<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="resources/code.css"><link rel="stylesheet" href="resources/tailwind.css"></head><body><div class="prose prose-xl mx-auto my-10"><h1>Artisan Console</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-commands">Writing Commands</a>

<ul>
<li><a href="#command-structure">Command Structure</a></li>
</ul></li>
<li><a href="#command-io">Command I/O</a>

<ul>
<li><a href="#defining-input-expectations">Defining Input Expectations</a></li>
<li><a href="#retrieving-input">Retrieving Input</a></li>
<li><a href="#prompting-for-input">Prompting For Input</a></li>
<li><a href="#writing-output">Writing Output</a></li>
</ul></li>
<li><a href="#registering-commands">Registering Commands</a></li>
<li><a href="#calling-commands-via-code">Calling Commands Via Code</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Artisan is the name of the command-line interface included with Laravel. It provides a number of helpful commands for your use while developing your application. It is driven by the powerful Symfony Console component. To view a list of all available Artisan commands, you may use the <code>list</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">list</span>
</pre></div>

<p>Every command also includes a &quot;help&quot; screen which displays and describes the command&#39;s available arguments and options. To view a help screen, simply precede the name of the command with <code>help</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">help</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="writing-commands"></a></p>

<h2>Writing Commands</h2>

<p>In addition to the commands provided with Artisan, you may also build your own custom commands for working with your application. You may store your custom commands in the <code>app/Console/Commands</code> directory; however, you are free to choose your own storage location as long as your commands can be autoloaded based on your <code>composer.json</code> settings.</p>

<p>To create a new command, you may use the <code>make:console</code> Artisan command, which will generate a command stub to help you get started:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">console</span> <span class="nx">SendEmails</span>
</pre></div>

<p>The command above would generate a class at <code>app/Console/Commands/SendEmails.php</code>. When creating the command, the <code>--command</code> option may be used to assign the terminal command name:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">console</span> <span class="nx">SendEmails</span> <span class="o">--</span><span class="nx">command</span><span class="o">=</span><span class="nx">emails</span><span class="o">:</span><span class="nx">send</span>
</pre></div>

<p><a name="command-structure"></a></p>

<h3>Command Structure</h3>

<p>Once your command is generated, you should fill out the <code>signature</code> and <code>description</code> properties of the class, which will be used when displaying your command on the <code>list</code> screen.</p>

<p>The <code>handle</code> method will be called when your command is executed. You may place any command logic in this method. Let&#39;s take a look at an example command.</p>

<p>Note that we are able to inject any dependencies we need into the command&#39;s constructor. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject all dependencies type-hinted in the constructor. For greater code reusability, it is good practice to keep your console commands light and let them defer to application services to accomplish their tasks.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\DripEmailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendEmails</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user}&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;Send drip e-mails to a user&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The drip e-mail service.</span>
<span class="sd">     *</span>
<span class="sd">     * @var DripEmailer</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$drip</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new command instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  DripEmailer  $drip</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">DripEmailer</span> <span class="nv">$drip</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">drip</span> <span class="o">=</span> <span class="nv">$drip</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">drip</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">argument</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="command-io"></a></p>

<h2>Command I/O</h2>

<p><a name="defining-input-expectations"></a></p>

<h3>Defining Input Expectations</h3>

<p>When writing console commands, it is common to gather input from the user through arguments or options. Laravel makes it very convenient to define the input you expect from the user using the <code>signature</code> property on your commands. The <code>signature</code> property allows you to define the name, arguments, and options for the command in a single, expressive, route-like syntax.</p>

<p>All user supplied arguments and options are wrapped in curly braces. In the following example, the command defines one <strong>required</strong> argument: <code>user</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user}&#39;</span><span class="p">;</span>
</pre></div>

<p>You may also make arguments optional and define default values for optional arguments:</p>
<div class="highlight"><pre><span></span><span class="c1">// Optional argument...</span>
<span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="o">?</span><span class="p">}</span>

<span class="c1">// Optional argument with default value...</span>
<span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="o">=</span><span class="nx">foo</span><span class="p">}</span>
</pre></div>

<p>Options, like arguments, are also a form of user input. However, they are prefixed by two hyphens (<code>--</code>) when they are specified on the command line. We can define options in the signature like so:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user} {--queue}&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the <code>--queue</code> switch may be specified when calling the Artisan command. If the <code>--queue</code> switch is passed, the value of the option will be <code>true</code>. Otherwise, the value will be <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="mi">1</span> <span class="o">--</span><span class="nx">queue</span>
</pre></div>

<p>You may also specify that the option should be assigned a value by the user by suffixing the option name with a <code>=</code> sign, indicating that a value should be provided:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user} {--queue=}&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the user may pass a value for the option like so:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="mi">1</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="k">default</span>
</pre></div>

<p>You may also assign default values to options:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="p">{</span><span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="k">default</span><span class="p">}</span>
</pre></div>

<p>To assign a shortcut when defining an option, you may specify it before the option name and use a | delimiter to separate the shortcut from the full option name:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="p">{</span><span class="o">--</span><span class="nx">Q</span><span class="o">|</span><span class="nx">queue</span><span class="p">}</span>
</pre></div>

<h4>Input Descriptions</h4>

<p>You may assign descriptions to input arguments and options by separating the parameter from the description using a colon:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send</span>
<span class="s1">                        {user : The ID of the user}</span>
<span class="s1">                        {--queue= : Whether the job should be queued}&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="retrieving-input"></a></p>

<h3>Retrieving Input</h3>

<p>While your command is executing, you will obviously need to access the values for the arguments and options accepted by your command. To do so, you may use the <code>argument</code> and <code>option</code> methods:</p>

<p>To retrieve the value of an argument, use the <code>argument</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$userId</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you need to retrieve all of the arguments as an <code>array</code>, call <code>argument</code> with no parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">$arguments</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">();</span>
</pre></div>

<p>Options may be retrieved just as easily as arguments using the <code>option</code> method. Like the <code>argument</code> method, you may call <code>option</code> without any parameters in order to retrieve all of the options as an <code>array</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve a specific option...</span>
<span class="nx">$queueName</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;queue&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve all options...</span>
<span class="nx">$options</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">();</span>
</pre></div>

<p>If the argument or option does not exist, <code>null</code> will be returned.</p>

<p><a name="prompting-for-input"></a></p>

<h3>Prompting For Input</h3>

<p>In addition to displaying output, you may also ask the user to provide input during the execution of your command. The <code>ask</code> method will prompt the user with the given question, accept their input, and then return the user&#39;s input back to your command:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">ask</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>secret</code> method is similar to <code>ask</code>, but the user&#39;s input will not be visible to them as they type in the console. This method is useful when asking for sensitive information such as a password:</p>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">secret</span><span class="p">(</span><span class="s1">&#39;What is the password?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking For Confirmation</h4>

<p>If you need to ask the user for a simple confirmation, you may use the <code>confirm</code> method. By default, this method will return <code>false</code>. However, if the user enters <code>y</code> in response to the prompt, the method will return <code>true</code>.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;Do you wish to continue? [y|N]&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Giving The User A Choice</h4>

<p>The <code>anticipate</code> method can be used to provided autocompletion for possible choices. The user can still choose any answer, regardless of the choices.</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">anticipate</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<p>If you need to give the user a predefined set of choices, you may use the <code>choice</code> method. The user chooses the index of the answer, but the value of the answer will be returned to you. You may set the default value to be returned if nothing is chosen:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>

<p><a name="writing-output"></a></p>

<h3>Writing Output</h3>

<p>To send output to the console, use the <code>line</code>, <code>info</code>, <code>comment</code>, <code>question</code> and <code>error</code> methods. Each of these methods will use the appropriate ANSI colors for their purpose.</p>

<p>To display an information message to the user, use the <code>info</code> method. Typically, this will display in the console as green text:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>To display an error message, use the <code>error</code> method. Error message text is typically displayed in red:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">);</span>
</pre></div>

<p>If you want to display plain console output, use the <code>line</code> method. The <code>line</code> method does not receive any unique coloration:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
</pre></div>

<h4>Table Layouts</h4>

<p>The <code>table</code> method makes it easy to correctly format multiple rows / columns of data. Just pass in the headers and rows to the method. The width and height will be dynamically calculated based on the given data:</p>
<div class="highlight"><pre><span></span><span class="nx">$headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">];</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">table</span><span class="p">(</span><span class="nx">$headers</span><span class="p">,</span> <span class="nx">$users</span><span class="p">);</span>
</pre></div>

<h4>Progress Bars</h4>

<p>For long running tasks, it could be helpful to show a progress indicator. Using the output object, we can start, advance and stop the Progress Bar. You have to define the number of steps when you start the progress, then advance the Progress Bar after each step:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$bar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">output</span><span class="o">-&gt;</span><span class="nx">createProgressBar</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$users</span><span class="p">));</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">performTask</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>

    <span class="nx">$bar</span><span class="o">-&gt;</span><span class="nx">advance</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">$bar</span><span class="o">-&gt;</span><span class="nx">finish</span><span class="p">();</span>
</pre></div>

<p>For more advanced options, check out the <a href="http://symfony.com/doc/2.7/components/console/helpers/progressbar.html">Symfony Progress Bar component documentation</a>.</p>

<p><a name="registering-commands"></a></p>

<h2>Registering Commands</h2>

<p>Once your command is finished, you need to register it with Artisan so it will be available for use. This is done within the <code>app/Console/Kernel.php</code> file.</p>

<p>Within this file, you will find a list of commands in the <code>commands</code> property. To register your command, simply add the class name to the list. When Artisan boots, all the commands listed in this property will be resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and registered with Artisan:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$commands</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Commands</span><span class="err">\</span><span class="nx">SendEmails</span><span class="o">::</span><span class="kr">class</span>
<span class="p">];</span>
</pre></div>

<p><a name="calling-commands-via-code"></a></p>

<h2>Calling Commands Via Code</h2>

<p>Sometimes you may wish to execute an Artisan command outside of the CLI. For example, you may wish to fire an Artisan command from a route or controller. You may use the <code>call</code> method on the <code>Artisan</code> facade to accomplish this. The <code>call</code> method accepts the name of the command as the first argument, and an array of command parameters as the second argument. The exit code will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Using the <code>queue</code> method on the <code>Artisan</code> facade, you may even queue Artisan commands so they are processed in the background by your <a href="/docs/%7B%7Bversion%7D%7D/queues">queue workers</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Artisan</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If you need to specify the value of an option that does not accept string values, such as the <code>--force</code> flag on the <code>migrate:refresh</code> command, you may pass a boolean <code>true</code> or <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;migrate:refresh&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;--force&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h3>Calling Commands From Other Commands</h3>

<p>Sometimes you may wish to call other commands from an existing Artisan command. You may do so using the <code>call</code> method. This <code>call</code> method accepts the command name and an array of command parameters:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to call another console command and suppress all of its output, you may use the <code>callSilent</code> method. The <code>callSilent</code> method has the same signature as the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">callSilent</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
<span class="p">]);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Authentication</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#introduction-database-considerations">Database Considerations</a></li>
</ul></li>
<li><a href="#authentication-quickstart">Authentication Quickstart</a>

<ul>
<li><a href="#included-routing">Routing</a></li>
<li><a href="#included-views">Views</a></li>
<li><a href="#included-authenticating">Authenticating</a></li>
<li><a href="#retrieving-the-authenticated-user">Retrieving The Authenticated User</a></li>
<li><a href="#protecting-routes">Protecting Routes</a></li>
<li><a href="#authentication-throttling">Authentication Throttling</a></li>
</ul></li>
<li><a href="#authenticating-users">Manually Authenticating Users</a>

<ul>
<li><a href="#remembering-users">Remembering Users</a></li>
<li><a href="#other-authentication-methods">Other Authentication Methods</a></li>
</ul></li>
<li><a href="#http-basic-authentication">HTTP Basic Authentication</a>

<ul>
<li><a href="#stateless-http-basic-authentication">Stateless HTTP Basic Authentication</a></li>
</ul></li>
<li><a href="#resetting-passwords">Resetting Passwords</a>

<ul>
<li><a href="#resetting-database">Database Considerations</a></li>
<li><a href="#resetting-routing">Routing</a></li>
<li><a href="#resetting-views">Views</a></li>
<li><a href="#after-resetting-passwords">After Resetting Passwords</a></li>
</ul></li>
<li><a href="#social-authentication">Social Authentication</a></li>
<li><a href="#adding-custom-authentication-drivers">Adding Custom Authentication Drivers</a></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel makes implementing authentication very simple. In fact, almost everything is configured for you out of the box. The authentication configuration file is located at <code>config/auth.php</code>, which contains several well documented options for tweaking the behavior of the authentication services.</p>

<p><a name="introduction-database-considerations"></a></p>

<h3>Database Considerations</h3>

<p>By default, Laravel includes an <code>App\User</code> <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent model</a> in your <code>app</code> directory. This model may be used with the default Eloquent authentication driver. If your application is not using Eloquent, you may use the <code>database</code> authentication driver which uses the Laravel query builder.</p>

<p>When building the database schema for the <code>App\User</code> model, make sure the password column is at least 60 characters in length.</p>

<p>Also, you should verify that your <code>users</code> (or equivalent) table contains a nullable, string <code>remember_token</code> column of 100 characters. This column will be used to store a token for &quot;remember me&quot; sessions being maintained by your application. This can be done by using <code>$table-&gt;rememberToken();</code> in a migration.</p>

<p><a name="authentication-quickstart"></a></p>

<h2>Authentication Quickstart</h2>

<p>Laravel ships with two authentication controllers out of the box, which are located in the <code>App\Http\Controllers\Auth</code> namespace. The <code>AuthController</code> handles new user registration and authentication, while the <code>PasswordController</code> contains the logic to help existing users reset their forgotten passwords. Each of these controllers uses a trait to include their necessary methods. For many applications, you will not need to modify these controllers at all.</p>

<p><a name="included-routing"></a></p>

<h3>Routing</h3>

<p>By default, no <a href="/docs/%7B%7Bversion%7D%7D/routing">routes</a> are included to point requests to the authentication controllers. You may manually add them to your <code>app/Http/routes.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="c1">// Authentication routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getLogin&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;auth/login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@postLogin&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/logout&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getLogout&#39;</span><span class="p">);</span>

<span class="c1">// Registration routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getRegister&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;auth/register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@postRegister&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="included-views"></a></p>

<h3>Views</h3>

<p>Though the authentication controllers are included with the framework, you will need to provide <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> that these controllers can render. The views should be placed in the <code>resources/views/auth</code> directory. You are free to customize these views however you wish. The login view should be placed at <code>resources/views/auth/login.blade.php</code>, and the registration view should be placed at <code>resources/views/auth/register.blade.php</code>.</p>

<h4>Sample Authentication Form</h4>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">login</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/auth/login&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Email</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;email&#39;) }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;remember&quot;</span><span class="o">&gt;</span> <span class="nx">Remember</span> <span class="nx">Me</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="nx">Login</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<h4>Sample Registration Form</h4>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">register</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/auth/register&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Name</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;name&#39;) }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Email</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;email&#39;) }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Confirm</span> <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password_confirmation&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="nx">Register</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="included-authenticating"></a></p>

<h3>Authenticating</h3>

<p>Now that you have routes and views setup for the included authentication controllers, you are ready to register and authenticate new users for your application. You may simply access your defined routes in a browser. The authentication controllers already contain the logic (via their traits) to authenticate existing users and store new users in the database.</p>

<p>When a user is successfully authenticated, they will be redirected to the <code>/home</code> URI, which you will need to register a route to handle. You can customize the post-authentication redirect location by defining a <code>redirectPath</code> property on the <code>AuthController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$redirectPath</span> <span class="o">=</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">;</span>
</pre></div>

<p>When a user is not successfully authenticated, they will be redirected to the <code>/auth/login</code> URI. You can customize the failed post-authentication redirect location by defining a <code>loginPath</code> property on the <code>AuthController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$loginPath</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span><span class="p">;</span>
</pre></div>

<p>The <code>loginPath</code> will not change where a user is bounced if they try to access a protected route. That is controlled by the <code>App\Http\Middleware\Authenticate</code> middleware&#39;s <code>handle</code> method.</p>

<h4>Customizations</h4>

<p>To modify the form fields that are required when a new user registers with your application, or to customize how new user records are inserted into your database, you may modify the <code>AuthController</code> class. This class is responsible for validating and creating new users of your application.</p>

<p>The <code>validator</code> method of the <code>AuthController</code> contains the validation rules for new users of the application. You are free to modify this method as you wish.</p>

<p>The <code>create</code> method of the <code>AuthController</code> is responsible for creating new <code>App\User</code> records in your database using the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>. You are free to modify this method according to the needs of your database.</p>

<p><a name="retrieving-the-authenticated-user"></a></p>

<h3>Retrieving The Authenticated User</h3>

<p>You may access the authenticated user via the <code>Auth</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">();</span>
</pre></div>

<p>Alternatively, once a user is authenticated, you may access the authenticated user via an <code>Illuminate\Http\Request</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the user&#39;s profile.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateProfile</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// $request-&gt;user() returns an instance of the authenticated user...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If The Current User Is Authenticated</h4>

<p>To determine if the user is already logged into your application, you may use the <code>check</code> method on the <code>Auth</code> facade, which will return <code>true</code> if the user is authenticated:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// The user is logged in...</span>
<span class="p">}</span>
</pre></div>

<p>However, you may use middleware to verify that the user is authenticated before allowing the user access to certain routes / controllers. To learn more about this, check out the documentation on <a href="/docs/%7B%7Bversion%7D%7D/authentication#protecting-routes">protecting routes</a>.</p>

<p><a name="protecting-routes"></a></p>

<h3>Protecting Routes</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Route middleware</a> can be used to allow only authenticated users to access a given route. Laravel ships with the <code>auth</code> middleware, which is defined in <code>app\Http\Middleware\Authenticate.php</code>. All you need to do is attach the middleware to a route definition:</p>
<div class="highlight"><pre><span></span><span class="c1">// Using A Route Closure...</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}]);</span>

<span class="c1">// Using A Controller...</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ProfileController@show&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>Of course, if you are using <a href="/docs/%7B%7Bversion%7D%7D/controllers">controller classes</a>, you may call the <code>middleware</code> method from the controller&#39;s constructor instead of attaching it in the route definition directly:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="authentication-throttling"></a></p>

<h3>Authentication Throttling</h3>

<p>If you are using Laravel&#39;s built-in <code>AuthController</code> class, the <code>Illuminate\Foundation\Auth\ThrottlesLogins</code> trait may be used to throttle login attempts to your application. By default, the user will not be able to login for one minute if they fail to provide the correct credentials after several attempts. The throttling is unique to the user&#39;s username / e-mail address and their IP address:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Validator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\ThrottlesLogins</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\AuthenticatesAndRegistersUsers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">AuthenticatesAndRegistersUsers</span><span class="p">,</span> <span class="nx">ThrottlesLogins</span><span class="p">;</span>

    <span class="c1">// Rest of AuthController class...</span>
<span class="p">}</span>
</pre></div>

<p><a name="authenticating-users"></a></p>

<h2>Manually Authenticating Users</h2>

<p>Of course, you are not required to use the authentication controllers included with Laravel. If you choose to remove these controllers, you will need to manage user authentication using the Laravel authentication classes directly. Don&#39;t worry, it&#39;s a cinch!</p>

<p>We will access Laravel&#39;s authentication services via the <code>Auth</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>, so we&#39;ll need to make sure to import the <code>Auth</code> facade at the top of the class. Next, let&#39;s check out the <code>attempt</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an authentication attempt.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nv">$password</span><span class="p">]))</span> <span class="p">{</span>
            <span class="c1">// Authentication passed...</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">intended</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>attempt</code> method accepts an array of key / value pairs as its first argument. The values in the array will be used to find the user in your database table. So, in the example above, the user will be retrieved by the value of the <code>email</code> column. If the user is found, the hashed password stored in the database will be compared with the hashed <code>password</code> value passed to the method via the array. If the two hashed passwords match an authenticated session will be started for the user.</p>

<p>The <code>attempt</code> method will return <code>true</code> if authentication was successful. Otherwise, <code>false</code> will be returned.</p>

<p>The <code>intended</code> method on the redirector will redirect the user to the URL they were attempting to access before being caught by the authentication filter. A fallback URI may be given to this method in case the intended destination is not available.</p>

<p>If you wish, you also may add extra conditions to the authentication query in addition to the user&#39;s e-mail and password. For example, we may verify that user is marked as &quot;active&quot;:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// The user is active, not suspended, and exists.</span>
<span class="p">}</span>
</pre></div>

<p>To log users out of your application, you may use the <code>logout</code> method on the <code>Auth</code> facade. This will clear the authentication information in the user&#39;s session:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">logout</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> In these examples, <code>email</code> is not a required option, it is merely used as an example. You should use whatever column name corresponds to a &quot;username&quot; in your database.</p>
</blockquote>

<p><a name="remembering-users"></a></p>

<h3>Remembering Users</h3>

<p>If you would like to provide &quot;remember me&quot; functionality in your application, you may pass a boolean value as the second argument to the <code>attempt</code> method, which will keep the user authenticated indefinitely, or until they manually logout. Of course, your <code>users</code> table must include the string <code>remember_token</code> column, which will be used to store the &quot;remember me&quot; token.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">],</span> <span class="nx">$remember</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user is being remembered...</span>
<span class="p">}</span>
</pre></div>

<p>If you are &quot;remembering&quot; users, you may use the <code>viaRemember</code> method to determine if the user was authenticated using the &quot;remember me&quot; cookie:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">viaRemember</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="other-authentication-methods"></a></p>

<h3>Other Authentication Methods</h3>

<h4>Authenticate A User Instance</h4>

<p>If you need to log an existing user instance into your application, you may call the <code>login</code> method with the user instance. The given object must be an implementation of the <code>Illuminate\Contracts\Auth\Authenticatable</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a>. Of course, the <code>App\User</code> model included with Laravel already implements this interface:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<h4>Authenticate A User By ID</h4>

<p>To log a user into the application by their ID, you may use the <code>loginUsingId</code> method. This method simply accepts the primary key of the user you wish to authenticate:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">loginUsingId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<h4>Authenticate A User Once</h4>

<p>You may use the <code>once</code> method to log a user into the application for a single request. No sessions or cookies will be utilized, which may be helpful when building a stateless API. The <code>once</code> method has the same signature as the <code>attempt</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">once</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="http-basic-authentication"></a></p>

<h2>HTTP Basic Authentication</h2>

<p><a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> provides a quick way to authenticate users of your application without setting up a dedicated &quot;login&quot; page. To get started, attach the <code>auth.basic</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> to your route. The <code>auth.basic</code> middleware is included with the Laravel framework, so you do not need to define it:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth.basic&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}]);</span>
</pre></div>

<p>Once the middleware has been attached to the route, you will automatically be prompted for credentials when accessing the route in your browser. By default, the <code>auth.basic</code> middleware will use the <code>email</code> column on the user record as the &quot;username&quot;.</p>

<h4>A Note On FastCGI</h4>

<p>If you are using PHP FastCGI, HTTP Basic authentication may not work correctly out of the box. The following lines should be added to your <code>.htaccess</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}</span> <span class="o">^</span><span class="p">(.</span><span class="o">+</span><span class="p">)</span><span class="nx">$</span>
<span class="nx">RewriteRule</span> <span class="p">.</span><span class="o">*</span> <span class="o">-</span> <span class="p">[</span><span class="nx">E</span><span class="o">=</span><span class="nx">HTTP_AUTHORIZATION</span><span class="o">:%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}]</span>
</pre></div>

<p><a name="stateless-http-basic-authentication"></a></p>

<h3>Stateless HTTP Basic Authentication</h3>

<p>You may also use HTTP Basic Authentication without setting a user identifier cookie in the session, which is particularly useful for API authentication. To do so, <a href="/docs/%7B%7Bversion%7D%7D/middleware">define a middleware</a> that calls the <code>onceBasic</code> method. If no response is returned by the <code>onceBasic</code> method, the request may be passed further into the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Auth\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthenticateOnceWithBasicAuth</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">onceBasic</span><span class="p">()</span> <span class="o">?:</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Next, <a href="/docs/%7B%7Bversion%7D%7D/middleware#registering-middleware">register the route middleware</a> and attach it to a route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;api/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth.basic.once&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}]);</span>
</pre></div>

<p><a name="resetting-passwords"></a></p>

<h2>Resetting Passwords</h2>

<p><a name="resetting-database"></a></p>

<h3>Database Considerations</h3>

<p>Most web applications provide a way for users to reset their forgotten passwords. Rather than forcing you to re-implement this on each application, Laravel provides convenient methods for sending password reminders and performing password resets.</p>

<p>To get started, verify that your <code>App\User</code> model implements the <code>Illuminate\Contracts\Auth\CanResetPassword</code> contract. Of course, the <code>App\User</code> model included with the framework already implements this interface, and uses the <code>Illuminate\Auth\Passwords\CanResetPassword</code> trait to include the methods needed to implement the interface.</p>

<h4>Generating The Reset Token Table Migration</h4>

<p>Next, a table must be created to store the password reset tokens. The migration for this table is included with Laravel out of the box, and resides in the <code>database/migrations</code> directory. So, all you need to do is migrate:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="resetting-routing"></a></p>

<h3>Routing</h3>

<p>Laravel includes an <code>Auth\PasswordController</code> that contains the logic necessary to reset user passwords. However, you will need to define routes to point requests to this controller:</p>
<div class="highlight"><pre><span></span><span class="c1">// Password reset link request routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\PasswordController@getEmail&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\PasswordController@postEmail&#39;</span><span class="p">);</span>

<span class="c1">// Password reset routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;password/reset/{token}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\PasswordController@getReset&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\PasswordController@postReset&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="resetting-views"></a></p>

<h3>Views</h3>

<p>In addition to defining the routes for the <code>PasswordController</code>, you will need to provide views that can be returned by this controller. Don&#39;t worry, we will provide sample views to help you get started. Of course, you are free to style your forms however you wish.</p>

<h4>Sample Password Reset Link Request Form</h4>

<p>You will need to provide an HTML view for the password reset request form. This view should be placed at <code>resources/views/auth/password.blade.php</code>. This form provides a single field for the user&#39;s e-mail address, allowing them to request a password reset link:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">password</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/password/email&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>

    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Email</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;email&#39;) }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span>
            <span class="nx">Send</span> <span class="nx">Password</span> <span class="nx">Reset</span> <span class="nx">Link</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>When a user submits a request to reset their password, they will receive an e-mail with a link that points to the <code>getReset</code> method (typically routed at <code>/password/reset</code>) of the <code>PasswordController</code>. You will need to create a view for this e-mail at <code>resources/views/emails/password.blade.php</code>. The view will receive the <code>$token</code> variable which contains the password reset token to match the user to the password reset request. Here is an example e-mail view to get you started:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">emails</span><span class="o">/</span><span class="nx">password</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="nx">Click</span> <span class="nx">here</span> <span class="nx">to</span> <span class="nx">reset</span> <span class="nx">your</span> <span class="nx">password</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;http://example.com/password/reset/&#39;</span><span class="p">.</span><span class="nx">$token</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<h4>Sample Password Reset Form</h4>

<p>When the user clicks the e-mailed link to reset their password, they will be presented with a password reset form. This view should be placed at <code>resources/views/auth/reset.blade.php</code>.</p>

<p>Here is a sample password reset form to get you started:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">reset</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/password/reset&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ $token }}&quot;</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Email</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;email&#39;) }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Confirm</span> <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password_confirmation&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span>
            <span class="nx">Reset</span> <span class="nx">Password</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="after-resetting-passwords"></a></p>

<h3>After Resetting Passwords</h3>

<p>Once you have defined the routes and views to reset your user&#39;s passwords, you may simply access the routes in your browser. The <code>PasswordController</code> included with the framework already includes the logic to send the password reset link e-mails as well as update passwords in the database.</p>

<p>After the password is reset, the user will automatically be logged into the application and redirected to <code>/home</code>. You can customize the post password reset redirect location by defining a <code>redirectTo</code> property on the <code>PasswordController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">;</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, password reset tokens expire after one hour. You may change this via the <code>reminder.expire</code> option in your <code>config/auth.php</code> file.</p>
</blockquote>

<p><a name="social-authentication"></a></p>

<h2>Social Authentication</h2>

<p>In addition to typical, form based authentication, Laravel also provides a simple, convenient way to authenticate with OAuth providers using <a href="https://github.com/laravel/socialite">Laravel Socialite</a>. Socialite currently supports authentication with Facebook, Twitter, LinkedIn, Google, GitHub and Bitbucket.</p>

<p>To get started with Socialite, add to your <code>composer.json</code> file as a dependency:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">socialite</span>
</pre></div>

<h3>Configuration</h3>

<p>After installing the Socialite library, register the <code>Laravel\Socialite\SocialiteServiceProvider</code> in your <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// Other service providers...</span>

    <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Socialite</span><span class="err">\</span><span class="nx">SocialiteServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Also, add the <code>Socialite</code> facade to the <code>aliases</code> array in your <code>app</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Socialite&#39;</span> <span class="p">=&gt;</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Socialite</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Socialite</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
</pre></div>

<p>You will also need to add credentials for the OAuth services your application utilizes. These credentials should be placed in your <code>config/services.php</code> configuration file, and should use the key <code>facebook</code>, <code>twitter</code>, <code>linkedin</code>, <code>google</code>, <code>github</code> or <code>bitbucket</code>, depending on the providers your application requires. For example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;github&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-github-app-id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-github-app-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redirect&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://your-callback-url&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h3>Basic Usage</h3>

<p>Next, you are ready to authenticate users! You will need two routes: one for redirecting the user to the OAuth provider, and another for receiving the callback from the provider after authentication. We will access Socialite using the <code>Socialite</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Socialite</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Redirect the user to the GitHub authentication page.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">redirectToProvider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Obtain the user information from GitHub.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleProviderCallback</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>

        <span class="c1">// $user-&gt;token;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>redirect</code> method takes care of sending the user to the OAuth provider, while the <code>user</code> method will read the incoming request and retrieve the user&#39;s information from the provider. Before redirecting the user, you may also set &quot;scopes&quot; on the request using the <code>scope</code> method. This method will overwrite all existing scopes:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">scopes</span><span class="p">([</span><span class="s1">&#39;scope1&#39;</span><span class="p">,</span> <span class="s1">&#39;scope2&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<p>Of course, you will need to define routes to your controller methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/github&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@redirectToProvider&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/github/callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@handleProviderCallback&#39;</span><span class="p">);</span>
</pre></div>

<p>A number of OAuth providers support optional parameters in the redirect request. To include any optional parameters in the request, call the <code>with</code> method with an associative array:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;hd&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example.com&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<h4>Retrieving User Details</h4>

<p>Once you have a user instance, you can grab a few more details about the user:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>

<span class="c1">// OAuth Two Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>

<span class="c1">// OAuth One Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>
<span class="nx">$tokenSecret</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokenSecret</span><span class="p">;</span>

<span class="c1">// All Providers</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getId</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getNickname</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getName</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getEmail</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getAvatar</span><span class="p">();</span>
</pre></div>

<p><a name="adding-custom-authentication-drivers"></a></p>

<h2>Adding Custom Authentication Drivers</h2>

<p>If you are not using a traditional relational database to store your users, you will need to extend Laravel with your own authentication driver. We will use the <code>extend</code> method on the <code>Auth</code> facade to define a custom driver. You should place this call to <code>extend</code> within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Extensions\RiakUserProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Auth</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return an instance of Illuminate\Contracts\Auth\UserProvider...</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">RiakUserProvider</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;riak.connection&#39;</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After you have registered the driver with the <code>extend</code> method, you may switch to the new driver in your <code>config/auth.php</code> configuration file.</p>

<h3>The User Provider Contract</h3>

<p>The <code>Illuminate\Contracts\Auth\UserProvider</code> implementations are only responsible for fetching a <code>Illuminate\Contracts\Auth\Authenticatable</code> implementation out of a persistent storage system, such as MySQL, Riak, etc. These two interfaces allow the Laravel authentication mechanisms to continue functioning regardless of how the user data is stored or what type of class is used to represent it.</p>

<p>Let&#39;s take a look at the <code>Illuminate\Contracts\Auth\UserProvider</code> contract:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Contracts\Auth</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">UserProvider</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveById</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveByToken</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateRememberToken</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveByCredentials</span><span class="p">(</span><span class="k">array</span> <span class="nv">$credentials</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateCredentials</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nv">$user</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$credentials</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>The <code>retrieveById</code> function typically receives a key representing the user, such as an auto-incrementing ID from a MySQL database. The <code>Authenticatable</code> implementation matching the ID should be retrieved and returned by the method.</p>

<p>The <code>retrieveByToken</code> function retrieves a user by their unique <code>$identifier</code> and &quot;remember me&quot; <code>$token</code>, stored in a field <code>remember_token</code>. As with the previous method, the <code>Authenticatable</code> implementation should be returned.</p>

<p>The <code>updateRememberToken</code> method updates the <code>$user</code> field <code>remember_token</code> with the new <code>$token</code>. The new token can be either a fresh token, assigned on a successful &quot;remember me&quot; login attempt, or a null when the user is logged out.</p>

<p>The <code>retrieveByCredentials</code> method receives the array of credentials passed to the <code>Auth::attempt</code> method when attempting to sign into an application. The method should then &quot;query&quot; the underlying persistent storage for the user matching those credentials. Typically, this method will run a query with a &quot;where&quot; condition on <code>$credentials[&#39;username&#39;]</code>. The method should then return an implementation of <code>UserInterface</code>. <strong>This method should not attempt to do any password validation or authentication.</strong></p>

<p>The <code>validateCredentials</code> method should compare the given <code>$user</code> with the <code>$credentials</code> to authenticate the user. For example, this method might compare the <code>$user-&gt;getAuthPassword()</code> string to a <code>Hash::make</code> of <code>$credentials[&#39;password&#39;]</code>. This method should only validate the user&#39;s credentials and return a boolean.</p>

<h3>The Authenticatable Contract</h3>

<p>Now that we have explored each of the methods on the <code>UserProvider</code>, let&#39;s take a look at the <code>Authenticatable</code> contract. Remember, the provider should return implementations of this interface from the <code>retrieveById</code> and <code>retrieveByCredentials</code> methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Contracts\Auth</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Authenticatable</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthIdentifier</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthPassword</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRememberToken</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setRememberToken</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRememberTokenName</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>

<p>This interface is simple. The <code>getAuthIdentifier</code> method should return the &quot;primary key&quot; of the user. In a MySQL back-end, again, this would be the auto-incrementing primary key. The <code>getAuthPassword</code> should return the user&#39;s hashed password. This interface allows the authentication system to work with any User class, regardless of what ORM or storage abstraction layer you are using. By default, Laravel includes a <code>User</code> class in the <code>app</code> directory which implements this interface, so you may consult this class for an implementation example.</p>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Laravel raises a variety of <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> during the authentication process. You may attach listeners to these events in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Contracts\Events\Dispatcher  $events</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">DispatcherContract</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$events</span><span class="p">);</span>

    <span class="c1">// Fired on each authentication attempt...</span>
    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.attempt&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$credentials</span><span class="p">,</span> <span class="nx">$remember</span><span class="p">,</span> <span class="nx">$login</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="c1">// Fired on successful logins...</span>
    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$remember</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="c1">// Fired on logouts...</span>
    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.logout&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Authorization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-abilities">Defining Abilities</a></li>
<li><a href="#checking-abilities">Checking Abilities</a>

<ul>
<li><a href="#via-the-gate-facade">Via The Gate Facade</a></li>
<li><a href="#via-the-user-model">Via The User Model</a></li>
<li><a href="#within-blade-templates">Within Blade Templates</a></li>
<li><a href="#within-form-requests">Within Form Requests</a></li>
</ul></li>
<li><a href="#policies">Policies</a>

<ul>
<li><a href="#creating-policies">Creating Policies</a></li>
<li><a href="#writing-policies">Writing Policies</a></li>
<li><a href="#checking-policies">Checking Policies</a></li>
</ul></li>
<li><a href="#controller-authorization">Controller Authorization</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to providing <a href="/docs/%7B%7Bversion%7D%7D/authentication">authentication</a> services out of the box, Laravel also provides a simple way to organize authorization logic and control access to resources. There are a variety of methods and helpers to assist you in organizing your authorization logic, and we&#39;ll cover each of them in this document.</p>

<blockquote>
<p><strong>Note:</strong> Authorization was added in Laravel 5.1.11, please refer to the <a href="/docs/%7B%7Bversion%7D%7D/upgrade">upgrade guide</a> before integrating these features into your application.</p>
</blockquote>

<p><a name="defining-abilities"></a></p>

<h2>Defining Abilities</h2>

<p>The simplest way to determine if a user may perform a given action is to define an &quot;ability&quot; using the <code>Illuminate\Auth\Access\Gate</code> class. The <code>AuthServiceProvider</code> which ships with Laravel serves as a convenient location to define all of the abilities for your application. For example, let&#39;s define an <code>update-post</code> ability which receives the current <code>User</code> and a <code>Post</code> <a href="/docs/%7B%7Bversion%7D%7D/eloquent">model</a>. Within our ability, we will determine if the user&#39;s <code>id</code> matches the post&#39;s <code>user_id</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\Access\Gate</span> <span class="k">as</span> <span class="nx">GateContract</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Contracts\Auth\Access\Gate  $gate</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">(</span><span class="nx">GateContract</span> <span class="nv">$gate</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">(</span><span class="nv">$gate</span><span class="p">);</span>

        <span class="nv">$gate</span><span class="o">-&gt;</span><span class="na">define</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Note that we did not check if the given <code>$user</code> is not <code>NULL</code>. The <code>Gate</code> will automatically return <code>false</code> for <strong>all abilities</strong> when there is not an authenticated user or a specific user has not been specified using the <code>forUser</code> method.</p>

<h4>Class Based Abilities</h4>

<p>In addition to registering <code>Closures</code> as authorization callbacks, you may register class methods by passing a string containing the class name and the method. When needed, the class will be resolved via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$gate</span><span class="o">-&gt;</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="s1">&#39;Class@method&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="intercepting-all-checks"></a>
<a name="intercepting-authorization-checks"></a></p>

<h4>Intercepting Authorization Checks</h4>

<p>Sometimes, you may wish to grant all abilities to a specific user. For this situation, use the <code>before</code> method to define a callback that is run before all other authorization checks:</p>
<div class="highlight"><pre><span></span><span class="nx">$gate</span><span class="o">-&gt;</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isSuperAdmin</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>If the <code>before</code> callback returns a non-null result that result will be considered the result of the check.</p>

<p>You may use the <code>after</code> method to define a callback to be executed after every authorization check. However, you may not modify the result of the authorization check from an <code>after</code> callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$gate</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">,</span> <span class="nx">$result</span><span class="p">,</span> <span class="nx">$arguments</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="checking-abilities"></a></p>

<h2>Checking Abilities</h2>

<p><a name="via-the-gate-facade"></a></p>

<h3>Via The Gate Facade</h3>

<p>Once an ability has been defined, we may &quot;check&quot; it in a variety of ways. First, we may use the <code>check</code>, <code>allows</code>, or <code>denies</code> methods on the <code>Gate</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. All of these methods receive the name of the ability and the arguments that should be passed to the ability&#39;s callback. You do <strong>not</strong> need to pass the current user to these methods, since the <code>Gate</code> will automatically prepend the current user to the arguments passed to the callback. So, when checking the <code>update-post</code> ability we defined earlier, we only need to pass a <code>Post</code> instance to the <code>denies</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Gate</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="na">denies</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Update Post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, the <code>allows</code> method is simply the inverse of the <code>denies</code> method, and returns <code>true</code> if the action is authorized. The <code>check</code> method is an alias of the <code>allows</code> method.</p>

<h4>Checking Abilities For Specific Users</h4>

<p>If you would like to use the <code>Gate</code> facade to check if a user <strong>other than the currently authenticated user</strong> has a given ability, you may use the <code>forUser</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">forUser</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Passing Multiple Arguments</h4>

<p>Of course, ability callbacks may receive multiple arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;delete-comment&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$post</span><span class="p">,</span> <span class="nx">$comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If your ability needs multiple arguments, simply pass an array of arguments to the <code>Gate</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;delete-comment&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$post</span><span class="p">,</span> <span class="nx">$comment</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="via-the-user-model"></a></p>

<h3>Via The User Model</h3>

<p>Alternatively, you may check abilities via the <code>User</code> model instance. By default, Laravel&#39;s <code>App\User</code> model uses an <code>Authorizable</code> trait which provides two methods: <code>can</code> and <code>cannot</code>. These methods may be used similarly to the <code>allows</code> and <code>denies</code> methods present on the <code>Gate</code> facade. So, using our previous example, we may modify our code like so:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cannot</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Update Post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, the <code>can</code> method is simply the inverse of the <code>cannot</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Update Post...</span>
<span class="p">}</span>
</pre></div>

<p><a name="within-blade-templates"></a></p>

<h3>Within Blade Templates</h3>

<p>For convenience, Laravel provides the <code>@can</code> Blade directive to quickly check if the currently authenticated user has a given ability. For example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/post/{{ $post-&gt;id }}&quot;</span><span class="o">&gt;</span><span class="nx">View</span> <span class="nx">Post</span><span class="o">&lt;</span><span class="err">/a&gt;</span>

<span class="err">@</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/post/{{ $post-&gt;id }}/edit&quot;</span><span class="o">&gt;</span><span class="nx">Edit</span> <span class="nx">Post</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
<span class="err">@</span><span class="nx">endcan</span>
</pre></div>

<p>You may also combine the <code>@can</code> directive with <code>@else</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="k">else</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcan</span>
</pre></div>

<p><a name="within-form-requests"></a></p>

<h3>Within Form Requests</h3>

<p>You may also choose to utilize your <code>Gate</code> defined abilities from a <a href="/docs/%7B%7Bversion%7D%7D/validation#form-request-validation">form request&#39;s</a> <code>authorize</code> method. For example:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$postId</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">Gate</span><span class="o">::</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$postId</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p><a name="policies"></a></p>

<h2>Policies</h2>

<p><a name="creating-policies"></a></p>

<h3>Creating Policies</h3>

<p>Since defining all of your authorization logic in the <code>AuthServiceProvider</code> could become cumbersome in large applications, Laravel allows you to split your authorization logic into &quot;Policy&quot; classes. Policies are plain PHP classes that group authorization logic based on the resource they authorize.</p>

<p>First, let&#39;s generate a policy to manage authorization for our <code>Post</code> model. You may generate a policy using the <code>make:policy</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">artisan command</a>. The generated policy will be placed in the <code>app/Policies</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">policy</span> <span class="nx">PostPolicy</span>
</pre></div>

<h4>Registering Policies</h4>

<p>Once the policy exists, we need to register it with the <code>Gate</code> class. The <code>AuthServiceProvider</code> contains a <code>policies</code> property which maps various entities to the policies that manage them. So, we will specify that the <code>Post</code> model&#39;s policy is the <code>PostPolicy</code> class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Policies\PostPolicy</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The policy mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$policies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">Post</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="nx">PostPolicy</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Register any application authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Contracts\Auth\Access\Gate  $gate</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">(</span><span class="nx">GateContract</span> <span class="nv">$gate</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">(</span><span class="nv">$gate</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="writing-policies"></a></p>

<h3>Writing Policies</h3>

<p>Once the policy has been generated and registered, we can add methods for each ability it authorizes. For example, let&#39;s define an <code>update</code> method on our <code>PostPolicy</code>, which will determine if the given <code>User</code> can &quot;update&quot; a <code>Post</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Policies</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostPolicy</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Determine if the given post can be updated by the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\User  $user</span>
<span class="sd">     * @param  \App\Post  $post</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may continue to define additional methods on the policy as needed for the various abilities it authorizes. For example, you might define <code>show</code>, <code>destroy</code>, or <code>addComment</code> methods to authorize various <code>Post</code> actions.</p>

<blockquote>
<p><strong>Note:</strong> All policies are resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, meaning you may type-hint any needed dependencies in the policy&#39;s constructor and they will be automatically injected.</p>
</blockquote>

<h4>Intercepting All Checks</h4>

<p>Sometimes, you may wish to grant all abilities to a specific user on a policy. For this situation, define a <code>before</code> method on the policy. This method will be run before all other authorization checks on the policy:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">before</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isSuperAdmin</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If the <code>before</code> method returns a non-null result that result will be considered the result of the check.</p>

<p><a name="checking-policies"></a></p>

<h3>Checking Policies</h3>

<p>Policy methods are called in exactly the same way as <code>Closure</code> based authorization callbacks. You may use the <code>Gate</code> facade, the <code>User</code> model, the <code>@can</code> Blade directive, or the <code>policy</code> helper.</p>

<h4>Via The Gate Facade</h4>

<p>The <code>Gate</code> will automatically determine which policy to use by examining the class of the arguments passed to its methods. So, if we pass a <code>Post</code> instance to the <code>denies</code> method, the <code>Gate</code> will utilize the corresponding <code>PostPolicy</code> to authorize actions:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Gate</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="na">denies</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Update Post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Via The User Model</h4>

<p>The <code>User</code> model&#39;s <code>can</code> and <code>cannot</code> methods will also automatically utilize policies when they are available for the given arguments. These methods provide a convenient way to authorize actions for any <code>User</code> instance retrieved by your application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">cannot</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Within Blade Templates</h4>

<p>Likewise, the <code>@can</code> Blade directive will utilize policies when they are available for the given arguments:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcan</span>
</pre></div>

<h4>Via The Policy Helper</h4>

<p>The global <code>policy</code> helper function may be used to retrieve the <code>Policy</code> class for a given class instance. For example, we may pass a <code>Post</code> instance to the <code>policy</code> helper to get an instance of our corresponding <code>PostPolicy</code> class:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">policy</span><span class="p">(</span><span class="nx">$post</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="controller-authorization"></a></p>

<h2>Controller Authorization</h2>

<p>By default, the base <code>App\Http\Controllers\Controller</code> class included with Laravel uses the <code>AuthorizesRequests</code> trait. This trait provides the <code>authorize</code> method, which may be used to quickly authorize a given action and throw a <code>HttpException</code> if the action is not authorized.</p>

<p>The <code>authorize</code> method shares the same signature as the various other authorization methods such as <code>Gate::allows</code> and <code>$user-&gt;can()</code>. So, let&#39;s use the <code>authorize</code> method to quickly authorize a request to update a <code>Post</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authorize</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">);</span>

        <span class="c1">// Update Post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If the action is authorized, the controller will continue executing normally; however, if the <code>authorize</code> method determines that the action is not authorized, a <code>HttpException</code> will automatically be thrown which generates a HTTP response with a <code>403 Not Authorized</code> status code. As you can see, the <code>authorize</code> method is a convenient, fast way to authorize an action or throw an exception with a single line of code.</p>

<p>The <code>AuthorizesRequests</code> trait also provides the <code>authorizeForUser</code> method to authorize an action on a user that is not the currently authenticated user:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorizeForUser</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>
</pre></div>

<h4>Automatically Determining Policy Methods</h4>

<p>Frequently, a policy&#39;s methods will correspond to the methods on a controller. For example, in the <code>update</code> method above, the controller method and the policy method share the same name: <code>update</code>.</p>

<p>For this reason, Laravel allows you to simply pass the instance arguments to the <code>authorize</code> method, and the ability being authorized will automatically be determined based on the name of the calling function. In this example, since <code>authorize</code> is called from the controller&#39;s <code>update</code> method, the <code>update</code> method will also be called on the <code>PostPolicy</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Update the given post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  int  $id</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorize</span><span class="p">(</span><span class="nx">$post</span><span class="p">);</span>

    <span class="c1">// Update Post...</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Cashier</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#subscriptions">Subscriptions</a>

<ul>
<li><a href="#creating-subscriptions">Creating Subscriptions</a></li>
<li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
<li><a href="#changing-plans">Changing Plans</a></li>
<li><a href="#subscription-quantity">Subscription Quantity</a></li>
<li><a href="#subscription-taxes">Subscription Taxes</a></li>
<li><a href="#cancelling-subscriptions">Cancelling Subscriptions</a></li>
<li><a href="#resuming-subscriptions">Resuming Subscriptions</a></li>
</ul></li>
<li><a href="#handling-stripe-webhooks">Handling Stripe Webhooks</a>

<ul>
<li><a href="#handling-failed-subscriptions">Failed Subscriptions</a></li>
<li><a href="#handling-other-webhooks">Other Webhooks</a></li>
</ul></li>
<li><a href="#single-charges">Single Charges</a></li>
<li><a href="#invoices">Invoices</a>

<ul>
<li><a href="#generating-invoice-pdfs">Generating Invoice PDFs</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Cashier provides an expressive, fluent interface to <a href="https://stripe.com">Stripe&#39;s</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading writing. In addition to basic subscription management, Cashier can handle coupons, swapping subscription, subscription &quot;quantities&quot;, cancellation grace periods, and even generate invoice PDFs.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<h4>Composer</h4>

<p>First, add the Cashier package to your <code>composer.json</code> file and run the <code>composer update</code> command:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">SDK</span> <span class="o">~</span><span class="mf">2.0</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">on</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="nx">version</span> <span class="nx">and</span> <span class="nx">later</span><span class="p">)</span>
<span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~4.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">on</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="nx">version</span> <span class="nx">and</span> <span class="nx">later</span><span class="p">)</span>
<span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">up</span> <span class="nx">to</span> <span class="nx">and</span> <span class="nx">including</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="nx">version</span><span class="p">)</span>
</pre></div>

<h4>Service Provider</h4>

<p>Next, register the <code>Laravel\Cashier\CashierServiceProvider</code> <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> in your <code>app</code> configuration file.</p>

<h4>Migration</h4>

<p>Before using Cashier, we&#39;ll need to add several columns to your database. Don&#39;t worry, you can use the <code>cashier:table</code> Artisan command to create a migration to add the necessary column. For example, to add the column to the users table run the command: <code>php artisan cashier:table users</code>.</p>

<p>Once the migration has been created, simply run the <code>migrate</code> command.</p>

<h4>Model Setup</h4>

<p>Next, add the <code>Billable</code> trait and appropriate date mutators to your model definition:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Billable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Billable</span> <span class="nx">as</span> <span class="nx">BillableContract</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="kr">implements</span> <span class="nx">BillableContract</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">Billable</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trial_ends_at&#39;</span><span class="p">,</span> <span class="s1">&#39;subscription_ends_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Adding the columns to your model&#39;s <code>$dates</code> property will instruct Eloquent to return the columns as Carbon / DateTime instances instead of raw strings.</p>

<h4>Stripe Key</h4>

<p>Finally, set your Stripe key in your <code>services.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;stripe&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;model&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;STRIPE_API_SECRET&#39;</span><span class="p">),</span>
<span class="p">],</span>
</pre></div>

<p><a name="subscriptions"></a></p>

<h2>Subscriptions</h2>

<p><a name="creating-subscriptions"></a></p>

<h3>Creating Subscriptions</h3>

<p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of <code>App\User</code>. Once you have retrieved the model instance, you may use the <code>subscription</code> method to manage the model&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>The <code>create</code> method will automatically create the Stripe subscription, as well as update your database with Stripe customer ID and other relevant billing information. If your plan has a trial configured in Stripe, the trial end date will also automatically be set on the user record.</p>

<p>If you want to implement trial periods, but are managing the trials entirely within your application instead of defining them within Stripe, you must manually set the trial end date:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h4>Additional User Details</h4>

<p>If you would like to specify additional customer details, you may do so by passing them as the second argument to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Our First Customer&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>To learn more about the additional fields supported by Stripe, check out Stripe&#39;s <a href="https://stripe.com/docs/api#create_customer">documentation on customer creation</a>.</p>

<h4>Coupons</h4>

<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">withCoupon</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p><a name="checking-subscription-status"></a></p>

<h3>Checking Subscription Status</h3>

<p>Once a user is subscribed to your application, you may easily check their subscription status using a variety of convenient methods. First, the <code>subscribed</code> method returns <code>true</code> if the user has an active subscription, even if the subscription is currently within its trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribed</code> method also makes a great candidate for a <a href="/docs/%7B%7Bversion%7D%7D/middleware">route middleware</a>, allowing you to filter access to routes and controllers based on the user&#39;s subscription status:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// This user is not a paying customer...</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for displaying a warning to the user that they are still on their trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>onPlan</code> method may be used to determine if the user is subscribed to a given plan based on its Stripe ID:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onPlan</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Cancelled Subscription Status</h4>

<p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>everSubscribed</code> method may be used to determine if the user has ever subscribed to a plan in your application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">everSubscribed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="changing-plans"></a></p>

<h3>Changing Plans</h3>

<p>After a user is subscribed to your application, they may occasionally want to change to a new subscription plan. To swap a user to a new subscription, use the <code>swap</code> method. For example, we may easily switch a user to the <code>premium</code> subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;premium&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">();</span>
</pre></div>

<p>If the user is on trial, the trial period will be maintained. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained. When swapping plans, you may also use the <code>prorate</code> method to indicate that the charges should be pro-rated. In addition, you may use the <code>swapAndInvoice</code> method to immediately invoice the user for the plan change:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;premium&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">prorate</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">swapAndInvoice</span><span class="p">();</span>
</pre></div>

<p><a name="subscription-quantity"></a></p>

<h3>Subscription Quantity</h3>

<p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge $10 per month <strong>per user</strong> on an account. To easily increment or decrement your subscription quantity, use the <code>increment</code> and <code>decrement</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">();</span>

<span class="c1">// Add five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">();</span>

<span class="c1">// Subtract five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may set a specific quantity using the <code>updateQuantity</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>For more information on subscription quantities, consult the <a href="https://stripe.com/docs/guides/subscriptions#setting-quantities">Stripe documentation</a>.</p>

<p><a name="subscription-taxes"></a></p>

<h3>Subscription Taxes</h3>

<p>With Cashier, it&#39;s easy to provide the <code>tax_percent</code> value sent to Stripe. To specify the tax percentage a user pays on a subscription, implement the <code>getTaxPercent</code> method on your billable model, and return a numeric value between 0 and 100, with no more than 2 decimal places.</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getTaxPercent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This enables you to apply a tax rate on a model-by-model basis, which may be helpful for a user base that spans multiple countries.</p>

<p><a name="cancelling-subscriptions"></a></p>

<h3>Cancelling Subscriptions</h3>

<p>To cancel a subscription, simply call the <code>cancel</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
</pre></div>

<p>When a subscription is cancelled, Cashier will automatically set the <code>subscription_ends_at</code> column in your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p>

<p>You may determine if a user has cancelled their subscription but are still on their &quot;grace period&quot; using the <code>onGracePeriod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="resuming-subscriptions"></a></p>

<h3>Resuming Subscriptions</h3>

<p>If a user has cancelled their subscription and you wish to resume it, use the <code>resume</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">resume</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>If the user cancels a subscription and then resumes that subscription before the subscription has fully expired, they will not be billed immediately. Instead, their subscription will simply be re-activated, and they will be billed on the original billing cycle.</p>

<p><a name="handling-stripe-webhooks"></a></p>

<h2>Handling Stripe Webhooks</h2>

<p><a name="handling-failed-subscriptions"></a></p>

<h3>Failed Subscriptions</h3>

<p>What if a customer&#39;s credit card expires? No worries - Cashier includes a Webhook controller that can easily cancel the customer&#39;s subscription for you. Just point a route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;stripe/webhook&#39;</span><span class="p">,</span> <span class="s1">&#39;\Laravel\Cashier\WebhookController@handleWebhook&#39;</span><span class="p">);</span>
</pre></div>

<p>That&#39;s it! Failed payments will be captured and handled by the controller. The controller will cancel the customer&#39;s subscription when Stripe determines the subscription has failed (normally after three failed payment attempts). Don&#39;t forget: you will need to configure the webhook URI in your Stripe control panel settings.</p>

<p>Since Stripe webhooks need to bypass Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/routing#csrf-protection">CSRF verification</a>, be sure to list the URI as an exception in your <code>VerifyCsrfToken</code> middleware:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$except</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;stripe/*&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="handling-other-webhooks"></a></p>

<h3>Other Webhooks</h3>

<p>If you have additional Stripe webhook events you would like to handle, simply extend the Webhook controller. Your method names should correspond to Cashier&#39;s expected convention, specifically, methods should be prefixed with <code>handle</code> and the &quot;camel case&quot; name of the Stripe webhook you wish to handle. For example, if you wish to handle the <code>invoice.payment_succeeded</code> webhook, you should add a <code>handleInvoicePaymentSucceeded</code> method to the controller.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Cashier\WebhookController</span> <span class="k">as</span> <span class="nx">BaseController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WebhookController</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle a stripe webhook.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $payload</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleInvoicePaymentSucceeded</span><span class="p">(</span><span class="nv">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle The Event</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="single-charges"></a></p>

<h2>Single Charges</h2>

<p>If you would like to make a &quot;one off&quot; charge against a subscribed customer&#39;s credit card, you may use the <code>charge</code> method on a billable model instance. The <code>charge</code> method accepts the amount you would like to charge in the <strong>lowest denominator of the currency used by your application</strong>. So, for example, the example below will charge 100 cents, or $1.00, against the user&#39;s credit card:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>

<p>The <code>charge</code> method accepts an array as its second argument, allowing you to pass any options you wish to the underlying Stripe charge creation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;source&#39;</span> <span class="p">=&gt;</span> <span class="nx">$token</span><span class="p">,</span>
    <span class="s1">&#39;receipt_email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>The <code>charge</code> method will return <code>false</code> if the charge fails. This typically indicates the charge was denied:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The charge was denied...</span>
<span class="p">}</span>
</pre></div>

<p>If the charge is successful, the full Stripe response will be returned from the method.</p>

<p><a name="invoices"></a></p>

<h2>Invoices</h2>

<p>You may easily retrieve an array of a billable model&#39;s invoices using the <code>invoices</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoices</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoices</span><span class="p">();</span>
</pre></div>

<p>When listing the invoices for the customer, you may use the invoice&#39;s helper methods to display the relevant invoice information. For example, you may wish to list every invoice in a table, allowing the user to easily download any of them:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$invoices</span> <span class="nx">as</span> <span class="nx">$invoice</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dateString</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dollars</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/user/invoice/{{ $invoice-&gt;id }}&quot;</span><span class="o">&gt;</span><span class="nx">Download</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/td&gt;</span>
        <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>
</pre></div>

<p><a name="generating-invoice-pdfs"></a></p>

<h4>Generating Invoice PDFs</h4>

<p>From within a route or controller, use the <code>downloadInvoice</code> method to generate a PDF download of the invoice. This method will automatically generate the proper HTTP response to send the download to the browser:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/invoice/{invoice}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$invoiceId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">downloadInvoice</span><span class="p">(</span><span class="nx">$invoiceId</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;vendor&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;Your Company&#39;</span><span class="p">,</span>
        <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Product&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Blade Templates</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#template-inheritance">Template Inheritance</a>

<ul>
<li><a href="#defining-a-layout">Defining A Layout</a></li>
<li><a href="#extending-a-layout">Extending A Layout</a></li>
</ul></li>
<li><a href="#displaying-data">Displaying Data</a></li>
<li><a href="#control-structures">Control Structures</a></li>
<li><a href="#service-injection">Service Injection</a></li>
<li><a href="#extending-blade">Extending Blade</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Blade is the simple, yet powerful templating engine provided with Laravel. Unlike other popular PHP templating engines, Blade does not restrict you from using plain PHP code in your views. All Blade views are compiled into plain PHP code and cached until they are modified, meaning Blade adds essentially zero overhead to your application. Blade view files use the <code>.blade.php</code> file extension and are typically stored in the <code>resources/views</code> directory.</p>

<p><a name="template-inheritance"></a></p>

<h2>Template Inheritance</h2>

<p><a name="defining-a-layout"></a></p>

<h3>Defining A Layout</h3>

<p>Two of the primary benefits of using Blade are <em>template inheritance</em> and <em>sections</em>. To get started, let&#39;s take a look at a simple example. First, we will examine a &quot;master&quot; page layout. Since most web applications maintain the same general layout across various pages, it&#39;s convenient to define this layout as a single Blade view:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">layouts</span><span class="o">/</span><span class="nx">master</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">App</span> <span class="nx">Name</span> <span class="o">-</span> <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
            <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span>
        <span class="err">@</span><span class="nx">show</span>

        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>As you can see, this file contains typical HTML mark-up. However, take note of the <code>@section</code> and <code>@yield</code> directives. The <code>@section</code> directive, as the name implies, defines a section of content, while the <code>@yield</code> directive is used to display the contents of a given section.</p>

<p>Now that we have defined a layout for our application, let&#39;s define a child page that inherits the layout.</p>

<p><a name="extending-a-layout"></a></p>

<h3>Extending A Layout</h3>

<p>When defining a child page, you may use the Blade <code>@extends</code> directive to specify which layout the child page should &quot;inherit&quot;. Views which <code>@extends</code> a Blade layout may inject content into the layout&#39;s sections using <code>@section</code> directives. Remember, as seen in the example above, the contents of these sections will be displayed in the layout using <code>@yield</code>:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">child</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.master&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Page Title&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
    <span class="err">@@</span><span class="nx">parent</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">appended</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">my</span> <span class="nx">body</span> <span class="nx">content</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<p>In this example, the <code>sidebar</code> section is utilizing the <code>@@parent</code> directive to append (rather than overwriting) content to the layout&#39;s sidebar. The <code>@@parent</code> directive will be replaced by the content of the layout when the view is rendered.</p>

<p>Of course, just like plain PHP views, Blade views may be returned from routes using the global <code>view</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;blade&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="displaying-data"></a></p>

<h2>Displaying Data</h2>

<p>You may display data passed to your Blade views by wrapping the variable in &quot;curly&quot; braces. For example, given the following route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samantha&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>You may display the contents of the <code>name</code> variable like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">$name</span> <span class="p">}}.</span>
</pre></div>

<p>Of course, you are not limited to displaying the contents of the variables passed to the view. You may also echo the results of any PHP function. In fact, you can put any PHP code you wish inside of a Blade echo statement:</p>
<div class="highlight"><pre><span></span><span class="nx">The</span> <span class="nx">current</span> <span class="nx">UNIX</span> <span class="nx">timestamp</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">time</span><span class="p">()</span> <span class="p">}}.</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Blade <code>{{ }}</code> statements are automatically sent through PHP&#39;s <code>htmlentities</code> function to prevent XSS attacks.</p>
</blockquote>

<h4>Blade &amp; JavaScript Frameworks</h4>

<p>Since many JavaScript frameworks also use &quot;curly&quot; braces to indicate a given expression should be displayed in the browser, you may use the <code>@</code> symbol to inform the Blade rendering engine an expression should remain untouched. For example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Laravel</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

<span class="nx">Hello</span><span class="p">,</span> <span class="err">@</span><span class="p">{{</span> <span class="nx">name</span> <span class="p">}}.</span>
</pre></div>

<p>In this example, the <code>@</code> symbol will be removed by Blade; however, <code>{{ name }}</code> expression will remain untouched by the Blade engine, allowing it to instead be rendered by your JavaScript framework.</p>

<h4>Echoing Data If It Exists</h4>

<p>Sometimes you may wish to echo a variable, but you aren&#39;t sure if the variable has been set. We can express this in verbose PHP code like so:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$name</span> <span class="o">:</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}</span>
</pre></div>

<p>However, instead of writing a ternary statement, Blade provides you with the following convenient short-cut:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$name</span> <span class="nx">or</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}</span>
</pre></div>

<p>In this example, if the <code>$name</code> variable exists, its value will be displayed. However, if it does not exist, the word <code>Default</code> will be displayed.</p>

<h4>Displaying Unescaped Data</h4>

<p>By default, Blade <code>{{ }}</code> statements are automatically sent through PHP&#39;s <code>htmlentities</code> function to prevent XSS attacks. If you do not want your data to be escaped, you may use the following syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{</span><span class="o">!!</span> <span class="nx">$name</span> <span class="o">!!</span><span class="p">}.</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Be very careful when echoing content that is supplied by users of your application. Always use the double curly brace syntax to escape any HTML entities in the content.</p>
</blockquote>

<p><a name="control-structures"></a></p>

<h2>Control Structures</h2>

<p>In addition to template inheritance and displaying data, Blade also provides convenient short-cuts for common PHP control structures, such as conditional statements and loops. These short-cuts provide a very clean, terse way of working with PHP control structures, while also remaining familiar to their PHP counterparts.</p>

<h4>If Statements</h4>

<p>You may construct <code>if</code> statements using the <code>@if</code>, <code>@elseif</code>, <code>@else</code>, and <code>@endif</code> directives. These directives function identically to their PHP counterparts:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">one</span> <span class="nx">record</span><span class="o">!</span>
<span class="err">@</span><span class="nx">elseif</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">multiple</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="k">else</span>
    <span class="nx">I</span> <span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">have</span> <span class="nx">any</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<p>For convenience, Blade also provides an <code>@unless</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">unless</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
    <span class="nx">You</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">signed</span> <span class="k">in</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endunless</span>
</pre></div>

<h4>Loops</h4>

<p>In addition to conditional statements, Blade provides simple directives for working with PHP&#39;s supported loop structures. Again, each of these directives functions identically to their PHP counterparts:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">The</span> <span class="nx">current</span> <span class="nx">value</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">$i</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endfor</span>

<span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">user</span> <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>

<span class="err">@</span><span class="nx">forelse</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="err">@</span><span class="nx">empty</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">users</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforelse</span>

<span class="err">@</span><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">I</span><span class="err">&#39;</span><span class="nx">m</span> <span class="nx">looping</span> <span class="nx">forever</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endwhile</span>
</pre></div>

<h4>Including Sub-Views</h4>

<p>Blade&#39;s <code>@include</code> directive, allows you to easily include a Blade view from within an existing view. All variables that are available to the parent view will be made available to the included view:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;shared.errors&#39;</span><span class="p">)</span>

    <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
        <span class="c">&lt;!--</span> <span class="nx">Form</span> <span class="nx">Contents</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p>Even though the included view will inherit all data available in the parent view, you may also pass an array of extra data to the included view:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You should avoid using the <code>__DIR__</code> and <code>__FILE__</code> constants in your Blade views, since they will refer to the location of the cached view.</p>
</blockquote>

<h4>Rendering Views For Collections</h4>

<p>You may combine loops and includes into one line with Blade&#39;s <code>@each</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">each</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="nx">$jobs</span><span class="p">,</span> <span class="s1">&#39;job&#39;</span><span class="p">)</span>
</pre></div>

<p>The first argument is the view partial to render for each element in the array or collection. The second argument is the array or collection you wish to iterate over, while the third argument is the variable name that will be assigned to the current iteration within the view. So, for example, if you are iterating over an array of <code>jobs</code>, typically you will want to access each job as a <code>job</code> variable within your view partial.</p>

<p>You may also pass a fourth argument to the <code>@each</code> directive. This argument determines the view that will be rendered if the given array is empty.</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">each</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="nx">$jobs</span><span class="p">,</span> <span class="s1">&#39;job&#39;</span><span class="p">,</span> <span class="s1">&#39;view.empty&#39;</span><span class="p">)</span>
</pre></div>

<h4>Comments</h4>

<p>Blade also allows you to define comments in your views. However, unlike HTML comments, Blade comments are not included in the HTML returned by your application:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">--</span> <span class="nx">This</span> <span class="nx">comment</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">present</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">rendered</span> <span class="nx">HTML</span> <span class="o">--</span><span class="p">}}</span>
</pre></div>

<p><a name="service-injection"></a></p>

<h2>Service Injection</h2>

<p>The <code>@inject</code> directive may be used to retrieve a service from the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. The first argument passed to <code>@inject</code> is the name of the variable the service will be placed into, while the second argument is the class / interface name of the service you wish to resolve:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Services\MetricsService&#39;</span><span class="p">)</span>

<span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="nx">Monthly</span> <span class="nx">Revenue</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$metrics</span><span class="o">-&gt;</span><span class="nx">monthlyRevenue</span><span class="p">()</span> <span class="p">}}.</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p><a name="extending-blade"></a></p>

<h2>Extending Blade</h2>

<p>Blade even allows you to define your own custom directives. You can use the <code>directive</code> method to register a directive. When the Blade compiler encounters the directive, it calls the provided callback with its parameter.</p>

<p>The following example creates a <code>@datetime($var)</code> directive which formats a given <code>$var</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Blade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Blade</span><span class="o">::</span><span class="na">directive</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$expression</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;?php echo with</span><span class="si">{</span><span class="nv">$expression</span><span class="si">}</span><span class="s2">-&gt;format(&#39;m/d/Y H:i&#39;); ?&gt;&quot;</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, Laravel&#39;s <code>with</code> helper function was used in this directive. The <code>with</code> helper simply returns the object / value it is given, allowing for convenient method chaining. The final PHP generated by this directive will be:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">with</span><span class="p">(</span><span class="nv">$var</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;m/d/Y H:i&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Cache</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#cache-usage">Cache Usage</a>

<ul>
<li><a href="#obtaining-a-cache-instance">Obtaining A Cache Instance</a></li>
<li><a href="#retrieving-items-from-the-cache">Retrieving Items From The Cache</a></li>
<li><a href="#storing-items-in-the-cache">Storing Items In The Cache</a></li>
<li><a href="#removing-items-from-the-cache">Removing Items From The Cache</a></li>
</ul></li>
<li><a href="#adding-custom-cache-drivers">Adding Custom Cache Drivers</a></li>
<li><a href="#cache-tags">Cache Tags</a>

<ul>
<li><a href="#storing-tagged-cache-items">Storing Tagged Cache Items</a></li>
<li><a href="#accessing-tagged-cache-items">Accessing Tagged Cache Items</a></li>
</ul></li>
<li><a href="#cache-events">Cache Events</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides a unified API for various caching systems. The cache configuration is located at <code>config/cache.php</code>. In this file you may specify which cache driver you would like used by default throughout your application. Laravel supports popular caching backends like <a href="http://memcached.org">Memcached</a> and <a href="http://redis.io">Redis</a> out of the box.</p>

<p>The cache configuration file also contains various other options, which are documented within the file, so make sure to read over these options. By default, Laravel is configured to use the <code>file</code> cache driver, which stores the serialized, cached objects in the filesystem. For larger applications, it is recommended that you use an in-memory cache such as Memcached or APC. You may even configure multiple cache configurations for the same driver.</p>

<h3>Cache Prerequisites</h3>

<h4>Database</h4>

<p>When using the <code>database</code> cache driver, you will need to setup a table to contain the cache items. You&#39;ll find an example <code>Schema</code> declaration for the table below:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;expiration&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Memcached</h4>

<p>Using the Memcached cache requires the <a href="http://pecl.php.net/package/memcached">Memcached PECL package</a> to be installed.</p>

<p>The default <a href="#configuration">configuration</a> uses TCP/IP based on <a href="http://php.net/manual/en/memcached.addserver.php">Memcached::addServer</a>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">11211</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>You may also set the <code>host</code> option to a UNIX socket path. If you do this, the <code>port</code> option should be set to <code>0</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;/var/run/memcached/memcached.sock&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>Redis</h4>

<p>Before using a Redis cache with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<p>For more information on configuring Redis, consult its <a href="/docs/%7B%7Bversion%7D%7D/redis#configuration">Laravel documentation page</a>.</p>

<p><a name="cache-usage"></a></p>

<h2>Cache Usage</h2>

<p><a name="obtaining-a-cache-instance"></a></p>

<h3>Obtaining A Cache Instance</h3>

<p>The <code>Illuminate\Contracts\Cache\Factory</code> and <code>Illuminate\Contracts\Cache\Repository</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contracts</a> provide access to Laravel&#39;s cache services. The <code>Factory</code> contract provides access to all cache drivers defined for your application. The <code>Repository</code> contract is typically an implementation of the default cache driver for your application as specified by your <code>cache</code> configuration file.</p>

<p>However, you may also use the <code>Cache</code> facade, which is what we will use throughout this documentation. The <code>Cache</code> facade provides convenient, terse access to the underlying implementations of the Laravel cache contracts.</p>

<p>For example, let&#39;s import the <code>Cache</code> facade into a controller:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all users of the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Accessing Multiple Cache Stores</h4>

<p>Using the <code>Cache</code> facade, you may access various cache stores via the <code>store</code> method. The key passed to the <code>store</code> method should correspond to one of the stores listed in the <code>stores</code> configuration array in your <code>cache</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p><a name="retrieving-items-from-the-cache"></a></p>

<h3>Retrieving Items From The Cache</h3>

<p>The <code>get</code> method on the <code>Cache</code> facade is used to retrieve items from the cache. If the item does not exist in the cache, <code>null</code> will be returned. If you wish, you may pass a second argument to the <code>get</code> method specifying the custom default value you wish to be returned if the item doesn&#39;t exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p>You may even pass a <code>Closure</code> as the default value. The result of the <code>Closure</code> will be returned if the specified item does not exist in the cache. Passing a Closure allows you to defer the retrieval of default values from a database or other external service:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(...)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Checking For Item Existence</h4>

<p>The <code>has</code> method may be used to determine if an item exists in the cache:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Incrementing / Decrementing Values</h4>

<p>The <code>increment</code> and <code>decrement</code> methods may be used to adjust the value of integer items in the cache. Both of these methods optionally accept a second argument indicating the amount by which to increment or decrement the item&#39;s value:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<h4>Retrieve Or Update</h4>

<p>Sometimes you may wish to retrieve an item from the cache, but also store a default value if the requested item doesn&#39;t exist. For example, you may wish to retrieve all users from the cache or, if they don&#39;t exist, retrieve them from the database and add them to the cache. You may do this using the <code>Cache::remember</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If the item does not exist in the cache, the <code>Closure</code> passed to the <code>remember</code> method will be executed and its result will be placed in the cache.</p>

<p>You may also combine the <code>remember</code> and <code>forever</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">rememberForever</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Retrieve And Delete</h4>

<p>If you need to retrieve an item from the cache and then delete it, you may use the <code>pull</code> method. Like the <code>get</code> method, <code>null</code> will be returned if the item does not exist in the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="storing-items-in-the-cache"></a></p>

<h3>Storing Items In The Cache</h3>

<p>You may use the <code>put</code> method on the <code>Cache</code> facade to store items in the cache. When you place an item in the cache, you will need to specify the number of minutes for which the value should be cached:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>Instead of passing the number of minutes until the item expires, you may also pass a PHP <code>DateTime</code> instance representing the expiration time of the cached item:</p>
<div class="highlight"><pre><span></span><span class="nx">$expiresAt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$expiresAt</span><span class="p">);</span>
</pre></div>

<p>The <code>add</code> method will only add the item to the cache if it does not already exist in the cache store. The method will return <code>true</code> if the item is actually added to the cache. Otherwise, the method will return <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>The <code>forever</code> method may be used to store an item in the cache permanently. These values must be manually removed from the cache using the <code>forget</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="removing-items-from-the-cache"></a></p>

<h3>Removing Items From The Cache</h3>

<p>You may remove items from the cache using the <code>forget</code> method on the <code>Cache</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>You may clear the entire cache using the <code>flush</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p>Flushing the cache <strong>does not</strong> respect the cache prefix and will remove all entries from the cache. Consider this carefully when clearing a cache which is shared by other applications.</p>

<p><a name="adding-custom-cache-drivers"></a></p>

<h2>Adding Custom Cache Drivers</h2>

<p>To extend the Laravel cache with a custom driver, we will use the <code>extend</code> method on the <code>Cache</code> facade, which is used to bind a custom driver resolver to the manager. Typically, this is done within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>.</p>

<p>For example, to register a new cache driver named &quot;mongo&quot;:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Extensions\MongoStore</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>extend</code> method is the name of the driver. This will correspond to your <code>driver</code> option in the <code>config/cache.php</code> configuration file. The second argument is a Closure that should return an <code>Illuminate\Cache\Repository</code> instance. The Closure will be passed an <code>$app</code> instance, which is an instance of the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<p>The call to <code>Cache::extend</code> could be done in the <code>boot</code> method of the default <code>App\Providers\AppServiceProvider</code> that ships with fresh Laravel applications, or you may create your own service provider to house the extension - just don&#39;t forget to register the provider in the <code>config/app.php</code> provider array.</p>

<p>To create our custom cache driver, we first need to implement the <code>Illuminate\Contracts\Cache\Store</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a> contract. So, our MongoDB cache implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Extensions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MongoStore</span> <span class="k">implements</span> <span class="nx">\Illuminate\Contracts\Cache\Store</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">put</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$minutes</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">increment</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">decrement</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forever</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forget</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPrefix</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>

<p>We just need to implement each of these methods using a MongoDB connection. Once our implementation is complete, we can finish our custom driver registration:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Once your extension is complete, simply update your <code>config/cache.php</code> configuration file&#39;s <code>driver</code> option to the name of your extension.</p>

<p>If you&#39;re wondering where to put your custom cache driver code, consider making it available on Packagist! Or, you could create an <code>Extensions</code> namespace within your <code>app</code> directory. However, keep in mind that Laravel does not have a rigid application structure and you are free to organize your application according to your preferences.</p>

<p><a name="cache-tags"></a></p>

<h2>Cache Tags</h2>

<blockquote>
<p><strong>Note:</strong> Cache tags are not supported when using the <code>file</code> or <code>database</code> cache drivers. Furthermore, when using multiple tags with caches that are stored &quot;forever&quot;, performance will be best with a driver such as <code>memcached</code>, which automatically purges stale records.</p>
</blockquote>

<p><a name="storing-tagged-cache-items"></a></p>

<h3>Storing Tagged Cache Items</h3>

<p>Cache tags allow you to tag related items in the cache and then flush all cached values that assigned a given tag. You may access a tagged cache by passing in an ordered array of tag names. For example, let&#39;s access a tagged cache and <code>put</code> value in the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$john</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">,</span> <span class="nx">$anne</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>However, you are not limited to the <code>put</code> method. You may use any cache storage method while working with tags.</p>

<p><a name="accessing-tagged-cache-items"></a></p>

<h3>Accessing Tagged Cache Items</h3>

<p>To retrieve a tagged cache item, pass the same ordered list of tags to the <code>tags</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$john</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">);</span>

<span class="nx">$anne</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">);</span>
</pre></div>

<p>You may flush all items that are assigned a tag or list of tags. For example, this statement would remove all caches tagged with either <code>people</code>, <code>authors</code>, or both. So, both <code>Anne</code> and <code>John</code> would be removed from the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p>In contrast, this statement would remove only caches tagged with <code>authors</code>, so <code>Anne</code> would be removed, but not <code>John</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p><a name="cache-events"></a></p>

<h2>Cache Events</h2>

<p>To execute code on every cache operation, you may listen for the <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> fired by the cache. Typically, you should place these event listeners within the <code>boot</code> method of your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Contracts\Events\Dispatcher  $events</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">DispatcherContract</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$events</span><span class="p">);</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.hit&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.missed&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.write&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.delete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Collections</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#creating-collections">Creating Collections</a></li>
</ul></li>
<li><a href="#available-methods">Available Methods</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The <code>Illuminate\Support\Collection</code> class provides a fluent, convenient wrapper for working with arrays of data. For example, check out the following code. We&#39;ll use the <code>collect</code> helper to create a new collection instance from the array, run the <code>strtoupper</code> function on each element, and then remove all empty elements:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;abigail&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">empty</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the <code>Collection</code> class allows you to chain its methods to perform fluent mapping and reducing of the underlying array. In general, collections are immutable, meaning every <code>Collection</code> method returns an entirely new <code>Collection</code> instance.</p>

<p><a name="creating-collections"></a></p>

<h3>Creating Collections</h3>

<p>As mentioned above, the <code>collect</code> helper returns a new <code>Illuminate\Support\Collection</code> instance for the given array. So, creating a collection is as simple as:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>The results of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> queries are always returned as <code>Collection</code> instances.</p>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<p>For the remainder of this documentation, we&#39;ll discuss each method available on the <code>Collection</code> class. Remember, all of these methods may be chained to fluently manipulating the underlying array. Furthermore, almost every method returns a new <code>Collection</code> instance, allowing you to preserve the original copy of the collection when necessary:</p>

<style>
    #collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    #collection-method-list a {
        display: block;
    }
</style>

<div id="collection-method-list" markdown="1">

[all](#method-all)
[average](#method-average)
[avg](#method-avg)
[chunk](#method-chunk)
[collapse](#method-collapse)
[contains](#method-contains)
[count](#method-count)
[diff](#method-diff)
[each](#method-each)
[every](#method-every)
[except](#method-except)
[filter](#method-filter)
[first](#method-first)
[flatMap](#method-flatmap)
[flatten](#method-flatten)
[flip](#method-flip)
[forget](#method-forget)
[forPage](#method-forpage)
[get](#method-get)
[groupBy](#method-groupby)
[has](#method-has)
[implode](#method-implode)
[intersect](#method-intersect)
[isEmpty](#method-isempty)
[keyBy](#method-keyby)
[keys](#method-keys)
[last](#method-last)
[map](#method-map)
[max](#method-max)
[merge](#method-merge)
[min](#method-min)
[only](#method-only)
[pluck](#method-pluck)
[pop](#method-pop)
[prepend](#method-prepend)
[pull](#method-pull)
[push](#method-push)
[put](#method-put)
[random](#method-random)
[reduce](#method-reduce)
[reject](#method-reject)
[reverse](#method-reverse)
[search](#method-search)
[shift](#method-shift)
[shuffle](#method-shuffle)
[slice](#method-slice)
[sort](#method-sort)
[sortBy](#method-sortby)
[sortByDesc](#method-sortbydesc)
[splice](#method-splice)
[sum](#method-sum)
[take](#method-take)
[toArray](#method-toarray)
[toJson](#method-tojson)
[transform](#method-transform)
[unique](#method-unique)
[values](#method-values)
[where](#method-where)
[whereLoose](#method-whereloose)
[zip](#method-zip)

</div>

<p><a name="method-listing"></a></p>

<h2>Method Listing</h2>

<style>
    #collection-method code {
        font-size: 14px;
    }

    #collection-method:not(.first-collection-method) {
        margin-top: 50px;
    }
</style>

<p><a name="method-all"></a></p>

<h4><code>all()</code> {#collection-method .first-collection-method}</h4>

<p>The <code>all</code> method returns the underlying array represented by the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<p><a name="method-average"></a></p>

<h4><code>average()</code> {#collection-method}</h4>

<p>Alias for the <a href="#method-avg"><code>avg</code></a> method.</p>

<p><a name="method-avg"></a></p>

<h4><code>avg()</code> {#collection-method}</h4>

<p>The <code>avg</code> method returns the <a href="https://en.wikipedia.org/wiki/Average">average value</a> of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$average</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">40</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 20</span>

<span class="nx">$average</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">();</span>

<span class="c1">// 2</span>
</pre></div>

<p><a name="method-chunk"></a></p>

<h4><code>chunk()</code> {#collection-method}</h4>

<p>The <code>chunk</code> method breaks the collection into multiple, smaller collections of a given size:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]);</span>

<span class="nx">$chunks</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">$chunks</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="c1">// [[1, 2, 3, 4], [5, 6, 7]]</span>
</pre></div>

<p>This method is especially useful in <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> when working with a grid system such as <a href="https://getbootstrap.com/css/#grid">Bootstrap</a>. Imagine you have a collection of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models you want to display in a grid:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$products</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$chunk</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$chunk</span> <span class="nx">as</span> <span class="nx">$product</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-xs-4&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$product</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="err">@</span><span class="nx">endforeach</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p><a name="method-collapse"></a></p>

<h4><code>collapse()</code> {#collection-method}</h4>

<p>The <code>collapse</code> method collapses a collection of arrays into a single, flat collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]);</span>

<span class="nx">$collapsed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">collapse</span><span class="p">();</span>

<span class="nx">$collapsed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</pre></div>

<p><a name="method-contains"></a></p>

<h4><code>contains()</code> {#collection-method}</h4>

<p>The <code>contains</code> method determines whether the collection contains a given item:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Desk&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>You may also pass a key / value pair to the <code>contains</code> method, which will determine if the given pair exists in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>Finally, you may also pass a callback to the <code>contains</code> method to perform your own truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// false</span>
</pre></div>

<p>The <code>contains</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value.</p>

<p><a name="method-count"></a></p>

<h4><code>count()</code> {#collection-method}</h4>

<p>The <code>count</code> method returns the total number of items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="c1">// 4</span>
</pre></div>

<p><a name="method-diff"></a></p>

<h4><code>diff()</code> {#collection-method}</h4>

<p>The <code>diff</code> method compares the collection against another collection or a plain PHP <code>array</code> based on its values. This method will return the values in the original collection that are not present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$diff</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">diff</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]);</span>

<span class="nx">$diff</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 3, 5]</span>
</pre></div>

<p><a name="method-each"></a></p>

<h4><code>each()</code> {#collection-method}</h4>

<p>The <code>each</code> method iterates over the items in the collection and passes each item to a callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If you would like to stop iterating through the items, you may return <code>false</code> from your callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="cm">/* some condition */</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-every"></a></p>

<h4><code>every()</code> {#collection-method}</h4>

<p>The <code>every</code> method creates a new collection consisting of every n-th element:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// [&#39;a&#39;, &#39;e&#39;]</span>
</pre></div>

<p>You may optionally pass an offset as the second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// [&#39;b&#39;, &#39;f&#39;]</span>
</pre></div>

<p><a name="method-except"></a></p>

<h4><code>except()</code> {#collection-method}</h4>

<p>The <code>except</code> method returns all items in the collection except for those with the specified keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1]</span>
</pre></div>

<p>For the inverse of <code>except</code>, see the <a href="#method-only">only</a> method.</p>

<p><a name="method-filter"></a></p>

<h4><code>filter()</code> {#collection-method}</h4>

<p>The <code>filter</code> method filters the collection using the given callback, keeping only those items that pass a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4]</span>
</pre></div>

<p>If no callback is supplied, all entries of the collection that are equivalent to <code>false</code> will be removed:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<p>For the inverse of <code>filter</code>, see the <a href="#method-reject">reject</a> method.</p>

<p><a name="method-first"></a></p>

<h4><code>first()</code> {#collection-method}</h4>

<p>The <code>first</code> method returns the first element in the collection that passes a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 3</span>
</pre></div>

<p>You may also call the <code>first</code> method with no arguments to get the first element in the collection. If the collection is empty, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="c1">// 1</span>
</pre></div>

<p><a name="method-flatmap"></a></p>

<h4><code>flatMap()</code> {#collection-method}</h4>

<p>The <code>flatMap</code> method iterates through the collection and passes each value to the given callback. The callback is free to modify the item and return it, thus forming a new collection of modified items. Then, the array is flattened by a level:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;school&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Arkansas&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">28</span><span class="p">]</span>
<span class="p">]);</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flatMap</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$values</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">array_map</span><span class="p">(</span><span class="s1">&#39;strtoupper&#39;</span><span class="p">,</span> <span class="nx">$values</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$flattened</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;SALLY&#39;, &#39;school&#39; =&gt; &#39;ARKANSAS&#39;, &#39;age&#39; =&gt; &#39;28&#39;];</span>
</pre></div>

<p><a name="method-flatten"></a></p>

<h4><code>flatten()</code> {#collection-method}</h4>

<p>The <code>flatten</code> method flattens a multi-dimensional collection into a single dimension:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">]]);</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flatten</span><span class="p">();</span>

<span class="nx">$flattened</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;taylor&#39;, &#39;php&#39;, &#39;javascript&#39;];</span>
</pre></div>

<p><a name="method-flip"></a></p>

<h4><code>flip()</code> {#collection-method}</h4>

<p>The <code>flip</code> method swaps the collection&#39;s keys with their corresponding values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$flipped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flip</span><span class="p">();</span>

<span class="nx">$flipped</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;taylor&#39; =&gt; &#39;name&#39;, &#39;laravel&#39; =&gt; &#39;framework&#39;]</span>
</pre></div>

<p><a name="method-forget"></a></p>

<h4><code>forget()</code> {#collection-method}</h4>

<p>The <code>forget</code> method removes an item from the collection by its key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;framework&#39; =&gt; &#39;laravel&#39;]</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Unlike most other collection methods, <code>forget</code> does not return a new modified collection; it modifies the collection it is called on.</p>
</blockquote>

<p><a name="method-forpage"></a></p>

<h4><code>forPage()</code> {#collection-method}</h4>

<p>The <code>forPage</code> method returns a new collection containing the items that would be present on a given page number. The method accepts the page number as its first argument and the number of items to show per page as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">forPage</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [4, 5, 6]</span>
</pre></div>

<p><a name="method-get"></a></p>

<h4><code>get()</code> {#collection-method}</h4>

<p>The <code>get</code> method returns the item at a given key. If the key does not exist, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// taylor</span>
</pre></div>

<p>You may optionally pass a default value as the second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;default-value&#39;</span><span class="p">);</span>

<span class="c1">// default-value</span>
</pre></div>

<p>You may even pass a callback as the default value. The result of the callback will be returned if the specified key does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;default-value&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// default-value</span>
</pre></div>

<p><a name="method-groupby"></a></p>

<h4><code>groupBy()</code> {#collection-method}</h4>

<p>The <code>groupBy</code> method groups the collection&#39;s items by a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x10&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x10&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x11&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$grouped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">);</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;account-x10&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Bookcase&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;account-x11&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x11&#39;, &#39;product&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>In addition to passing a string <code>key</code>, you may also pass a callback. The callback should return the value you wish to key the group by:</p>
<div class="highlight"><pre><span></span><span class="nx">$grouped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">substr</span><span class="p">(</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;account_id&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">3</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;x10&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Bookcase&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;x11&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x11&#39;, &#39;product&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-has"></a></p>

<h4><code>has()</code> {#collection-method}</h4>

<p>The <code>has</code> method determines if a given key exists in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-implode"></a></p>

<h4><code>implode()</code> {#collection-method}</h4>

<p>The <code>implode</code> method joins the items in a collection. Its arguments depend on the type of items in the collection. If the collection contains arrays or objects, you should pass the key of the attributes you wish to join, and the &quot;glue&quot; string you wish to place between the values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">);</span>

<span class="c1">// Desk, Chair</span>
</pre></div>

<p>If the collection contains simple strings or numeric values, simply pass the &quot;glue&quot; as the only argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// &#39;1-2-3-4-5&#39;</span>
</pre></div>

<p><a name="method-intersect"></a></p>

<h4><code>intersect()</code> {#collection-method}</h4>

<p>The <code>intersect</code> method removes any values from the original collection that are not present in the given <code>array</code> or collection. The resulting collection will preserve the original collection&#39;s keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Sofa&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">]);</span>

<span class="nx">$intersect</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">intersect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">]);</span>

<span class="nx">$intersect</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0 =&gt; &#39;Desk&#39;, 2 =&gt; &#39;Chair&#39;]</span>
</pre></div>

<p><a name="method-isempty"></a></p>

<h4><code>isEmpty()</code> {#collection-method}</h4>

<p>The <code>isEmpty</code> method returns <code>true</code> if the collection is empty; otherwise, <code>false</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([])</span><span class="o">-&gt;</span><span class="nx">isEmpty</span><span class="p">();</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-keyby"></a></p>

<h4><code>keyBy()</code> {#collection-method}</h4>

<p>The <code>keyBy</code> method keys the collection by the given key. If multiple items have the same key, only the last one will appear in the new collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$keyed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keyBy</span><span class="p">(</span><span class="s1">&#39;product_id&#39;</span><span class="p">);</span>

<span class="nx">$keyed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;prod-100&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-100&#39;, &#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        &#39;prod-200&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-200&#39;, &#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You may also pass a callback to the method. The callback should return the value to key the collection by:</p>
<div class="highlight"><pre><span></span><span class="nx">$keyed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keyBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">$keyed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;PROD-100&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-100&#39;, &#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        &#39;PROD-200&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-200&#39;, &#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-keys"></a></p>

<h4><code>keys()</code> {#collection-method}</h4>

<p>The <code>keys</code> method returns all of the collection&#39;s keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;prod-100&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="s1">&#39;prod-200&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$keys</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keys</span><span class="p">();</span>

<span class="nx">$keys</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;prod-100&#39;, &#39;prod-200&#39;]</span>
</pre></div>

<p><a name="method-last"></a></p>

<h4><code>last()</code> {#collection-method}</h4>

<p>The <code>last</code> method returns the last element in the collection that passes a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 2</span>
</pre></div>

<p>You may also call the <code>last</code> method with no arguments to get the last element in the collection. If the collection is empty, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">();</span>

<span class="c1">// 4</span>
</pre></div>

<p><a name="method-map"></a></p>

<h4><code>map()</code> {#collection-method}</h4>

<p>The <code>map</code> method iterates through the collection and passes each value to the given callback. The callback is free to modify the item and return it, thus forming a new collection of modified items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$multiplied</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$multiplied</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 6, 8, 10]</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Like most other collection methods, <code>map</code> returns a new collection instance; it does not modify the collection it is called on. If you want to transform the original collection, use the <a href="#method-transform"><code>transform</code></a> method.</p>
</blockquote>

<p><a name="method-max"></a></p>

<h4><code>max()</code> {#collection-method}</h4>

<p>The <code>max</code> method returns the maximum value of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$max</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 20</span>

<span class="nx">$max</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">();</span>

<span class="c1">// 5</span>
</pre></div>

<p><a name="method-merge"></a></p>

<h4><code>merge()</code> {#collection-method}</h4>

<p>The <code>merge</code> method merges the given array or collection with the original collection. If a string key in the given items matches a string key in the original collection, the given items&#39;s value will overwrite the value in the original collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]);</span>

<span class="nx">$merged</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$merged</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;price&#39; =&gt; 200, &#39;discount&#39; =&gt; false]</span>
</pre></div>

<p>If the given items&#39;s keys are numeric, the values will be appended to the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">]);</span>

<span class="nx">$merged</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;Door&#39;</span><span class="p">]);</span>

<span class="nx">$merged</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Desk&#39;, &#39;Chair&#39;, &#39;Bookcase&#39;, &#39;Door&#39;]</span>
</pre></div>

<p><a name="method-min"></a></p>

<h4><code>min()</code> {#collection-method}</h4>

<p>The <code>min</code> method returns the minimum value of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$min</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 10</span>

<span class="nx">$min</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">();</span>

<span class="c1">// 1</span>
</pre></div>

<p><a name="method-only"></a></p>

<h4><code>only()</code> {#collection-method}</h4>

<p>The <code>only</code> method returns the items in the collection with the specified keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;name&#39; =&gt; &#39;Desk&#39;]</span>
</pre></div>

<p>For the inverse of <code>only</code>, see the <a href="#method-except">except</a> method.</p>

<p><a name="method-pluck"></a></p>

<h4><code>pluck()</code> {#collection-method}</h4>

<p>The <code>pluck</code> method retrieves all of the values for a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Desk&#39;, &#39;Chair&#39;]</span>
</pre></div>

<p>You may also specify how you wish the resulting collection to be keyed:</p>
<div class="highlight"><pre><span></span><span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;prod-100&#39; =&gt; &#39;Desk&#39;, &#39;prod-200&#39; =&gt; &#39;Chair&#39;]</span>
</pre></div>

<p><a name="method-pop"></a></p>

<h4><code>pop()</code> {#collection-method}</h4>

<p>The <code>pop</code> method removes and returns the last item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pop</span><span class="p">();</span>

<span class="c1">// 5</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4]</span>
</pre></div>

<p><a name="method-prepend"></a></p>

<h4><code>prepend()</code> {#collection-method}</h4>

<p>The <code>prepend</code> method adds an item to the beginning of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0, 1, 2, 3, 4, 5]</span>
</pre></div>

<p>You may also pass a second argument to set the key of the prepended item:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;one&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;zero&#39; =&gt; 0, &#39;one&#39; =&gt; 1, &#39;two&#39; =&gt; 2]</span>
</pre></div>

<p><a name="method-pull"></a></p>

<h4><code>pull()</code> {#collection-method}</h4>

<p>The <code>pull</code> method removes and returns an item from the collection by its key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Desk&#39;</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; &#39;prod-100&#39;]</span>
</pre></div>

<p><a name="method-push"></a></p>

<h4><code>push()</code> {#collection-method}</h4>

<p>The <code>push</code> method appends an item to the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5]</span>
</pre></div>

<p><a name="method-put"></a></p>

<h4><code>put()</code> {#collection-method}</h4>

<p>The <code>put</code> method sets the given key and value in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-random"></a></p>

<h4><code>random()</code> {#collection-method}</h4>

<p>The <code>random</code> method returns a random item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">random</span><span class="p">();</span>

<span class="c1">// 4 - (retrieved randomly)</span>
</pre></div>

<p>You may optionally pass an integer to <code>random</code> to specify how many items you would like to randomly retrieve. If that integer is more than <code>1</code>, a collection of items is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$random</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">random</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$random</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 5] - (retrieved randomly)</span>
</pre></div>

<p><a name="method-reduce"></a></p>

<h4><code>reduce()</code> {#collection-method}</h4>

<p>The <code>reduce</code> method reduces the collection to a single value, passing the result of each iteration into the subsequent iteration:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$total</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$carry</span><span class="p">,</span> <span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$carry</span> <span class="o">+</span> <span class="nx">$item</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 6</span>
</pre></div>

<p>The value for <code>$carry</code> on the first iteration is <code>null</code>; however, you may specify its initial value by passing a second argument to <code>reduce</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$carry</span><span class="p">,</span> <span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$carry</span> <span class="o">+</span> <span class="nx">$item</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">4</span><span class="p">);</span>

<span class="c1">// 10</span>
</pre></div>

<p><a name="method-reject"></a></p>

<h4><code>reject()</code> {#collection-method}</h4>

<p>The <code>reject</code> method filters the collection using the given callback. The callback should return <code>true</code> if the item should be removed from the resulting collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<p>For the inverse of the <code>reject</code> method, see the <a href="#method-filter"><code>filter</code></a> method.</p>

<p><a name="method-reverse"></a></p>

<h4><code>reverse()</code> {#collection-method}</h4>

<p>The <code>reverse</code> method reverses the order of the collection&#39;s items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$reversed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reverse</span><span class="p">();</span>

<span class="nx">$reversed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 4, 3, 2, 1]</span>
</pre></div>

<p><a name="method-search"></a></p>

<h4><code>search()</code> {#collection-method}</h4>

<p>The <code>search</code> method searches the collection for the given value and returns its key if found. If the item is not found, <code>false</code> is returned.</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// 1</span>
</pre></div>

<p>The search is done using a &quot;loose&quot; comparison, meaning a string with an integer value will be considered equal to an integer of the same value. To use &quot;strict&quot; comparison, pass <code>true</code> as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>Alternatively, you may pass in your own callback to search for the first item that passes your truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 2</span>
</pre></div>

<p><a name="method-shift"></a></p>

<h4><code>shift()</code> {#collection-method}</h4>

<p>The <code>shift</code> method removes and returns the first item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">shift</span><span class="p">();</span>

<span class="c1">// 1</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 3, 4, 5]</span>
</pre></div>

<p><a name="method-shuffle"></a></p>

<h4><code>shuffle()</code> {#collection-method}</h4>

<p>The <code>shuffle</code> method randomly shuffles the items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$shuffled</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">shuffle</span><span class="p">();</span>

<span class="nx">$shuffled</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 2, 5, 1, 4] - (generated randomly)</span>
</pre></div>

<p><a name="method-slice"></a></p>

<h4><code>slice()</code> {#collection-method}</h4>

<p>The <code>slice</code> method returns a slice of the collection starting at the given index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">$slice</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 6, 7, 8, 9, 10]</span>
</pre></div>

<p>If you would like to limit the size of the returned slice, pass the desired size as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$slice</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">$slice</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 6]</span>
</pre></div>

<p>The returned slice will have new, numerically indexed keys. If you wish to preserve the original keys, pass <code>true</code> as the third argument to the method.</p>

<p><a name="method-sort"></a></p>

<h4><code>sort()</code> {#collection-method}</h4>

<p>The <code>sort</code> method sorts the collection. The sorted collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sort</span><span class="p">();</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5]</span>
</pre></div>

<p>If your sorting needs are more advanced, you may pass a callback to <code>sort</code> with your own algorithm. Refer to the PHP documentation on <a href="https://secure.php.net/manual/en/function.usort.php#refsect1-function.usort-parameters"><code>usort</code></a>, which is what the collection&#39;s <code>sort</code> method calls under the hood.</p>

<p>If you need to sort a collection of nested arrays or objects, see the <a href="#method-sortby"><code>sortBy</code></a> and <a href="#method-sortbydesc"><code>sortByDesc</code></a> methods.</p>

<p><a name="method-sortby"></a></p>

<h4><code>sortBy()</code> {#collection-method}</h4>

<p>The <code>sortBy</code> method sorts the collection by the given key. The sorted collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Bookcase&#39;, &#39;price&#39; =&gt; 150],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You can also pass your own callback to determine how to sort the collection values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">,</span> <span class="s1">&#39;Mahogany&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Beige&#39;</span><span class="p">,</span> <span class="s1">&#39;Brown&#39;</span><span class="p">]],</span>
<span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$product</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">(</span><span class="nx">$product</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;, &#39;colors&#39; =&gt; [&#39;Black&#39;]],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;colors&#39; =&gt; [&#39;Black&#39;, &#39;Mahogany&#39;]],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Bookcase&#39;, &#39;colors&#39; =&gt; [&#39;Red&#39;, &#39;Beige&#39;, &#39;Brown&#39;]],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-sortbydesc"></a></p>

<h4><code>sortByDesc()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-sortby"><code>sortBy</code></a> method, but will sort the collection in the opposite order.</p>

<p><a name="method-splice"></a></p>

<h4><code>splice()</code> {#collection-method}</h4>

<p>The <code>splice</code> method removes and returns a slice of items starting at the specified index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4, 5]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<p>You may pass a second argument to limit the size of the resulting chunk:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 4, 5]</span>
</pre></div>

<p>In addition, you can pass a third argument containing the new items to replace the items removed from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 10, 11, 4, 5]</span>
</pre></div>

<p><a name="method-sum"></a></p>

<h4><code>sum()</code> {#collection-method}</h4>

<p>The <code>sum</code> method returns the sum of all items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">();</span>

<span class="c1">// 15</span>
</pre></div>

<p>If the collection contains nested arrays or objects, you should pass a key to use for determining which values to sum:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;JavaScript: The Good Parts&#39;</span><span class="p">,</span> <span class="s1">&#39;pages&#39;</span> <span class="p">=&gt;</span> <span class="mi">176</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;JavaScript: The Definitive Guide&#39;</span><span class="p">,</span> <span class="s1">&#39;pages&#39;</span> <span class="p">=&gt;</span> <span class="mi">1096</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">);</span>

<span class="c1">// 1272</span>
</pre></div>

<p>In addition, you may pass your own callback to determine which values of the collection to sum:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">,</span> <span class="s1">&#39;Mahogany&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Beige&#39;</span><span class="p">,</span> <span class="s1">&#39;Brown&#39;</span><span class="p">]],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$product</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">(</span><span class="nx">$product</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="c1">// 6</span>
</pre></div>

<p><a name="method-take"></a></p>

<h4><code>take()</code> {#collection-method}</h4>

<p>The <code>take</code> method returns a new collection with the specified number of items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0, 1, 2]</span>
</pre></div>

<p>You may also pass a negative integer to take the specified amount of items from the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [4, 5]</span>
</pre></div>

<p><a name="method-toarray"></a></p>

<h4><code>toArray()</code> {#collection-method}</h4>

<p>The <code>toArray</code> method converts the collection into a plain PHP <code>array</code>. If the collection&#39;s values are <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models, the models will also be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> <code>toArray</code> also converts all of the collection&#39;s nested objects to an array. If you want to get the raw underlying array, use the <a href="#method-all"><code>all</code></a> method instead.</p>
</blockquote>

<p><a name="method-tojson"></a></p>

<h4><code>toJson()</code> {#collection-method}</h4>

<p>The <code>toJson</code> method converts the collection into a JSON serialized string:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>

<span class="c1">// &#39;{&quot;name&quot;:&quot;Desk&quot;, &quot;price&quot;:200}&#39;</span>
</pre></div>

<p><a name="method-transform"></a></p>

<h4><code>transform()</code> {#collection-method}</h4>

<p>The <code>transform</code> method iterates over the collection and calls the given callback with each item in the collection. The items in the collection will be replaced by the values returned by the callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">transform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 6, 8, 10]</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Unlike most other collection methods, <code>transform</code> modifies the collection itself. If you wish to create a new collection instead, use the <a href="#method-map"><code>map</code></a> method.</p>
</blockquote>

<p><a name="method-unique"></a></p>

<h4><code>unique()</code> {#collection-method}</h4>

<p>The <code>unique</code> method returns all of the unique items in the collection. The returned collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4]</span>
</pre></div>

<p>When dealing with nested arrays or objects, you may specify the key used to determine uniqueness:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;iPhone 6&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;iPhone 5&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple Watch&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;watch&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Galaxy S6&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samsung&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Galaxy Gear&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samsung&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;watch&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;brand&#39;</span><span class="p">);</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;iPhone 6&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy S6&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You may also pass your own callback to determine item uniqueness:</p>
<div class="highlight"><pre><span></span><span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">].</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
<span class="p">});</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;iPhone 6&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Apple Watch&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;watch&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy S6&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy Gear&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;watch&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>unique</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value.</p>

<p><a name="method-values"></a></p>

<h4><code>values()</code> {#collection-method}</h4>

<p>The <code>values</code> method returns a new collection with the keys reset to consecutive integers:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="mi">10</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="mi">11</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">]</span>
<span class="p">]);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">();</span>

<span class="nx">$values</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        0 =&gt; [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        1 =&gt; [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-where"></a></p>

<h4><code>where()</code> {#collection-method}</h4>

<p>The <code>where</code> method filters the collection by a given key / value pair:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Door&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>where</code> method uses &quot;strict&quot; comparisons when checking item values, meaning a string with an integer value will not be considered equal to an integer of the same value. Use the <a href="#method-whereloose"><code>whereLoose</code></a> method to filter using &quot;loose&quot; comparisons.</p>

<p><a name="method-whereloose"></a></p>

<h4><code>whereLoose()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-where"><code>where</code></a> method; however, all values are compared using &quot;loose&quot; comparisons.</p>

<p><a name="method-zip"></a></p>

<h4><code>zip()</code> {#collection-method}</h4>

<p>The <code>zip</code> method merges together the values of the given array with the values of the original collection at the corresponding index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$zipped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">zip</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$zipped</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [[&#39;Chair&#39;, 100], [&#39;Desk&#39;, 200]]</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Service Container</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#binding">Binding</a>

<ul>
<li><a href="#binding-interfaces-to-implementations">Binding Interfaces To Implementations</a></li>
<li><a href="#contextual-binding">Contextual Binding</a></li>
<li><a href="#tagging">Tagging</a></li>
</ul></li>
<li><a href="#resolving">Resolving</a></li>
<li><a href="#container-events">Container Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel service container is a powerful tool for managing class dependencies and performing dependency injection. Dependency injection is a fancy phrase that essentially means this: class dependencies are &quot;injected&quot; into the class via the constructor or, in some cases, &quot;setter&quot; methods.</p>

<p>Let&#39;s look at a simple example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Mail\Mailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Bus\SelfHandling</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PurchasePodcast</span> <span class="k">implements</span> <span class="nx">SelfHandling</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The mailer implementation.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Mailer  $mailer</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Purchase a podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, the <code>PurchasePodcast</code> job needs to send e-mails when a podcast is purchased. So, we will <strong>inject</strong> a service that is able to send e-mails. Since the service is injected, we are able to easily swap it out with another implementation. We are also able to easily &quot;mock&quot;, or create a dummy implementation of the mailer when testing our application.</p>

<p>A deep understanding of the Laravel service container is essential to building a powerful, large application, as well as for contributing to the Laravel core itself.</p>

<p><a name="binding"></a></p>

<h2>Binding</h2>

<p>Almost all of your service container bindings will be registered within <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a>, so all of these examples will demonstrate using the container in that context. However, there is no need to bind classes into the container if they do not depend on any interfaces. The container does not need to be instructed on how to build these objects, since it can automatically resolve such &quot;concrete&quot; objects using PHP&#39;s reflection services.</p>

<p>Within a service provider, you always have access to the container via the <code>$this-&gt;app</code> instance variable. We can register a binding using the <code>bind</code> method, passing the class or interface name that we wish to register along with a <code>Closure</code> that returns an instance of the class:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">HelpSpot</span><span class="err">\</span><span class="nx">API</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;HttpClient&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Notice that we receive the container itself as an argument to the resolver. We can then use the container to resolve sub-dependencies of the object we are building.</p>

<h4>Binding A Singleton</h4>

<p>The <code>singleton</code> method binds a class or interface into the container that should only be resolved one time, and then that same instance will be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">singleton</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;SomethingElse&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Binding Instances</h4>

<p>You may also bind an existing object instance into the container using the <code>instance</code> method. The given instance will always be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">(</span><span class="k">new</span> <span class="nx">SomethingElse</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">instance</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="nx">$fooBar</span><span class="p">);</span>
</pre></div>

<p><a name="binding-interfaces-to-implementations"></a></p>

<h3>Binding Interfaces To Implementations</h3>

<p>A very powerful feature of the service container is its ability to bind an interface to a given implementation. For example, let&#39;s assume we have an <code>EventPusher</code> interface and a <code>RedisEventPusher</code> implementation. Once we have coded our <code>RedisEventPusher</code> implementation of this interface, we can register it with the service container like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Services\RedisEventPusher&#39;</span><span class="p">);</span>
</pre></div>

<p>This tells the container that it should inject the <code>RedisEventPusher</code> when a class needs an implementation of <code>EventPusher</code>. Now we can type-hint the <code>EventPusher</code> interface in a constructor, or any other location where dependencies are injected by the service container:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">EventPusher</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Create a new class instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  EventPusher  $pusher</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">EventPusher</span> <span class="nx">$pusher</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">pusher</span> <span class="o">=</span> <span class="nx">$pusher</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="contextual-binding"></a></p>

<h3>Contextual Binding</h3>

<p>Sometimes you may have two classes that utilize the same interface, but you wish to inject different implementations into each class. For example, when our system receives a new Order, we may want to send an event via <a href="http://www.pubnub.com/">PubNub</a> rather than Pusher. Laravel provides a simple, fluent interface for defining this behavior:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;App\Handlers\Commands\CreateOrderHandler&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="s1">&#39;App\Services\PubNubEventPusher&#39;</span><span class="p">);</span>
</pre></div>

<p>You may even pass a Closure to the <code>give</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;App\Handlers\Commands\CreateOrderHandler&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                  <span class="c1">// Resolve dependency...</span>
              <span class="p">});</span>
</pre></div>

<p><a name="tagging"></a></p>

<h3>Tagging</h3>

<p>Occasionally, you may need to resolve all of a certain &quot;category&quot; of binding. For example, perhaps you are building a report aggregator that receives an array of many different <code>Report</code> interface implementations. After registering the <code>Report</code> implementations, you can assign them a tag using the <code>tag</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;MemoryReport&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">tag</span><span class="p">([</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="s1">&#39;MemoryReport&#39;</span><span class="p">],</span> <span class="s1">&#39;reports&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the services have been tagged, you may easily resolve them all via the <code>tagged</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ReportAggregator&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">ReportAggregator</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">tagged</span><span class="p">(</span><span class="s1">&#39;reports&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p><a name="resolving"></a></p>

<h2>Resolving</h2>

<p>There are several ways to resolve something out of the container. First, you may use the <code>make</code> method, which accepts the name of the class or interface you wish to resolve:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">);</span>
</pre></div>

<p>Secondly, you may access the container like an array, since it implements PHP&#39;s <code>ArrayAccess</code> interface:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="p">[</span><span class="s1">&#39;FooBar&#39;</span><span class="p">];</span>
</pre></div>

<p>Lastly, but most importantly, you may simply &quot;type-hint&quot; the dependency in the constructor of a class that is resolved by the container, including <a href="/docs/%7B%7Bversion%7D%7D/controllers">controllers</a>, <a href="/docs/%7B%7Bversion%7D%7D/events">event listeners</a>, <a href="/docs/%7B%7Bversion%7D%7D/queues">queue jobs</a>, <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a>, and more. In practice, this is how most of your objects are resolved by the container.</p>

<p>The container will automatically inject dependencies for the classes it resolves. For example, you may type-hint a repository defined by your application in a controller&#39;s constructor. The repository will automatically be resolved and injected into the class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Users\Repository</span> <span class="k">as</span> <span class="nx">UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the user with the given ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="container-events"></a></p>

<h2>Container Events</h2>

<p>The service container fires an event each time it resolves an object. You may listen to this event using the <code>resolving</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$object</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Called when container resolves object of any type...</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="nx">FooBar</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">FooBar</span> <span class="nx">$fooBar</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Called when container resolves objects of type &quot;FooBar&quot;...</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the object being resolved will be passed to the callback, allowing you to set any additional properties on the object before it is given to its consumer.</p>
<div style="page-break-after: always;" ></div><h1>Contracts</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#why-contracts">Why Contracts?</a></li>
<li><a href="#contract-reference">Contract Reference</a></li>
<li><a href="#how-to-use-contracts">How To Use Contracts</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s Contracts are a set of interfaces that define the core services provided by the framework. For example, a <code>Illuminate\Contracts\Queue\Queue</code> contract defines the methods needed for queueing jobs, while the <code>Illuminate\Contracts\Mail\Mailer</code> contract defines the methods needed for sending e-mail.</p>

<p>Each contract has a corresponding implementation provided by the framework. For example, Laravel provides a queue implementation with a variety of drivers, and a mailer implementation that is powered by <a href="http://swiftmailer.org/">SwiftMailer</a>.</p>

<p>All of the Laravel contracts live in <a href="https://github.com/illuminate/contracts">their own GitHub repository</a>. This provides a quick reference point for all available contracts, as well as a single, decoupled package that may be utilized by package developers.</p>

<h3>Contracts Vs. Facades</h3>

<p>Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/facades">facades</a> provide a simple way of utilizing Laravel&#39;s services without needing to type-hint and resolve contracts out of the service container. However, using contracts allows you to define explicit dependencies for your classes. For most applications, using a facade is just fine. However, if you really need the extra loose coupling that contracts can provide, keep reading!</p>

<p><a name="why-contracts"></a></p>

<h2>Why Contracts?</h2>

<p>You may have several questions regarding contracts. Why use interfaces at all? Isn&#39;t using interfaces more complicated? Let&#39;s distil the reasons for using interfaces to the following headings: loose coupling and simplicity.</p>

<h3>Loose Coupling</h3>

<p>First, let&#39;s review some code that is tightly coupled to a cache implementation. Consider the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The cache instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$cache</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \SomePackage\Cache\Memcached  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">\SomePackage\Cache\Memcached</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Retrieve an Order by ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Order</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nv">$id</span><span class="p">))</span>    <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this class, the code is tightly coupled to a given cache implementation. It is tightly coupled because we are depending on a concrete Cache class from a package vendor. If the API of that package changes our code must change as well.</p>

<p>Likewise, if we want to replace our underlying cache technology (Memcached) with another technology (Redis), we again will have to modify our repository. Our repository should not have so much knowledge regarding who is providing them data or how they are providing it.</p>

<p><strong>Instead of this approach, we can improve our code by depending on a simple, vendor agnostic interface:</strong></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Cache\Repository</span> <span class="k">as</span> <span class="nx">Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The cache instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$cache</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Cache  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Cache</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now the code is not coupled to any specific vendor, or even Laravel. Since the contracts package contains no implementation and no dependencies, you may easily write an alternative implementation of any given contract, allowing you to replace your cache implementation without modifying any of your cache consuming code.</p>

<h3>Simplicity</h3>

<p>When all of Laravel&#39;s services are neatly defined within simple interfaces, it is very easy to determine the functionality offered by a given service. <strong>The contracts serve as succinct documentation to the framework&#39;s features.</strong></p>

<p>In addition, when you depend on simple interfaces, your code is easier to understand and maintain. Rather than tracking down which methods are available to you within a large, complicated class, you can refer to a simple, clean interface.</p>

<p><a name="contract-reference"></a></p>

<h2>Contract Reference</h2>

<p>This is a reference to most Laravel Contracts, as well as their Laravel &quot;facade&quot; counterparts:</p>

<p>Contract  |  References Facade
------------- | -------------
<a href="https://github.com/illuminate/contracts/blob/master/Auth/Guard.php">Illuminate\Contracts\Auth\Guard</a>  |  Auth
<a href="https://github.com/illuminate/contracts/blob/master/Auth/PasswordBroker.php">Illuminate\Contracts\Auth\PasswordBroker</a>  |  Password
<a href="https://github.com/illuminate/contracts/blob/master/Bus/Dispatcher.php">Illuminate\Contracts\Bus\Dispatcher</a>  |  Bus
<a href="https://github.com/illuminate/contracts/blob/master/Broadcasting/Broadcaster.php">Illuminate\Contracts\Broadcasting\Broadcaster</a>  | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Cache/Repository.php">Illuminate\Contracts\Cache\Repository</a> | Cache
<a href="https://github.com/illuminate/contracts/blob/master/Cache/Factory.php">Illuminate\Contracts\Cache\Factory</a> | Cache::driver()
<a href="https://github.com/illuminate/contracts/blob/master/Config/Repository.php">Illuminate\Contracts\Config\Repository</a> | Config
<a href="https://github.com/illuminate/contracts/blob/master/Container/Container.php">Illuminate\Contracts\Container\Container</a> | App
<a href="https://github.com/illuminate/contracts/blob/master/Cookie/Factory.php">Illuminate\Contracts\Cookie\Factory</a> | Cookie
<a href="https://github.com/illuminate/contracts/blob/master/Cookie/QueueingFactory.php">Illuminate\Contracts\Cookie\QueueingFactory</a> | Cookie::queue()
<a href="https://github.com/illuminate/contracts/blob/master/Encryption/Encrypter.php">Illuminate\Contracts\Encryption\Encrypter</a> | Crypt
<a href="https://github.com/illuminate/contracts/blob/master/Events/Dispatcher.php">Illuminate\Contracts\Events\Dispatcher</a> | Event
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Cloud.php">Illuminate\Contracts\Filesystem\Cloud</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Factory.php">Illuminate\Contracts\Filesystem\Factory</a> | File
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Filesystem.php">Illuminate\Contracts\Filesystem\Filesystem</a> | File
<a href="https://github.com/illuminate/contracts/blob/master/Foundation/Application.php">Illuminate\Contracts\Foundation\Application</a> | App
<a href="https://github.com/illuminate/contracts/blob/master/Hashing/Hasher.php">Illuminate\Contracts\Hashing\Hasher</a> | Hash
<a href="https://github.com/illuminate/contracts/blob/master/Logging/Log.php">Illuminate\Contracts\Logging\Log</a> | Log
<a href="https://github.com/illuminate/contracts/blob/master/Mail/MailQueue.php">Illuminate\Contracts\Mail\MailQueue</a> | Mail::queue()
<a href="https://github.com/illuminate/contracts/blob/master/Mail/Mailer.php">Illuminate\Contracts\Mail\Mailer</a> | Mail
<a href="https://github.com/illuminate/contracts/blob/master/Queue/Factory.php">Illuminate\Contracts\Queue\Factory</a> | Queue::driver()
<a href="https://github.com/illuminate/contracts/blob/master/Queue/Queue.php">Illuminate\Contracts\Queue\Queue</a> | Queue
<a href="https://github.com/illuminate/contracts/blob/master/Redis/Database.php">Illuminate\Contracts\Redis\Database</a> | Redis
<a href="https://github.com/illuminate/contracts/blob/master/Routing/Registrar.php">Illuminate\Contracts\Routing\Registrar</a> | Route
<a href="https://github.com/illuminate/contracts/blob/master/Routing/ResponseFactory.php">Illuminate\Contracts\Routing\ResponseFactory</a> | Response
<a href="https://github.com/illuminate/contracts/blob/master/Routing/UrlGenerator.php">Illuminate\Contracts\Routing\UrlGenerator</a> | URL
<a href="https://github.com/illuminate/contracts/blob/master/Support/Arrayable.php">Illuminate\Contracts\Support\Arrayable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Support/Jsonable.php">Illuminate\Contracts\Support\Jsonable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Support/Renderable.php">Illuminate\Contracts\Support\Renderable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Validation/Factory.php">Illuminate\Contracts\Validation\Factory</a> | Validator::make()
<a href="https://github.com/illuminate/contracts/blob/master/Validation/Validator.php">Illuminate\Contracts\Validation\Validator</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/View/Factory.php">Illuminate\Contracts\View\Factory</a> | View::make()
<a href="https://github.com/illuminate/contracts/blob/master/View/View.php">Illuminate\Contracts\View\View</a> | &nbsp;</p>

<p><a name="how-to-use-contracts"></a></p>

<h2>How To Use Contracts</h2>

<p>So, how do you get an implementation of a contract? It&#39;s actually quite simple.</p>

<p>Many types of classes in Laravel are resolved through the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, including controllers, event listeners, middleware, queued jobs, and even route Closures. So, to get an implementation of a contract, you can just &quot;type-hint&quot; the interface in the constructor of the class being resolved.</p>

<p>For example, take a look at this event listener:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\NewUserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Redis\Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheUserInformation</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The Redis database implementation.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$redis</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event handler instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Database  $redis</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$redis</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redis</span> <span class="o">=</span> <span class="nv">$redis</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  NewUserRegistered  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">NewUserRegistered</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When the event listener is resolved, the service container will read the type-hints on the constructor of the class, and inject the appropriate value. To learn more about registering things in the service container, check out <a href="/docs/%7B%7Bversion%7D%7D/container">its documentation</a>.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guidelines</h1>

<p>If you are submitting documentation for the <strong>current stable release</strong>, submit it to the corresponding branch. For example, documentation for Laravel 5.1 would be submitted to the <code>5.1</code> branch. Documentation intended for the next release of Laravel should be submitted to the <code>master</code> branch.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guide</h1>

<ul>
<li><a href="#bug-reports">Bug Reports</a></li>
<li><a href="#core-development-discussion">Core Development Discussion</a></li>
<li><a href="#which-branch">Which Branch?</a></li>
<li><a href="#security-vulnerabilities">Security Vulnerabilities</a></li>
<li><a href="#coding-style">Coding Style</a>

<ul>
<li><a href="#phpdoc">PHPDoc</a></li>
<li><a href="#styleci">StyleCI</a></li>
</ul></li>
</ul>

<p><a name="bug-reports"></a></p>

<h2>Bug Reports</h2>

<p>To encourage active collaboration, Laravel strongly encourages pull requests, not just bug reports. &quot;Bug reports&quot; may also be sent in the form of a pull request containing a failing test.</p>

<p>However, if you file a bug report, your issue should contain a title and a clear description of the issue. You should also include as much relevant information as possible and a code sample that demonstrates the issue. The goal of a bug report is to make it easy for yourself - and others - to replicate the bug and develop a fix.</p>

<p>Remember, bug reports are created in the hope that others with the same problem will be able to collaborate with you on solving it. Do not expect that the bug report will automatically see any activity or that others will jump to fix it. Creating a bug report serves to help yourself and others start on the path of fixing the problem.</p>

<p>The Laravel source code is managed on Github, and there are repositories for each of the Laravel projects:</p>

<ul>
<li><a href="https://github.com/laravel/framework">Laravel Framework</a></li>
<li><a href="https://github.com/laravel/laravel">Laravel Application</a></li>
<li><a href="https://github.com/laravel/docs">Laravel Documentation</a></li>
<li><a href="https://github.com/laravel/cashier">Laravel Cashier</a></li>
<li><a href="https://github.com/laravel/envoy">Laravel Envoy</a></li>
<li><a href="https://github.com/laravel/homestead">Laravel Homestead</a></li>
<li><a href="https://github.com/laravel/settler">Laravel Homestead Build Scripts</a></li>
<li><a href="https://github.com/laravel/laravel.com">Laravel Website</a></li>
<li><a href="https://github.com/laravel/art">Laravel Art</a></li>
</ul>

<p><a name="core-development-discussion"></a></p>

<h2>Core Development Discussion</h2>

<p>You may propose new features or improvements of existing Laravel behavior in the Laravel Internals <a href="https://github.com/laravel/internals/issues">issue board</a>. If you propose a new feature, please be willing to implement at least some of the code that would be needed to complete the feature.</p>

<p>Informal discussion regarding bugs, new features, and implementation of existing features takes place in the <code>#internals</code> channel of the <a href="http://larachat.co">LaraChat</a> Slack team. Taylor Otwell, the maintainer of Laravel, is typically present in the channel on weekdays from 8am-5pm (UTC-06:00 or America/Chicago), and sporadically present in the channel at other times.</p>

<p><a name="which-branch"></a></p>

<h2>Which Branch?</h2>

<p><strong>All</strong> bug fixes should be sent to the latest stable branch or to the current LTS branch (5.1). Bug fixes should <strong>never</strong> be sent to the <code>master</code> branch unless they fix features that exist only in the upcoming release.</p>

<p><strong>Minor</strong> features that are <strong>fully backwards compatible</strong> with the current Laravel release may be sent to the latest stable branch.</p>

<p><strong>Major</strong> new features should always be sent to the <code>master</code> branch, which contains the upcoming Laravel release.</p>

<p>If you are unsure if your feature qualifies as a major or minor, please ask Taylor Otwell in the <code>#internals</code> channel of the <a href="http://larachat.co">LaraChat</a> Slack team.</p>

<p><a name="security-vulnerabilities"></a></p>

<h2>Security Vulnerabilities</h2>

<p>If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell at <a href="mailto:taylor@laravel.com">taylor@laravel.com</a>. All security vulnerabilities will be promptly addressed.</p>

<p><a name="coding-style"></a></p>

<h2>Coding Style</h2>

<p>Laravel follows the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md">PSR-2</a> coding standard and the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md">PSR-4</a> autoloading standard.</p>

<p>Please note that we do order our imports by length, rather than alphabetically.</p>

<p><a name="phpdoc"></a></p>

<h3>PHPDoc</h3>

<p>Below is an example of a valid Laravel documentation block. Note that the <code>@param</code> attribtue is followed by two spaces, the argument type, two more spaces, and finally the variable name:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register a binding with the container.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string|array  $abstract</span>
<span class="cm"> * @param  \Closure|string|null  $concrete</span>
<span class="cm"> * @param  bool  $shared</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">bind</span><span class="p">(</span><span class="nx">$abstract</span><span class="p">,</span> <span class="nx">$concrete</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$shared</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="styleci"></a></p>

<h3>StyleCI</h3>

<p>If your code style isn&#39;t perfect, don&#39;t worry! <a href="https://styleci.io/">StyleCI</a> will automatically merge any style fixes into the Laravel repository after any pull requests are merged. This allows us to focus on the content of the contribution and not the code style.</p>
<div style="page-break-after: always;" ></div><h1>HTTP Controllers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-controllers">Basic Controllers</a></li>
<li><a href="#controller-middleware">Controller Middleware</a></li>
<li><a href="#restful-resource-controllers">RESTful Resource Controllers</a>

<ul>
<li><a href="#restful-partial-resource-routes">Partial Resource Routes</a></li>
<li><a href="#restful-naming-resource-routes">Naming Resource Routes</a></li>
<li><a href="#restful-nested-resources">Nested Resources</a></li>
<li><a href="#restful-supplementing-resource-controllers">Supplementing Resource Controllers</a></li>
</ul></li>
<li><a href="#implicit-controllers">Implicit Controllers</a></li>
<li><a href="#dependency-injection-and-controllers">Dependency Injection &amp; Controllers</a></li>
<li><a href="#route-caching">Route Caching</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Instead of defining all of your request handling logic in a single <code>routes.php</code> file, you may wish to organize this behavior using Controller classes. Controllers can group related HTTP request handling logic into a class. Controllers are typically stored in the <code>app/Http/Controllers</code> directory.</p>

<p><a name="basic-controllers"></a></p>

<h2>Basic Controllers</h2>

<p>Here is an example of a basic controller class. All Laravel controllers should extend the base controller class included with the default Laravel installation:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>We can route to the controller action like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">);</span>
</pre></div>

<p>Now, when a request matches the specified route URI, the <code>showProfile</code> method on the <code>UserController</code> class will be executed. Of course, the route parameters will also be passed to the method.</p>

<h4>Controllers &amp; Namespaces</h4>

<p>It is very important to note that we did not need to specify the full controller namespace when defining the controller route. We only defined the portion of the class name that comes after the <code>App\Http\Controllers</code> namespace &quot;root&quot;. By default, the <code>RouteServiceProvider</code> will load the <code>routes.php</code> file within a route group containing the root controller namespace.</p>

<p>If you choose to nest or organize your controllers using PHP namespaces deeper into the <code>App\Http\Controllers</code> directory, simply use the specific class name relative to the <code>App\Http\Controllers</code> root namespace. So, if your full controller class is <code>App\Http\Controllers\Photos\AdminController</code>, you would register a route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Photos\AdminController@method&#39;</span><span class="p">);</span>
</pre></div>

<h4>Naming Controller Routes</h4>

<p>Like Closure routes, you may specify names on controller routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;FooController@method&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</pre></div>

<h4>URLs To Controller Actions</h4>

<p>You may also use the <code>route</code> helper to generate a URL to a named controller route:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also use the <code>action</code> helper method to generate a URL using the controller&#39;s class and method names. Again, we only need to specify the part of the controller class name that comes after the base <code>App\Http\Controllers</code> namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;FooController@method&#39;</span><span class="p">);</span>
</pre></div>

<p>You may access the name of the controller action being run using the <code>currentRouteAction</code> method on the <code>Route</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$action</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteAction</span><span class="p">();</span>
</pre></div>

<p><a name="controller-middleware"></a></p>

<h2>Controller Middleware</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a> may be assigned to the controller&#39;s routes like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>However, it is more convenient to specify middleware within your controller&#39;s constructor. Using the <code>middleware</code> method from your controller&#39;s constructor, you may easily assign middleware to the controller. You may even restrict the middleware to only certain methods on the controller class:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new UserController instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;fooAction&#39;</span><span class="p">,</span> <span class="s1">&#39;barAction&#39;</span><span class="p">]]);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;subscribed&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;fooAction&#39;</span><span class="p">,</span> <span class="s1">&#39;barAction&#39;</span><span class="p">]]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="restful-resource-controllers"></a></p>

<h2>RESTful Resource Controllers</h2>

<p>Resource controllers make it painless to build RESTful controllers around resources. For example, you may wish to create a controller that handles HTTP requests regarding &quot;photos&quot; stored by your application. Using the <code>make:controller</code> Artisan command, we can quickly create such a controller:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">PhotoController</span>
</pre></div>

<p>The Artisan command will generate a controller file at <code>app/Http/Controllers/PhotoController.php</code>. The controller will contain a method for each of the available resource operations.</p>

<p>Next, you may register a resourceful route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p>This single route declaration creates multiple routes to handle a variety of RESTful actions on the photo resource. Likewise, the generated controller will already have methods stubbed for each of these actions, including notes informing you which URIs and verbs they handle.</p>

<h4>Actions Handled By Resource Controller</h4>

<p>Verb      | Path                  | Action       | Route Name
----------|-----------------------|--------------|---------------------
GET       | <code>/photo</code>              | index        | photo.index
GET       | <code>/photo/create</code>       | create       | photo.create
POST      | <code>/photo</code>              | store        | photo.store
GET       | <code>/photo/{photo}</code>      | show         | photo.show
GET       | <code>/photo/{photo}/edit</code> | edit         | photo.edit
PUT/PATCH | <code>/photo/{photo}</code>      | update       | photo.update
DELETE    | <code>/photo/{photo}</code>      | destroy      | photo.destroy</p>

<p><a name="restful-partial-resource-routes"></a></p>

<h4>Partial Resource Routes</h4>

<p>When declaring a resource route, you may specify a subset of actions to handle on the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]]);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">]]);</span>
</pre></div>

<p><a name="restful-naming-resource-routes"></a></p>

<h4>Naming Resource Routes</h4>

<p>By default, all resource controller actions have a route name; however, you can override these names by passing a <code>names</code> array with your options:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;photo.build&#39;</span><span class="p">]]);</span>
</pre></div>

<p><a name="restful-nested-resources"></a></p>

<h4>Nested Resources</h4>

<p>Sometimes you may need to define routes to a &quot;nested&quot; resource. For example, a photo resource may have multiple &quot;comments&quot; that may be attached to the photo. To &quot;nest&quot; resource controllers, use &quot;dot&quot; notation in your route declaration:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoCommentController&#39;</span><span class="p">);</span>
</pre></div>

<p>This route will register a &quot;nested&quot; resource that may be accessed with URLs like the following: <code>photos/{photos}/comments/{comments}</code>.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PhotoCommentController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the specified photo comment.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $photoId</span>
<span class="sd">     * @param  int  $commentId</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$photoId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="restful-supplementing-resource-controllers"></a></p>

<h4>Supplementing Resource Controllers</h4>

<p>If it becomes necessary to add additional routes to a resource controller beyond the default resource routes, you should define those routes before your call to <code>Route::resource</code>; otherwise, the routes defined by the <code>resource</code> method may unintentionally take precedence over your supplemental routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;photos/popular&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController@method&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="implicit-controllers"></a></p>

<h2>Implicit Controllers</h2>

<p>Laravel allows you to easily define a single route to handle every action in a controller class. First, define the route using the <code>Route::controller</code> method. The <code>controller</code> method accepts two arguments. The first is the base URI the controller handles, while the second is the class name of the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">);</span>
</pre></div>

<p>Next, just add methods to your controller. The method names should begin with the HTTP verb they respond to followed by the title case version of the URI:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Responds to requests to GET /users</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Responds to requests to GET /users/show/1</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getShow</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Responds to requests to GET /users/admin-profile</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAdminProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Responds to requests to POST /users/profile</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">postProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see in the example above, <code>index</code> methods will respond to the root URI handled by the controller, which, in this case, is <code>users</code>.</p>

<h4>Assigning Route Names</h4>

<p>If you would like to <a href="/docs/%7B%7Bversion%7D%7D/routing#named-routes">name</a> some of the routes on the controller, you may pass an array of names as the third argument to the <code>controller</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;getShow&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;user.show&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="dependency-injection-and-controllers"></a></p>

<h2>Dependency Injection &amp; Controllers</h2>

<h4>Constructor Injection</h4>

<p>The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> is used to resolve all Laravel controllers. As a result, you are able to type-hint any dependencies your controller may need in its constructor. The dependencies will automatically be resolved and injected into the controller instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Repositories\UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, you may also type-hint any <a href="/docs/%7B%7Bversion%7D%7D/contracts">Laravel contract</a>. If the container can resolve it, you can type-hint it.</p>

<h4>Method Injection</h4>

<p>In addition to constructor injection, you may also type-hint dependencies on your controller&#39;s action methods. For example, let&#39;s type-hint the <code>Illuminate\Http\Request</code> instance on one of our methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If your controller method is also expecting input from a route parameter, simply list your route arguments after your other dependencies. For example, if your route is defined like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@update&#39;</span><span class="p">);</span>
</pre></div>

<p>You may still type-hint the <code>Illuminate\Http\Request</code> and access your route parameter <code>id</code> by defining your controller method like the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the specified user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="route-caching"></a></p>

<h2>Route Caching</h2>

<blockquote>
<p><strong>Note:</strong> Route caching does not work with Closure based routes. To use route caching, you must convert any Closure routes to use controller classes.</p>
</blockquote>

<p>If your application is exclusively using controller based routes, you may take advantage of Laravel&#39;s route cache. Using the route cache will drastically decrease the amount of time it takes to register all of your application&#39;s routes. In some cases, your route registration may even be up to 100x faster! To generate a route cache, just execute the <code>route:cache</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>That&#39;s all there is to it! Your cached routes file will now be used instead of your <code>app/Http/routes.php</code> file. Remember, if you add any new routes you will need to generate a fresh route cache. Because of this, you may wish to only run the <code>route:cache</code> command during your project&#39;s deployment.</p>

<p>To remove the cached routes file without generating a new cache, use the <code>route:clear</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">clear</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Getting Started</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#running-queries">Running Raw SQL Queries</a>

<ul>
<li><a href="#listening-for-query-events">Listening For Query Events</a></li>
</ul></li>
<li><a href="#database-transactions">Database Transactions</a></li>
<li><a href="#accessing-connections">Using Multiple Database Connections</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel makes connecting with databases and running queries extremely simple across a variety of database back-ends using either raw SQL, the <a href="/docs/%7B%7Bversion%7D%7D/queries">fluent query builder</a>, and the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>. Currently, Laravel supports four database systems:</p>

<ul>
<li>MySQL</li>
<li>Postgres</li>
<li>SQLite</li>
<li>SQL Server</li>
</ul>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>Laravel makes connecting with databases and running queries extremely simple. The database configuration for your application is located at <code>config/database.php</code>. In this file you may define all of your database connections, as well as specify which connection should be used by default. Examples for all of the supported database systems are provided in this file.</p>

<p>By default, Laravel&#39;s sample <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">environment configuration</a> is ready to use with <a href="/docs/%7B%7Bversion%7D%7D/homestead">Laravel Homestead</a>, which is a convenient virtual machine for doing Laravel development on your local machine. Of course, you are free to modify this configuration as needed for your local database.</p>

<p><a name="read-write-connections"></a></p>

<h4>Read / Write Connections</h4>

<p>Sometimes you may wish to use one database connection for SELECT statements, and another for INSERT, UPDATE, and DELETE statements. Laravel makes this a breeze, and the proper connections will always be used whether you are using raw queries, the query builder, or the Eloquent ORM.</p>

<p>To see how read / write connections should be configured, let&#39;s look at this example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mysql&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;read&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;write&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;196.168.1.2&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;driver&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;charset&#39;</span>   <span class="p">=&gt;</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;collation&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;utf8_unicode_ci&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prefix&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Note that two keys have been added to the configuration array: <code>read</code> and <code>write</code>. Both of these keys have array values containing a single key: <code>host</code>. The rest of the database options for the <code>read</code> and <code>write</code> connections will be merged from the main <code>mysql</code> array.</p>

<p>So, we only need to place items in the <code>read</code> and <code>write</code> arrays if we wish to override the values in the main array. So, in this case, <code>192.168.1.1</code> will be used as the &quot;read&quot; connection, while <code>192.168.1.2</code> will be used as the &quot;write&quot; connection. The database credentials, prefix, character set, and all other options in the main <code>mysql</code> array will be shared across both connections.</p>

<p><a name="running-queries"></a></p>

<h2>Running Raw SQL Queries</h2>

<p>Once you have configured your database connection, you may run queries using the <code>DB</code> facade. The <code>DB</code> facade provides methods for each type of query: <code>select</code>, <code>update</code>, <code>insert</code>, <code>delete</code>, and <code>statement</code>.</p>

<h4>Running A Select Query</h4>

<p>To run a basic query, we can use the <code>select</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all of the application&#39;s users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;select * from users where active = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>select</code> method is the raw SQL query, while the second argument is any parameter bindings that need to be bound to the query. Typically, these are the values of the <code>where</code> clause constraints. Parameter binding provides protection against SQL injection.</p>

<p>The <code>select</code> method will always return an <code>array</code> of results. Each result within the array will be a PHP <code>stdClass</code> object, allowing you to access the values of the results:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Using Named Bindings</h4>

<p>Instead of using <code>?</code> to represent your parameter bindings, you may execute a query using named bindings:</p>
<div class="highlight"><pre><span></span><span class="nx">$results</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;select * from users where id = :id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Running An Insert Statement</h4>

<p>To execute an <code>insert</code> statement, you may use the <code>insert</code> method on the <code>DB</code> facade. Like <code>select</code>, this method takes the raw SQL query as its first argument, and bindings as the second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">insert</span><span class="p">(</span><span class="s1">&#39;insert into users (id, name) values (?, ?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running An Update Statement</h4>

<p>The <code>update</code> method should be used to update existing records in the database. The number of rows affected by the statement will be returned by the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$affected</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;update users set votes = 100 where name = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running A Delete Statement</h4>

<p>The <code>delete</code> method should be used to delete records from the database. Like <code>update</code>, the number of rows deleted will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$deleted</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;delete from users&#39;</span><span class="p">);</span>
</pre></div>

<h4>Running A General Statement</h4>

<p>Some database statements should not return any value. For these types of operations, you may use the <code>statement</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">statement</span><span class="p">(</span><span class="s1">&#39;drop table users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="listening-for-query-events"></a></p>

<h3>Listening For Query Events</h3>

<p>If you would like to receive each SQL query executed by your application, you may use the <code>listen</code> method. This method is useful for logging queries or debugging. You may register your query listener in a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nv">$bindings</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="database-transactions"></a></p>

<h2>Database Transactions</h2>

<p>To run a set of operations within a database transaction, you may use the <code>transaction</code> method on the <code>DB</code> facade. If an exception is thrown within the transaction <code>Closure</code>, the transaction will automatically be rolled back. If the <code>Closure</code> executes successfully, the transaction will automatically be committed. You don&#39;t need to worry about manually rolling back or committing while using the <code>transaction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Manually Using Transactions</h4>

<p>If you would like to begin a transaction manually and have complete control over rollbacks and commits, you may use the <code>beginTransaction</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">beginTransaction</span><span class="p">();</span>
</pre></div>

<p>You can rollback the transaction via the <code>rollBack</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">rollBack</span><span class="p">();</span>
</pre></div>

<p>Lastly, you can commit a transaction via the <code>commit</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Using the <code>DB</code> facade&#39;s transaction methods also controls transactions for the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> and <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>.</p>
</blockquote>

<p><a name="accessing-connections"></a></p>

<h2>Using Multiple Database Connections</h2>

<p>When using multiple connections, you may access each connection via the <code>connection</code> method on the <code>DB</code> facade. The <code>name</code> passed to the <code>connection</code> method should correspond to one of the connections listed in your <code>config/database.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(...);</span>
</pre></div>

<p>You may also access the raw, underlying PDO instance using the <code>getPdo</code> method on a connection instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$pdo</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">getPdo</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><ul>
<li>## Prologue

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/releases">Release Notes</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/upgrade">Upgrade Guide</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contributions">Contribution Guide</a></li>
<li><a href="/api/%7B%7Bversion%7D%7D">API Documentation</a></li>
</ul></li>
<li>## Setup

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/installation">Installation</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a></li>
</ul></li>
<li>## Tutorials

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/quickstart">Beginner Task List</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/quickstart-intermediate">Intermediate Task List</a></li>
</ul></li>
<li>## The Basics

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/routing">Routing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/controllers">Controllers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/requests">Requests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/responses">Responses</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/views">Views</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/blade">Blade Templates</a></li>
</ul></li>
<li>## Architecture Foundations

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/lifecycle">Request Lifecycle</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/structure">Application Structure</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/providers">Service Providers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/container">Service Container</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contracts">Contracts</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/facades">Facades</a></li>
</ul></li>
<li>## Services

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/authentication">Authentication</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/authorization">Authorization</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan Console</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/billing">Billing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/cache">Cache</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/collections">Collections</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/elixir">Elixir</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/encryption">Encryption</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/errors">Errors &amp; Logging</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/events">Events</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/filesystem">Filesystem / Cloud Storage</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/hashing">Hashing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/helpers">Helpers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/localization">Localization</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/mail">Mail</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/packages">Package Development</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/pagination">Pagination</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queues">Queues</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/session">Session</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/envoy">SSH Tasks</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/scheduling">Task Scheduling</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/testing">Testing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/validation">Validation</a></li>
</ul></li>
<li>## Database

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/database">Getting Started</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queries">Query Builder</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/migrations">Migrations</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/seeding">Seeding</a></li>
</ul></li>
<li>## Eloquent ORM

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent">Getting Started</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">Relationships</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">Collections</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators">Mutators</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-serialization">Serialization</a></li>
</ul></li>
</ul>
<div style="page-break-after: always;" ></div><h1>Laravel Elixir</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation &amp; Setup</a></li>
<li><a href="#running-elixir">Running Elixir</a></li>
<li><a href="#working-with-stylesheets">Working With Stylesheets</a>

<ul>
<li><a href="#less">Less</a></li>
<li><a href="#sass">Sass</a></li>
<li><a href="#plain-css">Plain CSS</a></li>
<li><a href="#css-source-maps">Source Maps</a></li>
</ul></li>
<li><a href="#working-with-scripts">Working With Scripts</a>

<ul>
<li><a href="#coffeescript">CoffeeScript</a></li>
<li><a href="#browserify">Browserify</a></li>
<li><a href="#babel">Babel</a></li>
<li><a href="#javascript">Scripts</a></li>
</ul></li>
<li><a href="#copying-files-and-directories">Copying Files &amp; Directories</a></li>
<li><a href="#versioning-and-cache-busting">Versioning / Cache Busting</a></li>
<li><a href="#browser-sync">BrowserSync</a></li>
<li><a href="#calling-existing-gulp-tasks">Calling Existing Gulp Tasks</a></li>
<li><a href="#writing-elixir-extensions">Writing Elixir Extensions</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Elixir provides a clean, fluent API for defining basic <a href="http://gulpjs.com">Gulp</a> tasks for your Laravel application. Elixir supports several common CSS and JavaScript pre-processors, and even testing tools. Using method chaining, Elixir allows you to fluently define your asset pipeline. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;app.scss&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">coffee</span><span class="p">(</span><span class="s1">&#39;app.coffee&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you&#39;ve ever been confused about how to get started with Gulp and asset compilation, you will love Laravel Elixir. However, you are not required to use it while developing your application. You are free to use any asset pipeline tool you wish, or even none at all.</p>

<p><a name="installation"></a></p>

<h2>Installation &amp; Setup</h2>

<h3>Installing Node</h3>

<p>Before triggering Elixir, you must first ensure that Node.js is installed on your machine.</p>
<div class="highlight"><pre><span></span><span class="nx">node</span> <span class="o">-</span><span class="nx">v</span>
</pre></div>

<p>By default, Laravel Homestead includes everything you need; however, if you aren&#39;t using Vagrant, then you can easily install Node by visiting <a href="http://nodejs.org/download/">their download page</a>.</p>

<h3>Gulp</h3>

<p>Next, you&#39;ll want to pull in <a href="http://gulpjs.com">Gulp</a> as a global NPM package:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">global</span> <span class="nx">gulp</span>
</pre></div>

<h3>Laravel Elixir</h3>

<p>The only remaining step is to install Elixir! Within a fresh installation of Laravel, you&#39;ll find a <code>package.json</code> file in the root. Think of this like your <code>composer.json</code> file, except it defines Node dependencies instead of PHP. You may install the dependencies it references by running:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

<p>If you are developing on a Windows system or you are running your VM on a Windows host system, you may need to run the <code>npm install</code> command with the <code>--no-bin-links</code> switch enabled:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">bin</span><span class="o">-</span><span class="nx">links</span>
</pre></div>

<p><a name="running-elixir"></a></p>

<h2>Running Elixir</h2>

<p>Elixir is built on top of <a href="http://gulpjs.com">Gulp</a>, so to run your Elixir tasks you only need to run the <code>gulp</code> command in your terminal. Adding the <code>--production</code> flag to the command will instruct Elixir to minify your CSS and JavaScript files:</p>
<div class="highlight"><pre><span></span><span class="c1">// Run all tasks...</span>
<span class="nx">gulp</span>

<span class="c1">// Run all tasks and minify all CSS and JavaScript...</span>
<span class="nx">gulp</span> <span class="o">--</span><span class="nx">production</span>
</pre></div>

<h4>Watching Assets For Changes</h4>

<p>Since it is inconvenient to run the <code>gulp</code> command on your terminal after every change to your assets, you may use the <code>gulp watch</code> command. This command will continue running in your terminal and watch your assets for any changes. When changes occur, new files will automatically be compiled:</p>
<div class="highlight"><pre><span></span><span class="nx">gulp</span> <span class="nx">watch</span>
</pre></div>

<p><a name="working-with-stylesheets"></a></p>

<h2>Working With Stylesheets</h2>

<p>The <code>gulpfile.js</code> file in your project&#39;s root directory contains all of your Elixir tasks. Elixir tasks can be chained together to define exactly how your assets should be compiled.</p>

<p><a name="less"></a></p>

<h3>Less</h3>

<p>To compile <a href="http://lesscss.org/">Less</a> into CSS, you may use the <code>less</code> method. The <code>less</code> method assumes that your Less files are stored in <code>resources/assets/less</code>. By default, the task will place the compiled CSS for this example in <code>public/css/app.css</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;app.less&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may also combine multiple Less files into a single CSS file. Again, the resulting CSS will be placed in <code>public/css/app.css</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">([</span>
        <span class="s1">&#39;app.less&#39;</span><span class="p">,</span>
        <span class="s1">&#39;controllers.less&#39;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to customize the output location of the compiled CSS, you may pass a second argument to the <code>less</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/stylesheets&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Specifying a specific output filename...</span>
<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/stylesheets/style.css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="sass"></a></p>

<h3>Sass</h3>

<p>The <code>sass</code> method allows you to compile <a href="http://sass-lang.com/">Sass</a> into CSS. Assuming your Sass files are stored at <code>resources/assets/sass</code>, you may use the method like so:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;app.scss&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Again, like the <code>less</code> method, you may compile multiple Sass files into a single CSS file, and even customize the output directory of the resulting CSS:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">([</span>
        <span class="s1">&#39;app.scss&#39;</span><span class="p">,</span>
        <span class="s1">&#39;controllers.scss&#39;</span>
    <span class="p">],</span> <span class="s1">&#39;public/assets/css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="plain-css"></a></p>

<h3>Plain CSS</h3>

<p>If you would just like to combine some plain CSS stylesheets into a single file, you may use the <code>styles</code> method. Paths passed to this method are relative to the <code>resources/assets/css</code> directory and the resulting CSS will be placed in <code>public/css/all.css</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
        <span class="s1">&#39;normalize.css&#39;</span><span class="p">,</span>
        <span class="s1">&#39;main.css&#39;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, you may also output the resulting file to a custom location by passing a second argument to the <code>styles</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
        <span class="s1">&#39;normalize.css&#39;</span><span class="p">,</span>
        <span class="s1">&#39;main.css&#39;</span>
    <span class="p">],</span> <span class="s1">&#39;public/assets/css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="css-source-maps"></a></p>

<h3>Source Maps</h3>

<p>Source maps are enabled out of the box. So, for each file that is compiled you will find a companion <code>*.css.map</code> file in the same directory. This mapping allows you to trace your compiled stylesheet selectors back to your original Sass or Less while debugging in your browser.</p>

<p>If you do not want source maps generated for your CSS, you may disable them using a simple configuration option:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">sourcemaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;app.scss&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="working-with-scripts"></a></p>

<h2>Working With Scripts</h2>

<p>Elixir also provides several functions to help you work with your JavaScript files, such as compiling ECMAScript 6, compiling CoffeeScript, Browserify, minification, and simply concatenating plain JavaScript files.</p>

<p><a name="coffeescript"></a></p>

<h3>CoffeeScript</h3>

<p>The <code>coffee</code> method may be used to compile <a href="http://coffeescript.org/">CoffeeScript</a> into plain JavaScript. The <code>coffee</code> function accepts a string or array of CoffeeScript files relative to the <code>resources/assets/coffee</code> directory and generates a single <code>app.js</code> file in the <code>public/js</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">coffee</span><span class="p">([</span><span class="s1">&#39;app.coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;controllers.coffee&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p><a name="browserify"></a></p>

<h3>Browserify</h3>

<p>Elixir also ships with a <code>browserify</code> method, which gives you all the benefits of requiring modules in the browser and using ECMAScript 6.</p>

<p>This task assumes that your scripts are stored in <code>resources/assets/js</code> and will place the resulting file in <code>public/js/main.js</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">browserify</span><span class="p">(</span><span class="s1">&#39;main.js&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>While Browserify ships with the Partialify and Babelify transformers, you&#39;re free to install and add more if you wish:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">aliasify</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">js</span><span class="p">.</span><span class="nx">browserify</span><span class="p">.</span><span class="nx">transformers</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;aliasify&#39;</span><span class="p">,</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span>

<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">browserify</span><span class="p">(</span><span class="s1">&#39;main.js&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="babel"></a></p>

<h3>Babel</h3>

<p>The <code>babel</code> method may be used to compile <a href="https://babeljs.io/docs/learn-es2015/">ECMAScript 6 and 7</a> into plain JavaScript. This function accepts an array of files relative to the <code>resources/assets/js</code> directory, and generates a single <code>all.js</code> file in the <code>public/js</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">babel</span><span class="p">([</span>
        <span class="s1">&#39;order.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;product.js&#39;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>To choose a different output location, simply specify your desired path as the second argument. The signature and functionality of this method are identical to <code>mix.scripts()</code>, excluding the Babel compilation.</p>

<p><a name="javascript"></a></p>

<h3>Scripts</h3>

<p>If you have multiple JavaScript files that you would like to combine into a single file, you may use the <code>scripts</code> method.</p>

<p>The <code>scripts</code> method assumes all paths are relative to the <code>resources/assets/js</code> directory, and will place the resulting JavaScript in <code>public/js/all.js</code> by default:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scripts</span><span class="p">([</span>
        <span class="s1">&#39;jquery.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;app.js&#39;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>If you need to combine multiple sets of scripts into different files, you may make multiple calls to the <code>scripts</code> method. The second argument given to the method determines the resulting file name for each concatenation:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scripts</span><span class="p">([</span><span class="s1">&#39;app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;controllers.js&#39;</span><span class="p">],</span> <span class="s1">&#39;public/js/app.js&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">scripts</span><span class="p">([</span><span class="s1">&#39;forum.js&#39;</span><span class="p">,</span> <span class="s1">&#39;threads.js&#39;</span><span class="p">],</span> <span class="s1">&#39;public/js/forum.js&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you need to combine all of the scripts in a given directory, you may use the <code>scriptsIn</code> method. The resulting JavaScript will be placed in <code>public/js/all.js</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scriptsIn</span><span class="p">(</span><span class="s1">&#39;public/js/some/directory&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="copying-files-and-directories"></a></p>

<h2>Copying Files &amp; Directories</h2>

<p>The <code>copy</code> method may be used to copy files and directories to new locations. All operations are relative to the project&#39;s root directory:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;vendor/foo/bar.css&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css/bar.css&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;vendor/package/views&#39;</span><span class="p">,</span> <span class="s1">&#39;resources/views&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="versioning-and-cache-busting"></a></p>

<h2>Versioning / Cache Busting</h2>

<p>Many developers suffix their compiled assets with a timestamp or unique token to force browsers to load the fresh assets instead of serving stale copies of the code. Elixir can handle this for you using the <code>version</code> method.</p>

<p>The <code>version</code> method accepts a file name relative to the <code>public</code> directory, and will append a unique hash to the filename, allowing for cache-busting. For example, the generated file name will look something like: <code>all-16d570a7.css</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="s1">&#39;css/all.css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>After generating the versioned file, you may use Laravel&#39;s global <code>elixir</code> PHP helper function within your <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> to load the appropriately hashed asset. The <code>elixir</code> function will automatically determine the name of the hashed file:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&#39;css/all.css&#39;) }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<h4>Versioning Multiple Files</h4>

<p>You may pass an array to the <code>version</code> method to version multiple files:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">version</span><span class="p">([</span><span class="s1">&#39;css/all.css&#39;</span><span class="p">,</span> <span class="s1">&#39;js/app.js&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Once the files have been versioned, you may use the <code>elixir</code> helper function to generate links to the proper hashed files. Remember, you only need to pass the name of the un-hashed file to the <code>elixir</code> helper function. The helper will use the un-hashed name to determine the current hashed version of the file:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&#39;css/all.css&#39;) }}&quot;</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&#39;js/app.js&#39;) }}&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><a name="browser-sync"></a></p>

<h2>BrowserSync</h2>

<p>BrowserSync automatically refreshes your web browser after you make changes to your front-end resources. You can use the <code>browserSync</code> method to instruct Elixir to start a BrowserSync server when you run the <code>gulp watch</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">browserSync</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Once you run <code>gulp watch</code>, access your web application using port 3000 to enable browser syncing: <code>http://homestead.app:3000</code>. If you&#39;re using a domain other than <code>homestead.app</code> for local development, you may pass an array of <a href="http://www.browsersync.io/docs/options/">options</a> as the first argument to the <code>browserSync</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">browserSync</span><span class="p">({</span>
        <span class="nx">proxy</span><span class="o">:</span> <span class="s1">&#39;project.app&#39;</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="calling-existing-gulp-tasks"></a></p>

<h2>Calling Existing Gulp Tasks</h2>

<p>If you need to call an existing Gulp task from Elixir, you may use the <code>task</code> method. As an example, imagine that you have a Gulp task that simply speaks a bit of text when called:</p>
<div class="highlight"><pre><span></span><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;Tea...Earl Grey...Hot&#39;</span><span class="p">;</span>

    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shell</span><span class="p">(</span><span class="s1">&#39;say &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to call this task from Elixir, use the <code>mix.task</code> method and pass the name of the task as the only argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Custom Watchers</h4>

<p>If you need to register a watcher to run your custom task each time some files are modified, pass a regular expression as the second argument to the <code>task</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="s1">&#39;app/**/*.php&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="writing-elixir-extensions"></a></p>

<h2>Writing Elixir Extensions</h2>

<p>If you need more flexibility than Elixir&#39;s <code>task</code> method can provide, you may create custom Elixir extensions. Elixir extensions allow you to pass arguments to your custom tasks. For example, you could write an extension like so:</p>
<div class="highlight"><pre><span></span><span class="c1">// File: elixir-extensions.js</span>

<span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-shell&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Elixir</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;laravel-elixir&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Task</span> <span class="o">=</span> <span class="nx">Elixir</span><span class="p">.</span><span class="nx">Task</span><span class="p">;</span>

<span class="nx">Elixir</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">new</span> <span class="nx">Task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shell</span><span class="p">(</span><span class="s1">&#39;say &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">));</span>
    <span class="p">});</span>

<span class="p">});</span>

<span class="c1">// mix.speak(&#39;Hello World&#39;);</span>
</pre></div>

<p>That&#39;s it! Notice that your Gulp-specific logic should be placed within the function passed as the second argument to the <code>Task</code> constructor. You may either place this at the top of your Gulpfile, or instead extract it to a custom tasks file. For example, if you place your extensions in <code>elixir-extensions.js</code>, you may require the file from your main <code>Gulpfile</code> like so:</p>
<div class="highlight"><pre><span></span><span class="c1">// File: Gulpfile.js</span>

<span class="kd">var</span> <span class="nx">elixir</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;laravel-elixir&#39;</span><span class="p">);</span>

<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./elixir-extensions&#39;</span><span class="p">)</span>

<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="s1">&#39;Tea, Earl Grey, Hot&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Custom Watchers</h4>

<p>If you would like your custom task to be re-triggered while running <code>gulp watch</code>, you may register a watcher:</p>
<div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">Task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shell</span><span class="p">(</span><span class="s1">&#39;say &#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">));</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./app/**&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Collections</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#available-methods">Available Methods</a></li>
<li><a href="#custom-collections">Custom Collections</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>All multi-result sets returned by Eloquent are instances of the <code>Illuminate\Database\Eloquent\Collection</code> object, including results retrieved via the <code>get</code> method or accessed via a relationship. The Eloquent collection object extends the Laravel <a href="/docs/%7B%7Bversion%7D%7D/collections">base collection</a>, so it naturally inherits dozens of methods used to fluently work with the underlying array of Eloquent models.</p>

<p>Of course, all collections also serve as iterators, allowing you to loop over them as if they were simple PHP arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>However, collections are much more powerful than arrays and expose a variety of map / reduce operations that may be chained using an intuitive interface. For example, let&#39;s remove all inactive models and gather the first name for each remaining user:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$names</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">active</span> <span class="o">===</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> While most Eloquent collection methods return a new instance of an Eloquent collection, the <code>pluck</code>, <code>keys</code>, <code>zip</code>, <code>collapse</code>, <code>flatten</code> and <code>flip</code> methods return a <a href="/docs/%7B%7Bversion%7D%7D/collections">base collection</a> instance. Likewise, if a <code>map</code> operation returns a collection that does not contain any Eloquent models, it will be automatically cast to a base collection.</p>
</blockquote>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<h3>The Base Collection</h3>

<p>All Eloquent collections extend the base <a href="/docs/%7B%7Bversion%7D%7D/collections">Laravel collection</a> object; therefore, they inherit all of the powerful methods provided by the base collection class:</p>

<style>
    #collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    #collection-method-list a {
        display: block;
    }
</style>

<div id="collection-method-list" markdown="1">

[all](/docs/{{version}}/collections#method-all)
[average](/docs/{{version}}/collections#method-average)
[avg](/docs/{{version}}/collections#method-avg)
[chunk](/docs/{{version}}/collections#method-chunk)
[collapse](/docs/{{version}}/collections#method-collapse)
[contains](/docs/{{version}}/collections#method-contains)
[count](/docs/{{version}}/collections#method-count)
[diff](/docs/{{version}}/collections#method-diff)
[each](/docs/{{version}}/collections#method-each)
[every](/docs/{{version}}/collections#method-every)
[except](/docs/{{version}}/collections#method-except)
[filter](/docs/{{version}}/collections#method-filter)
[first](/docs/{{version}}/collections#method-first)
[flatMap](/docs/{{version}}/collections#method-flatmap)
[flatten](/docs/{{version}}/collections#method-flatten)
[flip](/docs/{{version}}/collections#method-flip)
[forget](/docs/{{version}}/collections#method-forget)
[forPage](/docs/{{version}}/collections#method-forpage)
[get](/docs/{{version}}/collections#method-get)
[groupBy](/docs/{{version}}/collections#method-groupby)
[has](/docs/{{version}}/collections#method-has)
[implode](/docs/{{version}}/collections#method-implode)
[intersect](/docs/{{version}}/collections#method-intersect)
[isEmpty](/docs/{{version}}/collections#method-isempty)
[keyBy](/docs/{{version}}/collections#method-keyby)
[keys](/docs/{{version}}/collections#method-keys)
[last](/docs/{{version}}/collections#method-last)
[map](/docs/{{version}}/collections#method-map)
[max](/docs/{{version}}/collections#method-max)
[merge](/docs/{{version}}/collections#method-merge)
[min](/docs/{{version}}/collections#method-min)
[only](/docs/{{version}}/collections#method-only)
[pluck](/docs/{{version}}/collections#method-pluck)
[pop](/docs/{{version}}/collections#method-pop)
[prepend](/docs/{{version}}/collections#method-prepend)
[pull](/docs/{{version}}/collections#method-pull)
[push](/docs/{{version}}/collections#method-push)
[put](/docs/{{version}}/collections#method-put)
[random](/docs/{{version}}/collections#method-random)
[reduce](/docs/{{version}}/collections#method-reduce)
[reject](/docs/{{version}}/collections#method-reject)
[reverse](/docs/{{version}}/collections#method-reverse)
[search](/docs/{{version}}/collections#method-search)
[shift](/docs/{{version}}/collections#method-shift)
[shuffle](/docs/{{version}}/collections#method-shuffle)
[slice](/docs/{{version}}/collections#method-slice)
[sort](/docs/{{version}}/collections#method-sort)
[sortBy](/docs/{{version}}/collections#method-sortby)
[sortByDesc](/docs/{{version}}/collections#method-sortbydesc)
[splice](/docs/{{version}}/collections#method-splice)
[sum](/docs/{{version}}/collections#method-sum)
[take](/docs/{{version}}/collections#method-take)
[toArray](/docs/{{version}}/collections#method-toarray)
[toJson](/docs/{{version}}/collections#method-tojson)
[transform](/docs/{{version}}/collections#method-transform)
[unique](/docs/{{version}}/collections#method-unique)
[values](/docs/{{version}}/collections#method-values)
[where](/docs/{{version}}/collections#method-where)
[whereLoose](/docs/{{version}}/collections#method-whereloose)
[zip](/docs/{{version}}/collections#method-zip)

</div>

<p><a name="custom-collections"></a></p>

<h2>Custom Collections</h2>

<p>If you need to use a custom <code>Collection</code> object with your own extension methods, you may override the <code>newCollection</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\CustomCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new Eloquent Collection instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $models</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Collection</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">newCollection</span><span class="p">(</span><span class="k">array</span> <span class="nv">$models</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomCollection</span><span class="p">(</span><span class="nv">$models</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have defined a <code>newCollection</code> method, you will receive an instance of your custom collection anytime Eloquent returns a <code>Collection</code> instance of that model. If you would like to use a custom collection for every model in your application, you should override the <code>newCollection</code> method on a base model class that is extended by all of your models.</p>
<div style="page-break-after: always;" ></div><h1>Eloquent: Mutators</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#accessors-and-mutators">Accessors &amp; Mutators</a></li>
<li><a href="#date-mutators">Date Mutators</a></li>
<li><a href="#attribute-casting">Attribute Casting</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Accessors and mutators allow you to format Eloquent attributes when retrieving them from a model or setting their value. For example, you may want to use the <a href="/docs/%7B%7Bversion%7D%7D/encryption">Laravel encrypter</a> to encrypt a value while it is stored in the database, and then automatically decrypt the attribute when you access it on an Eloquent model.</p>

<p>In addition to custom accessors and mutators, Eloquent can also automatically cast date fields to <a href="https://github.com/briannesbitt/Carbon">Carbon</a> instances or even <a href="#attribute-casting">cast text fields to JSON</a>.</p>

<p><a name="accessors-and-mutators"></a></p>

<h2>Accessors &amp; Mutators</h2>

<h4>Defining An Accessor</h4>

<p>To define an accessor, create a <code>getFooAttribute</code> method on your model where <code>Foo</code> is the &quot;camel&quot; cased name of the column you wish to access. In this example, we&#39;ll define an accessor for the <code>first_name</code> attribute. The accessor will automatically be called by Eloquent when attempting to retrieve the value of <code>first_name</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the user&#39;s first name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $value</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFirstNameAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, the original value of the column is passed to the accessor, allowing you to manipulate and return the value. To access the value of the mutator, you may simply access the <code>first_name</code> attribute:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$firstName</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">first_name</span><span class="p">;</span>
</pre></div>

<h4>Defining A Mutator</h4>

<p>To define a mutator, define a <code>setFooAttribute</code> method on your model where <code>Foo</code> is the &quot;camel&quot; cased name of the column you wish to access. So, again, let&#39;s define a mutator for the <code>first_name</code> attribute. This mutator will be automatically called when we attempt to set the value of the <code>first_name</code> attribute on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Set the user&#39;s first name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $value</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setFirstNameAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The mutator will receive the value that is being set on the attribute, allowing you to manipulate the value and set the manipulated value on the Eloquent model&#39;s internal <code>$attributes</code> property. So, for example, if we attempt to set the <code>first_name</code> attribute to <code>Sally</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">first_name</span> <span class="o">=</span> <span class="s1">&#39;Sally&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the <code>setFirstNameAttribute</code> function will be called with the value <code>Sally</code>. The mutator will then apply the <code>strtolower</code> function to the name and set its value in the internal <code>$attributes</code> array.</p>

<p><a name="date-mutators"></a></p>

<h2>Date Mutators</h2>

<p>By default, Eloquent will convert the <code>created_at</code> and <code>updated_at</code> columns to instances of <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, which provides an assortment of helpful methods, and extends the native PHP <code>DateTime</code> class.</p>

<p>You may customize which fields are automatically mutated, and even completely disable this mutation, by overriding the <code>$dates</code> property of your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be mutated to dates.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">,</span> <span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>When a column is considered a date, you may set its value to a UNIX timestamp, date string (<code>Y-m-d</code>), date-time string, and of course a <code>DateTime</code> / <code>Carbon</code> instance, and the date&#39;s value will automatically be correctly stored in your database:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">deleted_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>As noted above, when retrieving attributes that are listed in your <code>$dates</code> property, they will automatically be cast to <a href="https://github.com/briannesbitt/Carbon">Carbon</a> instances, allowing you to use any of Carbon&#39;s methods on your attributes:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">deleted_at</span><span class="o">-&gt;</span><span class="nx">getTimestamp</span><span class="p">();</span>
</pre></div>

<p>By default, timestamps are formatted as <code>&#39;Y-m-d H:i:s&#39;</code>. If you need to customize the timestamp format, set the <code>$dateFormat</code> property on your model. This property determines how date attributes are stored in the database, as well as their format when the model is serialized to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The storage format of the model&#39;s date columns.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="attribute-casting"></a></p>

<h2>Attribute Casting</h2>

<p>The <code>$casts</code> property on your model provides a convenient method of converting attributes to common data types. The <code>$casts</code> property should be an array where the key is the name of the attribute being cast, while the value is the type you wish to cast to the column to. The supported cast types are: <code>integer</code>, <code>real</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>boolean</code>, <code>object</code>, <code>array</code>, <code>collection</code>, <code>date</code> and <code>datetime</code>.</p>

<p>For example, let&#39;s cast the <code>is_admin</code> attribute, which is stored in our database as an integer (<code>0</code> or <code>1</code>) to a boolean value:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be casted to native types.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;is_admin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Now the <code>is_admin</code> attribute will always be cast to a boolean when you access it, even if the underlying value is stored in the database as an integer:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">is_admin</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Array Casting</h4>

<p>The <code>array</code> cast type is particularly useful when working with columns that are stored as serialized JSON. For example, if your database has a <code>TEXT</code> field type that contains serialized JSON, adding the <code>array</code> cast to that attribute will automatically deserialize the attribute to a PHP array when you access it on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be casted to native types.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once the cast is defined, you may access the <code>options</code> attribute and it will automatically be deserialized from JSON into a PHP array. When you set the value of the <code>options</code> attribute, the given array will automatically be serialized back into JSON for storage:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$options</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span><span class="p">;</span>

<span class="nx">$options</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$options</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Relationships</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-relationships">Defining Relationships</a>

<ul>
<li><a href="#one-to-one">One To One</a></li>
<li><a href="#one-to-many">One To Many</a></li>
<li><a href="#many-to-many">Many To Many</a></li>
<li><a href="#has-many-through">Has Many Through</a></li>
<li><a href="#polymorphic-relations">Polymorphic Relations</a></li>
<li><a href="#many-to-many-polymorphic-relations">Many To Many Polymorphic Relations</a></li>
</ul></li>
<li><a href="#querying-relations">Querying Relations</a>

<ul>
<li><a href="#eager-loading">Eager Loading</a></li>
<li><a href="#constraining-eager-loads">Constraining Eager Loads</a></li>
<li><a href="#lazy-eager-loading">Lazy Eager Loading</a></li>
</ul></li>
<li><a href="#inserting-related-models">Inserting Related Models</a>

<ul>
<li><a href="#inserting-many-to-many-relationships">Many To Many Relationships</a></li>
<li><a href="#touching-parent-timestamps">Touching Parent Timestamps</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Database tables are often related to one another. For example, a blog post may have many comments, or an order could be related to the user who placed it. Eloquent makes managing and working with these relationships easy, and supports several different types of relationships:</p>

<ul>
<li><a href="#one-to-one">One To One</a></li>
<li><a href="#one-to-many">One To Many</a></li>
<li><a href="#many-to-many">Many To Many</a></li>
<li><a href="#has-many-through">Has Many Through</a></li>
<li><a href="#polymorphic-relations">Polymorphic Relations</a></li>
<li><a href="#many-to-many-polymorphic-relations">Many To Many Polymorphic Relations</a></li>
</ul>

<p><a name="defining-relationships"></a></p>

<h2>Defining Relationships</h2>

<p>Eloquent relationships are defined as functions on your Eloquent model classes. Since, like Eloquent models themselves, relationships also serve as powerful <a href="/docs/%7B%7Bversion%7D%7D/queries">query builders</a>, defining relationships as functions provides powerful method chaining and querying capabilities. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>But, before diving too deep into using relationships, let&#39;s learn how to define each type:</p>

<p><a name="one-to-one"></a></p>

<h3>One To One</h3>

<p>A one-to-one relationship is a very basic relation. For example, a <code>User</code> model might be associated with one <code>Phone</code>. To define this relationship, we place a <code>phone</code> method on the <code>User</code> model. The <code>phone</code> method should return the results of the <code>hasOne</code> method on the base Eloquent model class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the phone record associated with the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">phone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasOne</code> method is the name of the related model. Once the relationship is defined, we may retrieve the related record using Eloquent&#39;s dynamic properties. Dynamic properties allow you to access relationship functions as if they were properties defined on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$phone</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">phone</span><span class="p">;</span>
</pre></div>

<p>Eloquent assumes the foreign key of the relationship based on the model name. In this case, the <code>Phone</code> model is automatically assumed to have a <code>user_id</code> foreign key. If you wish to override this convention, you may pass a second argument to the <code>hasOne</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
</pre></div>

<p>Additionally, Eloquent assumes that the foreign key should have a value matching the <code>id</code> column of the parent. In other words, Eloquent will look for the value of the user&#39;s <code>id</code> column in the <code>user_id</code> column of the <code>Phone</code> record. If you would like the relationship to use a value other than <code>id</code>, you may pass a third argument to the <code>hasOne</code> method specifying your custom key:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of The Relation</h4>

<p>So, we can access the <code>Phone</code> model from our <code>User</code>. Now, let&#39;s define a relationship on the <code>Phone</code> model that will let us access the <code>User</code> that owns the phone. We can define the inverse of a <code>hasOne</code> relationship using the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Phone</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the user that owns the phone.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In the example above, Eloquent will try to match the <code>user_id</code> from the <code>Phone</code> model to an <code>id</code> on the <code>User</code> model. Eloquent determines the default foreign key name by examining the name of the relationship method and suffixing the method name with <code>_id</code>. However, if the foreign key on the <code>Phone</code> model is not <code>user_id</code>, you may pass a custom key name as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the user that owns the phone.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If your parent model does not use <code>id</code> as its primary key, or you wish to join the child model to a different column, you may pass a third argument to the <code>belongsTo</code> method specifying your parent table&#39;s custom key:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the user that owns the phone.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;other_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="one-to-many"></a></p>

<h3>One To Many</h3>

<p>A &quot;one-to-many&quot; relationship is used to define relationships where a single model owns any amount of other models. For example, a blog post may have an infinite number of comments. Like all other Eloquent relationships, one-to-many relationships are defined by placing a function on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the comments for the blog post.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Remember, Eloquent will automatically determine the proper foreign key column on the <code>Comment</code> model. By convention, Eloquent will take the &quot;snake case&quot; name of the owning model and suffix it with <code>_id</code>. So, for this example, Eloquent will assume the foreign key on the <code>Comment</code> model is <code>post_id</code>.</p>

<p>Once the relationship has been defined, we can access the collection of comments by accessing the <code>comments</code> property. Remember, since Eloquent provides &quot;dynamic properties&quot;, we can access relationship functions as if they were defined as properties on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">;</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$comments</span> <span class="nx">as</span> <span class="nx">$comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Of course, since all relationships also serve as query builders, you can add further constraints to which comments are retrieved by calling the <code>comments</code> method and continuing to chain conditions onto the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<p>Like the <code>hasOne</code> method, you may also override the foreign and local keys by passing additional arguments to the <code>hasMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of The Relation</h4>

<p>Now that we can access all of a post&#39;s comments, let&#39;s define a relationship to allow a comment to access its parent post. To define the inverse of a <code>hasMany</code> relationship, define a relationship function on the child model which calls the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the post that owns the comment.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the relationship has been defined, we can retrieve the <code>Post</code> model for a <code>Comment</code> by accessing the <code>post</code> &quot;dynamic property&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">post</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">;</span>
</pre></div>

<p>In the example above, Eloquent will try to match the <code>post_id</code> from the <code>Comment</code> model to an <code>id</code> on the <code>Post</code> model. Eloquent determines the default foreign key name by examining the name of the relationship method and suffixing the method name with <code>_id</code>. However, if the foreign key on the <code>Comment</code> model is not <code>post_id</code>, you may pass a custom key name as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the post that owns the comment.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If your parent model does not use <code>id</code> as its primary key, or you wish to join the child model to a different column, you may pass a third argument to the <code>belongsTo</code> method specifying your parent table&#39;s custom key:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the post that owns the comment.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;other_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="many-to-many"></a></p>

<h3>Many To Many</h3>

<p>Many-to-many relations are slightly more complicated than <code>hasOne</code> and <code>hasMany</code> relationships. An example of such a relationship is a user with many roles, where the roles are also shared by other users. For example, many users may have the role of &quot;Admin&quot;. To define this relationship, three database tables are needed: <code>users</code>, <code>roles</code>, and <code>role_user</code>. The <code>role_user</code> table is derived from the alphabetical order of the related model names, and contains the <code>user_id</code> and <code>role_id</code> columns.</p>

<p>Many-to-many relationships are defined by writing a method that calls the <code>belongsToMany</code> method on the base Eloquent class. For example, let&#39;s define the <code>roles</code> method on our <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The roles that belong to the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">roles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the relationship is defined, you may access the user&#39;s roles using the <code>roles</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Of course, like all other relationship types, you may call the <code>roles</code> method to continue chaining query constraints onto the relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>As mentioned previously, to determine the table name of the relationship&#39;s joining table, Eloquent will join the two related model names in alphabetical order. However, you are free to override this convention. You may do so by passing a second argument to the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">);</span>
</pre></div>

<p>In addition to customizing the name of the joining table, you may also customize the column names of the keys on the table by passing additional arguments to the <code>belongsToMany</code> method. The third argument is the foreign key name of the model on which you are defining the relationship, while the fourth argument is the foreign key name of the model that you are joining to:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of The Relationship</h4>

<p>To define the inverse of a many-to-many relationship, you simply place another call to <code>belongsToMany</code> on your related model. To continue our user roles example, let&#39;s define the <code>users</code> method on the <code>Role</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Role</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The users that belong to the role.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, the relationship is defined exactly the same as its <code>User</code> counterpart, with the exception of simply referencing the <code>App\User</code> model. Since we&#39;re reusing the <code>belongsToMany</code> method, all of the usual table and key customization options are available when defining the inverse of many-to-many relationships.</p>

<h4>Retrieving Intermediate Table Columns</h4>

<p>As you have already learned, working with many-to-many relations requires the presence of an intermediate table. Eloquent provides some very helpful ways of interacting with this table. For example, let&#39;s assume our <code>User</code> object has many <code>Role</code> objects that it is related to. After accessing this relationship, we may access the intermediate table using the <code>pivot</code> attribute on the models:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">pivot</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Notice that each <code>Role</code> model we retrieve is automatically assigned a <code>pivot</code> attribute. This attribute contains a model representing the intermediate table, and may be used like any other Eloquent model.</p>

<p>By default, only the model keys will be present on the <code>pivot</code> object. If your pivot table contains extra attributes, you must specify them when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withPivot</span><span class="p">(</span><span class="s1">&#39;column1&#39;</span><span class="p">,</span> <span class="s1">&#39;column2&#39;</span><span class="p">);</span>
</pre></div>

<p>If you want your pivot table to have automatically maintained <code>created_at</code> and <code>updated_at</code> timestamps, use the <code>withTimestamps</code> method on the relationship definition:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withTimestamps</span><span class="p">();</span>
</pre></div>

<p><a name="has-many-through"></a></p>

<h3>Has Many Through</h3>

<p>The &quot;has-many-through&quot; relationship provides a convenient short-cut for accessing distant relations via an intermediate relation. For example, a <code>Country</code> model might have many <code>Post</code> models through an intermediate <code>User</code> model. In this example, you could easily gather all blog posts for a given country. Let&#39;s look at the tables required to define this relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">countries</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">country_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">user_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Though <code>posts</code> does not contain a <code>country_id</code> column, the <code>hasManyThrough</code> relation provides access to a country&#39;s posts via <code>$country-&gt;posts</code>. To perform this query, Eloquent inspects the <code>country_id</code> on the intermediate <code>users</code> table. After finding the matching user IDs, they are used to query the <code>posts</code> table.</p>

<p>Now that we have examined the table structure for the relationship, let&#39;s define it on the <code>Country</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Country</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts for the country.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasManyThrough</code> method is the name of the final model we wish to access, while the second argument is the name of the intermediate model.</p>

<p>Typical Eloquent foreign key conventions will be used when performing the relationship&#39;s queries. If you would like to customize the keys of the relationship, you may pass them as the third and fourth arguments to the <code>hasManyThrough</code> method. The third argument is the name of the foreign key on the intermediate model, while the fourth argument is the name of the foreign key on the final model.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="polymorphic-relations"></a></p>

<h3>Polymorphic Relations</h3>

<h4>Table Structure</h4>

<p>Polymorphic relations allow a model to belong to more than one other model on a single association. For example, imagine you want to store photos for your staff members and for your products. Using polymorphic relationships, you can use a single <code>photos</code> table for both of these scenarios. First, let&#39;s examine the table structure required to build this relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">staff</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">products</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">price</span> <span class="o">-</span> <span class="nx">integer</span>

<span class="nx">photos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">path</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">imageable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">imageable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Two important columns to note are the <code>imageable_id</code> and <code>imageable_type</code> columns on the <code>photos</code> table. The <code>imageable_id</code> column will contain the ID value of the owning staff or product, while the <code>imageable_type</code> column will contain the class name of the owning model. The <code>imageable_type</code> column is how the ORM determines which &quot;type&quot; of owning model to return when accessing the <code>imageable</code> relation.</p>

<h4>Model Structure</h4>

<p>Next, let&#39;s examine the model definitions needed to build this relationship:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Photo</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the owning imageable models.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">imageable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Staff</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the staff member&#39;s photos.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Product</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the product&#39;s photos.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving Polymorphic Relations</h4>

<p>Once your database table and models are defined, you may access the relationships via your models. For example, to access all of the photos for a staff member, we can simply use the <code>photos</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$staff</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Staff</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$staff</span><span class="o">-&gt;</span><span class="nx">photos</span> <span class="nx">as</span> <span class="nx">$photo</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also retrieve the owner of a polymorphic relation from the polymorphic model by accessing the name of the method that performs the call to <code>morphTo</code>. In our case, that is the <code>imageable</code> method on the <code>Photo</code> model. So, we will access that method as a dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$photo</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Photo</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$imageable</span> <span class="o">=</span> <span class="nx">$photo</span><span class="o">-&gt;</span><span class="nx">imageable</span><span class="p">;</span>
</pre></div>

<p>The <code>imageable</code> relation on the <code>Photo</code> model will return either a <code>Staff</code> or <code>Product</code> instance, depending on which type of model owns the photo.</p>

<h4>Custom Polymorphic Types</h4>

<p>By default, Laravel will use the fully qualified class name to store the type of the related model. For instance, given the example above where a <code>Like</code> may belong to a <code>Post</code> or a <code>Comment</code>, the default <code>likable_type</code> would be either <code>App\Post</code> or <code>App\Comment</code>, respectively. However, you may wish to decouple your database from your application&#39;s internal structure. In that case, you may define a relationship &quot;morph map&quot; to instruct Eloquent to use the table name associated with each model instead of the class name:</p>
<div class="highlight"><pre><span></span><span class="nx">Relation</span><span class="o">::</span><span class="nx">morphMap</span><span class="p">([</span>
    <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Or, you may specify a custom string to associate with each model:</p>
<div class="highlight"><pre><span></span><span class="nx">Relation</span><span class="o">::</span><span class="nx">morphMap</span><span class="p">([</span>
    <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;likes&#39;</span> <span class="p">=&gt;</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Like</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>You may register the <code>morphMap</code> in your <code>AppServiceProvider</code> or create a separate service provider if you wish.</p>

<p><a name="many-to-many-polymorphic-relations"></a></p>

<h3>Many To Many Polymorphic Relations</h3>

<h4>Table Structure</h4>

<p>In addition to traditional polymorphic relations, you may also define &quot;many-to-many&quot; polymorphic relations. For example, a blog <code>Post</code> and <code>Video</code> model could share a polymorphic relation to a <code>Tag</code> model. Using a many-to-many polymorphic relation allows you to have a single list of unique tags that are shared across blog posts and videos. First, let&#39;s examine the table structure:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">videos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">tags</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">taggables</span>
    <span class="nx">tag_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<h4>Model Structure</h4>

<p>Next, we&#39;re ready to define the relationships on the model. The <code>Post</code> and <code>Video</code> models will both have a <code>tags</code> method that calls the <code>morphToMany</code> method on the base Eloquent class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the tags for the post.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tags</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphToMany</span><span class="p">(</span><span class="s1">&#39;App\Tag&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Defining The Inverse Of The Relationship</h4>

<p>Next, on the <code>Tag</code> model, you should define a method for each of its related models. So, for this example, we will define a <code>posts</code> method and a <code>videos</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Tag</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts that are assigned this tag.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get all of the videos that are assigned this tag.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">videos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Video&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Relationship</h4>

<p>Once your database table and models are defined, you may access the relationships via your models. For example, to access all of the tags for a post, you can simply use the <code>tags</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">tags</span> <span class="nx">as</span> <span class="nx">$tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also retrieve the owner of a polymorphic relation from the polymorphic model by accessing the name of the method that performs the call to <code>morphedByMany</code>. In our case, that is the <code>posts</code> or <code>videos</code> methods on the <code>Tag</code> model. So, you will access those methods as dynamic properties:</p>
<div class="highlight"><pre><span></span><span class="nx">$tag</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Tag</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$tag</span><span class="o">-&gt;</span><span class="nx">videos</span> <span class="nx">as</span> <span class="nx">$video</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="querying-relations"></a></p>

<h2>Querying Relations</h2>

<p>Since all types of Eloquent relationships are defined via functions, you may call those functions to obtain an instance of the relationship without actually executing the relationship queries. In addition, all types of Eloquent relationships also serve as <a href="/docs/%7B%7Bversion%7D%7D/queries">query builders</a>, allowing you to continue to chain constraints onto the relationship query before finally executing the SQL against your database.</p>

<p>For example, imagine a blog system in which a <code>User</code> model has many associated <code>Post</code> models:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts for the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may query the <code>posts</code> relationship and add additional constraints to the relationship like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Note that you are able to use any of the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> methods on the relationship!</p>

<h4>Relationship Methods Vs. Dynamic Properties</h4>

<p>If you do not need to add additional constraints to an Eloquent relationship query, you may simply access the relationship as if it were a property. For example, continuing to use our <code>User</code> and <code>Post</code> example models, we may access all of a user&#39;s posts like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span> <span class="nx">as</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Dynamic properties are &quot;lazy loading&quot;, meaning they will only load their relationship data when you actually access them. Because of this, developers often use <a href="#eager-loading">eager loading</a> to pre-load relationships they know will be accessed after loading the model. Eager loading provides a significant reduction in SQL queries that must be executed to load a model&#39;s relations.</p>

<h4>Querying Relationship Existence</h4>

<p>When accessing the records for a model, you may wish to limit your results based on the existence of a relationship. For example, imagine you want to retrieve all blog posts that have at least one comment. To do so, you may pass the name of the relationship to the <code>has</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts that have at least one comment...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify an operator and count to further customize the query:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts that have three or more comments...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Nested <code>has</code> statements may also be constructed using &quot;dot&quot; notation. For example, you may retrieve all posts that have at least one comment and vote:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts that have at least one comment with votes...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments.votes&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need even more power, you may use the <code>whereHas</code> and <code>orWhereHas</code> methods to put &quot;where&quot; conditions on your <code>has</code> queries. These methods allow you to add customized constraints to a relationship constraint, such as checking the content of a comment:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts with at least one comment containing words like foo%</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="eager-loading"></a></p>

<h3>Eager Loading</h3>

<p>When accessing Eloquent relationships as properties, the relationship data is &quot;lazy loaded&quot;. This means the relationship data is not actually loaded until you first access the property. However, Eloquent can &quot;eager load&quot; relationships at the time you query the parent model. Eager loading alleviates the N + 1 query problem. To illustrate the N + 1 query problem, consider a <code>Book</code> model that is related to <code>Author</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the author that wrote the book.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">author</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Author&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, let&#39;s retrieve all books and their authors:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$books</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This loop will execute 1 query to retrieve all of the books on the table, then another query for each book to retrieve the author. So, if we have 25 books, this loop would run 26 queries: 1 for the original book, and 25 additional queries to retrieve the author of each book.</p>

<p>Thankfully, we can use eager loading to reduce this operation to just 2 queries. When querying, you may specify which relationships should be eager loaded using the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$books</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>For this operation, only two queries will be executed:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">books</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">authors</span> <span class="nx">where</span> <span class="nx">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>

<h4>Eager Loading Multiple Relationships</h4>

<p>Sometimes you may need to eager load several different relationships in a single operation. To do so, just pass additional arguments to the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Nested Eager Loading</h4>

<p>To eager load nested relationships, you may use &quot;dot&quot; syntax. For example, let&#39;s eager load all of the book&#39;s authors and all of the author&#39;s personal contacts in one Eloquent statement:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author.contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="constraining-eager-loads"></a></p>

<h3>Constraining Eager Loads</h3>

<p>Sometimes you may wish to eager load a relationship, but also specify additional query constraints for the eager loading query. Here&#39;s an example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;%first%&#39;</span><span class="p">);</span>

<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In this example, Eloquent will only eager load posts that if the post&#39;s <code>title</code> column contains the word <code>first</code>. Of course, you may call other <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> to further customize the eager loading operation:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>

<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="lazy-eager-loading"></a></p>

<h3>Lazy Eager Loading</h3>

<p>Sometimes you may need to eager load a relationship after the parent model has already been retrieved. For example, this may be useful if you need to dynamically decide whether to load related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$someCondition</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you need to set additional query constraints on the eager loading query, you may pass a <code>Closure</code> to the <code>load</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">([</span><span class="s1">&#39;author&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">);</span>
<span class="p">}]);</span>
</pre></div>

<p><a name="inserting-related-models"></a></p>

<h2>Inserting Related Models</h2>

<h4>The Save Method</h4>

<p>Eloquent provides convenient methods for adding new models to relationships. For example, perhaps you need to insert a new <code>Comment</code> for a <code>Post</code> model. Instead of manually setting the <code>post_id</code> attribute on the <code>Comment</code>, you may insert the <code>Comment</code> directly from the relationship&#39;s <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]);</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>
</pre></div>

<p>Notice that we did not access the <code>comments</code> relationship as a dynamic property. Instead, we called the <code>comments</code> method to obtain an instance of the relationship. The <code>save</code> method will automatically add the appropriate <code>post_id</code> value to the new <code>Comment</code> model.</p>

<p>If you need to save multiple related models, you may use the <code>saveMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">saveMany</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Another comment.&#39;</span><span class="p">]),</span>
<span class="p">]);</span>
</pre></div>

<h4>Save &amp; Many To Many Relationships</h4>

<p>When working with a many-to-many relationship, the <code>save</code> method accepts an array of additional intermediate table attributes as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<h4>The Create Method</h4>

<p>In addition to the <code>save</code> and <code>saveMany</code> methods, you may also use the <code>create</code> method, which accepts an array of attributes, creates a model, and inserts it into the database. Again, the difference between <code>save</code> and <code>create</code> is that <code>save</code> accepts a full Eloquent model instance while <code>create</code> accepts a plain PHP <code>array</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Before using the <code>create</code> method, be sure to review the documentation on attribute <a href="/docs/%7B%7Bversion%7D%7D/eloquent#mass-assignment">mass assignment</a>.</p>

<p><a name="updating-belongs-to-relationships"></a></p>

<h4>Updating &quot;Belongs To&quot; Relationships</h4>

<p>When updating a <code>belongsTo</code> relationship, you may use the <code>associate</code> method. This method will set the foreign key on the child model:</p>
<div class="highlight"><pre><span></span><span class="nx">$account</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Account</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">associate</span><span class="p">(</span><span class="nx">$account</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>When removing a <code>belongsTo</code> relationship, you may use the <code>dissociate</code> method. This method will reset the foreign key as well as the relation on the child model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">dissociate</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="inserting-many-to-many-relationships"></a></p>

<h3>Many To Many Relationships</h3>

<h4>Attaching / Detaching</h4>

<p>When working with many-to-many relationships, Eloquent provides a few additional helper methods to make working with related models more convenient. For example, let&#39;s imagine a user can have many roles and a role can have many users. To attach a role to a user by inserting a record in the intermediate table that joins the models, use the <code>attach</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">);</span>
</pre></div>

<p>When attaching a relationship to a model, you may also pass an array of additional data to be inserted into the intermediate table:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<p>Of course, sometimes it may be necessary to remove a role from a user. To remove a many-to-many relationship record, use the <code>detach</code> method. The <code>detach</code> method will remove the appropriate record out of the intermediate table; however, both models will remain in the database:</p>
<div class="highlight"><pre><span></span><span class="c1">// Detach a single role from the user...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">);</span>

<span class="c1">// Detach all roles from the user...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">();</span>
</pre></div>

<p>For convenience, <code>attach</code> and <code>detach</code> also accept arrays of IDs as input:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Syncing For Convenience</h4>

<p>You may also use the <code>sync</code> method to construct many-to-many associations. The <code>sync</code> method accepts an array of IDs to place on the intermediate table. Any IDs that are not in the given array will be removed from the intermediate table. So, after this operation is complete, only the IDs in the array will exist in the intermediate table:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>You may also pass additional intermediate table values with the IDs:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p><a name="touching-parent-timestamps"></a></p>

<h3>Touching Parent Timestamps</h3>

<p>When a model <code>belongsTo</code> or <code>belongsToMany</code> another model, such as a <code>Comment</code> which belongs to a <code>Post</code>, it is sometimes helpful to update the parent&#39;s timestamp when the child model is updated. For example, when a <code>Comment</code> model is updated, you may want to automatically &quot;touch&quot; the <code>updated_at</code> timestamp of the owning <code>Post</code>. Eloquent makes it easy. Just add a <code>touches</code> property containing the names of the relationships to the child model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * All of the relationships to be touched.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$touches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the post that the comment belongs to.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, when you update a <code>Comment</code>, the owning <code>Post</code> will have its <code>updated_at</code> column updated as well:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;Edit to this comment!&#39;</span><span class="p">;</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Serialization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#hiding-attributes-from-json">Hiding Attributes From JSON</a></li>
<li><a href="#appending-values-to-json">Appending Values To JSON</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When building JSON APIs, you will often need to convert your models and relationships to arrays or JSON. Eloquent includes convenient methods for making these conversions, as well as controlling which attributes are included in your serializations.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Converting A Model To An Array</h4>

<p>To convert a model and its loaded <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationships</a> to an array, you may use the <code>toArray</code> method. This method is recursive, so all attributes and all relations (including the relations of relations) will be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p>You may also convert <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">collections</a> to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<h4>Converting A Model To JSON</h4>

<p>To convert a model to JSON, you may use the <code>toJson</code> method. Like <code>toArray</code>, the <code>toJson</code> method is recursive, so all attributes and relations will be converted to JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may cast a model or collection to a string, which will automatically call the <code>toJson</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$user</span><span class="p">;</span>
</pre></div>

<p>Since models and collections are converted to JSON when cast to a string, you can return Eloquent objects directly from your application&#39;s routes or controllers:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="hiding-attributes-from-json"></a></p>

<h2>Hiding Attributes From JSON</h2>

<p>Sometimes you may wish to limit the attributes, such as passwords, that are included in your model&#39;s array or JSON representation. To do so, add a <code>$hidden</code> property definition to your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be hidden for arrays.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When hiding relationships, use the relationship&#39;s <strong>method</strong> name, not its dynamic property name.</p>
</blockquote>

<p>Alternatively, you may use the <code>visible</code> property to define a white-list of attributes that should be included in your model&#39;s array and JSON representation:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be visible in arrays.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="appending-values-to-json"></a></p>

<h2>Appending Values To JSON</h2>

<p>Occasionally, you may need to add array attributes that do not have a corresponding column in your database. To do so, first define an <a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators">accessor</a> for the value:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the administrator flag for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getIsAdminAttribute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have created the accessor, add the attribute name to the <code>appends</code> property on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The accessors to append to the model&#39;s array form.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_admin&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once the attribute has been added to the <code>appends</code> list, it will be included in both the model&#39;s array and JSON forms. Attributes in the <code>appends</code> array will also respect the <code>visible</code> and <code>hidden</code> settings configured on the model.</p>
<div style="page-break-after: always;" ></div><h1>Eloquent: Getting Started</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-models">Defining Models</a>

<ul>
<li><a href="#eloquent-model-conventions">Eloquent Model Conventions</a></li>
</ul></li>
<li><a href="#retrieving-multiple-models">Retrieving Multiple Models</a></li>
<li><a href="#retrieving-single-models">Retrieving Single Models / Aggregates</a>

<ul>
<li><a href="#retrieving-aggregates">Retrieving Aggregates</a></li>
</ul></li>
<li><a href="#inserting-and-updating-models">Inserting &amp; Updating Models</a>

<ul>
<li><a href="#basic-inserts">Basic Inserts</a></li>
<li><a href="#basic-updates">Basic Updates</a></li>
<li><a href="#mass-assignment">Mass Assignment</a></li>
</ul></li>
<li><a href="#deleting-models">Deleting Models</a>

<ul>
<li><a href="#soft-deleting">Soft Deleting</a></li>
<li><a href="#querying-soft-deleted-models">Querying Soft Deleted Models</a></li>
</ul></li>
<li><a href="#query-scopes">Query Scopes</a></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &quot;Model&quot; which is used to interact with that table. Models allow you to query for data in your tables, as well as insert new records into the table.</p>

<p>Before getting started, be sure to configure a database connection in <code>config/database.php</code>. For more information on configuring your database, check out <a href="/docs/%7B%7Bversion%7D%7D/database#configuration">the documentation</a>.</p>

<p><a name="defining-models"></a></p>

<h2>Defining Models</h2>

<p>To get started, let&#39;s create an Eloquent model. Models typically live in the <code>app</code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code>composer.json</code> file. All Eloquent models extend <code>Illuminate\Database\Eloquent\Model</code> class.</p>

<p>The easiest way to create a model instance is using the <code>make:model</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">User</span>
</pre></div>

<p>If you would like to generate a <a href="/docs/%7B%7Bversion%7D%7D/migrations">database migration</a> when you generate the model, you may use the <code>--migration</code> or <code>-m</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">User</span> <span class="o">--</span><span class="nx">migration</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">User</span> <span class="o">-</span><span class="nx">m</span>
</pre></div>

<p><a name="eloquent-model-conventions"></a></p>

<h3>Eloquent Model Conventions</h3>

<p>Now, let&#39;s look at an example <code>Flight</code> model class, which we will use to retrieve and store information from our <code>flights</code> database table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Table Names</h4>

<p>Note that we did not tell Eloquent which table to use for our <code>Flight</code> model. The &quot;snake case&quot;, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Eloquent will assume the <code>Flight</code> model stores records in the <code>flights</code> table. You may specify a custom table by defining a <code>table</code> property on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The table associated with the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;my_flights&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Primary Keys</h4>

<p>Eloquent will also assume that each table has a primary key column named <code>id</code>. You may define a <code>$primaryKey</code> property to override this convention.</p>

<h4>Timestamps</h4>

<p>By default, Eloquent expects <code>created_at</code> and <code>updated_at</code> columns to exist on your tables.  If you do not wish to have these columns automatically managed by Eloquent, set the <code>$timestamps</code> property on your model to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Indicates if the model should be timestamped.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you need to customize the format of your timestamps, set the <code>$dateFormat</code> property on your model. This property determines how date attributes are stored in the database, as well as their format when the model is serialized to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The storage format of the model&#39;s date columns.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Database Connection</h4>

<p>By default, all Eloquent models will use the default database connection configured for your application. If you would like to specify a different connection for the model, use the <code>$connection</code> property:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The connection name for the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;connection-name&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="retrieving-multiple-models"></a></p>

<h2>Retrieving Multiple Models</h2>

<p>Once you have created a model and <a href="/docs/%7B%7Bversion%7D%7D/migrations#writing-migrations">its associated database table</a>, you are ready to start retrieving data from your database. Think of each Eloquent model as a powerful <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> allowing you to fluently query the database table associated with the model. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Flight</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FlightController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all available flights.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$flights</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;flight.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;flights&#39;</span> <span class="o">=&gt;</span> <span class="nv">$flights</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Accessing Column Values</h4>

<p>If you have an Eloquent model instance, you may access the column values of the model by accessing the corresponding property. For example, let&#39;s loop through each <code>Flight</code> instance returned by our query and echo the value of the <code>name</code> column:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$flights</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Adding Additional Constraints</h4>

<p>The Eloquent <code>all</code> method will return all of the results in the model&#39;s table. Since each Eloquent model serves as a <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>, you may also add constraints to queries, and then use the <code>get</code> method to retrieve the results:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Since Eloquent models are query builders, you should review all of the methods available on the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>. You may use any of these methods in your Eloquent queries.</p>
</blockquote>

<h4>Collections</h4>

<p>For Eloquent methods like <code>all</code> and <code>get</code> which retrieve multiple results, an instance of <code>Illuminate\Database\Eloquent\Collection</code> will be returned. The <code>Collection</code> class provides <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#available-methods">a variety of helpful methods</a> for working with your Eloquent results. Of course, you may simply loop over this collection like an array:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$flights</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Chunking Results</h4>

<p>If you need to process thousands of Eloquent records, use the <code>chunk</code> command. The <code>chunk</code> method will retrieve a &quot;chunk&quot; of Eloquent models, feeding them to a given <code>Closure</code> for processing. Using the <code>chunk</code> method will conserve memory when working with large result sets:</p>
<div class="highlight"><pre><span></span><span class="nx">Flight</span><span class="o">::</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$flights</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$flights</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the method is the number of records you wish to receive per &quot;chunk&quot;. The Closure passed as the second argument will be called for each chunk that is retrieved from the database.</p>

<p><a name="retrieving-single-models"></a></p>

<h2>Retrieving Single Models / Aggregates</h2>

<p>Of course, in addition to retrieving all of the records for a given table, you may also retrieve single records using <code>find</code> and <code>first</code>. Instead of returning a collection of models, these methods return a single model instance:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve a model by its primary key...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Retrieve the first model matching the query constraints...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<h4>Not Found Exceptions</h4>

<p>Sometimes you may wish to throw an exception if a model is not found. This is particularly useful in routes or controllers. The <code>findOrFail</code> and <code>firstOrFail</code> methods will retrieve the first result of the query. However, if no result is found, a <code>Illuminate\Database\Eloquent\ModelNotFoundException</code> will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
</pre></div>

<p>If the exception is not caught, a <code>404</code> HTTP response is automatically sent back to the user, so it is not necessary to write explicit checks to return <code>404</code> responses when using these methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/flights/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="retrieving-aggregates"></a></p>

<h3>Retrieving Aggregates</h3>

<p>Of course, you may also use <code>count</code>, <code>sum</code>, <code>max</code>, and other <a href="/docs/%7B%7Bversion%7D%7D/queries#aggregates">aggregate functions</a> provided by the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>. These methods return the appropriate scalar value instead of a full model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$count</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$max</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="inserting-and-updating-models"></a></p>

<h2>Inserting &amp; Updating Models</h2>

<p><a name="basic-inserts"></a></p>

<h3>Basic Inserts</h3>

<p>To create a new record in the database, simply create a new model instance, set attributes on the model, then call the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Flight</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FlightController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new flight instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validate the request...</span>

        <span class="nv">$flight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Flight</span><span class="p">;</span>

        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>

        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, we simply assign the <code>name</code> parameter from the incoming HTTP request to the <code>name</code> attribute of the <code>App\Flight</code> model instance. When we call the <code>save</code> method, a record will be inserted into the database. The <code>created_at</code> and <code>updated_at</code> timestamps will automatically be set when the <code>save</code> method is called, so there is no need to set them manually.</p>

<p><a name="basic-updates"></a></p>

<h3>Basic Updates</h3>

<p>The <code>save</code> method may also be used to update models that already exist in the database. To update a model, you should retrieve it, set any attributes you wish to update, and then call the <code>save</code> method. Again, the <code>updated_at</code> timestamp will automatically be updated, so there is no need to manually set its value:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;New Flight Name&#39;</span><span class="p">;</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>Updates can also be performed against any number of models that match a given query. In this example, all flights that are <code>active</code> and have a <code>destination</code> of <code>San Diego</code> will be marked as delayed:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;destination&#39;</span><span class="p">,</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;delayed&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>The <code>update</code> method expects an array of column and value pairs representing the columns that should be updated.</p>

<p><a name="mass-assignment"></a></p>

<h3>Mass Assignment</h3>

<p>You may also use the <code>create</code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code>fillable</code> or <code>guarded</code> attribute on the model, as all Eloquent models protect against mass-assignment.</p>

<p>A mass-assignment vulnerability occurs when a user passes an unexpected HTTP parameter through a request, and that parameter changes a column in your database you did not expect. For example, a malicious user might send an <code>is_admin</code> parameter through an HTTP request, which is then mapped onto your model&#39;s <code>create</code> method, allowing the user to escalate themselves to an administrator.</p>

<p>So, to get started, you should define which model attributes you want to make mass assignable. You may do this using the <code>$fillable</code> property on the model. For example, let&#39;s make the <code>name</code> attribute of our <code>Flight</code> model mass assignable:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that are mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once we have made the attributes mass assignable, we can use the <code>create</code> method to insert a new record in the database. The <code>create</code> method returns the saved model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>
</pre></div>

<p>While <code>$fillable</code> serves as a &quot;white list&quot; of attributes that should be mass assignable, you may also choose to use <code>$guarded</code>. The <code>$guarded</code> property should contain an array of attributes that you do not want to be mass assignable. All other attributes not in the array will be mass assignable. So, <code>$guarded</code> functions like a &quot;black list&quot;. Of course, you should use either <code>$fillable</code> or <code>$guarded</code> - not both:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that aren&#39;t mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>In the example above, all attributes <strong>except for <code>price</code></strong> will be mass assignable.</p>

<h4>Other Creation Methods</h4>

<p>There are two other methods you may use to create models by mass assigning attributes: <code>firstOrCreate</code> and <code>firstOrNew</code>. The <code>firstOrCreate</code> method will attempt to locate a database record using the given column / value pairs. If the model can not be found in the database, a record will be inserted with the given attributes.</p>

<p>The <code>firstOrNew</code> method, like <code>firstOrCreate</code> will attempt to locate a record in the database matching the given attributes. However, if a model is not found, a new model instance will be returned. Note that the model returned by <code>firstOrNew</code> has not yet been persisted to the database. You will need to call <code>save</code> manually to persist it:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve the flight by the attributes, or create it if it doesn&#39;t exist...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrCreate</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>

<span class="c1">// Retrieve the flight by the attributes, or instantiate a new instance...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrNew</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="deleting-models"></a></p>

<h2>Deleting Models</h2>

<p>To delete a model, call the <code>delete</code> method on a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting An Existing Model By Key</h4>

<p>In the example above, we are retrieving the model from the database before calling the <code>delete</code> method. However, if you know the primary key of the model, you may delete the model without retrieving it. To do so, call the <code>destroy</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></div>

<h4>Deleting Models By Query</h4>

<p>Of course, you may also run a delete query on a set of models. In this example, we will delete all flights that are marked as inactive:</p>
<div class="highlight"><pre><span></span><span class="nx">$deletedRows</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p><a name="soft-deleting"></a></p>

<h3>Soft Deleting</h3>

<p>In addition to actually removing records from your database, Eloquent can also &quot;soft delete&quot; models. When models are soft deleted, they are not actually removed from your database. Instead, a <code>deleted_at</code> attribute is set on the model and inserted into the database. If a model has a non-null <code>deleted_at</code> value, the model has been soft deleted. To enable soft deletes for a model, use the <code>Illuminate\Database\Eloquent\SoftDeletes</code> trait on the model and add the <code>deleted_at</code> column to your <code>$dates</code> property:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\SoftDeletes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SoftDeletes</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be mutated to dates.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Of course, you should add the <code>deleted_at</code> column to your database table. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/migrations">schema builder</a> contains a helper method to create this column:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">softDeletes</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Now, when you call the <code>delete</code> method on the model, the <code>deleted_at</code> column will be set to the current date and time. And, when querying a model that uses soft deletes, the soft deleted models will automatically be excluded from all query results.</p>

<p>To determine if a given model instance has been soft deleted, use the <code>trashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">trashed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="querying-soft-deleted-models"></a></p>

<h3>Querying Soft Deleted Models</h3>

<h4>Including Soft Deleted Models</h4>

<p>As noted above, soft deleted models will automatically be excluded from query results. However, you may force soft deleted models to appear in a result set using the <code>withTrashed</code> method on the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>withTrashed</code> method may also be used on a <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationship</a> query:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Where Clause Caveats</h4>

<p>When adding <code>orWhere</code> clauses to your queries on soft deleted models, always use <a href="http://laravel.com/docs/5.1/queries#advanced-where-clauses">advance where clauses</a> to logically group the <code>WHERE</code> clauses. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>This will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="sb">`users`</span> <span class="nx">where</span> <span class="sb">`users`</span><span class="p">.</span><span class="sb">`deleted_at`</span> <span class="nx">is</span> <span class="kc">null</span> <span class="nx">and</span> <span class="p">(</span><span class="sb">`name`</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">or</span> <span class="sb">`votes`</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

<p>If the <code>orWhere</code> clause is not grouped, it will produce the following SQL which will contain soft deleted records:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="sb">`users`</span> <span class="nx">where</span> <span class="sb">`users`</span><span class="p">.</span><span class="sb">`deleted_at`</span> <span class="nx">is</span> <span class="kc">null</span> <span class="nx">and</span> <span class="sb">`name`</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">or</span> <span class="sb">`votes`</span> <span class="o">&gt;</span> <span class="mi">100</span>
</pre></div>

<h4>Retrieving Only Soft Deleted Models</h4>

<p>The <code>onlyTrashed</code> method will retrieve <strong>only</strong> soft deleted models:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">onlyTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Restoring Soft Deleted Models</h4>

<p>Sometimes you may wish to &quot;un-delete&quot; a soft deleted model. To restore a soft deleted model into an active state, use the <code>restore</code> method on a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>restore</code> method in a query to quickly restore multiple models:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>Like the <code>withTrashed</code> method, the <code>restore</code> method may also be used on <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationships</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<h4>Permanently Deleting Models</h4>

<p>Sometimes you may need to truly remove a model from your database. To permanently remove a soft deleted model from the database, use the <code>forceDelete</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Force deleting a single model instance...</span>
<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>

<span class="c1">// Force deleting all related models...</span>
<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p><a name="query-scopes"></a></p>

<h2>Query Scopes</h2>

<p>Scopes allow you to define common sets of constraints that you may easily re-use throughout your application. For example, you may need to frequently retrieve all users that are considered &quot;popular&quot;. To define a scope, simply prefix an Eloquent model method with <code>scope</code>.</p>

<p>Scopes should always return a query builder instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include popular users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopePopular</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include active users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeActive</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Utilizing A Query Scope</h4>

<p>Once the scope has been defined, you may call the scope methods when querying the model. However, you do not need to include the <code>scope</code> prefix when calling the method. You can even chain calls to various scopes, for example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Dynamic Scopes</h4>

<p>Sometimes you may wish to define a scope that accepts parameters. To get started, just add your additional parameters to your scope. Scope parameters should be defined after the <code>$query</code> argument:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include users of a given type.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeOfType</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="nv">$type</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, you may pass the parameters when calling the scope:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">ofType</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Eloquent models fire several events, allowing you to hook into various points in the model&#39;s lifecycle using the following methods: <code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>, <code>restoring</code>, <code>restored</code>. Events allow you to easily execute code each time a specific model class is saved or updated in the database.</p>

<p><a name="basic-usage"></a></p>

<h3>Basic Usage</h3>

<p>Whenever a new model is saved for the first time, the <code>creating</code> and <code>created</code> events will fire. If a model already existed in the database and the <code>save</code> method is called, the <code>updating</code> / <code>updated</code> events will fire. However, in both cases, the <code>saving</code> / <code>saved</code> events will fire.</p>

<p>For example, let&#39;s define an Eloquent event listener in a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. Within our event listener, we will call the <code>isValid</code> method on the given model, and return <code>false</code> if the model is not valid. Returning <code>false</code> from an Eloquent event listener will cancel the <code>save</code> / <code>update</code> operation:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">User</span><span class="o">::</span><span class="na">creating</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Encryption</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Before using Laravel&#39;s encrypter, you should set the <code>key</code> option of your <code>config/app.php</code> configuration file to a 32 character, random string. If this value is not properly set, all values encrypted by Laravel will be insecure.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Encrypting A Value</h4>

<p>You may encrypt a value using the <code>Crypt</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. All encrypted values are encrypted using OpenSSL and the <code>AES-256-CBC</code> cipher. Furthermore, all encrypted values are signed with a message authentication code (MAC) to detect any modifications to the encrypted string.</p>

<p>For example, we may use the <code>encrypt</code> method to encrypt a secret and store it on an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent model</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Crypt</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a secret message for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">storeSecret</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
            <span class="s1">&#39;secret&#39;</span> <span class="o">=&gt;</span> <span class="nx">Crypt</span><span class="o">::</span><span class="na">encrypt</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">)</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Decrypting A Value</h4>

<p>Of course, you may decrypt values using the <code>decrypt</code> method on the <code>Crypt</code> facade. If the value can not be properly decrypted, such as when the MAC is invalid, an <code>Illuminate\Contracts\Encryption\DecryptException</code> will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Encryption</span><span class="err">\</span><span class="nx">DecryptException</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">$decrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">$encryptedValue</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">DecryptException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Envoy Task Runner</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-tasks">Writing Tasks</a>

<ul>
<li><a href="#task-variables">Task Variables</a></li>
<li><a href="#envoy-multiple-servers">Multiple Servers</a></li>
<li><a href="#envoy-task-macros">Task Macros</a></li>
</ul></li>
<li><a href="#envoy-running-tasks">Running Tasks</a></li>
<li><a href="#envoy-notifications">Notifications</a>

<ul>
<li><a href="#hipchat">HipChat</a></li>
<li><a href="#slack">Slack</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="https://github.com/laravel/envoy">Laravel Envoy</a> provides a clean, minimal syntax for defining common tasks you run on your remote servers. Using a Blade style syntax, you can easily setup tasks for deployment, Artisan commands, and more. Currently, Envoy only supports the Mac and Linux operating systems.</p>

<p><a name="envoy-installation"></a></p>

<h3>Installation</h3>

<p>First, install Envoy using the Composer <code>global</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/envoy=~1.0&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>envoy</code> executable is found when you run the <code>envoy</code> command in your terminal.</p>

<h4>Updating Envoy</h4>

<p>You may also use Composer to keep your Envoy installation up to date:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">update</span>
</pre></div>

<p><a name="writing-tasks"></a></p>

<h2>Writing Tasks</h2>

<p>All of your Envoy tasks should be defined in an <code>Envoy.blade.php</code> file in the root of your project. Here&#39;s an example to get you started:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;user@192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>As you can see, an array of <code>@servers</code> is defined at the top of the file, allowing you to reference these servers in the <code>on</code> option of your task declarations. Within your <code>@task</code> declarations, you should place the Bash code that will be run on your server when the task is executed.</p>

<h4>Bootstrapping</h4>

<p>Sometimes, you may need to execute some PHP code before evaluating your Envoy tasks. You may use the <code>@setup</code> directive to declare variables and do general PHP work inside the Envoy file:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">setup</span>
    <span class="nx">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>

    <span class="nx">$environment</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$env</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$env</span> <span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">endsetup</span>
</pre></div>

<p>You may also use <code>@include</code> to include any outside PHP files:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">)</span>
</pre></div>

<h4>Confirming Tasks</h4>

<p>If you would like to be prompted for confirmation before running a given task on your servers, you may add the <code>confirm</code> directive to your task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;confirm&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="task-variables"></a></p>

<h3>Task Variables</h3>

<p>If needed, you may pass variables into the Envoy file using command line switches, allowing you to customize your tasks:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span> <span class="o">--</span><span class="nx">branch</span><span class="o">=</span><span class="nx">master</span>
</pre></div>

<p>You may use the options in your tasks via Blade&#39;s &quot;echo&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="envoy-multiple-servers"></a></p>

<h3>Multiple Servers</h3>

<p>You may easily run a task across multiple servers. First, add additional servers to your <code>@servers</code> declaration. Each server should be assigned a unique name. Once you have defined your additional servers, simply list the servers in the task declaration&#39;s <code>on</code> array:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">]])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>By default, the task will be executed on each server serially. Meaning, the task will finish running on the first server before proceeding to execute on the next server.</p>

<h4>Parallel Execution</h4>

<p>If you would like to run a task across multiple servers in parallel, add the <code>parallel</code> option to your task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">],</span> <span class="s1">&#39;parallel&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="envoy-task-macros"></a></p>

<h3>Task Macros</h3>

<p>Macros allow you to define a set of tasks to be run in sequence using a single command. For instance, a <code>deploy</code> macro may run the <code>git</code> and <code>composer</code> tasks:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
    <span class="nx">git</span>
    <span class="nx">composer</span>
<span class="err">@</span><span class="nx">endmacro</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;git&#39;</span><span class="p">)</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="nx">master</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;composer&#39;</span><span class="p">)</span>
    <span class="nx">composer</span> <span class="nx">install</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>Once the macro has been defined, you may run it via single, simple command:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span>
</pre></div>

<p><a name="envoy-running-tasks"></a></p>

<h2>Running Tasks</h2>

<p>To run a task from your <code>Envoy.blade.php</code> file, execute Envoy&#39;s <code>run</code> command, passing the command the name of the task or macro you would like to execute. Envoy will run the task and display the output from the servers as the task is running:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">task</span>
</pre></div>

<p><a name="envoy-notifications"></a>
<a name="envoy-hipchat-notifications"></a></p>

<h2>Notifications</h2>

<p><a name="hipchat"></a></p>

<h3>HipChat</h3>

<p>After running a task, you may send a notification to your team&#39;s HipChat room using Envoy&#39;s <code>@hipchat</code> directive. The directive accepts an API token, the name of the room, and the username to be displayed as the sender of the message:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>If you wish, you may also pass a custom message to send to the HipChat room. Any variables available to your Envoy tasks will also be available when constructing the message:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">,</span> <span class="s2">&quot;{{ $task }} ran in the {{ $env }} environment.&quot;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p><a name="slack"></a></p>

<h3>Slack</h3>

<p>In addition to HipChat, Envoy also supports sending notifications to <a href="https://slack.com">Slack</a>. The <code>@slack</code> directive accepts a Slack hook URL, a channel name, and the message you wish to send to the channel:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">slack</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>You may retrieve your webhook URL by creating an <code>Incoming WebHooks</code> integration on Slack&#39;s website. The <code>hook</code> argument should be the entire webhook URL provided by the Incoming Webhooks Slack Integration. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//hooks.slack.com/services/ZZZZZZZZZ/YYYYYYYYY/XXXXXXXXXXXXXXX</span>
</pre></div>

<p>You may provide one of the following as the channel argument:</p>

<ul>
<li>To send the notification to a channel: <code>#channel</code></li>
<li>To send the notification to a user: <code>@user</code></li>
</ul>
<div style="page-break-after: always;" ></div><h1>Errors &amp; Logging</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#the-exception-handler">The Exception Handler</a>

<ul>
<li><a href="#report-method">Report Method</a></li>
<li><a href="#render-method">Render Method</a></li>
</ul></li>
<li><a href="#http-exceptions">HTTP Exceptions</a>

<ul>
<li><a href="#custom-http-error-pages">Custom HTTP Error Pages</a></li>
</ul></li>
<li><a href="#logging">Logging</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When you start a new Laravel project, error and exception handling is already configured for you. In addition, Laravel is integrated with the <a href="https://github.com/Seldaek/monolog">Monolog</a> logging library, which provides support for a variety of powerful log handlers.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<h4>Error Detail</h4>

<p>The amount of error detail your application displays through the browser is controlled by the <code>debug</code> configuration option in your <code>config/app.php</code> configuration file. By default, this configuration option is set to respect the <code>APP_DEBUG</code> environment variable, which is stored in your <code>.env</code> file.</p>

<p>For local development, you should set the <code>APP_DEBUG</code> environment variable to <code>true</code>. In your production environment, this value should always be <code>false</code>.</p>

<h4>Log Modes</h4>

<p>Out of the box, Laravel supports <code>single</code>, <code>daily</code>, <code>syslog</code> and <code>errorlog</code> logging modes. For example, if you wish to use daily log files instead of a single file, you should simply set the <code>log</code> value in your <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;log&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;daily&#39;</span>
</pre></div>

<h4>Custom Monolog Configuration</h4>

<p>If you would like to have complete control over how Monolog is configured for your application, you may use the application&#39;s <code>configureMonologUsing</code> method. You should place a call to this method in your <code>bootstrap/app.php</code> file right before the <code>$app</code> variable is returned by the file:</p>
<div class="highlight"><pre><span></span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">configureMonologUsing</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$monolog</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$monolog</span><span class="o">-&gt;</span><span class="nx">pushHandler</span><span class="p">(...);</span>
<span class="p">});</span>

<span class="k">return</span> <span class="nx">$app</span><span class="p">;</span>
</pre></div>

<p><a name="the-exception-handler"></a></p>

<h2>The Exception Handler</h2>

<p>All exceptions are handled by the <code>App\Exceptions\Handler</code> class. This class contains two methods: <code>report</code> and <code>render</code>. We&#39;ll examine each of these methods in detail.</p>

<p><a name="report-method"></a></p>

<h3>The Report Method</h3>

<p>The <code>report</code> method is used to log exceptions or send them to an external service like <a href="https://bugsnag.com">BugSnag</a>. By default, the <code>report</code> method simply passes the exception to the base class where the exception is logged. However, you are free to log exceptions however you wish.</p>

<p>For example, if you need to report different types of exceptions in different ways, you may use the PHP <code>instanceof</code> comparison operator:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Report or log an exception.</span>
<span class="cm"> *</span>
<span class="cm"> * This is a great spot to send exceptions to Sentry, Bugsnag, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Exception  $e</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">report</span><span class="p">(</span><span class="nx">Exception</span> <span class="nx">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$e</span> <span class="k">instanceof</span> <span class="nx">CustomException</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">parent</span><span class="o">::</span><span class="nx">report</span><span class="p">(</span><span class="nx">$e</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Ignoring Exceptions By Type</h4>

<p>The <code>$dontReport</code> property of the exception handler contains an array of exception types that will not be logged. By default, exceptions resulting from 404 errors are not written to your log files. You may add other exception types to this array as needed.</p>

<p><a name="render-method"></a></p>

<h3>The Render Method</h3>

<p>The <code>render</code> method is responsible for converting a given exception into an HTTP response that should be sent back to the browser. By default, the exception is passed to the base class which generates a response for you. However, you are free to check the exception type or return your own custom response:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Render an exception into an HTTP response.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @param  \Exception  $e</span>
<span class="cm"> * @return \Illuminate\Http\Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nx">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$e</span> <span class="k">instanceof</span> <span class="nx">CustomException</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;errors.custom&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">parent</span><span class="o">::</span><span class="nx">render</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">$e</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="http-exceptions"></a></p>

<h2>HTTP Exceptions</h2>

<p>Some exceptions describe HTTP error codes from the server. For example, this may be a &quot;page not found&quot; error (404), an &quot;unauthorized error&quot; (401) or even a developer generated 500 error. In order to generate such a response from anywhere in your application, use the following:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>The <code>abort</code> method will immediately raise an exception which will be rendered by the exception handler. Optionally, you may provide the response text:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
</pre></div>

<p>This method may be used at any time during the request&#39;s lifecycle.</p>

<p><a name="custom-http-error-pages"></a></p>

<h3>Custom HTTP Error Pages</h3>

<p>Laravel makes it easy to return custom error pages for various HTTP status codes. For example, if you wish to customize the error page for 404 HTTP status codes, create a <code>resources/views/errors/404.blade.php</code>. This file will be served on all 404 errors generated by your application.</p>

<p>The views within this directory should be named to match the HTTP status code they correspond to.</p>

<p><a name="logging"></a></p>

<h2>Logging</h2>

<p>The Laravel logging facilities provide a simple layer on top of the powerful <a href="http://github.com/seldaek/monolog">Monolog</a> library. By default, Laravel is configured to create daily log files for your application which are stored in the <code>storage/logs</code> directory. You may write information to the logs using the <code>Log</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Log</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Showing user profile for user: &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The logger provides the eight logging levels defined in <a href="http://tools.ietf.org/html/rfc5424">RFC 5424</a>: <strong>emergency</strong>, <strong>alert</strong>, <strong>critical</strong>, <strong>error</strong>, <strong>warning</strong>, <strong>notice</strong>, <strong>info</strong> and <strong>debug</strong>.</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">emergency</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">alert</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">critical</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">warning</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">notice</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">debug</span><span class="p">(</span><span class="nx">$error</span><span class="p">);</span>
</pre></div>

<h4>Contextual Information</h4>

<p>An array of contextual data may also be passed to the log methods. This contextual data will be formatted and displayed with the log message:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;User failed to login.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">]);</span>
</pre></div>

<h4>Accessing The Underlying Monolog Instance</h4>

<p>Monolog has a variety of additional handlers you may use for logging. If needed, you may access the underlying Monolog instance being used by Laravel:</p>
<div class="highlight"><pre><span></span><span class="nx">$monolog</span> <span class="o">=</span> <span class="nx">Log</span><span class="o">::</span><span class="nx">getMonolog</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Events</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#registering-events-and-listeners">Registering Events / Listeners</a></li>
<li><a href="#defining-events">Defining Events</a></li>
<li><a href="#defining-listeners">Defining Listeners</a>

<ul>
<li><a href="#queued-event-listeners">Queued Event Listeners</a></li>
</ul></li>
<li><a href="#firing-events">Firing Events</a></li>
<li><a href="#broadcasting-events">Broadcasting Events</a>

<ul>
<li><a href="#broadcast-configuration">Configuration</a></li>
<li><a href="#marking-events-for-broadcast">Marking Events For Broadcast</a></li>
<li><a href="#broadcast-data">Broadcast Data</a></li>
<li><a href="#consuming-event-broadcasts">Consuming Event Broadcasts</a></li>
</ul></li>
<li><a href="#event-subscribers">Event Subscribers</a></li>
<li><a href="#framework-events">Framework Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s events provides a simple observer implementation, allowing you to subscribe and listen for events in your application. Event classes are typically stored in the <code>app/Events</code> directory, while their listeners are stored in <code>app/Listeners</code>.</p>

<p><a name="registering-events-and-listeners"></a></p>

<h2>Registering Events / Listeners</h2>

<p>The <code>EventServiceProvider</code> included with your Laravel application provides a convenient place to register all event listeners. The <code>listen</code> property contains an array of all events (keys) and their listeners (values). Of course, you may add as many events to this array as your application requires. For example, let&#39;s add our <code>PodcastWasPurchased</code> event:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;App\Events\PodcastWasPurchased&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\EmailPurchaseConfirmation&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<h3>Generating Event / Listener Classes</h3>

<p>Of course, manually creating the files for each event and listener is cumbersome. Instead, simply add listeners and events to your <code>EventServiceProvider</code> and use the <code>event:generate</code> command. This command will generate any events or listeners that are listed in your <code>EventServiceProvider</code>. Of course, events and listeners that already exist will be left untouched:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">event</span><span class="o">:</span><span class="nx">generate</span>
</pre></div>

<h3>Registering Events Manually</h3>

<p>Typically, events should be registered via the <code>EventServiceProvider</code> <code>$listen</code> array; however, you may also register events manually with the event dispatcher using either the <code>Event</code> facade or the <code>Illuminate\Contracts\Events\Dispatcher</code> contract implementation:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Contracts\Events\Dispatcher  $events</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">DispatcherContract</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$events</span><span class="p">);</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;event.name&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$foo</span><span class="p">,</span> <span class="nx">$bar</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h4>Wildcard Event Listeners</h4>

<p>You may even register listeners using the <code>*</code> as a wildcard, allowing you to catch multiple events on the same listener. Wildcard listeners receive the entire event data array as a single argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;event.*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="defining-events"></a></p>

<h2>Defining Events</h2>

<p>An event class is simply a data container which holds the information related to the event. For example, let&#39;s assume our generated <code>PodcastWasPurchased</code> event receives an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a> object:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastWasPurchased</span> <span class="k">extends</span> <span class="nx">Event</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$podcast</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Podcast  $podcast</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nv">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span> <span class="o">=</span> <span class="nv">$podcast</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, this event class contains no special logic. It is simply a container for the <code>Podcast</code> object that was purchased. The <code>SerializesModels</code> trait used by the event will gracefully serialize any Eloquent models if the event object is serialized using PHP&#39;s <code>serialize</code> function.</p>

<p><a name="defining-listeners"></a></p>

<h2>Defining Listeners</h2>

<p>Next, let&#39;s take a look at the listener for our example event. Event listeners receive the event instance in their <code>handle</code> method. The <code>event:generate</code> command will automatically import the proper event class and type-hint the event on the <code>handle</code> method. Within the <code>handle</code> method, you may perform any logic necessary to respond to the event.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\PodcastWasPurchased</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmailPurchaseConfirmation</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create the event listener.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  PodcastWasPurchased  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">PodcastWasPurchased</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Access the podcast using $event-&gt;podcast...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Your event listeners may also type-hint any dependencies they need on their constructors. All event listeners are resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so dependencies will be injected automatically:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Mail</span><span class="err">\</span><span class="nx">Mailer</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nx">$mailer</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mailer</span> <span class="o">=</span> <span class="nx">$mailer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Stopping The Propagation Of An Event</h4>

<p>Sometimes, you may wish to stop the propagation of an event to other listeners. You may do so by returning <code>false</code> from your listener&#39;s <code>handle</code> method.</p>

<p><a name="queued-event-listeners"></a></p>

<h3>Queued Event Listeners</h3>

<p>Need to <a href="/docs/%7B%7Bversion%7D%7D/queues">queue</a> an event listener? It couldn&#39;t be any easier. Simply add the <code>ShouldQueue</code> interface to the listener class. Listeners generated by the <code>event:generate</code> Artisan command already have this interface imported into the current namespace, so you can use it immediately:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\PodcastWasPurchased</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmailPurchaseConfirmation</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>That&#39;s it! Now, when this listener is called for an event, it will be queued automatically by the event dispatcher using Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/queues">queue system</a>. If no exceptions are thrown when the listener is executed by the queue, the queued job will automatically be deleted after it has processed.</p>

<h4>Manually Accessing The Queue</h4>

<p>If you need to access the underlying queue job&#39;s <code>delete</code> and <code>release</code> methods manually, you may do so. The <code>Illuminate\Queue\InteractsWithQueue</code> trait, which is imported by default on generated listeners, gives you access to these methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\PodcastWasPurchased</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmailPurchaseConfirmation</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">PodcastWasPurchased</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">release</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="firing-events"></a></p>

<h2>Firing Events</h2>

<p>To fire an event, you may use the <code>Event</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>, passing an instance of the event to the <code>fire</code> method. The <code>fire</code> method will dispatch the event to all of its registered listeners:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\PodcastWasPurchased</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $userId</span>
<span class="sd">     * @param  int  $podcastId</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">purchasePodcast</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$podcastId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$podcast</span> <span class="o">=</span> <span class="nx">Podcast</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$podcastId</span><span class="p">);</span>

        <span class="c1">// Purchase podcast logic...</span>

        <span class="nx">Event</span><span class="o">::</span><span class="na">fire</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, you may use the global <code>event</code> helper function to fire events:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p><a name="broadcasting-events"></a></p>

<h2>Broadcasting Events</h2>

<p>In many modern web applications, web sockets are used to implement real-time, live-updating user interfaces. When some data is updated on the server, a message is typically sent over a websocket connection to be handled by the client.</p>

<p>To assist you in building these types of applications, Laravel makes it easy to &quot;broadcast&quot; your events over a websocket connection. Broadcasting your Laravel events allows you to share the same event names between your server-side code and your client-side JavaScript framework.</p>

<p><a name="broadcast-configuration"></a></p>

<h3>Configuration</h3>

<p>All of the event broadcasting configuration options are stored in the <code>config/broadcasting.php</code> configuration file. Laravel supports several broadcast drivers out of the box: <a href="https://pusher.com">Pusher</a>, <a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a>, and a <code>log</code> driver for local development and debugging. A configuration example is included for each of these drivers.</p>

<h4>Broadcast Prerequisites</h4>

<p>The following dependencies are needed for event broadcasting:</p>

<ul>
<li>Pusher: <code>pusher/pusher-php-server ~2.0</code></li>
<li>Redis: <code>predis/predis ~1.0</code></li>
</ul>

<h4>Queue Prerequisites</h4>

<p>Before broadcasting events, you will also need to configure and run a <a href="/docs/%7B%7Bversion%7D%7D/queues">queue listener</a>. All event broadcasting is done via queued jobs so that the response time of your application is not seriously affected.</p>

<p><a name="marking-events-for-broadcast"></a></p>

<h3>Marking Events For Broadcast</h3>

<p>To inform Laravel that a given event should be broadcast, implement the <code>Illuminate\Contracts\Broadcasting\ShouldBroadcast</code> interface on the event class. The <code>ShouldBroadcast</code> interface requires you to implement a single method: <code>broadcastOn</code>. The <code>broadcastOn</code> method should return an array of &quot;channel&quot; names that the event should be broadcast on:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServerCreated</span> <span class="k">extends</span> <span class="nx">Event</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the channels the event should be broadcast on.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;user.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Then, you only need to <a href="#firing-events">fire the event</a> as you normally would. Once the event has been fired, a <a href="/docs/%7B%7Bversion%7D%7D/queues">queued job</a> will automatically broadcast the event over your specified broadcast driver.</p>

<p><a name="overriding-broadcast-event-name"></a></p>

<h4>Overriding Broadcast Event Name</h4>

<p>By default, the broadcast event name will be the fully qualified class name of the event. Using the example class above, the broadcast event would be <code>App\Events\ServerCreated</code>. You can customize this broadcast event name to whatever you want using the <code>broadcastAs</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the broadcast event name.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastAs</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;app.server-created&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="broadcast-data"></a></p>

<h3>Broadcast Data</h3>

<p>When an event is broadcast, all of its <code>public</code> properties are automatically serialized and broadcast as the event&#39;s payload, allowing you to access any of its public data from your JavaScript application. So, for example, if your event has a single public <code>$user</code> property that contains an Eloquent model, the broadcast payload would be:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Jonathan Banks&quot;</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>However, if you wish to have even more fine-grained control over your broadcast payload, you may add a <code>broadcastWith</code> method to your event. This method should return the array of data that you wish to broadcast with the event:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the data to broadcast.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastWith</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="consuming-event-broadcasts"></a></p>

<h3>Consuming Event Broadcasts</h3>

<h4>Pusher</h4>

<p>You may conveniently consume events broadcast using the <a href="https://pusher.com">Pusher</a> driver using Pusher&#39;s JavaScript SDK. For example, let&#39;s consume the <code>App\Events\ServerCreated</code> event from our previous examples:</p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">pusher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pusher</span><span class="p">(</span><span class="s1">&#39;pusher-key&#39;</span><span class="p">);</span>

<span class="k">this</span><span class="p">.</span><span class="nx">pusherChannel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pusher</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;user.&#39;</span> <span class="o">+</span> <span class="nx">USER_ID</span><span class="p">);</span>

<span class="k">this</span><span class="p">.</span><span class="nx">pusherChannel</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;App\\Events\\ServerCreated&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Redis</h4>

<p>If you are using the Redis broadcaster, you will need to write your own Redis pub/sub consumer to receive the messages and broadcast them using the websocket technology of your choice. For example, you may choose to use the popular <a href="http://socket.io">Socket.io</a> library which is written in Node.</p>

<p>Using the <code>socket.io</code> and <code>ioredis</code> Node libraries, you can quickly write an event broadcaster to publish all events that are broadcast by your Laravel application:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">).</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">)(</span><span class="nx">app</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">Redis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ioredis&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">redis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Redis</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is running!&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">redis</span><span class="p">.</span><span class="nx">psubscribe</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">redis</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;pmessage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subscribed</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">message</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">channel</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="event-subscribers"></a></p>

<h2>Event Subscribers</h2>

<p>Event subscribers are classes that may subscribe to multiple events from within the class itself, allowing you to define several event handlers within a single class. Subscribers should define a <code>subscribe</code> method, which will be passed an event dispatcher instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserEventListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle user login events.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onUserLogin</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle user logout events.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onUserLogout</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the listeners for the subscriber.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Illuminate\Events\Dispatcher  $events</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">subscribe</span><span class="p">(</span><span class="nv">$events</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="s1">&#39;App\Events\UserLoggedIn&#39;</span><span class="p">,</span>
            <span class="s1">&#39;App\Listeners\UserEventListener@onUserLogin&#39;</span>
        <span class="p">);</span>

        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="s1">&#39;App\Events\UserLoggedOut&#39;</span><span class="p">,</span>
            <span class="s1">&#39;App\Listeners\UserEventListener@onUserLogout&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Registering An Event Subscriber</h4>

<p>Once the subscriber has been defined, it may be registered with the event dispatcher. You may register subscribers using the <code>$subscribe</code> property on the <code>EventServiceProvider</code>. For example, let&#39;s add the <code>UserEventListener</code>.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Events\Dispatcher</span> <span class="k">as</span> <span class="nx">DispatcherContract</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\EventServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The event listener mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">//</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * The subscriber classes to register.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$subscribe</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\UserEventListener&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="framework-events"></a></p>

<h2>Framework Events</h2>

<p>Laravel provides a variety of &quot;core&quot; events for actions performed by the framework. You can subscribe to them in the same way that you subscribe to your own custom events:</p>

<p>Event  |  Parameter(s)
------------- | -----------
artisan.start | $application
auth.attempt | $credentials, $remember, $login
auth.login | $user, $remember
auth.logout | $user
cache.missed | $key
cache.hit | $key, $value
cache.write | $key, $value, $minutes
cache.delete | $key
connection.{name}.beganTransaction | $connection
connection.{name}.committed | $connection
connection.{name}.rollingBack | $connection
illuminate.query | $query, $bindings, $time, $connectionName
illuminate.queue.after | $connection, $job, $data
illuminate.queue.failed | $connection, $job, $data
illuminate.queue.stopping | null
mailer.sending | $message
router.matched | $route, $request
composing:{view name} | $view
creating:{view name} | $view</p>
<div style="page-break-after: always;" ></div><h1>Facades</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#using-facades">Using Facades</a></li>
<li><a href="#facade-class-reference">Facade Class Reference</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Facades provide a &quot;static&quot; interface to classes that are available in the application&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. Laravel ships with many facades, and you have probably been using them without even knowing it! Laravel &quot;facades&quot; serve as &quot;static proxies&quot; to underlying classes in the service container, providing the benefit of a terse, expressive syntax while maintaining more testability and flexibility than traditional static methods.</p>

<p><a name="using-facades"></a></p>

<h2>Using Facades</h2>

<p>In the context of a Laravel application, a facade is a class that provides access to an object from the container. The machinery that makes this work is in the <code>Facade</code> class. Laravel&#39;s facades, and any custom facades you create, will extend the base <code>Illuminate\Support\Facades\Facade</code> class.</p>

<p>A facade class only needs to implement a single method: <code>getFacadeAccessor</code>. It&#39;s the <code>getFacadeAccessor</code> method&#39;s job to define what to resolve from the container. The <code>Facade</code> base class makes use of the <code>__callStatic()</code> magic-method to defer calls from your facade to the resolved object.</p>

<p>In the example below, a call is made to the Laravel cache system. By glancing at this code, one might assume that the static method <code>get</code> is being called on the <code>Cache</code> class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Notice that near the top of the file we are &quot;importing&quot; the <code>Cache</code> facade. This facade serves as a proxy to accessing the underlying implementation of the <code>Illuminate\Contracts\Cache\Factory</code> interface. Any calls we make using the facade will be passed to the underlying instance of Laravel&#39;s cache service.</p>

<p>If we look at that <code>Illuminate\Support\Facades\Cache</code> class, you&#39;ll see that there is no static method <code>get</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Cache</span> <span class="kr">extends</span> <span class="nx">Facade</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Get the registered name of the component.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;cache&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Instead, the <code>Cache</code> facade extends the base <code>Facade</code> class and defines the method <code>getFacadeAccessor()</code>. Remember, this method&#39;s job is to return the name of a service container binding. When a user references any static method on the <code>Cache</code> facade, Laravel resolves the <code>cache</code> binding from the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and runs the requested method (in this case, <code>get</code>) against that object.</p>

<p><a name="facade-class-reference"></a></p>

<h2>Facade Class Reference</h2>

<p>Below you will find every facade and its underlying class. This is a useful tool for quickly digging into the API documentation for a given facade root. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container binding</a> key is also included where applicable.</p>

<p>Facade  |  Class  |  Service Container Binding
------------- | ------------- | -------------
App  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a>  | <code>app</code>
Artisan  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Console/Kernel.html">Illuminate\Contracts\Console\Kernel</a>  |  <code>artisan</code>
Auth  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a>  |  <code>auth</code>
Auth (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Guard.html">Illuminate\Auth\Guard</a>  |
Blade  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a>  |  <code>blade.compiler</code>
Bus  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a>  |
Cache  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a>  |  <code>cache</code>
Config  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a>  |  <code>config</code>
Cookie  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a>  |  <code>cookie</code>
Crypt  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a>  |  <code>encrypter</code>
DB  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a>  |  <code>db</code>
DB (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a>  |
Event  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a>  |  <code>events</code>
File  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a>  |  <code>files</code>
Gate  |  <a href="http://laravel.com/api/5.1/Illuminate/Contracts/Auth/Access/Gate.html">Illuminate\Contracts\Auth\Access\Gate</a>  |
Hash  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a>  |  <code>hash</code>
Input  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Lang  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a>  |  <code>translator</code>
Log  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Log/Writer.html">Illuminate\Log\Writer</a>  |  <code>log</code>
Mail  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a>  |  <code>mailer</code>
Password  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a>  |  <code>auth.password</code>
Queue  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a>  |  <code>queue</code>
Queue (Instance) |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/QueueInterface.html">Illuminate\Queue\QueueInterface</a>  |
Queue (Base Class) |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a>  |
Redirect  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a>  |  <code>redirect</code>
Redis  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Redis/Database.html">Illuminate\Redis\Database</a>  |  <code>redis</code>
Request  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Response  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a>  |
Route  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a>  |  <code>router</code>
Schema  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Schema/Blueprint.html">Illuminate\Database\Schema\Blueprint</a>  |
Session  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a>  |  <code>session</code>
Session (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/Store.html">Illuminate\Session\Store</a>  |
Storage  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Filesystem/Factory.html">Illuminate\Contracts\Filesystem\Factory</a>  |  <code>filesystem</code>
URL  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a>  |  <code>url</code>
Validator  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a>  |  <code>validator</code>
Validator (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a> |
View  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Factory.html">Illuminate\View\Factory</a>  |  <code>view</code>
View (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/View.html">Illuminate\View\View</a>  |</p>
<div style="page-break-after: always;" ></div><h1>Filesystem / Cloud Storage</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#obtaining-disk-instances">Obtaining Disk Instances</a></li>
<li><a href="#retrieving-files">Retrieving Files</a></li>
<li><a href="#storing-files">Storing Files</a></li>
<li><a href="#deleting-files">Deleting Files</a></li>
<li><a href="#directories">Directories</a></li>
</ul></li>
<li><a href="#custom-filesystems">Custom Filesystems</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a powerful filesystem abstraction thanks to the wonderful <a href="https://github.com/thephpleague/flysystem">Flysystem</a> PHP package by Frank de Jonge. The Laravel Flysystem integration provides simple to use drivers for working with local filesystems, Amazon S3, and Rackspace Cloud Storage. Even better, it&#39;s amazingly simple to switch between these storage options as the API remains the same for each system.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The filesystem configuration file is located at <code>config/filesystems.php</code>. Within this file you may configure all of your &quot;disks&quot;. Each disk represents a particular storage driver and storage location. Example configurations for each supported driver is included in the configuration file. So, simply modify the configuration to reflect your storage preferences and credentials.</p>

<p>Of course, you may configure as many disks as you like, and may even have multiple disks that use the same driver.</p>

<h4>The Local Driver</h4>

<p>When using the <code>local</code> driver, note that all file operations are relative to the <code>root</code> directory defined in your configuration file. By default, this value is set to the <code>storage/app</code> directory. Therefore, the following method would store a file in <code>storage/app/file.txt</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;Contents&#39;</span><span class="p">);</span>
</pre></div>

<h4>Other Driver Prerequisites</h4>

<p>Before using the S3 or Rackspace drivers, you will need to install the appropriate package via Composer:</p>

<ul>
<li>Amazon S3: <code>league/flysystem-aws-s3-v3 ~1.0</code></li>
<li>Rackspace: <code>league/flysystem-rackspace ~1.0</code></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p><a name="obtaining-disk-instances"></a></p>

<h3>Obtaining Disk Instances</h3>

<p>The <code>Storage</code> facade may be used to interact with any of your configured disks. For example, you may use the <code>put</code> method on the facade to store an avatar on the default disk. If you call methods on the <code>Storage</code> facade without first calling the <code>disk</code> method, the method call will automatically be passed to the default disk:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the avatar for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateAvatar</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nx">Storage</span><span class="o">::</span><span class="na">put</span><span class="p">(</span>
            <span class="s1">&#39;avatars/&#39;</span><span class="o">.</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getRealPath</span><span class="p">())</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When using multiple disks, you may access a particular disk using the <code>disk</code> method on the <code>Storage</code> facade. Of course, you may continue to chain methods to execute methods on the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">$disk</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">);</span>

<span class="nx">$contents</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="retrieving-files"></a></p>

<h3>Retrieving Files</h3>

<p>The <code>get</code> method may be used to retrieve the contents of a given file. The raw string contents of the file will be returned by the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$contents</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>has</code> method may be used to determine if a given file exists on the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">$exists</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>File Meta Information</h4>

<p>The <code>size</code> method may be used to get the size of the file in bytes:</p>
<div class="highlight"><pre><span></span><span class="nx">$size</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">size</span><span class="p">(</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>lastModified</code> method returns the UNIX timestamp of the last time the file was modified:</p>
<div class="highlight"><pre><span></span><span class="nx">$time</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">lastModified</span><span class="p">(</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="storing-files"></a></p>

<h3>Storing Files</h3>

<p>The <code>put</code> method may be used to store a file on disk. You may also pass a PHP <code>resource</code> to the <code>put</code> method, which will use Flysystem&#39;s underlying stream support. Using streams is greatly recommended when dealing with large files:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$contents</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$resource</span><span class="p">);</span>
</pre></div>

<p>The <code>copy</code> method may be used to copy an existing file to a new location on the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;old/file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>move</code> method may be used to rename or move an existing file to a new location:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">move</span><span class="p">(</span><span class="s1">&#39;old/file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Prepending / Appending To Files</h4>

<p>The <code>prepend</code> and <code>append</code> methods allow you to easily insert content at the beginning or end of a file:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Prepended Text&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Appended Text&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="deleting-files"></a></p>

<h3>Deleting Files</h3>

<p>The <code>delete</code> method accepts a single filename or an array of files to remove from the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">([</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;file2.jpg&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="directories"></a></p>

<h3>Directories</h3>

<h4>Get All Files Within A Directory</h4>

<p>The <code>files</code> method returns an array of all of the files in a given directory. If you would like to retrieve a list of all files within a given directory including all sub-directories, you may use the <code>allFiles</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">files</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allFiles</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Get All Directories Within A Directory</h4>

<p>The <code>directories</code> method returns an array of all the directories within a given directory. Additionally, you may use the <code>allDirectories</code> method to get a list of all directories within a given directory and all of its sub-directories:</p>
<div class="highlight"><pre><span></span><span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">directories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="c1">// Recursive...</span>
<span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allDirectories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Create A Directory</h4>

<p>The <code>makeDirectory</code> method will create the given directory, including any needed sub-directories:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">makeDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Delete A Directory</h4>

<p>Finally, the <code>deleteDirectory</code> may be used to remove a directory, including all of its files, from the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">deleteDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<p><a name="custom-filesystems"></a></p>

<h2>Custom Filesystems</h2>

<p>Laravel&#39;s Flysystem integration provides drivers for several &quot;drivers&quot; out of the box; however, Flysystem is not limited to these and has adapters for many other storage systems. You can create a custom driver if you want to use one of these additional adapters in your Laravel application.</p>

<p>In order to set up the custom filesystem you will need to create a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> such as <code>DropboxServiceProvider</code>. In the provider&#39;s <code>boot</code> method, you may use the <code>Storage</code> facade&#39;s <code>extend</code> method to define the custom driver:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">League\Flysystem\Filesystem</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Dropbox\Client</span> <span class="k">as</span> <span class="nx">DropboxClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">League\Flysystem\Dropbox\DropboxAdapter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DropboxServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;dropbox&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DropboxClient</span><span class="p">(</span>
                <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;accessToken&#39;</span><span class="p">],</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;clientIdentifier&#39;</span><span class="p">]</span>
            <span class="p">);</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">Filesystem</span><span class="p">(</span><span class="k">new</span> <span class="nx">DropboxAdapter</span><span class="p">(</span><span class="nv">$client</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument of the <code>extend</code> method is the name of the driver and the second is a Closure that receives the <code>$app</code> and <code>$config</code> variables. The resolver Closure must return an instance of <code>League\Flysystem\Filesystem</code>. The <code>$config</code> variable contains the values defined in <code>config/filesystems.php</code> for the specified disk.</p>

<p>Once you have created the service provider to register the extension, you may use the <code>dropbox</code> driver in your <code>config/filesystem.php</code> configuration file.</p>
<div style="page-break-after: always;" ></div><h1>Hashing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Hash</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> provides secure Bcrypt hashing for storing user passwords. If you are using the <code>AuthController</code> controller that is included with your Laravel application, it will automatically use Bcrypt for registration and authentication.</p>

<p>Bcrypt is a great choice for hashing passwords because its &quot;work factor&quot; is adjustable, which means that the time it takes to generate a hash can be increased as hardware power increases.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>You may hash a password by calling the <code>make</code> method on the <code>Hash</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Hash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the password for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updatePassword</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="c1">// Validate the new password length...</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">newPassword</span><span class="p">)</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, you may also use the global <code>bcrypt</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;plain-text&#39;</span><span class="p">);</span>
</pre></div>

<h4>Verifying A Password Against A Hash</h4>

<p>The <code>check</code> method allows you to verify that a given plain-text string corresponds to a given hash. However, if you are using the <code>AuthController</code> <a href="/docs/%7B%7Bversion%7D%7D/authentication">included with Laravel</a>, you will probably not need to use this directly, as the included authentication controller automatically calls this method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;plain-text&#39;</span><span class="p">,</span> <span class="nx">$hashedPassword</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The passwords match...</span>
<span class="p">}</span>
</pre></div>

<h4>Checking If A Password Needs To Be Rehashed</h4>

<p>The <code>needsRehash</code> function allows you to determine if the work factor used by the hasher has changed since the password was hashed:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">needsRehash</span><span class="p">(</span><span class="nx">$hashed</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;plain-text&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Helper Functions</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#available-methods">Available Methods</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel includes a variety of &quot;helper&quot; PHP functions. Many of these functions are used by the framework itself; however, you are free to use them in your own applications if you find them convenient.</p>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<style>
    .collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    .collection-method-list a {
        display: block;
    }
</style>

<h3>Arrays</h3>

<div class="collection-method-list" markdown="1">
[array_add](#method-array-add)
[array_collapse](#method-array-collapse)
[array_divide](#method-array-divide)
[array_dot](#method-array-dot)
[array_except](#method-array-except)
[array_first](#method-array-first)
[array_flatten](#method-array-flatten)
[array_forget](#method-array-forget)
[array_get](#method-array-get)
[array_has](#method-array-has)
[array_only](#method-array-only)
[array_pluck](#method-array-pluck)
[array_pull](#method-array-pull)
[array_set](#method-array-set)
[array_sort](#method-array-sort)
[array_sort_recursive](#method-array-sort-recursive)
[array_where](#method-array-where)
[head](#method-head)
[last](#method-last)
</div>

<h3>Paths</h3>

<div class="collection-method-list" markdown="1">
[app_path](#method-app-path)
[base_path](#method-base-path)
[config_path](#method-config-path)
[database_path](#method-database-path)
[elixir](#method-elixir)
[public_path](#method-public-path)
[storage_path](#method-storage-path)
</div>

<h3>Strings</h3>

<div class="collection-method-list" markdown="1">
[camel_case](#method-camel-case)
[class_basename](#method-class-basename)
[e](#method-e)
[ends_with](#method-ends-with)
[snake_case](#method-snake-case)
[str_limit](#method-str-limit)
[starts_with](#method-starts-with)
[str_contains](#method-str-contains)
[str_finish](#method-str-finish)
[str_is](#method-str-is)
[str_plural](#method-str-plural)
[str_random](#method-str-random)
[str_singular](#method-str-singular)
[str_slug](#method-str-slug)
[studly_case](#method-studly-case)
[trans](#method-trans)
[trans_choice](#method-trans-choice)
</div>

<h3>URLs</h3>

<div class="collection-method-list" markdown="1">
[action](#method-action)
[asset](#method-asset)
[secure_asset](#method-secure-asset)
[route](#method-route)
[url](#method-url)
</div>

<h3>Miscellaneous</h3>

<div class="collection-method-list" markdown="1">
[auth](#method-auth)
[back](#method-back)
[bcrypt](#method-bcrypt)
[collect](#method-collect)
[config](#method-config)
[csrf_field](#method-csrf-field)
[csrf_token](#method-csrf-token)
[dd](#method-dd)
[env](#method-env)
[event](#method-event)
[factory](#method-factory)
[method_field](#method-method-field)
[old](#method-old)
[redirect](#method-redirect)
[request](#method-request)
[response](#method-response)
[session](#method-session)
[value](#method-value)
[view](#method-view)
[with](#method-with)
</div>

<p><a name="method-listing"></a></p>

<h2>Method Listing</h2>

<style>
    #collection-method code {
        font-size: 14px;
    }

    #collection-method:not(.first-collection-method) {
        margin-top: 50px;
    }
</style>

<p><a name="arrays"></a></p>

<h2>Arrays</h2>

<p><a name="method-array-add"></a></p>

<h4><code>array_add()</code> {#collection-method .first-collection-method}</h4>

<p>The <code>array_add</code> function adds a given key / value pair to the array if the given key doesn&#39;t already exist in the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_add</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-collapse"></a></p>

<h4><code>array_collapse()</code> {#collection-method}</h4>

<p>The <code>array_collapse</code> function collapse an array of arrays into a single array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_collapse</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]);</span>

<span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</pre></div>

<p><a name="method-array-divide"></a></p>

<h4><code>array_divide()</code> {#collection-method}</h4>

<p>The <code>array_divide</code> function returns two arrays, one containing the keys, and the other containing the values of the original array:</p>
<div class="highlight"><pre><span></span><span class="nx">list</span><span class="p">(</span><span class="nx">$keys</span><span class="p">,</span> <span class="nx">$values</span><span class="p">)</span> <span class="o">=</span> <span class="nx">array_divide</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="c1">// $keys: [&#39;name&#39;]</span>

<span class="c1">// $values: [&#39;Desk&#39;]</span>
</pre></div>

<p><a name="method-array-dot"></a></p>

<h4><code>array_dot()</code> {#collection-method}</h4>

<p>The <code>array_dot</code> function flattens a multi-dimensional array into a single level array that uses &quot;dot&quot; notation to indicate depth:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_dot</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">]]);</span>

<span class="c1">// [&#39;foo.bar&#39; =&gt; &#39;baz&#39;];</span>
</pre></div>

<p><a name="method-array-except"></a></p>

<h4><code>array_except()</code> {#collection-method}</h4>

<p>The <code>array_except</code> function removes the given key / value pairs from the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_except</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;]</span>
</pre></div>

<p><a name="method-array-first"></a></p>

<h4><code>array_first()</code> {#collection-method}</h4>

<p>The <code>array_first</code> function returns the first element of an array passing a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 200</span>
</pre></div>

<p>A default value may also be passed as the third parameter to the method. This value will be returned if no value passes the truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p><a name="method-array-flatten"></a></p>

<h4><code>array_flatten()</code> {#collection-method}</h4>

<p>The <code>array_flatten</code> function will flatten a multi-dimensional array into a single level.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">]];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_flatten</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;Joe&#39;, &#39;PHP&#39;, &#39;Ruby&#39;];</span>
</pre></div>

<p><a name="method-array-forget"></a></p>

<h4><code>array_forget()</code> {#collection-method}</h4>

<p>The <code>array_forget</code> function removes a given key / value pair from a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">array_forget</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; []]</span>
</pre></div>

<p><a name="method-array-get"></a></p>

<h4><code>array_get()</code> {#collection-method}</h4>

<p>The <code>array_get</code> function retrieves a value from a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;price&#39; =&gt; 100]</span>
</pre></div>

<p>The <code>array_get</code> function also accepts a default value, which will be returned if the specific key is not found:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.john&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-array-has"></a></p>

<h4><code>array_has()</code> {#collection-method}</h4>

<p>The <code>array_has</code> function checks that a given item exists in an array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">$hasDesk</span> <span class="o">=</span> <span class="nx">array_has</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-array-only"></a></p>

<h4><code>array_only()</code> {#collection-method}</h4>

<p>The <code>array_only</code> function will return only the specified key / value pairs from the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;orders&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_only</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-pluck"></a></p>

<h4><code>array_pluck()</code> {#collection-method}</h4>

<p>The <code>array_pluck</code> function will pluck a list of the given key / value pairs from the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">]],</span>
<span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;Taylor&#39;, &#39;Abigail&#39;];</span>
</pre></div>

<p>You may also specify how you wish the resulting list to be keyed:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">,</span> <span class="s1">&#39;developer.id&#39;</span><span class="p">);</span>

<span class="c1">// [1 =&gt; &#39;Taylor&#39;, 2 =&gt; &#39;Abigail&#39;];</span>
</pre></div>

<p><a name="method-array-pull"></a></p>

<h4><code>array_pull()</code> {#collection-method}</h4>

<p>The <code>array_pull</code> function returns and removes a key / value pair from the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">array_pull</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// $name: Desk</span>

<span class="c1">// $array: [&#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-set"></a></p>

<h4><code>array_set()</code> {#collection-method}</h4>

<p>The <code>array_set</code> function sets a value within a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">array_set</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 200]]]</span>
</pre></div>

<p><a name="method-array-sort"></a></p>

<h4><code>array_sort()</code> {#collection-method}</h4>

<p>The <code>array_sort</code> function sorts the array by the results of the given Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">array_sort</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}));</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-array-sort-recursive"></a></p>

<h4><code>array_sort_recursive()</code> {#collection-method}</h4>

<p>The <code>array_sort_recursive</code> function recursively sorts the array using the <code>sort</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;Roman&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Li&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;PHP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Ruby&#39;</span><span class="p">,</span>
        <span class="s1">&#39;JavaScript&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_sort_recursive</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [</span>
<span class="cm">            &#39;Li&#39;,</span>
<span class="cm">            &#39;Roman&#39;,</span>
<span class="cm">            &#39;Taylor&#39;,</span>
<span class="cm">        ],</span>
<span class="cm">        [</span>
<span class="cm">            &#39;JavaScript&#39;,</span>
<span class="cm">            &#39;PHP&#39;,</span>
<span class="cm">            &#39;Ruby&#39;,</span>
<span class="cm">        ]</span>
<span class="cm">    ];</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-array-where"></a></p>

<h4><code>array_where()</code> {#collection-method}</h4>

<p>The <code>array_where</code> function filters the array using the given Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_where</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">is_string</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// [1 =&gt; 200, 3 =&gt; 400]</span>
</pre></div>

<p><a name="method-head"></a></p>

<h4><code>head()</code> {#collection-method}</h4>

<p>The <code>head</code> function simply returns the first element in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$first</span> <span class="o">=</span> <span class="nx">head</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// 100</span>
</pre></div>

<p><a name="method-last"></a></p>

<h4><code>last()</code> {#collection-method}</h4>

<p>The <code>last</code> function returns the last element in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$last</span> <span class="o">=</span> <span class="nx">last</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// 300</span>
</pre></div>

<p><a name="paths"></a></p>

<h2>Paths</h2>

<p><a name="method-app-path"></a></p>

<h4><code>app_path()</code> {#collection-method}</h4>

<p>The <code>app_path</code> function returns the fully qualified path to the <code>app</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>app_path</code> function to generate a fully qualified path to a given file relative to the application directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">(</span><span class="s1">&#39;Http/Controllers/Controller.php&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-base-path"></a></p>

<h4><code>base_path()</code> {#collection-method}</h4>

<p>The <code>base_path</code> function returns the fully qualified path to the project root:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>base_path</code> function to generate a fully qualified path to a given file relative to the application directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;vendor/bin&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-config-path"></a></p>

<h4><code>config_path()</code> {#collection-method}</h4>

<p>The <code>config_path</code> function returns the fully qualified path to the application configuration directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">config_path</span><span class="p">();</span>
</pre></div>

<p><a name="method-database-path"></a></p>

<h4><code>database_path()</code> {#collection-method}</h4>

<p>The <code>database_path</code> function returns the fully qualified path to the application&#39;s database directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">database_path</span><span class="p">();</span>
</pre></div>

<p><a name="method-elixir"></a></p>

<h4><code>elixir()</code> {#collection-method}</h4>

<p>The <code>elixir</code> function gets the path to the versioned <a href="/docs/%7B%7Bversion%7D%7D/elixir">Elixir</a> file:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="nx">$file</span><span class="p">);</span>
</pre></div>

<p><a name="method-public-path"></a></p>

<h4><code>public_path()</code> {#collection-method}</h4>

<p>The <code>public_path</code> function returns the fully qualified path to the <code>public</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">();</span>
</pre></div>

<p><a name="method-storage-path"></a></p>

<h4><code>storage_path()</code> {#collection-method}</h4>

<p>The <code>storage_path</code> function returns the fully qualified path to the <code>storage</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>storage_path</code> function to generate a fully qualified path to a given file relative to the storage directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/file.txt&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="strings"></a></p>

<h2>Strings</h2>

<p><a name="method-camel-case"></a></p>

<h4><code>camel_case()</code> {#collection-method}</h4>

<p>The <code>camel_case</code> function converts the given string to <code>camelCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$camel</span> <span class="o">=</span> <span class="nx">camel_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// fooBar</span>
</pre></div>

<p><a name="method-class-basename"></a></p>

<h4><code>class_basename()</code> {#collection-method}</h4>

<p>The <code>class_basename</code> returns the class name of the given class with the class&#39; namespace removed:</p>
<div class="highlight"><pre><span></span><span class="nx">$class</span> <span class="o">=</span> <span class="nx">class_basename</span><span class="p">(</span><span class="s1">&#39;Foo\Bar\Baz&#39;</span><span class="p">);</span>

<span class="c1">// Baz</span>
</pre></div>

<p><a name="method-e"></a></p>

<h4><code>e()</code> {#collection-method}</h4>

<p>The <code>e</code> function runs <code>htmlentities</code> over the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">e</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;foo&lt;/html&gt;&#39;</span><span class="p">);</span>

<span class="c1">// &amp;lt;html&amp;gt;foo&amp;lt;/html&amp;gt;</span>
</pre></div>

<p><a name="method-ends-with"></a></p>

<h4><code>ends_with()</code> {#collection-method}</h4>

<p>The <code>ends_with</code> function determines if the given string ends with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">ends_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-snake-case"></a></p>

<h4><code>snake_case()</code> {#collection-method}</h4>

<p>The <code>snake_case</code> function converts the given string to <code>snake_case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$snake</span> <span class="o">=</span> <span class="nx">snake_case</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">);</span>

<span class="c1">// foo_bar</span>
</pre></div>

<p><a name="method-str-limit"></a></p>

<h4><code>str_limit()</code> {#collection-method}</h4>

<p>The <code>str_limit</code> function limits the number of characters in a string. The function accepts a string as its first argument and the maximum number of resulting characters as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_limit</span><span class="p">(</span><span class="s1">&#39;The PHP framework for web artisans.&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="c1">// The PHP...</span>
</pre></div>

<p><a name="method-starts-with"></a></p>

<h4><code>starts_with()</code> {#collection-method}</h4>

<p>The <code>starts_with</code> function determines if the given string begins with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">starts_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-str-contains"></a></p>

<h4><code>str_contains()</code> {#collection-method}</h4>

<p>The <code>str_contains</code> function determines if the given string contains the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_contains</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-str-finish"></a></p>

<h4><code>str_finish()</code> {#collection-method}</h4>

<p>The <code>str_finish</code> function adds a single instance of the given value to a string:</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_finish</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>
</pre></div>

<p><a name="method-str-is"></a></p>

<h4><code>str_is()</code> {#collection-method}</h4>

<p>The <code>str_is</code> function determines if a given string matches a given pattern. Asterisks may be used to indicate wildcards:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_is</span><span class="p">(</span><span class="s1">&#39;foo*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_is</span><span class="p">(</span><span class="s1">&#39;baz*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-str-plural"></a></p>

<h4><code>str_plural()</code> {#collection-method}</h4>

<p>The <code>str_plural</code> function converts a string to its plural form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">);</span>

<span class="c1">// cars</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">);</span>

<span class="c1">// children</span>
</pre></div>

<p>You may provide an integer as a second argument to the function to retrieve the singular or plural form of the string:</p>
<div class="highlight"><pre><span></span><span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// children</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// child</span>
</pre></div>

<p><a name="method-str-random"></a></p>

<h4><code>str_random()</code> {#collection-method}</h4>

<p>The <code>str_random</code> function generates a random string of the specified length:</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
</pre></div>

<p><a name="method-str-singular"></a></p>

<h4><code>str_singular()</code> {#collection-method}</h4>

<p>The <code>str_singular</code> function converts a string to its singular form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">$singular</span> <span class="o">=</span> <span class="nx">str_singular</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">);</span>

<span class="c1">// car</span>
</pre></div>

<p><a name="method-str-slug"></a></p>

<h4><code>str_slug()</code> {#collection-method}</h4>

<p>The <code>str_slug</code> function generates a URL friendly &quot;slug&quot; from the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">$title</span> <span class="o">=</span> <span class="nx">str_slug</span><span class="p">(</span><span class="s2">&quot;Laravel 5 Framework&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">);</span>

<span class="c1">// laravel-5-framework</span>
</pre></div>

<p><a name="method-studly-case"></a></p>

<h4><code>studly_case()</code> {#collection-method}</h4>

<p>The <code>studly_case</code> function converts the given string to <code>StudlyCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">studly_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// FooBar</span>
</pre></div>

<p><a name="method-trans"></a></p>

<h4><code>trans()</code> {#collection-method}</h4>

<p>The <code>trans</code> function translates the given language line using your <a href="/docs/%7B%7Bversion%7D%7D/localization">localization files</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;validation.required&#39;</span><span class="p">)</span><span class="o">:</span>
</pre></div>

<p><a name="method-trans-choice"></a></p>

<h4><code>trans_choice()</code> {#collection-method}</h4>

<p>The <code>trans_choice</code> function translates the given language line with inflection:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="nx">$count</span><span class="p">);</span>
</pre></div>

<p><a name="urls"></a></p>

<h2>URLs</h2>

<p><a name="method-action"></a></p>

<h4><code>action()</code> {#collection-method}</h4>

<p>The <code>action</code> function generates a URL for the given controller action. You do not need to pass the full namespace to the controller. Instead, pass the controller class name relative to the <code>App\Http\Controllers</code> namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@getIndex&#39;</span><span class="p">);</span>
</pre></div>

<p>If the method accepts route parameters, you may pass them as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="method-asset"></a></p>

<h4><code>asset()</code> {#collection-method}</h4>

<p>Generate a URL for an asset using the current scheme of the request (HTTP or HTTPS):</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-secure-asset"></a></p>

<h4><code>secure_asset()</code> {#collection-method}</h4>

<p>Generate a URL for an asset using HTTPS:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">secure_asset</span><span class="p">(</span><span class="s1">&#39;foo/bar.zip&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="p">[]);</span>
</pre></div>

<p><a name="method-route"></a></p>

<h4><code>route()</code> {#collection-method}</h4>

<p>The <code>route</code> function generates a URL for the given named route:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">);</span>
</pre></div>

<p>If the route accepts parameters, you may pass them as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="method-url"></a></p>

<h4><code>url()</code> {#collection-method}</h4>

<p>The <code>url</code> function generates a fully qualified URL to the given path:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="miscellaneous"></a></p>

<h2>Miscellaneous</h2>

<p><a name="method-auth"></a></p>

<h4><code>auth()</code> {#collection-method}</h4>

<p>The <code>auth</code> function returns an authenticator instance. You may use it instead of the <code>Auth</code> facade for convenience:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
</pre></div>

<p><a name="method-back"></a></p>

<h4><code>back()</code> {#collection-method}</h4>

<p>The <code>back()</code> function generates a redirect response to the user&#39;s previous location:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">back</span><span class="p">();</span>
</pre></div>

<p><a name="method-bcrypt"></a></p>

<h4><code>bcrypt()</code> {#collection-method}</h4>

<p>The <code>bcrypt</code> function hashes the given value using Bcrypt. You may use it as an alternative to the <code>Hash</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;my-secret-password&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-collect"></a></p>

<h4><code>collect()</code> {#collection-method}</h4>

<p>The <code>collect</code> function creates a <a href="/docs/%7B%7Bversion%7D%7D/collections">collection</a> instance from the supplied items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;abigail&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="method-config"></a></p>

<h4><code>config()</code> {#collection-method}</h4>

<p>The <code>config</code> function gets the value of a configuration variable. The configuration values may be accessed using &quot;dot&quot; syntax, which includes the name of the file and the option you wish to access. A default value may be specified and is returned if the configuration option does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p>The <code>config</code> helper may also be used to set configuration variables at runtime by passing an array of key / value pairs:</p>
<div class="highlight"><pre><span></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.debug&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
</pre></div>

<p><a name="method-csrf-field"></a></p>

<h4><code>csrf_field()</code> {#collection-method}</h4>

<p>The <code>csrf_field</code> function generates an HTML <code>hidden</code> input field containing the value of the CSRF token. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>
</pre></div>

<p><a name="method-csrf-token"></a></p>

<h4><code>csrf_token()</code> {#collection-method}</h4>

<p>The <code>csrf_token</code> function retrieves the value of the current CSRF token:</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">csrf_token</span><span class="p">();</span>
</pre></div>

<p><a name="method-dd"></a></p>

<h4><code>dd()</code> {#collection-method}</h4>

<p>The <code>dd</code> function dumps the given variable and ends execution of the script:</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p><a name="method-env"></a></p>

<h4><code>env()</code> {#collection-method}</h4>

<p>The <code>env</code> function gets the value of an environment variable or returns a default value:</p>
<div class="highlight"><pre><span></span><span class="nx">$env</span> <span class="o">=</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">);</span>

<span class="c1">// Return a default value if the variable doesn&#39;t exist...</span>
<span class="nx">$env</span> <span class="o">=</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-event"></a></p>

<h4><code>event()</code> {#collection-method}</h4>

<p>The <code>event</code> function dispatches the given <a href="/docs/%7B%7Bversion%7D%7D/events">event</a> to its listeners:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserRegistered</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
</pre></div>

<p><a name="method-factory"></a></p>

<h4><code>factory()</code> {#collection-method}</h4>

<p>The <code>factory</code> function creates a model factory builder for a given class, name, and amount. It can be used while <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">testing</a> or <a href="/docs/%7B%7Bversion%7D%7D/seeding#using-model-factories">seeding</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<p><a name="method-method-field"></a></p>

<h4><code>method_field()</code> {#collection-method}</h4>

<p>The <code>method_field</code> function generates an HTML <code>hidden</code> input field containing the spoofed value of the form&#39;s HTTP verb. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span> <span class="o">!!</span><span class="p">}</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="method-old"></a></p>

<h4><code>old()</code> {#collection-method}</h4>

<p>The <code>old</code> function <a href="/docs/%7B%7Bversion%7D%7D/requests#retrieving-input">retrieves</a> an old input value flashed into the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-redirect"></a></p>

<h4><code>redirect()</code> {#collection-method}</h4>

<p>The <code>redirect</code> function returns an instance of the redirector to do <a href="/docs/%7B%7Bversion%7D%7D/responses#redirects">redirects</a>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-request"></a></p>

<h4><code>request()</code> {#collection-method}</h4>

<p>The <code>request</code> function returns the current <a href="/docs/%7B%7Bversion%7D%7D/requests">request</a> instance or obtains an input item:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">();</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$default</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
</pre></div>

<p><a name="method-response"></a></p>

<h4><code>response()</code> {#collection-method}</h4>

<p>The <code>response</code> function creates a <a href="/docs/%7B%7Bversion%7D%7D/responses">response</a> instance or obtains an instance of the response factory:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<p><a name="method-session"></a></p>

<h4><code>session()</code> {#collection-method}</h4>

<p>The <code>session</code> function may be used to get / set a session value:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>You may set values by passing an array of key / value pairs to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">([</span><span class="s1">&#39;chairs&#39;</span> <span class="p">=&gt;</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;instruments&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>The session store will be returned if no value is passed to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p><a name="method-value"></a></p>

<h4><code>value()</code> {#collection-method}</h4>

<p>The <code>value</code> function&#39;s behavior will simply return the value it is given. However, if you pass a <code>Closure</code> to the function, the <code>Closure</code> will be executed then its result will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<p><a name="method-view"></a></p>

<h4><code>view()</code> {#collection-method}</h4>

<p>The <code>view</code> function retrieves a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a> instance:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-with"></a></p>

<h4><code>with()</code> {#collection-method}</h4>

<p>The <code>with</code> function returns the value it is given. This function is primarily useful for method chaining where it would otherwise be impossible:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="k">new</span> <span class="nx">Foo</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">work</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Homestead</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation-and-setup">Installation &amp; Setup</a>

<ul>
<li><a href="#first-steps">First Steps</a></li>
<li><a href="#configuring-homestead">Configuring Homestead</a></li>
<li><a href="#launching-the-vagrant-box">Launching The Vagrant Box</a></li>
<li><a href="#per-project-installation">Per Project Installation</a></li>
<li><a href="#installing-mariadb">Installing MariaDB</a></li>
</ul></li>
<li><a href="#daily-usage">Daily Usage</a>

<ul>
<li><a href="#accessing-homestead-globally">Accessing Homestead Globally</a></li>
<li><a href="#connecting-via-ssh">Connecting Via SSH</a></li>
<li><a href="#connecting-to-databases">Connecting To Databases</a></li>
<li><a href="#adding-additional-sites">Adding Additional Sites</a></li>
<li><a href="#configuring-cron-schedules">Configuring Cron Schedules</a></li>
<li><a href="#ports">Ports</a></li>
</ul></li>
<li><a href="#network-interfaces">Network Interfaces</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel strives to make the entire PHP development experience delightful, including your local development environment. <a href="http://vagrantup.com">Vagrant</a> provides a simple, elegant way to manage and provision Virtual Machines.</p>

<p>Laravel Homestead is an official, pre-packaged Vagrant box that provides you a wonderful development environment without requiring you to install PHP, HHVM, a web server, and any other server software on your local machine. No more worrying about messing up your operating system! Vagrant boxes are completely disposable. If something goes wrong, you can destroy and re-create the box in minutes!</p>

<p>Homestead runs on any Windows, Mac, or Linux system, and includes the Nginx web server, PHP 7.0, MySQL, Postgres, Redis, Memcached, Node, and all of the other goodies you need to develop amazing Laravel applications.</p>

<blockquote>
<p><strong>Note:</strong> If you are using Windows, you may need to enable hardware virtualization (VT-x). It can usually be enabled via your BIOS. If you are using Hyper-V on a UEFI system you may additionally need to disable Hyper-V in order to access VT-x.</p>
</blockquote>

<p><a name="included-software"></a></p>

<h3>Included Software</h3>

<ul>
<li>Ubuntu 14.04</li>
<li>Git</li>
<li>PHP 7.0</li>
<li>HHVM</li>
<li>Nginx</li>
<li>MySQL</li>
<li>MariaDB</li>
<li>Sqlite3</li>
<li>Postgres</li>
<li>Composer</li>
<li>Node (With PM2, Bower, Grunt, and Gulp)</li>
<li>Redis</li>
<li>Memcached</li>
<li>Beanstalkd</li>
</ul>

<p><a name="installation-and-setup"></a></p>

<h2>Installation &amp; Setup</h2>

<p><a name="first-steps"></a></p>

<h3>First Steps</h3>

<p>Before launching your Homestead environment, you must install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox 5.x</a> or <a href="http://www.vmware.com">VMWare</a> as well as <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>. All of these software packages provide easy-to-use visual installers for all popular operating systems.</p>

<p>To use the VMware provider, you will need to purchase both VMware Fusion / Workstation and the <a href="http://www.vagrantup.com/vmware">VMware Vagrant plug-in</a>. Though it is not free, VMware can provide faster shared folder performance out of the box.</p>

<h4>Installing The Homestead Vagrant Box</h4>

<p>Once VirtualBox / VMware and Vagrant have been installed, you should add the <code>laravel/homestead</code> box to your Vagrant installation using the following command in your terminal. It will take a few minutes to download the box, depending on your Internet connection speed:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span>
</pre></div>

<p>If this command fails, make sure your Vagrant installation is up to date.</p>

<h4>Installing Homestead</h4>

<p>You may install Homestead by simply cloning the repository. Consider cloning the repository into a <code>Homestead</code> folder within your &quot;home&quot; directory, as the Homestead box will serve as the host to all of your Laravel projects:</p>
<div class="highlight"><pre><span></span><span class="nx">cd</span> <span class="o">~</span>

<span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/homestead.git Homestead</span>
</pre></div>

<p>Once you have cloned the Homestead repository, run the <code>bash init.sh</code> command from the Homestead directory to create the <code>Homestead.yaml</code> configuration file. The <code>Homestead.yaml</code> file will be placed in the <code>~/.homestead</code> hidden directory:</p>
<div class="highlight"><pre><span></span><span class="nx">bash</span> <span class="nx">init</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>

<p><a name="configuring-homestead"></a></p>

<h3>Configuring Homestead</h3>

<h4>Setting Your Provider</h4>

<p>The <code>provider</code> key in your <code>~/.homestead/Homestead.yaml</code> file indicates which Vagrant provider should be used: <code>virtualbox</code>, <code>vmware_fusion</code>, or <code>vmware_workstation</code>. You may set this to the provider you prefer:</p>
<div class="highlight"><pre><span></span><span class="nx">provider</span><span class="o">:</span> <span class="nx">virtualbox</span>
</pre></div>

<h4>Configuring Shared Folders</h4>

<p>The <code>folders</code> property of the <code>Homestead.yaml</code> file lists all of the folders you wish to share with your Homestead environment. As files within these folders are changed, they will be kept in sync between your local machine and the Homestead environment. You may configure as many shared folders as necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/Code</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code</span>
</pre></div>

<p>To enable <a href="http://docs.vagrantup.com/v2/synced-folders/nfs.html">NFS</a>, just add a simple flag to your synced folder configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/Code</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;nfs&quot;</span>
</pre></div>

<h4>Configuring Nginx Sites</h4>

<p>Not familiar with Nginx? No problem. The <code>sites</code> property allows you to easily map a &quot;domain&quot; to a folder on your Homestead environment. A sample site configuration is included in the <code>Homestead.yaml</code> file. Again, you may add as many sites to your Homestead environment as necessary. Homestead can serve as a convenient, virtualized environment for every Laravel project you are working on:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code/Laravel/public</span>
</pre></div>

<p>You can make any Homestead site use <a href="http://hhvm.com">HHVM</a> by setting the <code>hhvm</code> option to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code/Laravel/public</span>
      <span class="nx">hhvm</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>If you change the <code>sites</code> property after provisioning the Homestead box, you should re-run <code>vagrant reload --provision</code>  to update the Nginx configuration on the virtual machine.</p>

<h4>The Hosts File</h4>

<p>You must add the &quot;domains&quot; for your Nginx sites to the <code>hosts</code> file on your machine. The <code>hosts</code> file will redirect requests for your Homestead sites into your Homestead machine. On Mac and Linux, this file is located at <code>/etc/hosts</code>. On Windows, it is located at <code>C:\Windows\System32\drivers\etc\hosts</code>. The lines you add to this file will look like the following:</p>
<div class="highlight"><pre><span></span><span class="mf">192.168.10.10</span>  <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
</pre></div>

<p>Make sure the IP address listed is the one set in your <code>~/.homestead/Homestead.yaml</code> file. Once you have added the domain to your <code>hosts</code> file, you can access the site via your web browser:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//homestead.app</span>
</pre></div>

<p><a name="launching-the-vagrant-box"></a></p>

<h3>Launching The Vagrant Box</h3>

<p>Once you have edited the <code>Homestead.yaml</code> to your liking, run the <code>vagrant up</code> command from your Homestead directory. Vagrant will boot the virtual machine and automatically configure your shared folders and Nginx sites.</p>

<p>To destroy the machine, you may use the <code>vagrant destroy --force</code> command.</p>

<p><a name="per-project-installation"></a></p>

<h3>Per Project Installation</h3>

<p>Instead of installing Homestead globally and sharing the same Homestead box across all of your projects, you may instead configure a Homestead instance for each project you manage. Installing Homestead per project may be beneficial if you wish to ship a <code>Vagrantfile</code> with your project, allowing others working on the project to simply <code>vagrant up</code>.</p>

<p>To install Homestead directly into your project, require it using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span> <span class="o">--</span><span class="nx">dev</span>
</pre></div>

<p>Once Homestead has been installed, use the <code>make</code> command to generate the <code>Vagrantfile</code> and <code>Homestead.yaml</code> file in your project root. The <code>make</code> command will automatically configure the <code>sites</code> and <code>folders</code> directives in the <code>Homestead.yaml</code> file.</p>

<p>Mac / Linux:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">vendor</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">homestead</span> <span class="nx">make</span>
</pre></div>

<p>Windows:</p>

<p>vendor\bin\homestead make</p>

<p>Next, run the <code>vagrant up</code> command in your terminal and access your project at <code>http://homestead.app</code> in your browser. Remember, you will still need to add an <code>/etc/hosts</code> file entry for <code>homestead.app</code> or the domain of your choice.</p>

<p><a name="installing-mariadb"></a></p>

<h3>Installing MariaDB</h3>

<p>If you prefer to use MariaDB instead of MySQL, you may add the <code>mariadb</code> option to your <code>Homestead.yaml</code> file. This option will remove MySQL and install MariaDB. MariaDB serves as a drop-in replacement for MySQL so you should still use the <code>mysql</code> database driver in your application&#39;s database configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">box</span><span class="o">:</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span>
<span class="nx">ip</span><span class="o">:</span> <span class="s2">&quot;192.168.20.20&quot;</span>
<span class="nx">memory</span><span class="o">:</span> <span class="mi">2048</span>
<span class="nx">cpus</span><span class="o">:</span> <span class="mi">4</span>
<span class="nx">provider</span><span class="o">:</span> <span class="nx">virtualbox</span>
<span class="nx">mariadb</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p><a name="daily-usage"></a></p>

<h2>Daily Usage</h2>

<p><a name="accessing-homestead-globally"></a></p>

<h3>Accessing Homestead Globally</h3>

<p>Sometimes you may want to <code>vagrant up</code> your Homestead machine from anywhere on your filesystem. You can do this by adding a simple Bash alias to your Bash profile. This alias will allow you to run any Vagrant command from anywhere on your system and will automatically point that command to your Homestead installation:</p>
<div class="highlight"><pre><span></span><span class="nx">alias</span> <span class="nx">homestead</span><span class="o">=</span><span class="s1">&#39;function __homestead() { (cd ~/Homestead &amp;&amp; vagrant $*); unset -f __homestead; }; __homestead&#39;</span>
</pre></div>

<p>Make sure to tweak the <code>~/Homestead</code> path in the alias to the location of your actual Homestead installation. Once the alias is installed, you may run commands like <code>homestead up</code> or <code>homestead ssh</code> from anywhere on your system.</p>

<p><a name="connecting-via-ssh"></a></p>

<h3>Connecting Via SSH</h3>

<p>You can SSH into your virtual machine by issuing the <code>vagrant ssh</code> terminal command from your Homestead directory.</p>

<p>But, since you will probably need to SSH into your Homestead machine frequently, consider adding the &quot;alias&quot; described above to your host machine to quickly SSH into the Homestead box.</p>

<p><a name="connecting-to-databases"></a></p>

<h3>Connecting To Databases</h3>

<p>A <code>homestead</code> database is configured for both MySQL and Postgres out of the box. For even more convenience, Laravel&#39;s <code>.env</code> file configures the framework to use this database out of the box.</p>

<p>To connect to your MySQL or Postgres database from your host machine via Navicat or Sequel Pro, you should connect to <code>127.0.0.1</code> and port <code>33060</code> (MySQL) or <code>54320</code> (Postgres). The username and password for both databases is <code>homestead</code> / <code>secret</code>.</p>

<blockquote>
<p><strong>Note:</strong> You should only use these non-standard ports when connecting to the databases from your host machine. You will use the default 3306 and 5432 ports in your Laravel database configuration file since Laravel is running <em>within</em> the virtual machine.</p>
</blockquote>

<p><a name="adding-additional-sites"></a></p>

<h3>Adding Additional Sites</h3>

<p>Once your Homestead environment is provisioned and running, you may want to add additional Nginx sites for your Laravel applications. You can run as many Laravel installations as you wish on a single Homestead environment. To add an additional site, simply add the site to your <code>~/.homestead/Homestead.yaml</code> file and then run the <code>vagrant provision</code> terminal command from your Homestead directory.</p>

<p><a name="configuring-cron-schedules"></a></p>

<h3>Configuring Cron Schedules</h3>

<p>Laravel provides a convenient way to <a href="/docs/%7B%7Bversion%7D%7D/scheduling">schedule Cron jobs</a> by scheduling a single <code>schedule:run</code> Artisan command to be run every minute. The <code>schedule:run</code> command will examine the job scheduled defined in your <code>App\Console\Kernel</code> class to determine which jobs should be run.</p>

<p>If you would like the <code>schedule:run</code> command to be run for a Homestead site, you may set the <code>schedule</code> option to <code>true</code> when defining the site:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code/Laravel/public</span>
      <span class="nx">schedule</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>The Cron job for the site will be defined in the <code>/etc/cron.d</code> folder of the virtual machine.</p>

<p><a name="ports"></a></p>

<h3>Ports</h3>

<p>By default, the following ports are forwarded to your Homestead environment:</p>

<ul>
<li><strong>SSH:</strong> 2222 &rarr; Forwards To 22</li>
<li><strong>HTTP:</strong> 8000 &rarr; Forwards To 80</li>
<li><strong>HTTPS:</strong> 44300 &rarr; Forwards To 443</li>
<li><strong>MySQL:</strong> 33060 &rarr; Forwards To 3306</li>
<li><strong>Postgres:</strong> 54320 &rarr; Forwards To 5432</li>
</ul>

<h4>Forwarding Additional Ports</h4>

<p>If you wish, you may forward additional ports to the Vagrant box, as well as specify their protocol:</p>
<div class="highlight"><pre><span></span><span class="nx">ports</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">93000</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">9300</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">7777</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">777</span>
      <span class="nx">protocol</span><span class="o">:</span> <span class="nx">udp</span>
</pre></div>

<p><a name="network-interfaces"></a></p>

<h2>Network Interfaces</h2>

<p>The <code>networks</code> property of the <code>Homestead.yaml</code> configures network interfaces for your Homestead environment. You may configure as many interfaces as necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;private_network&quot;</span>
      <span class="nx">ip</span><span class="o">:</span> <span class="s2">&quot;192.168.10.20&quot;</span>
</pre></div>

<p>To enable a <a href="https://www.vagrantup.com/docs/networking/public_network.html">bridged</a> interface, configure a <code>bridge</code> setting and change the network type to <code>public_network</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;public_network&quot;</span>
      <span class="nx">ip</span><span class="o">:</span> <span class="s2">&quot;192.168.10.20&quot;</span>
      <span class="nx">bridge</span><span class="o">:</span> <span class="s2">&quot;en1: Wi-Fi (AirPort)&quot;</span>
</pre></div>

<p>To enable <a href="https://www.vagrantup.com/docs/networking/public_network.html">DHCP</a>, just remove the <code>ip</code> option from your configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;public_network&quot;</span>
      <span class="nx">bridge</span><span class="o">:</span> <span class="s2">&quot;en1: Wi-Fi (AirPort)&quot;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Installation</h1>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#basic-configuration">Basic Configuration</a></li>
<li><a href="#environment-configuration">Environment Configuration</a></li>
<li><a href="#configuration-caching">Configuration Caching</a></li>
<li><a href="#accessing-configuration-values">Accessing Configuration Values</a></li>
<li><a href="#naming-your-application">Naming Your Application</a></li>
</ul></li>
<li><a href="#maintenance-mode">Maintenance Mode</a></li>
</ul>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<h3>Server Requirements</h3>

<p>The Laravel framework has a few system requirements. Of course, all of these requirements are satisfied by the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Laravel Homestead</a> virtual machine:</p>

<div class="content-list" markdown="1">
- PHP >= 5.5.9
- OpenSSL PHP Extension
- PDO PHP Extension
- Mbstring PHP Extension
- Tokenizer PHP Extension
</div>

<p><a name="install-laravel"></a></p>

<h3>Installing Laravel</h3>

<p>Laravel utilizes <a href="http://getcomposer.org">Composer</a> to manage its dependencies. So, before using Laravel, make sure you have Composer installed on your machine.</p>

<h4>Via Laravel Installer</h4>

<p>First, download the Laravel installer using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/installer&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>laravel</code> executable can be located by your system.</p>

<p>Once installed, the simple <code>laravel new</code> command will create a fresh Laravel installation in the directory you specify. For instance, <code>laravel new blog</code> will create a directory named <code>blog</code> containing a fresh Laravel installation with all of Laravel&#39;s dependencies already installed. This method of installation is much faster than installing via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">laravel</span> <span class="k">new</span> <span class="nx">blog</span>
</pre></div>

<h4>Via Composer Create-Project</h4>

<p>Alternatively, you may also install Laravel by issuing the Composer <code>create-project</code> command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="nx">blog</span> <span class="s2">&quot;5.1.*&quot;</span>
</pre></div>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p><a name="basic-configuration"></a></p>

<h3>Basic Configuration</h3>

<p>All of the configuration files for the Laravel framework are stored in the <code>config</code> directory. Each option is documented, so feel free to look through the files and get familiar with the options available to you.</p>

<h4>Directory Permissions</h4>

<p>After installing Laravel, you may need to configure some permissions. Directories within the <code>storage</code> and the <code>bootstrap/cache</code> directories should be writable by your web server. If you are using the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> virtual machine, these permissions should already be set.</p>

<h4>Application Key</h4>

<p>The next thing you should do after installing Laravel is set your application key to a random string. If you installed Laravel via Composer or the Laravel installer, this key has already been set for you by the <code>key:generate</code> command. Typically, this string should be 32 characters long. The key can be set in the <code>.env</code> environment file. If you have not renamed the <code>.env.example</code> file to <code>.env</code>, you should do that now. <strong>If the application key is not set, your user sessions and other encrypted data will not be secure!</strong></p>

<h4>Additional Configuration</h4>

<p>Laravel needs almost no other configuration out of the box. You are free to get started developing! However, you may wish to review the <code>config/app.php</code> file and its documentation. It contains several options such as <code>timezone</code> and <code>locale</code> that you may wish to change according to your application.</p>

<p>You may also want to configure a few additional components of Laravel, such as:</p>

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/cache#configuration">Cache</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/database#configuration">Database</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/session#configuration">Session</a></li>
</ul>

<p>Once Laravel is installed, you should also <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">configure your local environment</a>.</p>

<p><a name="pretty-urls"></a></p>

<h4>Pretty URLs</h4>

<p><strong>Apache</strong></p>

<p>The framework ships with a <code>public/.htaccess</code> file that is used to allow URLs without <code>index.php</code>. If you use Apache to serve your Laravel application, be sure to enable the <code>mod_rewrite</code> module.</p>

<p>If the <code>.htaccess</code> file that ships with Laravel does not work with your Apache installation, try this one:</p>
<div class="highlight"><pre><span></span><span class="nx">Options</span> <span class="o">+</span><span class="nx">FollowSymLinks</span>
<span class="nx">RewriteEngine</span> <span class="nx">On</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">d</span>
<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">f</span>
<span class="nx">RewriteRule</span> <span class="o">^</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span> <span class="p">[</span><span class="nx">L</span><span class="p">]</span>
</pre></div>

<p><strong>Nginx</strong></p>

<p>On Nginx, the following directive in your site configuration will allow &quot;pretty&quot; URLs:</p>
<div class="highlight"><pre><span></span><span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
<span class="p">}</span>
</pre></div>

<p>Of course, when using <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a>, pretty URLs will be configured automatically.</p>

<p><a name="environment-configuration"></a></p>

<h3>Environment Configuration</h3>

<p>It is often helpful to have different configuration values based on the environment the application is running in. For example, you may wish to use a different cache driver locally than you do on your production server. It&#39;s easy using environment based configuration.</p>

<p>To make this a cinch, Laravel utilizes the <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> PHP library by Vance Lucas. In a fresh Laravel installation, the root directory of your application will contain a <code>.env.example</code> file. If you install Laravel via Composer, this file will automatically be renamed to <code>.env</code>. Otherwise, you should rename the file manually.</p>

<p>All of the variables listed in this file will be loaded into the <code>$_ENV</code> PHP super-global when your application receives a request. You may use the <code>env</code> helper to retrieve values from these variables. In fact, if you review the Laravel configuration files, you will notice several of the options already using this helper!</p>

<p>Feel free to modify your environment variables as needed for your own local server, as well as your production environment. However, your <code>.env</code> file should not be committed to your application&#39;s source control, since each developer / server using your application could require a different environment configuration.</p>

<p>If you are developing with a team, you may wish to continue including a <code>.env.example</code> file with your application. By putting place-holder values in the example configuration file, other developers on your team can clearly see which environment variables are needed to run your application.</p>

<h4>Accessing The Current Application Environment</h4>

<p>The current application environment is determined via the <code>APP_ENV</code> variable from your <code>.env</code> file. You may access this value via the <code>environment</code> method on the <code>App</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p>You may also pass arguments to the <code>environment</code> method to check if the environment matches a given value. You may even pass multiple values if necessary:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The environment is local</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The environment is either local OR staging...</span>
<span class="p">}</span>
</pre></div>

<p>An application instance may also be accessed via the <code>app</code> helper method:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p><a name="configuration-caching"></a></p>

<h3>Configuration Caching</h3>

<p>To give your application a speed boost, you should cache all of your configuration files into a single file using the <code>config:cache</code> Artisan command. This will combine all of the configuration options for your application into a single file which can be loaded quickly by the framework.</p>

<p>You should typically run the <code>php artisan config:cache</code> command as part of your production deployment routine. The command should not be run during local development as configuration options will frequently need to be changed during the course of your application&#39;s development.</p>

<p><a name="accessing-configuration-values"></a></p>

<h3>Accessing Configuration Values</h3>

<p>You may easily access your configuration values using the global <code>config</code> helper function. The configuration values may be accessed using &quot;dot&quot; syntax, which includes the name of the file and option you wish to access. A default value may also be specified and will be returned if the configuration option does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>
</pre></div>

<p>To set configuration values at runtime, pass an array to the <code>config</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.timezone&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="naming-your-application"></a></p>

<h3>Naming Your Application</h3>

<p>After installing Laravel, you may wish to &quot;name&quot; your application. By default, the <code>app</code> directory is namespaced under <code>App</code>, and autoloaded by Composer using the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 autoloading standard</a>. However, you may change the namespace to match the name of your application, which you can easily do via the <code>app:name</code> Artisan command.</p>

<p>For example, if your application is named &quot;Horsefly&quot;, you could run the following command from the root of your installation:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">app</span><span class="o">:</span><span class="nx">name</span> <span class="nx">Horsefly</span>
</pre></div>

<p>Renaming your application is entirely optional, and you are free to keep the <code>App</code> namespace if you wish.</p>

<p><a name="maintenance-mode"></a></p>

<h2>Maintenance Mode</h2>

<p>When your application is in maintenance mode, a custom view will be displayed for all requests into your application. This makes it easy to &quot;disable&quot; your application while it is updating or when you are performing maintenance. A maintenance mode check is included in the default middleware stack for your application. If the application is in maintenance mode, an <code>HttpException</code> will be thrown with a status code of 503.</p>

<p>To enable maintenance mode, simply execute the <code>down</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span>
</pre></div>

<p>To disable maintenance mode, use the <code>up</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">up</span>
</pre></div>

<h3>Maintenance Mode Response Template</h3>

<p>The default template for maintenance mode responses is located in <code>resources/views/errors/503.blade.php</code>.</p>

<h3>Maintenance Mode &amp; Queues</h3>

<p>While your application is in maintenance mode, no <a href="/docs/%7B%7Bversion%7D%7D/queues">queued jobs</a> will be handled. The jobs will continue to be handled as normal once the application is out of maintenance mode.</p>
<div style="page-break-after: always;" ></div><h1>Request Lifecycle</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#lifecycle-overview">Lifecycle Overview</a></li>
<li><a href="#focus-on-service-providers">Focus On Service Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When using any tool in the &quot;real world&quot;, you feel more confident if you understand how that tool works. Application development is no different. When you understand how your development tools function, you feel more comfortable and confident using them.</p>

<p>The goal of this document is to give you a good, high-level overview of how the Laravel framework &quot;works&quot;. By getting to know the overall framework better, everything feels less &quot;magical&quot; and you will be more confident building your applications.</p>

<p>If you don&#39;t understand all of the terms right away, don&#39;t lose heart! Just try to get a basic grasp of what is going on, and your knowledge will grow as you explore other sections of the documentation.</p>

<p><a name="lifecycle-overview"></a></p>

<h2>Lifecycle Overview</h2>

<h3>First Things</h3>

<p>The entry point for all requests to a Laravel application is the <code>public/index.php</code> file. All requests are directed to this file by your web server (Apache / Nginx) configuration. The <code>index.php</code> file doesn&#39;t contain much code. Rather, it is simply a starting point for loading the rest of the framework.</p>

<p>The <code>index.php</code> file loads the Composer generated autoloader definition, and then retrieves an instance of the Laravel application from <code>bootstrap/app.php</code> script. The first action taken by Laravel itself is to create an instance of the application / <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<h3>HTTP / Console Kernels</h3>

<p>Next, the incoming request is sent to either the HTTP kernel or the console kernel, depending on the type of request that is entering the application. These two kernels serve as the central location that all requests flow through. For now, let&#39;s just focus on the HTTP kernel, which is located in <code>app/Http/Kernel.php</code>.</p>

<p>The HTTP kernel extends the <code>Illuminate\Foundation\Http\Kernel</code> class, which defines an array of <code>bootstrappers</code> that will be run before the request is executed. These bootstrappers configure error handling, configure logging, <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">detect the application environment</a>, and perform other tasks that need to be done before the request is actually handled.</p>

<p>The HTTP kernel also defines a list of HTTP <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> that all requests must pass through before being handled by the application. These middleware handle reading and writing the <a href="/docs/%7B%7Bversion%7D%7D/session">HTTP session</a>, determine if the application is in maintenance mode, <a href="/docs/%7B%7Bversion%7D%7D/routing#csrf-protection">verifying the CSRF token</a>, and more.</p>

<p>The method signature for the HTTP kernel&#39;s <code>handle</code> method is quite simple: receive a <code>Request</code> and return a <code>Response</code>. Think of the Kernel as being a big black box that represents your entire application. Feed it HTTP requests and it will return HTTP responses.</p>

<h4>Service Providers</h4>

<p>One of the most important Kernel bootstrapping actions is loading the <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a> for your application. All of the service providers for the application are configured in the <code>config/app.php</code> configuration file&#39;s <code>providers</code> array. First, the <code>register</code> method will be called on all providers, then, once all providers have been registered, the <code>boot</code> method will be called.</p>

<p>Service providers are responsible for bootstrapping all of the framework&#39;s various components, such as the database, queue, validation, and routing components. Since they bootstrap and configure every feature offered by the framework, service providers are the most important aspect of the entire Laravel bootstrap process.</p>

<h4>Dispatch Request</h4>

<p>Once the application has been bootstrapped and all service providers have been registered, the <code>Request</code> will be handed off to the router for dispatching. The router will dispatch the request to a route or controller, as well as run any route specific middleware.</p>

<p><a name="focus-on-service-providers"></a></p>

<h2>Focus On Service Providers</h2>

<p>Service providers are truly the key to bootstrapping a Laravel application. The application instance is created, the service providers are registered, and the request is handed to the bootstrapped application. It&#39;s really that simple!</p>

<p>Having a firm grasp of how a Laravel application is built and bootstrapped via service providers is very valuable. Of course, your application&#39;s default service providers are stored in the <code>app/Providers</code> directory.</p>

<p>By default, the <code>AppServiceProvider</code> is fairly empty. This provider is a great place to add your application&#39;s own bootstrapping and service container bindings. Of course, for large applications, you may wish to create several service providers, each with a more granular type of bootstrapping.</p>
<div style="page-break-after: always;" ></div><h1>Localization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#pluralization">Pluralization</a></li>
</ul></li>
<li><a href="#overriding-vendor-language-files">Overriding Vendor Language Files</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s localization features provide a convenient way to retrieve strings in various languages, allowing you to easily support multiple languages within your application.</p>

<p>Language strings are stored in files within the <code>resources/lang</code> directory. Within this directory there should be a subdirectory for each language supported by the application:</p>
<div class="highlight"><pre><span></span><span class="err">/resources</span>
    <span class="err">/lang</span>
        <span class="err">/en</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
        <span class="o">/</span><span class="nx">es</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
</pre></div>

<p>All language files simply return an array of keyed strings. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;welcome&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to our application&#39;</span>
<span class="p">];</span>
</pre></div>

<h4>Configuring The Locale</h4>

<p>The default language for your application is stored in the <code>config/app.php</code> configuration file. Of course, you may modify this value to suit the needs of your application. You may also change the active language at runtime using the <code>setLocale</code> method on the <code>App</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;welcome/{locale}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$locale</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">App</span><span class="o">::</span><span class="nx">setLocale</span><span class="p">(</span><span class="nx">$locale</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may also configure a &quot;fallback language&quot;, which will be used when the active language does not contain a given language line. Like the default language, the fallback language is also configured in the <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;fallback_locale&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>You may retrieve lines from language files using the <code>trans</code> helper function. The <code>trans</code> method accepts the file and key of the language line as its first argument. For example, let&#39;s retrieve the language line <code>welcome</code> in the <code>resources/lang/messages.php</code> language file:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course if you are using the <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade templating engine</a>, you may use the <code>{{ }}</code> syntax to echo the language line:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p>If the specified language line does not exist, the <code>trans</code> function will simply return the language line key. So, using the example above, the <code>trans</code> function would return <code>messages.welcome</code> if the language line does not exist.</p>

<h4>Replacing Parameters In Language Lines</h4>

<p>If you wish, you may define place-holders in your language lines. All place-holders are prefixed with a <code>:</code>. For example, you may define a welcome message with a place-holder name:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;welcome&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Welcome, :name&#39;</span><span class="p">,</span>
</pre></div>

<p>To replace the place-holders when retrieving a language line, pass an array of replacements as the second argument to the <code>trans</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="pluralization"></a></p>

<h3>Pluralization</h3>

<p>Pluralization is a complex problem, as different languages have a variety of complex rules for pluralization. By using a &quot;pipe&quot; character, you may distinguish a singular and plural form of a string:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;There is one apple|There are many apples&#39;</span><span class="p">,</span>
</pre></div>

<p>Then, you may then use the <code>trans_choice</code> function to retrieve the line for a given &quot;count&quot;. In this example, since the count is greater than one, the plural form of the language line is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;messages.apples&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>Since the Laravel translator is powered by the Symfony Translation component, you may create even more complex pluralization rules:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{0} There are none|[1,19] There are some|[20,Inf] There are many&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="overriding-vendor-language-files"></a></p>

<h2>Overriding Vendor Language Files</h2>

<p>Some packages may ship with their own language files. Instead of hacking the package&#39;s core files to tweak these lines, you may override them by placing your own files in the <code>resources/lang/vendor/{package}/{locale}</code> directory.</p>

<p>So, for example, if you need to override the English language lines in <code>messages.php</code> for a package named <code>skyrim/hearthfire</code>, you would place a language file at: <code>resources/lang/vendor/hearthfire/en/messages.php</code>. In this file you should only define the language lines you wish to override. Any language lines you don&#39;t override will still be loaded from the package&#39;s original language files.</p>
<div style="page-break-after: always;" ></div><h1>Mail</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#sending-mail">Sending Mail</a>

<ul>
<li><a href="#attachments">Attachments</a></li>
<li><a href="#inline-attachments">Inline Attachments</a></li>
<li><a href="#queueing-mail">Queueing Mail</a></li>
</ul></li>
<li><a href="#mail-and-local-development">Mail &amp; Local Development</a></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a clean, simple API over the popular <a href="http://swiftmailer.org">SwiftMailer</a> library. Laravel provides drivers for SMTP, Mailgun, Mandrill, Amazon SES, PHP&#39;s <code>mail</code> function, and <code>sendmail</code>, allowing you to quickly get started sending mail through a local or cloud based service of your choice.</p>

<h3>Driver Prerequisites</h3>

<p>The API based drivers such as Mailgun and Mandrill are often simpler and faster than SMTP servers. All of the API drivers require that the Guzzle HTTP library be installed for your application. You may install Guzzle to your project by adding the following line to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;guzzlehttp/guzzle&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.3|~6.0&quot;</span>
</pre></div>

<h4>Mailgun Driver</h4>

<p>To use the Mailgun driver, first install Guzzle, then set the <code>driver</code> option in your <code>config/mail.php</code> configuration file to <code>mailgun</code>. Next, verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mailgun&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-key&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>Mandrill Driver</h4>

<p>To use the Mandrill driver, first install Guzzle, then set the <code>driver</code> option in your <code>config/mail.php</code> configuration file to <code>mandrill</code>. Next, verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mandrill&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mandrill-key&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>SES Driver</h4>

<p>To use the Amazon SES driver, install the Amazon AWS SDK for PHP. You may install this library by adding the following line to your <code>composer.json</code> file&#39;s <code>require</code> section:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;aws/aws-sdk-php&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.0&quot;</span>
</pre></div>

<p>Next, set the <code>driver</code> option in your <code>config/mail.php</code> configuration file to <code>ses</code>. Then, verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;ses&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ses-region&#39;</span><span class="p">,</span>  <span class="c1">// e.g. us-east-1</span>
<span class="p">],</span>
</pre></div>

<p><a name="sending-mail"></a></p>

<h2>Sending Mail</h2>

<p>Laravel allows you to store your e-mail messages in <a href="/docs/%7B%7Bversion%7D%7D/views">views</a>. For example, to organize your e-mails, you could create an <code>emails</code> directory within your <code>resources/views</code> directory:</p>

<p>To send a message, use the <code>send</code> method on the <code>Mail</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>send</code> method accepts three arguments. First, the name of a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a> that contains the e-mail message. Secondly, an array of data you wish to pass to the view. Lastly, a <code>Closure</code> callback which receives a message instance, allowing you to customize the recipients, subject, and other aspects of the mail message:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Mail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Send an e-mail reminder to the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmailReminder</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nx">Mail</span><span class="o">::</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;emails.reminder&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">],</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$m</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;hello@app.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Application&#39;</span><span class="p">);</span>

            <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;Your Reminder!&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Since we are passing an array containing the <code>user</code> key in the example above, we could display the user&#39;s name within our e-mail view using the following PHP code:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="cp">?&gt;</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> A <code>$message</code> variable is always passed to e-mail views, and allows the <a href="#attachments">inline embedding of attachments</a>. So, you should avoid passing a <code>message</code> variable in your view payload.</p>
</blockquote>

<h4>Building The Message</h4>

<p>As previously discussed, the third argument given to the <code>send</code> method is a <code>Closure</code> allowing you to specify various options on the e-mail message itself. Using this Closure you may specify other attributes of the message, such as carbon copies, blind carbon copies, etc:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;us@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Here is a list of the available methods on the <code>$message</code> message builder instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">sender</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">bcc</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">replyTo</span><span class="p">(</span><span class="nx">$address</span><span class="p">,</span> <span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="nx">$subject</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">priority</span><span class="p">(</span><span class="nx">$level</span><span class="p">);</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$options</span> <span class="o">=</span> <span class="p">[]);</span>

<span class="c1">// Attach a file from a raw $data string...</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attachData</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$options</span> <span class="o">=</span> <span class="p">[]);</span>

<span class="c1">// Get the underlying SwiftMailer message instance...</span>
<span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">getSwiftMessage</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The message instance passed to a <code>Mail::send</code> Closure extends the SwiftMailer message class, allowing you to call any method on that class to build your e-mail messages.</p>
</blockquote>

<h4>Mailing Plain Text</h4>

<p>By default, the view given to the <code>send</code> method is assumed to contain HTML. However, by passing an array as the first argument to the <code>send</code> method, you may specify a plain text view to send in addition to the HTML view:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">([</span><span class="s1">&#39;html.view&#39;</span><span class="p">,</span> <span class="s1">&#39;text.view&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>Or, if you only need to send a plain text e-mail, you may specify this using the <code>text</code> key in the array:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">([</span><span class="s1">&#39;text&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<h4>Mailing Raw Strings</h4>

<p>You may use the <code>raw</code> method if you wish to e-mail a raw string directly:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;Text to e-mail&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="attachments"></a></p>

<h3>Attachments</h3>

<p>To add attachments to an e-mail, use the <code>attach</code> method on the <code>$message</code> object passed to your Closure. The <code>attach</code> method accepts the full path to the file as its first argument:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When attaching files to a message, you may also specify the display name and / or MIME type by passing an <code>array</code> as the second argument to the <code>attach</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="nx">$display</span><span class="p">,</span> <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="nx">$mime</span><span class="p">]);</span>
</pre></div>

<p><a name="inline-attachments"></a></p>

<h3>Inline Attachments</h3>

<h4>Embedding An Image In An E-Mail View</h4>

<p>Embedding inline images into your e-mails is typically cumbersome; however, Laravel provides a convenient way to attach images to your e-mails and retrieving the appropriate CID. To embed an inline image, use the <code>embed</code> method on the <code>$message</code> variable within your e-mail view. Remember, Laravel automatically makes the <code>$message</code> variable available to all of your e-mail views:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embed</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<h4>Embedding Raw Data In An E-Mail View</h4>

<p>If you already have a raw data string you wish to embed into an e-mail message, you may use the <code>embedData</code> method on the <code>$message</code> variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">from</span> <span class="nx">raw</span> <span class="nx">data</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embedData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<p><a name="queueing-mail"></a></p>

<h3>Queueing Mail</h3>

<h4>Queueing A Mail Message</h4>

<p>Since sending e-mail messages can drastically lengthen the response time of your application, many developers choose to queue e-mail messages for background sending. Laravel makes this easy using its built-in <a href="/docs/%7B%7Bversion%7D%7D/queues">unified queue API</a>. To queue a mail message, use the <code>queue</code> method on the <code>Mail</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>This method will automatically take care of pushing a job onto the queue to send the mail message in the background. Of course, you will need to <a href="/docs/%7B%7Bversion%7D%7D/queues">configure your queues</a> before using this feature.</p>

<h4>Delayed Message Queueing</h4>

<p>If you wish to delay the delivery of a queued e-mail message, you may use the <code>later</code> method. To get started, simply pass the number of seconds by which you wish to delay the sending of the message as the first argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">later</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Pushing To Specific Queues</h4>

<p>If you wish to specify a specific queue on which to push the message, you may do so using the <code>queueOn</code> and <code>laterOn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queueOn</span><span class="p">(</span><span class="s1">&#39;queue-name&#39;</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Mail</span><span class="o">::</span><span class="nx">laterOn</span><span class="p">(</span><span class="s1">&#39;queue-name&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="mail-and-local-development"></a></p>

<h2>Mail &amp; Local Development</h2>

<p>When developing an application that sends e-mail, you probably don&#39;t want to actually send e-mails to live e-mail addresses. Laravel provides several ways to &quot;disable&quot; the actual sending of e-mail messages.</p>

<h4>Log Driver</h4>

<p>One solution is to use the <code>log</code> mail driver during local development. This driver will write all e-mail messages to your log files for inspection. For more information on configuring your application per environment, check out the <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">configuration documentation</a>.</p>

<h4>Universal To</h4>

<p>Another solution provided by Laravel is to set a universal recipient of all e-mails sent by the framework. This way, all the emails generated by your application will be sent to a specific address, instead of the address actually specified when sending the message. This can be done via the <code>to</code> option in your <code>config/mail.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;to&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dev@domain.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dev Example&#39;</span>
<span class="p">],</span>
</pre></div>

<h4>Mailtrap</h4>

<p>Finally, you may use a service like <a href="https://mailtrap.io">Mailtrap</a> and the <code>smtp</code> driver to send your e-mail messages to a &quot;dummy&quot; mailbox where you may view them in a true e-mail client. This approach has the benefit of allowing you to actually inspect the final e-mails in Mailtrap&#39;s message viewer.</p>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Laravel fires the <code>mailer.sending</code> event just before sending mail messages. Remember, this event is fired when the mail is <em>sent</em>, not when it is queued. You may register an event listener in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Contracts\Events\Dispatcher  $events</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">DispatcherContract</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$events</span><span class="p">);</span>

    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;mailer.sending&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Middleware</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-middleware">Defining Middleware</a></li>
<li><a href="#registering-middleware">Registering Middleware</a></li>
<li><a href="#middleware-parameters">Middleware Parameters</a></li>
<li><a href="#terminable-middleware">Terminable Middleware</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>HTTP middleware provide a convenient mechanism for filtering HTTP requests entering your application. For example, Laravel includes a middleware that verifies the user of your application is authenticated. If the user is not authenticated, the middleware will redirect the user to the login screen. However, if the user is authenticated, the middleware will allow the request to proceed further into the application.</p>

<p>Of course, additional middleware can be written to perform a variety of tasks besides authentication. A CORS middleware might be responsible for adding the proper headers to all responses leaving your application. A logging middleware might log all incoming requests to your application.</p>

<p>There are several middleware included in the Laravel framework, including middleware for maintenance, authentication, CSRF protection, and more. All of these middleware are located in the <code>app/Http/Middleware</code> directory.</p>

<p><a name="defining-middleware"></a></p>

<h2>Defining Middleware</h2>

<p>To create a new middleware, use the <code>make:middleware</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">middleware</span> <span class="nx">OldMiddleware</span>
</pre></div>

<p>This command will place a new <code>OldMiddleware</code> class within your <code>app/Http/Middleware</code> directory. In this middleware, we will only allow access to the route if the supplied <code>age</code> is greater than 200. Otherwise, we will redirect the users back to the &quot;home&quot; URI.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OldMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the request filter.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>As you can see, if the given <code>age</code> is less than or equal to <code>200</code>, the middleware will return an HTTP redirect to the client; otherwise, the request will be passed further into the application. To pass the request deeper into the application (allowing the middleware to &quot;pass&quot;), simply call the <code>$next</code> callback with the <code>$request</code>.</p>

<p>It&#39;s best to envision middleware as a series of &quot;layers&quot; HTTP requests must pass through before they hit your application. Each layer can examine the request and even reject it entirely.</p>

<h3><em>Before</em> / <em>After</em> Middleware</h3>

<p>Whether a middleware runs before or after a request depends on the middleware itself. For example, the following middleware would perform some task <strong>before</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BeforeMiddleware</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>However, this middleware would perform its task <strong>after</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AfterMiddleware</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-middleware"></a></p>

<h2>Registering Middleware</h2>

<h3>Global Middleware</h3>

<p>If you want a middleware to be run during every HTTP request to your application, simply list the middleware class in the <code>$middleware</code> property of your <code>app/Http/Kernel.php</code> class.</p>

<h3>Assigning Middleware To Routes</h3>

<p>If you would like to assign middleware to specific routes, you should first assign the middleware a short-hand key in your <code>app/Http/Kernel.php</code> file. By default, the <code>$routeMiddleware</code> property of this class contains entries for the middleware included with Laravel. To add your own, simply append it to this list and assign it a key of your choosing. For example:</p>
<div class="highlight"><pre><span></span><span class="c1">// Within App\Http\Kernel Class...</span>

<span class="kr">protected</span> <span class="nx">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;auth&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">Authenticate</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;auth.basic&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AuthenticateWithBasicAuth</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;guest&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">RedirectIfAuthenticated</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Once the middleware has been defined in the HTTP kernel, you may use the <code>middleware</code> key in the route options array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p>Use an array to assign multiple middleware to the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p>Instead of using an array, you may also chain the <code>middleware</code> method onto the route definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="middleware-parameters"></a></p>

<h2>Middleware Parameters</h2>

<p>Middleware can also receive additional custom parameters. For example, if your application needs to verify that the authenticated user has a given &quot;role&quot; before performing a given action, you could create a <code>RoleMiddleware</code> that receives a role name as an additional argument.</p>

<p>Additional middleware parameters will be passed to the middleware after the <code>$next</code> argument:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RoleMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the request filter.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @param  string  $role</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasRole</span><span class="p">(</span><span class="nv">$role</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Redirect...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Middleware parameters may be specified when defining the route by separating the middleware name and parameters with a <code>:</code>. Multiple parameters should be delimited by commas:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;post/{id}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;role:editor&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p><a name="terminable-middleware"></a></p>

<h2>Terminable Middleware</h2>

<p>Sometimes a middleware may need to do some work after the HTTP response has already been sent to the browser. For example, the &quot;session&quot; middleware included with Laravel writes the session data to storage <em>after</em> the response has been sent to the browser. To accomplish this, define the middleware as &quot;terminable&quot; by adding a <code>terminate</code> method to the middleware:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Session\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StartSession</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">terminate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Store the session data...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>terminate</code> method should receive both the request and the response. Once you have defined a terminable middleware, you should add it to the list of global middlewares in your HTTP kernel.</p>

<p>When calling the <code>terminate</code> method on your middleware, Laravel will resolve a fresh instance of the middleware from the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. If you would like to use the same middleware instance when the <code>handle</code> and <code>terminate</code> methods are called, register the middleware with the container using the container&#39;s <code>singleton</code> method.</p>
<div style="page-break-after: always;" ></div><h1>Database: Migrations</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#generating-migrations">Generating Migrations</a></li>
<li><a href="#migration-structure">Migration Structure</a></li>
<li><a href="#running-migrations">Running Migrations</a>

<ul>
<li><a href="#rolling-back-migrations">Rolling Back Migrations</a></li>
</ul></li>
<li><a href="#writing-migrations">Writing Migrations</a>

<ul>
<li><a href="#creating-tables">Creating Tables</a></li>
<li><a href="#renaming-and-dropping-tables">Renaming / Dropping Tables</a></li>
<li><a href="#creating-columns">Creating Columns</a></li>
<li><a href="#modifying-columns">Modifying Columns</a></li>
<li><a href="#dropping-columns">Dropping Columns</a></li>
<li><a href="#creating-indexes">Creating Indexes</a></li>
<li><a href="#dropping-indexes">Dropping Indexes</a></li>
<li><a href="#foreign-key-constraints">Foreign Key Constraints</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Migrations are like version control for your database, allowing a team to easily modify and share the application&#39;s database schema. Migrations are typically paired with Laravel&#39;s schema builder to easily build your application&#39;s database schema.</p>

<p>The Laravel <code>Schema</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> provides database agnostic support for creating and manipulating tables. It shares the same expressive, fluent API across all of Laravel&#39;s supported database systems.</p>

<p><a name="generating-migrations"></a></p>

<h2>Generating Migrations</h2>

<p>To create a migration, use the <code>make:migration</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span>
</pre></div>

<p>The new migration will be placed in your <code>database/migrations</code> directory. Each migration file name contains a timestamp which allows Laravel to determine the order of the migrations.</p>

<p>The <code>--table</code> and <code>--create</code> options may also be used to indicate the name of the table and whether the migration will be creating a new table. These options simply pre-fill the generated migration stub file with the specified table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">add_votes_to_users_table</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">users</span>
</pre></div>

<p>If you would like to specify a custom output path for the generated migration, you may use the <code>--path</code> option when executing the <code>make:migration</code> command. The provided path should be relative to your application&#39;s base path.</p>

<p><a name="migration-structure"></a></p>

<h2>Migration Structure</h2>

<p>A migration class contains two methods: <code>up</code> and <code>down</code>. The <code>up</code> method is used to add new tables, columns, or indexes to your database, while the <code>down</code> method should simply reverse the operations performed by the <code>up</code> method.</p>

<p>Within both of these methods you may use the Laravel schema builder to expressively create and modify tables. To learn about all of the methods available on the <code>Schema</code> builder, <a href="#creating-tables">check out its documentation</a>. For example, let&#39;s look at a sample migration that creates a <code>flights</code> table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateFlightsTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;airline&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Reverse the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="running-migrations"></a></p>

<h2>Running Migrations</h2>

<p>To run all outstanding migrations for your application, use the <code>migrate</code> Artisan command. If you are using the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead virtual machine</a>, you should run this command from within your VM:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>If you receive a &quot;class not found&quot; error when running migrations, try running the <code>composer dump-autoload</code> command and re-issuing the migrate command.</p>

<h4>Forcing Migrations To Run In Production</h4>

<p>Some migration operations are destructive, meaning they may cause you to lose data. In order to protect you from running these commands against your production database, you will be prompted for confirmation before these commands are executed. To force the commands to run without a prompt, use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p><a name="rolling-back-migrations"></a></p>

<h3>Rolling Back Migrations</h3>

<p>To rollback the latest migration &quot;operation&quot;, you may use the <code>rollback</code> command. Note that this rolls back the last &quot;batch&quot; of migrations that ran, which may include multiple migration files:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">rollback</span>
</pre></div>

<p>The <code>migrate:reset</code> command will roll back all of your application&#39;s migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">reset</span>
</pre></div>

<h4>Rollback / Migrate In Single Command</h4>

<p>The <code>migrate:refresh</code> command will first roll back all of your database migrations, and then run the <code>migrate</code> command. This command effectively re-creates your entire database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p><a name="writing-migrations"></a></p>

<h2>Writing Migrations</h2>

<p><a name="creating-tables"></a></p>

<h3>Creating Tables</h3>

<p>To create a new database table, use the <code>create</code> method on the <code>Schema</code> facade. The <code>create</code> method accepts two arguments. The first is the name of the table, while the second is a <code>Closure</code> which receives a <code>Blueprint</code> object used to define the new table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, when creating the table, you may use any of the schema builder&#39;s <a href="#creating-columns">column methods</a> to define the table&#39;s columns.</p>

<h4>Checking For Table / Column Existence</h4>

<p>You may easily check for the existence of a table or column using the <code>hasTable</code> and <code>hasColumn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasTable</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasColumn</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Connection &amp; Storage Engine</h4>

<p>If you want to perform a schema operation on a database connection that is not your default connection, use the <code>connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>To set the storage engine for a table, set the <code>engine</code> property on the schema builder:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">engine</span> <span class="o">=</span> <span class="s1">&#39;InnoDB&#39;</span><span class="p">;</span>

    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="renaming-and-dropping-tables"></a></p>

<h3>Renaming / Dropping Tables</h3>

<p>To rename an existing database table, use the <code>rename</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">rename</span><span class="p">(</span><span class="nx">$from</span><span class="p">,</span> <span class="nx">$to</span><span class="p">);</span>
</pre></div>

<p>To drop an existing table, you may use the <code>drop</code> or <code>dropIfExists</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>

<span class="nx">Schema</span><span class="o">::</span><span class="nx">dropIfExists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="creating-columns"></a></p>

<h3>Creating Columns</h3>

<p>To update an existing table, we will use the <code>table</code> method on the <code>Schema</code> facade. Like the <code>create</code> method, the <code>table</code> method accepts two arguments: the name of the table and a <code>Closure</code> that receives a <code>Blueprint</code> instance we can use to add columns to the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Available Column Types</h4>

<p>Of course, the schema builder contains a variety of column types that you may use when building your tables:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;bigIncrements(&#39;id&#39;);</code>  |  Incrementing ID (primary key) using a &quot;UNSIGNED BIG INTEGER&quot; equivalent.
<code>$table-&gt;bigInteger(&#39;votes&#39;);</code>  |  BIGINT equivalent for the database.
<code>$table-&gt;binary(&#39;data&#39;);</code>  |  BLOB equivalent for the database.
<code>$table-&gt;boolean(&#39;confirmed&#39;);</code>  |  BOOLEAN equivalent for the database.
<code>$table-&gt;char(&#39;name&#39;, 4);</code>  |  CHAR equivalent with a length.
<code>$table-&gt;date(&#39;created_at&#39;);</code>  |  DATE equivalent for the database.
<code>$table-&gt;dateTime(&#39;created_at&#39;);</code>  |  DATETIME equivalent for the database.
<code>$table-&gt;decimal(&#39;amount&#39;, 5, 2);</code>  |  DECIMAL equivalent with a precision and scale.
<code>$table-&gt;double(&#39;column&#39;, 15, 8);</code>  |  DOUBLE equivalent with precision, 15 digits in total and 8 after the decimal point.
<code>$table-&gt;enum(&#39;choices&#39;, [&#39;foo&#39;, &#39;bar&#39;]);</code> | ENUM equivalent for the database.
<code>$table-&gt;float(&#39;amount&#39;);</code>  |  FLOAT equivalent for the database.
<code>$table-&gt;increments(&#39;id&#39;);</code>  |  Incrementing ID (primary key) using a &quot;UNSIGNED INTEGER&quot; equivalent.
<code>$table-&gt;integer(&#39;votes&#39;);</code>  |  INTEGER equivalent for the database.
<code>$table-&gt;json(&#39;options&#39;);</code>  |  JSON equivalent for the database.
<code>$table-&gt;jsonb(&#39;options&#39;);</code>  |  JSONB equivalent for the database.
<code>$table-&gt;longText(&#39;description&#39;);</code>  |  LONGTEXT equivalent for the database.
<code>$table-&gt;mediumInteger(&#39;numbers&#39;);</code>  |  MEDIUMINT equivalent for the database.
<code>$table-&gt;mediumText(&#39;description&#39;);</code>  |  MEDIUMTEXT equivalent for the database.
<code>$table-&gt;morphs(&#39;taggable&#39;);</code>  |  Adds INTEGER <code>taggable_id</code> and STRING <code>taggable_type</code>.
<code>$table-&gt;nullableTimestamps();</code>  |  Same as <code>timestamps()</code>, except allows NULLs.
<code>$table-&gt;rememberToken();</code>  |  Adds <code>remember_token</code> as VARCHAR(100) NULL.
<code>$table-&gt;smallInteger(&#39;votes&#39;);</code>  |  SMALLINT equivalent for the database.
<code>$table-&gt;softDeletes();</code>  |  Adds <code>deleted_at</code> column for soft deletes.
<code>$table-&gt;string(&#39;email&#39;);</code>  |  VARCHAR equivalent column.
<code>$table-&gt;string(&#39;name&#39;, 100);</code>  |  VARCHAR equivalent with a length.
<code>$table-&gt;text(&#39;description&#39;);</code>  |  TEXT equivalent for the database.
<code>$table-&gt;time(&#39;sunrise&#39;);</code>  |  TIME equivalent for the database.
<code>$table-&gt;tinyInteger(&#39;numbers&#39;);</code>  |  TINYINT equivalent for the database.
<code>$table-&gt;timestamp(&#39;added_on&#39;);</code>  |  TIMESTAMP equivalent for the database.
<code>$table-&gt;timestamps();</code>  |  Adds <code>created_at</code> and <code>updated_at</code> columns.
<code>$table-&gt;uuid(&#39;id&#39;);</code>  |  UUID equivalent for the database.</p>

<h4>Column Modifiers</h4>

<p>In addition to the column types listed above, there are several other column &quot;modifiers&quot; which you may use while adding the column. For example, to make the column &quot;nullable&quot;, you may use the <code>nullable</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Below is a list of all the available column modifiers. This list does not include the <a href="#creating-indexes">index modifiers</a>:</p>

<p>Modifier  | Description
------------- | -------------
<code>-&gt;first()</code>  |  Place the column &quot;first&quot; in the table (MySQL Only)
<code>-&gt;after(&#39;column&#39;)</code>  |  Place the column &quot;after&quot; another column (MySQL Only)
<code>-&gt;nullable()</code>  |  Allow NULL values to be inserted into the column
<code>-&gt;default($value)</code>  |  Specify a &quot;default&quot; value for the column
<code>-&gt;unsigned()</code>  |  Set <code>integer</code> columns to <code>UNSIGNED</code></p>

<p><a name="changing-columns"></a>
<a name="modifying-columns"></a></p>

<h3>Modifying Columns</h3>

<h4>Prerequisites</h4>

<p>Before modifying a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file. The Doctrine DBAL library is used to determine the current state of the column and create the SQL queries needed to make the specified adjustments to the column.</p>

<h4>Updating Column Attributes</h4>

<p>The <code>change</code> method allows you to modify an existing column to a new type, or modify the column&#39;s attributes. For example, you may wish to increase the size of a string column. To see the <code>change</code> method in action, let&#39;s increase the size of the <code>name</code> column from 25 to 50:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>We could also modify a column to be nullable:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="renaming-columns"></a></p>

<h4>Renaming Columns</h4>

<p>To rename a column, you may use the <code>renameColumn</code> method on the Schema builder. Before renaming a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">renameColumn</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Renaming columns in a table with a <code>enum</code> column is not currently supported.</p>
</blockquote>

<p><a name="dropping-columns"></a></p>

<h3>Dropping Columns</h3>

<p>To drop a column, use the <code>dropColumn</code> method on the Schema builder:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may drop multiple columns from a table by passing an array of column names to the <code>dropColumn</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Before dropping columns from a SQLite database, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file and run the <code>composer update</code> command in your terminal to install the library.</p>

<p><strong>Note:</strong> Dropping or modifying multiple columns within a single migration while using a SQLite database is not supported.</p>
</blockquote>

<p><a name="creating-indexes"></a></p>

<h3>Creating Indexes</h3>

<p>The schema builder supports several types of indexes. First, let&#39;s look at an example that specifies a column&#39;s values should be unique. To create the index, we can simply chain the <code>unique</code> method onto the column definition:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may create the index after defining the column. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<p>You may even pass an array of columns to an index method to create a compound index:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">index</span><span class="p">([</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Available Index Types</h4>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;primary(&#39;id&#39;);</code>  |  Add a primary key.
<code>$table-&gt;primary([&#39;first&#39;, &#39;last&#39;]);</code>  |  Add composite keys.
<code>$table-&gt;unique(&#39;email&#39;);</code>  |  Add a unique index.
<code>$table-&gt;index(&#39;state&#39;);</code>  |  Add a basic index.</p>

<p><a name="dropping-indexes"></a></p>

<h3>Dropping Indexes</h3>

<p>To drop an index, you must specify the index&#39;s name. By default, Laravel automatically assigns a reasonable name to the indexes. Simply concatenate the table name, the name of the indexed column, and the index type. Here are some examples:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;dropPrimary(&#39;users_id_primary&#39;);</code>  |  Drop a primary key from the &quot;users&quot; table.
<code>$table-&gt;dropUnique(&#39;users_email_unique&#39;);</code>  |  Drop a unique index from the &quot;users&quot; table.
<code>$table-&gt;dropIndex(&#39;geo_state_index&#39;);</code>  |  Drop a basic index from the &quot;geo&quot; table.</p>

<p>If you pass an array of columns into a method that drops indexes, the conventional index name will be generated based on the table name, columns and key type.</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropIndex</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">]);</span> <span class="c1">// Drops index &#39;geo_state_index&#39;</span>
<span class="p">});</span>
</pre></div>

<p><a name="foreign-key-constraints"></a></p>

<h3>Foreign Key Constraints</h3>

<p>Laravel also provides support for creating foreign key constraints, which are used to force referential integrity at the database level. For example, let&#39;s define a <code>user_id</code> column on the <code>posts</code> table that references the <code>id</code> column on a <code>users</code> table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unsigned</span><span class="p">();</span>

    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may also specify the desired action for the &quot;on delete&quot; and &quot;on update&quot; properties of the constraint:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">onDelete</span><span class="p">(</span><span class="s1">&#39;cascade&#39;</span><span class="p">);</span>
</pre></div>

<p>To drop a foreign key, you may use the <code>dropForeign</code> method. Foreign key constraints use the same naming convention as indexes. So, we will concatenate the table name and the columns in the constraint then suffix the name with &quot;_foreign&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">(</span><span class="s1">&#39;posts_user_id_foreign&#39;</span><span class="p">);</span>
</pre></div>

<p>Or you may pass an array value which will automatically use the conventional constraint name when dropping:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span><span class="p">]);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Package Development</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#service-providers">Service Providers</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#resources">Resources</a>

<ul>
<li><a href="#views">Views</a></li>
<li><a href="#translations">Translations</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul></li>
<li><a href="#public-assets">Public Assets</a></li>
<li><a href="#publishing-file-groups">Publishing File Groups</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Packages are the primary way of adding functionality to Laravel. Packages might be anything from a great way to work with dates like <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, or an entire BDD testing framework like <a href="https://github.com/Behat/Behat">Behat</a>.</p>

<p>Of course, there are different types of packages. Some packages are stand-alone, meaning they work with any framework, not just Laravel. Both Carbon and Behat are examples of stand-alone packages. Any of these packages may be used with Laravel by simply requesting them in your <code>composer.json</code> file.</p>

<p>On the other hand, other packages are specifically intended for use with Laravel. These packages may have routes, controllers, views, and configuration specifically intended to enhance a Laravel application. This guide primarily covers the development of those packages that are Laravel specific.</p>

<p><a name="service-providers"></a></p>

<h2>Service Providers</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/providers">Service providers</a> are the connection points between your package and Laravel. A service provider is responsible for binding things into Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and informing Laravel where to load package resources such as views, configuration, and localization files.</p>

<p>A service provider extends the <code>Illuminate\Support\ServiceProvider</code> class and contains two methods: <code>register</code> and <code>boot</code>. The base <code>ServiceProvider</code> class is located in the <code>illuminate/support</code> Composer package, which you should add to your own package&#39;s dependencies.</p>

<p>To learn more about the structure and purpose of service providers, check out <a href="/docs/%7B%7Bversion%7D%7D/providers">their documentation</a>.</p>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p>To define routes for your package, simply <code>require</code> the routes file from within your package service provider&#39;s <code>boot</code> method. From within your routes file, you may use the <code>Route</code> facade to <a href="/docs/%7B%7Bversion%7D%7D/routing">register routes</a> just as you would within a typical Laravel application:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">routesAreCached</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">require</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../../routes.php&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="resources"></a></p>

<h2>Resources</h2>

<p><a name="views"></a></p>

<h3>Views</h3>

<p>To register your package&#39;s <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> with Laravel, you need to tell Laravel where the views are located. You may do this using the service provider&#39;s <code>loadViewsFrom</code> method. The <code>loadViewsFrom</code> method accepts two arguments: the path to your view templates and your package&#39;s name. For example, if your package name is &quot;courier&quot;, add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Package views are referenced using a double-colon <code>package::view</code> syntax. So, you may load the <code>admin</code> view from the <code>courier</code> package like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;courier::admin&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Overriding Package Views</h4>

<p>When you use the <code>loadViewsFrom</code> method, Laravel actually registers <strong>two</strong> locations for your views: one in the application&#39;s <code>resources/views/vendor</code> directory and one in the directory you specify. So, using our <code>courier</code> example: when requesting a package view, Laravel will first check if a custom version of the view has been provided by the developer in <code>resources/views/vendor/courier</code>. Then, if the view has not been customized, Laravel will search the package view directory you specified in your call to <code>loadViewsFrom</code>. This makes it easy for end-users to customize / override your package&#39;s views.</p>

<h4>Publishing Views</h4>

<p>If you would like to make your views available for publishing to the application&#39;s <code>resources/views/vendor</code> directory, you may use the service provider&#39;s <code>publishes</code> method. The <code>publishes</code> method accepts an array of package view paths and their corresponding publish locations.</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span> <span class="p">=&gt;</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;resources/views/vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> Artisan command, your package&#39;s views will be copied to the specified location.</p>

<p><a name="translations"></a></p>

<h3>Translations</h3>

<p>If your package contains <a href="/docs/%7B%7Bversion%7D%7D/localization">translation files</a>, you may use the <code>loadTranslationsFrom</code> method to inform Laravel how to load them. For example, if your package is named &quot;courier&quot;, you should add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadTranslationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Package translations are referenced using a double-colon <code>package::file.line</code> syntax. So, you may load the <code>courier</code> package&#39;s <code>welcome</code> line from the <code>messages</code> file like so:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;courier::messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<h4>Publishing Translations</h4>

<p>If you would like to publish your package&#39;s translations to the application&#39;s <code>resources/lang/vendor</code> directory, you may use the service provider&#39;s <code>publishes</code> method. The <code>publishes</code> method accepts an array of package paths and their corresponding publish locations. For example, to the publish the translation files for our example <code>courier</code> package:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadTranslationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span> <span class="p">=&gt;</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;resources/lang/vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> Artisan command, your package&#39;s translations will be published to the specified location.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>Typically, you will want to publish your package&#39;s configuration file to the application&#39;s own <code>config</code> directory. This will allow users of your package to easily override your default configuration options. To publish a configuration file, just use the <code>publishes</code> method from the <code>boot</code> method of your service provider:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;courier.php&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> command, your file will be copied to the specified location. Of course, once your configuration has been published, it can be accessed like any other configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;courier.option&#39;</span><span class="p">);</span>
</pre></div>

<h4>Default Package Configuration</h4>

<p>You may also choose to merge your own package configuration file with the application&#39;s copy. This allows your users to include only the options they actually want to override in the published copy of the configuration. To merge the configurations, use the <code>mergeConfigFrom</code> method within your service provider&#39;s <code>register</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register bindings in the container.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mergeConfigFrom</span><span class="p">(</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="public-assets"></a></p>

<h2>Public Assets</h2>

<p>Your packages may have assets such as JavaScript, CSS, and images. To publish these assets to the application&#39;s <code>public</code> directory, use the service provider&#39;s <code>publishes</code> method. In this example, we will also add a <code>public</code> asset group tag, which may be used to publish groups of related assets:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/assets&#39;</span> <span class="p">=&gt;</span> <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">],</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when your package&#39;s users execute the <code>vendor:publish</code> command, your assets will be copied to the specified location. Since you typically will need to overwrite the assets every time the package is updated, you may use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="kr">public</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p>If you would like to make sure your public assets are always up-to-date, you can add this command to the <code>post-update-cmd</code> list in your <code>composer.json</code> file.</p>

<p><a name="publishing-file-groups"></a></p>

<h2>Publishing File Groups</h2>

<p>You may want to publish groups of package assets and resources separately. For instance, you might want your users to be able to publish your package&#39;s configuration files without being forced to publish your package&#39;s assets at the same time. You may do this by &quot;tagging&quot; them when calling the <code>publishes</code> method. For example, let&#39;s define two publish groups in the <code>boot</code> method of a package service provider:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Perform post-registration booting of services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../config/package.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;package.php&#39;</span><span class="p">)</span>
    <span class="p">],</span> <span class="s1">&#39;config&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../database/migrations/&#39;</span> <span class="p">=&gt;</span> <span class="nx">database_path</span><span class="p">(</span><span class="s1">&#39;migrations&#39;</span><span class="p">)</span>
    <span class="p">],</span> <span class="s1">&#39;migrations&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Now your users may publish these groups separately by referencing their tag name when using the <code>vendor:publish</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&quot;Vendor\Providers\PackageServiceProvider&quot;</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="s2">&quot;config&quot;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Pagination</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#paginating-query-builder-results">Paginating Query Builder Results</a></li>
<li><a href="#paginating-eloquent-results">Paginating Eloquent Results</a></li>
<li><a href="#manually-creating-a-paginator">Manually Creating A Paginator</a></li>
</ul></li>
<li><a href="#displaying-results-in-a-view">Displaying Results In A View</a></li>
<li><a href="#converting-results-to-json">Converting Results To JSON</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In other frameworks, pagination can be very painful. Laravel makes it a breeze. Laravel can quickly generate an intelligent &quot;range&quot; of links based on the current page, and the generated HTML is compatible with the <a href="http://getbootstrap.com/">Bootstrap CSS framework</a>.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p><a name="paginating-query-builder-results"></a></p>

<h3>Paginating Query Builder Results</h3>

<p>There are several ways to paginate items. The simplest is by using the <code>paginate</code> method on the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> or an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent query</a>. The <code>paginate</code> method provided by Laravel automatically takes care of setting the proper limit and offset based on the current page being viewed by the user. By default, the current page is detected by the value of the <code>?page</code> query string argument on the HTTP request. Of course, this value is automatically detected by Laravel, and is also automatically inserted into links generated by the paginator.</p>

<p>First, let&#39;s take a look at calling the <code>paginate</code> method on a query. In this example, the only argument passed to <code>paginate</code> is the number of items you would like displayed &quot;per page&quot;. In this case, let&#39;s specify that we would like to display <code>15</code> items per page:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show all of the users for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Currently, pagination operations that use a <code>groupBy</code> statement cannot be executed efficiently by Laravel. If you need to use a <code>groupBy</code> with a paginated result set, it is recommended that you query the database and create a paginator manually.</p>
</blockquote>

<h4>&quot;Simple Pagination&quot;</h4>

<p>If you only need to display simple &quot;Next&quot; and &quot;Previous&quot; links in your pagination view, you have the option of using the <code>simplePaginate</code> method to perform a more efficient query. This is very useful for large datasets if you do not need to display a link for each page number when rendering your view:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p><a name="paginating-eloquent-results"></a></p>

<h3>Paginating Eloquent Results</h3>

<p>You may also paginate <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> queries. In this example, we will paginate the <code>User</code> model with <code>15</code> items per page. As you can see, the syntax is nearly identical to paginating query builder results:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>Of course, you may call <code>paginate</code> after setting other constraints on the query, such as <code>where</code> clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>You may also use the <code>simplePaginate</code> method when paginating Eloquent models:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p><a name="manually-creating-a-paginator"></a></p>

<h3>Manually Creating A Paginator</h3>

<p>Sometimes you may wish to create a pagination instance manually, passing it an array of items. You may do so by creating either an <code>Illuminate\Pagination\Paginator</code> or <code>Illuminate\Pagination\LengthAwarePaginator</code> instance, depending on your needs.</p>

<p>The <code>Paginator</code> class does not need to know the total number of items in the result set; however, because of this, the class does not have methods for retrieving the index of the last page. The <code>LengthAwarePaginator</code> accepts almost the same arguments as the <code>Paginator</code>; however, it does require a count of the total number of items in the result set.</p>

<p>In other words, the <code>Paginator</code> corresponds to the <code>simplePaginate</code> method on the query builder and Eloquent, while the <code>LengthAwarePaginator</code> corresponds to the <code>paginate</code> method.</p>

<p>When manually creating a paginator instance, you should manually &quot;slice&quot; the array of results you pass to the paginator. If you&#39;re unsure how to do this, check out the <a href="http://php.net/manual/en/function.array-slice.php">array_slice</a> PHP function.</p>

<p><a name="displaying-results-in-a-view"></a></p>

<h2>Displaying Results In A View</h2>

<p>When you call the <code>paginate</code> or <code>simplePaginate</code> methods on a query builder or Eloquent query, you will receive a paginator instance. When calling the <code>paginate</code> method, you will receive an instance of <code>Illuminate\Pagination\LengthAwarePaginator</code>. When calling the <code>simplePaginate</code> method, you will receive an instance of <code>Illuminate\Pagination\Paginator</code>. These objects provide several methods that describe the result set. In addition to these helpers methods, the paginator instances are iterators and may be looped as an array.</p>

<p>So, once you have retrieved the results, you may display the results and render the page links using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
        <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="p">{</span><span class="o">!!</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">render</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>
</pre></div>

<p>The <code>render</code> method will render the links to the rest of the pages in the result set. Each of these links will already contain the proper <code>?page</code> query string variable. Remember, the HTML generated by the <code>render</code> method is compatible with the <a href="https://getbootstrap.com">Bootstrap CSS framework</a>.</p>

<blockquote>
<p><strong>Note:</strong> When calling the <code>render</code> method from a Blade template, be sure to use the <code>{!! !!}</code> syntax so the HTML links are not escaped.</p>
</blockquote>

<h4>Customizing The Paginator URI</h4>

<p>The <code>setPath</code> method allows you to customize the URI used by the paginator when generating links. For example, if you want the paginator to generate links like <code>http://example.com/custom/url?page=N</code>, you should pass <code>custom/url</code> to the <code>setPath</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

    <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">setPath</span><span class="p">(</span><span class="s1">&#39;custom/url&#39;</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Appending To Pagination Links</h4>

<p>You may add to the query string of pagination links using the <code>appends</code> method. For example, to append <code>&amp;sort=votes</code> to each pagination link, you should make the following call to <code>appends</code>:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="o">!!</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">appends</span><span class="p">([</span><span class="s1">&#39;sort&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;votes&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">render</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>
</pre></div>

<p>If you wish to append a &quot;hash fragment&quot; to the paginator&#39;s URLs, you may use the <code>fragment</code> method. For example, to append <code>#foo</code> to the end of each pagination link, make the following call to the <code>fragment</code> method:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="o">!!</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">fragment</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">render</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>
</pre></div>

<h4>Additional Helper Methods</h4>

<p>You may also access additional pagination information via the following methods on paginator instances:</p>

<ul>
<li><code>$results-&gt;count()</code></li>
<li><code>$results-&gt;currentPage()</code></li>
<li><code>$results-&gt;hasMorePages()</code></li>
<li><code>$results-&gt;lastPage() (Not available when using simplePaginate)</code></li>
<li><code>$results-&gt;nextPageUrl()</code></li>
<li><code>$results-&gt;perPage()</code></li>
<li><code>$results-&gt;previousPageUrl()</code></li>
<li><code>$results-&gt;total() (Not available when using simplePaginate)</code></li>
<li><code>$results-&gt;url($page)</code></li>
</ul>

<p><a name="converting-results-to-json"></a></p>

<h2>Converting Results To JSON</h2>

<p>The Laravel paginator result classes implement the <code>Illuminate\Contracts\Support\JsonableInterface</code> contract and expose the <code>toJson</code> method, so it&#39;s very easy to convert your pagination results to JSON.</p>

<p>You may also convert a paginator instance to JSON by simply returning it from a route or controller action:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The JSON from the paginator will include meta information such as <code>total</code>, <code>current_page</code>, <code>last_page</code>, and more. The actual result objects will be available via the <code>data</code> key in the JSON array. Here is an example of the JSON created by returning a paginator instance from a route:</p>

<h4>Example Paginator JSON</h4>
<div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;total&quot;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
   <span class="s2">&quot;per_page&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
   <span class="s2">&quot;current_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;last_page&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
   <span class="s2">&quot;next_page_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://laravel.app?page=2&quot;</span><span class="p">,</span>
   <span class="s2">&quot;prev_page_url&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="s2">&quot;from&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;to&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
   <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="c1">// Result Object</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="c1">// Result Object</span>
        <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Service Providers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-service-providers">Writing Service Providers</a>

<ul>
<li><a href="#the-register-method">The Register Method</a></li>
<li><a href="#the-boot-method">The Boot Method</a></li>
</ul></li>
<li><a href="#registering-providers">Registering Providers</a></li>
<li><a href="#deferred-providers">Deferred Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Service providers are the central place of all Laravel application bootstrapping. Your own application, as well as all of Laravel&#39;s core services are bootstrapped via service providers.</p>

<p>But, what do we mean by &quot;bootstrapped&quot;? In general, we mean <strong>registering</strong> things, including registering service container bindings, event listeners, middleware, and even routes. Service providers are the central place to configure your application.</p>

<p>If you open the <code>config/app.php</code> file included with Laravel, you will see a <code>providers</code> array. These are all of the service provider classes that will be loaded for your application. Of course, many of them are &quot;deferred&quot; providers, meaning they will not be loaded on every request, but only when the services they provide are actually needed.</p>

<p>In this overview you will learn how to write your own service providers and register them with your Laravel application.</p>

<p><a name="writing-service-providers"></a></p>

<h2>Writing Service Providers</h2>

<p>All service providers extend the <code>Illuminate\Support\ServiceProvider</code> class. This abstract class requires that you define at least one method on your provider: <code>register</code>. Within the <code>register</code> method, you should <strong>only bind things into the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a></strong>. You should never attempt to register any event listeners, routes, or any other piece of functionality within the <code>register</code> method.</p>

<p>The Artisan CLI can easily generate a new provider via the <code>make:provider</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">provider</span> <span class="nx">RiakServiceProvider</span>
</pre></div>

<p><a name="the-register-method"></a></p>

<h3>The Register Method</h3>

<p>As mentioned previously, within the <code>register</code> method, you should only bind things into the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. You should never attempt to register any event listeners, routes, or any other piece of functionality within the <code>register</code> method. Otherwise, you may accidently use a service that is provided by a service provider which has not loaded yet.</p>

<p>Now, let&#39;s take a look at a basic service provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This service provider only defines a <code>register</code> method, and uses that method to define an implementation of <code>Riak\Contracts\Connection</code> in the service container. If you don&#39;t understand how the service container works, check out <a href="/docs/%7B%7Bversion%7D%7D/container">its documentation</a>.</p>

<p><a name="the-boot-method"></a></p>

<h3>The Boot Method</h3>

<p>So, what if we need to register a view composer within our service provider? This should be done within the <code>boot</code> method. <strong>This method is called after all other service providers have been registered</strong>, meaning you have access to all other services that have been registered by the framework:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Boot Method Dependency Injection</h4>

<p>We are able to type-hint dependencies for our <code>boot</code> method. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject any dependencies you need:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">ResponseFactory</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">ResponseFactory</span> <span class="nx">$factory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-providers"></a></p>

<h2>Registering Providers</h2>

<p>All service providers are registered in the <code>config/app.php</code> configuration file. This file contains a <code>providers</code> array where you can list the names of your service providers. By default, a set of Laravel core service providers are listed in this array. These providers bootstrap the core Laravel components, such as the mailer, queue, cache, and others.</p>

<p>To register your provider, simply add it to the array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// Other Service Providers</span>

    <span class="nx">App</span><span class="err">\</span><span class="nx">Providers</span><span class="err">\</span><span class="nx">AppServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="deferred-providers"></a></p>

<h2>Deferred Providers</h2>

<p>If your provider is <strong>only</strong> registering bindings in the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, you may choose to defer its registration until one of the registered bindings is actually needed. Deferring the loading of such a provider will improve the performance of your application, since it is not loaded from the filesystem on every request.</p>

<p>To defer the loading of a provider, set the <code>defer</code> property to <code>true</code> and define a <code>provides</code> method. The <code>provides</code> method returns the service container bindings that the provider registers:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Indicates if loading of the provider is deferred.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$defer</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;riak&#39;</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the services provided by the provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Laravel compiles and stores a list of all of the services supplied by deferred service providers, along with the name of its service provider class. Then, only when you attempt to resolve one of these services does Laravel load the service provider.</p>
<div style="page-break-after: always;" ></div><h1>Database: Query Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#retrieving-results">Retrieving Results</a>

<ul>
<li><a href="#aggregates">Aggregates</a></li>
</ul></li>
<li><a href="#selects">Selects</a></li>
<li><a href="#joins">Joins</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#where-clauses">Where Clauses</a>

<ul>
<li><a href="#advanced-where-clauses">Advanced Where Clauses</a></li>
</ul></li>
<li><a href="#ordering-grouping-limit-and-offset">Ordering, Grouping, Limit, &amp; Offset</a></li>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a></li>
<li><a href="#deletes">Deletes</a></li>
<li><a href="#pessimistic-locking">Pessimistic Locking</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The database query builder provides a convenient, fluent interface to creating and running database queries. It can be used to perform most database operations in your application, and works on all supported database systems.</p>

<blockquote>
<p><strong>Note:</strong> The Laravel query builder uses PDO parameter binding to protect your application against SQL injection attacks. There is no need to clean strings being passed as bindings.</p>
</blockquote>

<p><a name="retrieving-results"></a></p>

<h2>Retrieving Results</h2>

<h4>Retrieving All Rows From A Table</h4>

<p>To begin a fluent query, use the <code>table</code> method on the <code>DB</code> facade. The <code>table</code> method returns a fluent query builder instance for the given table, allowing you to chain more constraints onto the query and then finally get the results. In this example, let&#39;s just <code>get</code> all records from a table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all of the application&#39;s users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Like <a href="/docs/%7B%7Bversion%7D%7D/database">raw queries</a>, the <code>get</code> method returns an <code>array</code> of results where each result is an instance of the PHP <code>StdClass</code> object. You may access each column&#39;s value by accessing the column as a property of the object:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving A Single Row / Column From A Table</h4>

<p>If you just need to retrieve a single row from the database table, you may use the <code>first</code> method. This method will return a single <code>StdClass</code> object:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
</pre></div>

<p>If you don&#39;t even need an entire row, you may extract a single value from a record using the <code>value</code> method. This method will return the value of the column directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$email</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Chunking Results From A Table</h4>

<p>If you need to work with thousands of database records, consider using the <code>chunk</code> method. This method retrieves a small &quot;chunk&quot; of the results at a time, and feeds each chunk into a <code>Closure</code> for processing. This method is very useful for writing <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan commands</a> that process thousands of records. For example, let&#39;s work with the entire <code>users</code> table in chunks of 100 records at a time:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>You may stop further chunks from being processed by returning <code>false</code> from the <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Process the records...</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Retrieving A List Of Column Values</h4>

<p>If you would like to retrieve an array containing the values of a single column, you may use the <code>lists</code> method. In this example, we&#39;ll retrieve an array of role titles:</p>
<div class="highlight"><pre><span></span><span class="nx">$titles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$titles</span> <span class="nx">as</span> <span class="nx">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify a custom key column for the returned array:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$roles</span> <span class="nx">as</span> <span class="nx">$name</span> <span class="p">=&gt;</span> <span class="nx">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="aggregates"></a></p>

<h3>Aggregates</h3>

<p>The query builder also provides a variety of aggregate methods, such as <code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, and <code>sum</code>. You may call any of these methods after constructing your query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, you may combine these methods with other clauses to build your query:</p>
<div class="highlight"><pre><span></span><span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;finalized&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="selects"></a></p>

<h2>Selects</h2>

<h4>Specifying A Select Clause</h4>

<p>Of course, you may not always want to select all columns from a database table. Using the <code>select</code> method, you can specify a custom <code>select</code> clause for the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email as user_email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>distinct</code> method allows you to force the query to return distinct results:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">distinct</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you already have a query builder instance and you wish to add a column to its existing select clause, you may use the <code>addSelect</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">addSelect</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Raw Expressions</h4>

<p>Sometimes you may need to use a raw expression in a query. These expressions will be injected into the query as strings, so be careful not to create any SQL injection points! To create a raw expression, you may use the <code>DB::raw</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;count(*) as user_count, status&#39;</span><span class="p">))</span>
                     <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="joins"></a></p>

<h2>Joins</h2>

<h4>Inner Join Statement</h4>

<p>The query builder may also be used to write join statements. To perform a basic SQL &quot;inner join&quot;, you may use the <code>join</code> method on a query builder instance. The first argument passed to the <code>join</code> method is the name of the table you need to join to, while the remaining arguments specify the column constraints for the join. Of course, as you can see, you can join to multiple tables in a single query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;users.*&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.phone&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.price&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Left Join Statement</h4>

<p>If you would like to perform a &quot;left join&quot; instead of an &quot;inner join&quot;, use the <code>leftJoin</code> method. The <code>leftJoin</code> method has the same signature as the <code>join</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">leftJoin</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;posts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Advanced Join Statements</h4>

<p>You may also specify more advanced join clauses. To get started, pass a <code>Closure</code> as the second argument into the <code>join</code> method. The <code>Closure</code> will receive a <code>JoinClause</code> object which allows you to specify constraints on the <code>join</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$join</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orOn</span><span class="p">(...);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you would like to use a &quot;where&quot; style clause on your joins, you may use the <code>where</code> and <code>orWhere</code> methods on a join. Instead of comparing two columns, these methods will compare the column against a value:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$join</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;contacts.user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="unions"></a></p>

<h2>Unions</h2>

<p>The query builder also provides a quick way to &quot;union&quot; two queries together. For example, you may create an initial query, and then use the <code>union</code> method to union it with a second query:</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">union</span><span class="p">(</span><span class="nx">$first</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>unionAll</code> method is also available and has the same method signature as <code>union</code>.</p>

<p><a name="where-clauses"></a></p>

<h2>Where Clauses</h2>

<h4>Simple Where Clauses</h4>

<p>To add <code>where</code> clauses to the query, use the <code>where</code> method on a query builder instance. The most basic call to <code>where</code> requires three arguments. The first argument is the name of the column. The second argument is an operator, which can be any of the database&#39;s supported operators. The third argument is the value to evaluate against the column.</p>

<p>For example, here is a query that verifies the value of the &quot;votes&quot; column is equal to 100:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>For convenience, if you simply want to verify that a column is equal to a given value, you may pass the value directly as the second argument to the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Of course, you may use a variety of other operators when writing a <code>where</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;T%&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Or Statements</h4>

<p>You may chain where constraints together, as well as add <code>or</code> clauses to the query. The <code>orWhere</code> method accepts the same arguments as the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Additional Where Clauses</h4>

<p><strong>whereBetween</strong></p>

<p>The <code>whereBetween</code> method verifies that a column&#39;s value is between two values:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereNotBetween</strong></p>

<p>The <code>whereNotBetween</code> method verifies that a column&#39;s value lies outside of two values:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereIn / whereNotIn</strong></p>

<p>The <code>whereIn</code> method verifies that a given column&#39;s value is contained within the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereNotIn</code> method verifies that the given column&#39;s value is <strong>not</strong> contained in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereNull / whereNotNull</strong></p>

<p>The <code>whereNull</code> method verifies that the value of the given column is <code>NULL</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereNotNull</code> method verifies that the column&#39;s value is <strong>not</strong> <code>NULL</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="advanced-where-clauses"></a></p>

<h2>Advanced Where Clauses</h2>

<h4>Parameter Grouping</h4>

<p>Sometimes you may need to create more advanced where clauses such as &quot;where exists&quot; or nested parameter groupings. The Laravel query builder can handle these as well. To get started, let&#39;s look at an example of grouping constraints within parenthesis:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>As you can see, passing <code>Closure</code> into the <code>orWhere</code> method instructs the query builder to begin a constraint group. The <code>Closure</code> will receive a query builder instance which you can use to set the constraints that should be contained within the parenthesis group. The example above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">or</span> <span class="p">(</span><span class="nx">votes</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="nx">and</span> <span class="nx">title</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
</pre></div>

<h4>Exists Statements</h4>

<p>The <code>whereExists</code> method allows you to write <code>where exist</code> SQL clauses. The <code>whereExists</code> method accepts a <code>Closure</code> argument, which will receive a query builder instance allowing you to define the query that should be placed inside of the &quot;exists&quot; clause:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereExists</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                      <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;orders.user_id = users.id&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span>
<span class="nx">where</span> <span class="nx">exists</span> <span class="p">(</span>
    <span class="nx">select</span> <span class="mi">1</span> <span class="nx">from</span> <span class="nx">orders</span> <span class="nx">where</span> <span class="nx">orders</span><span class="p">.</span><span class="nx">user_id</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
<span class="p">)</span>
</pre></div>

<p><a name="ordering-grouping-limit-and-offset"></a></p>

<h2>Ordering, Grouping, Limit, &amp; Offset</h2>

<h4>orderBy</h4>

<p>The <code>orderBy</code> method allows you to sort the result of the query by a given column. The first argument to the <code>orderBy</code> method should be the column you wish to sort by, while the second argument controls the direction of the sort and may be either <code>asc</code> or <code>desc</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>groupBy / having / havingRaw</h4>

<p>The <code>groupBy</code> and <code>having</code> methods may be used to group the query results. The <code>having</code> method&#39;s signature is similar to that of the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">having</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>havingRaw</code> method may be used to set a raw string as the value of the <code>having</code> clause. For example, we can find all of the departments with sales greater than $2,500:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;SUM(price) as total_sales&#39;</span><span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">havingRaw</span><span class="p">(</span><span class="s1">&#39;SUM(price) &gt; 2500&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>skip / take</h4>

<p>To limit the number of results returned from the query, or to skip a given number of results in the query (<code>OFFSET</code>), you may use the <code>skip</code> and <code>take</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="inserts"></a></p>

<h2>Inserts</h2>

<p>The query builder also provides an <code>insert</code> method for inserting records into the database table. The <code>insert</code> method accepts an array of column names and values to insert:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p>You may even insert several records into the table with a single call to <code>insert</code> by passing an array of arrays. Each array represents a row to be inserted into the table:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>

<h4>Auto-Incrementing IDs</h4>

<p>If the table has an auto-incrementing id, use the <code>insertGetId</code> method to insert a record and then retrieve the ID:</p>
<div class="highlight"><pre><span></span><span class="nx">$id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insertGetId</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When using PostgreSQL the insertGetId method expects the auto-incrementing column to be named <code>id</code>. If you would like to retrieve the ID from a different &quot;sequence&quot;, you may pass the sequence name as the second parameter to the <code>insertGetId</code> method.</p>
</blockquote>

<p><a name="updates"></a></p>

<h2>Updates</h2>

<p>Of course, in addition to inserting records into the database, the query builder can also update existing records using the <code>update</code> method. The <code>update</code> method, like the <code>insert</code> method, accepts an array of column and value pairs containing the columns to be updated. You may constrain the <code>update</code> query using <code>where</code> clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Increment / Decrement</h4>

<p>The query builder also provides convenient methods for incrementing or decrementing the value of a given column. This is simply a short-cut, providing a more expressive and terse interface compared to manually writing the <code>update</code> statement.</p>

<p>Both of these methods accept at least one argument: the column to modify. A second argument may optionally be passed to control the amount by which the column should be incremented / decremented.</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may also specify additional columns to update during the operation:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="deletes"></a></p>

<h2>Deletes</h2>

<p>Of course, the query builder may also be used to delete records from the table via the <code>delete</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p>You may constrain <code>delete</code> statements by adding <code>where</code> clauses before calling the <code>delete</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p>If you wish to truncate the entire table, which will remove all rows and reset the auto-incrementing ID to zero, you may use the <code>truncate</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">truncate</span><span class="p">();</span>
</pre></div>

<p><a name="pessimistic-locking"></a></p>

<h2>Pessimistic Locking</h2>

<p>The query builder also includes a few functions to help you do &quot;pessimistic locking&quot; on your <code>select</code> statements. To run the statement with a &quot;shared lock&quot;, you may use the <code>sharedLock</code> method on a query. A shared lock prevents the selected rows from being modified until your transaction commits:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sharedLock</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may use the <code>lockForUpdate</code> method. A &quot;for update&quot; lock prevents the rows from being modified or from being selected with another shared lock:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lockForUpdate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Queues</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-job-classes">Writing Job Classes</a>

<ul>
<li><a href="#generating-job-classes">Generating Job Classes</a></li>
<li><a href="#job-class-structure">Job Class Structure</a></li>
</ul></li>
<li><a href="#pushing-jobs-onto-the-queue">Pushing Jobs Onto The Queue</a>

<ul>
<li><a href="#delayed-jobs">Delayed Jobs</a></li>
<li><a href="#dispatching-jobs-from-requests">Dispatching Jobs From Requests</a></li>
<li><a href="#job-events">Job Events</a></li>
</ul></li>
<li><a href="#running-the-queue-listener">Running The Queue Listener</a>

<ul>
<li><a href="#supervisor-configuration">Supervisor Configuration</a></li>
<li><a href="#daemon-queue-listener">Daemon Queue Listener</a></li>
<li><a href="#deploying-with-daemon-queue-listeners">Deploying With Daemon Queue Listeners</a></li>
</ul></li>
<li><a href="#dealing-with-failed-jobs">Dealing With Failed Jobs</a>

<ul>
<li><a href="#failed-job-events">Failed Job Events</a></li>
<li><a href="#retrying-failed-jobs">Retrying Failed Jobs</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel queue service provides a unified API across a variety of different queue back-ends. Queues allow you to defer the processing of a time consuming task, such as sending an e-mail, until a later time which drastically speeds up web requests to your application.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>The queue configuration file is stored in <code>config/queue.php</code>. In this file you will find connection configurations for each of the queue drivers that are included with the framework, which includes a database, <a href="http://kr.github.com/beanstalkd">Beanstalkd</a>, <a href="http://iron.io">IronMQ</a>, <a href="http://aws.amazon.com/sqs">Amazon SQS</a>, <a href="http://redis.io">Redis</a>,  and synchronous (for local use) driver.</p>

<p>A <code>null</code> queue driver is also included which simply discards queued jobs.</p>

<h3>Driver Prerequisites</h3>

<h4>Database</h4>

<p>In order to use the <code>database</code> queue driver, you will need a database table to hold the jobs. To generate a migration that creates this table, run the <code>queue:table</code> Artisan command. Once the migration is created, you may migrate your database using the <code>migrate</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h4>Other Queue Dependencies</h4>

<p>The following dependencies are needed for the listed queue drivers:</p>

<ul>
<li>Amazon SQS: <code>aws/aws-sdk-php ~3.0</code></li>
<li>Beanstalkd: <code>pda/pheanstalk ~3.0</code></li>
<li>IronMQ: <code>iron-io/iron_mq ~2.0|~4.0</code></li>
<li>Redis: <code>predis/predis ~1.0</code></li>
</ul>

<p><a name="writing-job-classes"></a></p>

<h2>Writing Job Classes</h2>

<p><a name="generating-job-classes"></a></p>

<h3>Generating Job Classes</h3>

<p>By default, all of the queueable jobs for your application are stored in the <code>app/Jobs</code> directory. You may generate a new queued job using the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">job</span> <span class="nx">SendReminderEmail</span> <span class="o">--</span><span class="nx">queued</span>
</pre></div>

<p>This command will generate a new class in the <code>app/Jobs</code> directory, and the class will implement the <code>Illuminate\Contracts\Queue\ShouldQueue</code> interface, indicating to Laravel that the job should be pushed onto the queue instead of run synchronously.</p>

<p><a name="job-class-structure"></a></p>

<h3>Job Class Structure</h3>

<p>Job classes are very simple, normally containing only a <code>handle</code> method which is called when the job is processed by the queue. To get started, let&#39;s take a look at an example job class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\Job</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Mail\Mailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Bus\SelfHandling</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendReminderEmail</span> <span class="k">extends</span> <span class="nx">Job</span> <span class="k">implements</span> <span class="nx">SelfHandling</span><span class="p">,</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new job instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  User  $user</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Mailer  $mailer</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s1">&#39;emails.reminder&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">],</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">reminders</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, note that we were able to pass an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent model</a> directly into the queued job&#39;s constructor. Because of the <code>SerializesModels</code> trait that the job is using, Eloquent models will be gracefully serialized and unserialized when the job is processing. If your queued job accepts an Eloquent model in its constructor, only the identifier for the model will be serialized onto the queue. When the job is actually handled, the queue system will automatically re-retrieve the full model instance from the database. It&#39;s all totally transparent to your application and prevents issues that can arise from serializing full Eloquent model instances.</p>

<p>The <code>handle</code> method is called when the job is processed by the queue. Note that we are able to type-hint dependencies on the <code>handle</code> method of the job. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> automatically injects these dependencies.</p>

<h4>When Things Go Wrong</h4>

<p>If an exception is thrown while the job is being processed, it will automatically be released back onto the queue so it may be attempted again. The job will continue to be released until it has been attempted the maximum number of times allowed by your application. The number of maximum attempts is defined by the <code>--tries</code> switch used on the <code>queue:listen</code> or <code>queue:work</code> Artisan jobs. More information on running the queue listener <a href="#running-the-queue-listener">can be found below</a>.</p>

<h4>Manually Releasing Jobs</h4>

<p>If you would like to <code>release</code> the job manually, the <code>InteractsWithQueue</code> trait, which is already included in your generated job class, provides access to the queue job <code>release</code> method. The <code>release</code> method accepts one argument: the number of seconds you wish to wait until the job is made available again:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nx">$mailer</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Checking The Number Of Run Attempts</h4>

<p>As noted above, if an exception occurs while the job is being processed, it will automatically be released back onto the queue. You may check the number of attempts that have been made to run the job using the <code>attempts</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nx">$mailer</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attempts</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="pushing-jobs-onto-the-queue"></a></p>

<h2>Pushing Jobs Onto The Queue</h2>

<p>The default Laravel controller located in <code>app/Http/Controllers/Controller.php</code> uses a <code>DispatchesJobs</code> trait. This trait provides several methods allowing you to conveniently push jobs onto the queue, such as the <code>dispatch</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\SendReminderEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Send a reminder e-mail to a given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendReminderEmail</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">SendReminderEmail</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, sometimes you may wish to dispatch a job from somewhere in your application besides a route or controller. For that reason, you can include the <code>DispatchesJobs</code> trait on any of the classes in your application to gain access to its various dispatch methods. For example, here is a sample class that uses the trait:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\DispatchesJobs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleClass</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">DispatchesJobs</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Specifying The Queue For A Job</h4>

<p>You may also specify the queue a job should be sent to.</p>

<p>By pushing jobs to different queues, you may &quot;categorize&quot; your queued jobs, and even prioritize how many workers you assign to various queues. This does not push jobs to different queue &quot;connections&quot; as defined by your queue configuration file, but only to specific queues within a single connection. To specify the queue, use the <code>onQueue</code> method on the job instance. The <code>onQueue</code> method is provided by the <code>Illuminate\Bus\Queueable</code> trait, which is already included on the <code>App\Jobs\Job</code> base class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\SendReminderEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Send a reminder e-mail to a given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendReminderEmail</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$job</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SendReminderEmail</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">onQueue</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$job</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="delayed-jobs"></a></p>

<h3>Delayed Jobs</h3>

<p>Sometimes you may wish to delay the execution of a queued job. For instance, you may wish to queue a job that sends a customer a reminder e-mail 15 minutes after sign-up. You may accomplish this using the <code>delay</code> method on your job class, which is provided by the <code>Illuminate\Bus\Queueable</code> trait:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\SendReminderEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Send a reminder e-mail to a given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendReminderEmail</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$job</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SendReminderEmail</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">delay</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$job</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, we&#39;re specifying that the job should be delayed in the queue for 60 seconds before being made available to workers.</p>

<blockquote>
<p><strong>Note:</strong> The Amazon SQS service has a maximum delay time of 15 minutes.</p>
</blockquote>

<p><a name="dispatching-jobs-from-requests"></a></p>

<h3>Dispatching Jobs From Requests</h3>

<p>It is very common to map HTTP request variables into jobs. So, instead of forcing you to do this manually for each request, Laravel provides some helper methods to make it a cinch. Let&#39;s take a look at the <code>dispatchFrom</code> method available on the <code>DispatchesJobs</code> trait. By default, this trait is included on the base Laravel controller class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CommerceController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Process the given order.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">processOrder</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Process the request...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dispatchFrom</span><span class="p">(</span><span class="s1">&#39;App\Jobs\ProcessOrder&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This method will examine the constructor of the given job class and extract variables from the HTTP request (or any other <code>ArrayAccess</code> object) to fill the needed constructor parameters of the job. So, if our job class accepts a <code>productId</code> variable in its constructor, the job bus will attempt to pull the <code>productId</code> parameter from the HTTP request.</p>

<p>You may also pass an array as the third argument to the <code>dispatchFrom</code> method. This array will be used to fill any constructor parameters that are not available on the request:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatchFrom</span><span class="p">(</span><span class="s1">&#39;App\Jobs\ProcessOrder&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;taxPercentage&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="job-events"></a></p>

<h3>Job Events</h3>

<h4>Job Completion Event</h4>

<p>The <code>Queue::after</code> method allows you to register a callback to be executed when a queued job executes successfully. This callback is a great opportunity to perform additional logging, queue a subsequent job, or increment statistics for a dashboard. For example, we may attach a callback to this event from the <code>AppServiceProvider</code> that is included with Laravel:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">after</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">,</span> <span class="nv">$job</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="running-the-queue-listener"></a></p>

<h2>Running The Queue Listener</h2>

<h4>Starting The Queue Listener</h4>

<p>Laravel includes an Artisan command that will run new jobs as they are pushed onto the queue. You may run the listener using the <code>queue:listen</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span>
</pre></div>

<p>You may also specify which queue connection the listener should utilize:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span>
</pre></div>

<p>Note that once this task has started, it will continue to run until it is manually stopped. You may use a process monitor such as <a href="http://supervisord.org/">Supervisor</a> to ensure that the queue listener does not stop running.</p>

<h4>Queue Priorities</h4>

<p>You may pass a comma-delimited list of queue connections to the <code>listen</code> job to set queue priorities:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">high</span><span class="p">,</span><span class="nx">low</span>
</pre></div>

<p>In this example, jobs on the <code>high</code> queue will always be processed before moving onto jobs from the <code>low</code> queue.</p>

<h4>Specifying The Job Timeout Parameter</h4>

<p>You may also set the length of time (in seconds) each job should be allowed to run:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">60</span>
</pre></div>

<h4>Specifying Queue Sleep Duration</h4>

<p>In addition, you may specify the number of seconds to wait before polling for new jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">5</span>
</pre></div>

<p>Note that the queue only &quot;sleeps&quot; if no jobs are on the queue. If more jobs are available, the queue will continue to work them without sleeping.</p>

<p><a name="supervisor-configuration"></a></p>

<h3>Supervisor Configuration</h3>

<p>Supervisor is a process monitor for the Linux operating system, and will automatically restart your <code>queue:listen</code> or <code>queue:work</code> commands if they fail. To install Supervisor on Ubuntu, you may use the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">supervisor</span>
</pre></div>

<p>Supervisor configuration files are typically stored in the <code>/etc/supervisor/conf.d</code> directory. Within this directory, you may create any number of configuration files that instruct supervisor how your processes should be monitored. For example, let&#39;s create a <code>laravel-worker.conf</code> file that starts and monitors a <code>queue:work</code> process:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">program</span><span class="o">:</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">worker</span><span class="p">]</span>
<span class="nx">process_name</span><span class="o">=%</span><span class="p">(</span><span class="nx">program_name</span><span class="p">)</span><span class="nx">s_</span><span class="o">%</span><span class="p">(</span><span class="nx">process_num</span><span class="p">)</span><span class="mi">02</span><span class="nx">d</span>
<span class="nx">command</span><span class="o">=</span><span class="nx">php</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">forge</span><span class="o">/</span><span class="nx">app</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">sqs</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">daemon</span>
<span class="nx">autostart</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">autorestart</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">user</span><span class="o">=</span><span class="nx">forge</span>
<span class="nx">numprocs</span><span class="o">=</span><span class="mi">8</span>
<span class="nx">redirect_stderr</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">stdout_logfile</span><span class="o">=</span><span class="err">/home/forge/app.com/worker.log</span>
</pre></div>

<p>In this example, the <code>numprocs</code> directive will instruct Supervisor to run 8 <code>queue:work</code> processes and monitor all of them, automatically restarting them if they fail. Of course, you should change the <code>queue:work sqs</code> portion of the <code>command</code> directive to reflect your chosen queue connection.</p>

<p>Once the configuration file has been created, you may update the Supervisor configuration and start the processes using the following commands:</p>
<div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">reread</span>

<span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">update</span>

<span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">start</span> <span class="nx">laravel</span><span class="o">-</span><span class="nx">worker</span><span class="o">:*</span>
</pre></div>

<p>For more information on configuring and using Supervisor, consult the <a href="http://supervisord.org/index.html">Supervisor documentation</a>. Alternatively, you may use <a href="https://forge.laravel.com">Laravel Forge</a> to automatically configure and manage your Supervisor configuration from a convenient web interface.</p>

<p><a name="daemon-queue-listener"></a></p>

<h3>Daemon Queue Listener</h3>

<p>The <code>queue:work</code> Artisan command includes a <code>--daemon</code> option for forcing the queue worker to continue processing jobs without ever re-booting the framework. This results in a significant reduction of CPU usage when compared to the <code>queue:listen</code> command:</p>

<p>To start a queue worker in daemon mode, use the <code>--daemon</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>As you can see, the <code>queue:work</code> job supports most of the same options available to <code>queue:listen</code>. You may use the <code>php artisan help queue:work</code> job to view all of the available options.</p>

<h4>Coding Considerations For Daemon Queue Listeners</h4>

<p>Daemon queue workers do not restart the framework before processing each job. Therefore, you should be careful to free any heavy resources before your job finishes. For example, if you are doing image manipulation with the GD library, you should free the memory with <code>imagedestroy</code> when you are done.</p>

<p>Similarly, your database connection may disconnect when being used by a long-running daemon. You may use the <code>DB::reconnect</code> method to ensure you have a fresh connection.</p>

<p><a name="deploying-with-daemon-queue-listeners"></a></p>

<h3>Deploying With Daemon Queue Listeners</h3>

<p>Since daemon queue workers are long-lived processes, they will not pick up changes in your code without being restarted. So, the simplest way to deploy an application using daemon queue workers is to restart the workers during your deployment script. You may gracefully restart all of the workers by including the following command in your deployment script:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">restart</span>
</pre></div>

<p>This command will gracefully instruct all queue workers to restart after they finish processing their current job so that no existing jobs are lost.</p>

<blockquote>
<p><strong>Note:</strong> This command relies on the cache system to schedule the restart. By default, APCu does not work for CLI jobs. If you are using APCu, add <code>apc.enable_cli=1</code> to your APCu configuration.</p>
</blockquote>

<p><a name="dealing-with-failed-jobs"></a></p>

<h2>Dealing With Failed Jobs</h2>

<p>Since things don&#39;t always go as planned, sometimes your queued jobs will fail. Don&#39;t worry, it happens to the best of us! Laravel includes a convenient way to specify the maximum number of times a job should be attempted. After a job has exceeded this amount of attempts, it will be inserted into a <code>failed_jobs</code> table. The name of the table can be configured via the <code>config/queue.php</code> configuration file.</p>

<p>To create a migration for the <code>failed_jobs</code> table, you may use the <code>queue:failed-table</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span><span class="o">-</span><span class="nx">table</span>
</pre></div>

<p>When running your <a href="#running-the-queue-listener">queue listener</a>, you may specify the maximum number of times a job should be attempted using the <code>--tries</code> switch on the <code>queue:listen</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span><span class="o">-</span><span class="nx">name</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p><a name="failed-job-events"></a></p>

<h3>Failed Job Events</h3>

<p>If you would like to register an event that will be called when a queued job fails, you may use the <code>Queue::failing</code> method. This event is a great opportunity to notify your team via e-mail or <a href="https://www.hipchat.com">HipChat</a>. For example, we may attach a callback to this event from the <code>AppServiceProvider</code> that is included with Laravel:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">failing</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$connection</span><span class="p">,</span> <span class="nv">$job</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Notify team of failing job...</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Failed Method On Job Classes</h4>

<p>For more granular control, you may define a <code>failed</code> method directly on a queue job class, allowing you to perform job specific actions when a failure occurs:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Jobs\Job</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Mail\Mailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Bus\SelfHandling</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendReminderEmail</span> <span class="k">extends</span> <span class="nx">Job</span> <span class="k">implements</span> <span class="nx">SelfHandling</span><span class="p">,</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Mailer  $mailer</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle a job failure.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Called when the job is failing...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="retrying-failed-jobs"></a></p>

<h3>Retrying Failed Jobs</h3>

<p>To view all of your failed jobs that have been inserted into your <code>failed_jobs</code> database table, you may use the <code>queue:failed</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span>
</pre></div>

<p>The <code>queue:failed</code> command will list the job ID, connection, queue, and failure time. The job ID may be used to retry the failed job. For instance, to retry a failed job that has an ID of 5, the following command should be issued:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="mi">5</span>
</pre></div>

<p>To retry all of your failed jobs, use <code>queue:retry</code> with <code>all</code> as the ID:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="nx">all</span>
</pre></div>

<p>If you would like to delete a failed job, you may use the <code>queue:forget</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">forget</span> <span class="mi">5</span>
</pre></div>

<p>To delete all of your failed jobs, you may use the <code>queue:flush</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">flush</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Intermediate Task List</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#prepping-the-database">Prepping The Database</a>

<ul>
<li><a href="#database-migrations">Database Migrations</a></li>
<li><a href="#eloquent-models">Eloquent Models</a></li>
<li><a href="#eloquent-relationships">Eloquent Relationships</a></li>
</ul></li>
<li><a href="#routing">Routing</a>

<ul>
<li><a href="#displaying-a-view">Displaying A View</a></li>
<li><a href="#authentication-routing">Authentication</a></li>
<li><a href="#the-task-controller">The Task Controller</a></li>
</ul></li>
<li><a href="#building-layouts-and-views">Building Layouts &amp; Views</a>

<ul>
<li><a href="#defining-the-layout">Defining The Layout</a></li>
<li><a href="#defining-the-child-view">Defining The Child View</a></li>
</ul></li>
<li><a href="#adding-tasks">Adding Tasks</a>

<ul>
<li><a href="#validation">Validation</a></li>
<li><a href="#creating-the-task">Creating The Task</a></li>
</ul></li>
<li><a href="#displaying-existing-tasks">Displaying Existing Tasks</a>

<ul>
<li><a href="#dependency-injection">Dependency Injection</a></li>
<li><a href="#displaying-the-tasks">Displaying The Tasks</a></li>
</ul></li>
<li><a href="#deleting-tasks">Deleting Tasks</a>

<ul>
<li><a href="#adding-the-delete-button">Adding The Delete Button</a></li>
<li><a href="#route-model-binding">Route Model Binding</a></li>
<li><a href="#authorization">Authorization</a></li>
<li><a href="#deleting-the-task">Deleting The Task</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>This quickstart guide provides an intermediate introduction to the Laravel framework and includes content on database migrations, the Eloquent ORM, routing, authentication, authorization, dependency injection, validation, views, and Blade templates. This is a great starting point if you are familiar with the basics of the Laravel framework or PHP frameworks in general.</p>

<p>To sample a basic selection of Laravel features, we will build a task list we can use to track all of the tasks we want to accomplish (the typical &quot;to-do list&quot; example). In contrast to the &quot;basic&quot; quickstart, this tutorial will allow users to create accounts and authenticate with the application. The complete, finished source code for this project is <a href="https://github.com/laravel/quickstart-intermediate">available on GitHub</a>.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>Of course, first you will need a fresh installation of the Laravel framework. You may use the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead virtual machine</a> or the local PHP environment of your choice to run the framework. Once your local environment is ready, you may install the Laravel framework using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="nx">quickstart</span> <span class="o">--</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">dist</span>
</pre></div>

<p>You&#39;re free to just read along for the remainder of this quickstart; however, if you would like to download the source code for this quickstart and run it on your local machine, you may clone its Git repository and install its dependencies:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/quickstart-intermediate quickstart</span>
<span class="nx">cd</span> <span class="nx">quickstart</span>
<span class="nx">composer</span> <span class="nx">install</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>For more complete documentation on building a local Laravel development environment, check out the full <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> and <a href="/docs/%7B%7Bversion%7D%7D/installation">installation</a> documentation.</p>

<p><a name="prepping-the-database"></a></p>

<h2>Prepping The Database</h2>

<p><a name="database-migrations"></a></p>

<h3>Database Migrations</h3>

<p>First, let&#39;s use a migration to define a database table to hold all of our tasks. Laravel&#39;s database migrations provide an easy way to define your database table structure and modifications using fluent, expressive PHP code. Instead of telling your team members to manually add columns to their local copy of the database, your teammates can simply run the migrations you push into source control.</p>

<h4>The <code>users</code> Table</h4>

<p>Since we are going to allow users to create their accounts within the application, we will need a table to store all of our users. Thankfully, Laravel already ships with a migration to create a basic <code>users</code> table, so we do not need to manually generate one. The default migration for the <code>users</code> table is located in the <code>database/migrations</code> directory.</p>

<h4>The <code>tasks</code> Table</h4>

<p>Next, let&#39;s build a database table that will hold all of our tasks. The <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan CLI</a> can be used to generate a variety of classes and will save you a lot of typing as you build your Laravel projects. In this case, let&#39;s use the <code>make:migration</code> command to generate a new database migration for our <code>tasks</code> table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_tasks_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">tasks</span>
</pre></div>

<p>The migration will be placed in the <code>database/migrations</code> directory of your project. As you may have noticed, the <code>make:migration</code> command already added an auto-incrementing ID and timestamps to the migration file. Let&#39;s edit this file and add an additional <code>string</code> column for the name of our tasks, as well as a <code>user_id</code> column which will link our <code>tasks</code> and <code>users</code> tables:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateTasksTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Reverse the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>To run our migrations, we will use the <code>migrate</code> Artisan command. If you are using Homestead, you should run this command from within your virtual machine, since your host machine will not have direct access to the database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>This command will create all of our database tables. If you inspect the database tables using the database client of your choice, you should see new <code>tasks</code> and <code>users</code> tables which contains the columns defined in our migration. Next, we&#39;re ready to define our Eloquent ORM models!</p>

<p><a name="eloquent-models"></a></p>

<h3>Eloquent Models</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> is Laravel&#39;s default ORM (object-relational mapper). Eloquent makes it painless to retrieve and store data in your database using clearly defined &quot;models&quot;. Usually, each Eloquent model corresponds directly with a single database table.</p>

<h4>The <code>User</code> Model</h4>

<p>First, we need a model that corresponds to our <code>users</code> database table. However, if you look in the <code>app</code> directory of your project, you will see that Laravel already ships with a <code>User</code> model, so we do not need to generate one manually.</p>

<h4>The <code>Task</code> Model</h4>

<p>So, let&#39;s define a <code>Task</code> model that corresponds to our <code>tasks</code> database table we just created. Again, we can use an Artisan command to generate this model. In this case, we&#39;ll use the <code>make:model</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">Task</span>
</pre></div>

<p>The model will be placed in the <code>app</code> directory of your application. By default, the model class is empty. We do not have to explicitly tell the Eloquent model which table it corresponds to because it will assume the database table is the plural form of the model name. So, in this case, the <code>Task</code> model is assumed to correspond with the <code>tasks</code> database table.</p>

<p>Let&#39;s add a few things to this model. First, we will state that the <code>name</code> attribute on the model should be &quot;mass-assignable&quot;:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Task</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that are mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>We&#39;ll learn more about how to use Eloquent models as we add routes to our application. Of course, feel free to consult the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">complete Eloquent documentation</a> for more information.</p>

<p><a name="eloquent-relationships"></a></p>

<h3>Eloquent Relationships</h3>

<p>Now that our models are defined, we need to link them. For example, our <code>User</code> can have many <code>Task</code> instances, while a <code>Task</code> is assigned to one <code>User</code>. Defining a relationship will allow us to fluently walk through our relations like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tasks</span> <span class="nx">as</span> <span class="nx">$task</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>tasks</code> Relationship</h4>

<p>First, let&#39;s define the <code>tasks</code> relationship on our <code>User</code> model. Eloquent relationships are defined as methods on models. Eloquent supports several different types of relationships, so be sure to consult the <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">full Eloquent documentation</a> for more information. In this case, we will define a <code>tasks</code> function on the <code>User</code> model which calls the <code>hasMany</code> method provided by Eloquent:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="c1">// Namespace Imports...</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="k">implements</span> <span class="nx">AuthenticatableContract</span><span class="p">,</span>
                                    <span class="nx">AuthorizableContract</span><span class="p">,</span>
                                    <span class="nx">CanResetPasswordContract</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Authenticatable</span><span class="p">,</span> <span class="nx">Authorizable</span><span class="p">,</span> <span class="nx">CanResetPassword</span><span class="p">;</span>

    <span class="c1">// Other Eloquent Properties...</span>

    <span class="sd">/**</span>
<span class="sd">     * Get all of the tasks for the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tasks</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>user</code> Relationship</h4>

<p>Next, let&#39;s define the <code>user</code> relationship on the <code>Task</code> model. Again, we will define the relationship as a method on the model. In this case, we will use the <code>belongsTo</code> method provided by Eloquent to define the relationship:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Task</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that are mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the user that owns the task.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Wonderful! Now that our relationships are defined, we can start building our controllers!</p>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p>In the <a href="/docs/%7B%7Bversion%7D%7D/quickstart">basic version</a> of our task list application, we defined all of our logic using Closures within our <code>routes.php</code> file. For the majority of this application, we will use <a href="/docs/%7B%7Bversion%7D%7D/controllers">controllers</a> to organize our routes. Controllers will allow us to break out HTTP request handling logic across multiple files for better organization.</p>

<p><a name="displaying-a-view"></a></p>

<h3>Displaying A View</h3>

<p>We will have a single route that uses a Closure: our <code>/</code> route, which will simply be a landing page for application guests. So, let&#39;s fill out our <code>/</code> route. From this route, we want to render an HTML template that contains the &quot;welcome&quot; page:</p>

<p>In Laravel, all HTML templates are stored in the <code>resources/views</code> directory, and we can use the <code>view</code> helper to return one of these templates from our route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, we need to actually define this view. We&#39;ll do that in a bit!</p>

<p><a name="authentication-routing"></a></p>

<h3>Authentication</h3>

<p>Remember, we also need to let users create accounts and login to our application. Typically, it can be a tedious task to build an entire authentication layer into a web application. However, since it is such a common need, Laravel attempts to make this procedure totally painless.</p>

<p>First, notice that there is already a <code>app/Http/Controllers/Auth/AuthController</code> included in your Laravel application. This controller uses a special <code>AuthenticatesAndRegistersUsers</code> trait which contains all of the necessary logic to create and authenticate users.</p>

<h4>Authentication Routes</h4>

<p>So, what&#39;s left for us to do? Well, we still need to create the registration and login templates as well as define the routes to point to the authentication controller. First, let&#39;s add the routes we need to our <code>app/Http/routes.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="c1">// Authentication Routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getLogin&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;auth/login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@postLogin&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/logout&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getLogout&#39;</span><span class="p">);</span>

<span class="c1">// Registration Routes...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;auth/register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@getRegister&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;auth/register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\AuthController@postRegister&#39;</span><span class="p">);</span>
</pre></div>

<h4>Authentication Views</h4>

<p>Authentication requires us to create <code>login.blade.php</code> and <code>register.blade.php</code> within the <code>resources/views/auth</code> directory. Of course, the design and styling of these views is unimportant; however, they should at least contain some basic fields.</p>

<p>The <code>register.blade.php</code> file should contain a form that includes <code>name</code>, <code>email</code>, <code>password</code>, and <code>password_confirmation</code> fields and makes a <code>POST</code> request to the <code>/auth/register</code> route.</p>

<p>The <code>login.blade.php</code> file should contain a form that includes <code>email</code> and <code>password</code> fields and makes a <code>POST</code> request to <code>/auth/login</code>.</p>

<blockquote>
<p><strong>Note:</strong> If you would like to view complete examples for these views, remember that the entire application&#39;s source code is <a href="https://github.com/laravel/quickstart-intermediate">available on GitHub</a>.</p>
</blockquote>

<p><a name="the-task-controller"></a></p>

<h3>The Task Controller</h3>

<p>Since we know we&#39;re going to need to retrieve and store tasks, let&#39;s create a <code>TaskController</code> using the Artisan CLI, which will place the new controller in the <code>app/Http/Controllers</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">TaskController</span> <span class="o">--</span><span class="nx">plain</span>
</pre></div>

<p>Now that the controller has been generated, let&#39;s go ahead and stub out some routes in our <code>app/Http/routes.php</code> file to point to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/tasks&#39;</span><span class="p">,</span> <span class="s1">&#39;TaskController@index&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span> <span class="s1">&#39;TaskController@store&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/task/{task}&#39;</span><span class="p">,</span> <span class="s1">&#39;TaskController@destroy&#39;</span><span class="p">);</span>
</pre></div>

<h4>Authenticating All Task Routes</h4>

<p>For this application, we want all of our task routes to require an authenticated user. In other words, the user must be &quot;logged into&quot; the application in order to create a task. So, we need to restrict access to our task routes to only authenticated users. Laravel makes this a cinch using <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a>.</p>

<p>To require an authenticated users for all actions on the controller, we can add a call to the <code>middleware</code> method from the controller&#39;s constructor. All available route middleware are defined in the <code>app/Http/Kernel.php</code> file. In this case, we want to assign the <code>auth</code> middleware to all actions on the controller:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="building-layouts-and-views"></a></p>

<h2>Building Layouts &amp; Views</h2>

<p>This application only has a single view which contains a form for adding new tasks as well as a listing of all current tasks. To help you visualize the view, here is a screenshot of the finished application with basic Bootstrap CSS styling applied:</p>

<p><img src="https://laravel.com/assets/img/quickstart/basic-overview.png" alt="Application Image"></p>

<p><a name="defining-the-layout"></a></p>

<h3>Defining The Layout</h3>

<p>Almost all web applications share the same layout across pages. For example, this application has a top navigation bar that would be typically present on every page (if we had more than one). Laravel makes it easy to share these common features across every page using Blade <strong>layouts</strong>.</p>

<p>As we discussed earlier, all Laravel views are stored in <code>resources/views</code>. So, let&#39;s define a new layout view in <code>resources/views/layouts/app.blade.php</code>. The <code>.blade.php</code> extension instructs the framework to use the <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade templating engine</a> to render the view. Of course, you may use plain PHP templates with Laravel. However, Blade provides convenient short-cuts for writing cleaner, terse templates.</p>

<p>Our <code>app.blade.php</code> view should look like the following:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/layouts/app.blade.php</span>

<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Laravel</span> <span class="nx">Quickstart</span> <span class="o">-</span> <span class="nx">Intermediate</span><span class="o">&lt;</span><span class="err">/title&gt;</span>

        <span class="c">&lt;!--</span> <span class="nx">CSS</span> <span class="nx">And</span> <span class="nx">JavaScript</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>

    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">nav</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;navbar navbar-default&quot;</span><span class="o">&gt;</span>
                <span class="c">&lt;!--</span> <span class="nx">Navbar</span> <span class="nx">Contents</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="err">/nav&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>

        <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>Note the <code>@yield(&#39;content&#39;)</code> portion of the layout. This is a special Blade directive that specifies where all child pages that extend the layout can inject their own content. Next, let&#39;s define the child view that will use this layout and provide its primary content.</p>

<p><a name="defining-the-child-view"></a></p>

<h3>Defining The Child View</h3>

<p>Great, our application layout is finished. Next, we need to define a view that contains a form to create a new task as well as a table that lists all existing tasks. Let&#39;s define this view in <code>resources/views/tasks/index.blade.php</code>, which will correspond to the <code>index</code> method in our <code>TaskController</code>.</p>

<p>We&#39;ll skip over some of the Bootstrap CSS boilerplate and only focus on the things that matter. Remember, you can download the full source for this application on <a href="https://github.com/laravel/quickstart-intermediate">GitHub</a>:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/tasks/index.blade.php</span>

<span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

    <span class="c">&lt;!--</span> <span class="nx">Bootstrap</span> <span class="nx">Boilerplate</span><span class="p">...</span> <span class="o">--&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
        <span class="c">&lt;!--</span> <span class="nx">Display</span> <span class="nx">Validation</span> <span class="nx">Errors</span> <span class="o">--&gt;</span>
        <span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;common.errors&#39;</span><span class="p">)</span>

        <span class="c">&lt;!--</span> <span class="nx">New</span> <span class="nx">Task</span> <span class="nx">Form</span> <span class="o">--&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/task&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-horizontal&quot;</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>

            <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;task-name&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-3 control-label&quot;</span><span class="o">&gt;</span><span class="nx">Task</span><span class="o">&lt;</span><span class="err">/label&gt;</span>

                <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-6&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;task-name&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>

            <span class="c">&lt;!--</span> <span class="nx">Add</span> <span class="nx">Task</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-offset-3 col-sm-6&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;btn btn-default&quot;</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;fa fa-plus&quot;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt; Add Task</span>
                    <span class="o">&lt;</span><span class="err">/button&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">TODO</span><span class="o">:</span> <span class="nx">Current</span> <span class="nx">Tasks</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<h4>A Few Notes Of Explanation</h4>

<p>Before moving on, let&#39;s talk about this template a bit. First, the <code>@extends</code> directive informs Blade that we are using the layout we defined at <code>resources/views/layouts/app.blade.php</code>. All of the content between <code>@section(&#39;content&#39;)</code> and <code>@endsection</code> will be injected into the location of the <code>@yield(&#39;content&#39;)</code> directive within the <code>app.blade.php</code> layout.</p>

<p>Now we have defined a basic layout and view for our application. Let&#39;s go ahead and return this view from the <code>index</code> method of our <code>TaskController</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Display a list of all of the user&#39;s task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks.index&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Next, we&#39;re ready to add code to our <code>POST /task</code> route&#39;s controller method to handle the incoming form input and add a new task to the database.</p>

<blockquote>
<p><strong>Note:</strong> The <code>@include(&#39;common.errors&#39;)</code> directive will load the template located at <code>resources/views/common/errors.blade.php</code>. We haven&#39;t defined this template, but we will soon!</p>
</blockquote>

<p><a name="adding-tasks"></a></p>

<h2>Adding Tasks</h2>

<p><a name="validation"></a></p>

<h3>Validation</h3>

<p>Now that we have a form in our view, we need to add code to our <code>TaskController@store</code> method to validate the incoming form input and create a new task. First, let&#39;s validate the input.</p>

<p>For this form, we will make the <code>name</code> field required and state that it must contain less than <code>255</code> characters. If the validation fails, we want to redirect the user back to the <code>/tasks</code> URL, as well as flash the old input and errors into the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Create a new task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// Create The Task...</span>
<span class="p">}</span>
</pre></div>

<p>If you followed along with the <a href="/docs/%7B%7Bversion%7D%7D/quickstart">basic quickstart</a>, you&#39;ll notice this validation code looks quite a bit different! Since we are in a controller, we can leverage the convenience of the <code>ValidatesRequests</code> trait that is included in the base Laravel controller. This trait exposes a simple <code>validate</code> method which accepts a request and an array of validation rules.</p>

<p>We don&#39;t even have to manually determine if the validation failed or do manual redirection. If the validation fails for the given rules, the user will automatically be redirected back to where they came from and the errors will automatically be flashed to the session. Nice!</p>

<h4>The <code>$errors</code> Variable</h4>

<p>Remember that we used the <code>@include(&#39;common.errors&#39;)</code> directive within our view to render the form&#39;s validation errors. The <code>common.errors</code> will allow us to easily show validation errors in the same format across all of our pages. Let&#39;s define the contents of this view now:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/common/errors.blade.php</span>

<span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">Form</span> <span class="nb">Error</span> <span class="nx">List</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Whoops</span><span class="o">!</span> <span class="nx">Something</span> <span class="nx">went</span> <span class="nx">wrong</span><span class="o">!&lt;</span><span class="err">/strong&gt;</span>

        <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>$errors</code> variable is available in <strong>every</strong> Laravel view. It will simply be an empty instance of <code>ViewErrorBag</code> if no validation errors are present.</p>
</blockquote>

<p><a name="creating-the-task"></a></p>

<h3>Creating The Task</h3>

<p>Now that input validation is handled, let&#39;s actually create a new task by continuing to fill out our route. Once the new task has been created, we will redirect the user back to the <code>/tasks</code> URL. To create the task, we are going to leverage the power of Eloquent&#39;s relationships.</p>

<p>Most of Laravel&#39;s relationships expose a <code>create</code> method, which accepts an array of attributes and will automatically set the foreign key value on the related model before storing it in the database. In this case, the <code>create</code> method will automatically set the <code>user_id</code> property of the given task to the ID of the currently authenticated user, which we are accessing using <code>$request-&gt;user()</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Create a new task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">tasks</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/tasks&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Great! We can now successfully create tasks. Next, let&#39;s continue adding to our view by building a list of all existing tasks.</p>

<p><a name="displaying-existing-tasks"></a></p>

<h2>Displaying Existing Tasks</h2>

<p>First, we need to edit our <code>TaskController@index</code> method to pass all of the existing tasks to the view. The <code>view</code> function accepts a second argument which is an array of data that will be made available to the view, where each key in the array will become a variable within the view. For example, we could do this:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Display a list of all of the user&#39;s task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$tasks</span> <span class="o">=</span> <span class="nx">Task</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks.index&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;tasks&#39;</span> <span class="p">=&gt;</span> <span class="nx">$tasks</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>However, let&#39;s explore some of the dependency injection capabilities of Laravel to inject a <code>TaskRepository</code> into our <code>TaskController</code>, which we will use for all of our data access.</p>

<p><a name="dependency-injection"></a></p>

<h3>Dependency Injection</h3>

<p>Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> is one of the most powerful features of the entire framework. After reading this quickstart, be sure to read over all of the container&#39;s documentation.</p>

<h4>Creating The Repository</h4>

<p>As we mentioned earlier, we want to define a <code>TaskRepository</code> that holds all of our data access logic for the <code>Task</code> model. This will be especially useful if the application grows and you need to share some Eloquent queries across the application.</p>

<p>So, let&#39;s create an <code>app/Repositories</code> directory and add a <code>TaskRepository</code> class. Remember, all Laravel <code>app</code> folders are auto-loaded using the PSR-4 auto-loading standard, so you are free to create as many extra directories as needed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Repositories</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Task</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskRepository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the tasks for a given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  User  $user</span>
<span class="sd">     * @return Collection</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forUser</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Task</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Injecting The Repository</h4>

<p>Once our repository is defined, we can simply &quot;type-hint&quot; it in the constructor of our <code>TaskController</code> and utilize it within our <code>index</code> route. Since Laravel uses the container to resolve all controllers, our dependencies will automatically be injected into the controller instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Repositories\TaskRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The task repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @var TaskRepository</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$tasks</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  TaskRepository  $tasks</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">TaskRepository</span> <span class="nv">$tasks</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tasks</span> <span class="o">=</span> <span class="nv">$tasks</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Display a list of all of the user&#39;s task.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks.index&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tasks</span><span class="o">-&gt;</span><span class="na">forUser</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="displaying-the-tasks"></a></p>

<h3>Displaying The Tasks</h3>

<p>Once the data is passed, we can spin through the tasks in our <code>tasks/index.blade.php</code> view and display them in a table. The <code>@foreach</code> Blade construct allows us to write concise loops that compile down into blazing fast plain PHP code:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">Create</span> <span class="nx">Task</span> <span class="nx">Form</span><span class="p">...</span> <span class="o">--&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">Current</span> <span class="nx">Tasks</span> <span class="o">--&gt;</span>
    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$tasks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel panel-default&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-heading&quot;</span><span class="o">&gt;</span>
                <span class="nx">Current</span> <span class="nx">Tasks</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>

            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">table</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table table-striped task-table&quot;</span><span class="o">&gt;</span>

                    <span class="c">&lt;!--</span> <span class="nx">Table</span> <span class="nx">Headings</span> <span class="o">--&gt;</span>
                    <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Task</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
                    <span class="o">&lt;</span><span class="err">/thead&gt;</span>

                    <span class="c">&lt;!--</span> <span class="nx">Table</span> <span class="nx">Body</span> <span class="o">--&gt;</span>
                    <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
                        <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$tasks</span> <span class="nx">as</span> <span class="nx">$task</span><span class="p">)</span>
                            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                                <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
                                <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table-text&quot;</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
                                <span class="o">&lt;</span><span class="err">/td&gt;</span>

                                <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span>
                                    <span class="c">&lt;!--</span> <span class="nx">TODO</span><span class="o">:</span> <span class="nx">Delete</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
                                <span class="o">&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="err">/tr&gt;</span>
                        <span class="err">@</span><span class="nx">endforeach</span>
                    <span class="o">&lt;</span><span class="err">/tbody&gt;</span>
                <span class="o">&lt;</span><span class="err">/table&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="err">@</span><span class="nx">endif</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<p>Our task application is almost complete. But, we have no way to delete our existing tasks when they&#39;re done. Let&#39;s add that next!</p>

<p><a name="deleting-tasks"></a></p>

<h2>Deleting Tasks</h2>

<p><a name="adding-the-delete-button"></a></p>

<h3>Adding The Delete Button</h3>

<p>We left a &quot;TODO&quot; note in our code where our delete button is supposed to be. So, let&#39;s add a delete button to each row of our task listing within the <code>tasks/index.blade.php</code> view. We&#39;ll create a small single-button form for each task in the list. When the button is clicked, a <code>DELETE /task</code> request will be sent to the application which will trigger our <code>TaskController@destroy</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table-text&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/td&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">Delete</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/task/{{ $task-&gt;id }}&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>
            <span class="p">{{</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">)</span> <span class="p">}}</span>

            <span class="o">&lt;</span><span class="nx">button</span><span class="o">&gt;</span><span class="nx">Delete</span> <span class="nx">Task</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="o">&lt;</span><span class="err">/tr&gt;</span>
</pre></div>

<p><a name="a-note-on-method-spoofing"></a></p>

<h4>A Note On Method Spoofing</h4>

<p>Note that the delete button&#39;s form <code>method</code> is listed as <code>POST</code>, even though we are responding to the request using a <code>Route::delete</code> route. HTML forms only allow the <code>GET</code> and <code>POST</code> HTTP verbs, so we need a way to spoof a <code>DELETE</code> request from the form.</p>

<p>We can spoof a <code>DELETE</code> request by outputting the results of the <code>method_field(&#39;DELETE&#39;)</code> function within our form. This function generates a hidden form input that Laravel recognizes and will use to override the actual HTTP request method. The generated field will look like the following:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="o">&gt;</span>
</pre></div>

<p><a name="route-model-binding"></a></p>

<h3>Route Model Binding</h3>

<p>Now, we&#39;re almost ready to define the <code>destroy</code> method on our <code>TaskController</code>. But, first, let&#39;s revisit our route declaration for this route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/task/{task}&#39;</span><span class="p">,</span> <span class="s1">&#39;TaskController@destroy&#39;</span><span class="p">);</span>
</pre></div>

<p>Without adding any additional code, Laravel would inject the given task ID into the <code>TaskController@destroy</code> method, like so:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Destroy the given task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @param  string  $taskId</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$taskId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>However, the very first thing we will need to do in this method is retrieve the <code>Task</code> instance from the database using the given ID. So, wouldn&#39;t it be nice if Laravel could just inject the <code>Task</code> instance that matches the ID in the first place? Let&#39;s make it happen!</p>

<p>In your <code>app/Providers/RouteServiceProvider.php</code> file&#39;s <code>boot</code> method, let&#39;s add the following line of code:</p>
<div class="highlight"><pre><span></span><span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Task&#39;</span><span class="p">);</span>
</pre></div>

<p>This small line of code will instruct Laravel to retrieve the <code>Task</code> model that corresponds to a given ID whenever it sees <code>{task}</code> in a route declaration. Now we can define our destroy method like so:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Destroy the given task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @param  Task  $task</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">Task</span> <span class="nx">$task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="authorization"></a></p>

<h3>Authorization</h3>

<p>Now, we have a <code>Task</code> instance injected into our <code>destroy</code> method; however, we have no guarantee that the authenticated user actually &quot;owns&quot; the given task. For example, a malicious request could have been concocted in an attempt to delete another user&#39;s tasks by passing a random task ID to the <code>/tasks/{task}</code> URL. So, we need to use Laravel&#39;s authorization capabilities to make sure the authenticated user actually owns the <code>Task</code> instance that was injected into the route.</p>

<h4>Creating A Policy</h4>

<p>Laravel uses &quot;policies&quot; to organize authorization logic into simple, small classes. Typically, each policy corresponds to a model. So, let&#39;s create a <code>TaskPolicy</code> using the Artisan CLI, which will place the generated file in <code>app/Policies/TaskPolicy.php</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">policy</span> <span class="nx">TaskPolicy</span>
</pre></div>

<p>Next, let&#39;s add a <code>destroy</code> method to the policy. This method will receive a <code>User</code> instance and a <code>Task</code> instance. The method should simply check if the user&#39;s ID matches the <code>user_id</code> on the task. In fact, all policy methods should either return <code>true</code> or <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Policies</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Auth\Access\HandlesAuthorization</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskPolicy</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HandlesAuthorization</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Determine if the given user can delete the given task.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  User  $user</span>
<span class="sd">     * @param  Task  $task</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Task</span> <span class="nv">$task</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Finally, we need to associate our <code>Task</code> model with our <code>TaskPolicy</code>. We can do this by adding a line in the <code>app/Providers/AuthServiceProvider.php</code> file&#39;s <code>$policies</code> property. This will inform Laravel which policy should be used whenever we try to authorize an action on a <code>Task</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The policy mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$policies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Task</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="nx">TaskPolicy</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<h4>Authorizing The Action</h4>

<p>Now that our policy is written, let&#39;s use it in our <code>destroy</code> method. All Laravel controllers may call an <code>authorize</code> method, which is exposed by the <code>AuthorizesRequest</code> trait:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Destroy the given task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @param  Task  $task</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">Task</span> <span class="nx">$task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">$task</span><span class="p">);</span>

    <span class="c1">// Delete The Task...</span>
<span class="p">}</span>
</pre></div>

<p>Let&#39;s examine this method call for a moment. The first argument passed to the <code>authorize</code> method is the name of the policy method we wish to call. The second argument is the model instance that is our current concern. Remember, we recently told Laravel that our <code>Task</code> model corresponds to our <code>TaskPolicy</code>, so the framework knows on which policy to fire the <code>destroy</code> method. The current user will automatically be sent to the policy method, so we do not need to manually pass it here.</p>

<p>If the action is authorized, our code will continue executing normally. However, if the action is not authorized (meaning the policy&#39;s <code>destroy</code> method returned <code>false</code>), a 403 exception will be thrown and an error page will be displayed to the user.</p>

<blockquote>
<p><strong>Note:</strong> There are several other ways to interact with the authorization services Laravel provides. Be sure to browse the complete <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization documentation</a>.</p>
</blockquote>

<p><a name="deleting-the-task"></a></p>

<h3>Deleting The Task</h3>

<p>Finally, let&#39;s finish adding the logic to our <code>destroy</code> method to actually delete the given task. We can use Eloquent&#39;s <code>delete</code> method to delete the given model instance in the database. Once the record is deleted, we will redirect the user back to the <code>/tasks</code> URL:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Destroy the given task.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @param  Task  $task</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">Task</span> <span class="nx">$task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">$task</span><span class="p">);</span>

    <span class="nx">$task</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/tasks&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Basic Task List</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#prepping-the-database">Prepping The Database</a>

<ul>
<li><a href="#database-migrations">Database Migrations</a></li>
<li><a href="#eloquent-models">Eloquent Models</a></li>
</ul></li>
<li><a href="#routing">Routing</a>

<ul>
<li><a href="#stubbing-the-routes">Stubbing The Routes</a></li>
<li><a href="#displaying-a-view">Displaying A View</a></li>
</ul></li>
<li><a href="#building-layouts-and-views">Building Layouts &amp; Views</a>

<ul>
<li><a href="#defining-the-layout">Defining The Layout</a></li>
<li><a href="#defining-the-child-view">Defining The Child View</a></li>
</ul></li>
<li><a href="#adding-tasks">Adding Tasks</a>

<ul>
<li><a href="#validation">Validation</a></li>
<li><a href="#creating-the-task">Creating The Task</a></li>
<li><a href="#displaying-existing-tasks">Displaying Existing Tasks</a></li>
</ul></li>
<li><a href="#deleting-tasks">Deleting Tasks</a>

<ul>
<li><a href="#adding-the-delete-button">Adding The Delete Button</a></li>
<li><a href="#deleting-the-task">Deleting The Task</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>This quickstart guide provides a basic introduction to the Laravel framework and includes content on database migrations, the Eloquent ORM, routing, validation, views, and Blade templates. This is a great starting point if you are brand new to the Laravel framework or PHP frameworks in general. If you have already used Laravel or other PHP frameworks, you may wish to consult one of our more advanced quickstarts.</p>

<p>To sample a basic selection of Laravel features, we will build a simple task list we can use to track all of the tasks we want to accomplish (the typical &quot;to-do list&quot; example). The complete, finished source code for this project is <a href="http://github.com/laravel/quickstart-basic">available on GitHub</a>.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>Of course, first you will need a fresh installation of the Laravel framework. You may use the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead virtual machine</a> or the local PHP environment of your choice to run the framework. Once your local environment is ready, you may install the Laravel framework using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="nx">quickstart</span> <span class="o">--</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">dist</span>
</pre></div>

<p>You&#39;re free to just read along for the remainder of this quickstart; however, if you would like to download the source code for this quickstart and run it on your local machine, you may clone its Git repository and install its dependencies:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/quickstart-basic quickstart</span>
<span class="nx">cd</span> <span class="nx">quickstart</span>
<span class="nx">composer</span> <span class="nx">install</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>For more complete documentation on building a local Laravel development environment, check out the full <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> and <a href="/docs/%7B%7Bversion%7D%7D/installation">installation</a> documentation.</p>

<p><a name="prepping-the-database"></a></p>

<h2>Prepping The Database</h2>

<p><a name="database-migrations"></a></p>

<h3>Database Migrations</h3>

<p>First, let&#39;s use a migration to define a database table to hold all of our tasks. Laravel&#39;s database migrations provide an easy way to define your database table structure and modifications using fluent, expressive PHP code. Instead of telling your team members to manually add columns to their local copy of the database, your teammates can simply run the migrations you push into source control.</p>

<p>So, let&#39;s build a database table that will hold all of our tasks. The <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan CLI</a> can be used to generate a variety of classes and will save you a lot of typing as you build your Laravel projects. In this case, let&#39;s use the <code>make:migration</code> command to generate a new database migration for our <code>tasks</code> table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_tasks_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">tasks</span>
</pre></div>

<p>The migration will be placed in the <code>database/migrations</code> directory of your project. As you may have noticed, the <code>make:migration</code> command already added an auto-incrementing ID and timestamps to the migration file. Let&#39;s edit this file and add an additional <code>string</code> column for the name of our tasks:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateTasksTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Reverse the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>To run our migration, we will use the <code>migrate</code> Artisan command. If you are using Homestead, you should run this command from within your virtual machine, since your host machine will not have direct access to the database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>This command will create all of our database tables. If you inspect the database tables using the database client of your choice, you should see a new <code>tasks</code> table which contains the columns defined in our migration. Next, we&#39;re ready to define an Eloquent ORM model for our tasks!</p>

<p><a name="eloquent-models"></a></p>

<h3>Eloquent Models</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> is Laravel&#39;s default ORM (object-relational mapper). Eloquent makes it painless to retrieve and store data in your database using clearly defined &quot;models&quot;. Usually, each Eloquent model corresponds directly with a single database table.</p>

<p>So, let&#39;s define a <code>Task</code> model that corresponds to our <code>tasks</code> database table we just created. Again, we can use an Artisan command to generate this model. In this case, we&#39;ll use the <code>make:model</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">Task</span>
</pre></div>

<p>The model will be placed in the <code>app</code> directory of your application. By default, the model class is empty. We do not have to explicitly tell the Eloquent model which table it corresponds to because it will assume the database table is the plural form of the model name. So, in this case, the <code>Task</code> model is assumed to correspond with the <code>tasks</code> database table. Here is what our empty model should look like:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Task</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>We&#39;ll learn more about how to use Eloquent models as we add routes to our application. Of course, feel free to consult the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">complete Eloquent documentation</a> for more information.</p>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p><a name="stubbing-the-routes"></a></p>

<h3>Stubbing The Routes</h3>

<p>Next, we&#39;re ready to add a few routes to our application. Routes are used to point URLs to controllers or anonymous functions that should be executed when a user accesses a given page. By default, all Laravel routes are defined in the <code>app/Http/routes.php</code> file that is included in every new project.</p>

<p>For this application, we know we will need at least three routes: a route to display a list of all of our tasks, a route to add new tasks, and a route to delete existing tasks. So, let&#39;s stub all of these routes in the <code>app/Http/routes.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Display All Tasks</span>
<span class="sd"> */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="sd">/**</span>
<span class="sd"> * Add A New Task</span>
<span class="sd"> */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="sd">/**</span>
<span class="sd"> * Delete An Existing Task</span>
<span class="sd"> */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/task/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="displaying-a-view"></a></p>

<h3>Displaying A View</h3>

<p>Next, let&#39;s fill out our <code>/</code> route. From this route, we want to render an HTML template that contains a form to add new tasks, as well as a list of all current tasks.</p>

<p>In Laravel, all HTML templates are stored in the <code>resources/views</code> directory, and we can use the <code>view</code> helper to return one of these templates from our route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, we need to actually define this view, so let&#39;s do that now!</p>

<p><a name="building-layouts-and-views"></a></p>

<h2>Building Layouts &amp; Views</h2>

<p>This application only has a single view which contains a form for adding new tasks as well as a listing of all current tasks. To help you visualize the view, here is a screenshot of the finished application with basic Bootstrap CSS styling applied:</p>

<p><img src="https://laravel.com/assets/img/quickstart/basic-overview.png" alt="Application Image"></p>

<p><a name="defining-the-layout"></a></p>

<h3>Defining The Layout</h3>

<p>Almost all web applications share the same layout across pages. For example, this application has a top navigation bar that would be typically present on every page (if we had more than one). Laravel makes it easy to share these common features across every page using Blade <strong>layouts</strong>.</p>

<p>As we discussed earlier, all Laravel views are stored in <code>resources/views</code>. So, let&#39;s define a new layout view in <code>resources/views/layouts/app.blade.php</code>. The <code>.blade.php</code> extension instructs the framework to use the <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade templating engine</a> to render the view. Of course, you may use plain PHP templates with Laravel. However, Blade provides convenient short-cuts for writing cleaner, terse templates.</p>

<p>Our <code>app.blade.php</code> view should look like the following:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/layouts/app.blade.php</span>

<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Laravel</span> <span class="nx">Quickstart</span> <span class="o">-</span> <span class="nx">Basic</span><span class="o">&lt;</span><span class="err">/title&gt;</span>

        <span class="c">&lt;!--</span> <span class="nx">CSS</span> <span class="nx">And</span> <span class="nx">JavaScript</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>

    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">nav</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;navbar navbar-default&quot;</span><span class="o">&gt;</span>
                <span class="c">&lt;!--</span> <span class="nx">Navbar</span> <span class="nx">Contents</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="err">/nav&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>

        <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>Note the <code>@yield(&#39;content&#39;)</code> portion of the layout. This is a special Blade directive that specifies where all child pages that extend the layout can inject their own content. Next, let&#39;s define the child view that will use this layout and provide its primary content.</p>

<p><a name="defining-the-child-view"></a></p>

<h3>Defining The Child View</h3>

<p>Great, our application layout is finished. Next, we need to define a view that contains a form to create a new task as well as a table that lists all existing tasks. Let&#39;s define this view in <code>resources/views/tasks.blade.php</code>.</p>

<p>We&#39;ll skip over some of the Bootstrap CSS boilerplate and only focus on the things that matter. Remember, you can download the full source for this application on <a href="https://github.com/laravel/quickstart-basic">GitHub</a>:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/tasks.blade.php</span>

<span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

    <span class="c">&lt;!--</span> <span class="nx">Bootstrap</span> <span class="nx">Boilerplate</span><span class="p">...</span> <span class="o">--&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
        <span class="c">&lt;!--</span> <span class="nx">Display</span> <span class="nx">Validation</span> <span class="nx">Errors</span> <span class="o">--&gt;</span>
        <span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;common.errors&#39;</span><span class="p">)</span>

        <span class="c">&lt;!--</span> <span class="nx">New</span> <span class="nx">Task</span> <span class="nx">Form</span> <span class="o">--&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/task&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-horizontal&quot;</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>

            <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;task&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-3 control-label&quot;</span><span class="o">&gt;</span><span class="nx">Task</span><span class="o">&lt;</span><span class="err">/label&gt;</span>

                <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-6&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;task-name&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>

            <span class="c">&lt;!--</span> <span class="nx">Add</span> <span class="nx">Task</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-sm-offset-3 col-sm-6&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;btn btn-default&quot;</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;fa fa-plus&quot;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt; Add Task</span>
                    <span class="o">&lt;</span><span class="err">/button&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">TODO</span><span class="o">:</span> <span class="nx">Current</span> <span class="nx">Tasks</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<h4>A Few Notes Of Explanation</h4>

<p>Before moving on, let&#39;s talk about this template a bit. First, the <code>@extends</code> directive informs Blade that we are using the layout we defined at <code>resources/views/layouts/app.blade.php</code>. All of the content between <code>@section(&#39;content&#39;)</code> and <code>@endsection</code> will be injected into the location of the <code>@yield(&#39;content&#39;)</code> directive within the <code>app.blade.php</code> layout.</p>

<p>Now we have defined a basic layout and view for our application. Remember, we are returning this view from our <code>/</code> route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Next, we&#39;re ready to add code to our <code>POST /task</code> route to handle the incoming form input and add a new task to the database.</p>

<blockquote>
<p><strong>Note:</strong> The <code>@include(&#39;common.errors&#39;)</code> directive will load the template located at <code>resources/views/common/errors.blade.php</code>. We haven&#39;t defined this template, but we will soon!</p>
</blockquote>

<p><a name="adding-tasks"></a></p>

<h2>Adding Tasks</h2>

<p><a name="validation"></a></p>

<h3>Validation</h3>

<p>Now that we have a form in our view, we need to add code to our <code>POST /task</code> route to validate the incoming form input and create a new task. First, let&#39;s validate the input.</p>

<p>For this form, we will make the <code>name</code> field required and state that it must contain less than <code>255</code> characters. If the validation fails, we will redirect the user back to the <code>/</code> URL, as well as flash the old input and errors into the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Create The Task...</span>
<span class="p">});</span>
</pre></div>

<h4>The <code>$errors</code> Variable</h4>

<p>Let&#39;s take a break for a moment to talk about the <code>-&gt;withErrors($validator)</code> portion of this example. The <code>-&gt;withErrors($validator)</code> call will flash the errors from the given validator instance into the session so that they can be accessed via the <code>$errors</code> variable in our view.</p>

<p>Remember that we used the <code>@include(&#39;common.errors&#39;)</code> directive within our view to render the form&#39;s validation errors. The <code>common.errors</code> will allow us to easily show validation errors in the same format across all of our pages. Let&#39;s define the contents of this view now:</p>
<div class="highlight"><pre><span></span><span class="c1">// resources/views/common/errors.blade.php</span>

<span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">Form</span> <span class="nb">Error</span> <span class="nx">List</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Whoops</span><span class="o">!</span> <span class="nx">Something</span> <span class="nx">went</span> <span class="nx">wrong</span><span class="o">!&lt;</span><span class="err">/strong&gt;</span>

        <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>$errors</code> variable is available in <strong>every</strong> Laravel view. It will simply be an empty instance of <code>ViewErrorBag</code> if no validation errors are present.</p>
</blockquote>

<p><a name="creating-the-task"></a></p>

<h3>Creating The Task</h3>

<p>Now that input validation is handled, let&#39;s actually create a new task by continuing to fill out our route. Once the new task has been created, we will redirect the user back to the <code>/</code> URL. To create the task, we may use the <code>save</code> method after creating and setting properties on a new Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">;</span>
    <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
    <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Great! We can now successfully create tasks. Next, let&#39;s continue adding to our view by building a list of all existing tasks.</p>

<p><a name="displaying-existing-tasks"></a></p>

<h3>Displaying Existing Tasks</h3>

<p>First, we need to edit our <code>/</code> route to pass all of the existing tasks to the view. The <code>view</code> function accepts a second argument which is an array of data that will be made available to the view, where each key in the array will become a variable within the view:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$tasks</span> <span class="o">=</span> <span class="nx">Task</span><span class="o">::</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;tasks&#39;</span> <span class="p">=&gt;</span> <span class="nx">$tasks</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Once the data is passed, we can spin through the tasks in our <code>tasks.blade.php</code> view and display them in a table. The <code>@foreach</code> Blade construct allows us to write concise loops that compile down into blazing fast plain PHP code:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">Create</span> <span class="nx">Task</span> <span class="nx">Form</span><span class="p">...</span> <span class="o">--&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">Current</span> <span class="nx">Tasks</span> <span class="o">--&gt;</span>
    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$tasks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel panel-default&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-heading&quot;</span><span class="o">&gt;</span>
                <span class="nx">Current</span> <span class="nx">Tasks</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>

            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">table</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table table-striped task-table&quot;</span><span class="o">&gt;</span>

                    <span class="c">&lt;!--</span> <span class="nx">Table</span> <span class="nx">Headings</span> <span class="o">--&gt;</span>
                    <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Task</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
                        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
                    <span class="o">&lt;</span><span class="err">/thead&gt;</span>

                    <span class="c">&lt;!--</span> <span class="nx">Table</span> <span class="nx">Body</span> <span class="o">--&gt;</span>
                    <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
                        <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$tasks</span> <span class="nx">as</span> <span class="nx">$task</span><span class="p">)</span>
                            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                                <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
                                <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table-text&quot;</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
                                <span class="o">&lt;</span><span class="err">/td&gt;</span>

                                <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span>
                                    <span class="c">&lt;!--</span> <span class="nx">TODO</span><span class="o">:</span> <span class="nx">Delete</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
                                <span class="o">&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="err">/tr&gt;</span>
                        <span class="err">@</span><span class="nx">endforeach</span>
                    <span class="o">&lt;</span><span class="err">/tbody&gt;</span>
                <span class="o">&lt;</span><span class="err">/table&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="err">@</span><span class="nx">endif</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<p>Our task application is almost complete. But, we have no way to delete our existing tasks when they&#39;re done. Let&#39;s add that next!</p>

<p><a name="deleting-tasks"></a></p>

<h2>Deleting Tasks</h2>

<p><a name="adding-the-delete-button"></a></p>

<h3>Adding The Delete Button</h3>

<p>We left a &quot;TODO&quot; note in our code where our delete button is supposed to be. So, let&#39;s add a delete button to each row of our task listing within the <code>tasks.blade.php</code> view. We&#39;ll create a small single-button form for each task in the list. When the button is clicked, a <code>DELETE /task</code> request will be sent to the application:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">Task</span> <span class="nx">Name</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;table-text&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$task</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/td&gt;</span>

    <span class="c">&lt;!--</span> <span class="nx">Delete</span> <span class="nx">Button</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/task/{{ $task-&gt;id }}&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>
            <span class="p">{{</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">)</span> <span class="p">}}</span>

            <span class="o">&lt;</span><span class="nx">button</span><span class="o">&gt;</span><span class="nx">Delete</span> <span class="nx">Task</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="o">&lt;</span><span class="err">/tr&gt;</span>
</pre></div>

<p><a name="a-note-on-method-spoofing"></a></p>

<h4>A Note On Method Spoofing</h4>

<p>Note that the delete button&#39;s form <code>method</code> is listed as <code>POST</code>, even though we are responding to the request using a <code>Route::delete</code> route. HTML forms only allow the <code>GET</code> and <code>POST</code> HTTP verbs, so we need a way to spoof a <code>DELETE</code> request from the form.</p>

<p>We can spoof a <code>DELETE</code> request by outputting the results of the <code>method_field(&#39;DELETE&#39;)</code> function within our form. This function generates a hidden form input that Laravel recognizes and will use to override the actual HTTP request method. The generated field will look like the following:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="o">&gt;</span>
</pre></div>

<p><a name="deleting-the-task"></a></p>

<h3>Deleting The Task</h3>

<p>Finally, let&#39;s add logic to our route to actually delete the given task. We can use the Eloquent <code>findOrFail</code> method to retrieve a model by ID or throw a 404 exception if the model does not exist. Once we retrieve the model, we will use the <code>delete</code> method to delete the record. Once the record is deleted, we will redirect the user back to the <code>/</code> URL:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/task/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Task</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Redis</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#pipelining-commands">Pipelining Commands</a></li>
</ul></li>
<li><a href="#pubsub">Pub / Sub</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="http://redis.io">Redis</a> is an open source, advanced key-value store. It is often referred to as a data structure server since keys can contain <a href="http://redis.io/topics/data-types#strings">strings</a>, <a href="http://redis.io/topics/data-types#hashes">hashes</a>, <a href="http://redis.io/topics/data-types#lists">lists</a>, <a href="http://redis.io/topics/data-types#sets">sets</a>, and <a href="http://redis.io/topics/data-types#sorted-sets">sorted sets</a>. Before using Redis with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>The Redis configuration for your application is located in the <code>config/database.php</code> configuration file. Within this file, you will see a <code>redis</code> array containing the Redis servers used by your application:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;cluster&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span>     <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span>     <span class="p">=&gt;</span> <span class="mi">6379</span><span class="p">,</span>
        <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<p>The default server configuration should suffice for development. However, you are free to modify this array based on your environment. Simply give each Redis server a name, and specify the host and port used by the server.</p>

<p>The <code>cluster</code> option will tell the Laravel Redis client to perform client-side sharding across your Redis nodes, allowing you to pool nodes and create a large amount of available RAM. However, note that client-side sharding does not handle failover; therefore, is primarily suited for cached data that is available from another primary data store.</p>

<p>Additionally, you may define an <code>options</code> array value in your Redis connection definition, allowing you to specify a set of Predis <a href="https://github.com/nrk/predis/wiki/Client-Options">client options</a>.</p>

<p>If your Redis server requires authentication, you may supply a password by adding a <code>password</code> configuration item to your Redis server configuration array.</p>

<blockquote>
<p><strong>Note:</strong> If you have the Redis PHP extension installed via PECL, you will need to rename the alias for Redis in your <code>config/app.php</code> file.</p>
</blockquote>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>You may interact with Redis by calling various methods on the <code>Redis</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>Redis</code> facade supports dynamic methods, meaning you may call any <a href="http://redis.io/commands">Redis command</a> on the facade and the command will be passed directly to Redis. In this example, we will call the <code>GET</code> command on Redis by calling the <code>get</code> method on the <code>Redis</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Redis</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user:profile:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, as mentioned above, you may call any of the Redis commands on the <code>Redis</code> facade. Laravel uses magic methods to pass the commands to the Redis server, so simply pass the arguments the Redis command expects:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may also pass commands to the server using the <code>command</code> method, which accepts the name of the command as its first argument, and an array of values as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;lrange&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>
</pre></div>

<h4>Using Multiple Redis Connections</h4>

<p>You may get a Redis instance by calling the <code>Redis::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">();</span>
</pre></div>

<p>This will give you an instance of the default Redis server. If you are not using server clustering, you may pass the server name to the <code>connection</code> method to get a specific server as defined in your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="pipelining-commands"></a></p>

<h3>Pipelining Commands</h3>

<p>Pipelining should be used when you need to send many commands to the server in one operation. The <code>pipeline</code> method accepts one argument: a <code>Closure</code> that receives a Redis instance. You may issue all of your commands to this Redis instance and they will all be executed within a single operation:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">pipeline</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$pipe</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$pipe</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;key:$i&quot;</span><span class="p">,</span> <span class="nx">$i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="pubsub"></a></p>

<h2>Pub / Sub</h2>

<p>Laravel also provides a convenient interface to the Redis <code>publish</code> and <code>subscribe</code> commands. These Redis commands allow you to listen for messages on a given &quot;channel&quot;. You may publish messages to the channel from another application, or even using another programming language, allowing easy communication between applications / processes.</p>

<p>First, let&#39;s setup a listener on a channel via Redis using the <code>subscribe</code> method. We will place this method call within an <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> since calling the <code>subscribe</code> method begins a long-running process:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Redis</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RedisSubscribe</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;redis:subscribe&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;Subscribe to a Redis channel&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Redis</span><span class="o">::</span><span class="na">subscribe</span><span class="p">([</span><span class="s1">&#39;test-channel&#39;</span><span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, we may publish messages to the channel using the <code>publish</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Route logic...</span>

    <span class="nx">Redis</span><span class="o">::</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;test-channel&#39;</span><span class="p">,</span> <span class="nx">json_encode</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]));</span>
<span class="p">});</span>
</pre></div>

<h4>Wildcard Subscriptions</h4>

<p>Using the <code>psubscribe</code> method, you may subscribe to a wildcard channel, which is useful for catching all messages on all channels. The <code>$channel</code> name will be passed as the second argument to the provided callback <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">psubscribe</span><span class="p">([</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$message</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Redis</span><span class="o">::</span><span class="nx">psubscribe</span><span class="p">([</span><span class="s1">&#39;users.*&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$message</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Release Notes</h1>

<ul>
<li><a href="#support-policy">Support Policy</a></li>
<li><a href="#laravel-5.1.11">Laravel 5.1.11</a></li>
<li><a href="#laravel-5.1.4">Laravel 5.1.4</a></li>
<li><a href="#laravel-5.1">Laravel 5.1</a></li>
<li><a href="#laravel-5.0">Laravel 5.0</a></li>
<li><a href="#laravel-4.2">Laravel 4.2</a></li>
<li><a href="#laravel-4.1">Laravel 4.1</a></li>
</ul>

<p><a name="support-policy"></a></p>

<h2>Support Policy</h2>

<p>For LTS releases, such as Laravel 5.1, bug fixes are provided for 2 years and security fixes are provided for 3 years. These releases provide the longest window of support and maintenance.</p>

<p>For general releases, bug fixes are provided for 6 months and security fixes are provided for 1 year.</p>

<p><a name="laravel-5.1.11"></a></p>

<h2>Laravel 5.1.11</h2>

<p>Laravel 5.1.11 introduces <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization</a> support out of the box! Conveniently organize your application&#39;s authorization logic using simple callbacks or policy classes, and authorize actions using simple, expressive methods.</p>

<p>For more information, please refer to the <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization documentation</a>.</p>

<p><a name="laravel-5.1.4"></a></p>

<h2>Laravel 5.1.4</h2>

<p>Laravel 5.1.4 introduces simple login throttling to the framework. Consult the <a href="/docs/%7B%7Bversion%7D%7D/authentication#authentication-throttling">authentication documentation</a> for more information.</p>

<p><a name="laravel-5.1"></a></p>

<h2>Laravel 5.1</h2>

<p>Laravel 5.1 continues the improvements made in Laravel 5.0 by adopting PSR-2 and adding event broadcasting, middleware parameters, Artisan improvements, and more.</p>

<h3>PHP 5.5.9+</h3>

<p>Since PHP 5.4 will enter &quot;end of life&quot; in September and will no longer receive security updates from the PHP development team, Laravel 5.1 requires PHP 5.5.9 or greater. PHP 5.5.9 allows compatibility with the latest versions of popular PHP libraries such as Guzzle and the AWS SDK.</p>

<h3>LTS</h3>

<p>Laravel 5.1 is the first release of Laravel to receive <strong>long term support</strong>. Laravel 5.1 will receive bug fixes for 2 years and security fixes for 3 years. This support window is the largest ever provided for Laravel and provides stability and peace of mind for larger, enterprise clients and customers.</p>

<h3>PSR-2</h3>

<p>The <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md">PSR-2 coding style guide</a> has been adopted as the default style guide for the Laravel framework. Additionally, all generators have been updated to generate PSR-2 compatible syntax.</p>

<h3>Documentation</h3>

<p>Every page of the Laravel documentation has been meticulously reviewed and dramatically improved. All code examples have also been reviewed and expanded to provide more relevance and context.</p>

<h3>Event Broadcasting</h3>

<p>In many modern web applications, web sockets are used to implement real-time, live-updating user interfaces. When some data is updated on the server, a message is typically sent over a websocket connection to be handled by the client.</p>

<p>To assist you in building these types of applications, Laravel makes it easy to &quot;broadcast&quot; your events over a websocket connection. Broadcasting your Laravel events allows you to share the same event names between your server-side code and your client-side JavaScript framework.</p>

<p>To learn more about event broadcasting, check out the <a href="/docs/%7B%7Bversion%7D%7D/events#broadcasting-events">event documentation</a>.</p>

<h3>Middleware Parameters</h3>

<p>Middleware can now receive additional custom parameters. For example, if your application needs to verify that the authenticated user has a given &quot;role&quot; before performing a given action, you could create a <code>RoleMiddleware</code> that receives a role name as an additional argument:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RoleMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the request filter.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @param  string  $role</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasRole</span><span class="p">(</span><span class="nv">$role</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Redirect...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Middleware parameters may be specified when defining the route by separating the middleware name and parameters with a <code>:</code>. Multiple parameters should be delimited by commas:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;post/{id}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;role:editor&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p>For more information on middleware, check out the <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware documentation</a>.</p>

<h3>Testing Overhaul</h3>

<p>The built-in testing capabilities of Laravel have been dramatically improved. A variety of new methods provide a fluent, expressive interface for interacting with your application and examining its responses. For example, check out the following test:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testNewUserRegistration</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;terms&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">press</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">seePageIs</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>For more information on testing, check out the <a href="/docs/%7B%7Bversion%7D%7D/testing">testing documentation</a>.</p>

<h3>Model Factories</h3>

<p>Laravel now ships with an easy way to create stub Eloquent models using <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">model factories</a>. Model factories allow you to easily define a set of &quot;default&quot; attributes for your Eloquent model, and then generate test model instances for your tests or database seeds. Model factories also take advantage of the powerful <a href="https://github.com/fzaninotto/Faker">Faker</a> PHP library for generating random attribute data:</p>
<div class="highlight"><pre><span></span><span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">define</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$faker</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;remember_token&#39;</span> <span class="p">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">});</span>
</pre></div>

<p>For more information on model factories, check out <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">the documentation</a>.</p>

<h3>Artisan Improvements</h3>

<p>Artisan commands may now be defined using a simple, route-like &quot;signature&quot;, which provides an extremely simple interface for defining command line arguments and options. For example, you may define a simple command and its options like so:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user} {--force}&#39;</span><span class="p">;</span>
</pre></div>

<p>For more information on defining Artisan commands, consult the <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan documentation</a>.</p>

<h3>Folder Structure</h3>

<p>To better express intent, the <code>app/Commands</code> directory has been renamed to <code>app/Jobs</code>. Additionally, the <code>app/Handlers</code> directory has been consolidated into a single <code>app/Listeners</code> directory which simply contains event listeners. However, this is not a breaking change and you are not required to update to the new folder structure to use Laravel 5.1.</p>

<h3>Encryption</h3>

<p>In previous versions of Laravel, encryption was handled by the <code>mcrypt</code> PHP extension. However, beginning in Laravel 5.1, encryption is handled by the <code>openssl</code> extension, which is more actively maintained.</p>

<p><a name="laravel-5.0"></a></p>

<h2>Laravel 5.0</h2>

<p>Laravel 5.0 introduces a fresh application structure to the default Laravel project. This new structure serves as a better foundation for building a robust application in Laravel, as well as embraces new auto-loading standards (PSR-4) throughout the application. First, let&#39;s examine some of the major changes:</p>

<h3>New Folder Structure</h3>

<p>The old <code>app/models</code> directory has been entirely removed. Instead, all of your code lives directly within the <code>app</code> folder, and, by default, is organized to the <code>App</code> namespace. This default namespace can be quickly changed using the new <code>app:name</code> Artisan command.</p>

<p>Controllers, middleware, and requests (a new type of class in Laravel 5.0) are now grouped under the <code>app/Http</code> directory, as they are all classes related to the HTTP transport layer of your application. Instead of a single, flat file of route filters, all middleware are now broken into their own class files.</p>

<p>A new <code>app/Providers</code> directory replaces the <code>app/start</code> files from previous versions of Laravel 4.x. These service providers provide various bootstrapping functions to your application, such as error handling, logging, route loading, and more. Of course, you are free to create additional service providers for your application.</p>

<p>Application language files and views have been moved to the <code>resources</code> directory.</p>

<h3>Contracts</h3>

<p>All major Laravel components implement interfaces which are located in the <code>illuminate/contracts</code> repository. This repository has no external dependencies. Having a convenient, centrally located set of interfaces you may use for decoupling and dependency injection will serve as an easy alternative option to Laravel Facades.</p>

<p>For more information on contracts, consult the <a href="/docs/%7B%7Bversion%7D%7D/contracts">full documentation</a>.</p>

<h3>Route Cache</h3>

<p>If your application is made up entirely of controller routes, you may utilize the new <code>route:cache</code> Artisan command to drastically speed up the registration of your routes. This is primarily useful on applications with 100+ routes and will <strong>drastically</strong> speed up this portion of your application.</p>

<h3>Route Middleware</h3>

<p>In addition to Laravel 4 style route &quot;filters&quot;, Laravel 5 now supports HTTP middleware, and the included authentication and CSRF &quot;filters&quot; have been converted to middleware. Middleware provides a single, consistent interface to replace all types of filters, allowing you to easily inspect, and even reject, requests before they enter your application.</p>

<p>For more information on middleware, check out <a href="/docs/%7B%7Bversion%7D%7D/middleware">the documentation</a>.</p>

<h3>Controller Method Injection</h3>

<p>In addition to the existing constructor injection, you may now type-hint dependencies on controller methods. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject the dependencies, even if the route contains other parameters:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">createPost</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">PostRepository</span> <span class="nx">$posts</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h3>Authentication Scaffolding</h3>

<p>User registration, authentication, and password reset controllers are now included out of the box, as well as simple corresponding views, which are located at <code>resources/views/auth</code>. In addition, a &quot;users&quot; table migration has been included with the framework. Including these simple resources allows rapid development of application ideas without bogging down on authentication boilerplate. The authentication views may be accessed on the <code>auth/login</code> and <code>auth/register</code> routes. The <code>App\Services\Auth\Registrar</code> service is responsible for user validation and creation.</p>

<h3>Event Objects</h3>

<p>You may now define events as objects instead of simply using strings. For example, check out the following event:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PodcastWasPurchased</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$podcast</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nv">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span> <span class="o">=</span> <span class="nv">$podcast</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The event may be dispatched like normal:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p>Of course, your event handler will receive the event object instead of a list of data:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ReportPodcastPurchase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">PodcastWasPurchased</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>For more information on working with events, check out the <a href="/docs/%7B%7Bversion%7D%7D/events">full documentation</a>.</p>

<h3>Commands / Queueing</h3>

<p>In addition to the queue job format supported in Laravel 4, Laravel 5 allows you to represent your queued jobs as simple command objects. These commands live in the <code>app/Commands</code> directory. Here&#39;s a sample command:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PurchasePodcast</span> <span class="k">extends</span> <span class="nx">Command</span> <span class="k">implements</span> <span class="nx">SelfHandling</span><span class="p">,</span> <span class="nx">ShouldBeQueued</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$podcast</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new command instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Podcast</span> <span class="nv">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span> <span class="o">=</span> <span class="nv">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Handle the logic to purchase the podcast...</span>

        <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The base Laravel controller utilizes the new <code>DispatchesCommands</code> trait, allowing you to easily dispatch your commands for execution:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">PurchasePodcastCommand</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p>Of course, you may also use commands for tasks that are executed synchronously (are not queued). In fact, using commands is a great way to encapsulate complex tasks your application needs to perform. For more information, check out the <a href="/docs/5.0/bus">command bus</a> documentation.</p>

<h3>Database Queue</h3>

<p>A <code>database</code> queue driver is now included in Laravel, providing a simple, local queue driver that requires no extra package installation beyond your database software.</p>

<h3>Laravel Scheduler</h3>

<p>In the past, developers have generated a Cron entry for each console command they wished to schedule. However, this is a headache. Your console schedule is no longer in source control, and you must SSH into your server to add the Cron entries. Let&#39;s make our lives easier. The Laravel command scheduler allows you to fluently and expressively define your command schedule within Laravel itself, and only a single Cron entry is needed on your server.</p>

<p>It looks like this:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;artisan:command&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dailyAt</span><span class="p">(</span><span class="s1">&#39;15:00&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, check out the <a href="/docs/%7B%7Bversion%7D%7D/scheduling">full documentation</a> to learn all about the scheduler!</p>

<h3>Tinker / Psysh</h3>

<p>The <code>php artisan tinker</code> command now utilizes <a href="https://github.com/bobthecow/psysh">Psysh</a> by Justin Hileman, a more robust REPL for PHP. If you liked Boris in Laravel 4, you&#39;re going to love Psysh. Even better, it works on Windows! To get started, just try:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">tinker</span>
</pre></div>

<h3>DotEnv</h3>

<p>Instead of a variety of confusing, nested environment configuration directories, Laravel 5 now utilizes <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> by Vance Lucas. This library provides a super simple way to manage your environment configuration, and makes environment detection in Laravel 5 a breeze. For more details, check out the full <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">configuration documentation</a>.</p>

<h3>Laravel Elixir</h3>

<p>Laravel Elixir, by Jeffrey Way, provides a fluent, expressive interface to compiling and concatenating your assets. If you&#39;ve ever been intimidated by learning Grunt or Gulp, fear no more. Elixir makes it a cinch to get started using Gulp to compile your Less, Sass, and CoffeeScript. It can even run your tests for you!</p>

<p>For more information on Elixir, check out the <a href="/docs/%7B%7Bversion%7D%7D/elixir">full documentation</a>.</p>

<h3>Laravel Socialite</h3>

<p>Laravel Socialite is an optional, Laravel 5.0+ compatible package that provides totally painless authentication with OAuth providers. Currently, Socialite supports Facebook, Twitter, Google, and GitHub. Here&#39;s what it looks like:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">redirectForAuth</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getUserFromProvider</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>No more spending hours writing OAuth authentication flows. Get started in minutes! The <a href="/docs/%7B%7Bversion%7D%7D/authentication#social-authentication">full documentation</a> has all the details.</p>

<h3>Flysystem Integration</h3>

<p>Laravel now includes the powerful <a href="https://github.com/thephpleague/flysystem">Flysystem</a> filesystem abstraction library, providing pain free integration with local, Amazon S3, and Rackspace cloud storage - all with one, unified and elegant API! Storing a file in Amazon S3 is now as simple as:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">);</span>
</pre></div>

<p>For more information on the Laravel Flysystem integration, consult the <a href="/docs/%7B%7Bversion%7D%7D/filesystem">full documentation</a>.</p>

<h3>Form Requests</h3>

<p>Laravel 5.0 introduces <strong>form requests</strong>, which extend the <code>Illuminate\Foundation\Http\FormRequest</code> class. These request objects can be combined with controller method injection to provide a boiler-plate free method of validating user input. Let&#39;s dig in and look at a sample <code>FormRequest</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegisterRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|confirmed|min:8&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the class has been defined, we can type-hint it on our controller action:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="nx">RegisterRequest</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>When the Laravel service container identifies that the class it is injecting is a <code>FormRequest</code> instance, the request will <strong>automatically be validated</strong>. This means that if your controller action is called, you can safely assume the HTTP request input has been validated according to the rules you specified in your form request class. Even more, if the request is invalid, an HTTP redirect, which you may customize, will automatically be issued, and the error messages will be either flashed to the session or converted to JSON. <strong>Form validation has never been more simple.</strong> For more information on <code>FormRequest</code> validation, check out the <a href="/docs/%7B%7Bversion%7D%7D/validation#form-request-validation">documentation</a>.</p>

<h3>Simple Controller Request Validation</h3>

<p>The Laravel 5 base controller now includes a <code>ValidatesRequests</code> trait. This trait provides a simple <code>validate</code> method to validate incoming requests. If <code>FormRequests</code> are a little too much for your application, check this out:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">createPost</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>If the validation fails, an exception will be thrown and the proper HTTP response will automatically be sent back to the browser. The validation errors will even be flashed to the session! If the request was an AJAX request, Laravel even takes care of sending a JSON representation of the validation errors back to you.</p>

<p>For more information on this new method, check out <a href="/docs/%7B%7Bversion%7D%7D/validation#validation-quickstart">the documentation</a>.</p>

<h3>New Generators</h3>

<p>To complement the new default application structure, new Artisan generator commands have been added to the framework. See <code>php artisan list</code> for more details.</p>

<h3>Configuration Cache</h3>

<p>You may now cache all of your configuration in a single file using the <code>config:cache</code> command.</p>

<h3>Symfony VarDumper</h3>

<p>The popular <code>dd</code> helper function, which dumps variable debug information, has been upgraded to use the amazing Symfony VarDumper. This provides color-coded output and even collapsing of arrays. Just try the following in your project:</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p><a name="laravel-4.2"></a></p>

<h2>Laravel 4.2</h2>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.2 installation, or by <a href="https://github.com/laravel/framework/blob/4.2/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<blockquote>
<p><strong>Note:</strong> During the 4.2 release cycle, many small bug fixes and enhancements were incorporated into the various Laravel 4.1 point releases. So, be sure to check the change list for Laravel 4.1 as well!</p>
</blockquote>

<h3>PHP 5.4 Requirement</h3>

<p>Laravel 4.2 requires PHP 5.4 or greater. This upgraded PHP requirement allows us to use new PHP features such as traits to provide more expressive interfaces for tools like <a href="/docs/billing">Laravel Cashier</a>. PHP 5.4 also brings significant speed and performance improvements over PHP 5.3.</p>

<h3>Laravel Forge</h3>

<p>Laravel Forge, a new web based application, provides a simple way to create and manage PHP servers on the cloud of your choice, including Linode, DigitalOcean, Rackspace, and Amazon EC2. Supporting automated Nginx configuration, SSH key access, Cron job automation, server monitoring via NewRelic &amp; Papertrail, &quot;Push To Deploy&quot;, Laravel queue worker configuration, and more, Forge provides the simplest and most affordable way to launch all of your Laravel applications.</p>

<p>The default Laravel 4.2 installation&#39;s <code>app/config/database.php</code> configuration file is now configured for Forge usage by default, allowing for more convenient deployment of fresh applications onto the platform.</p>

<p>More information about Laravel Forge can be found on the <a href="https://forge.laravel.com">official Forge website</a>.</p>

<h3>Laravel Homestead</h3>

<p>Laravel Homestead is an official Vagrant environment for developing robust Laravel and PHP applications. The vast majority of the boxes&#39; provisioning needs are handled before the box is packaged for distribution, allowing the box to boot extremely quickly. Homestead includes Nginx 1.6, PHP 5.6, MySQL, Postgres, Redis, Memcached, Beanstalk, Node, Gulp, Grunt, &amp; Bower. Homestead includes a simple <code>Homestead.yaml</code> configuration file for managing multiple Laravel applications on a single box.</p>

<p>The default Laravel 4.2 installation now includes an <code>app/config/local/database.php</code> configuration file that is configured to use the Homestead database out of the box, making Laravel initial installation and configuration more convenient.</p>

<p>The official documentation has also been updated to include <a href="/docs/homestead">Homestead documentation</a>.</p>

<h3>Laravel Cashier</h3>

<p>Laravel Cashier is a simple, expressive library for managing subscription billing with Stripe. With the introduction of Laravel 4.2, we are including Cashier documentation along with the main Laravel documentation, though installation of the component itself is still optional. This release of Cashier brings numerous bug fixes, multi-currency support, and compatibility with the latest Stripe API.</p>

<h3>Daemon Queue Workers</h3>

<p>The Artisan <code>queue:work</code> command now supports a <code>--daemon</code> option to start a worker in &quot;daemon mode&quot;, meaning the worker will continue to process jobs without ever re-booting the framework. This results in a significant reduction in CPU usage at the cost of a slightly more complex application deployment process.</p>

<p>More information about daemon queue workers can be found in the <a href="/docs/queues#daemon-queue-worker">queue documentation</a>.</p>

<h3>Mail API Drivers</h3>

<p>Laravel 4.2 introduces new Mailgun and Mandrill API drivers for the <code>Mail</code> functions. For many applications, this provides a faster and more reliable method of sending e-mails than the SMTP options. The new drivers utilize the Guzzle 4 HTTP library.</p>

<h3>Soft Deleting Traits</h3>

<p>A much cleaner architecture for &quot;soft deletes&quot; and other &quot;global scopes&quot; has been introduced via PHP 5.4 traits. This new architecture allows for the easier construction of similar global traits, and a cleaner separation of concerns within the framework itself.</p>

<p>More information on the new <code>SoftDeletingTrait</code> may be found in the <a href="/docs/eloquent#soft-deleting">Eloquent documentation</a>.</p>

<h3>Convenient Auth &amp; Remindable Traits</h3>

<p>The default Laravel 4.2 installation now uses simple traits for including the needed properties for the authentication and password reminder user interfaces. This provides a much cleaner default <code>User</code> model file out of the box.</p>

<h3>&quot;Simple Paginate&quot;</h3>

<p>A new <code>simplePaginate</code> method was added to the query and Eloquent builder which allows for more efficient queries when using simple &quot;Next&quot; and &quot;Previous&quot; links in your pagination view.</p>

<h3>Migration Confirmation</h3>

<p>In production, destructive migration operations will now ask for confirmation. Commands may be forced to run without any prompts using the <code>--force</code> command.</p>

<p><a name="laravel-4.1"></a></p>

<h2>Laravel 4.1</h2>

<h3>Full Change List</h3>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.1 installation, or by <a href="https://github.com/laravel/framework/blob/4.1/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<h3>New SSH Component</h3>

<p>An entirely new <code>SSH</code> component has been introduced with this release. This feature allows you to easily SSH into remote servers and run commands. To learn more, consult the <a href="/docs/4.1/ssh">SSH component documentation</a>.</p>

<p>The new <code>php artisan tail</code> command utilizes the new SSH component. For more information, consult the <code>tail</code> <a href="http://laravel.com/docs/4.1/ssh#tailing-remote-logs">command documentation</a>.</p>

<h3>Boris In Tinker</h3>

<p>The <code>php artisan tinker</code> command now utilizes the <a href="https://github.com/d11wtq/boris">Boris REPL</a> if your system supports it. The <code>readline</code> and <code>pcntl</code> PHP extensions must be installed to use this feature. If you do not have these extensions, the shell from 4.0 will be used.</p>

<h3>Eloquent Improvements</h3>

<p>A new <code>hasManyThrough</code> relationship has been added to Eloquent. To learn how to use it, consult the <a href="/docs/eloquent#has-many-through">Eloquent documentation</a>.</p>

<p>A new <code>whereHas</code> method has also been introduced to allow <a href="/docs/eloquent#querying-relations">retrieving models based on relationship constraints</a>.</p>

<h3>Database Read / Write Connections</h3>

<p>Automatic handling of separate read / write connections is now available throughout the database layer, including the query builder and Eloquent. For more information, consult <a href="/docs/database#read-write-connections">the documentation</a>.</p>

<h3>Queue Priority</h3>

<p>Queue priorities are now supported by passing a comma-delimited list to the <code>queue:listen</code> command.</p>

<h3>Failed Queue Job Handling</h3>

<p>The queue facilities now include automatic handling of failed jobs when using the new <code>--tries</code> switch on <code>queue:listen</code>. More information on handling failed jobs can be found in the <a href="/docs/queues#failed-jobs">queue documentation</a>.</p>

<h3>Cache Tags</h3>

<p>Cache &quot;sections&quot; have been superseded by &quot;tags&quot;. Cache tags allow you to assign multiple &quot;tags&quot; to a cache item, and flush all items assigned to a single tag. More information on using cache tags may be found in the <a href="/docs/cache#cache-tags">cache documentation</a>.</p>

<h3>Flexible Password Reminders</h3>

<p>The password reminder engine has been changed to provide greater developer flexibility when validating passwords, flashing status messages to the session, etc. For more information on using the enhanced password reminder engine, <a href="/docs/4.1/security#password-reminders-and-reset">consult the documentation</a>.</p>

<h3>Improved Routing Engine</h3>

<p>Laravel 4.1 features a totally re-written routing layer. The API is the same; however, registering routes is a full 100% faster compared to 4.0. The entire engine has been greatly simplified, and the dependency on Symfony Routing has been minimized to the compiling of route expressions.</p>

<h3>Improved Session Engine</h3>

<p>With this release, we&#39;re also introducing an entirely new session engine. Similar to the routing improvements, the new session layer is leaner and faster. We are no longer using Symfony&#39;s (and therefore PHP&#39;s) session handling facilities, and are using a custom solution that is simpler and easier to maintain.</p>

<h3>Doctrine DBAL</h3>

<p>If you are using the <code>renameColumn</code> function in your migrations, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file. This package is no longer included in Laravel by default.</p>
<div style="page-break-after: always;" ></div><h1>HTTP Requests</h1>

<ul>
<li><a href="#accessing-the-request">Accessing The Request</a>

<ul>
<li><a href="#basic-request-information">Basic Request Information</a></li>
<li><a href="#psr7-requests">PSR-7 Requests</a></li>
</ul></li>
<li><a href="#retrieving-input">Retrieving Input</a>

<ul>
<li><a href="#old-input">Old Input</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#files">Files</a></li>
</ul></li>
</ul>

<p><a name="accessing-the-request"></a></p>

<h2>Accessing The Request</h2>

<p>To obtain an instance of the current HTTP request via dependency injection, you should type-hint the <code>Illuminate\Http\Request</code> class on your controller constructor or method. The current request instance will automatically be injected by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If your controller method is also expecting input from a route parameter, simply list your route arguments after your other dependencies. For example, if your route is defined like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@update&#39;</span><span class="p">);</span>
</pre></div>

<p>You may still type-hint the <code>Illuminate\Http\Request</code> and access your route parameter <code>id</code> by defining your controller method like the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the specified user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="basic-request-information"></a></p>

<h3>Basic Request Information</h3>

<p>The <code>Illuminate\Http\Request</code> instance provides a variety of methods for examining the HTTP request for your application. The Laravel <code>Illuminate\Http\Request</code> extends the <code>Symfony\Component\HttpFoundation\Request</code> class. Here are a few more of the useful methods available on this class:</p>

<h4>Retrieving The Request URI</h4>

<p>The <code>path</code> method returns the request&#39;s URI. So, if the incoming request is targeted at <code>http://domain.com/foo/bar</code>, the <code>path</code> method will return <code>foo/bar</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$uri</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">path</span><span class="p">();</span>
</pre></div>

<p>The <code>is</code> method allows you to verify that the incoming request URI matches a given pattern. You may use the <code>*</code> character as a wildcard when utilizing this method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To get the full URL, not just the path info, you may use the <code>url</code> method on the request instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">url</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Request Method</h4>

<p>The <code>method</code> method will return the HTTP verb for the request. You may also use the <code>isMethod</code> method to verify that the HTTP verb matches a given string:</p>
<div class="highlight"><pre><span></span><span class="nx">$method</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">method</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">isMethod</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="psr7-requests"></a></p>

<h3>PSR-7 Requests</h3>

<p>The PSR-7 standard specifies interfaces for HTTP messages, including requests and responses. If you would like to obtain an instance of a PSR-7 request, you will first need to install a few libraries. Laravel uses the Symfony HTTP Message Bridge component to convert typical Laravel requests and responses into PSR-7 compatible implementations:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">symfony</span><span class="o">/</span><span class="nx">psr</span><span class="o">-</span><span class="nx">http</span><span class="o">-</span><span class="nx">message</span><span class="o">-</span><span class="nx">bridge</span>

<span class="nx">composer</span> <span class="nx">require</span> <span class="nx">zendframework</span><span class="o">/</span><span class="nx">zend</span><span class="o">-</span><span class="nx">diactoros</span>
</pre></div>

<p>Once you have installed these libraries, you may obtain a PSR-7 request by simply type-hinting the request type on your route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Psr</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Message</span><span class="err">\</span><span class="nx">ServerRequestInterface</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ServerRequestInterface</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If you return a PSR-7 response instance from a route or controller, it will automatically be converted back to a Laravel response instance and be displayed by the framework.</p>

<p><a name="retrieving-input"></a></p>

<h2>Retrieving Input</h2>

<h4>Retrieving An Input Value</h4>

<p>Using a few simple methods, you may access all user input from your <code>Illuminate\Http\Request</code> instance. You do not need to worry about the HTTP verb used for the request, as input is accessed in the same way for all verbs:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may access user input using the properties of the <code>Illuminate\Http\Request</code> instance. For example, if one of your application&#39;s forms contains a <code>name</code> field, you may access the value of the posted field like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
</pre></div>

<p>You may pass a default value as the second argument to the <code>input</code> method. This value will be returned if the requested input value is not present on the request:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">);</span>
</pre></div>

<p>When working on forms with array inputs, you may use &quot;dot&quot; notation to access the arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;products.0.name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If An Input Value Is Present</h4>

<p>To determine if a value is present on the request, you may use the <code>has</code> method. The <code>has</code> method returns <code>true</code> if the value is present <strong>and</strong> is not an empty string:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving All Input Data</h4>

<p>You may also retrieve all of the input data as an <code>array</code> using the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Retrieving A Portion Of The Input Data</h4>

<p>If you need to retrieve a sub-set of the input data, you may use the <code>only</code> and <code>except</code> methods. Both of these methods will accept a single <code>array</code> or a dynamic list of arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">]);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span><span class="s1">&#39;credit_card&#39;</span><span class="p">]);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;credit_card&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="old-input"></a></p>

<h3>Old Input</h3>

<p>Laravel allows you to keep input from one request during the next request. This feature is particularly useful for re-populating forms after detecting validation errors. However, if you are using Laravel&#39;s included <a href="/docs/%7B%7Bversion%7D%7D/validation">validation services</a>, it is unlikely you will need to manually use these methods, as some of Laravel&#39;s built-in validation facilities will call them automatically.</p>

<h4>Flashing Input To The Session</h4>

<p>The <code>flash</code> method on the <code>Illuminate\Http\Request</code> instance will flash the current input to the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a> so that it is available during the user&#39;s next request to the application:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flash</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>flashOnly</code> and <code>flashExcept</code> methods to flash a sub-set of the request data into the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flashOnly</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">);</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flashExcept</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>

<h4>Flash Input Into Session Then Redirect</h4>

<p>Since you often will want to flash input in association with a redirect to the previous page, you may easily chain input flashing onto a redirect using the <code>withInput</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">));</span>
</pre></div>

<h4>Retrieving Old Data</h4>

<p>To retrieve flashed input from the previous request, use the <code>old</code> method on the <code>Request</code> instance. The <code>old</code> method provides a convenient helper for pulling the flashed input data out of the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$username</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>

<p>Laravel also provides a global <code>old</code> helper function. If you are displaying old input within a <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade template</a>, it is more convenient to use the <code>old</code> helper:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p><a name="cookies"></a></p>

<h3>Cookies</h3>

<h4>Retrieving Cookies From The Request</h4>

<p>All cookies created by the Laravel framework are encrypted and signed with an authentication code, meaning they will be considered invalid if they have been changed by the client. To retrieve a cookie value from the request, you may use the <code>cookie</code> method on the <code>Illuminate\Http\Request</code> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Attaching A New Cookie To A Response</h4>

<p>Laravel provides a global <code>cookie</code> helper function which serves as a simple factory for generating new <code>Symfony\Component\HttpFoundation\Cookie</code> instances. The cookies may be attached to a <code>Illuminate\Http\Response</code> instance using the <code>withCookie</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>

<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">));</span>

<span class="k">return</span> <span class="nx">$response</span><span class="p">;</span>
</pre></div>

<p>To create a long-lived cookie, which lasts for five years, you may use the <code>forever</code> method on the cookie factory by first calling the <code>cookie</code> helper with no arguments, and then chaining the <code>forever</code> method onto the returned cookie factory:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="files"></a></p>

<h3>Files</h3>

<h4>Retrieving Uploaded Files</h4>

<p>You may access uploaded files that are included with the <code>Illuminate\Http\Request</code> instance using the <code>file</code> method. The object returned by the <code>file</code> method is an instance of the <code>Symfony\Component\HttpFoundation\File\UploadedFile</code> class, which extends the PHP <code>SplFileInfo</code> class and provides a variety of methods for interacting with the file:</p>
<div class="highlight"><pre><span></span><span class="nx">$file</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">);</span>
</pre></div>

<h4>Verifying File Presence</h4>

<p>You may also determine if a file is present on the request using the <code>hasFile</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">hasFile</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Validating Successful Uploads</h4>

<p>In addition to checking if the file is present, you may verify that there were no problems uploading the file via the <code>isValid</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Moving Uploaded Files</h4>

<p>To move the uploaded file to a new location, you should use the <code>move</code> method. This method will move the file from its temporary upload location (as determined by your PHP configuration) to a more permanent destination of your choosing:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">);</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">,</span> <span class="nx">$fileName</span><span class="p">);</span>
</pre></div>

<h4>Other File Methods</h4>

<p>There are a variety of other methods available on <code>UploadedFile</code> instances. Check out the <a href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/File/UploadedFile.html">API documentation for the class</a> for more information regarding these methods.</p>
<div style="page-break-after: always;" ></div><h1>HTTP Responses</h1>

<ul>
<li><a href="#basic-responses">Basic Responses</a>

<ul>
<li><a href="#attaching-headers-to-responses">Attaching Headers To Responses</a></li>
<li><a href="#attaching-cookies-to-responses">Attaching Cookies To Responses</a></li>
</ul></li>
<li><a href="#other-response-types">Other Response Types</a>

<ul>
<li><a href="#view-responses">View Responses</a></li>
<li><a href="#json-responses">JSON Responses</a></li>
<li><a href="#file-downloads">File Downloads</a></li>
</ul></li>
<li><a href="#redirects">Redirects</a>

<ul>
<li><a href="#redirecting-named-routes">Redirecting To Named Routes</a></li>
<li><a href="#redirecting-controller-actions">Redirecting To Controller Actions</a></li>
<li><a href="#redirecting-with-flashed-session-data">Redirecting With Flashed Session Data</a></li>
</ul></li>
<li><a href="#response-macros">Response Macros</a></li>
</ul>

<p><a name="basic-responses"></a></p>

<h2>Basic Responses</h2>

<p>Of course, all routes and controllers should return some kind of response to be sent back to the user&#39;s browser. Laravel provides several different ways to return responses. The most basic response is simply returning a string from a route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The given string will automatically be converted into an HTTP response by the framework.</p>

<p>However, for most routes and controller actions, you will be returning a full <code>Illuminate\Http\Response</code> instance or a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a>. Returning a full <code>Response</code> instance allows you to customize the response&#39;s HTTP status code and headers. A <code>Response</code> instance inherits from the <code>Symfony\Component\HttpFoundation\Response</code> class, providing a variety of methods for building HTTP responses:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Response</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">$status</span><span class="p">))</span>
                  <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>For convenience, you may also use the <code>response</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">$status</span><span class="p">)</span>
                  <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> For a full list of available <code>Response</code> methods, check out its <a href="http://laravel.com/api/master/Illuminate/Http/Response.html">API documentation</a> and the <a href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/Response.html">Symfony API documentation</a>.</p>
</blockquote>

<p><a name="attaching-headers-to-responses"></a></p>

<h4>Attaching Headers To Responses</h4>

<p>Keep in mind that most response methods are chainable, allowing for the fluent building of responses. For example, you may use the <code>header</code> method to add a series of headers to the response before sending it back to the user:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;X-Header-One&#39;</span><span class="p">,</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;X-Header-Two&#39;</span><span class="p">,</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="attaching-cookies-to-responses"></a></p>

<h4>Attaching Cookies To Responses</h4>

<p>The <code>withCookie</code> helper method on the response instance allows you to easily attach cookies to the response. For example, you may use the <code>withCookie</code> method to generate a cookie and attach it to the response instance:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>withCookie</code> method accepts additional optional arguments which allow you to further customize your cookie&#39;s properties:</p>
<div class="highlight"><pre><span></span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="nx">$path</span><span class="p">,</span> <span class="nx">$domain</span><span class="p">,</span> <span class="nx">$secure</span><span class="p">,</span> <span class="nx">$httpOnly</span><span class="p">)</span>
</pre></div>

<p>By default, all cookies generated by Laravel are encrypted and signed so that they can&#39;t be modified or read by the client. If you would like to disable encryption for a certain subset of cookies generated by your application, you may use the <code>$except</code> property of the <code>App\Http\Middleware\EncryptCookies</code> middleware:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The names of the cookies that should not be encrypted.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$except</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;cookie_name&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="other-response-types"></a></p>

<h2>Other Response Types</h2>

<p>The <code>response</code> helper may be used to conveniently generate other types of response instances. When the <code>response</code> helper is called without arguments, an implementation of the <code>Illuminate\Contracts\Routing\ResponseFactory</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a> is returned. This contract provides several helpful methods for generating responses.</p>

<p><a name="view-responses"></a></p>

<h4>View Responses</h4>

<p>If you need control over the response status and headers, but also need to return a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a> as the response content, you may use the <code>view</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">);</span>
</pre></div>

<p>Of course, if you do not need to pass a custom HTTP status code or custom headers, you may simply use the global <code>view</code> helper function.</p>

<p><a name="json-responses"></a></p>

<h4>JSON Responses</h4>

<p>The <code>json</code> method will automatically set the <code>Content-Type</code> header to <code>application/json</code>, as well as convert the given array into JSON using the <code>json_encode</code> PHP function:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">]);</span>
</pre></div>

<p>If you would like to create a JSONP response, you may use the <code>json</code> method in addition to <code>setCallback</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">])</span>
                 <span class="o">-&gt;</span><span class="nx">setCallback</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="file-downloads"></a></p>

<h4>File Downloads</h4>

<p>The <code>download</code> method may be used to generate a response that forces the user&#39;s browser to download the file at the given path. The <code>download</code> method accepts a file name as the second argument to the method, which will determine the file name that is seen by the user downloading the file. Finally, you may pass an array of HTTP headers as the third argument to the method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Symfony HttpFoundation, which manages file downloads, requires the file being downloaded to have an ASCII file name.</p>
</blockquote>

<p><a name="redirects"></a></p>

<h2>Redirects</h2>

<p>Redirect responses are instances of the <code>Illuminate\Http\RedirectResponse</code> class, and contain the proper headers needed to redirect the user to another URL. There are several ways to generate a <code>RedirectResponse</code> instance. The simplest method is to use the global <code>redirect</code> helper method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home/dashboard&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Sometimes you may wish to redirect the user to their previous location, for example, after a form submission that is invalid. You may do so by using the global <code>back</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Validate the request...</span>

    <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="redirecting-named-routes"></a></p>

<h4>Redirecting To Named Routes</h4>

<p>When you call the <code>redirect</code> helper with no parameters, an instance of <code>Illuminate\Routing\Redirector</code> is returned, allowing you to call any method on the <code>Redirector</code> instance. For example, to generate a <code>RedirectResponse</code> to a named route, you may use the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>If your route has parameters, you may pass them as the second argument to the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>If you are redirecting to a route with an &quot;ID&quot; parameter that is being populated from an Eloquent model, you may simply pass the model itself. The ID will be extracted automatically:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$user</span><span class="p">]);</span>
</pre></div>

<p><a name="redirecting-controller-actions"></a></p>

<h4>Redirecting To Controller Actions</h4>

<p>You may also generate redirects to <a href="/docs/%7B%7Bversion%7D%7D/controllers">controller actions</a>. To do so, simply pass the controller and action name to the <code>action</code> method. Remember, you do not need to specify the full namespace to the controller since Laravel&#39;s <code>RouteServiceProvider</code> will automatically set the default controller namespace:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, if your controller route requires parameters, you may pass them as the second argument to the <code>action</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="redirecting-with-flashed-session-data"></a></p>

<h4>Redirecting With Flashed Session Data</h4>

<p>Redirecting to a new URL and <a href="/docs/%7B%7Bversion%7D%7D/session#flash-data">flashing data to the session</a> are typically done at the same time. So, for convenience, you may create a <code>RedirectResponse</code> instance <strong>and</strong> flash data to the session in a single method chain. This is particularly convenient for storing status messages after an action:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Update the user&#39;s profile...</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile updated!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, after the user is redirected to a new page, you may retrieve and display the flashed message from the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">))</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-success&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<p><a name="response-macros"></a></p>

<h2>Response Macros</h2>

<p>If you would like to define a custom response that you can re-use in a variety of your routes and controllers, you may use the <code>macro</code> method on an implementation of <code>Illuminate\Contracts\Routing\ResponseFactory</code>.</p>

<p>For example, from a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider&#39;s</a> <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Routing\ResponseFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ResponseMacroServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  ResponseFactory  $factory</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">(</span><span class="nx">ResponseFactory</span> <span class="nv">$factory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$factory</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>macro</code> function accepts a name as its first argument, and a Closure as its second. The macro&#39;s Closure will be executed when calling the macro name from a <code>ResponseFactory</code> implementation or the <code>response</code> helper:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">caps</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Routing</h1>

<ul>
<li><a href="#basic-routing">Basic Routing</a></li>
<li><a href="#route-parameters">Route Parameters</a>

<ul>
<li><a href="#required-parameters">Required Parameters</a></li>
<li><a href="#parameters-optional-parameters">Optional Parameters</a></li>
<li><a href="#parameters-regular-expression-constraints">Regular Expression Constraints</a></li>
</ul></li>
<li><a href="#named-routes">Named Routes</a></li>
<li><a href="#route-groups">Route Groups</a>

<ul>
<li><a href="#route-group-middleware">Middleware</a></li>
<li><a href="#route-group-namespaces">Namespaces</a></li>
<li><a href="#route-group-sub-domain-routing">Sub-Domain Routing</a></li>
<li><a href="#route-group-prefixes">Route Prefixes</a></li>
</ul></li>
<li><a href="#csrf-protection">CSRF Protection</a>

<ul>
<li><a href="#csrf-introduction">Introduction</a></li>
<li><a href="#csrf-excluding-uris">Excluding URIs</a></li>
<li><a href="#csrf-x-csrf-token">X-CSRF-Token</a></li>
<li><a href="#csrf-x-xsrf-token">X-XSRF-Token</a></li>
</ul></li>
<li><a href="#route-model-binding">Route Model Binding</a></li>
<li><a href="#form-method-spoofing">Form Method Spoofing</a></li>
<li><a href="#throwing-404-errors">Throwing 404 Errors</a></li>
</ul>

<p><a name="basic-routing"></a></p>

<h2>Basic Routing</h2>

<p>You will define most of the routes for your application in the <code>app/Http/routes.php</code> file, which is loaded by the <code>App\Providers\RouteServiceProvider</code> class. The most basic Laravel routes simply accept a URI and a <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Route For Multiple Verbs</h4>

<p>Sometimes you may need to register a route that responds to multiple HTTP verbs. You may do so using the <code>match</code> method on the <code>Route</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">match</span><span class="p">([</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">],</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Or, you may even register a route that responds to all HTTP verbs using the <code>any</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">any</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Generating URLs To Routes</h4>

<p>You may generate URLs to your application&#39;s routes using the <code>url</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="route-parameters"></a></p>

<h2>Route Parameters</h2>

<p><a name="required-parameters"></a></p>

<h3>Required Parameters</h3>

<p>Of course, sometimes you will need to capture segments of the URI within your route. For example, you may need to capture a user&#39;s ID from the URL. You may do so by defining route parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;User &#39;</span><span class="p">.</span><span class="nx">$id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>You may define as many route parameters as required by your route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;posts/{post}/comments/{comment}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$postId</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Route parameters are always encased within &quot;curly&quot; braces. The parameters will be passed into your route&#39;s <code>Closure</code> when the route is executed.</p>

<blockquote>
<p><strong>Note:</strong> Route parameters cannot contain the <code>-</code> character. Use an underscore (<code>_</code>) instead.</p>
</blockquote>

<p><a name="parameters-optional-parameters"></a></p>

<h3>Optional Parameters</h3>

<p>Occasionally you may need to specify a route parameter, but make the presence of that route parameter optional. You may do so by placing a <code>?</code> mark after the parameter name:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="parameters-regular-expression-constraints"></a></p>

<h3>Regular Expression Constraints</h3>

<p>You may constrain the format of your route parameters using the <code>where</code> method on a route instance. The <code>where</code> method accepts the name of the parameter and a regular expression defining how the parameter should be constrained:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;[A-Za-z]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[a-z]+&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="parameters-global-constraints"></a></p>

<h4>Global Constraints</h4>

<p>If you would like a route parameter to always be constrained by a given regular expression, you may use the <code>pattern</code> method. You should define these patterns in the <code>boot</code> method of your <code>RouteServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define your route model bindings, pattern filters, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Routing\Router  $router</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">Router</span> <span class="nx">$router</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>

    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$router</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Once the pattern has been defined, it is automatically applied to all routes using that parameter name:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only called if {id} is numeric.</span>
<span class="p">});</span>
</pre></div>

<p><a name="named-routes"></a></p>

<h2>Named Routes</h2>

<p>Named routes allow you to conveniently generate URLs or redirects for a specific route. You may specify a name for a route using the <code>as</code> array key when defining the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p>You may also specify route names for controller actions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>Instead of specifying the route name in the route array definition, you may chain the <code>name</code> method onto the end of the route definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<h4>Route Groups &amp; Named Routes</h4>

<p>If you are using <a href="#route-groups">route groups</a>, you may specify an <code>as</code> keyword in the route group attribute array, allowing you to set a common route name prefix for all routes within the group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;admin::&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Route named &quot;admin::dashboard&quot;</span>
    <span class="p">}]);</span>
<span class="p">});</span>
</pre></div>

<h4>Generating URLs To Named Routes</h4>

<p>Once you have assigned a name to a given route, you may use the route&#39;s name when generating URLs or redirects via the <code>route</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="nx">$redirect</span> <span class="o">=</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>If the route defines parameters, you may pass the parameters as the second argument to the <code>route</code> method. The given parameters will automatically be inserted into the URL:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="route-groups"></a></p>

<h2>Route Groups</h2>

<p>Route groups allow you to share route attributes, such as middleware or namespaces, across a large number of routes without needing to define those attributes on each individual route. Shared attributes are specified in an array format as the first parameter to the <code>Route::group</code> method.</p>

<p>To learn more about route groups, we&#39;ll walk through several common use-cases for the feature.</p>

<p><a name="route-group-middleware"></a></p>

<h3>Middleware</h3>

<p>To assign middleware to all routes within a group, you may use the <code>middleware</code> key in the group attribute array. Middleware will be executed in the order you define this array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span>    <span class="p">{</span>
        <span class="c1">// Uses Auth Middleware</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Uses Auth Middleware</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-group-namespaces"></a></p>

<h3>Namespaces</h3>

<p>Another common use-case for route groups is assigning the same PHP namespace to a group of controllers. You may use the <code>namespace</code> parameter in your group attribute array to specify the namespace for all controllers within the group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;namespace&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Controllers Within The &quot;App\Http\Controllers\Admin&quot; Namespace</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;namespace&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Controllers Within The &quot;App\Http\Controllers\Admin\User&quot; Namespace</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>Remember, by default, the <code>RouteServiceProvider</code> includes your <code>routes.php</code> file within a namespace group, allowing you to register controller routes without specifying the full <code>App\Http\Controllers</code> namespace prefix. So, we only need to specify the portion of the namespace that comes after the base <code>App\Http\Controllers</code> namespace root.</p>

<p><a name="route-group-sub-domain-routing"></a></p>

<h3>Sub-Domain Routing</h3>

<p>Route groups may also be used to route wildcard sub-domains. Sub-domains may be assigned route parameters just like route URIs, allowing you to capture a portion of the sub-domain for usage in your route or controller. The sub-domain may be specified using the <code>domain</code> key on the group attribute array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{account}.myapp.com&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$account</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-group-prefixes"></a></p>

<h3>Route Prefixes</h3>

<p>The <code>prefix</code> group array attribute may be used to prefix each route in the group with a given URI. For example, you may want to prefix all route URIs within the group with <code>admin</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span>    <span class="p">{</span>
        <span class="c1">// Matches The &quot;/admin/users&quot; URL</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>You may also use the <code>prefix</code> parameter to specify common parameters for your grouped routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;accounts/{account_id}&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$account_id</span><span class="p">)</span>    <span class="p">{</span>
        <span class="c1">// Matches The accounts/{account_id}/detail URL</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="csrf-protection"></a></p>

<h2>CSRF Protection</h2>

<p><a name="csrf-introduction"></a></p>

<h3>Introduction</h3>

<p>Laravel makes it easy to protect your application from <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgeries</a>. Cross-site request forgeries are a type of malicious exploit whereby unauthorized commands are performed on behalf of the authenticated user.</p>

<p>Laravel automatically generates a CSRF &quot;token&quot; for each active user session managed by the application. This token is used to verify that the authenticated user is the one actually making the requests to the application. To generate a hidden input field <code>_token</code> containing the CSRF token, you may use the <code>csrf_field</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">csrf_field</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>The <code>csrf_field</code> helper function generates the following HTML:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">csrf_token</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>Of course, using the Blade <a href="/docs/%7B%7Bversion%7D%7D/blade">templating engine</a>:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>You do not need to manually verify the CSRF token on POST, PUT, or DELETE requests. The <code>VerifyCsrfToken</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">HTTP middleware</a> will verify that the token in the request input matches the token stored in the session.</p>

<p><a name="csrf-excluding-uris"></a></p>

<h3>Excluding URIs From CSRF Protection</h3>

<p>Sometimes you may wish to exclude a set of URIs from CSRF protection. For example, if you are using <a href="https://stripe.com">Stripe</a> to process payments and are utilizing their webhook system, you will need to exclude your webhook handler route from Laravel&#39;s CSRF protection.</p>

<p>You may exclude URIs by adding them to the <code>$except</code> property of the <code>VerifyCsrfToken</code> middleware:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Middleware\VerifyCsrfToken</span> <span class="k">as</span> <span class="nx">BaseVerifier</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VerifyCsrfToken</span> <span class="k">extends</span> <span class="nx">BaseVerifier</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The URIs that should be excluded from CSRF verification.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$except</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;stripe/*&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="csrf-x-csrf-token"></a></p>

<h3>X-CSRF-TOKEN</h3>

<p>In addition to checking for the CSRF token as a POST parameter, the Laravel <code>VerifyCsrfToken</code> middleware will also check for the <code>X-CSRF-TOKEN</code> request header. You could, for example, store the token in a &quot;meta&quot; tag:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;csrf-token&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>Once you have created the <code>meta</code> tag, you can instruct a library like jQuery to add the token to all request headers. This provides simple, convenient CSRF protection for your AJAX based applications:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;X-CSRF-TOKEN&#39;</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="csrf-x-xsrf-token"></a></p>

<h3>X-XSRF-TOKEN</h3>

<p>Laravel also stores the CSRF token in a <code>XSRF-TOKEN</code> cookie. You can use the cookie value to set the <code>X-XSRF-TOKEN</code> request header. Some JavaScript frameworks, like Angular, do this automatically for you. It is unlikely that you will need to use this value manually.</p>

<p><a name="route-model-binding"></a></p>

<h2>Route Model Binding</h2>

<p>Laravel route model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user&#39;s ID, you can inject the entire <code>User</code> class instance that matches the given ID.</p>

<p>First, use the router&#39;s <code>model</code> method to specify the class for a given parameter. You should define your model bindings in the <code>RouteServiceProvider::boot</code> method:</p>

<h4>Binding A Parameter To A Model</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">Router</span> <span class="nx">$router</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$router</span><span class="p">);</span>

    <span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Next, define a route that contains a <code>{user}</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Since we have bound the <code>{user}</code> parameter to the <code>App\User</code> model, a <code>User</code> instance will be injected into the route. So, for example, a request to <code>profile/1</code> will inject the <code>User</code> instance which has an ID of 1.</p>

<blockquote>
<p><strong>Note:</strong> If a matching model instance is not found in the database, a 404 exception will be thrown automatically.</p>
</blockquote>

<p>If you wish to specify your own &quot;not found&quot; behavior, pass a Closure as the third argument to the <code>model</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to use your own resolution logic, you should use the <code>Route::bind</code> method. The Closure you pass to the <code>bind</code> method will receive the value of the URI segment, and should return an instance of the class you want to be injected into the route:</p>
<div class="highlight"><pre><span></span><span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="form-method-spoofing"></a></p>

<h2>Form Method Spoofing</h2>

<p>HTML forms do not support <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> actions. So, when defining <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> routes that are called from an HTML form, you will need to add a hidden <code>_method</code> field to the form. The value sent with the <code>_method</code> field will be used as the HTTP request method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>To generate the hidden input field <code>_method</code>, you may also use the <code>method_field</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<p>Of course, using the Blade <a href="/docs/%7B%7Bversion%7D%7D/blade">templating engine</a>:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p><a name="throwing-404-errors"></a></p>

<h2>Throwing 404 Errors</h2>

<p>There are two ways to manually trigger a 404 error from a route. First, you may use the <code>abort</code> helper. The <code>abort</code> helper simply throws a <code>Symfony\Component\HttpFoundation\Exception\HttpException</code> with the specified status code:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>Secondly, you may manually throw an instance of <code>Symfony\Component\HttpKernel\Exception\NotFoundHttpException</code>.</p>

<p>More information on handling 404 exceptions and using custom responses for these errors may be found in the <a href="/docs/%7B%7Bversion%7D%7D/errors#http-exceptions">errors</a> section of the documentation.</p>
<div style="page-break-after: always;" ></div><h1>Task Scheduling</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-schedules">Defining Schedules</a>

<ul>
<li><a href="#schedule-frequency-options">Schedule Frequency Options</a></li>
<li><a href="#preventing-task-overlaps">Preventing Task Overlaps</a></li>
</ul></li>
<li><a href="#task-output">Task Output</a></li>
<li><a href="#task-hooks">Task Hooks</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In the past, developers have generated a Cron entry for each task they need to schedule. However, this is a headache. Your task schedule is no longer in source control, and you must SSH into your server to add the Cron entries. The Laravel command scheduler allows you to fluently and expressively define your command schedule within Laravel itself, and only a single Cron entry is needed on your server.</p>

<p>Your task schedule is defined in the <code>app/Console/Kernel.php</code> file&#39;s <code>schedule</code> method. To help you get started, a simple example is included with the method. You are free to add as many scheduled tasks as you wish to the <code>Schedule</code> object.</p>

<h3>Starting The Scheduler</h3>

<p>Here is the only Cron entry you need to add to your server:</p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="nx">php</span> <span class="o">/</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">artisan</span> <span class="nx">schedule</span><span class="o">:</span><span class="nx">run</span> <span class="o">&gt;&gt;</span> <span class="err">/dev/null 2&gt;&amp;1</span>
</pre></div>

<p>This Cron will call the Laravel command scheduler every minute. Then, Laravel evaluates your scheduled tasks and runs the tasks that are due.</p>

<p><a name="defining-schedules"></a></p>

<h2>Defining Schedules</h2>

<p>You may define all of your scheduled tasks in the <code>schedule</code> method of the <code>App\Console\Kernel</code> class. To get started, let&#39;s look at an example of scheduling a task. In this example, we will schedule a <code>Closure</code> to be called every day at midnight. Within the <code>Closure</code> we will execute a database query to clear a table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Console\Scheduling\Schedule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Console\Kernel</span> <span class="k">as</span> <span class="nx">ConsoleKernel</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">ConsoleKernel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The Artisan commands provided by your application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$commands</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">\App\Console\Commands\Inspire</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Define the application&#39;s command schedule.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Console\Scheduling\Schedule  $schedule</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">schedule</span><span class="p">(</span><span class="nx">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;recent_users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
        <span class="p">})</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In addition to scheduling <code>Closure</code> calls, you may also schedule <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan commands</a> and operating system commands. For example, you may use the <code>command</code> method to schedule an Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send --force&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p>The <code>exec</code> command may be used to issue a command to the operating system:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;node /home/forge/script.js&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p><a name="schedule-frequency-options"></a></p>

<h3>Schedule Frequency Options</h3>

<p>Of course, there are a variety of schedules you may assign to your task:</p>

<p>Method  | Description
------------- | -------------
<code>-&gt;cron(&#39;* * * * * *&#39;);</code>  |  Run the task on a custom Cron schedule
<code>-&gt;everyMinute();</code>  |  Run the task every minute
<code>-&gt;everyFiveMinutes();</code>  |  Run the task every five minutes
<code>-&gt;everyTenMinutes();</code>  |  Run the task every ten minutes
<code>-&gt;everyThirtyMinutes();</code>  |  Run the task every thirty minutes
<code>-&gt;hourly();</code>  |  Run the task every hour
<code>-&gt;daily();</code>  |  Run the task every day at midnight
<code>-&gt;dailyAt(&#39;13:00&#39;);</code>  |  Run the task every day at 13:00
<code>-&gt;twiceDaily(1, 13);</code>  |  Run the task daily at 1:00 &amp; 13:00
<code>-&gt;weekly();</code>  |  Run the task every week
<code>-&gt;monthly();</code>  |  Run the task every month
<code>-&gt;yearly();</code>  |  Run the task every year</p>

<p>These methods may be combined with additional constraints to create even more finely tuned schedules that only run on certain days of the week. For example, to schedule a command to run weekly on Monday:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Runs once a week on Monday at 13:00...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">weekly</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">mondays</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;13:00&#39;</span><span class="p">);</span>
</pre></div>

<p>Below is a list of the additional schedule constraints:</p>

<p>Method  | Description
------------- | -------------
<code>-&gt;weekdays();</code>  |  Limit the task to weekdays
<code>-&gt;sundays();</code>  |  Limit the task to Sunday
<code>-&gt;mondays();</code>  |  Limit the task to Monday
<code>-&gt;tuesdays();</code>  |  Limit the task to Tuesday
<code>-&gt;wednesdays();</code>  |  Limit the task to Wednesday
<code>-&gt;thursdays();</code>  |  Limit the task to Thursday
<code>-&gt;fridays();</code>  |  Limit the task to Friday
<code>-&gt;saturdays();</code>  |  Limit the task to Saturday
<code>-&gt;when(Closure);</code>  |  Limit the task based on a truth test</p>

<h4>Truth Test Constraints</h4>

<p>The <code>when</code> method may be used to limit the execution of a task based on the result of a given truth test. In other words, if the given <code>Closure</code> returns <code>true</code>, the task will execute as long as no other constraining conditions prevent the task from running:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>When using chained <code>when</code> methods, the scheduled command will only execute if all <code>when</code> conditions return <code>true</code>.</p>

<p><a name="preventing-task-overlaps"></a></p>

<h3>Preventing Task Overlaps</h3>

<p>By default, scheduled tasks will be run even if the previous instance of the task is still running. To prevent this, you may use the <code>withoutOverlapping</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withoutOverlapping</span><span class="p">();</span>
</pre></div>

<p>In this example, the <code>emails:send</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> will be run every minute if it is not already running. The <code>withoutOverlapping</code> method is especially useful if you have tasks that vary drastically in their execution time, preventing you from predicting exactly how long a given task will take.</p>

<p><a name="task-output"></a></p>

<h2>Task Output</h2>

<p>The Laravel scheduler provides several convenient methods for working with the output generated by scheduled tasks. First, using the <code>sendOutputTo</code> method, you may send the output to a file for later inspection:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">);</span>
</pre></div>

<p>If you would like to append the output to a given file, you may use the <code>appendOutputTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">appendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">);</span>
</pre></div>

<p>Using the <code>emailOutputTo</code> method, you may e-mail the output to an e-mail address of your choice. Note that the output must first be sent to a file using the <code>sendOutputTo</code> method. Also, before e-mailing the output of a task, you should configure Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/mail">e-mail services</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">emailOutputTo</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>emailOutputTo</code> and <code>sendOutputTo</code> methods are exclusive to the <code>command</code> method and are not supported for <code>call</code>.</p>
</blockquote>

<p><a name="task-hooks"></a></p>

<h2>Task Hooks</h2>

<p>Using the <code>before</code> and <code>after</code> methods, you may specify code to be executed before and after the scheduled task is complete:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// Task is about to start...</span>
         <span class="p">})</span>
         <span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// Task is complete...</span>
         <span class="p">});</span>
</pre></div>

<h4>Pinging URLs</h4>

<p>Using the <code>pingBefore</code> and <code>thenPing</code> methods, the scheduler can automatically ping a given URL before or after a task is complete. This method is useful for notifying an external service, such as <a href="https://envoyer.io">Laravel Envoyer</a>, that your scheduled task is commencing or complete:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">pingBefore</span><span class="p">(</span><span class="nx">$url</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">thenPing</span><span class="p">(</span><span class="nx">$url</span><span class="p">);</span>
</pre></div>

<p>Using either the <code>pingBefore($url)</code> or <code>thenPing($url)</code> feature requires the Guzzle HTTP library. You can add Guzzle to your project by adding the following line to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;guzzlehttp/guzzle&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.3|~6.0&quot;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Seeding</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-seeders">Writing Seeders</a>

<ul>
<li><a href="#using-model-factories">Using Model Factories</a></li>
<li><a href="#calling-additional-seeders">Calling Additional Seeders</a></li>
</ul></li>
<li><a href="#running-seeders">Running Seeders</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel includes a simple method of seeding your database with test data using seed classes. All seed classes are stored in <code>database/seeds</code>. Seed classes may have any name you wish, but probably should follow some sensible convention, such as <code>UsersTableSeeder</code>, etc. By default, a <code>DatabaseSeeder</code> class is defined for you. From this class, you may use the <code>call</code> method to run other seed classes, allowing you to control the seeding order.</p>

<p><a name="writing-seeders"></a></p>

<h2>Writing Seeders</h2>

<p>To generate a seeder, you may issue the <code>make:seeder</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>. All seeders generated by the framework will be placed in the <code>database/seeders</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">seeder</span> <span class="nx">UsersTableSeeder</span>
</pre></div>

<p>A seeder class only contains one method by default: <code>run</code>. This method is called when the <code>db:seed</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> is executed. Within the <code>run</code> method, you may insert data into your database however you wish. You may use the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> to manually insert data or you may use <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">Eloquent model factories</a>.</p>

<p>As an example, let&#39;s modify the <code>DatabaseSeeder</code> class which is included with a default installation of Laravel. Let&#39;s add a database insert statement to the <code>run</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the database seeds.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;@gmail.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="using-model-factories"></a></p>

<h3>Using Model Factories</h3>

<p>Of course, manually specifying the attributes for each model seed is cumbersome. Instead, you can use <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">model factories</a> to conveniently generate large amounts of database records. First, review the <a href="/docs/%7B%7Bversion%7D%7D/testing#model-factories">model factory documentation</a> to learn how to define your factories. Once you have defined your factories, you may use the <code>factory</code> helper function to insert records into your database.</p>

<p>For example, let&#39;s create 50 users and attach a relationship to each user:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Run the database seeds.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$u</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$u</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">());</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="calling-additional-seeders"></a></p>

<h3>Calling Additional Seeders</h3>

<p>Within the <code>DatabaseSeeder</code> class, you may use the <code>call</code> method to execute additional seed classes. Using the <code>call</code> method allows you to break up your database seeding into multiple files so that no single seeder class becomes overwhelmingly large. Simply pass the name of the seeder class you wish to run:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Run the database seeds.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Model</span><span class="o">::</span><span class="nx">unguard</span><span class="p">();</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="nx">UsersTableSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="nx">PostsTableSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="nx">CommentsTableSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

    <span class="nx">Model</span><span class="o">::</span><span class="nx">reguard</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="running-seeders"></a></p>

<h2>Running Seeders</h2>

<p>Once you have written your seeder classes, you may use the <code>db:seed</code> Artisan command to seed your database. By default, the <code>db:seed</code> command runs the <code>DatabaseSeeder</code> class, which may be used to call other seed classes. However, you may use the <code>--class</code> option to specify a specific seeder class to run individually:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="kr">class</span><span class="o">=</span><span class="nx">UserTableSeeder</span>
</pre></div>

<p>You may also seed your database using the <code>migrate:refresh</code> command, which will also rollback and re-run all of your migrations. This command is useful for completely re-building your database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Session</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#flash-data">Flash Data</a></li>
</ul></li>
<li><a href="#adding-custom-session-drivers">Adding Custom Session Drivers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Since HTTP driven applications are stateless, sessions provide a way to store information about the user across requests. Laravel ships with a variety of session back-ends available for use through a clean, unified API. Support for popular back-ends such as <a href="http://memcached.org">Memcached</a>, <a href="http://redis.io">Redis</a>, and databases is included out of the box.</p>

<h3>Configuration</h3>

<p>The session configuration file is stored at <code>config/session.php</code>. Be sure to review the well documented options available to you in this file. By default, Laravel is configured to use the <code>file</code> session driver, which will work well for many applications. In production applications, you may consider using the <code>memcached</code> or <code>redis</code> drivers for even faster session performance.</p>

<p>The session <code>driver</code> defines where session data will be stored for each request. Laravel ships with several great drivers out of the box:</p>

<div class="content-list" markdown="1">
- `file` - sessions are stored in `storage/framework/sessions`.
- `cookie` - sessions are stored in secure, encrypted cookies.
- `database` - sessions are stored in a database used by your application.
- `memcached` / `redis` - sessions are stored in one of these fast, cache based stores.
- `array` - sessions are stored in a simple PHP array and will not be persisted across requests.
</div>

<blockquote>
<p><strong>Note:</strong> The array driver is typically used for running <a href="/docs/%7B%7Bversion%7D%7D/testing">tests</a> to prevent session data from persisting.</p>
</blockquote>

<h3>Driver Prerequisites</h3>

<h4>Database</h4>

<p>When using the <code>database</code> session driver, you will need to setup a table to contain the session items. Below is an example <code>Schema</code> declaration for the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;last_activity&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may use the <code>session:table</code> Artisan command to generate this migration for you!</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">session</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">composer</span> <span class="nx">dump</span><span class="o">-</span><span class="nx">autoload</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h4>Redis</h4>

<p>Before using Redis sessions with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<h3>Other Session Considerations</h3>

<p>The Laravel framework uses the <code>flash</code> session key internally, so you should not add an item to the session by that name.</p>

<p>If you need all stored session data to be encrypted, set the <code>encrypt</code> configuration option to <code>true</code>.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Accessing The Session</h4>

<p>First, let&#39;s access the session. We can access the session instance via the HTTP request, which can be type-hinted on a controller method. Remember, controller method dependencies are injected via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When you retrieve a value from the session, you may also pass a default value as the second argument to the <code>get</code> method. This default value will be returned if the specified key does not exist in the session. If you pass a <code>Closure</code> as the default value to the <code>get</code> method, the <code>Closure</code> will be executed and its result returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>If you would like to retrieve all data from the session, you may use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<p>You may also use the global <code>session</code> PHP function to retrieve and store data in the session:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Retrieve a piece of data from the session...</span>
    <span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

    <span class="c1">// Store a piece of data in the session...</span>
    <span class="nx">session</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Determining If An Item Exists In The Session</h4>

<p>The <code>has</code> method may be used to check if an item exists in the session. This method will return <code>true</code> if the item exists:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Storing Data In The Session</h4>

<p>Once you have access to the session instance, you may call a variety of functions to interact with the underlying data. For example, the <code>put</code> method stores a new piece of data in the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h4>Pushing To Array Session Values</h4>

<p>The <code>push</code> method may be used to push a new value onto a session value that is an array. For example, if the <code>user.teams</code> key contains an array of team names, you may push a new value onto the array like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;user.teams&#39;</span><span class="p">,</span> <span class="s1">&#39;developers&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving And Deleting An Item</h4>

<p>The <code>pull</code> method will retrieve and delete an item from the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<h4>Deleting Items From The Session</h4>

<p>The <code>forget</code> method will remove a piece of data from the session. If you would like to remove all data from the session, you may use the <code>flush</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<h4>Regenerating The Session ID</h4>

<p>If you need to regenerate the session ID, you may use the <code>regenerate</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">regenerate</span><span class="p">();</span>
</pre></div>

<p><a name="flash-data"></a></p>

<h3>Flash Data</h3>

<p>Sometimes you may wish to store items in the session only for the next request. You may do so using the <code>flash</code> method. Data stored in the session using this method will only be available during the subsequent HTTP request, and then will be deleted. Flash data is primarily useful for short-lived status messages:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Task was successful!&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to keep your flash data around for even more requests, you may use the <code>reflash</code> method, which will keep all of the flash data around for an additional request. If you only need to keep specific flash data around, you may use the <code>keep</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">reflash</span><span class="p">();</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">keep</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="adding-custom-session-drivers"></a></p>

<h2>Adding Custom Session Drivers</h2>

<p>To add additional drivers to Laravel&#39;s session back-end, you may use the <code>extend</code> method on the <code>Session</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. You can call the <code>extend</code> method from the <code>boot</code> method of a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Session</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Extensions\MongoSessionStore</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SessionServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Session</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return implementation of SessionHandlerInterface...</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">MongoSessionStore</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Note that your custom session driver should implement the <code>SessionHandlerInterface</code>. This interface contains just a few simple methods we need to implement. A stubbed MongoDB implementation looks something like this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Extensions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MongoHandler</span> <span class="k">implements</span> <span class="nx">SessionHandlerInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$savePath</span><span class="p">,</span> <span class="nv">$sessionName</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">gc</span><span class="p">(</span><span class="nv">$lifetime</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>

<p>Since these methods are not as readily understandable as the cache <code>StoreInterface</code>, let&#39;s quickly cover what each of the methods do:</p>

<div class="content-list" markdown="1">
- The `open` method would typically be used in file based session store systems. Since Laravel ships with a `file` session driver, you will almost never need to put anything in this method. You can leave it as an empty stub. It is simply a fact of poor interface design (which we'll discuss later) that PHP requires us to implement this method.
- The `close` method, like the `open` method, can also usually be disregarded. For most drivers, it is not needed.
- The `read` method should return the string version of the session data associated with the given `$sessionId`. There is no need to do any serialization or other encoding when retrieving or storing session data in your driver, as Laravel will perform the serialization for you.
- The `write` method should write the given `$data` string associated with the `$sessionId` to some persistent storage system, such as MongoDB, Dynamo, etc.
- The `destroy` method should remove the data associated with the `$sessionId` from persistent storage.
- The `gc` method should destroy all session data that is older than the given `$lifetime`, which is a UNIX timestamp. For self-expiring systems like Memcached and Redis, this method may be left empty.
</div>

<p>Once the session driver has been registered, you may use the <code>mongo</code> driver in your <code>config/session.php</code> configuration file.</p>
<div style="page-break-after: always;" ></div><h1>Application Structure</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-root-directory">The Root Directory</a></li>
<li><a href="#the-app-directory">The App Directory</a></li>
<li><a href="#namespacing-your-application">Namespacing Your Application</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The default Laravel application structure is intended to provide a great starting point for both large and small applications. Of course, you are free to organize your application however you like. Laravel imposes almost no restrictions on where any given class is located - as long as Composer can autoload the class.</p>

<p><a name="the-root-directory"></a></p>

<h2>The Root Directory</h2>

<p>The root directory of a fresh Laravel installation contains a variety of folders:</p>

<p>The <code>app</code> directory, as you might expect, contains the core code of your application. We&#39;ll explore this folder in more detail soon.</p>

<p>The <code>bootstrap</code> folder contains a few files that bootstrap the framework and configure autoloading, as well as a <code>cache</code> folder that contains a few framework generated files for bootstrap performance optimization.</p>

<p>The <code>config</code> directory, as the name implies, contains all of your application&#39;s configuration files.</p>

<p>The <code>database</code> folder contains your database migration and seeds. If you wish, you may also use this folder to hold an SQLite database.</p>

<p>The <code>public</code> directory contains the front controller and your assets (images, JavaScript, CSS, etc.).</p>

<p>The <code>resources</code> directory contains your views, raw assets (LESS, SASS, CoffeeScript), and localization files.</p>

<p>The <code>storage</code> directory contains compiled Blade templates, file based sessions, file caches, and other files generated by the framework. This folder is segregated into <code>app</code>, <code>framework</code>, and <code>logs</code> directories. The <code>app</code> directory may be used to store any files utilized by your application. The <code>framework</code> directory is used to store framework generated files and caches. Finally, the <code>logs</code> directory contains your application&#39;s log files.</p>

<p>The <code>tests</code> directory contains your automated tests. An example <a href="https://phpunit.de/">PHPUnit</a> is provided out of the box.</p>

<p>The <code>vendor</code> directory contains your <a href="https://getcomposer.org">Composer</a> dependencies.</p>

<p><a name="the-app-directory"></a></p>

<h2>The App Directory</h2>

<p>The &quot;meat&quot; of your application lives in the <code>app</code> directory. By default, this directory is namespaced under <code>App</code> and is autoloaded by Composer using the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 autoloading standard</a>. <strong>You may change this namespace using the <code>app:name</code> Artisan command</strong>.</p>

<p>The <code>app</code> directory ships with a variety of additional directories such as <code>Console</code>, <code>Http</code>, and <code>Providers</code>. Think of the <code>Console</code> and <code>Http</code> directories as providing an API into the &quot;core&quot; of your application. The HTTP protocol and CLI are both mechanisms to interact with your application, but do not actually contain application logic. In other words, they are simply two ways of issuing commands to your application. The <code>Console</code> directory contains all of your Artisan commands, while the <code>Http</code> directory contains your controllers, middleware, and requests.</p>

<p>The <code>Jobs</code> directory, of course, houses the <a href="/docs/%7B%7Bversion%7D%7D/queues">queueable jobs</a> for your application. Jobs may be queued by your application, as well as be run synchronously within the current request lifecycle.</p>

<p>The <code>Events</code> directory, as you might expect, houses <a href="/docs/%7B%7Bversion%7D%7D/events">event classes</a>. Events may be used to alert other parts of your application that a given action has occurred, providing a great deal of flexibility and decoupling.</p>

<p>The <code>Listeners</code> directory contains the handler classes for your events. Handlers receive an event and perform logic in response to the event being fired. For example, a <code>UserRegistered</code> event might be handled by a <code>SendWelcomeEmail</code> listener.</p>

<p>The <code>Exceptions</code> directory contains your application&#39;s exception handler and is also a good place to stick any exceptions thrown by your application.</p>

<blockquote>
<p><strong>Note:</strong> Many of the classes in the <code>app</code> directory can be generated by Artisan via commands. To review the available commands, run the <code>php artisan list make</code> command in your terminal.</p>
</blockquote>

<p><a name="namespacing-your-application"></a></p>

<h2>Namespacing Your Application</h2>

<p>As discussed above, the default application namespace is <code>App</code>; however, you may change this namespace to match the name of your application, which is easily done via the <code>app:name</code> Artisan command. For example, if your application is named &quot;SocialNet&quot;, you would run the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">app</span><span class="o">:</span><span class="nx">name</span> <span class="nx">SocialNet</span>
</pre></div>

<p>Of course, you are free to simply use the <code>App</code> namespace.</p>
<div style="page-break-after: always;" ></div><h1>Testing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#application-testing">Application Testing</a>

<ul>
<li><a href="#interacting-with-your-application">Interacting With Your Application</a></li>
<li><a href="#testing-json-apis">Testing JSON APIs</a></li>
<li><a href="#sessions-and-authentication">Sessions / Authentication</a></li>
<li><a href="#disabling-middleware">Disabling Middleware</a></li>
<li><a href="#custom-http-requests">Custom HTTP Requests</a></li>
<li><a href="#phpunit-assertions">PHPUnit Assertions</a></li>
</ul></li>
<li><a href="#working-with-databases">Working With Databases</a>

<ul>
<li><a href="#resetting-the-database-after-each-test">Resetting The Database After Each Test</a></li>
<li><a href="#model-factories">Model Factories</a></li>
</ul></li>
<li><a href="#mocking">Mocking</a>

<ul>
<li><a href="#mocking-events">Mocking Events</a></li>
<li><a href="#mocking-jobs">Mocking Jobs</a></li>
<li><a href="#mocking-facades">Mocking Facades</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel is built with testing in mind. In fact, support for testing with PHPUnit is included out of the box, and a <code>phpunit.xml</code> file is already setup for your application. The framework also ships with convenient helper methods allowing you to expressively test your applications.</p>

<p>An <code>ExampleTest.php</code> file is provided in the <code>tests</code> directory. After installing a new Laravel application, simply run <code>phpunit</code> on the command line to run your tests.</p>

<h3>Test Environment</h3>

<p>When running tests, Laravel will automatically set the configuration environment to <code>testing</code>. Laravel automatically configures the session and cache to the <code>array</code> driver while testing, meaning no session or cache data will be persisted while testing.</p>

<p>You are free to create other testing environment configurations as necessary. The <code>testing</code> environment variables may be configured in the <code>phpunit.xml</code> file.</p>

<h3>Defining &amp; Running Tests</h3>

<p>To create a new test case, use the <code>make:test</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">test</span> <span class="nx">UserTest</span>
</pre></div>

<p>This command will place a new <code>UserTest</code> class within your <code>tests</code> directory. You may then define test methods as you normally would using PHPUnit. To run your tests, simply execute the <code>phpunit</code> command from your terminal:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseMigrations</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseTransactions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If you define your own <code>setUp</code> method within a test class, be sure to call <code>parent::setUp</code>.</p>
</blockquote>

<p><a name="application-testing"></a></p>

<h2>Application Testing</h2>

<p>Laravel provides a very fluent API for making HTTP requests to your application, examining the output, and even filling out forms. For example, take a look at the <code>ExampleTest.php</code> file included in your <code>tests</code> directory:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseTransactions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Laravel 5&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">dontSee</span><span class="p">(</span><span class="s1">&#39;Rails&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>visit</code> method makes a <code>GET</code> request into the application. The <code>see</code> method asserts that we should see the given text in the response returned by the application. The <code>dontSee</code> method asserts that the given text is not returned in the application response. This is the most basic application test available in Laravel.</p>

<p><a name="interacting-with-your-application"></a></p>

<h3>Interacting With Your Application</h3>

<p>Of course, you can do much more than simply assert that text appears in a given response. Let&#39;s take a look at some examples of clicking links and filling out forms:</p>

<h4>Clicking Links</h4>

<p>In this test, we will make a request to the application, &quot;click&quot; a link in the returned response, and then assert that we landed on a given URI. For example, let&#39;s assume there is a link in our response that has a text value of &quot;About Us&quot;:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/about-us&quot;</span><span class="o">&gt;</span><span class="nx">About</span> <span class="nx">Us</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
</pre></div>

<p>Now, let&#39;s write a test that clicks the link and asserts the user lands on the correct page:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testBasicExample</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">click</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">seePageIs</span><span class="p">(</span><span class="s1">&#39;/about-us&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Working With Forms</h4>

<p>Laravel also provides several methods for testing forms. The <code>type</code>, <code>select</code>, <code>check</code>, <code>attach</code>, and <code>press</code> methods allow you to interact with all of your form&#39;s inputs. For example, let&#39;s imagine this form exists on the application&#39;s registration page:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/register&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">!!</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="o">!!</span><span class="p">}</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="nx">Name</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;terms&quot;</span><span class="o">&gt;</span> <span class="nx">Accept</span> <span class="nx">Terms</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Register&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>We can write a test to complete this form and inspect the result:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testNewUserRegistration</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;terms&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">press</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">seePageIs</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Of course, if your form contains other inputs such as radio buttons or drop-down boxes, you may easily fill out those types of fields as well. Here is a list of each form manipulation method:</p>

<p>Method  | Description
------------- | -------------
<code>$this-&gt;type($text, $elementName)</code>  |  &quot;Type&quot; text into a given field.
<code>$this-&gt;select($value, $elementName)</code>  |  &quot;Select&quot; a radio button or drop-down field.
<code>$this-&gt;check($elementName)</code>  |  &quot;Check&quot; a checkbox field.
<code>$this-&gt;attach($pathToFile, $elementName)</code>  |  &quot;Attach&quot; a file to the form.
<code>$this-&gt;press($buttonTextOrElementName)</code>  |  &quot;Press&quot; a button with the given text or name.</p>

<h4>Working With Attachments</h4>

<p>If your form contains <code>file</code> input types, you may attach files to the form using the <code>attach</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testPhotoCanBeUploaded</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;File Name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$absolutePathToFile</span><span class="p">,</span> <span class="s1">&#39;photo&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">press</span><span class="p">(</span><span class="s1">&#39;Upload&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">see</span><span class="p">(</span><span class="s1">&#39;Upload Successful!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="testing-json-apis"></a></p>

<h3>Testing JSON APIs</h3>

<p>Laravel also provides several helpers for testing JSON APIs and their responses. For example, the <code>get</code>, <code>post</code>, <code>put</code>, <code>patch</code>, and <code>delete</code> methods may be used to issue requests with various HTTP verbs. You may also easily pass data and headers to these methods. To get started, let&#39;s write a test to make a <code>POST</code> request to <code>/user</code> and assert that a given array was returned in JSON format:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">])</span>
             <span class="o">-&gt;</span><span class="na">seeJson</span><span class="p">([</span>
                 <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
             <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>seeJson</code> method converts the given array into JSON, and then verifies that the JSON fragment occurs <strong>anywhere</strong> within the entire JSON response returned by the application. So, if there are other properties in the JSON response, this test will still pass as long as the given fragment is present.</p>

<h4>Verify Exact JSON Match</h4>

<p>If you would like to verify that the given array is an <strong>exact</strong> match for the JSON returned by the application, you should use the <code>seeJsonEquals</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">])</span>
             <span class="o">-&gt;</span><span class="na">seeJsonEquals</span><span class="p">([</span>
                 <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
             <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="sessions-and-authentication"></a></p>

<h3>Sessions / Authentication</h3>

<p>Laravel provides several helpers for working with the session during testing. First, you may set the session data to a given array using the <code>withSession</code> method. This is useful for loading the session with data before testing a request to your application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withSession</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
             <span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Of course, one common use of the session is for maintaining user state, such as the authenticated user. The <code>actingAs</code> helper method provides a simple way to authenticate a given user as the current user. For example, we may use a <a href="#model-factories">model factory</a> to generate and authenticate a user:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App\User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">withSession</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
             <span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Hello, &#39;</span><span class="o">.</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="disabling-middleware"></a></p>

<h3>Disabling Middleware</h3>

<p>When testing your application, you may find it convenient to disable <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> for some of your tests. This will allow you to test your routes and controller in isolation from any middleware concerns. Laravel includes a simple <code>WithoutMiddleware</code> trait that you can use to automatically disable all middleware for the test class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseTransactions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">WithoutMiddleware</span><span class="p">;</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to only disable middleware for a few test methods, you may call the <code>withoutMiddleware</code> method from within the test methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withoutMiddleware</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Laravel 5&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="custom-http-requests"></a></p>

<h3>Custom HTTP Requests</h3>

<p>If you would like to make a custom HTTP request into your application and get the full <code>Illuminate\Http\Response</code> object, you may use the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testApplication</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">status</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>If you are making <code>POST</code>, <code>PUT</code>, or <code>PATCH</code> requests you may pass an array of input data with the request. Of course, this data will be available in your routes and controller via the <a href="/docs/%7B%7Bversion%7D%7D/requests">Request instance</a>:</p>
<div class="highlight"><pre><span></span>   <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="phpunit-assertions"></a></p>

<h3>PHPUnit Assertions</h3>

<p>Laravel provides several additional assertion methods for <a href="https://phpunit.de/">PHPUnit</a> tests:</p>

<p>Method  | Description
------------- | -------------
<code>-&gt;assertResponseOk();</code>  |  Assert that the client response has an OK status code.
<code>-&gt;assertResponseStatus($code);</code>  |  Assert that the client response has a given code.
<code>-&gt;assertViewHas($key, $value = null);</code>  |  Assert that the response view has a given piece of bound data.
<code>-&gt;assertViewHasAll(array $bindings);</code>  |  Assert that the view has a given list of bound data.
<code>-&gt;assertViewMissing($key);</code>  |  Assert that the response view is missing a piece of bound data.
<code>-&gt;assertRedirectedTo($uri, $with = []);</code>  |  Assert whether the client was redirected to a given URI.
<code>-&gt;assertRedirectedToRoute($name, $parameters = [], $with = []);</code>  |  Assert whether the client was redirected to a given route.
<code>-&gt;assertRedirectedToAction($name, $parameters = [], $with = []);</code>  |  Assert whether the client was redirected to a given action.
<code>-&gt;assertSessionHas($key, $value = null);</code>  |  Assert that the session has a given value.
<code>-&gt;assertSessionHasAll(array $bindings);</code>  |  Assert that the session has a given list of values.
<code>-&gt;assertSessionHasErrors($bindings = [], $format = null);</code>  |  Assert that the session has errors bound.
<code>-&gt;assertHasOldInput();</code>  |  Assert that the session has old input.</p>

<p><a name="working-with-databases"></a></p>

<h2>Working With Databases</h2>

<p>Laravel also provides a variety of helpful tools to make it easier to test your database driven applications. First, you may use the <code>seeInDatabase</code> helper to assert that data exists in the database matching a given set of criteria. For example, if we would like to verify that there is a record in the <code>users</code> table with the <code>email</code> value of <code>sally@example.com</code>, we can do the following:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Make call to application...</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">seeInDatabase</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sally@example.com&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Of course, the <code>seeInDatabase</code> method and other helpers like it are for convenience. You are free to use any of PHPUnit&#39;s built-in assertion methods to supplement your tests.</p>

<p><a name="resetting-the-database-after-each-test"></a></p>

<h3>Resetting The Database After Each Test</h3>

<p>It is often useful to reset your database after each test so that data from a previous test does not interfere with subsequent tests.</p>

<h4>Using Migrations</h4>

<p>One option is to rollback the database after each test and migrate it before the next test. Laravel provides a simple <code>DatabaseMigrations</code> trait that will automatically handle this for you. Simply use the trait on your test class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseMigrations</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseTransactions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">DatabaseMigrations</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Laravel 5&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Using Transactions</h4>

<p>Another option is to wrap every test case in a database transaction. Again, Laravel provides a convenient <code>DatabaseTransactions</code> trait that will automatically handle this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseMigrations</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\DatabaseTransactions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">DatabaseTransactions</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Laravel 5&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> This trait will only wrap the default database connection in a transaction.</p>
</blockquote>

<p><a name="model-factories"></a></p>

<h3>Model Factories</h3>

<p>When testing, it is common to need to insert a few records into your database before executing your test. Instead of manually specifying the value of each column when you create this test data, Laravel allows you to define a default set of attributes for each of your <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent models</a> using &quot;factories&quot;. To get started, take a look at the <code>database/factories/ModelFactory.php</code> file in your application. Out of the box, this file contains one factory definition:</p>
<div class="highlight"><pre><span></span><span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">define</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Faker</span><span class="err">\</span><span class="nx">Generator</span> <span class="nx">$faker</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
        <span class="s1">&#39;remember_token&#39;</span> <span class="p">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">});</span>
</pre></div>

<p>Within the Closure, which serves as the factory definition, you may return the default test values of all attributes on the model. The Closure will receive an instance of the <a href="https://github.com/fzaninotto/Faker">Faker</a> PHP library, which allows you to conveniently generate various kinds of random data for testing.</p>

<p>Of course, you are free to add your own additional factories to the <code>ModelFactory.php</code> file.</p>

<h4>Multiple Factory Types</h4>

<p>Sometimes you may wish to have multiple factories for the same Eloquent model class. For example, perhaps you would like to have a factory for &quot;Administrator&quot; users in addition to normal users. You may define these factories using the <code>defineAs</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">defineAs</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$faker</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$faker</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;remember_token&#39;</span> <span class="p">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;admin&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">});</span>
</pre></div>

<p>Instead of duplicating all of the attributes from your base user factory, you may use the <code>raw</code> method to retrieve the base attributes. Once you have the attributes, simply supplement them with any additional values you require:</p>
<div class="highlight"><pre><span></span><span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">defineAs</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$faker</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$factory</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">$factory</span><span class="o">-&gt;</span><span class="nx">raw</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;admin&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Using Factories In Tests</h4>

<p>Once you have defined your factories, you may use them in your tests or database seed files to generate model instances using the global <code>factory</code> function. So, let&#39;s take a look at a few examples of creating models. First, we&#39;ll use the <code>make</code> method, which creates models but does not save them to the database:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>

    <span class="c1">// Use model in tests...</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to override some of the default values of your models, you may pass an array of values to the <code>make</code> method. Only the specified values will be replaced while the rest of the values remain set to their default values as specified by the factory:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span>
   <span class="p">]);</span>
</pre></div>

<p>You may also create a Collection of many models or create models of a given type:</p>
<div class="highlight"><pre><span></span><span class="c1">// Create three App\User instances...</span>
<span class="nx">$users</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>

<span class="c1">// Create an App\User &quot;admin&quot; instance...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>

<span class="c1">// Create three App\User &quot;admin&quot; instances...</span>
<span class="nx">$users</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<h4>Persisting Factory Models</h4>

<p>The <code>create</code> method not only creates the model instances, but also saves them to the database using Eloquent&#39;s <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

    <span class="c1">// Use model in tests...</span>
<span class="p">}</span>
</pre></div>

<p>Again, you may override attributes on the model by passing an array to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span>
   <span class="p">]);</span>
</pre></div>

<h4>Adding Relations To Models</h4>

<p>You may even persist multiple models to the database. In this example, we&#39;ll even attach a relation to the created models. When using the <code>create</code> method to create multiple models, an Eloquent <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">collection instance</a> is returned, allowing you to use any of the convenient functions provided by the collection, such as <code>each</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="nx">create</span><span class="p">()</span>
           <span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$u</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$u</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">factory</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">());</span>
            <span class="p">});</span>
</pre></div>

<p><a name="mocking"></a></p>

<h2>Mocking</h2>

<p><a name="mocking-events"></a></p>

<h3>Mocking Events</h3>

<p>If you are making heavy use of Laravel&#39;s event system, you may wish to silence or mock certain events while testing. For example, if you are testing user registration, you probably do not want all of a <code>UserRegistered</code> event&#39;s handlers firing, since these may send &quot;welcome&quot; e-mails, etc.</p>

<p>Laravel provides a convenient <code>expectsEvents</code> method that verifies the expected events are fired, but prevents any handlers for those events from running:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUserRegistration</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectsEvents</span><span class="p">(</span><span class="nx">App\Events\UserRegistered</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Test user registration code...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to prevent all event handlers from running, you may use the <code>withoutEvents</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUserRegistration</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withoutEvents</span><span class="p">();</span>

        <span class="c1">// Test user registration code...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="mocking-jobs"></a></p>

<h3>Mocking Jobs</h3>

<p>Sometimes, you may wish to simply test that specific jobs are dispatched by your controllers when making requests to your application. This allows you to test your routes / controllers in isolation - set apart from your job&#39;s logic. Of course, you can then test the job itself in a separate test class.</p>

<p>Laravel provides a convenient <code>expectsJobs</code> method that will verify that the expected jobs are dispatched, but the job itself will not be executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPurchasePodcast</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectsJobs</span><span class="p">(</span><span class="nx">App\Jobs\PurchasePodcast</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Test purchase podcast code...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> This method only detects jobs that are dispatched via the <code>DispatchesJobs</code> trait&#39;s dispatch methods. It does not detect jobs that are sent directly to <code>Queue::push</code>.</p>
</blockquote>

<p><a name="mocking-facades"></a></p>

<h3>Mocking Facades</h3>

<p>When testing, you may often want to mock a call to a Laravel <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. For example, consider the following controller action:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all users of the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>We can mock the call to the <code>Cache</code> facade by using the <code>shouldReceive</code> method, which will return an instance of a <a href="https://github.com/padraic/mockery">Mockery</a> mock. Since facades are actually resolved and managed by the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, they have much more testability than a typical static class. For example, let&#39;s mock our call to the <code>Cache</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">shouldReceive</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">once</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">andReturn</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visit</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You should not mock the <code>Request</code> facade. Instead, pass the input you desire into the HTTP helper methods such as <code>call</code> and <code>post</code> when running your test.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Upgrade Guide</h1>

<ul>
<li><a href="#upgrade-5.1.11">Upgrading To 5.1.11</a></li>
<li><a href="#upgrade-5.1.0">Upgrading To 5.1.0</a></li>
<li><a href="#upgrade-5.0.16">Upgrading To 5.0.16</a></li>
<li><a href="#upgrade-5.0">Upgrading To 5.0 From 4.2</a></li>
<li><a href="#upgrade-4.2">Upgrading To 4.2 From 4.1</a></li>
<li><a href="#upgrade-4.1.29">Upgrading To 4.1.29 From &lt;= 4.1.x</a></li>
<li><a href="#upgrade-4.1.26">Upgrading To 4.1.26 From &lt;= 4.1.25</a></li>
<li><a href="#upgrade-4.1">Upgrading To 4.1 From 4.0</a></li>
</ul>

<p><a name="upgrade-5.1.11"></a></p>

<h2>Upgrading To 5.1.11</h2>

<p>Laravel 5.1.11 includes support for <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization</a> and <a href="/docs/%7B%7Bversion%7D%7D/authorization#policies">policies</a>. Incorporating these new features into your existing Laravel 5.1 applications is simple.</p>

<blockquote>
<p><strong>Note:</strong> These upgrades are <strong>optional</strong>, and ignoring them will not affect your application.</p>
</blockquote>

<h4>Create The Policies Directory</h4>

<p>First, create an empty <code>app/Policies</code> directory within your application.</p>

<h4>Create / Register The AuthServiceProvider &amp; Gate Facade</h4>

<p>Create a <code>AuthServiceProvider</code> within your <code>app/Providers</code> directory. You may copy the contents of the default provider <a href="https://raw.githubusercontent.com/laravel/laravel/5.1/app/Providers/AuthServiceProvider.php">from GitHub</a>. Remember to change the provider&#39;s namespace if your application is using a custom namespace. After creating the provider, be sure to register it in your <code>app.php</code> configuration file&#39;s <code>providers</code> array.</p>

<p>Also, you should register the <code>Gate</code> facade in your <code>app.php</code> configuration file&#39;s <code>aliases</code> array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Gate&#39;</span> <span class="p">=&gt;</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Gate</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
</pre></div>

<h4>Update The User Model</h4>

<p>Secondly, use the <code>Illuminate\Foundation\Auth\Access\Authorizable</code> trait and <code>Illuminate\Contracts\Auth\Access\Authorizable</code> contract on your <code>App\User</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Auth\Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Auth\Passwords\CanResetPassword</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\Access\Authorizable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\Authenticatable</span> <span class="k">as</span> <span class="nx">AuthenticatableContract</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\Access\Authorizable</span> <span class="k">as</span> <span class="nx">AuthorizableContract</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\CanResetPassword</span> <span class="k">as</span> <span class="nx">CanResetPasswordContract</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="k">implements</span> <span class="nx">AuthenticatableContract</span><span class="p">,</span>
                                    <span class="nx">AuthorizableContract</span><span class="p">,</span>
                                    <span class="nx">CanResetPasswordContract</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Authenticatable</span><span class="p">,</span> <span class="nx">Authorizable</span><span class="p">,</span> <span class="nx">CanResetPassword</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Update The Base Controller</h4>

<p>Next, update your base <code>App\Http\Controllers\Controller</code> controller to use the <code>Illuminate\Foundation\Auth\Access\AuthorizesRequests</code> trait:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\DispatchesJobs</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span> <span class="k">as</span> <span class="nx">BaseController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Validation\ValidatesRequests</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\Access\AuthorizesRequests</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Controller</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">AuthorizesRequests</span><span class="p">,</span> <span class="nx">DispatchesJobs</span><span class="p">,</span> <span class="nx">ValidatesRequests</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="upgrade-5.1.0"></a></p>

<h2>Upgrading To 5.1.0</h2>

<h4>Estimated Upgrade Time: Less Than 1 Hour</h4>

<h3>Update <code>bootstrap/autoload.php</code></h3>

<p>Update the <code>$compiledPath</code> variable in <code>bootstrap/autoload.php</code> to the following:</p>
<div class="highlight"><pre><span></span><span class="nx">$compiledPath</span> <span class="o">=</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/cache/compiled.php&#39;</span><span class="p">;</span>
</pre></div>

<h3>Create <code>bootstrap/cache</code> Directory</h3>

<p>Within your <code>bootstrap</code> directory, create a <code>cache</code> directory (<code>bootstrap/cache</code>). Place a <code>.gitignore</code> file in this directory with the following contents:</p>
<div class="highlight"><pre><span></span><span class="o">*</span>
<span class="o">!</span><span class="p">.</span><span class="nx">gitignore</span>
</pre></div>

<p>This directory should be writable, and will be used by the framework to store temporary optimization files like <code>compiled.php</code>, <code>routes.php</code>, <code>config.php</code>, and <code>services.json</code>.</p>

<h3>Add <code>BroadcastServiceProvider</code> Provider</h3>

<p>Within your <code>config/app.php</code> configuration file, add <code>Illuminate\Broadcasting\BroadcastServiceProvider</code> to the <code>providers</code> array.</p>

<h3>Authentication</h3>

<p>If you are using the provided <code>AuthController</code> which uses the <code>AuthenticatesAndRegistersUsers</code> trait, you will need to make a few changes to how new users are validated and created.</p>

<p>First, you no longer need to pass the <code>Guard</code> and <code>Registrar</code> instances to the base constructor. You can remove these dependencies entirely from your controller&#39;s constructor.</p>

<p>Secondly, the <code>App\Services\Registrar</code> class used in Laravel 5.0 is no longer needed. You can simply copy and paste your <code>validator</code> and <code>create</code> method from this class directly into your <code>AuthController</code>. No other changes should need to be made to these methods; however, you should be sure to import the <code>Validator</code> facade and your <code>User</code> model at the top of your <code>AuthController</code>.</p>

<h4>Password Controller</h4>

<p>The included <code>PasswordController</code> no longer requires any dependencies in its constructor. You may remove both of the dependencies that were required under 5.0.</p>

<h3>Validation</h3>

<p>If you are overriding the <code>formatValidationErrors</code> method on your base controller class, you should now type-hint the <code>Illuminate\Contracts\Validation\Validator</code> contract instead of the concrete <code>Illuminate\Validation\Validator</code> instance.</p>

<p>Likewise, if you are overriding the <code>formatErrors</code> method on the base form request class, you should now type-hint <code>Illuminate\Contracts\Validation\Validator</code> contract instead of the concrete <code>Illuminate\Validation\Validator</code> instance.</p>

<h3>Eloquent</h3>

<h4>The <code>create</code> Method</h4>

<p>Eloquent&#39;s <code>create</code> method can now be called without any parameters. If you are overriding the <code>create</code> method in your own models, set the default value of the <code>$attributes</code> parameter to an array:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">create</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="p">[])</span>
<span class="p">{</span>
    <span class="c1">// Your custom implementation</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>find</code> Method</h4>

<p>If you are overriding the <code>find</code> method in your own models and calling <code>parent::find()</code> within your custom method, you should now change it to call the <code>find</code> method on the Eloquent query builder:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
<span class="p">{</span>
    <span class="nx">$model</span> <span class="o">=</span> <span class="kr">static</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$columns</span><span class="p">);</span>

    <span class="c1">// ...</span>

    <span class="k">return</span> <span class="nx">$model</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>lists</code> Method</h4>

<p>The <code>lists</code> method now returns a <code>Collection</code> instance instead of a plain array for Eloquent queries. If you would like to convert the <code>Collection</code> into a plain array, use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<p>Be aware that the Query Builder <code>lists</code> method still returns an array.</p>

<h4>Date Formatting</h4>

<p>Previously, the storage format for Eloquent date fields could be modified by overriding the <code>getDateFormat</code> method on your model. This is still possible; however, for convenience you may simply specify a <code>$dateFormat</code> property on the model instead of overriding the method.</p>

<p>The date format is also now applied when serializing a model to an <code>array</code> or JSON. This may change the format of your JSON serialized date fields when migrating from Laravel 5.0 to 5.1. To set a specific date format for serialized models, you may override the <code>serializeDate(DateTime $date)</code> method on your model. This method allows you to have granular control over the formatting of serialized Eloquent date fields without changing their storage format.</p>

<h3>The Collection Class</h3>

<h4>The <code>sort</code> Method</h4>

<p>The <code>sort</code> method now returns a fresh collection instance instead of modifying the existing collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sort</span><span class="p">(</span><span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<h4>The <code>sortBy</code> Method</h4>

<p>The <code>sortBy</code> method now returns a fresh collection instance instead of modifying the existing collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>The <code>groupBy</code> Method</h4>

<p>The <code>groupBy</code> method now returns <code>Collection</code> instances for each item in the parent <code>Collection</code>. If you would like to convert all of the items back to plain arrays, you may <code>map</code> over them:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>The <code>lists</code> Method</h4>

<p>The <code>lists</code> method now returns a <code>Collection</code> instance instead of a plain array. If you would like to convert the <code>Collection</code> into a plain array, use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h3>Commands &amp; Handlers</h3>

<p>The <code>app/Commands</code> directory has been renamed to <code>app/Jobs</code>. However, you are not required to move all of your commands to the new location, and you may continue using the <code>make:command</code> and <code>handler:command</code> Artisan commands to generate your classes.</p>

<p>Likewise, the <code>app/Handlers</code> directory has been renamed to <code>app/Listeners</code> and now only contains event listeners. However, you are not required to move or rename your existing command and event handlers, and you may continue to use the <code>handler:event</code> command to generate event handlers.</p>

<p>By providing backwards compatibility for the Laravel 5.0 folder structure, you may upgrade your applications to Laravel 5.1 and slowly upgrade your events and commands to their new locations when it is convenient for you or your team.</p>

<h3>Blade</h3>

<p>The <code>createMatcher</code>, <code>createOpenMatcher</code>, and <code>createPlainMatcher</code> methods have been removed from the Blade compiler. Use the new <code>directive</code> method to create custom directives for Blade in Laravel 5.1. Consult the <a href="/docs/%7B%7Bversion%7D%7D/blade#extending-blade">extending blade</a> documentation for more information.</p>

<h3>Tests</h3>

<p>Add the protected <code>$baseUrl</code> property to the <code>tests/TestCase.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$baseUrl</span> <span class="o">=</span> <span class="s1">&#39;http://localhost&#39;</span><span class="p">;</span>
</pre></div>

<h3>Translation Files</h3>

<p>The default directory for published language files for vendor packages has been moved. Move any vendor package language files from <code>resources/lang/packages/{locale}/{namespace}</code> to <code>resources/lang/vendor/{namespace}/{locale}</code> directory. For example, <code>Acme/Anvil</code> package&#39;s <code>acme/anvil::foo</code> namespaced English language file would be moved from <code>resources/lang/packages/en/acme/anvil/foo.php</code> to <code>resources/lang/vendor/acme/anvil/en/foo.php</code>.</p>

<h3>Amazon Web Services SDK</h3>

<p>If you are using the AWS SQS queue driver or the AWS SES e-mail driver, you should update your installed AWS PHP SDK to version 3.0.</p>

<p>If you are using the Amazon S3 filesystem driver, you will need to update the corresponding Flysystem package via Composer:</p>

<ul>
<li>Amazon S3: <code>league/flysystem-aws-s3-v3 ~1.0</code></li>
</ul>

<h3>Deprecations</h3>

<p>The following Laravel features have been deprecated and will be removed entirely with the release of Laravel 5.2 in December 2015:</p>

<div class="content-list" markdown="1">
- Route filters have been deprecated in preference of [middleware](/docs/{{version}}/middleware).
- The `Illuminate\Contracts\Routing\Middleware` contract has been deprecated. No contract is required on your middleware. In addition, the `TerminableMiddleware` contract has also been deprecated. Instead of implementing the interface, simply define a `terminate` method on your middleware.
- The `Illuminate\Contracts\Queue\ShouldBeQueued` contract has been deprecated in favor of `Illuminate\Contracts\Queue\ShouldQueue`.
- Iron.io "push queues" have been deprecated in favor of typical Iron.io queues and [queue listeners](/docs/{{version}}/queues#running-the-queue-listener).
- The `Illuminate\Foundation\Bus\DispatchesCommands` trait has been deprecated and renamed to `Illuminate\Foundation\Bus\DispatchesJobs`.
- `Illuminate\Container\BindingResolutionException` has been moved to `Illuminate\Contracts\Container\BindingResolutionException`.
- The service container's `bindShared` method has been deprecated in favor of the `singleton` method.
- The Eloquent and query builder `pluck` method has been deprecated and renamed to `value`.
- The collection `fetch` method has been deprecated in favor of the `pluck` method.
- The `array_fetch` helper has been deprecated in favor of the `array_pluck` method.
</div>

<p><a name="upgrade-5.0.16"></a></p>

<h2>Upgrading To 5.0.16</h2>

<p>In your <code>bootstrap/autoload.php</code> file, update the <code>$compiledPath</code> variable to:</p>
<div class="highlight"><pre><span></span><span class="nx">$compiledPath</span> <span class="o">=</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../vendor/compiled.php&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="upgrade-5.0"></a></p>

<h2>Upgrading To 5.0 From 4.2</h2>

<h3>Fresh Install, Then Migrate</h3>

<p>The recommended method of upgrading is to create a new Laravel <code>5.0</code> install and then to copy your <code>4.2</code> site&#39;s unique application files into the new application. This would include controllers, routes, Eloquent models, Artisan commands, assets, and other code specific files to your application.</p>

<p>To start, <a href="/docs/5.0/installation">install a new Laravel 5.0 application</a> into a fresh directory in your local environment.  Do not install any versions newer than 5.0 yet, since we need to complete the migration steps for 5.0 first. We&#39;ll discuss each piece of the migration process in further detail below.</p>

<h3>Composer Dependencies &amp; Packages</h3>

<p>Don&#39;t forget to copy any additional Composer dependencies into your 5.0 application. This includes third-party code such as SDKs.</p>

<p>Some Laravel-specific packages may not be compatible with Laravel 5 on initial release. Check with your package&#39;s maintainer to determine the proper version of the package for Laravel 5. Once you have added any additional Composer dependencies your application needs, run <code>composer update</code>.</p>

<h3>Namespacing</h3>

<p>By default, Laravel 4 applications did not utilize namespacing within your application code. So, for example, all Eloquent models and controllers simply lived in the &quot;global&quot; namespace. For a quicker migration, you can simply leave these classes in the global namespace in Laravel 5 as well.</p>

<h3>Configuration</h3>

<h4>Migrating Environment Variables</h4>

<p>Copy the new <code>.env.example</code> file to <code>.env</code>, which is the <code>5.0</code> equivalent of the old <code>.env.php</code> file. Set any appropriate values there, like your <code>APP_ENV</code> and <code>APP_KEY</code> (your encryption key), your database credentials, and your cache and session drivers.</p>

<p>Additionally, copy any custom values you had in your old <code>.env.php</code> file and place them in both <code>.env</code> (the real value for your local environment) and <code>.env.example</code> (a sample instructional value for other team members).</p>

<p>For more information on environment configuration, view the <a href="/docs/%7B%7Bversion%7D%7D/installation#environment-configuration">full documentation</a>.</p>

<blockquote>
<p><strong>Note:</strong> You will need to place the appropriate <code>.env</code> file and values on your production server before deploying your Laravel 5 application.</p>
</blockquote>

<h4>Configuration Files</h4>

<p>Laravel 5.0 no longer uses <code>app/config/{environmentName}/</code> directories to provide specific configuration files for a given environment. Instead, move any configuration values that vary by environment into <code>.env</code>, and then access them in your configuration files using <code>env(&#39;key&#39;, &#39;default value&#39;)</code>. You will see examples of this in the <code>config/database.php</code> configuration file.</p>

<p>Set the config files in the <code>config/</code> directory to represent either the values that are consistent across all of your environments, or set them to use <code>env()</code> to load values that vary by environment.</p>

<p>Remember, if you add more keys to <code>.env</code> file, add sample values to the <code>.env.example</code> file as well. This will help your other team members create their own <code>.env</code> files.</p>

<h3>Routes</h3>

<p>Copy and paste your old <code>routes.php</code> file into your new <code>app/Http/routes.php</code>.</p>

<h3>Controllers</h3>

<p>Next, move all of your controllers into the <code>app/Http/Controllers</code> directory. Since we are not going to migrate to full namespacing in this guide, add the <code>app/Http/Controllers</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file. Next, you can remove the namespace from the abstract <code>app/Http/Controllers/Controller.php</code> base class. Verify that your migrated controllers are extending this base class.</p>

<p>In your <code>app/Providers/RouteServiceProvider.php</code> file, set the <code>namespace</code> property to <code>null</code>.</p>

<h3>Route Filters</h3>

<p>Copy your filter bindings from <code>app/filters.php</code> and place them into the <code>boot()</code> method of <code>app/Providers/RouteServiceProvider.php</code>. Add <code>use Illuminate\Support\Facades\Route;</code> in the <code>app/Providers/RouteServiceProvider.php</code> in order to continue using the <code>Route</code> Facade.</p>

<p>You do not need to move over any of the default Laravel 4.0 filters such as <code>auth</code> and <code>csrf</code>; they&#39;re all here, but as middleware. Edit any routes or controllers that reference the old default filters (e.g. <code>[&#39;before&#39; =&gt; &#39;auth&#39;]</code>) and change them to reference the new middleware (e.g. <code>[&#39;middleware&#39; =&gt; &#39;auth&#39;].</code>)</p>

<p>Filters are not removed in Laravel 5. You can still bind and use your own custom filters using <code>before</code> and <code>after</code>.</p>

<h3>Global CSRF</h3>

<p>By default, <a href="/docs/%7B%7Bversion%7D%7D/routing#csrf-protection">CSRF protection</a> is enabled on all routes. If you&#39;d like to disable this, or only manually enable it on certain routes, remove this line from <code>App\Http\Kernel</code>&#39;s <code>middleware</code> array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;App\Http\Middleware\VerifyCsrfToken&#39;</span><span class="p">,</span>
</pre></div>

<p>If you want to use it elsewhere, add this line to <code>$routeMiddleware</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;csrf&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App\Http\Middleware\VerifyCsrfToken&#39;</span><span class="p">,</span>
</pre></div>

<p>Now you can add the middleware to individual routes / controllers using <code>[&#39;middleware&#39; =&gt; &#39;csrf&#39;]</code> on the route. For more information on middleware, consult the <a href="/docs/%7B%7Bversion%7D%7D/middleware">full documentation</a>.</p>

<h3>Eloquent Models</h3>

<p>Feel free to create a new <code>app/Models</code> directory to house your Eloquent models. Again, add this directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>

<p>Update any models using <code>SoftDeletingTrait</code> to use <code>Illuminate\Database\Eloquent\SoftDeletes</code>.</p>

<h4>Eloquent Caching</h4>

<p>Eloquent no longer provides the <code>remember</code> method for caching queries. You now are responsible for caching your queries manually using the <code>Cache::remember</code> function. For more information on caching, consult the <a href="/docs/%7B%7Bversion%7D%7D/cache">full documentation</a>.</p>

<h3>User Authentication Model</h3>

<p>To upgrade your <code>User</code> model for Laravel 5&#39;s authentication system, follow these instructions:</p>

<p><strong>Delete the following from your <code>use</code> block:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">UserInterface</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Reminders</span><span class="err">\</span><span class="nx">RemindableInterface</span><span class="p">;</span>
</pre></div>

<p><strong>Add the following to your <code>use</code> block:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Authenticatable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Passwords</span><span class="err">\</span><span class="nx">CanResetPassword</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Authenticatable</span> <span class="nx">as</span> <span class="nx">AuthenticatableContract</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">CanResetPassword</span> <span class="nx">as</span> <span class="nx">CanResetPasswordContract</span><span class="p">;</span>
</pre></div>

<p><strong>Remove the UserInterface and RemindableInterface interfaces.</strong></p>

<p><strong>Mark the class as implementing the following interfaces:</strong></p>
<div class="highlight"><pre><span></span><span class="kr">implements</span> <span class="nx">AuthenticatableContract</span><span class="p">,</span> <span class="nx">CanResetPasswordContract</span>
</pre></div>

<p><strong>Include the following traits within the class declaration:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Authenticatable</span><span class="p">,</span> <span class="nx">CanResetPassword</span><span class="p">;</span>
</pre></div>

<p><strong>If you used them, remove <code>Illuminate\Auth\Reminders\RemindableTrait</code>  and <code>Illuminate\Auth\UserTrait</code> from your use block and your class declaration.</strong></p>

<h3>Cashier User Changes</h3>

<p>The name of the trait and interface used by <a href="/docs/%7B%7Bversion%7D%7D/billing">Laravel Cashier</a> has changed. Instead of using <code>BillableTrait</code>, use the <code>Laravel\Cashier\Billable</code> trait. And, instead of <code>Laravel\Cashier\BillableInterface</code> implement the <code>Laravel\Cashier\Contracts\Billable</code> interface instead. No other method changes are required.</p>

<h3>Artisan Commands</h3>

<p>Move all of your command classes from your old <code>app/commands</code> directory to the new <code>app/Console/Commands</code> directory. Next, add the <code>app/Console/Commands</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>

<p>Then, copy your list of Artisan commands from <code>start/artisan.php</code> into the <code>command</code> array of the <code>app/Console/Kernel.php</code> file.</p>

<h3>Database Migrations &amp; Seeds</h3>

<p>Delete the two migrations included with Laravel 5.0, since you should already have the users table in your database.</p>

<p>Move all of your migration classes from the old <code>app/database/migrations</code> directory to the new <code>database/migrations</code>. All of your seeds should be moved from <code>app/database/seeds</code> to <code>database/seeds</code>.</p>

<h3>Global IoC Bindings</h3>

<p>If you have any <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> bindings in <code>start/global.php</code>, move them all to the <code>register</code> method of the <code>app/Providers/AppServiceProvider.php</code> file. You may need to import the <code>App</code> facade.</p>

<p>Optionally, you may break these bindings up into separate service providers by category.</p>

<h3>Views</h3>

<p>Move your views from <code>app/views</code> to the new <code>resources/views</code> directory.</p>

<h3>Blade Tag Changes</h3>

<p>For better security by default, Laravel 5.0 escapes all output from both the <code>{{ }}</code> and <code>{{{ }}}</code> Blade directives. A new <code>{!! !!}</code> directive has been introduced to display raw, unescaped output. The most secure option when upgrading your application is to only use the new <code>{!! !!}</code> directive when you are <strong>certain</strong> that it is safe to display raw output.</p>

<p>However, if you <strong>must</strong> use the old Blade syntax, add the following lines at the bottom of <code>AppServiceProvider@register</code>:</p>
<div class="highlight"><pre><span></span><span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setRawTags</span><span class="p">(</span><span class="s1">&#39;{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}&#39;</span><span class="p">);</span>
<span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setContentTags</span><span class="p">(</span><span class="s1">&#39;{{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}}&#39;</span><span class="p">);</span>
<span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setEscapedContentTags</span><span class="p">(</span><span class="s1">&#39;{{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}}&#39;</span><span class="p">);</span>
</pre></div>

<p>This should not be done lightly, and may make your application more vulnerable to XSS exploits. Also, comments with <code>{{--</code> will no longer work.</p>

<h3>Translation Files</h3>

<p>Move your language files from <code>app/lang</code> to the new <code>resources/lang</code> directory.</p>

<h3>Public Directory</h3>

<p>Copy your application&#39;s public assets from your <code>4.2</code> application&#39;s <code>public</code> directory to your new application&#39;s <code>public</code> directory. Be sure to keep the <code>5.0</code> version of <code>index.php</code>.</p>

<h3>Tests</h3>

<p>Move your tests from <code>app/tests</code> to the new <code>tests</code> directory.</p>

<h3>Misc. Files</h3>

<p>Copy in any other files in your project. For example, <code>.scrutinizer.yml</code>, <code>bower.json</code> and other similar tooling configuration files.</p>

<p>You may move your Sass, Less, or CoffeeScript to any location you wish. The <code>resources/assets</code> directory could be a good default location.</p>

<h3>Form &amp; HTML Helpers</h3>

<p>If you&#39;re using Form or HTML helpers, you will see an error stating <code>class &#39;Form&#39; not found</code> or <code>class &#39;Html&#39; not found</code>. The Form and HTML helpers have been deprecated in Laravel 5.0; however, there are community-driven replacements such as those maintained by the <a href="http://laravelcollective.com/docs/%7B%7Bversion%7D%7D/html">Laravel Collective</a>.</p>

<p>For example, you may add <code>&quot;laravelcollective/html&quot;: &quot;~5.0&quot;</code> to your <code>composer.json</code> file&#39;s <code>require</code> section.</p>

<p>You&#39;ll also need to add the Form and HTML facades and service provider. Edit <code>config/app.php</code> and add this line to the &#39;providers&#39; array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Collective\Html\HtmlServiceProvider&#39;</span><span class="p">,</span>
</pre></div>

<p>Next, add these lines to the &#39;aliases&#39; array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Form&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Collective\Html\FormFacade&#39;</span><span class="p">,</span>
<span class="s1">&#39;Html&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Collective\Html\HtmlFacade&#39;</span><span class="p">,</span>
</pre></div>

<h3>CacheManager</h3>

<p>If your application code was injecting <code>Illuminate\Cache\CacheManager</code> to get a non-Facade version of Laravel&#39;s cache, inject <code>Illuminate\Contracts\Cache\Repository</code> instead.</p>

<h3>Pagination</h3>

<p>Replace any calls to <code>$paginator-&gt;links()</code> with <code>$paginator-&gt;render()</code>.</p>

<p>Replace any calls to <code>$paginator-&gt;getFrom()</code> and <code>$paginator-&gt;getTo()</code> with <code>$paginator-&gt;firstItem()</code> and <code>$paginator-&gt;lastItem()</code> respectively.</p>

<p>Remove the &quot;get&quot; prefix from calls to <code>$paginator-&gt;getPerPage()</code>, <code>$paginator-&gt;getCurrentPage()</code>, <code>$paginator-&gt;getLastPage()</code> and <code>$paginator-&gt;getTotal()</code> (e.g. <code>$paginator-&gt;perPage()</code>).</p>

<h3>Beanstalk Queuing</h3>

<p>Laravel 5.0 now requires <code>&quot;pda/pheanstalk&quot;: &quot;~3.0&quot;</code> instead of <code>&quot;pda/pheanstalk&quot;: &quot;~2.1&quot;</code>.</p>

<h3>Remote</h3>

<p>The Remote component has been deprecated.</p>

<h3>Workbench</h3>

<p>The Workbench component has been deprecated.</p>

<p><a name="upgrade-4.2"></a></p>

<h2>Upgrading To 4.2 From 4.1</h2>

<h3>PHP 5.4+</h3>

<p>Laravel 4.2 requires PHP 5.4.0 or greater.</p>

<h3>Encryption Defaults</h3>

<p>Add a new <code>cipher</code> option in your <code>app/config/app.php</code> configuration file. The value of this option should be <code>MCRYPT_RIJNDAEL_256</code>.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;cipher&#39;</span> <span class="p">=&gt;</span> <span class="nx">MCRYPT_RIJNDAEL_256</span>
</pre></div>

<p>This setting may be used to control the default cipher used by the Laravel encryption facilities.</p>

<blockquote>
<p><strong>Note:</strong> In Laravel 4.2, the default cipher is <code>MCRYPT_RIJNDAEL_128</code> (AES), which is considered to be the most secure cipher. Changing the cipher back to <code>MCRYPT_RIJNDAEL_256</code> is required to decrypt cookies/values that were encrypted in Laravel &lt;= 4.1</p>
</blockquote>

<h3>Soft Deleting Models Now Use Traits</h3>

<p>If you are using soft deleting models, the <code>softDeletes</code> property has been removed. You must now use the <code>SoftDeletingTrait</code> like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">SoftDeletingTrait</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You must also manually add the <code>deleted_at</code> column to your <code>dates</code> property:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>The API for all soft delete operations remains the same.</p>

<blockquote>
<p><strong>Note:</strong> The <code>SoftDeletingTrait</code> can not be applied on a base model. It must be used on an actual model class.</p>
</blockquote>

<h3>View / Pagination Environment Renamed</h3>

<p>If you are directly referencing the <code>Illuminate\View\Environment</code> class or <code>Illuminate\Pagination\Environment</code> class, update your code to reference <code>Illuminate\View\Factory</code> and <code>Illuminate\Pagination\Factory</code> instead. These two classes have been renamed to better reflect their function.</p>

<h3>Additional Parameter On Pagination Presenter</h3>

<p>If you are extending the <code>Illuminate\Pagination\Presenter</code> class, the abstract method <code>getPageLinkWrapper</code> signature has changed to add the <code>rel</code> argument:</p>
<div class="highlight"><pre><span></span><span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getPageLinkWrapper</span><span class="p">(</span><span class="nx">$url</span><span class="p">,</span> <span class="nx">$page</span><span class="p">,</span> <span class="nx">$rel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<h3>Iron.Io Queue Encryption</h3>

<p>If you are using the Iron.io queue driver, you will need to add a new <code>encrypt</code> option to your queue configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;encrypt&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span>
</pre></div>

<p><a name="upgrade-4.1.29"></a></p>

<h2>Upgrading To 4.1.29 From &lt;= 4.1.x</h2>

<p>Laravel 4.1.29 improves the column quoting for all database drivers. This protects your application from some mass assignment vulnerabilities when <strong>not</strong> using the <code>fillable</code> property on models. If you are using the <code>fillable</code> property on your models to protect against mass assignment, your application is not vulnerable. However, if you are using <code>guarded</code> and are passing a user controlled array into an &quot;update&quot; or &quot;save&quot; type function, you should upgrade to <code>4.1.29</code> immediately as your application may be at risk of mass assignment.</p>

<p>To upgrade to Laravel 4.1.29, simply <code>composer update</code>. No breaking changes are introduced in this release.</p>

<p><a name="upgrade-4.1.26"></a></p>

<h2>Upgrading To 4.1.26 From &lt;= 4.1.25</h2>

<p>Laravel 4.1.26 introduces security improvements for &quot;remember me&quot; cookies. Before this update, if a remember cookie was hijacked by another malicious user, the cookie would remain valid for a long period of time, even after the true owner of the account reset their password, logged out, etc.</p>

<p>This change requires the addition of a new <code>remember_token</code> column to your <code>users</code> (or equivalent) database table. After this change, a fresh token will be assigned to the user each time they login to your application. The token will also be refreshed when the user logs out of the application. The implications of this change are: if a &quot;remember me&quot; cookie is hijacked, simply logging out of the application will invalidate the cookie.</p>

<h3>Upgrade Path</h3>

<p>First, add a new, nullable <code>remember_token</code> of VARCHAR(100), TEXT, or equivalent to your <code>users</code> table.</p>

<p>Next, if you are using the Eloquent authentication driver, update your <code>User</code> class with the following three methods:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberToken</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">setRememberToken</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span> <span class="o">=</span> <span class="nx">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberTokenName</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;remember_token&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All existing &quot;remember me&quot; sessions will be invalidated by this change, so all users will be forced to re-authenticate with your application.</p>
</blockquote>

<h3>Package Maintainers</h3>

<p>Two new methods were added to the <code>Illuminate\Auth\UserProviderInterface</code> interface. Sample implementations may be found in the default drivers:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByToken</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">updateRememberToken</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
</pre></div>

<p>The <code>Illuminate\Auth\UserInterface</code> also received the three new methods described in the &quot;Upgrade Path&quot;.</p>

<p><a name="upgrade-4.1"></a></p>

<h2>Upgrading To 4.1 From 4.0</h2>

<h3>Upgrading Your Composer Dependency</h3>

<p>To upgrade your application to Laravel 4.1, change your <code>laravel/framework</code> version to <code>4.1.*</code> in your <code>composer.json</code> file.</p>

<h3>Replacing Files</h3>

<p>Replace your <code>public/index.php</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/index.php">this fresh copy from the repository</a>.</p>

<p>Replace your <code>artisan</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/artisan">this fresh copy from the repository</a>.</p>

<h3>Adding Configuration Files &amp; Options</h3>

<p>Update your <code>aliases</code> and <code>providers</code> arrays in your <code>app/config/app.php</code> configuration file. The updated values for these arrays can be found <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/app.php">in this file</a>. Be sure to add your custom and package service providers / aliases back to the arrays.</p>

<p>Add the new <code>app/config/remote.php</code> file <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/remote.php">from the repository</a>.</p>

<p>Add the new <code>expire_on_close</code> configuration option to your <code>app/config/session.php</code> file. The default value should be <code>false</code>.</p>

<p>Add the new <code>failed</code> configuration section to your <code>app/config/queue.php</code> file. Here are the default values for the section:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;failed&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;failed_jobs&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><strong>(Optional)</strong> Update the <code>pagination</code> configuration option in your <code>app/config/view.php</code> file to <code>pagination::slider-3</code>.</p>

<h3>Controller Updates</h3>

<p>If <code>app/controllers/BaseController.php</code> has a <code>use</code> statement at the top, change <code>use Illuminate\Routing\Controllers\Controller;</code> to <code>use Illuminate\Routing\Controller;</code>.</p>

<h3>Password Reminders Updates</h3>

<p>Password reminders have been overhauled for greater flexibility. You may examine the new stub controller by running the <code>php artisan auth:reminders-controller</code> Artisan command. You may also browse the <a href="/docs/4.1/security#password-reminders-and-reset">updated documentation</a> and update your application accordingly.</p>

<p>Update your <code>app/lang/en/reminders.php</code> language file to match <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/lang/en/reminders.php">this updated file</a>.</p>

<h3>Environment Detection Updates</h3>

<p>For security reasons, URL domains may no longer be used to detect your application environment. These values are easily spoofable and allow attackers to modify the environment for a request. You should convert your environment detection to use machine host names (<code>hostname</code> command on Mac, Linux, and Windows).</p>

<h3>Simpler Log Files</h3>

<p>Laravel now generates a single log file: <code>app/storage/logs/laravel.log</code>. However, you may still configure this behavior in your <code>app/start/global.php</code> file.</p>

<h3>Removing Redirect Trailing Slash</h3>

<p>In your <code>bootstrap/start.php</code> file, remove the call to <code>$app-&gt;redirectIfTrailingSlash()</code>. This method is no longer needed as this functionality is now handled by the <code>.htaccess</code> file included with the framework.</p>

<p>Next, replace your Apache <code>.htaccess</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/.htaccess">this new one</a> that handles trailing slashes.</p>

<h3>Current Route Access</h3>

<p>The current route is now accessed via <code>Route::current()</code> instead of <code>Route::getCurrentRoute()</code>.</p>

<h3>Composer Update</h3>

<p>Once you have completed the changes above, you can run the <code>composer update</code> function to update your core application files! If you receive class load errors, try running the <code>update</code> command with the <code>--no-scripts</code> option enabled like so: <code>composer update --no-scripts</code>.</p>

<h3>Wildcard Event Listeners</h3>

<p>The wildcard event listeners no longer append the event to your handler functions parameters. If you require finding the event that was fired you should use <code>Event::firing()</code>.</p>
<div style="page-break-after: always;" ></div><h1>Validation</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#validation-quickstart">Validation Quickstart</a>

<ul>
<li><a href="#quick-defining-the-routes">Defining The Routes</a></li>
<li><a href="#quick-creating-the-controller">Creating The Controller</a></li>
<li><a href="#quick-writing-the-validation-logic">Writing The Validation Logic</a></li>
<li><a href="#quick-displaying-the-validation-errors">Displaying The Validation Errors</a></li>
<li><a href="#quick-ajax-requests-and-validation">AJAX Requests &amp; Validation</a></li>
</ul></li>
<li><a href="#other-validation-approaches">Other Validation Approaches</a>

<ul>
<li><a href="#manually-creating-validators">Manually Creating Validators</a></li>
<li><a href="#form-request-validation">Form Request Validation</a></li>
</ul></li>
<li><a href="#working-with-error-messages">Working With Error Messages</a>

<ul>
<li><a href="#custom-error-messages">Custom Error Messages</a></li>
</ul></li>
<li><a href="#available-validation-rules">Available Validation Rules</a></li>
<li><a href="#conditionally-adding-rules">Conditionally Adding Rules</a></li>
<li><a href="#custom-validation-rules">Custom Validation Rules</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides several different approaches to validate your application&#39;s incoming data. By default, Laravel&#39;s base controller class uses a <code>ValidatesRequests</code> trait which provides a convenient method to validate incoming HTTP request with a variety of powerful validation rules.</p>

<p><a name="validation-quickstart"></a></p>

<h2>Validation Quickstart</h2>

<p>To learn about Laravel&#39;s powerful validation features, let&#39;s look at a complete example of validating a form and displaying the error messages back to the user.</p>

<p><a name="quick-defining-the-routes"></a></p>

<h3>Defining The Routes</h3>

<p>First, let&#39;s assume we have the following routes defined in our <code>app/Http/routes.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="c1">// Display a form to create a blog post...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;post/create&#39;</span><span class="p">,</span> <span class="s1">&#39;PostController@create&#39;</span><span class="p">);</span>

<span class="c1">// Store a new blog post...</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;PostController@store&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, the <code>GET</code> route will display a form for the user to create a new blog post, while the <code>POST</code> route will store the new blog post in the database.</p>

<p><a name="quick-creating-the-controller"></a></p>

<h3>Creating The Controller</h3>

<p>Next, let&#39;s take a look at a simple controller that handles these routes. We&#39;ll leave the <code>store</code> method empty for now:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the form to create a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;post.create&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Store a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validate and store the blog post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="quick-writing-the-validation-logic"></a></p>

<h3>Writing The Validation Logic</h3>

<p>Now we are ready to fill in our <code>store</code> method with the logic to validate the new blog post. If you examine your application&#39;s base controller (<code>App\Http\Controllers\Controller</code>) class, you will see that the class uses a <code>ValidatesRequests</code> trait. This trait provides a convenient <code>validate</code> method in all of your controllers.</p>

<p>The <code>validate</code> method accepts an incoming HTTP request and a set of validation rules. If the validation rules pass, your code will keep executing normally; however, if validation fails, an exception will be thrown and the proper error response will automatically be sent back to the user. In the case of a traditional HTTP request, a redirect response will be generated, while a JSON response will be sent for AJAX requests.</p>

<p>To get a better understanding of the <code>validate</code> method, let&#39;s jump back into the <code>store</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store a new blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// The blog post is valid, store in database...</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, we simply pass the incoming HTTP request and desired validation rules into the <code>validate</code> method. Again, if the validation fails, the proper response will automatically be generated. If the validation passes, our controller will continue executing normally.</p>

<h4>A Note On Nested Attributes</h4>

<p>If your HTTP request contains &quot;nested&quot; parameters, you may specify them in your validation rules using &quot;dot&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;author.name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;author.description&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="quick-displaying-the-validation-errors"></a></p>

<h3>Displaying The Validation Errors</h3>

<p>So, what if the incoming request parameters do not pass the given validation rules? As mentioned previously, Laravel will automatically redirect the user back to their previous location. In addition, all of the validation errors will automatically be <a href="/docs/%7B%7Bversion%7D%7D/session#flash-data">flashed to the session</a>.</p>

<p>Again, notice that we did not have to explicitly bind the error messages to the view in our <code>GET</code> route. This is because Laravel will always check for errors in the session data, and automatically bind them to the view if they are available. <strong>So, it is important to note that an <code>$errors</code> variable will always be available in all of your views on every request</strong>, allowing you to conveniently assume the <code>$errors</code> variable is always defined and can be safely used. The <code>$errors</code> variable will be an instance of <code>Illuminate\Support\MessageBag</code>. For more information on working with this object, <a href="#working-with-error-messages">check out its documentation</a>.</p>

<p>So, in our example, the user will be redirected to our controller&#39;s <code>create</code> method when validation fails, allowing us to display the error messages in the view:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/post/create.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Create</span> <span class="nx">Post</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

<span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>

<span class="c">&lt;!--</span> <span class="nx">Create</span> <span class="nx">Post</span> <span class="nx">Form</span> <span class="o">--&gt;</span>
</pre></div>

<p><a name="quick-customizing-the-flashed-error-format"></a></p>

<h4>Customizing The Flashed Error Format</h4>

<p>If you wish to customize the format of the validation errors that are flashed to the session when validation fails, override the <code>formatValidationErrors</code> on your base controller. Don&#39;t forget to import the <code>Illuminate\Contracts\Validation\Validator</code> class at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\DispatchesJobs</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Validation\Validator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span> <span class="k">as</span> <span class="nx">BaseController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Validation\ValidatesRequests</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Controller</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">DispatchesJobs</span><span class="p">,</span> <span class="nx">ValidatesRequests</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritdoc}</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">formatValidationErrors</span><span class="p">(</span><span class="nx">Validator</span> <span class="nv">$validator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="quick-ajax-requests-and-validation"></a></p>

<h3>AJAX Requests &amp; Validation</h3>

<p>In this example, we used a traditional form to send data to the application. However, many applications use AJAX requests. When using the <code>validate</code> method during an AJAX request, Laravel will not generate a redirect response. Instead, Laravel generates a JSON response containing all of the validation errors. This JSON response will be sent with a 422 HTTP status code.</p>

<p><a name="other-validation-approaches"></a></p>

<h2>Other Validation Approaches</h2>

<p><a name="manually-creating-validators"></a></p>

<h3>Manually Creating Validators</h3>

<p>If you do not want to use the <code>ValidatesRequests</code> trait&#39;s <code>validate</code> method, you may create a validator instance manually using the <code>Validator</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>make</code> method on the facade generates a new validator instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Validator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;post/create&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withErrors</span><span class="p">(</span><span class="nv">$validator</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Store the blog post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>make</code> method is the data under validation. The second argument is the validation rules that should be applied to the data.</p>

<p>After checking if the request failed to pass validation, you may use the <code>withErrors</code> method to flash the error messages to the session. When using this method, the <code>$errors</code> variable will automatically be shared with your views after redirection, allowing you to easily display them back to the user. The <code>withErrors</code> method accepts a validator, a <code>MessageBag</code>, or a PHP <code>array</code>.</p>

<h4>Named Error Bags</h4>

<p>If you have multiple forms on a single page, you may wish to name the <code>MessageBag</code> of errors, allowing you to retrieve the error messages for a specific form. Simply pass a name as the second argument to <code>withErrors</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>You may then access the named <code>MessageBag</code> instance from the <code>$errors</code> variable:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">login</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<h4>After Validation Hook</h4>

<p>The validator also allows you to attach callbacks to be run after validation is completed. This allows you to easily perform further validation and even add more error messages to the message collection. To get started, use the <code>after</code> method on a validator instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(...);</span>

<span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">somethingElseIsInvalid</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;Something is wrong with this field!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="form-request-validation"></a></p>

<h3>Form Request Validation</h3>

<p>For more complex validation scenarios, you may wish to create a &quot;form request&quot;. Form requests are custom request classes that contain validation logic. To create a form request class, use the <code>make:request</code> Artisan CLI command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">request</span> <span class="nx">StoreBlogPostRequest</span>
</pre></div>

<p>The generated class will be placed in the <code>app/Http/Requests</code> directory. Let&#39;s add a few validation rules to the <code>rules</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the validation rules that apply to the request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">rules</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>So, how are the validation rules evaluated? All you need to do is type-hint the request on your controller method. The incoming form request is validated before the controller method is called, meaning you do not need to clutter your controller with any validation logic:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store the incoming blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  StoreBlogPostRequest  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">StoreBlogPostRequest</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// The incoming request is valid...</span>
<span class="p">}</span>
</pre></div>

<p>If validation fails, a redirect response will be generated to send the user back to their previous location. The errors will also be flashed to the session so they are available for display. If the request was an AJAX request, a HTTP response with a 422 status code will be returned to the user including a JSON representation of the validation errors.</p>

<h4>Authorizing Form Requests</h4>

<p>The form request class also contains an <code>authorize</code> method. Within this method, you may check if the authenticated user actually has the authority to update a given resource. For example, if a user is attempting to update a blog post comment, do they actually own that comment? For example:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$commentId</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span>
                  <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">id</span><span class="p">())</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Note the call to the <code>route</code> method in the example above. This method grants you access to the URI parameters defined on the route being called, such as the <code>{comment}</code> parameter in the example below:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;comment/{comment}&#39;</span><span class="p">);</span>
</pre></div>

<p>If the <code>authorize</code> method returns <code>false</code>, a HTTP response with a 403 status code will automatically be returned and your controller method will not execute.</p>

<p>If you plan to have authorization logic in another part of your application, simply return <code>true</code> from the <code>authorize</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Customizing The Flashed Error Format</h4>

<p>If you wish to customize the format of the validation errors that are flashed to the session when validation fails, override the <code>formatErrors</code> on your base request (<code>App\Http\Requests\Request</code>). Don&#39;t forget to import the <code>Illuminate\Contracts\Validation\Validator</code> class at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * {@inheritdoc}</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">formatErrors</span><span class="p">(</span><span class="nx">Validator</span> <span class="nx">$validator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>Customizing The Error Messages</h4>

<p>You may customize the error messages used by the form request by overriding the <code>messages</code> method. This method should return an array of attribute / rule pairs and their corresponding error messages:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the error messages for the defined validation rules.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">messages</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;title.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A title is required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body.required&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;A message is required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="working-with-error-messages"></a></p>

<h2>Working With Error Messages</h2>

<p>After calling the <code>errors</code> method on a <code>Validator</code> instance, you will receive an <code>Illuminate\Support\MessageBag</code> instance, which has a variety of convenient methods for working with error messages.</p>

<h4>Retrieving The First Error Message For A Field</h4>

<p>To retrieve the first error message for a given field, use the <code>first</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Error Messages For A Field</h4>

<p>If you wish to simply retrieve an array of all of the messages for a given field, use the <code>get</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving All Error Messages For All Fields</h4>

<p>To retrieve an array of all messages for all fields, use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If Messages Exist For A Field</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving An Error Message With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;:message&lt;/p&gt;&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Error Messages With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;:message&lt;/li&gt;&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="custom-error-messages"></a></p>

<h3>Custom Error Messages</h3>

<p>If needed, you may use custom error messages for validation instead of the defaults. There are several ways to specify custom messages. First, you may pass the custom messages as the third argument to the <code>Validator::make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute field is required.&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
</pre></div>

<p>In this example, the <code>:attribute</code> place-holder will be replaced by the actual name of the field under validation. You may also utilize other place-holders in validation messages. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;same&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute and :other must match.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be exactly :size.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;between&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be between :min - :max.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;in&#39;</span>      <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be one of the following types: :values&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<h4>Specifying A Custom Message For A Given Attribute</h4>

<p>Sometimes you may wish to specify a custom error messages only for a specific field. You may do so using &quot;dot&quot; notation. Specify the attribute&#39;s name first, followed by the rule:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;email.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="localization"></a></p>

<h4>Specifying Custom Messages In Language Files</h4>

<p>In many cases, you may wish to specify your attribute specific custom messages in a language file instead of passing them directly to the <code>Validator</code>. To do so, add your messages to <code>custom</code> array in the <code>resources/lang/xx/validation.php</code> language file.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="available-validation-rules"></a></p>

<h2>Available Validation Rules</h2>

<p>Below is a list of all available validation rules and their function:</p>

<style>
    .collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    .collection-method-list a {
        display: block;
    }
</style>

<div class="collection-method-list" markdown="1">
[Accepted](#rule-accepted)
[Active URL](#rule-active-url)
[After (Date)](#rule-after)
[Alpha](#rule-alpha)
[Alpha Dash](#rule-alpha-dash)
[Alpha Numeric](#rule-alpha-num)
[Array](#rule-array)
[Before (Date)](#rule-before)
[Between](#rule-between)
[Boolean](#rule-boolean)
[Confirmed](#rule-confirmed)
[Date](#rule-date)
[Date Format](#rule-date-format)
[Different](#rule-different)
[Digits](#rule-digits)
[Digits Between](#rule-digits-between)
[E-Mail](#rule-email)
[Exists (Database)](#rule-exists)
[Image (File)](#rule-image)
[In](#rule-in)
[Integer](#rule-integer)
[IP Address](#rule-ip)
[JSON](#rule-json)
[Max](#rule-max)
[MIME Types (File)](#rule-mimes)
[Min](#rule-min)
[Not In](#rule-not-in)
[Numeric](#rule-numeric)
[Regular Expression](#rule-regex)
[Required](#rule-required)
[Required If](#rule-required-if)
[Required Unless](#rule-required-unless)
[Required With](#rule-required-with)
[Required With All](#rule-required-with-all)
[Required Without](#rule-required-without)
[Required Without All](#rule-required-without-all)
[Same](#rule-same)
[Size](#rule-size)
[String](#rule-string)
[Timezone](#rule-timezone)
[Unique (Database)](#rule-unique)
[URL](#rule-url)
</div>

<p><a name="rule-accepted"></a></p>

<h4>accepted</h4>

<p>The field under validation must be <em>yes</em>, <em>on</em>, <em>1</em>, or <em>true</em>. This is useful for validating &quot;Terms of Service&quot; acceptance.</p>

<p><a name="rule-active-url"></a></p>

<h4>active_url</h4>

<p>The field under validation must be a valid URL according to the <code>checkdnsrr</code> PHP function.</p>

<p><a name="rule-after"></a></p>

<h4>after:<em>date</em></h4>

<p>The field under validation must be a value after a given date. The dates will be passed into the <code>strtotime</code> PHP function:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;start_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|date|after:tomorrow&#39;</span>
</pre></div>

<p>Instead of passing a date string to be evaluated by <code>strtotime</code>, you may specify another field to compare against the date:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;finish_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|date|after:start_date&#39;</span>
</pre></div>

<p><a name="rule-alpha"></a></p>

<h4>alpha</h4>

<p>The field under validation must be entirely alphabetic characters.</p>

<p><a name="rule-alpha-dash"></a></p>

<h4>alpha_dash</h4>

<p>The field under validation may have alpha-numeric characters, as well as dashes and underscores.</p>

<p><a name="rule-alpha-num"></a></p>

<h4>alpha_num</h4>

<p>The field under validation must be entirely alpha-numeric characters.</p>

<p><a name="rule-array"></a></p>

<h4>array</h4>

<p>The field under validation must be a PHP <code>array</code>.</p>

<p><a name="rule-before"></a></p>

<h4>before:<em>date</em></h4>

<p>The field under validation must be a value preceding the given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-between"></a></p>

<h4>between:<em>min</em>,<em>max</em></h4>

<p>The field under validation must have a size between the given <em>min</em> and <em>max</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-boolean"></a></p>

<h4>boolean</h4>

<p>The field under validation must be able to be cast as a boolean. Accepted input are <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code>, <code>&quot;1&quot;</code>, and <code>&quot;0&quot;</code>.</p>

<p><a name="rule-confirmed"></a></p>

<h4>confirmed</h4>

<p>The field under validation must have a matching field of <code>foo_confirmation</code>. For example, if the field under validation is <code>password</code>, a matching <code>password_confirmation</code> field must be present in the input.</p>

<p><a name="rule-date"></a></p>

<h4>date</h4>

<p>The field under validation must be a valid date according to the <code>strtotime</code> PHP function.</p>

<p><a name="rule-date-format"></a></p>

<h4>date<em>format:</em>format_</h4>

<p>The field under validation must match the given <em>format</em>. The format will be evaluated using the PHP <code>date_parse_from_format</code> function. You should use <strong>either</strong> <code>date</code> or <code>date_format</code> when validating a field, not both.</p>

<p><a name="rule-different"></a></p>

<h4>different:<em>field</em></h4>

<p>The field under validation must have a different value than <em>field</em>.</p>

<p><a name="rule-digits"></a></p>

<h4>digits:<em>value</em></h4>

<p>The field under validation must be <em>numeric</em> and must have an exact length of <em>value</em>.</p>

<p><a name="rule-digits-between"></a></p>

<h4>digits<em>between:</em>min<em>,</em>max_</h4>

<p>The field under validation must have a length between the given <em>min</em> and <em>max</em>.</p>

<p><a name="rule-email"></a></p>

<h4>email</h4>

<p>The field under validation must be formatted as an e-mail address.</p>

<p><a name="rule-exists"></a></p>

<h4>exists:<em>table</em>,<em>column</em></h4>

<p>The field under validation must exist on a given database table.</p>

<h4>Basic Usage Of Exists Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states&#39;</span>
</pre></div>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states,abbreviation&#39;</span>
</pre></div>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,account_id,1&#39;</span>
</pre></div>

<p>You may also pass <code>NULL</code> or <code>NOT_NULL</code> to the &quot;where&quot; clause:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,deleted_at,NULL&#39;</span>

<span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,deleted_at,NOT_NULL&#39;</span>
</pre></div>

<p><a name="rule-image"></a></p>

<h4>image</h4>

<p>The file under validation must be an image (jpeg, png, bmp, gif, or svg)</p>

<p><a name="rule-in"></a></p>

<h4>in:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be included in the given list of values.</p>

<p><a name="rule-integer"></a></p>

<h4>integer</h4>

<p>The field under validation must be an integer.</p>

<p><a name="rule-ip"></a></p>

<h4>ip</h4>

<p>The field under validation must be an IP address.</p>

<p><a name="rule-json"></a></p>

<h4>json</h4>

<p>The field under validation must be a valid JSON string.</p>

<p><a name="rule-max"></a></p>

<h4>max:<em>value</em></h4>

<p>The field under validation must be less than or equal to a maximum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-mimes"></a></p>

<h4>mimes:<em>foo</em>,<em>bar</em>,...</h4>

<p>The file under validation must have a MIME type corresponding to one of the listed extensions.</p>

<h4>Basic Usage Of MIME Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;photo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mimes:jpeg,bmp,png&#39;</span>
</pre></div>

<p>Even though you only need to specify the extensions, this rule actually validates against the MIME type of the file by reading the file&#39;s contents and guessing its MIME type.</p>

<p>A full listing of MIME types and their corresponding extensions may be found at the following location: <a href="http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types">http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types</a></p>

<p><a name="rule-min"></a></p>

<h4>min:<em>value</em></h4>

<p>The field under validation must have a minimum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-not-in"></a></p>

<h4>not<em>in:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must not be included in the given list of values.</p>

<p><a name="rule-numeric"></a></p>

<h4>numeric</h4>

<p>The field under validation must be numeric.</p>

<p><a name="rule-regex"></a></p>

<h4>regex:<em>pattern</em></h4>

<p>The field under validation must match the given regular expression.</p>

<p><strong>Note:</strong> When using the <code>regex</code> pattern, it may be necessary to specify rules in an array instead of using pipe delimiters, especially if the regular expression contains a pipe character.</p>

<p><a name="rule-required"></a></p>

<h4>required</h4>

<p>The field under validation must be present in the input data and not empty. A field is considered &quot;empty&quot; is one of the following conditions are true:</p>

<ul>
<li>The value is <code>null</code>.</li>
<li>The value is an empty string.</li>
<li>The value is an empty array or empty <code>Countable</code> object.</li>
<li>The value is an uploaded file with no path.</li>
</ul>

<p><a name="rule-required-if"></a></p>

<h4>required<em>if:</em>anotherfield<em>,</em>value_,...</h4>

<p>The field under validation must be present if the <em>anotherfield</em> field is equal to any <em>value</em>.</p>

<p><a name="rule-required-unless"></a></p>

<h4>required<em>unless:</em>anotherfield<em>,</em>value_,...</h4>

<p>The field under validation must be present unless the <em>anotherfield</em> field is equal to any <em>value</em>.</p>

<p><a name="rule-required-with"></a></p>

<h4>required<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only if</em> any of the other specified fields are present.</p>

<p><a name="rule-required-with-all"></a></p>

<h4>required<em>with</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only if</em> all of the other specified fields are present.</p>

<p><a name="rule-required-without"></a></p>

<h4>required<em>without:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only when</em> any of the other specified fields are not present.</p>

<p><a name="rule-required-without-all"></a></p>

<h4>required<em>without</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only when</em> all of the other specified fields are not present.</p>

<p><a name="rule-same"></a></p>

<h4>same:<em>field</em></h4>

<p>The given <em>field</em> must match the field under validation.</p>

<p><a name="rule-size"></a></p>

<h4>size:<em>value</em></h4>

<p>The field under validation must have a size matching the given <em>value</em>. For string data, <em>value</em> corresponds to the number of characters. For numeric data, <em>value</em> corresponds to a given integer value. For files, <em>size</em> corresponds to the file size in kilobytes.</p>

<p><a name="rule-string"></a></p>

<h4>string</h4>

<p>The field under validation must be a string.</p>

<p><a name="rule-timezone"></a></p>

<h4>timezone</h4>

<p>The field under validation must be a valid timezone identifier according to the <code>timezone_identifiers_list</code> PHP function.</p>

<p><a name="rule-unique"></a></p>

<h4>unique:<em>table</em>,<em>column</em>,<em>except</em>,<em>idColumn</em></h4>

<p>The field under validation must be unique on a given database table. If the <code>column</code> option is not specified, the field name will be used.</p>

<p><strong>Specifying A Custom Column Name:</strong></p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address&#39;</span>
</pre></div>

<p><strong>Custom Database Connection</strong></p>

<p>Occasionally, you may need to set a custom connection for database queries made by the Validator. As seen above, setting <code>unique:users</code> as a validation rule will use the default database connection to query the database. To override this, specify the connection followed by the table name using &quot;dot&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:connection.users,email_address&#39;</span>
</pre></div>

<p><strong>Forcing A Unique Rule To Ignore A Given ID:</strong></p>

<p>Sometimes, you may wish to ignore a given ID during the unique check. For example, consider an &quot;update profile&quot; screen that includes the user&#39;s name, e-mail address, and location. Of course, you will want to verify that the e-mail address is unique. However, if the user only changes the name field and not the e-mail field, you do not want a validation error to be thrown because the user is already the owner of the e-mail address. You only want to throw a validation error if the user provides an e-mail address that is already used by a different user. To tell the unique rule to ignore the user&#39;s ID, you may pass the ID as the third parameter:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,&#39;</span><span class="p">.</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span>
</pre></div>

<p>If your table uses a primary key column name other than <code>id</code>, you may specify it as the fourth parameter:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,&#39;</span><span class="p">.</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">.</span><span class="s1">&#39;,user_id&#39;</span>
</pre></div>

<p><strong>Adding Additional Where Clauses:</strong></p>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,NULL,id,account_id,1&#39;</span>
</pre></div>

<p>In the rule above, only rows with an <code>account_id</code> of <code>1</code> would be included in the unique check.</p>

<p><a name="rule-url"></a></p>

<h4>url</h4>

<p>The field under validation must be a valid URL according to PHP&#39;s <code>filter_var</code> function.</p>

<p><a name="conditionally-adding-rules"></a></p>

<h2>Conditionally Adding Rules</h2>

<p>In some situations, you may wish to run validation checks against a field <strong>only</strong> if that field is present in the input array. To quickly accomplish this, add the <code>sometimes</code> rule to your rule list:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sometimes|required|email&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>In the example above, the <code>email</code> field will only be validated if it is present in the <code>$data</code> array.</p>

<h4>Complex Conditional Validation</h4>

<p>Sometimes you may wish to add validation rules based on more complex conditional logic. For example, you may wish to require a given field only if another field has a greater value than 100. Or, you may need two fields to have a given value only when another field is present. Adding these validation rules doesn&#39;t have to be a pain. First, create a <code>Validator</code> instance with your <em>static rules</em> that never change:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;games&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|numeric&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Let&#39;s assume our web application is for game collectors. If a game collector registers with our application and they own more than 100 games, we want them to explain why they own so many games. For example, perhaps they run a game re-sell shop, or maybe they just enjoy collecting. To conditionally add this requirement, we can use the <code>sometimes</code> method on the <code>Validator</code> instance.</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;required|max:500&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>sometimes</code> method is the name of the field we are conditionally validating. The second argument is the rules we want to add. If the <code>Closure</code> passed as the third argument returns <code>true</code>, the rules will be added. This method makes it a breeze to build complex conditional validations. You may even add conditional validations for several fields at once:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">([</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;cost&#39;</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>$input</code> parameter passed to your <code>Closure</code> will be an instance of <code>Illuminate\Support\Fluent</code> and may be used to access your input and files.</p>
</blockquote>

<p><a name="custom-validation-rules"></a></p>

<h2>Custom Validation Rules</h2>

<p>Laravel provides a variety of helpful validation rules; however, you may wish to specify some of your own. One method of registering custom validation rules is using the <code>extend</code> method on the <code>Validator</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. Let&#39;s use this method within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> to register a custom validation rule:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Validator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Validator</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$validator</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The custom validator Closure receives four arguments: the name of the <code>$attribute</code> being validated, the <code>$value</code> of the attribute, an array of <code>$parameters</code> passed to the rule, and the <code>Validator</code> instance.</p>

<p>You may also pass a class and method to the <code>extend</code> method instead of a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooValidator@validate&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Error Message</h4>

<p>You will also need to define an error message for your custom rule. You can do so either using an inline custom message array or by adding an entry in the validation language file. This message should be placed in the first level of the array, not within the <code>custom</code> array, which is only for attribute-specific error messages:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;foo&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;Your input was invalid!&quot;</span><span class="p">,</span>

<span class="s2">&quot;accepted&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;The :attribute must be accepted.&quot;</span><span class="p">,</span>

<span class="c1">// The rest of the validation error messages...</span>
</pre></div>

<p>When creating a custom validation rule, you may sometimes need to define custom place-holder replacements for error messages. You may do so by creating a custom Validator as described above then making a call to the <code>replacer</code> method on the <code>Validator</code> facade. You may do this within the <code>boot</code> method of a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(...);</span>

    <span class="nx">Validator</span><span class="o">::</span><span class="nx">replacer</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(...);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h4>Implicit Extensions</h4>

<p>By default, when an attribute being validated is not present or contains an empty value as defined by the <a href="#rule-required"><code>required</code></a> rule, normal validation rules, including custom extensions, are not run. For example, the <a href="#rule-integer"><code>integer</code></a> rule will not be run against a <code>null</code> value:</p>
<div class="highlight"><pre><span></span><span class="nx">$rules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">];</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">];</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">passes</span><span class="p">();</span> <span class="c1">// true</span>
</pre></div>

<p>For a rule to run even when an attribute is empty, the rule must imply that the attribute is required. To create such an &quot;implicit&quot; extension, use the <code>Validator::extendImplicit()</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extendImplicit</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">,</span> <span class="nx">$validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> An &quot;implicit&quot; extension only <em>implies</em> that the attribute is required. Whether it actually invalidates a missing or empty attribute is up to you.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Views</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#passing-data-to-views">Passing Data To Views</a></li>
<li><a href="#sharing-data-with-all-views">Sharing Data With All Views</a></li>
</ul></li>
<li><a href="#view-composers">View Composers</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>Views contain the HTML served by your application and separate your controller / application logic from your presentation logic. Views are stored in the <code>resources/views</code> directory.</p>

<p>A simple view might look something like this:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">View</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$name</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>Since this view is stored at <code>resources/views/greeting.php</code>, we may return it using the global <code>view</code> helper function like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span>    <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;James&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the first argument passed to the <code>view</code> helper corresponds to the name of the view file in the <code>resources/views</code> directory. The second argument passed to helper is an array of data that should be made available to the view. In this case, we are passing the <code>name</code> variable, which is displayed in the view by simply executing <code>echo</code> on the variable.</p>

<p>Of course, views may also be nested within sub-directories of the <code>resources/views</code> directory. &quot;Dot&quot; notation may be used to reference nested views. For example, if your view is stored at <code>resources/views/admin/profile.php</code>, you may reference it like so:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;admin.profile&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<h4>Determining If A View Exists</h4>

<p>If you need to determine if a view exists, you may use the <code>exists</code> method after calling the <code>view</code> helper with no arguments. This method will return <code>true</code> if the view exists on disk:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;emails.customer&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>When the <code>view</code> helper is called without arguments, an instance of <code>Illuminate\Contracts\View\Factory</code> is returned, giving you access to any of the factory&#39;s methods.</p>

<p><a name="view-data"></a></p>

<h3>View Data</h3>

<p><a name="passing-data-to-views"></a></p>

<h4>Passing Data To Views</h4>

<p>As you saw in the previous examples, you may easily pass an array of data to views:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greetings&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">]);</span>
</pre></div>

<p>When passing information in this manner, <code>$data</code> should be an array with key/value pairs. Inside your view, you can then access each value using its corresponding key, such as <code>&lt;?php echo $key; ?&gt;</code>. As an alternative to passing a complete array of data to the <code>view</code> helper function, you may use the <code>with</code> method to add individual pieces of data to the view:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="sharing-data-with-all-views"></a></p>

<h4>Sharing Data With All Views</h4>

<p>Occasionally, you may need to share a piece of data with all views that are rendered by your application. You may do so using the view factory&#39;s <code>share</code> method. Typically, you would place calls to <code>share</code> within a service provider&#39;s <code>boot</code> method. You are free to add them to the <code>AppServiceProvider</code> or generate a separate service provider to house them:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">share</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="view-composers"></a></p>

<h2>View Composers</h2>

<p>View composers are callbacks or class methods that are called when a view is rendered. If you have data that you want to be bound to a view each time that view is rendered, a view composer can help you organize that logic into a single location.</p>

<p>Let&#39;s register our view composers within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. We&#39;ll use the <code>view</code> helper to access the underlying <code>Illuminate\Contracts\View\Factory</code> contract implementation. Remember, Laravel does not include a default directory for view composers. You are free to organize them however you wish. For example, you could create an <code>App\Http\ViewComposers</code> directory:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ComposerServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Using class based composers...</span>
        <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">composer</span><span class="p">(</span>
            <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\ViewComposers\ProfileComposer&#39;</span>
        <span class="p">);</span>

        <span class="c1">// Using Closure based composers...</span>
        <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Remember, if you create a new service provider to contain your view composer registrations, you will need to add the service provider to the <code>providers</code> array in the <code>config/app.php</code> configuration file.</p>

<p>Now that we have registered the composer, the <code>ProfileComposer@compose</code> method will be executed each time the <code>profile</code> view is being rendered. So, let&#39;s define the composer class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\ViewComposers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\View\View</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Users\Repository</span> <span class="k">as</span> <span class="nx">UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileComposer</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository implementation.</span>
<span class="sd">     *</span>
<span class="sd">     * @var UserRepository</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new profile composer.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Dependencies automatically resolved by service container...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bind data to the view.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  View  $view</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compose</span><span class="p">(</span><span class="nx">View</span> <span class="nv">$view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Just before the view is rendered, the composer&#39;s <code>compose</code> method is called with the <code>Illuminate\Contracts\View\View</code> instance. You may use the <code>with</code> method to bind data to the view.</p>

<blockquote>
<p><strong>Note:</strong> All view composers are resolved via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so you may type-hint any dependencies you need within a composer&#39;s constructor.</p>
</blockquote>

<h4>Attaching A Composer To Multiple Views</h4>

<p>You may attach a view composer to multiple views at once by passing an array of views as the first argument to the <code>composer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">composer</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;dashboard&#39;</span><span class="p">],</span>
    <span class="s1">&#39;App\Http\ViewComposers\MyViewComposer&#39;</span>
<span class="p">);</span>
</pre></div>

<p>The <code>composer</code> method accepts the <code>*</code> character as a wildcard, allowing you to attach a composer to all views:</p>
<div class="highlight"><pre><span></span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$view</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h3>View Creators</h3>

<p>View <strong>creators</strong> are very similar to view composers; however, they are fired immediately when the view is instantiated instead of waiting until the view is about to render. To register a view creator, use the <code>creator</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">creator</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\ViewCreators\ProfileCreator&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div></div></body></html>