<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="resources/code.css"><link rel="stylesheet" href="resources/tailwind.css"></head><body><div class="prose prose-xl mx-auto my-10"><h1>Artisan CLI</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#calling-commands-outside-of-cli">Calling Commands Outside Of CLI</a></li>
<li><a href="#scheduling-artisan-commands">Scheduling Artisan Commands</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Artisan is the name of the command-line interface included with Laravel. It provides a number of helpful commands for your use while developing your application. It is driven by the powerful Symfony Console component.</p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<h4>Listing All Available Commands</h4>

<p>To view a list of all available Artisan commands, you may use the <code>list</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">list</span>
</pre></div>

<h4>Viewing The Help Screen For A Command</h4>

<p>Every command also includes a &quot;help&quot; screen which displays and describes the command&#39;s available arguments and options. To view a help screen, simply precede the name of the command with <code>help</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">help</span> <span class="nx">migrate</span>
</pre></div>

<h4>Specifying The Configuration Environment</h4>

<p>You may specify the configuration environment that should be used while running a command using the <code>--env</code> switch:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">env</span><span class="o">=</span><span class="nx">local</span>
</pre></div>

<h4>Displaying Your Current Laravel Version</h4>

<p>You may also view the current version of your Laravel installation using the <code>--version</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="o">--</span><span class="nx">version</span>
</pre></div>

<p><a name="calling-commands-outside-of-cli"></a></p>

<h2>Calling Commands Outside Of CLI</h2>

<p>Sometimes you may wish to execute an Artisan command outside of the CLI. For example, you may wish to fire an Artisan command from an HTTP route. Just use the <code>Artisan</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;command:name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--option&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may even queue Artisan commands so they are processed in the background by your <a href="/docs/%7B%7Bversion%7D%7D/queues">queue workers</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Artisan</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;command:name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--option&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="scheduling-artisan-commands"></a></p>

<h2>Scheduling Artisan Commands</h2>

<p>In the past, developers have generated a Cron entry for each console command they wished to schedule. However, this is a headache. Your console schedule is no longer in source control, and you must SSH into your server to add the Cron entries. Let&#39;s make our lives easier. The Laravel command scheduler allows you to fluently and expressively define your command schedule within Laravel itself, and only a single Cron entry is needed on your server.</p>

<p>Your command schedule is stored in the <code>app/Console/Kernel.php</code> file. Within this class you will see a <code>schedule</code> method. To help you get started, a simple example is included with the method. You are free to add as many scheduled jobs as you wish to the <code>Schedule</code> object. The only Cron entry you need to add to your server is this:</p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="nx">php</span> <span class="o">/</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">artisan</span> <span class="nx">schedule</span><span class="o">:</span><span class="nx">run</span> <span class="mi">1</span><span class="o">&gt;&gt;</span> <span class="err">/dev/null 2&gt;&amp;1</span>
</pre></div>

<p>This Cron will call the Laravel command scheduler every minute. Then, Laravel evaluates your scheduled jobs and runs the jobs that are due. It couldn&#39;t be easier!</p>

<h3>More Scheduling Examples</h3>

<p>Let&#39;s look at a few more scheduling examples:</p>

<h4>Scheduling Closures</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Do some task...</span>

<span class="p">})</span><span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">();</span>
</pre></div>

<h4>Scheduling Terminal Commands</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;composer self-update&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<h4>Manual Cron Expression</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cron</span><span class="p">(</span><span class="s1">&#39;* * * * *&#39;</span><span class="p">);</span>
</pre></div>

<h4>Frequent Jobs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">everyFiveMinutes</span><span class="p">();</span>

<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">everyTenMinutes</span><span class="p">();</span>

<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">everyThirtyMinutes</span><span class="p">();</span>
</pre></div>

<h4>Daily Jobs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<h4>Daily Jobs At A Specific Time (24 Hour Time)</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dailyAt</span><span class="p">(</span><span class="s1">&#39;15:00&#39;</span><span class="p">);</span>
</pre></div>

<h4>Twice Daily Jobs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">twiceDaily</span><span class="p">();</span>
</pre></div>

<h4>Job That Runs Every Weekday</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">weekdays</span><span class="p">();</span>
</pre></div>

<h4>Weekly Jobs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">weekly</span><span class="p">();</span>

<span class="c1">// Schedule weekly job for specific day (0-6) and time...</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">weeklyOn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;8:00&#39;</span><span class="p">);</span>
</pre></div>

<h4>Monthly Jobs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">monthly</span><span class="p">();</span>
</pre></div>

<h4>Job That Runs On Specific Days</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">mondays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">tuesdays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">wednesdays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">thursdays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">fridays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">saturdays</span><span class="p">();</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sundays</span><span class="p">();</span>
</pre></div>

<h4>Prevent Jobs From Overlapping</h4>

<p>By default, scheduled jobs will be run even if the previous instance of the job is still running. To prevent this, you may use the <code>withoutOverlapping</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withoutOverlapping</span><span class="p">();</span>
</pre></div>

<p>In this example, the <code>foo</code> command will be run every minute if it is not already running.</p>

<h4>Limit The Environment The Jobs Should Run In</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">monthly</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">environments</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">);</span>
</pre></div>

<h4>Indicate The Job Should Run Even When Application Is In Maintenance Mode</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">monthly</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">evenInMaintenanceMode</span><span class="p">();</span>
</pre></div>

<h4>Only Allow Job To Run When Callback Is True</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">monthly</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>E-mail The Output Of A Scheduled Job</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">emailOutputTo</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You must send the output to a file before it can be mailed.</p>
</blockquote>

<h4>Send The Output Of The Scheduled Job To A Given Location</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">);</span>
</pre></div>

<h4>Ping A Given URL After The Job Runs</h4>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">thenPing</span><span class="p">(</span><span class="nx">$url</span><span class="p">);</span>
</pre></div>

<p>Using the <code>thenPing($url)</code> feature requires the Guzzle HTTP library. You can add Guzzle 5 to your project by adding the following line to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;guzzlehttp/guzzle&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.0&quot;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Authentication</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#authenticating-users">Authenticating Users</a></li>
<li><a href="#retrieving-the-authenticated-user">Retrieving The Authenticated User</a></li>
<li><a href="#protecting-routes">Protecting Routes</a></li>
<li><a href="#http-basic-authentication">HTTP Basic Authentication</a></li>
<li><a href="#password-reminders-and-reset">Password Reminders &amp; Reset</a></li>
<li><a href="#social-authentication">Social Authentication</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel makes implementing authentication very simple. In fact, almost everything is configured for you out of the box. The authentication configuration file is located at <code>config/auth.php</code>, which contains several well documented options for tweaking the behavior of the authentication services.</p>

<p>By default, Laravel includes an <code>App\User</code> model in your <code>app</code> directory. This model may be used with the default Eloquent authentication driver.</p>

<p>Remember: when building the database schema for this model, make the password column at least 60 characters. Also, before getting started, make sure that your <code>users</code> (or equivalent) table contains a nullable, string <code>remember_token</code> column of 100 characters. This column will be used to store a token for &quot;remember me&quot; sessions being maintained by your application. This can be done by using <code>$table-&gt;rememberToken();</code> in a migration. Of course, Laravel 5 ships migrations for these columns out of the box!</p>

<p>If your application is not using Eloquent, you may use the <code>database</code> authentication driver which uses the Laravel query builder.</p>

<p><a name="authenticating-users"></a></p>

<h2>Authenticating Users</h2>

<p>Laravel ships with two authentication related controllers out of the box. The <code>AuthController</code> handles new user registration and &quot;logging in&quot;, while the <code>PasswordController</code> contains the logic to help existing users reset their forgotten passwords.</p>

<p>Each of these controllers uses a trait to include their necessary methods. For many applications, you will not need to modify these controllers at all. The views that these controllers render are located in the <code>resources/views/auth</code> directory. You are free to customize these views however you wish.</p>

<h3>The User Registrar</h3>

<p>To modify the form fields that are required when a new user registers with your application, you may modify the <code>App\Services\Registrar</code> class. This class is responsible for validating and creating new users of your application.</p>

<p>The <code>validator</code> method of the <code>Registrar</code> contains the validation rules for new users of the application, while the <code>create</code> method of the <code>Registrar</code> is responsible for creating new <code>User</code> records in your database. You are free to modify each of these methods as you wish. The <code>Registrar</code> is called by the <code>AuthController</code> via the methods contained in the <code>AuthenticatesAndRegistersUsers</code> trait.</p>

<h4>Manual Authentication</h4>

<p>If you choose not to use the provided <code>AuthController</code> implementation, you will need to manage the authentication of your users using the Laravel authentication classes directly. Don&#39;t worry, it&#39;s still a cinch! First, let&#39;s check out the <code>attempt</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle an authentication attempt.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nv">$password</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">intended</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>attempt</code> method accepts an array of key / value pairs as its first argument. The <code>password</code> value will be <a href="/docs/%7B%7Bversion%7D%7D/hashing">hashed</a>. The other values in the array will be used to find the user in your database table. So, in the example above, the user will be retrieved by the value of the <code>email</code> column. If the user is found, the hashed password stored in the database will be compared with the hashed <code>password</code> value passed to the method via the array. If the two hashed passwords match, a new authenticated session will be started for the user.</p>

<p>The <code>attempt</code> method will return <code>true</code> if authentication was successful. Otherwise, <code>false</code> will be returned.</p>

<blockquote>
<p><strong>Note:</strong> In this example, <code>email</code> is not a required option, it is merely used as an example. You should use whatever column name corresponds to a &quot;username&quot; in your database.</p>
</blockquote>

<p>The <code>intended</code> redirect function will redirect the user to the URL they were attempting to access before being caught by the authentication filter. A fallback URI may be given to this method in case the intended destination is not available.</p>

<h4>Authenticating A User With Conditions</h4>

<p>You also may add extra conditions to the authentication query:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]))</span>
<span class="p">{</span>
    <span class="c1">// The user is active, not suspended, and exists.</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If A User Is Authenticated</h4>

<p>To determine if the user is already logged into your application, you may use the <code>check</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// The user is logged in...</span>
<span class="p">}</span>
</pre></div>

<h4>Authenticating A User And &quot;Remembering&quot; Them</h4>

<p>If you would like to provide &quot;remember me&quot; functionality in your application, you may pass a boolean value as the second argument to the <code>attempt</code> method, which will keep the user authenticated indefinitely, or until they manually logout. Of course, your <code>users</code> table must include the string <code>remember_token</code> column, which will be used to store the &quot;remember me&quot; token.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">],</span> <span class="nx">$remember</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The user is being remembered...</span>
<span class="p">}</span>
</pre></div>

<p>If you are &quot;remembering&quot; users, you may use the <code>viaRemember</code> method to determine if the user was authenticated using the &quot;remember me&quot; cookie:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">viaRemember</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Authenticating Users By ID</h4>

<p>To log a user into the application by their ID, use the <code>loginUsingId</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">loginUsingId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<h4>Validating User Credentials Without Login</h4>

<p>The <code>validate</code> method allows you to validate a user&#39;s credentials without actually logging them into the application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Logging A User In For A Single Request</h4>

<p>You may also use the <code>once</code> method to log a user into the application for a single request. No sessions or cookies will be utilized:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">once</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Manually Logging In A User</h4>

<p>If you need to log an existing user instance into your application, you may call the <code>login</code> method with the user instance:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<p>This is equivalent to logging in a user via credentials using the <code>attempt</code> method.</p>

<h4>Logging A User Out Of The Application</h4>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">logout</span><span class="p">();</span>
</pre></div>

<p>Of course, if you are using the built-in Laravel authentication controllers, a controller method that handles logging users out of the application is provided out of the box.</p>

<h4>Authentication Events</h4>

<p>When the <code>attempt</code> method is called, the <code>auth.attempt</code> <a href="/docs/%7B%7Bversion%7D%7D/events">event</a> will be fired. If the authentication attempt is successful and the user is logged in, the <code>auth.login</code> event will be fired as well.</p>

<p><a name="retrieving-the-authenticated-user"></a></p>

<h2>Retrieving The Authenticated User</h2>

<p>Once a user is authenticated, there are several ways to obtain an instance of the User.</p>

<p>First, you may access the user from the <code>Auth</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the user&#39;s profile.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="c1">// Auth::user() returns an instance of the authenticated user...</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Second, you may access the authenticated user via an <code>Illuminate\Http\Request</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the user&#39;s profile.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateProfile</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="c1">// $request-&gt;user() returns an instance of the authenticated user...</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Thirdly, you may type-hint the <code>Illuminate\Contracts\Auth\Authenticatable</code> contract. This type-hint may be added to a controller constructor, controller method, or any other constructor of a class resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\Authenticatable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the user&#39;s profile.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateProfile</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// $user is an instance of the authenticated user...</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="protecting-routes"></a></p>

<h2>Protecting Routes</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Route middleware</a> can be used to allow only authenticated users to access a given route. Laravel provides the <code>auth</code> middleware by default, and it is defined in <code>app\Http\Middleware\Authenticate.php</code>. All you need to do is attach it to a route definition:</p>
<div class="highlight"><pre><span></span><span class="c1">// With A Route Closure...</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}]);</span>

<span class="c1">// With A Controller...</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ProfileController@show&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="http-basic-authentication"></a></p>

<h2>HTTP Basic Authentication</h2>

<p>HTTP Basic Authentication provides a quick way to authenticate users of your application without setting up a dedicated &quot;login&quot; page. To get started, attach the <code>auth.basic</code> middleware to your route:</p>

<h4>Protecting A Route With HTTP Basic</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth.basic&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}]);</span>
</pre></div>

<p>By default, the <code>basic</code> middleware will use the <code>email</code> column on the user record as the &quot;username&quot;.</p>

<h4>Setting Up A Stateless HTTP Basic Filter</h4>

<p>You may also use HTTP Basic Authentication without setting a user identifier cookie in the session, which is particularly useful for API authentication. To do so, <a href="/docs/%7B%7Bversion%7D%7D/middleware">define a middleware</a> that calls the <code>onceBasic</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">onceBasic</span><span class="p">()</span> <span class="o">?:</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you are using PHP FastCGI, HTTP Basic authentication may not work correctly out of the box. The following lines should be added to your <code>.htaccess</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}</span> <span class="o">^</span><span class="p">(.</span><span class="o">+</span><span class="p">)</span><span class="nx">$</span>
<span class="nx">RewriteRule</span> <span class="p">.</span><span class="o">*</span> <span class="o">-</span> <span class="p">[</span><span class="nx">E</span><span class="o">=</span><span class="nx">HTTP_AUTHORIZATION</span><span class="o">:%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}]</span>
</pre></div>

<p><a name="password-reminders-and-reset"></a></p>

<h2>Password Reminders &amp; Reset</h2>

<h3>Model &amp; Table</h3>

<p>Most web applications provide a way for users to reset their forgotten passwords. Rather than forcing you to re-implement this on each application, Laravel provides convenient methods for sending password reminders and performing password resets.</p>

<p>To get started, verify that your <code>User</code> model implements the <code>Illuminate\Contracts\Auth\CanResetPassword</code> contract. Of course, the <code>User</code> model included with the framework already implements this interface, and uses the <code>Illuminate\Auth\Passwords\CanResetPassword</code> trait to include the methods needed to implement the interface.</p>

<h4>Generating The Reminder Table Migration</h4>

<p>Next, a table must be created to store the password reset tokens. The migration for this table is included with Laravel out of the box, and resides in the <code>database/migrations</code> directory. So all you need to do is migrate:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h3>Password Reminder Controller</h3>

<p>Laravel also includes an <code>Auth\PasswordController</code> that contains the logic necessary to reset user passwords. We&#39;ve even provided views to get you started! The views are located in the <code>resources/views/auth</code> directory. You are free to modify these views as you wish to suit your own application&#39;s design.</p>

<p>Your user will receive an e-mail with a link that points to the <code>getReset</code> method of the <code>PasswordController</code>. This method will render the password reset form and allow users to reset their passwords. After the password is reset, the user will automatically be logged into the application and redirected to <code>/home</code>. You can customize the post-reset redirect location by defining a <code>redirectTo</code> property on the <code>PasswordController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">;</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, password reset tokens expire after one hour. You may change this via the <code>reminder.expire</code> option in your <code>config/auth.php</code> file.</p>
</blockquote>

<p><a name="social-authentication"></a></p>

<h2>Social Authentication</h2>

<p>In addition to typical, form based authentication, Laravel also provides a simple, convenient way to authenticate with OAuth providers using <a href="https://github.com/laravel/socialite">Laravel Socialite</a>. <strong>Socialite currently supports authentication with Facebook, Twitter, Google, GitHub and Bitbucket.</strong></p>

<p>To get started with Socialite, include the package in your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;laravel/socialite&quot;</span><span class="o">:</span> <span class="s2">&quot;~2.0&quot;</span>
</pre></div>

<p>Next, register the <code>Laravel\Socialite\SocialiteServiceProvider</code> in your <code>config/app.php</code> configuration file. You may also register a <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Socialize&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Laravel\Socialite\Facades\Socialite&#39;</span><span class="p">,</span>
</pre></div>

<p>You will need to add credentials for the OAuth services your application utilizes. These credentials should be placed in your <code>config/services.php</code> configuration file, and should use the key <code>facebook</code>, <code>twitter</code>, <code>google</code>, or <code>github</code>, depending on the providers your application requires. For example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;github&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-github-app-id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-github-app-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redirect&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://your-callback-url&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Next, you are ready to authenticate users! You will need two routes: one for redirecting the user to the OAuth provider, and another for receiving the callback from the provider after authentication. Here&#39;s an example using the <code>Socialize</code> facade:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">redirectToProvider</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handleProviderCallback</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>

    <span class="c1">// $user-&gt;token;</span>
<span class="p">}</span>
</pre></div>

<p>The <code>redirect</code> method takes care of sending the user to the OAuth provider, while the <code>user</code> method will read the incoming request and retrieve the user&#39;s information from the provider. Before redirecting the user, you may also set &quot;scopes&quot; on the request:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">scopes</span><span class="p">([</span><span class="s1">&#39;scope1&#39;</span><span class="p">,</span> <span class="s1">&#39;scope2&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<p>Once you have a user instance, you can grab a few more details about the user:</p>

<h4>Retrieving User Details</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>

<span class="c1">// OAuth Two Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>

<span class="c1">// OAuth One Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>
<span class="nx">$tokenSecret</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokenSecret</span><span class="p">;</span>

<span class="c1">// All Providers</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getId</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getNickname</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getName</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getEmail</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getAvatar</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Cashier</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#subscribing-to-a-plan">Subscribing To A Plan</a></li>
<li><a href="#single-charges">Single Charges</a></li>
<li><a href="#no-card-up-front">No Card Up Front</a></li>
<li><a href="#swapping-subscriptions">Swapping Subscriptions</a></li>
<li><a href="#subscription-quantity">Subscription Quantity</a></li>
<li><a href="#subscription-tax">Subscription Tax</a></li>
<li><a href="#cancelling-a-subscription">Cancelling A Subscription</a></li>
<li><a href="#resuming-a-subscription">Resuming A Subscription</a></li>
<li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
<li><a href="#handling-failed-subscriptions">Handling Failed Subscriptions</a></li>
<li><a href="#handling-other-stripe-webhooks">Handling Other Stripe Webhooks</a></li>
<li><a href="#invoices">Invoices</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Cashier provides an expressive, fluent interface to <a href="https://stripe.com">Stripe&#39;s</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading writing. In addition to basic subscription management, Cashier can handle coupons, swapping subscription, subscription &quot;quantities&quot;, cancellation grace periods, and even generate invoice PDFs.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<h4>Composer</h4>

<p>First, add the Cashier package to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">SDK</span> <span class="o">~</span><span class="mf">2.0</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">on</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="nx">version</span> <span class="nx">and</span> <span class="nx">later</span><span class="p">)</span>
<span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~4.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">on</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="nx">version</span> <span class="nx">and</span> <span class="nx">later</span><span class="p">)</span>
<span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.0&quot;</span> <span class="p">(</span><span class="nx">For</span> <span class="nx">Stripe</span> <span class="nx">APIs</span> <span class="nx">up</span> <span class="nx">to</span> <span class="nx">and</span> <span class="nx">including</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="nx">version</span><span class="p">)</span>
</pre></div>

<h4>Service Provider</h4>

<p>Next, register the <code>Laravel\Cashier\CashierServiceProvider</code> in your <code>app</code> configuration file.</p>

<h4>Migration</h4>

<p>Before using Cashier, we&#39;ll need to add several columns to your database. Don&#39;t worry, you can use the <code>cashier:table</code> Artisan command to create a migration to add the necessary column. For example, to add the column to the users table use <code>php artisan cashier:table users</code>. Once the migration has been created, simply run the <code>migrate</code> command.</p>

<h4>Model Setup</h4>

<p>Next, add the <code>Billable</code> trait and appropriate date mutators to your model definition:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Billable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Billable</span> <span class="nx">as</span> <span class="nx">BillableContract</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="kr">implements</span> <span class="nx">BillableContract</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">Billable</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trial_ends_at&#39;</span><span class="p">,</span> <span class="s1">&#39;subscription_ends_at&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<h4>Stripe Key</h4>

<p>Finally, set your Stripe key in your <code>services.php</code> config file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;stripe&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;model&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;STRIPE_API_SECRET&#39;</span><span class="p">),</span>
<span class="p">],</span>
</pre></div>

<p>Alternatively you can store it in one of your bootstrap files or service providers, such as the <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">setStripeKey</span><span class="p">(</span><span class="s1">&#39;stripe-key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="subscribing-to-a-plan"></a></p>

<h2>Subscribing To A Plan</h2>

<p>Once you have a model instance, you can easily subscribe that user to a given Stripe plan:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">withCoupon</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>The <code>subscription</code> method will automatically create the Stripe subscription, as well as update your database with Stripe customer ID and other relevant billing information. If your plan has a trial configured in Stripe, the trial end date will also automatically be set on the user record.</p>

<p>If your plan has a trial period that is <strong>not</strong> configured in Stripe, you must set the trial end date manually after subscribing:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h3>Specifying Additional User Details</h3>

<p>If you would like to specify additional customer details, you may do so by passing them as second argument to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Our First Customer&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>To learn more about the additional fields supported by Stripe, check out Stripe&#39;s <a href="https://stripe.com/docs/api#create_customer">documentation on customer creation</a>.</p>

<p><a name="single-charges"></a></p>

<h2>Single Charges</h2>

<p>If you would like to make a &quot;one off&quot; charge against a subscribed customer&#39;s credit card, you may use the <code>charge</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>

<p>The <code>charge</code> method accepts the amount you would like to charge in the <strong>lowest denominator of the currency</strong>. So, for example, the example above will charge 100 cents, or $1.00, against the user&#39;s credit card.</p>

<p>The <code>charge</code> method accepts an array as its second argument, allowing you to pass any options you wish to the underlying Stripe charge creation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;source&#39;</span> <span class="p">=&gt;</span> <span class="nx">$token</span><span class="p">,</span>
    <span class="s1">&#39;receipt_email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>The <code>charge</code> method will return <code>false</code> if the charge fails. This typically indicates the charge was denied:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The charge was denied...</span>
<span class="p">}</span>
</pre></div>

<p>If the charge is successful, the full Stripe response will be returned from the method.</p>

<p><a name="no-card-up-front"></a></p>

<h2>No Card Up Front</h2>

<p>If your application offers a free-trial with no credit-card up front, set the <code>cardUpFront</code> property on your model to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$cardUpFront</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>

<p>On account creation, be sure to set the trial end date on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="swapping-subscriptions"></a></p>

<h2>Swapping Subscriptions</h2>

<p>To swap a user to a new subscription, use the <code>swap</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;premium&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">();</span>
</pre></div>

<p>If the user is on trial, the trial will be maintained as normal. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p>

<p><a name="subscription-quantity"></a></p>

<h2>Subscription Quantity</h2>

<p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge $10 per month per user on an account. To easily increment or decrement your subscription quantity, use the <code>increment</code> and <code>decrement</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">();</span>

<span class="c1">// Add five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">();</span>

<span class="c1">// Subtract five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p><a name="subscription-tax"></a></p>

<h2>Subscription Tax</h2>

<p>With Cashier, it&#39;s easy to override the <code>tax_percent</code> value sent to Stripe. To specify the tax percentage a user pays on a subscription, implement the <code>getTaxPercent</code> method on your model, and return a numeric value between 0 and 100, with no more than 2 decimal places.</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getTaxPercent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This enables you to apply a tax rate on a model-by-model basis, which may be helpful for a user base that spans multiple countries.</p>

<p><a name="cancelling-a-subscription"></a></p>

<h2>Cancelling A Subscription</h2>

<p>Cancelling a subscription is a walk in the park:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
</pre></div>

<p>When a subscription is cancelled, Cashier will automatically set the <code>subscription_ends_at</code> column on your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p>

<p><a name="resuming-a-subscription"></a></p>

<h2>Resuming A Subscription</h2>

<p>If a user has cancelled their subscription and you wish to resume it, use the <code>resume</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">resume</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>If the user cancels a subscription and then resumes that subscription before the subscription has fully expired, they will not be billed immediately. Their subscription will simply be re-activated, and they will be billed on the original billing cycle.</p>

<p><a name="checking-subscription-status"></a></p>

<h2>Checking Subscription Status</h2>

<p>To verify that a user is subscribed to your application, use the <code>subscribed</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribed</code> method makes a great candidate for a <a href="/docs/%7B%7Bversion%7D%7D/middleware">route middleware</a>:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if the user is still within their trial period (if applicable) using the <code>onTrial</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was scheduled to end on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>everSubscribed</code> method may be used to determine if the user has ever subscribed to a plan in your application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">everSubscribed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>onPlan</code> method may be used to determine if the user is subscribed to a given plan based on its ID:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onPlan</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="handling-failed-subscriptions"></a></p>

<h2>Handling Failed Subscriptions</h2>

<p>What if a customer&#39;s credit card expires? No worries - Cashier includes a Webhook controller that can easily cancel the customer&#39;s subscription for you. Just point a route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;stripe/webhook&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel\Cashier\WebhookController@handleWebhook&#39;</span><span class="p">);</span>
</pre></div>

<p>That&#39;s it! Failed payments will be captured and handled by the controller. The controller will cancel the customer&#39;s subscription when Stripe determines the subscription has failed (normally after three failed payment attempts). The <code>stripe/webhook</code> URI in this example is just for example. You will need to configure the URI in your Stripe settings.</p>

<p><a name="handling-other-stripe-webhooks"></a></p>

<h2>Handling Other Stripe Webhooks</h2>

<p>If you have additional Stripe webhook events you would like to handle, simply extend the Webhook controller. Your method names should correspond to Cashier&#39;s expected convention, specifically, methods should be prefixed with <code>handle</code> and the name of the Stripe webhook you wish to handle. For example, if you wish to handle the <code>invoice.payment_succeeded</code> webhook, you should add a <code>handleInvoicePaymentSucceeded</code> method to the controller.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">WebhookController</span> <span class="kr">extends</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">WebhookController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handleInvoicePaymentSucceeded</span><span class="p">(</span><span class="nx">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle The Event</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> In addition to updating the subscription information in your database, the Webhook controller will also cancel the subscription via the Stripe API.</p>
</blockquote>

<p><a name="invoices"></a></p>

<h2>Invoices</h2>

<p>You can easily retrieve an array of a user&#39;s invoices using the <code>invoices</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoices</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoices</span><span class="p">();</span>
</pre></div>

<p>When listing the invoices for the customer, you may use these helper methods to display the relevant invoice information:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span>

<span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dateString</span><span class="p">()</span> <span class="p">}}</span>

<span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dollars</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>Use the <code>downloadInvoice</code> method to generate a PDF download of the invoice. Yes, it&#39;s really this easy:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">downloadInvoice</span><span class="p">(</span><span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;vendor&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;Your Company&#39;</span><span class="p">,</span>
    <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Product&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Command Bus</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-commands">Creating Commands</a></li>
<li><a href="#dispatching-commands">Dispatching Commands</a></li>
<li><a href="#queued-commands">Queued Commands</a></li>
<li><a href="#command-pipeline">Command Pipeline</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel command bus provides a convenient method of encapsulating tasks your application needs to perform into simple, easy to understand &quot;commands&quot;. To help us understand the purpose of commands, let&#39;s pretend we are building an application that allows users to purchase podcasts.</p>

<p>When a user purchases a podcast, there are a variety of things that need to happen. For example, we may need to charge the user&#39;s credit card, add a record to our database that represents the purchase, and send a confirmation e-mail of the purchase. Perhaps we also need to perform some kind of validation as to whether the user is allowed to purchase podcasts.</p>

<p>We could put all of this logic inside a controller method; however, this has several disadvantages. The first disadvantage is that our controller probably handles several other incoming HTTP actions, and including complicated logic in each controller method will soon bloat our controller and make it harder to read. Secondly, it is difficult to re-use the purchase podcast logic outside of the controller context. Thirdly, it is more difficult to unit-test the command as we must also generate a stub HTTP request and make a full request to the application to test the purchase podcast logic.</p>

<p>Instead of putting this logic in the controller, we may choose to encapsulate it within a &quot;command&quot; object, such as a <code>PurchasePodcast</code> command.</p>

<p><a name="creating-commands"></a></p>

<h2>Creating Commands</h2>

<p>The Artisan CLI can generate new command classes using the <code>make:command</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">PurchasePodcast</span>
</pre></div>

<p>The newly generated class will be placed in the <code>app/Commands</code> directory. By default, the command contains two methods: the constructor and the <code>handle</code> method. Of course, the constructor allows you to pass any relevant objects to the command, while the <code>handle</code> method executes the command. For example:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">PurchasePodcast</span> <span class="kr">extends</span> <span class="nx">Command</span> <span class="kr">implements</span> <span class="nx">SelfHandling</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Create a new command instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">Podcast</span> <span class="nx">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">$user</span><span class="p">;</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span> <span class="o">=</span> <span class="nx">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Execute the command.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Handle the logic to purchase the podcast...</span>

        <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">,</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>handle</code> method may also type-hint dependencies, and they will be automatically injected by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. For example:</p>
<div class="highlight"><pre><span></span>    <span class="cm">/**</span>
<span class="cm">     * Execute the command.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">BillingGateway</span> <span class="nx">$billing</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle the logic to purchase the podcast...</span>
    <span class="p">}</span>
</pre></div>

<p><a name="dispatching-commands"></a></p>

<h2>Dispatching Commands</h2>

<p>So, once we have created a command, how do we dispatch it? Of course, we could call the <code>handle</code> method directly; however, dispatching the command through the Laravel &quot;command bus&quot; has several advantages which we will discuss later.</p>

<p>If you glance at your application&#39;s base controller, you will see the <code>DispatchesCommands</code> trait. This trait allows us to call the <code>dispatch</code> method from any of our controllers. For example:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">purchasePodcast</span><span class="p">(</span><span class="nx">$podcastId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">PurchasePodcast</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">(),</span> <span class="nx">Podcast</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$podcastId</span><span class="p">))</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The command bus will take care of executing the command and calling the IoC container to inject any needed dependencies into the <code>handle</code> method.</p>

<p>You may add the <code>Illuminate\Foundation\Bus\DispatchesCommands</code> trait to any class you wish. If you would like to receive a command bus instance through the constructor of any of your classes, you may type-hint the <code>Illuminate\Contracts\Bus\Dispatcher</code> interface. Finally, you may also use the <code>Bus</code> facade to quickly dispatch commands:</p>
<div class="highlight"><pre><span></span>    <span class="nx">Bus</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">PurchasePodcast</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">(),</span> <span class="nx">Podcast</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$podcastId</span><span class="p">))</span>
    <span class="p">);</span>
</pre></div>

<h3>Mapping Command Properties From Requests</h3>

<p>It is very common to map HTTP request variables into commands. So, instead of forcing you to do this manually for each request, Laravel provides some helper methods to make it a cinch. Let&#39;s take a look at the <code>dispatchFrom</code> method available on the <code>DispatchesCommands</code> trait:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatchFrom</span><span class="p">(</span><span class="s1">&#39;Command\Class\Name&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="p">);</span>
</pre></div>

<p>This method will examine the constructor of the command class it is given, and then extract variables from the HTTP request (or any other <code>ArrayAccess</code> object) to fill the needed constructor parameters of the command. So, if our command class accepts a <code>firstName</code> variable in its constructor, the command bus will attempt to pull the <code>firstName</code> parameter from the HTTP request.</p>

<p>You may also pass an array as the third argument to the <code>dispatchFrom</code> method. This array will be used to fill any constructor parameters that are not available on the request:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatchFrom</span><span class="p">(</span><span class="s1">&#39;Command\Class\Name&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;firstName&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="queued-commands"></a></p>

<h2>Queued Commands</h2>

<p>The command bus is not just for synchronous jobs that run during the current request cycle, but also serves as the primary way to build queued jobs in Laravel. So, how do we instruct command bus to queue our job for background processing instead of running it synchronously? It&#39;s easy. Firstly, when generating a new command, just add the <code>--queued</code> flag to the command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">PurchasePodcast</span> <span class="o">--</span><span class="nx">queued</span>
</pre></div>

<p>As you will see, this adds a few more features to the command, namely the <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> interface and the <code>SerializesModels</code> trait. These instruct the command bus to queue the command, as well as gracefully serialize and deserialize any Eloquent models your command stores as properties.</p>

<p>If you would like to convert an existing command into a queued command, simply implement the <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> interface on the class manually. It contains no methods, and merely serves as a &quot;marker interface&quot; for the dispatcher.</p>

<p>Then, just write your command normally. When you dispatch it to the bus that bus will automatically queue the command for background processing. It doesn&#39;t get any easier than that.</p>

<p>For more information on interacting with queued commands, view the full <a href="/docs/%7B%7Bversion%7D%7D/queues">queue documentation</a>.</p>

<p><a name="command-pipeline"></a></p>

<h2>Command Pipeline</h2>

<p>Before a command is dispatched to a handler, you may pass it through other classes in a &quot;pipeline&quot;. Command pipes work just like HTTP middleware, except for your commands! For example, a command pipe could wrap the entire command operation within a database transaction, or simply log its execution.</p>

<p>To add a pipe to your bus, call the <code>pipeThrough</code> method of the dispatcher from your <code>App\Providers\BusServiceProvider::boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$dispatcher</span><span class="o">-&gt;</span><span class="nx">pipeThrough</span><span class="p">([</span><span class="s1">&#39;UseDatabaseTransactions&#39;</span><span class="p">,</span> <span class="s1">&#39;LogCommand&#39;</span><span class="p">]);</span>
</pre></div>

<p>A command pipe is defined with a <code>handle</code> method, just like a middleware:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UseDatabaseTransactions</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$command</span><span class="p">,</span> <span class="nx">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$command</span><span class="p">,</span> <span class="nx">$next</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$command</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Command pipe classes are resolved through the <a href="/docs/%7B%7Bversion%7D%7D/container">IoC container</a>, so feel free to type-hint any dependencies you need within their constructors.</p>

<p>You may even define a <code>Closure</code> as a command pipe:</p>
<div class="highlight"><pre><span></span><span class="nx">$dispatcher</span><span class="o">-&gt;</span><span class="nx">pipeThrough</span><span class="p">([</span><span class="kd">function</span><span class="p">(</span><span class="nx">$command</span><span class="p">,</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$command</span><span class="p">,</span> <span class="nx">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$command</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}]);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Cache</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#cache-usage">Cache Usage</a></li>
<li><a href="#increments-and-decrements">Increments &amp; Decrements</a></li>
<li><a href="#cache-tags">Cache Tags</a></li>
<li><a href="#cache-events">Cache Events</a></li>
<li><a href="#database-cache">Database Cache</a></li>
<li><a href="#memcached-cache">Memcached Cache</a></li>
<li><a href="#redis-cache">Redis Cache</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides a unified API for various caching systems. The cache configuration is located at <code>config/cache.php</code>. In this file you may specify which cache driver you would like used by default throughout your application. Laravel supports popular caching backends like <a href="http://memcached.org">Memcached</a> and <a href="http://redis.io">Redis</a> out of the box.</p>

<p>The cache configuration file also contains various other options, which are documented within the file, so make sure to read over these options. By default, Laravel is configured to use the <code>file</code> cache driver, which stores the serialized, cached objects in the filesystem. For larger applications, it is recommended that you use an in-memory cache such as Memcached or APC. You may even configure multiple cache configurations for the same driver.</p>

<p>Before using a Redis cache with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<p><a name="cache-usage"></a></p>

<h2>Cache Usage</h2>

<h4>Storing An Item In The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<h4>Using Carbon Objects To Set Expire Time</h4>
<div class="highlight"><pre><span></span><span class="nx">$expiresAt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$expiresAt</span><span class="p">);</span>
</pre></div>

<h4>Storing An Item In The Cache If It Doesn&#39;t Exist</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>The <code>add</code> method will return <code>true</code> if the item is actually <strong>added</strong> to the cache. Otherwise, the method will return <code>false</code>.</p>

<h4>Checking For Existence In Cache</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving An Item From The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item Or Returning A Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h4>Storing An Item In The Cache Permanently</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p>Sometimes you may wish to retrieve an item from the cache, but also store a default value if the requested item doesn&#39;t exist. You may do this using the <code>Cache::remember</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>You may also combine the <code>remember</code> and <code>forever</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">rememberForever</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Note that all items stored in the cache are serialized, so you are free to store any type of data.</p>

<h4>Pulling An Item From The Cache</h4>

<p>If you need to retrieve an item from the cache and then delete it, you may use the <code>pull</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Removing An Item From The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Access Specific Cache Stores</h4>

<p>When using multiple cache stores, you may access them via the <code>store</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="increments-and-decrements"></a></p>

<h2>Increments &amp; Decrements</h2>

<p>All drivers except <code>database</code> support the <code>increment</code> and <code>decrement</code> operations:</p>

<h4>Incrementing A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<h4>Decrementing A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<p><a name="cache-tags"></a></p>

<h2>Cache Tags</h2>

<blockquote>
<p><strong>Note:</strong> Cache tags are not supported when using the <code>file</code> or <code>database</code> cache drivers. Furthermore, when using multiple tags with caches that are stored &quot;forever&quot;, performance will be best with a driver such as <code>memcached</code>, which automatically purges stale records.</p>
</blockquote>

<h4>Accessing A Tagged Cache</h4>

<p>Cache tags allow you to tag related items in the cache, and then flush all caches tagged with a given name. To access a tagged cache, use the <code>tags</code> method.</p>

<p>You may store a tagged cache by passing in an ordered list of tag names as arguments, or as an ordered array of tag names:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$john</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">,</span> <span class="nx">$anne</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>You may use any cache storage method in combination with tags, including <code>remember</code>, <code>forever</code>, and <code>rememberForever</code>. You may also access cached items from the tagged cache, as well as use the other cache methods such as <code>increment</code> and <code>decrement</code>.</p>

<h4>Accessing Items In A Tagged Cache</h4>

<p>To access a tagged cache, pass the same ordered list of tags used to save it.</p>
<div class="highlight"><pre><span></span><span class="nx">$anne</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">);</span>

<span class="nx">$john</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">);</span>
</pre></div>

<p>You may flush all items tagged with a name or list of names. For example, this statement would remove all caches tagged with either <code>people</code>, <code>authors</code>, or both. So, both &quot;Anne&quot; and &quot;John&quot; would be removed from the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p>In contrast, this statement would remove only caches tagged with <code>authors</code>, so &quot;John&quot; would be removed, but not &quot;Anne&quot;.</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p><a name="cache-events"></a></p>

<h2>Cache Events</h2>

<p>To execute code on every cache operation, you may listen for the events fired by the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.hit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.missed&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.write&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;cache.delete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="database-cache"></a></p>

<h2>Database Cache</h2>

<p>When using the <code>database</code> cache driver, you will need to setup a table to contain the cache items. You&#39;ll find an example <code>Schema</code> declaration for the table below:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;expiration&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="memcached-cache"></a></p>

<h4>Memcached Cache</h4>

<p>Using the Memcached cache requires the <a href="http://pecl.php.net/package/memcached">Memcached PECL package</a> to be installed.</p>

<p>The default <a href="#configuration">configuration</a> uses TCP/IP based on <a href="http://php.net/manual/en/memcached.addserver.php">Memcached::addServer</a>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">11211</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>

<p>You may also set the <code>host</code> option to a UNIX socket path. If you do this, the <code>port</code> option should be set to <code>0</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;/var/run/memcached/memcached.sock&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>

<p><a name="redis-cache"></a></p>

<h4>Redis Cache</h4>

<p>See <a href="/docs/redis#configuration">Redis Configuration</a></p>
<div style="page-break-after: always;" ></div><h1>Collections</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The <code>Illuminate\Support\Collection</code> class provides a fluent, convenient wrapper for working with arrays of data. For example, check out the following code. We&#39;ll use the <code>collect</code> helper to create a new collection instance from the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;abigail&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">empty</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the <code>Collection</code> class allows you to chain its methods to perform fluent mapping and reducing of the underlying array. In general, every <code>Collection</code> method returns an entirely new <code>Collection</code> instance. To dig in further, keep reading!</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Creating Collections</h4>

<p>As mentioned above, the <code>collect</code> helper will return a new <code>Illuminate\Support\Collection</code> instance for the given array. You may also use the <code>make</code> command on the <code>Collection</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">make</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>Of course, collections of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> objects are always returned as <code>Collection</code> instances; however, you should feel free to use the <code>Collection</code> class wherever it is convenient for your application.</p>

<h4>Explore The Collection</h4>

<p>Instead of listing all of the methods (there are a lot) the Collection makes available, check out the <a href="http://laravel.com/api/master/Illuminate/Support/Collection.html">API documentation for the class</a>!</p>
<div style="page-break-after: always;" ></div><h1>Artisan Development</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#building-a-command">Building A Command</a></li>
<li><a href="#registering-commands">Registering Commands</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to the commands provided with Artisan, you may also build your own custom commands for working with your application. You may store your custom commands in the <code>app/Console/Commands</code> directory; however, you are free to choose your own storage location as long as your commands can be autoloaded based on your <code>composer.json</code> settings.</p>

<p><a name="building-a-command"></a></p>

<h2>Building A Command</h2>

<h3>Generating The Class</h3>

<p>To create a new command, you may use the <code>make:console</code> Artisan command, which will generate a command stub to help you get started:</p>

<h4>Generate A New Command Class</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">console</span> <span class="nx">FooCommand</span>
</pre></div>

<p>The command above would generate a class at <code>app/Console/Commands/FooCommand.php</code>.</p>

<p>When creating the command, the <code>--command</code> option may be used to assign the terminal command name:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">console</span> <span class="nx">AssignUsers</span> <span class="o">--</span><span class="nx">command</span><span class="o">=</span><span class="nx">users</span><span class="o">:</span><span class="nx">assign</span>
</pre></div>

<h3>Writing The Command</h3>

<p>Once your command is generated, you should fill out the <code>name</code> and <code>description</code> properties of the class, which will be used when displaying your command on the <code>list</code> screen.</p>

<p>The <code>fire</code> method will be called when your command is executed. You may place any command logic in this method.</p>

<h3>Arguments &amp; Options</h3>

<p>The <code>getArguments</code> and <code>getOptions</code> methods are where you may define any arguments or options your command receives. Both of these methods return an array of commands, which are described by a list of array options.</p>

<p>When defining <code>arguments</code>, the array definition values represent the following:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$mode</span><span class="p">,</span> <span class="nx">$description</span><span class="p">,</span> <span class="nx">$defaultValue</span><span class="p">]</span>
</pre></div>

<p>The argument <code>mode</code> may be any of the following: <code>InputArgument::REQUIRED</code> or <code>InputArgument::OPTIONAL</code>.</p>

<p>When defining <code>options</code>, the array definition values represent the following:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$shortcut</span><span class="p">,</span> <span class="nx">$mode</span><span class="p">,</span> <span class="nx">$description</span><span class="p">,</span> <span class="nx">$defaultValue</span><span class="p">]</span>
</pre></div>

<p>For options, the argument <code>mode</code> may be: <code>InputOption::VALUE_REQUIRED</code>, <code>InputOption::VALUE_OPTIONAL</code>, <code>InputOption::VALUE_IS_ARRAY</code>, <code>InputOption::VALUE_NONE</code>.</p>

<p>The <code>VALUE_IS_ARRAY</code> mode indicates that the switch may be used multiple times when calling the command:</p>
<div class="highlight"><pre><span></span><span class="nx">InputOption</span><span class="o">::</span><span class="nx">VALUE_REQUIRED</span> <span class="o">|</span> <span class="nx">InputOption</span><span class="o">::</span><span class="nx">VALUE_IS_ARRAY</span>
</pre></div>

<p>Would then allow for this command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">option</span><span class="o">=</span><span class="nx">bar</span> <span class="o">--</span><span class="nx">option</span><span class="o">=</span><span class="nx">baz</span>
</pre></div>

<p>The <code>VALUE_NONE</code> option indicates that the option is simply used as a &quot;switch&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">option</span>
</pre></div>

<h3>Retrieving Input</h3>

<p>While your command is executing, you will obviously need to access the values for the arguments and options accepted by your application. To do so, you may use the <code>argument</code> and <code>option</code> methods:</p>

<h4>Retrieving The Value Of A Command Argument</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Arguments</h4>
<div class="highlight"><pre><span></span><span class="nx">$arguments</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Value Of A Command Option</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Options</h4>
<div class="highlight"><pre><span></span><span class="nx">$options</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">();</span>
</pre></div>

<h3>Writing Output</h3>

<p>To send output to the console, you may use the <code>info</code>, <code>comment</code>, <code>question</code> and <code>error</code> methods. Each of these methods will use the appropriate ANSI colors for their purpose.</p>

<h4>Sending Information To The Console</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
</pre></div>

<h4>Sending An Error Message To The Console</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">);</span>
</pre></div>

<h3>Asking Questions</h3>

<p>You may also use the <code>ask</code> and <code>confirm</code> methods to prompt the user for input:</p>

<h4>Asking The User For Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">ask</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking The User For Secret Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">secret</span><span class="p">(</span><span class="s1">&#39;What is the password?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking The User For Confirmation</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;Do you wish to continue? [yes|no]&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify a default value to the <code>confirm</code> method, which should be <code>true</code> or <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="nx">$question</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<h3>Calling Other Commands</h3>

<p>Sometimes you may wish to call other commands from your command. You may do so using the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;command:name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;argument&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;--option&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="registering-commands"></a></p>

<h2>Registering Commands</h2>

<h4>Registering An Artisan Command</h4>

<p>Once your command is finished, you need to register it with Artisan so it will be available for use. This is typically done in the <code>app/Console/Kernel.php</code> file. Within this file, you will find a list of commands in the <code>commands</code> property. To register your command, simply add it to this list.</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$commands</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;App\Console\Commands\FooCommand&#39;</span>
<span class="p">];</span>
</pre></div>

<p>When Artisan boots, all the commands listed in this property will be resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and registered with Artisan.</p>
<div style="page-break-after: always;" ></div><h1>Configuration</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#after-installation">After Installation</a></li>
<li><a href="#accessing-configuration-values">Accessing Configuration Values</a></li>
<li><a href="#environment-configuration">Environment Configuration</a></li>
<li><a href="#configuration-caching">Configuration Caching</a></li>
<li><a href="#maintenance-mode">Maintenance Mode</a></li>
<li><a href="#pretty-urls">Pretty URLs</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>All of the configuration files for the Laravel framework are stored in the <code>config</code> directory. Each option is documented, so feel free to look through the files and get familiar with the options available to you.</p>

<p><a name="after-installation"></a></p>

<h2>After Installation</h2>

<h3>Naming Your Application</h3>

<p>After installing Laravel, you may wish to &quot;name&quot; your application. By default, the <code>app</code> directory is namespaced under <code>App</code>, and autoloaded by Composer using the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 autoloading standard</a>. However, you may change the namespace to match the name of your application, which you can easily do via the <code>app:name</code> Artisan command.</p>

<p>For example, if your application is named &quot;Horsefly&quot;, you could run the following command from the root of your installation:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">app</span><span class="o">:</span><span class="nx">name</span> <span class="nx">Horsefly</span>
</pre></div>

<p>Renaming your application is entirely optional, and you are free to keep the <code>App</code> namespace if you wish.</p>

<h3>Other Configuration</h3>

<p>Laravel needs very little configuration out of the box. You are free to get started developing! However, you may wish to review the <code>config/app.php</code> file and its documentation. It contains several options such as <code>timezone</code> and <code>locale</code> that you may wish to change according to your location.</p>

<p>Once Laravel is installed, you should also <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">configure your local environment</a>.</p>

<blockquote>
<p><strong>Note:</strong> You should never have the <code>app.debug</code> configuration option set to <code>true</code> for a production application.</p>
</blockquote>

<p><a name="permissions"></a></p>

<h3>Permissions</h3>

<p>Laravel may require one set of permissions to be configured: folders within <code>storage</code> and <code>vendor</code> require write access by the web server.</p>

<p><a name="accessing-configuration-values"></a></p>

<h2>Accessing Configuration Values</h2>

<p>You may easily access your configuration values using the <code>Config</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>

<span class="nx">Config</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also use the <code>config</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="environment-configuration"></a></p>

<h2>Environment Configuration</h2>

<p>It is often helpful to have different configuration values based on the environment the application is running in. For example, you may wish to use a different cache driver locally than you do on your production server. It&#39;s easy using environment based configuration.</p>

<p>To make this a cinch, Laravel utilizes the <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> PHP library by Vance Lucas. In a fresh Laravel installation, the root directory of your application will contain a <code>.env.example</code> file. If you install Laravel via Composer, this file will automatically be renamed to <code>.env</code>. Otherwise, you should rename the file manually.</p>

<p>All of the variables listed in this file will be loaded into the <code>$_ENV</code> PHP super-global when your application receives a request. You may use the <code>env</code> helper to retrieve values from these variables. In fact, if you review the Laravel configuration files, you will notice several of the options already using this helper!</p>

<p>Feel free to modify your environment variables as needed for your own local server, as well as your production environment. However, your <code>.env</code> file should not be committed to your application&#39;s source control, since each developer / server using your application could require a different environment configuration.</p>

<p>If you are developing with a team, you may wish to continue including a <code>.env.example</code> file with your application. By putting place-holder values in the example configuration file, other developers on your team can clearly see which environment variables are needed to run your application.</p>

<h4>Accessing The Current Application Environment</h4>

<p>You may access the current application environment via the <code>environment</code> method on the <code>Application</code> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p>You may also pass arguments to the <code>environment</code> method to check if the environment matches a given value:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The environment is local</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The environment is either local OR staging...</span>
<span class="p">}</span>
</pre></div>

<p>To obtain an instance of the application, resolve the <code>Illuminate\Contracts\Foundation\Application</code> contract via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. Of course, if you are within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>, the application instance is available via the <code>$this-&gt;app</code> instance variable.</p>

<p>An application instance may also be accessed via the <code>app</code> helper or the <code>App</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">environment</span><span class="p">();</span>

<span class="nx">$environment</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p><a name="configuration-caching"></a></p>

<h2>Configuration Caching</h2>

<p>To give your application a little speed boost, you may cache all of your configuration files into a single file using the <code>config:cache</code> Artisan command. This will combine all of the configuration options for your application into a single file which can be loaded quickly by the framework.</p>

<p>You should typically run the <code>config:cache</code> command as part of your deployment routine.</p>

<p><a name="maintenance-mode"></a></p>

<h2>Maintenance Mode</h2>

<p>When your application is in maintenance mode, a custom view will be displayed for all requests into your application. This makes it easy to &quot;disable&quot; your application while it is updating or when you are performing maintenance. A maintenance mode check is included in the default middleware stack for your application. If the application is in maintenance mode, an <code>HttpException</code> will be thrown with a status code of 503.</p>

<p>To enable maintenance mode, simply execute the <code>down</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span>
</pre></div>

<p>To disable maintenance mode, use the <code>up</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">up</span>
</pre></div>

<h3>Maintenance Mode Response Template</h3>

<p>The default template for maintenance mode responses is located in <code>resources/views/errors/503.blade.php</code>.</p>

<h3>Maintenance Mode &amp; Queues</h3>

<p>While your application is in maintenance mode, no <a href="/docs/%7B%7Bversion%7D%7D/queues">queued jobs</a> will be handled. The jobs will continue to be handled as normal once the application is out of maintenance mode.</p>

<p><a name="pretty-urls"></a></p>

<h2>Pretty URLs</h2>

<h3>Apache</h3>

<p>The framework ships with a <code>public/.htaccess</code> file that is used to allow URLs without <code>index.php</code>. If you use Apache to serve your Laravel application, be sure to enable the <code>mod_rewrite</code> module.</p>

<p>If the <code>.htaccess</code> file that ships with Laravel does not work with your Apache installation, try this one:</p>
<div class="highlight"><pre><span></span><span class="nx">Options</span> <span class="o">+</span><span class="nx">FollowSymLinks</span>
<span class="nx">RewriteEngine</span> <span class="nx">On</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">d</span>
<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">f</span>
<span class="nx">RewriteRule</span> <span class="o">^</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span> <span class="p">[</span><span class="nx">L</span><span class="p">]</span>
</pre></div>

<p>If your web host doesn&#39;t allow the <code>FollowSymlinks</code> option, try replacing it with <code>Options +SymLinksIfOwnerMatch</code>.</p>

<h3>Nginx</h3>

<p>On Nginx, the following directive in your site configuration will allow &quot;pretty&quot; URLs:</p>
<div class="highlight"><pre><span></span><span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
<span class="p">}</span>
</pre></div>

<p>Of course, when using <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a>, pretty URLs will be configured automatically.</p>
<div style="page-break-after: always;" ></div><h1>Service Container</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#binding-interfaces-to-implementations">Binding Interfaces To Implementations</a></li>
<li><a href="#contextual-binding">Contextual Binding</a></li>
<li><a href="#tagging">Tagging</a></li>
<li><a href="#practical-applications">Practical Applications</a></li>
<li><a href="#container-events">Container Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel service container is a powerful tool for managing class dependencies. Dependency injection is a fancy word that essentially means this: class dependencies are &quot;injected&quot; into the class via the constructor or, in some cases, &quot;setter&quot; methods.</p>

<p>Let&#39;s look at a simple example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Handlers\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Commands\PurchasePodcastCommand</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Mail\Mailer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PurchasePodcastHandler</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The mailer implementation.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Mailer  $mailer</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Mailer</span> <span class="nv">$mailer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Purchase a podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  PurchasePodcastCommand  $command</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">PurchasePodcastCommand</span> <span class="nv">$command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In this example, the <code>PurchasePodcast</code> command handler needs to send e-mails when a podcast is purchased. So, we will <strong>inject</strong> a service that is able to send e-mails. Since the service is injected, we are able to easily swap it out with another implementation. We are also able to easily &quot;mock&quot;, or create a dummy implementation of the mailer when testing our application.</p>

<p>A deep understanding of the Laravel service container is essential to building a powerful, large application, as well as for contributing to the Laravel core itself.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h3>Binding</h3>

<p>Almost all of your service container bindings will be registered within <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a>, so all of these examples will demonstrate using the container in that context. However, if you need an instance of the container elsewhere in your application, such as a factory, you may type-hint the <code>Illuminate\Contracts\Container\Container</code> contract and an instance of the container will be injected for you. Alternatively, you may use the <code>App</code> facade to access the container.</p>

<h4>Registering A Basic Resolver</h4>

<p>Within a service provider, you always have access to the container via the <code>$this-&gt;app</code> instance variable.</p>

<p>There are several ways the service container can register dependencies, including Closure callbacks and binding interfaces to implementations. First, we&#39;ll explore Closure callbacks. A Closure resolver is registered in the container with a key (typically the class name) and a Closure that returns some value:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;SomethingElse&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Singleton</h4>

<p>Sometimes, you may wish to bind something into the container that should only be resolved once, and the same instance should be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">singleton</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;SomethingElse&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Binding An Existing Instance Into The Container</h4>

<p>You may also bind an existing object instance into the container using the <code>instance</code> method. The given instance will always be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">(</span><span class="k">new</span> <span class="nx">SomethingElse</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">instance</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="nx">$fooBar</span><span class="p">);</span>
</pre></div>

<h3>Resolving</h3>

<p>There are several ways to resolve something out of the container. First, you may use the <code>make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">);</span>
</pre></div>

<p>Secondly, you may use &quot;array access&quot; on the container, since it implements PHP&#39;s <code>ArrayAccess</code> interface:</p>
<div class="highlight"><pre><span></span><span class="nx">$fooBar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="p">[</span><span class="s1">&#39;FooBar&#39;</span><span class="p">];</span>
</pre></div>

<p>Lastly, but most importantly, you may simply &quot;type-hint&quot; the dependency in the constructor of a class that is resolved by the container, including controllers, event listeners, queue jobs, filters, and more. The container will automatically inject the dependencies:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Users\Repository</span> <span class="k">as</span> <span class="nx">UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the user with the given ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="binding-interfaces-to-implementations"></a></p>

<h2>Binding Interfaces To Implementations</h2>

<h3>Injecting Concrete Dependencies</h3>

<p>A very powerful feature of the service container is its ability to bind an interface to a given implementation. For example, perhaps our application integrates with the <a href="https://pusher.com">Pusher</a> web service for sending and receiving real-time events. If we are using Pusher&#39;s PHP SDK, we could inject an instance of the Pusher client into a class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Handlers\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Commands\CreateOrder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Pusher\Client</span> <span class="k">as</span> <span class="nx">PusherClient</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateOrderHandler</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The Pusher SDK client instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$pusher</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new order handler instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  PusherClient  $pusher</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">PusherClient</span> <span class="nv">$pusher</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pusher</span> <span class="o">=</span> <span class="nv">$pusher</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the given command.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  CreateOrder  $command</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nx">CreateOrder</span> <span class="nv">$command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In this example, it is good that we are injecting the class dependencies; however, we are tightly coupled to the Pusher SDK. If the Pusher SDK methods change or we decide to switch to a new event service entirely, we will need to change our <code>CreateOrderHandler</code> code.</p>

<h3>Program To An Interface</h3>

<p>In order to &quot;insulate&quot; the <code>CreateOrderHandler</code> against changes to event pushing, we could define an <code>EventPusher</code> interface and a <code>PusherEventPusher</code> implementation:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Contracts</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">EventPusher</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Push a new event to all clients.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $event</span>
<span class="sd">     * @param  array  $data</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">push</span><span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>Once we have coded our <code>PusherEventPusher</code> implementation of this interface, we can register it with the service container like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Services\PusherEventPusher&#39;</span><span class="p">);</span>
</pre></div>

<p>This tells the container that it should inject the <code>PusherEventPusher</code> when a class needs an implementation of <code>EventPusher</code>. Now we can type-hint the <code>EventPusher</code> interface in our constructor:</p>
<div class="highlight"><pre><span></span>    <span class="cm">/**</span>
<span class="cm">     * Create a new order handler instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  EventPusher  $pusher</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">EventPusher</span> <span class="nx">$pusher</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">pusher</span> <span class="o">=</span> <span class="nx">$pusher</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>

<p><a name="contextual-binding"></a></p>

<h2>Contextual Binding</h2>

<p>Sometimes you may have two classes that utilize the same interface, but you wish to inject different implementations into each class. For example, when our system receives a new Order, we may want to send an event via <a href="http://www.pubnub.com/">PubNub</a> rather than Pusher. Laravel provides a simple, fluent interface for defining this behavior:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;App\Handlers\Commands\CreateOrderHandler&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="s1">&#39;App\Services\PubNubEventPusher&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="tagging"></a></p>

<h2>Tagging</h2>

<p>Occasionally, you may need to resolve all of a certain &quot;category&quot; of binding. For example, perhaps you are building a report aggregator that receives an array of many different <code>Report</code> interface implementations. After registering the <code>Report</code> implementations, you can assign them a tag using the <code>tag</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;MemoryReport&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">tag</span><span class="p">([</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="s1">&#39;MemoryReport&#39;</span><span class="p">],</span> <span class="s1">&#39;reports&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the services have been tagged, you may easily resolve them all via the <code>tagged</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ReportAggregator&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">ReportAggregator</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">tagged</span><span class="p">(</span><span class="s1">&#39;reports&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p><a name="practical-applications"></a></p>

<h2>Practical Applications</h2>

<p>Laravel provides several opportunities to use the service container to increase the flexibility and testability of your application. One primary example is when resolving controllers. All controllers are resolved through the service container, meaning you can type-hint dependencies in a controller constructor, and they will automatically be injected.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Repositories\OrderRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrdersController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The order repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$orders</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  OrderRepository  $orders</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">OrderRepository</span> <span class="nv">$orders</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">orders</span> <span class="o">=</span> <span class="nv">$orders</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show all of the orders.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$orders</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">orders</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;orders&#39;</span> <span class="o">=&gt;</span> <span class="nv">$orders</span><span class="p">]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In this example, the <code>OrderRepository</code> class will automatically be injected into the controller. This means that a &quot;mock&quot; <code>OrderRepository</code> may be bound into the container when <a href="/docs/%7B%7Bversion%7D%7D/testing">unit testing</a>, allowing for painless stubbing of database layer interaction.</p>

<h4>Other Examples Of Container Usage</h4>

<p>Of course, as mentioned above, controllers are not the only classes Laravel resolves via the service container. You may also type-hint dependencies on route Closures, filters, queue jobs, event listeners, and more. For examples of using the service container in these contexts, please refer to their documentation.</p>

<p><a name="container-events"></a></p>

<h2>Container Events</h2>

<h4>Registering A Resolving Listener</h4>

<p>The container fires an event each time it resolves an object. You may listen to this event using the <code>resolving</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$object</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Called when container resolves object of any type...</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">FooBar</span> <span class="nx">$fooBar</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Called when container resolves objects of type &quot;FooBar&quot;...</span>
<span class="p">});</span>
</pre></div>

<p>The object being resolved will be passed to the callback.</p>
<div style="page-break-after: always;" ></div><h1>Contracts</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#why-contracts">Why Contracts?</a></li>
<li><a href="#contract-reference">Contract Reference</a></li>
<li><a href="#how-to-use-contracts">How To Use Contracts</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s Contracts are a set of interfaces that define the core services provided by the framework. For example, a <code>Queue</code> contract defines the methods needed for queueing jobs, while the <code>Mailer</code> contract defines the methods needed for sending e-mail.</p>

<p>Each contract has a corresponding implementation provided by the framework. For example, Laravel provides a <code>Queue</code> implementation with a variety of drivers, and a <code>Mailer</code> implementation that is powered by <a href="http://swiftmailer.org/">SwiftMailer</a>.</p>

<p>All of the Laravel contracts live in <a href="https://github.com/illuminate/contracts">their own GitHub repository</a>. This provides a quick reference point for all available contracts, as well as a single, decoupled package that may be utilized by other package developers.</p>

<p><a name="why-contracts"></a></p>

<h2>Why Contracts?</h2>

<p>You may have several questions regarding contracts. Why use interfaces at all? Isn&#39;t using interfaces more complicated?</p>

<p>Let&#39;s distill the reasons for using interfaces to the following headings: loose coupling and simplicity.</p>

<h3>Loose Coupling</h3>

<p>First, let&#39;s review some code that is tightly coupled to a cache implementation. Consider the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The cache.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$cache</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \SomePackage\Cache\Memcached  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">\SomePackage\Cache\Memcached</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Retrieve an Order by ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Order</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nv">$id</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In this class, the code is tightly coupled to a given cache implementation. It is tightly coupled because we are depending on a concrete Cache class from a package vendor. If the API of that package changes our code must change as well.</p>

<p>Likewise, if we want to replace our underlying cache technology (Memcached) with another technology (Redis), we again will have to modify our repository. Our repository should not have so much knowledge regarding who is providing them data or how they are providing it.</p>

<p><strong>Instead of this approach, we can improve our code by depending on a simple, vendor agnostic interface:</strong></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Cache\Repository</span> <span class="k">as</span> <span class="nx">Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Cache  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Cache</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now the code is not coupled to any specific vendor, or even Laravel. Since the contracts package contains no implementation and no dependencies, you may easily write an alternative implementation of any given contract, allowing you to replace your cache implementation without modifying any of your cache consuming code.</p>

<h3>Simplicity</h3>

<p>When all of Laravel&#39;s services are neatly defined within simple interfaces, it is very easy to determine the functionality offered by a given service. <strong>The contracts serve as succinct documentation to the framework&#39;s features.</strong></p>

<p>In addition, when you depend on simple interfaces, your code is easier to understand and maintain. Rather than tracking down which methods are available to you within a large, complicated class, you can refer to a simple, clean interface.</p>

<p><a name="contract-reference"></a></p>

<h2>Contract Reference</h2>

<p>This is a reference to most Laravel Contracts, as well as their Laravel &quot;facade&quot; counterparts:</p>

<p>Contract  |  Laravel 4.x Facade
------------- | -------------
<a href="https://github.com/illuminate/contracts/blob/master/Auth/Guard.php">Illuminate\Contracts\Auth\Guard</a>  |  Auth
<a href="https://github.com/illuminate/contracts/blob/master/Auth/PasswordBroker.php">Illuminate\Contracts\Auth\PasswordBroker</a>  |  Password
<a href="https://github.com/illuminate/contracts/blob/master/Bus/Dispatcher.php">Illuminate\Contracts\Bus\Dispatcher</a>  |  Bus
<a href="https://github.com/illuminate/contracts/blob/master/Cache/Repository.php">Illuminate\Contracts\Cache\Repository</a> | Cache
<a href="https://github.com/illuminate/contracts/blob/master/Cache/Factory.php">Illuminate\Contracts\Cache\Factory</a> | Cache::driver()
<a href="https://github.com/illuminate/contracts/blob/master/Config/Repository.php">Illuminate\Contracts\Config\Repository</a> | Config
<a href="https://github.com/illuminate/contracts/blob/master/Container/Container.php">Illuminate\Contracts\Container\Container</a> | App
<a href="https://github.com/illuminate/contracts/blob/master/Cookie/Factory.php">Illuminate\Contracts\Cookie\Factory</a> | Cookie
<a href="https://github.com/illuminate/contracts/blob/master/Cookie/QueueingFactory.php">Illuminate\Contracts\Cookie\QueueingFactory</a> | Cookie::queue()
<a href="https://github.com/illuminate/contracts/blob/master/Encryption/Encrypter.php">Illuminate\Contracts\Encryption\Encrypter</a> | Crypt
<a href="https://github.com/illuminate/contracts/blob/master/Events/Dispatcher.php">Illuminate\Contracts\Events\Dispatcher</a> | Event
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Cloud.php">Illuminate\Contracts\Filesystem\Cloud</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Factory.php">Illuminate\Contracts\Filesystem\Factory</a> | File
<a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Filesystem.php">Illuminate\Contracts\Filesystem\Filesystem</a> | File
<a href="https://github.com/illuminate/contracts/blob/master/Foundation/Application.php">Illuminate\Contracts\Foundation\Application</a> | App
<a href="https://github.com/illuminate/contracts/blob/master/Hashing/Hasher.php">Illuminate\Contracts\Hashing\Hasher</a> | Hash
<a href="https://github.com/illuminate/contracts/blob/master/Logging/Log.php">Illuminate\Contracts\Logging\Log</a> | Log
<a href="https://github.com/illuminate/contracts/blob/master/Mail/MailQueue.php">Illuminate\Contracts\Mail\MailQueue</a> | Mail::queue()
<a href="https://github.com/illuminate/contracts/blob/master/Mail/Mailer.php">Illuminate\Contracts\Mail\Mailer</a> | Mail
<a href="https://github.com/illuminate/contracts/blob/master/Queue/Factory.php">Illuminate\Contracts\Queue\Factory</a> | Queue::driver()
<a href="https://github.com/illuminate/contracts/blob/master/Queue/Queue.php">Illuminate\Contracts\Queue\Queue</a> | Queue
<a href="https://github.com/illuminate/contracts/blob/master/Redis/Database.php">Illuminate\Contracts\Redis\Database</a> | Redis
<a href="https://github.com/illuminate/contracts/blob/master/Routing/Registrar.php">Illuminate\Contracts\Routing\Registrar</a> | Route
<a href="https://github.com/illuminate/contracts/blob/master/Routing/ResponseFactory.php">Illuminate\Contracts\Routing\ResponseFactory</a> | Response
<a href="https://github.com/illuminate/contracts/blob/master/Routing/UrlGenerator.php">Illuminate\Contracts\Routing\UrlGenerator</a> | URL
<a href="https://github.com/illuminate/contracts/blob/master/Support/Arrayable.php">Illuminate\Contracts\Support\Arrayable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Support/Jsonable.php">Illuminate\Contracts\Support\Jsonable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Support/Renderable.php">Illuminate\Contracts\Support\Renderable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/Validation/Factory.php">Illuminate\Contracts\Validation\Factory</a> | Validator::make()
<a href="https://github.com/illuminate/contracts/blob/master/Validation/Validator.php">Illuminate\Contracts\Validation\Validator</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/master/View/Factory.php">Illuminate\Contracts\View\Factory</a> | View::make()
<a href="https://github.com/illuminate/contracts/blob/master/View/View.php">Illuminate\Contracts\View\View</a> | &nbsp;</p>

<p><a name="how-to-use-contracts"></a></p>

<h2>How To Use Contracts</h2>

<p>So, how do you get an implementation of a contract? It&#39;s actually quite simple. Many types of classes in Laravel are resolved through the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, including controllers, event listeners, filters, queue jobs, and even route Closures. So, to get an implementation of a contract, you can just &quot;type-hint&quot; the interface in the constructor of the class being resolved. For example, take a look at this event handler:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Handlers\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\NewUserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Redis\Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheUserInformation</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The Redis database implementation.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$redis</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event handler instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Database  $redis</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$redis</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redis</span> <span class="o">=</span> <span class="nv">$redis</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  NewUserRegistered  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">NewUserRegistered</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>When the event listener is resolved, the service container will read the type-hints on the constructor of the class, and inject the appropriate value. To learn more about registering things in the service container, check out <a href="/docs/%7B%7Bversion%7D%7D/container">the documentation</a>.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guidelines</h1>

<p>If you are submitting documentation for the <strong>current stable release</strong>, submit it to the corresponding branch. For example, documentation for Laravel 5.0 would be submitted to the <code>5.0</code> branch. Documentation intended for the next release of Laravel should be submitted to the <code>master</code> branch.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guide</h1>

<ul>
<li><a href="#bug-reports">Bug Reports</a></li>
<li><a href="#core-development-discussion">Core Development Discussion</a></li>
<li><a href="#which-branch">Which Branch?</a></li>
<li><a href="#security-vulnerabilities">Security Vulnerabilities</a></li>
<li><a href="#coding-style">Coding Style</a></li>
</ul>

<p><a name="bug-reports"></a></p>

<h2>Bug Reports</h2>

<p>To encourage active collaboration, Laravel strongly encourages pull requests, not just bug reports. &quot;Bug reports&quot; may also be sent in the form of a pull request containing a failing unit test.</p>

<p>However, if you file a bug report, your issue should contain a title and a clear description of the issue. You should also include as much relevant information as possible and a code sample that demonstrates the issue. The goal of a bug report is to make it easy for yourself - and others - to replicate the bug and develop a fix.</p>

<p>Remember, bug reports are created in the hope that others with the same problem will be able to collaborate with you on solving it. Do not expect that the bug report will automatically see any activity or that others will jump to fix it. Creating a bug report serves to help yourself and others start on the path of fixing the problem.</p>

<p>The Laravel source code is managed on Github, and there are repositories for each of the Laravel projects:</p>

<ul>
<li><a href="https://github.com/laravel/framework">Laravel Framework</a></li>
<li><a href="https://github.com/laravel/laravel">Laravel Application</a></li>
<li><a href="https://github.com/laravel/docs">Laravel Documentation</a></li>
<li><a href="https://github.com/laravel/cashier">Laravel Cashier</a></li>
<li><a href="https://github.com/laravel/envoy">Laravel Envoy</a></li>
<li><a href="https://github.com/laravel/homestead">Laravel Homestead</a></li>
<li><a href="https://github.com/laravel/settler">Laravel Homestead Build Scripts</a></li>
<li><a href="https://github.com/laravel/laravel.com">Laravel Website</a></li>
<li><a href="https://github.com/laravel/art">Laravel Art</a></li>
</ul>

<p><a name="core-development-discussion"></a></p>

<h2>Core Development Discussion</h2>

<p>Discussion regarding bugs, new features, and implementation of existing features takes place in the <code>#laravel-dev</code> IRC channel (Freenode). Taylor Otwell, the maintainer of Laravel, is typically present in the channel on weekdays from 8am-5pm (UTC-06:00 or America/Chicago), and sporadically present in the channel at other times.</p>

<p>The <code>#laravel-dev</code> IRC channel is open to all. All are welcome to join the channel either to participate or simply observe the discussions!</p>

<p><a name="which-branch"></a></p>

<h2>Which Branch?</h2>

<p><strong>All</strong> bug fixes should be sent to the latest stable branch. Bug fixes should <strong>never</strong> be sent to the <code>master</code> branch unless they fix features that exist only in the upcoming release.</p>

<p><strong>Minor</strong> features that are <strong>fully backwards compatible</strong> with the current Laravel release may be sent to the latest stable branch.</p>

<p><strong>Major</strong> new features should always be sent to the <code>master</code> branch, which contains the upcoming Laravel release.</p>

<p>If you are unsure if your feature qualifies as a major or minor, please ask Taylor Otwell in the <code>#laravel-dev</code> IRC channel (Freenode).</p>

<p><a name="security-vulnerabilities"></a></p>

<h2>Security Vulnerabilities</h2>

<p>If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell at <a href="mailto:taylor@laravel.com">taylor@laravel.com</a>. All security vulnerabilities will be promptly addressed.</p>

<p><a name="coding-style"></a></p>

<h2>Coding Style</h2>

<p>Laravel follows the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md">PSR-4</a> and <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md">PSR-1</a> coding standards. In addition to these standards, the following coding standards should be followed:</p>

<ul>
<li>The class namespace declaration must be on the same line as <code>&lt;?php</code>.</li>
<li>A class&#39; opening <code>{</code> must be on the same line as the class name.</li>
<li>Functions and control structures must use Allman style braces.</li>
<li>Indent with tabs, align with spaces.</li>
</ul>
<div style="page-break-after: always;" ></div><h1>HTTP Controllers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-controllers">Basic Controllers</a></li>
<li><a href="#controller-middleware">Controller Middleware</a></li>
<li><a href="#implicit-controllers">Implicit Controllers</a></li>
<li><a href="#restful-resource-controllers">RESTful Resource Controllers</a></li>
<li><a href="#dependency-injection-and-controllers">Dependency Injection &amp; Controllers</a></li>
<li><a href="#route-caching">Route Caching</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Instead of defining all of your request handling logic in a single <code>routes.php</code> file, you may wish to organize this behavior using Controller classes. Controllers can group related HTTP request handling logic into a class. Controllers are typically stored in the <code>app/Http/Controllers</code> directory.</p>

<p><a name="basic-controllers"></a></p>

<h2>Basic Controllers</h2>

<p>Here is an example of a basic controller class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>We can route to the controller action like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All controllers should extend the base controller class.</p>
</blockquote>

<h4>Controllers &amp; Namespaces</h4>

<p>It is very important to note that we did not need to specify the full controller namespace, only the portion of the class name that comes after the <code>App\Http\Controllers</code> namespace &quot;root&quot;. By default, the <code>RouteServiceProvider</code> will load the <code>routes.php</code> file within a route group containing the root controller namespace.</p>

<p>If you choose to nest or organize your controllers using PHP namespaces deeper into the <code>App\Http\Controllers</code> directory, simply use the specific class name relative to the <code>App\Http\Controllers</code> root namespace. So, if your full controller class is <code>App\Http\Controllers\Photos\AdminController</code>, you would register a route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Photos\AdminController@method&#39;</span><span class="p">);</span>
</pre></div>

<h4>Naming Controller Routes</h4>

<p>Like Closure routes, you may specify names on controller routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;FooController@method&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</pre></div>

<h4>URLs To Controller Actions</h4>

<p>To generate a URL to a controller action, use the <code>action</code> helper method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\FooController@method&#39;</span><span class="p">);</span>
</pre></div>

<p>If you wish to generate a URL to a controller action while using only the portion of the class name relative to your controller namespace, register the root controller namespace with the URL generator:</p>
<div class="highlight"><pre><span></span><span class="nx">URL</span><span class="o">::</span><span class="nx">setRootControllerNamespace</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;FooController@method&#39;</span><span class="p">);</span>
</pre></div>

<p>You may access the name of the controller action being run using the <code>currentRouteAction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$action</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteAction</span><span class="p">();</span>
</pre></div>

<p><a name="controller-middleware"></a></p>

<h2>Controller Middleware</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a> may be specified on controller routes like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>Additionally, you may specify middleware within your controller&#39;s constructor:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new UserController instance.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;fooAction&#39;</span><span class="p">,</span> <span class="s1">&#39;barAction&#39;</span><span class="p">]]);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;subscribed&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;fooAction&#39;</span><span class="p">,</span> <span class="s1">&#39;barAction&#39;</span><span class="p">]]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="implicit-controllers"></a></p>

<h2>Implicit Controllers</h2>

<p>Laravel allows you to easily define a single route to handle every action in a controller. First, define the route using the <code>Route::controller</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>controller</code> method accepts two arguments. The first is the base URI the controller handles, while the second is the class name of the controller. Next, just add methods to your controller, prefixed with the HTTP verb they respond to:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">postProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">anyLogin</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>index</code> methods will respond to the root URI handled by the controller, which, in this case, is <code>users</code>.</p>

<p>If your controller action contains multiple words, you may access the action using &quot;dash&quot; syntax in the URI. For example, the following controller action on our <code>UserController</code> would respond to the <code>users/admin-profile</code> URI:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAdminProfile</span><span class="p">()</span> <span class="p">{}</span>
</pre></div>

<h4>Assigning Route Names</h4>

<p>If you would like to &quot;name&quot; some of the routes on the controller, you may pass a third argument to the <code>controller</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;anyLogin&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;user.login&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="restful-resource-controllers"></a></p>

<h2>RESTful Resource Controllers</h2>

<p>Resource controllers make it painless to build RESTful controllers around resources. For example, you may wish to create a controller that handles HTTP requests regarding &quot;photos&quot; stored by your application. Using the <code>make:controller</code> Artisan command, we can quickly create such a controller:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">PhotoController</span>
</pre></div>

<p>Next, we register a resourceful route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p>This single route declaration creates multiple routes to handle a variety of RESTful actions on the photo resource. Likewise, the generated controller will already have methods stubbed for each of these actions, including notes informing you which URIs and verbs they handle.</p>

<h4>Actions Handled By Resource Controller</h4>

<p>Verb      | Path                  | Action       | Route Name
----------|-----------------------|--------------|---------------------
GET       | /photo                | index        | photo.index
GET       | /photo/create         | create       | photo.create
POST      | /photo                | store        | photo.store
GET       | /photo/{photo}        | show         | photo.show
GET       | /photo/{photo}/edit   | edit         | photo.edit
PUT/PATCH | /photo/{photo}        | update       | photo.update
DELETE    | /photo/{photo}        | destroy      | photo.destroy</p>

<h4>Customizing Resource Routes</h4>

<p>Additionally, you may specify only a subset of actions to handle on the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]]);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">]]);</span>
</pre></div>

<p>By default, all resource controller actions have a route name; however, you can override these names by passing a <code>names</code> array with your options:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;photo.build&#39;</span><span class="p">]]);</span>
</pre></div>

<h4>Handling Nested Resource Controllers</h4>

<p>To &quot;nest&quot; resource controllers, use &quot;dot&quot; notation in your route declaration:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoCommentController&#39;</span><span class="p">);</span>
</pre></div>

<p>This route will register a &quot;nested&quot; resource that may be accessed with URLs like the following: <code>photos/{photos}/comments/{comments}</code>.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">PhotoCommentController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Show the specified photo comment.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  int  $photoId</span>
<span class="cm">     * @param  int  $commentId</span>
<span class="cm">     * @return Response</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">$photoId</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Adding Additional Routes To Resource Controllers</h4>

<p>If it becomes necessary to add additional routes to a resource controller beyond the default resource routes, you should define those routes before your call to <code>Route::resource</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;photos/popular&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController@method&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="dependency-injection-and-controllers"></a></p>

<h2>Dependency Injection &amp; Controllers</h2>

<h4>Constructor Injection</h4>

<p>The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> is used to resolve all Laravel controllers. As a result, you are able to type-hint any dependencies your controller may need in its constructor:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Repositories\UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Of course, you may also type-hint any <a href="/docs/%7B%7Bversion%7D%7D/contracts">Laravel contract</a>. If the container can resolve it, you can type-hint it.</p>

<h4>Method Injection</h4>

<p>In addition to constructor injection, you may also type-hint dependencies on your controller&#39;s methods. For example, let&#39;s type-hint the <code>Request</code> instance on one of our methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If your controller method is also expecting input from a route parameter, simply list your route arguments after your other dependencies:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the specified user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Method injection is fully compatible with <a href="/docs/%7B%7Bversion%7D%7D/routing#route-model-binding">model binding</a>. The container will intelligently determine which arguments are model bound and which arguments should be injected.</p>
</blockquote>

<p><a name="route-caching"></a></p>

<h2>Route Caching</h2>

<p>If your application is exclusively using controller routes, you may take advantage of Laravel&#39;s route cache. Using the route cache will drastically decrease the amount of time it take to register all of your application&#39;s routes. In some cases, your route registration may even be up to 100x faster! To generate a route cache, just execute the <code>route:cache</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>That&#39;s all there is to it! Your cached routes file will now be used instead of your <code>app/Http/routes.php</code> file. Remember, if you add any new routes you will need to generate a fresh route cache. Because of this, you may wish to only run the <code>route:cache</code> command during your project&#39;s deployment.</p>

<p>To remove the cached routes file without generating a new cache, use the <code>route:clear</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">clear</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Basic Database Usage</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#read-write-connections">Read / Write Connections</a></li>
<li><a href="#running-queries">Running Queries</a></li>
<li><a href="#database-transactions">Database Transactions</a></li>
<li><a href="#accessing-connections">Accessing Connections</a></li>
<li><a href="#query-logging">Query Logging</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel makes connecting with databases and running queries extremely simple. The database configuration file is <code>config/database.php</code>. In this file you may define all of your database connections, as well as specify which connection should be used by default. Examples for all of the supported database systems are provided in this file.</p>

<p>Currently Laravel supports four database systems: MySQL, Postgres, SQLite, and SQL Server.</p>

<p><a name="read-write-connections"></a></p>

<h2>Read / Write Connections</h2>

<p>Sometimes you may wish to use one database connection for SELECT statements, and another for INSERT, UPDATE, and DELETE statements. Laravel makes this a breeze, and the proper connections will always be used whether you are using raw queries, the query builder, or the Eloquent ORM.</p>

<p>To see how read / write connections should be configured, let&#39;s look at this example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mysql&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;read&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;write&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;196.168.1.2&#39;</span>
    <span class="p">],</span>
    <span class="s1">&#39;driver&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;charset&#39;</span>   <span class="p">=&gt;</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;collation&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;utf8_unicode_ci&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prefix&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Note that two keys have been added to the configuration array: <code>read</code> and <code>write</code>. Both of these keys have array values containing a single key: <code>host</code>. The rest of the database options for the <code>read</code> and <code>write</code> connections will be merged from the main <code>mysql</code> array. So, we only need to place items in the <code>read</code> and <code>write</code> arrays if we wish to override the values in the main array. So, in this case, <code>192.168.1.1</code> will be used as the &quot;read&quot; connection, while <code>192.168.1.2</code> will be used as the &quot;write&quot; connection. The database credentials, prefix, character set, and all other options in the main <code>mysql</code> array will be shared across both connections.</p>

<p><a name="running-queries"></a></p>

<h2>Running Queries</h2>

<p>Once you have configured your database connection, you may run queries using the <code>DB</code> facade.</p>

<h4>Running A Select Query</h4>
<div class="highlight"><pre><span></span><span class="nx">$results</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;select * from users where id = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>The <code>select</code> method will always return an <code>array</code> of results.</p>

<p>You may also execute a query using named bindings:</p>
<div class="highlight"><pre><span></span><span class="nx">$results</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;select * from users where id = :id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Running An Insert Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">insert</span><span class="p">(</span><span class="s1">&#39;insert into users (id, name) values (?, ?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running An Update Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;update users set votes = 100 where name = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running A Delete Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;delete from users&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>update</code> and <code>delete</code> statements return the number of rows affected by the operation.</p>
</blockquote>

<h4>Running A General Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">statement</span><span class="p">(</span><span class="s1">&#39;drop table users&#39;</span><span class="p">);</span>
</pre></div>

<h4>Listening For Query Events</h4>

<p>You may listen for query events using the <code>DB::listen</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$sql</span><span class="p">,</span> <span class="nx">$bindings</span><span class="p">,</span> <span class="nx">$time</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="database-transactions"></a></p>

<h2>Database Transactions</h2>

<p>To run a set of operations within a database transaction, you may use the <code>transaction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Any exception thrown within the <code>transaction</code> closure will cause the transaction to be rolled back automatically.</p>
</blockquote>

<p>Sometimes you may need to begin a transaction yourself:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">beginTransaction</span><span class="p">();</span>
</pre></div>

<p>You can rollback a transaction via the <code>rollback</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">rollback</span><span class="p">();</span>
</pre></div>

<p>Lastly, you can commit a transaction via the <code>commit</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>

<p><a name="accessing-connections"></a></p>

<h2>Accessing Connections</h2>

<p>When using multiple connections, you may access them via the <code>DB::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(...);</span>
</pre></div>

<p>You may also access the raw, underlying PDO instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$pdo</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">getPdo</span><span class="p">();</span>
</pre></div>

<p>Sometimes you may need to reconnect to a given database:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">reconnect</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to disconnect from the given database due to exceeding the underlying PDO instance&#39;s <code>max_connections</code> limit, use the <code>disconnect</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">disconnect</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="query-logging"></a></p>

<h2>Query Logging</h2>

<p>Laravel can optionally log in memory all queries that have been run for the current request. Be aware that in some cases, such as when inserting a large number of rows, this can cause the application to use excess memory. To enable the log, you may use the <code>enableQueryLog</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">enableQueryLog</span><span class="p">();</span>
</pre></div>

<p>To get an array of the executed queries, you may use the <code>getQueryLog</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$queries</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">getQueryLog</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><ul>
<li>## Prologue

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/releases">Release Notes</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/upgrade">Upgrade Guide</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contributions">Contribution Guide</a></li>
</ul></li>
<li>## Setup

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/installation">Installation</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/configuration">Configuration</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a></li>
</ul></li>
<li>## The Basics

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/routing">Routing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/controllers">Controllers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/requests">Requests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/responses">Responses</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/views">Views</a></li>
</ul></li>
<li>## Architecture Foundations

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/providers">Service Providers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/container">Service Container</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contracts">Contracts</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/facades">Facades</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/lifecycle">Request Lifecycle</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/structure">Application Structure</a></li>
</ul></li>
<li>## Services

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/authentication">Authentication</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/billing">Billing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/cache">Cache</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/collections">Collections</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/bus">Command Bus</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/extending">Core Extension</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/elixir">Elixir</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/encryption">Encryption</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/envoy">Envoy</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/errors">Errors &amp; Logging</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/events">Events</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/filesystem">Filesystem / Cloud Storage</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/hashing">Hashing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/helpers">Helpers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/localization">Localization</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/mail">Mail</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/packages">Package Development</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/pagination">Pagination</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queues">Queues</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/session">Session</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/templates">Templates</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/testing">Unit Testing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/validation">Validation</a></li>
</ul></li>
<li>## Database

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/database">Basic Usage</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queries">Query Builder</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/schema">Schema Builder</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/migrations">Migrations &amp; Seeding</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a></li>
</ul></li>
<li>## Artisan CLI

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/artisan">Overview</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/commands">Development</a></li>
</ul></li>
</ul>
<div style="page-break-after: always;" ></div><h1>Laravel Elixir</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation &amp; Setup</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#gulp">Gulp</a></li>
<li><a href="#extensions">Extensions</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Elixir provides a clean, fluent API for defining basic <a href="http://gulpjs.com">Gulp</a> tasks for your Laravel application. Elixir supports several common CSS and JavaScript pre-processors, and even testing tools.</p>

<p>If you&#39;ve ever been confused about how to get started with Gulp and asset compilation, you will love Laravel Elixir!</p>

<p><a name="installation"></a></p>

<h2>Installation &amp; Setup</h2>

<h3>Installing Node</h3>

<p>Before triggering Elixir, you must first ensure that Node.js is installed on your machine.</p>
<div class="highlight"><pre><span></span><span class="nx">node</span> <span class="o">-</span><span class="nx">v</span>
</pre></div>

<p>By default, Laravel Homestead includes everything you need; however, if you aren&#39;t using Vagrant, then you can easily install Node by visiting <a href="http://nodejs.org/download/">their download page</a>. Don&#39;t worry, it&#39;s quick and easy!</p>

<h3>Gulp</h3>

<p>Next, you&#39;ll want to pull in <a href="http://gulpjs.com">Gulp</a> as a global NPM package like so:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">global</span> <span class="nx">gulp</span>
</pre></div>

<h3>Laravel Elixir</h3>

<p>The only remaining step is to install Elixir! With a new install of Laravel, you&#39;ll find a <code>package.json</code> file in the root. Think of this like your <code>composer.json</code> file, except it defines Node dependencies instead of PHP. You may install the dependencies it references by running:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<p>Now that you&#39;ve installed Elixir, you&#39;ll be compiling and concatenating in no time! The <code>gulpfile.js</code> file in your project&#39;s root directory contains all of your Elixir tasks.</p>

<h4>Compile Less</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s2">&quot;app.less&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>In the example above, Elixir assumes that your Less files are stored in <code>resources/assets/less</code>.</p>

<h4>Compile Multiple Less Files</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">([</span>
        <span class="s1">&#39;app.less&#39;</span><span class="p">,</span>
        <span class="s1">&#39;something-else.less&#39;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Compile Sass</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s2">&quot;app.scss&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>This assumes that your Sass files are stored in <code>resources/assets/sass</code>.</p>

<p>By default, Elixir, underneath the hood, uses the LibSass library for compilation. In some instances, it might prove advantageous to instead leverage the Ruby version, which, though slower, is more feature rich. Assuming that you have both Ruby and the Sass gem installed (<code>gem install sass</code>), you may enable Ruby-mode, like so:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">rubySass</span><span class="p">(</span><span class="s2">&quot;app.sass&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Compile Without Source Maps</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">sourcemaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s2">&quot;app.scss&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Source maps are enabled out of the box. As such, for each file that is compiled, you&#39;ll find a companion <code>*.css.map</code> file in the same directory. This mapping allows you to, when debugging, trace your compiled stylesheet selectors  back to your original Sass or Less partials! Should you need to disable this functionality, however, the code sample above will do the trick.</p>

<h4>Compile CoffeeScript</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">coffee</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>This assumes that your CoffeeScript files are stored in <code>resources/assets/coffee</code>.</p>

<h4>Compile All Less and CoffeeScript</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">()</span>
       <span class="p">.</span><span class="nx">coffee</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Trigger PHPUnit Tests</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">phpUnit</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Trigger PHPSpec Tests</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">phpSpec</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Combine Stylesheets</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
        <span class="s2">&quot;normalize.css&quot;</span><span class="p">,</span>
        <span class="s2">&quot;main.css&quot;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Paths passed to this method are relative to the <code>resources/assets/css</code> directory.</p>

<h4>Combine Stylesheets and Save to a Custom Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
        <span class="s2">&quot;normalize.css&quot;</span><span class="p">,</span>
        <span class="s2">&quot;main.css&quot;</span>
    <span class="p">],</span> <span class="s1">&#39;public/build/css/everything.css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Combine Stylesheets From A Custom Base Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
        <span class="s2">&quot;normalize.css&quot;</span><span class="p">,</span>
        <span class="s2">&quot;main.css&quot;</span>
    <span class="p">],</span> <span class="s1">&#39;public/build/css/everything.css&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The third argument to both the <code>styles</code> and <code>scripts</code> methods determines the relative directory for all paths passed to the methods.</p>

<h4>Combine All Styles in a Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">stylesIn</span><span class="p">(</span><span class="s2">&quot;public/css&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Combine Scripts</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scripts</span><span class="p">([</span>
        <span class="s2">&quot;jquery.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;app.js&quot;</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>Again, this assumes all paths are relative to the <code>resources/assets/js</code> directory.</p>

<h4>Combine All Scripts in a Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scriptsIn</span><span class="p">(</span><span class="s2">&quot;public/js/some/directory&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Combine Multiple Sets of Scripts</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">scripts</span><span class="p">([</span><span class="s1">&#39;jquery.js&#39;</span><span class="p">,</span> <span class="s1">&#39;main.js&#39;</span><span class="p">],</span> <span class="s1">&#39;public/js/main.js&#39;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">scripts</span><span class="p">([</span><span class="s1">&#39;forum.js&#39;</span><span class="p">,</span> <span class="s1">&#39;threads.js&#39;</span><span class="p">],</span> <span class="s1">&#39;public/js/forum.js&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Version / Hash A File</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="s2">&quot;css/all.css&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>This will append a unique hash to the filename, allowing for cache-busting. For example, the generated file name will look something like: <code>all-16d570a7.css</code>.</p>

<p>Within your views, you may use the <code>elixir()</code> function to load the appropriately hashed asset. Here&#39;s an example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&quot;</span><span class="nx">css</span><span class="o">/</span><span class="nx">all</span><span class="p">.</span><span class="nx">css</span><span class="s2">&quot;) }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>Behind the scenes, the <code>elixir()</code> function will determine the name of the hashed file that should be included. Don&#39;t you feel the weight lifting off your shoulders already?</p>

<p>You may also pass an array to the <code>version</code> method to version multiple files:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">version</span><span class="p">([</span><span class="s2">&quot;css/all.css&quot;</span><span class="p">,</span> <span class="s2">&quot;js/app.js&quot;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&quot;</span><span class="nx">css</span><span class="o">/</span><span class="nx">all</span><span class="p">.</span><span class="nx">css</span><span class="s2">&quot;) }}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;{{ elixir(&quot;</span><span class="nx">js</span><span class="o">/</span><span class="nx">app</span><span class="p">.</span><span class="nx">js</span><span class="s2">&quot;) }}&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<h4>Copy a File to a New Location</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;vendor/foo/bar.css&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css/bar.css&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Copy an Entire Directory to a New Location</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;vendor/package/views&#39;</span><span class="p">,</span> <span class="s1">&#39;resources/views&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Trigger Browserify</h4>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">browserify</span><span class="p">(</span><span class="s1">&#39;index.js&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Want to require modules in the browser? Hoping to use EcmaScript 6 sooner than later? Need a built-in JSX transformer? If so, <a href="http://browserify.org/">Browserify</a>, along with the <code>browserify</code> Elixir task, will handle the job nicely.</p>

<p>This task assumes that your scripts are stored in <code>resources/assets/js</code>, though you&#39;re free to override the default.</p>

<h4>Method Chaining</h4>

<p>Of course, you may chain almost all of Elixir&#39;s methods together to build your recipe:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s2">&quot;app.less&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">coffee</span><span class="p">()</span>
       <span class="p">.</span><span class="nx">phpUnit</span><span class="p">()</span>
       <span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="s2">&quot;css/bootstrap.css&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="gulp"></a></p>

<h2>Gulp</h2>

<p>Now that you&#39;ve told Elixir which tasks to execute, you only need to trigger Gulp from the command line.</p>

<h4>Execute All Registered Tasks Once</h4>
<div class="highlight"><pre><span></span><span class="nx">gulp</span>
</pre></div>

<h4>Watch Assets For Changes</h4>
<div class="highlight"><pre><span></span><span class="nx">gulp</span> <span class="nx">watch</span>
</pre></div>

<h4>Only Compile Scripts</h4>
<div class="highlight"><pre><span></span><span class="nx">gulp</span> <span class="nx">scripts</span>
</pre></div>

<h4>Only Compile Styles</h4>
<div class="highlight"><pre><span></span><span class="nx">gulp</span> <span class="nx">styles</span>
</pre></div>

<h4>Watch Tests And PHP Classes for Changes</h4>
<div class="highlight"><pre><span></span><span class="nx">gulp</span> <span class="nx">tdd</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All tasks will assume a development environment, and will exclude minification. For production, use <code>gulp --production</code>.</p>
</blockquote>

<p><a name="extensions"></a></p>

<h2>Custom Tasks and Extensions</h2>

<p>Sometimes, you&#39;ll want to hook your own Gulp tasks into Elixir. Perhaps you have a special bit of functionality that you&#39;d like Elixir to mix and watch for you. No problem!</p>

<p>As an example, imagine that you have a general task that simply speaks a bit of text when called.</p>
<div class="highlight"><pre><span></span><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">&quot;speak&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">&quot;Tea...Earl Grey...Hot&quot;</span><span class="p">;</span>

    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shell</span><span class="p">(</span><span class="s2">&quot;say &quot;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>Easy enough. From the command line, you may, of course, call <code>gulp speak</code> to trigger the task. To add it to Elixir, however, use the <code>mix.task()</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>That&#39;s it! Now, each time you run Gulp, your custom &quot;speak&quot; task will be executed alongside any other Elixir tasks that you&#39;ve mixed in. To additionally register a watcher, so that your custom tasks will be re-triggered each time one or more files are modified, you may pass a regular expression as the second argument.</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">,</span> <span class="s1">&#39;app/**/*.php&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>By adding this second argument, we&#39;ve instructed Elixir to re-trigger the &quot;speak&quot; task each time a PHP file in the &quot;app/&quot; directory is saved.</p>

<p>For even more flexibility, you can create full Elixir extensions. Using the previous &quot;speak&quot; example, you may write an extension, like so:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gulp&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gulp-shell&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">elixir</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;laravel-elixir&quot;</span><span class="p">);</span>

<span class="nx">elixir</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;speak&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">&quot;speak&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shell</span><span class="p">(</span><span class="s2">&quot;say &quot;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">queueTask</span><span class="p">(</span><span class="s2">&quot;speak&quot;</span><span class="p">);</span>

 <span class="p">});</span>
</pre></div>

<p>Notice that we <code>extend</code> Elixir&#39;s API by passing the name that we will reference within our Gulpfile, as well as a callback function that will create the Gulp task.</p>

<p>As before, if you want your custom task to be monitored, then register a watcher.</p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">registerWatcher</span><span class="p">(</span><span class="s2">&quot;speak&quot;</span><span class="p">,</span> <span class="s2">&quot;app/**/*.php&quot;</span><span class="p">);</span>
</pre></div>

<p>This lines designates that when any file that matches the regular expression, <code>app/**/*.php</code>, is modified, we want to trigger the <code>speak</code> task.</p>

<p>That&#39;s it! You may either place this at the top of your Gulpfile, or instead extract it to a custom tasks file. If you choose the latter approach, simply require it into your Gulpfile, like so:</p>
<div class="highlight"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./custom-tasks&quot;</span><span class="p">)</span>
</pre></div>

<p>You&#39;re done! Now, you can mix it in.</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mix</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="s2">&quot;Tea, Earl Grey, Hot&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>With this addition, each time you trigger Gulp, Picard will request some tea.</p>
<div style="page-break-after: always;" ></div><h1>Eloquent ORM</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#mass-assignment">Mass Assignment</a></li>
<li><a href="#insert-update-delete">Insert, Update, Delete</a></li>
<li><a href="#soft-deleting">Soft Deleting</a></li>
<li><a href="#timestamps">Timestamps</a></li>
<li><a href="#query-scopes">Query Scopes</a></li>
<li><a href="#global-scopes">Global Scopes</a></li>
<li><a href="#relationships">Relationships</a></li>
<li><a href="#querying-relations">Querying Relations</a></li>
<li><a href="#eager-loading">Eager Loading</a></li>
<li><a href="#inserting-related-models">Inserting Related Models</a></li>
<li><a href="#touching-parent-timestamps">Touching Parent Timestamps</a></li>
<li><a href="#working-with-pivot-tables">Working With Pivot Tables</a></li>
<li><a href="#collections">Collections</a></li>
<li><a href="#accessors-and-mutators">Accessors &amp; Mutators</a></li>
<li><a href="#date-mutators">Date Mutators</a></li>
<li><a href="#attribute-casting">Attribute Casting</a></li>
<li><a href="#model-events">Model Events</a></li>
<li><a href="#model-observers">Model Observers</a></li>
<li><a href="#model-url-generation">Model URL Generation</a></li>
<li><a href="#converting-to-arrays-or-json">Converting To Arrays / JSON</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &quot;Model&quot; which is used to interact with that table.</p>

<p>Before getting started, be sure to configure a database connection in <code>config/database.php</code>.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>To get started, create an Eloquent model. Models typically live in the <code>app</code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code>composer.json</code> file. All Eloquent models extend <code>Illuminate\Database\Eloquent\Model</code>.</p>

<h4>Defining An Eloquent Model</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{}</span>
</pre></div>

<p>You may also generate Eloquent models using the <code>make:model</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">User</span>
</pre></div>

<p>Note that we did not tell Eloquent which table to use for our <code>User</code> model. The &quot;snake case&quot;, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Eloquent will assume the <code>User</code> model stores records in the <code>users</code> table. You may specify a custom table by defining a <code>table</code> property on your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$table</span> <span class="o">=</span> <span class="s1">&#39;my_users&#39;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Eloquent will also assume that each table has a primary key column named <code>id</code>. You may define a <code>primaryKey</code> property to override this convention. Likewise, you may define a <code>connection</code> property to override the name of the database connection that should be used when utilizing the model.</p>
</blockquote>

<p>Once a model is defined, you are ready to start retrieving and creating records in your table. Note that you will need to place <code>updated_at</code> and <code>created_at</code> columns on your table by default. If you do not wish to have these columns automatically maintained, set the <code>$timestamps</code> property on your model to <code>false</code>.</p>

<h4>Retrieving All Records</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Retrieving A Record By Primary Key</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All methods available on the <a href="/docs/queries">query builder</a> are also available when querying Eloquent models.</p>
</blockquote>

<h4>Retrieving A Model By Primary Key Or Throw An Exception</h4>

<p>Sometimes you may wish to throw an exception if a model is not found. To do this, you may use the <code>firstOrFail</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
</pre></div>

<p>Doing this will let you catch the exception so you can log and display an error page as necessary. To catch the <code>ModelNotFoundException</code>, add some logic to your <code>app/Exceptions/Handler.php</code> file.</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">ModelNotFoundException</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Handler</span> <span class="kr">extends</span> <span class="nx">ExceptionHandler</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nx">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$e</span> <span class="k">instanceof</span> <span class="nx">ModelNotFoundException</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Custom logic for model not found...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">parent</span><span class="o">::</span><span class="nx">render</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">$e</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Querying Using Eloquent Models</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Eloquent Aggregates</h4>

<p>Of course, you may also use the query builder aggregate functions.</p>
<div class="highlight"><pre><span></span><span class="nx">$count</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>
</pre></div>

<p>If you are unable to generate the query you need via the fluent interface, feel free to use <code>whereRaw</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;age &gt; ? and votes = 100&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Chunking Results</h4>

<p>If you need to process a lot (thousands) of Eloquent records, using the <code>chunk</code> command will allow you to do without eating all of your RAM:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the method is the number of records you wish to receive per &quot;chunk&quot;. The Closure passed as the second argument will be called for each chunk that is pulled from the database.</p>

<h4>Specifying The Query Connection</h4>

<p>You may also specify which database connection should be used when running an Eloquent query. Simply use the <code>on</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection-name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>If you are using <a href="/docs/%7B%7Bversion%7D%7D/database#read-write-connections">read / write connections</a>, you may force the query to use the &quot;write&quot; connection with the following method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">onWriteConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p><a name="mass-assignment"></a></p>

<h2>Mass Assignment</h2>

<p>When creating a new model, you pass an array of attributes to the model constructor. These attributes are then assigned to the model via mass-assignment. This is convenient; however, can be a <strong>serious</strong> security concern when blindly passing user input into a model. If user input is blindly passed into a model, the user is free to modify <strong>any</strong> and <strong>all</strong> of the model&#39;s attributes. For this reason, all Eloquent models protect against mass-assignment by default.</p>

<p>To get started, set the <code>fillable</code> or <code>guarded</code> properties on your model.</p>

<h4>Defining Fillable Attributes On A Model</h4>

<p>The <code>fillable</code> property specifies which attributes should be mass-assignable. This can be set at the class or instance level.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<p>In this example, only the three listed attributes will be mass-assignable.</p>

<h4>Defining Guarded Attributes On A Model</h4>

<p>The inverse of <code>fillable</code> is <code>guarded</code>, and serves as a &quot;black-list&quot; instead of a &quot;white-list&quot;:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When using <code>guarded</code>, you should still never pass <code>Input::get()</code> or any raw array of user controlled input into a <code>save</code> or <code>update</code> method, as any column that is not guarded may be updated.</p>
</blockquote>

<h4>Blocking All Attributes From Mass Assignment</h4>

<p>In the example above, the <code>id</code> and <code>password</code> attributes may <strong>not</strong> be mass assigned. All other attributes will be mass assignable. You may also block <strong>all</strong> attributes from mass assignment using the guard property:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">];</span>
</pre></div>

<p><a name="insert-update-delete"></a></p>

<h2>Insert, Update, Delete</h2>

<p>To create a new record in the database from a model, simply create a new model instance and call the <code>save</code> method.</p>

<h4>Saving A New Model</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Typically, your Eloquent models will have auto-incrementing keys. However, if you wish to specify your own keys, set the <code>incrementing</code> property on your model to <code>false</code>.</p>
</blockquote>

<p>You may also use the <code>create</code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code>fillable</code> or <code>guarded</code> attribute on the model, as all Eloquent models protect against mass-assignment.</p>

<p>After saving or creating a new model that uses auto-incrementing IDs, you may retrieve the ID by accessing the object&#39;s <code>id</code> attribute:</p>
<div class="highlight"><pre><span></span><span class="nx">$insertedId</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>
</pre></div>

<h4>Setting The Guarded Attributes On The Model</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<h4>Using The Model Create Method</h4>
<div class="highlight"><pre><span></span><span class="c1">// Create a new user in the database...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>

<span class="c1">// Retrieve the user by the attributes, or create it if it doesn&#39;t exist...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">firstOrCreate</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>

<span class="c1">// Retrieve the user by the attributes, or instantiate a new instance...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">firstOrNew</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Updating A Retrieved Model</h4>

<p>To update a model, you may retrieve it, change an attribute, and use the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span> <span class="o">=</span> <span class="s1">&#39;john@foo.com&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h4>Saving A Model And Relationships</h4>

<p>Sometimes you may wish to save not only a model, but also all of its relationships. To do so, you may use the <code>push</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">();</span>
</pre></div>

<p>You may also run updates as queries against a set of models:</p>
<div class="highlight"><pre><span></span><span class="nx">$affectedRows</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;status&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> No model events are fired when updating a set of models via the Eloquent query builder.</p>
</blockquote>

<h4>Deleting An Existing Model</h4>

<p>To delete a model, simply call the <code>delete</code> method on the instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting An Existing Model By Key</h4>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></div>

<p>Of course, you may also run a delete query on a set of models:</p>
<div class="highlight"><pre><span></span><span class="nx">$affectedRows</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Updating Only The Model&#39;s Timestamps</h4>

<p>If you wish to simply update the timestamps on a model, you may use the <code>touch</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">touch</span><span class="p">();</span>
</pre></div>

<p><a name="soft-deleting"></a></p>

<h2>Soft Deleting</h2>

<p>When soft deleting a model, it is not actually removed from your database. Instead, a <code>deleted_at</code> timestamp is set on the record. To enable soft deletes for a model, apply the <code>SoftDeletes</code> to the model:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">SoftDeletes</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">SoftDeletes</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<p>To add a <code>deleted_at</code> column to your table, you may use the <code>softDeletes</code> method from a migration:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">softDeletes</span><span class="p">();</span>
</pre></div>

<p>Now, when you call the <code>delete</code> method on the model, the <code>deleted_at</code> column will be set to the current timestamp. When querying a model that uses soft deletes, the &quot;deleted&quot; models will not be included in query results.</p>

<h4>Forcing Soft Deleted Models Into Results</h4>

<p>To force soft deleted models to appear in a result set, use the <code>withTrashed</code> method on the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>withTrashed</code> method may be used on a defined relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you wish to <strong>only</strong> receive soft deleted models in your results, you may use the <code>onlyTrashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">onlyTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>To restore a soft deleted model into an active state, use the <code>restore</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>restore</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>Like with <code>withTrashed</code>, the <code>restore</code> method may also be used on relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>If you wish to truly remove a model from the database, you may use the <code>forceDelete</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p>The <code>forceDelete</code> method also works on relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p>To determine if a given model instance has been soft deleted, you may use the <code>trashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trashed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="timestamps"></a></p>

<h2>Timestamps</h2>

<p>By default, Eloquent will maintain the <code>created_at</code> and <code>updated_at</code> columns on your database table automatically. Simply add these <code>timestamp</code> columns to your table and Eloquent will take care of the rest. If you do not wish for Eloquent to maintain these columns, add the following property to your model:</p>

<h4>Disabling Auto Timestamps</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$table</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span><span class="p">;</span>

    <span class="kr">public</span> <span class="nx">$timestamps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

<h4>Providing A Custom Timestamp Format</h4>

<p>If you wish to customize the format of your timestamps, you may override the <code>getDateFormat</code> method in your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="kd">function</span> <span class="nx">getDateFormat</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="query-scopes"></a></p>

<h2>Query Scopes</h2>

<h4>Defining A Query Scope</h4>

<p>Scopes allow you to easily re-use query logic in your models. To define a scope, simply prefix a model method with <code>scope</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopePopular</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopeWomen</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">whereGender</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Utilizing A Query Scope</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">women</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Dynamic Scopes</h4>

<p>Sometimes you may wish to define a scope that accepts parameters. Just add your parameters to your scope function:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopeOfType</span><span class="p">(</span><span class="nx">$query</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">whereType</span><span class="p">(</span><span class="nx">$type</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Then pass the parameter into the scope call:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">ofType</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="global-scopes"></a></p>

<h2>Global Scopes</h2>

<p>Sometimes you may wish to define a scope that applies to all queries performed on a model. In essence, this is how Eloquent&#39;s own &quot;soft delete&quot; feature works. Global scopes are defined using a combination of PHP traits and an implementation of <code>Illuminate\Database\Eloquent\ScopeInterface</code>.</p>

<p>First, let&#39;s define a trait. For this example, we&#39;ll use the <code>SoftDeletes</code> that ships with Laravel:</p>
<div class="highlight"><pre><span></span><span class="nx">trait</span> <span class="nx">SoftDeletes</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Boot the soft deleting trait for a model.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">bootSoftDeletes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kr">static</span><span class="o">::</span><span class="nx">addGlobalScope</span><span class="p">(</span><span class="k">new</span> <span class="nx">SoftDeletingScope</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If an Eloquent model uses a trait that has a method matching the <code>bootNameOfTrait</code> naming convention, that trait method will be called when the Eloquent model is booted, giving you an opportunity to register a global scope, or do anything else you want. A scope must implement <code>ScopeInterface</code>, which specifies two methods: <code>apply</code> and <code>remove</code>.</p>

<p>The <code>apply</code> method receives an <code>Illuminate\Database\Eloquent\Builder</code> query builder object and the <code>Model</code> it&#39;s applied to, and is responsible for adding any additional <code>where</code> clauses that the scope wishes to add. The <code>remove</code> method also receives a <code>Builder</code> object and <code>Model</code> and is responsible for reversing the action taken by <code>apply</code>. In other words, <code>remove</code> should remove the <code>where</code> clause (or any other clause) that was added. So, for our <code>SoftDeletingScope</code>, the methods look something like this:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Apply the scope to a given Eloquent query builder.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Builder  $builder</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">apply</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">,</span> <span class="nx">Model</span> <span class="nx">$model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="nx">$model</span><span class="o">-&gt;</span><span class="nx">getQualifiedDeletedAtColumn</span><span class="p">());</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$builder</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Remove the scope from the given Eloquent query builder.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Builder  $builder</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">,</span> <span class="nx">Model</span> <span class="nx">$model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$column</span> <span class="o">=</span> <span class="nx">$model</span><span class="o">-&gt;</span><span class="nx">getQualifiedDeletedAtColumn</span><span class="p">();</span>

    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">getQuery</span><span class="p">();</span>

    <span class="nx">foreach</span> <span class="p">((</span><span class="nx">array</span><span class="p">)</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span> <span class="nx">as</span> <span class="nx">$key</span> <span class="p">=&gt;</span> <span class="nx">$where</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// If the where clause is a soft delete date constraint, we will remove it from</span>
        <span class="c1">// the query and reset the keys on the wheres. This allows this developer to</span>
        <span class="c1">// include deleted model in a relationship result set that is lazy loaded.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">isSoftDeleteConstraint</span><span class="p">(</span><span class="nx">$where</span><span class="p">,</span> <span class="nx">$column</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nx">unset</span><span class="p">(</span><span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span><span class="p">[</span><span class="nx">$key</span><span class="p">]);</span>

            <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="relationships"></a></p>

<h2>Relationships</h2>

<p>Of course, your database tables are probably related to one another. For example, a blog post may have many comments, or an order could be related to the user who placed it. Eloquent makes managing and working with these relationships easy. Laravel supports many types of relationships:</p>

<ul>
<li><a href="#one-to-one">One To One</a></li>
<li><a href="#one-to-many">One To Many</a></li>
<li><a href="#many-to-many">Many To Many</a></li>
<li><a href="#has-many-through">Has Many Through</a></li>
<li><a href="#polymorphic-relations">Polymorphic Relations</a></li>
<li><a href="#many-to-many-polymorphic-relations">Many To Many Polymorphic Relations</a></li>
</ul>

<p><a name="one-to-one"></a></p>

<h3>One To One</h3>

<h4>Defining A One To One Relation</h4>

<p>A one-to-one relationship is a very basic relation. For example, a <code>User</code> model might have one <code>Phone</code>. We can define this relation in Eloquent:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">phone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasOne</code> method is the name of the related model. Once the relationship is defined, we may retrieve it using Eloquent&#39;s <a href="#dynamic-properties">dynamic properties</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$phone</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">phone</span><span class="p">;</span>
</pre></div>

<p>The SQL performed by this statement will be as follows:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">phones</span> <span class="nx">where</span> <span class="nx">user_id</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>Take note that Eloquent assumes the foreign key of the relationship based on the model name. In this case, <code>Phone</code> model is assumed to use a <code>user_id</code> foreign key. If you wish to override this convention, you may pass a second argument to the <code>hasOne</code> method. Furthermore, you may pass a third argument to the method to specify which local column that should be used for the association:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of A Relation</h4>

<p>To define the inverse of the relationship on the <code>Phone</code> model, we use the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In the example above, Eloquent will look for a <code>user_id</code> column on the <code>phones</code> table. If you would like to define a different foreign key column, you may pass it as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Additionally, you pass a third parameter which specifies the name of the associated column on the parent table:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_key&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="one-to-many"></a></p>

<h3>One To Many</h3>

<p>An example of a one-to-many relation is a blog post that &quot;has many&quot; comments. We can model this relation like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now we can access the post&#39;s comments through the <a href="#dynamic-properties">dynamic property</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">;</span>
</pre></div>

<p>If you need to add further constraints to which comments are retrieved, you may call the <code>comments</code> method and continue chaining conditions:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<p>Again, you may override the conventional foreign key by passing a second argument to the <code>hasMany</code> method. And, like the <code>hasOne</code> relation, the local column may also be specified:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of A Relation</h4>

<p>To define the inverse of the relationship on the <code>Comment</code> model, we use the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Comment</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="many-to-many"></a></p>

<h3>Many To Many</h3>

<p>Many-to-many relations are a more complicated relationship type. An example of such a relationship is a user with many roles, where the roles are also shared by other users. For example, many users may have the role of &quot;Admin&quot;. Three database tables are needed for this relationship: <code>users</code>, <code>roles</code>, and <code>role_user</code>. The <code>role_user</code> table is derived from the alphabetical order of the related model names, and should have <code>user_id</code> and <code>role_id</code> columns.</p>

<p>We can define a many-to-many relation using the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">roles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, we can retrieve the roles through the <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>
</pre></div>

<p>If you would like to use an unconventional table name for your pivot table, you may pass it as the second argument to the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also override the conventional associated keys:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;foo_id&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, you may also define the inverse of the relationship on the <code>Role</code> model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Role</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="has-many-through"></a></p>

<h3>Has Many Through</h3>

<p>The &quot;has many through&quot; relation provides a convenient short-cut for accessing distant relations via an intermediate relation. For example, a <code>Country</code> model might have many <code>Post</code> through a <code>User</code> model. The tables for this relationship would look like this:</p>
<div class="highlight"><pre><span></span><span class="nx">countries</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">country_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">user_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Even though the <code>posts</code> table does not contain a <code>country_id</code> column, the <code>hasManyThrough</code> relation will allow us to access a country&#39;s posts via <code>$country-&gt;posts</code>. Let&#39;s define the relationship:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If you would like to manually specify the keys of the relationship, you may pass them as the third and fourth arguments to the method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="polymorphic-relations"></a></p>

<h3>Polymorphic Relations</h3>

<p>Polymorphic relations allow a model to belong to more than one other model, on a single association. For example, you might have a photo model that belongs to either a staff model or an order model. We would define this relation like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Photo</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">imageable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphTo</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Staff</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Order</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Retrieving A Polymorphic Relation</h4>

<p>Now, we can retrieve the photos for either a staff member or an order:</p>
<div class="highlight"><pre><span></span><span class="nx">$staff</span> <span class="o">=</span> <span class="nx">Staff</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$staff</span><span class="o">-&gt;</span><span class="nx">photos</span> <span class="nx">as</span> <span class="nx">$photo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Owner Of A Polymorphic Relation</h4>

<p>However, the true &quot;polymorphic&quot; magic is when you access the staff or order from the <code>Photo</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$photo</span> <span class="o">=</span> <span class="nx">Photo</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$imageable</span> <span class="o">=</span> <span class="nx">$photo</span><span class="o">-&gt;</span><span class="nx">imageable</span><span class="p">;</span>
</pre></div>

<p>The <code>imageable</code> relation on the <code>Photo</code> model will return either a <code>Staff</code> or <code>Order</code> instance, depending on which type of model owns the photo.</p>

<h4>Polymorphic Relation Table Structure</h4>

<p>To help understand how this works, let&#39;s explore the database structure for a polymorphic relation:</p>
<div class="highlight"><pre><span></span><span class="nx">staff</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">orders</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">price</span> <span class="o">-</span> <span class="nx">integer</span>

<span class="nx">photos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">path</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">imageable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">imageable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>The key fields to notice here are the <code>imageable_id</code> and <code>imageable_type</code> on the <code>photos</code> table. The ID will contain the ID value of, in this example, the owning staff or order, while the type will contain the class name of the owning model. This is what allows the ORM to determine which type of owning model to return when accessing the <code>imageable</code> relation.</p>

<p><a name="many-to-many-polymorphic-relations"></a></p>

<h3>Many To Many Polymorphic Relations</h3>

<h4>Polymorphic Many To Many Relation Table Structure</h4>

<p>In addition to traditional polymorphic relations, you may also specify many-to-many polymorphic relations. For example, a blog <code>Post</code> and <code>Video</code> model could share a polymorphic relation to a <code>Tag</code> model. First, let&#39;s examine the table structure:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">videos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">tags</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">taggables</span>
    <span class="nx">tag_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Next, we&#39;re ready to setup the relationships on the model. The <code>Post</code> and <code>Video</code> model will both have a <code>morphToMany</code> relationship via a <code>tags</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">tags</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphToMany</span><span class="p">(</span><span class="s1">&#39;App\Tag&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>Tag</code> model may define a method for each of its relationships:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Tag</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">videos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Video&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="querying-relations"></a></p>

<h2>Querying Relations</h2>

<h4>Querying Relations When Selecting</h4>

<p>When accessing the records for a model, you may wish to limit your results based on the existence of a relationship. For example, you wish to pull all blog posts that have at least one comment. To do so, you may use the <code>has</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify an operator and a count:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Nested <code>has</code> statements may also be constructed using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments.votes&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need even more power, you may use the <code>whereHas</code> and <code>orWhereHas</code> methods to put &quot;where&quot; conditions on your <code>has</code> queries:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$q</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$q</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>

<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="dynamic-properties"></a></p>

<h3>Dynamic Properties</h3>

<p>Eloquent allows you to access your relations via dynamic properties. Eloquent will automatically load the relationship for you, and is even smart enough to know whether to call the <code>get</code> (for one-to-many relationships) or <code>first</code> (for one-to-one relationships) method.  It will then be accessible via a dynamic property by the same name as the relation. For example, with the following model <code>$phone</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="nx">$phone</span> <span class="o">=</span> <span class="nx">Phone</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>Instead of echoing the user&#39;s email like this:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$phone</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
</pre></div>

<p>It may be shortened to simply:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$phone</span><span class="o">-&gt;</span><span class="nx">user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Relationships that return many results will return an instance of the <code>Illuminate\Database\Eloquent\Collection</code> class.</p>
</blockquote>

<p><a name="eager-loading"></a></p>

<h2>Eager Loading</h2>

<p>Eager loading exists to alleviate the N + 1 query problem. For example, consider a <code>Book</code> model that is related to <code>Author</code>. The relationship is defined like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Book</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">author</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Author&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, consider the following code:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This loop will execute 1 query to retrieve all of the books on the table, then another query for each book to retrieve the author. So, if we have 25 books, this loop would run 26 queries.</p>

<p>Thankfully, we can use eager loading to drastically reduce the number of queries. The relationships that should be eager loaded may be specified via the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>In the loop above, only two queries will be executed:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">books</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">authors</span> <span class="nx">where</span> <span class="nx">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>

<p>Wise use of eager loading can drastically increase the performance of your application.</p>

<p>Of course, you may eager load multiple relationships at one time:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may even eager load nested relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author.contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In the example above, the <code>author</code> relationship will be eager loaded, and the author&#39;s <code>contacts</code> relation will also be loaded.</p>

<h3>Eager Load Constraints</h3>

<p>Sometimes you may wish to eager load a relationship, but also specify a condition for the eager load. Here&#39;s an example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;%first%&#39;</span><span class="p">);</span>

<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In this example, we&#39;re eager loading the user&#39;s posts, but only if the post&#39;s title column contains the word &quot;first&quot;.</p>

<p>Of course, eager loading Closures aren&#39;t limited to &quot;constraints&quot;. You may also apply orders:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>

<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h3>Lazy Eager Loading</h3>

<p>It is also possible to eagerly load related models directly from an already existing model collection. This may be useful when dynamically deciding whether to load related models or not, or in combination with caching.</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also pass a Closure to set constraints on the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">([</span><span class="s1">&#39;author&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">);</span>
<span class="p">}]);</span>
</pre></div>

<p><a name="inserting-related-models"></a></p>

<h2>Inserting Related Models</h2>

<h4>Attaching A Related Model</h4>

<p>You will often need to insert new related models. For example, you may wish to insert a new comment for a post. Instead of manually setting the <code>post_id</code> foreign key on the model, you may insert the new comment from its parent <code>Post</code> model directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]);</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>
</pre></div>

<p>In this example, the <code>post_id</code> field will automatically be set on the inserted comment.</p>

<p>If you need to save multiple related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Another comment.&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The latest comment.&#39;</span><span class="p">])</span>
<span class="p">];</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">saveMany</span><span class="p">(</span><span class="nx">$comments</span><span class="p">);</span>
</pre></div>

<h3>Associating Models (Belongs To)</h3>

<p>When updating a <code>belongsTo</code> relationship, you may use the <code>associate</code> method. This method will set the foreign key on the child model:</p>
<div class="highlight"><pre><span></span><span class="nx">$account</span> <span class="o">=</span> <span class="nx">Account</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">associate</span><span class="p">(</span><span class="nx">$account</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h3>Inserting Related Models (Many To Many)</h3>

<p>You may also insert related models when working with many-to-many relations. Let&#39;s continue using our <code>User</code> and <code>Role</code> models as examples. We can easily attach new roles to a user using the <code>attach</code> method:</p>

<h4>Attaching Many To Many Models</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>You may also pass an array of attributes that should be stored on the pivot table for the relation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<p>Of course, the opposite of <code>attach</code> is <code>detach</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>Both <code>attach</code> and <code>detach</code> also take arrays of IDs as input:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;attribute1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value1&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Using Sync To Attach Many To Many Models</h4>

<p>You may also use the <code>sync</code> method to attach related models. The <code>sync</code> method accepts an array of IDs to place on the pivot table. After this operation is complete, only the IDs in the array will be on the intermediate table for the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Adding Pivot Data When Syncing</h4>

<p>You may also associate other pivot table values with the given IDs:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]]);</span>
</pre></div>

<p>Sometimes you may wish to create a new related model and attach it in a single command. For this operation, you may use the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$role</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Editor&#39;</span><span class="p">]);</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">);</span>
</pre></div>

<p>In this example, the new <code>Role</code> model will be saved and attached to the user model. You may also pass an array of attributes to place on the joining table for this operation:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<p><a name="touching-parent-timestamps"></a></p>

<h2>Touching Parent Timestamps</h2>

<p>When a model <code>belongsTo</code> another model, such as a <code>Comment</code> which belongs to a <code>Post</code>, it is often helpful to update the parent&#39;s timestamp when the child model is updated. For example, when a <code>Comment</code> model is updated, you may want to automatically touch the <code>updated_at</code> timestamp of the owning <code>Post</code>. Eloquent makes it easy. Just add a <code>touches</code> property containing the names of the relationships to the child model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Comment</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$touches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">];</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, when you update a <code>Comment</code>, the owning <code>Post</code> will have its <code>updated_at</code> column updated:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;Edit to this comment!&#39;</span><span class="p">;</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="working-with-pivot-tables"></a></p>

<h2>Working With Pivot Tables</h2>

<p>As you have already learned, working with many-to-many relations requires the presence of an intermediate table. Eloquent provides some very helpful ways of interacting with this table. For example, let&#39;s assume our <code>User</code> object has many <code>Role</code> objects that it is related to. After accessing this relationship, we may access the <code>pivot</code> table on the models:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">pivot</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Notice that each <code>Role</code> model we retrieve is automatically assigned a <code>pivot</code> attribute. This attribute contains a model representing the intermediate table, and may be used as any other Eloquent model.</p>

<p>By default, only the keys will be present on the <code>pivot</code> object. If your pivot table contains extra attributes, you must specify them when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withPivot</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
</pre></div>

<p>Now the <code>foo</code> and <code>bar</code> attributes will be accessible on our <code>pivot</code> object for the <code>Role</code> model.</p>

<p>If you want your pivot table to have automatically maintained <code>created_at</code> and <code>updated_at</code> timestamps, use the <code>withTimestamps</code> method on the relationship definition:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withTimestamps</span><span class="p">();</span>
</pre></div>

<h4>Deleting Records On A Pivot Table</h4>

<p>To delete all records on the pivot table for a model, you may use the <code>detach</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">();</span>
</pre></div>

<p>Note that this operation does not delete records from the <code>roles</code> table, but only from the pivot table.</p>

<h4>Updating A Record On A Pivot Table</h4>

<p>Sometimes you may need to update your pivot table, but not detach it. If you wish to update your pivot table in place you may use <code>updateExistingPivot</code> method like so:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateExistingPivot</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">,</span> <span class="nx">$attributes</span><span class="p">);</span>
</pre></div>

<h4>Defining A Custom Pivot Model</h4>

<p>Laravel also allows you to define a custom Pivot model. To define a custom model, first create your own &quot;Base&quot; model class that extends <code>Eloquent</code>. In your other Eloquent models, extend this custom base model instead of the default <code>Eloquent</code> base. In your base model, add the following function that returns an instance of your custom Pivot model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">newPivot</span><span class="p">(</span><span class="nx">Model</span> <span class="nx">$parent</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$exists</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">YourCustomPivot</span><span class="p">(</span><span class="nx">$parent</span><span class="p">,</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$exists</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="collections"></a></p>

<h2>Collections</h2>

<p>All multi-result sets returned by Eloquent, either via the <code>get</code> method or a <code>relationship</code>, will return a collection object. This object implements the <code>IteratorAggregate</code> PHP interface so it can be iterated over like an array. However, this object also has a variety of other helpful methods for working with result sets.</p>

<h4>Checking If A Collection Contains A Key</h4>

<p>For example, we may determine if a result set contains a given primary key using the <code>contains</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Collections may also be converted to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>
</pre></div>

<p>If a collection is cast to a string, it will be returned as JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>
</pre></div>

<h4>Iterating Collections</h4>

<p>Eloquent collections also contain a few helpful methods for looping and filtering the items they contain:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Filtering Collections</h4>

<p>When filtering collections, the callback provided will be used as callback for <a href="http://php.net/manual/en/function.array-filter.php">array_filter</a>.</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When filtering a collection and converting it to JSON, try calling the <code>values</code> function first to reset the array&#39;s keys.</p>
</blockquote>

<h4>Applying A Callback To Each Collection Object</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>

<span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Sorting A Collection By A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortByDesc</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Sorting A Collection By A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>

<span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortByDesc</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Custom Collection Type</h4>

<p>Sometimes, you may wish to return a custom Collection object with your own added methods. You may specify this on your Eloquent model by overriding the <code>newCollection</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">newCollection</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$models</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomCollection</span><span class="p">(</span><span class="nx">$models</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="accessors-and-mutators"></a></p>

<h2>Accessors &amp; Mutators</h2>

<h4>Defining An Accessor</h4>

<p>Eloquent provides a convenient way to transform your model attributes when getting or setting them. Simply define a <code>getFooAttribute</code> method on your model to declare an accessor. Keep in mind that the methods should follow camel-casing, even though your database columns are snake-case:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getFirstNameAttribute</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In the example above, the <code>first_name</code> column has an accessor. Note that the value of the attribute is passed to the accessor.</p>

<h4>Defining A Mutator</h4>

<p>Mutators are declared in a similar fashion:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">setFirstNameAttribute</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="date-mutators"></a></p>

<h2>Date Mutators</h2>

<p>By default, Eloquent will convert the <code>created_at</code> and <code>updated_at</code> columns to instances of <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, which provides an assortment of helpful methods, and extends the native PHP <code>DateTime</code> class.</p>

<p>You may customize which fields are automatically mutated, and even completely disable this mutation, by overriding the <code>getDates</code> method of the model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getDates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>When a column is considered a date, you may set its value to a UNIX timestamp, date string (<code>Y-m-d</code>), date-time string, and of course a <code>DateTime</code> / <code>Carbon</code> instance.</p>

<p>To totally disable date mutations, simply return an empty array from the <code>getDates</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getDates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[];</span>
<span class="p">}</span>
</pre></div>

<p><a name="attribute-casting"></a></p>

<h2>Attribute Casting</h2>

<p>If you have some attributes that you want to always convert to another data-type, you may add the attribute to the <code>casts</code> property of your model. Otherwise, you will have to define a mutator for each of the attributes, which can be time consuming. Here is an example of using the <code>casts</code> property:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The attributes that should be casted to native types.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;is_admin&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Now the <code>is_admin</code> attribute will always be cast to a boolean when you access it, even if the underlying value is stored in the database as an integer. Other supported cast types are: <code>integer</code>, <code>real</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>boolean</code>, <code>object</code> and <code>array</code>.</p>

<p>The <code>array</code> cast is particularly useful for working with columns that are stored as serialized JSON. For example, if your database has a TEXT type field that contains serialized JSON, adding the <code>array</code> cast to that attribute will automatically deserialize the attribute to a PHP array when you access it on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The attributes that should be casted to native types.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;options&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Now, when you utilize the Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// $options is an array...</span>
<span class="nx">$options</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span><span class="p">;</span>

<span class="c1">// options is automatically serialized back to JSON...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">];</span>
</pre></div>

<p><a name="model-events"></a></p>

<h2>Model Events</h2>

<p>Eloquent models fire several events, allowing you to hook into various points in the model&#39;s lifecycle using the following methods: <code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>, <code>restoring</code>, <code>restored</code>.</p>

<p>Whenever a new item is saved for the first time, the <code>creating</code> and <code>created</code> events will fire. If an item is not new and the <code>save</code> method is called, the <code>updating</code> / <code>updated</code> events will fire. In both cases, the <code>saving</code> / <code>saved</code> events will fire.</p>

<h4>Cancelling Save Operations Via Events</h4>

<p>If <code>false</code> is returned from the <code>creating</code>, <code>updating</code>, <code>saving</code>, or <code>deleting</code> events, the action will be cancelled:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">creating</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Where To Register Event Listeners</h4>

<p>Your <code>EventServiceProvider</code> serves as a convenient place to register your model event bindings. For example:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Contracts\Events\Dispatcher  $events</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">DispatcherContract</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$events</span><span class="p">);</span>

    <span class="nx">User</span><span class="o">::</span><span class="nx">creating</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="model-observers"></a></p>

<h2>Model Observers</h2>

<p>To consolidate the handling of model events, you may register a model observer. An observer class may have methods that correspond to the various model events. For example, <code>creating</code>, <code>updating</code>, <code>saving</code> methods may be on an observer, in addition to any other model event name.</p>

<p>So, for example, a model observer might look like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserObserver</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">saving</span><span class="p">(</span><span class="nx">$model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">saved</span><span class="p">(</span><span class="nx">$model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may register an observer instance using the <code>observe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">observe</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserObserver</span><span class="p">);</span>
</pre></div>

<p><a name="model-url-generation"></a></p>

<h2>Model URL Generation</h2>

<p>When you pass a model to the <code>route</code> or <code>action</code> methods, it&#39;s primary key is inserted into the generated URI. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{user}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@show&#39;</span><span class="p">);</span>

<span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$user</span><span class="p">]);</span>
</pre></div>

<p>In this example the <code>$user-&gt;id</code> property will be inserted into the <code>{user}</code> place-holder of the generated URL. However, if you would like to use another property instead of the ID, you may override the <code>getRouteKey</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRouteKey</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">slug</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="converting-to-arrays-or-json"></a></p>

<h2>Converting To Arrays / JSON</h2>

<h4>Converting A Model To An Array</h4>

<p>When building JSON APIs, you may often need to convert your models and relationships to arrays or JSON. So, Eloquent includes methods for doing so. To convert a model and its loaded relationship to an array, you may use the <code>toArray</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p>Note that entire collections of models may also be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<h4>Converting A Model To JSON</h4>

<p>To convert a model to JSON, you may use the <code>toJson</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>
</pre></div>

<h4>Returning A Model From A Route</h4>

<p>Note that when a model or collection is cast to a string, it will be converted to JSON, meaning you can return Eloquent objects directly from your application&#39;s routes!</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Hiding Attributes From Array Or JSON Conversion</h4>

<p>Sometimes you may wish to limit the attributes that are included in your model&#39;s array or JSON form, such as passwords. To do so, add a <code>hidden</code> property definition to your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When hiding relationships, use the relationship&#39;s <strong>method</strong> name, not the dynamic accessor name.</p>
</blockquote>

<p>Alternatively, you may use the <code>visible</code> property to define a white-list:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$visible</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">];</span>
</pre></div>

<p><a name="array-appends"></a>
Occasionally, you may need to add array attributes that do not have a corresponding column in your database. To do so, simply define an accessor for the value:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIsAdminAttribute</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Once you have created the accessor, just add the value to the <code>appends</code> property on the model:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_admin&#39;</span><span class="p">];</span>
</pre></div>

<p>Once the attribute has been added to the <code>appends</code> list, it will be included in both the model&#39;s array and JSON forms. Attributes in the <code>appends</code> array respect the <code>visible</code> and <code>hidden</code> configuration on the model.</p>
<div style="page-break-after: always;" ></div><h1>Encryption</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides facilities for strong AES encryption via the Mcrypt PHP extension.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Encrypting A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$encrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">encrypt</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Be sure to set a 16, 24, or 32 character random string in the <code>key</code> option of the <code>config/app.php</code> file. Otherwise, encrypted values will not be secure.</p>
</blockquote>

<h4>Decrypting A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$decrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">$encryptedValue</span><span class="p">);</span>
</pre></div>

<h4>Setting The Cipher &amp; Mode</h4>

<p>You may also set the cipher and mode used by the encrypter:</p>
<div class="highlight"><pre><span></span><span class="nx">Crypt</span><span class="o">::</span><span class="nx">setMode</span><span class="p">(</span><span class="s1">&#39;ctr&#39;</span><span class="p">);</span>

<span class="nx">Crypt</span><span class="o">::</span><span class="nx">setCipher</span><span class="p">(</span><span class="nx">$cipher</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Envoy Task Runner</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#envoy-installation">Installation</a></li>
<li><a href="#envoy-running-tasks">Running Tasks</a></li>
<li><a href="#envoy-multiple-servers">Multiple Servers</a></li>
<li><a href="#envoy-parallel-execution">Parallel Execution</a></li>
<li><a href="#envoy-task-macros">Task Macros</a></li>
<li><a href="#envoy-notifications">Notifications</a></li>
<li><a href="#envoy-updating-envoy">Updating Envoy</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="https://github.com/laravel/envoy">Laravel Envoy</a> provides a clean, minimal syntax for defining common tasks you run on your remote servers. Using a Blade style syntax, you can easily setup tasks for deployment, Artisan commands, and more.</p>

<blockquote>
<p><strong>Note:</strong> Envoy requires PHP version 5.4 or greater, and only runs on Mac / Linux operating systems.</p>
</blockquote>

<p><a name="envoy-installation"></a></p>

<h2>Installation</h2>

<p>First, install Envoy using the Composer <code>global</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/envoy=~1.0&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>envoy</code> executable is found when you run the <code>envoy</code> command in your terminal.</p>

<p>Next, create an <code>Envoy.blade.php</code> file in the root of your project. Here&#39;s an example to get you started:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>As you can see, an array of <code>@servers</code> is defined at the top of the file. You can reference these servers in the <code>on</code> option of your task declarations. Within your <code>@task</code> declarations you should place the Bash code that will be run on your server when the task is executed.</p>

<p>The <code>init</code> command may be used to easily create a stub Envoy file:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">init</span> <span class="nx">user</span><span class="err">@</span><span class="mf">192.168.1.1</span>
</pre></div>

<p><a name="envoy-running-tasks"></a></p>

<h2>Running Tasks</h2>

<p>To run a task, use the <code>run</code> command of your Envoy installation:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">foo</span>
</pre></div>

<p>If needed, you may pass variables into the Envoy file using command line switches:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span> <span class="o">--</span><span class="nx">branch</span><span class="o">=</span><span class="nx">master</span>
</pre></div>

<p>You may use the options via the Blade syntax you are used to:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<h4>Bootstrapping</h4>

<p>You may use the <code>@setup</code> directive to declare variables and do general PHP work inside the Envoy file:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">setup</span>
    <span class="nx">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>

    <span class="nx">$environment</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$env</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$env</span> <span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">endsetup</span>
</pre></div>

<p>You may also use <code>@include</code> to include any PHP files:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">);</span>
</pre></div>

<h4>Confirming Tasks Before Running</h4>

<p>If you would like to be prompted for confirmation before running a given task on your servers, you may use the <code>confirm</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;confirm&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="envoy-multiple-servers"></a></p>

<h2>Multiple Servers</h2>

<p>You may easily run a task across multiple servers. Simply list the servers in the task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">]])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>By default, the task will be executed on each server serially. Meaning, the task will finish running on the first server before proceeding to execute on the next server.</p>

<p><a name="envoy-parallel-execution"></a></p>

<h2>Parallel Execution</h2>

<p>If you would like to run a task across multiple servers in parallel, simply add the <code>parallel</code> option to your task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">],</span> <span class="s1">&#39;parallel&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="envoy-task-macros"></a></p>

<h2>Task Macros</h2>

<p>Macros allow you to define a set of tasks to be run in sequence using a single command. For instance:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
    <span class="nx">foo</span>
    <span class="nx">bar</span>
<span class="err">@</span><span class="nx">endmacro</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="nx">echo</span> <span class="s2">&quot;HELLO&quot;</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="nx">echo</span> <span class="s2">&quot;WORLD&quot;</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>The <code>deploy</code> macro can now be run via a single, simple command:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span>
</pre></div>

<p><a name="envoy-notifications"></a>
<a name="envoy-hipchat-notifications"></a></p>

<h2>Notifications</h2>

<h4>HipChat</h4>

<p>After running a task, you may send a notification to your team&#39;s HipChat room using the simple <code>@hipchat</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>You can also specify a custom message to the hipchat room. Any variables declared in <code>@setup</code> or included with <code>@include</code> will be available for use in the message:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">,</span> <span class="s2">&quot;$task ran on [$environment]&quot;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>This is an amazingly simple way to keep your team notified of the tasks being run on the server.</p>

<h4>Slack</h4>

<p>The following syntax may be used to send a notification to <a href="https://slack.com">Slack</a>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">slack</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>You may retrieve your webhook URL by creating an <code>Incoming WebHooks</code> integration on Slack&#39;s website. The <code>hook</code> argument should be the entire webhook URL provided by the Incoming Webhooks Slack Integration. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//hooks.slack.com/services/ZZZZZZZZZ/YYYYYYYYY/XXXXXXXXXXXXXXX</span>
</pre></div>

<p>You may provide one of the following for the channel argument:</p>

<ul>
<li>To send the notification to a channel: <code>#channel</code></li>
<li>To send the notification to a user: <code>@user</code></li>
</ul>

<p>If no <code>channel</code> argument is provided the default channel will be used.</p>

<blockquote>
<p>Note: Slack notifications will only be sent if all tasks complete successfully.</p>
</blockquote>

<p><a name="envoy-updating-envoy"></a></p>

<h2>Updating Envoy</h2>

<p>To update Envoy, simply use Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">update</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Errors &amp; Logging</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#handling-errors">Handling Errors</a></li>
<li><a href="#http-exceptions">HTTP Exceptions</a></li>
<li><a href="#logging">Logging</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The logging facilities for your application are configured in the <code>Illuminate\Foundation\Bootstrap\ConfigureLogging</code> bootstrapper class. This class utilizes the <code>log</code> configuration option from your <code>config/app.php</code> configuration file.</p>

<p>By default, the logger is configured to use daily log files; however, you may customize this behavior as needed. Since Laravel uses the popular <a href="https://github.com/Seldaek/monolog">Monolog</a> logging library, you can take advantage of the variety of handlers that Monolog offers.</p>

<p>For example, if you wish to use a single log file instead of daily files, you can make the following change to your <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;log&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;single&#39;</span>
</pre></div>

<p>Out of the box, Laravel supported <code>single</code>, <code>daily</code>, <code>syslog</code> and <code>errorlog</code> logging modes. However, you are free to customize the logging for your application as you wish by overriding the <code>ConfigureLogging</code> bootstrapper class.</p>

<h3>Error Detail</h3>

<p>The amount of error detail your application displays through the browser is controlled by the <code>app.debug</code> configuration option in your <code>config/app.php</code> configuration file. By default, this configuration option is set to respect the <code>APP_DEBUG</code> environment variable, which is stored in your <code>.env</code> file.</p>

<p>For local development, you should set the <code>APP_DEBUG</code> environment variable to <code>true</code>. <strong>In your production environment, this value should always be <code>false</code>.</strong></p>

<p><a name="handling-errors"></a></p>

<h2>Handling Errors</h2>

<p>All exceptions are handled by the <code>App\Exceptions\Handler</code> class. This class contains two methods: <code>report</code> and <code>render</code>.</p>

<p>The <code>report</code> method is used to log exceptions or send them to an external service like <a href="https://bugsnag.com">BugSnag</a>. By default, the <code>report</code> method simply passes the exception to the base implementation on the parent class where the exception is logged. However, you are free to log exceptions however you wish. If you need to report different types of exceptions in different ways, you may use the PHP <code>instanceof</code> comparison operator:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Report or log an exception.</span>
<span class="cm"> *</span>
<span class="cm"> * This is a great spot to send exceptions to Sentry, Bugsnag, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Exception  $e</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">report</span><span class="p">(</span><span class="nx">Exception</span> <span class="nx">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$e</span> <span class="k">instanceof</span> <span class="nx">CustomException</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">parent</span><span class="o">::</span><span class="nx">report</span><span class="p">(</span><span class="nx">$e</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>render</code> method is responsible for converting the exception into an HTTP response that should be sent back to the browser. By default, the exception is passed to the base class which generates a response for you. However, you are free to check the exception type or return your own custom response.</p>

<p>The <code>dontReport</code> property of the exception handler contains an array of exception types that will not be logged. By default, exceptions resulting from 404 errors are not written to your log files. You may add other exception types to this array as needed.</p>

<p><a name="http-exceptions"></a></p>

<h2>HTTP Exceptions</h2>

<p>Some exceptions describe HTTP error codes from the server. For example, this may be a &quot;page not found&quot; error (404), an &quot;unauthorized error&quot; (401) or even a developer generated 500 error. In order to return such a response, use the following:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>Optionally, you may provide a response:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
</pre></div>

<p>This method may be used at any time during the request&#39;s lifecycle.</p>

<h3>Custom 404 Error Page</h3>

<p>To return a custom view for all 404 errors, create a <code>resources/views/errors/404.blade.php</code> file. This view will be served on all 404 errors generated by your application.</p>

<p><a name="logging"></a></p>

<h2>Logging</h2>

<p>The Laravel logging facilities provide a simple layer on top of the powerful <a href="http://github.com/seldaek/monolog">Monolog</a> library. By default, Laravel is configured to create daily log files for your application which are stored in the <code>storage/logs</code> directory. You may write information to the log like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;This is some useful information.&#39;</span><span class="p">);</span>

<span class="nx">Log</span><span class="o">::</span><span class="nx">warning</span><span class="p">(</span><span class="s1">&#39;Something could be going wrong.&#39;</span><span class="p">);</span>

<span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something is really going wrong.&#39;</span><span class="p">);</span>
</pre></div>

<p>The logger provides the seven logging levels defined in <a href="http://tools.ietf.org/html/rfc5424">RFC 5424</a>: <strong>debug</strong>, <strong>info</strong>, <strong>notice</strong>, <strong>warning</strong>, <strong>error</strong>, <strong>critical</strong>, and <strong>alert</strong>.</p>

<p>An array of contextual data may also be passed to the log methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Log message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;context&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Other helpful information&#39;</span><span class="p">]);</span>
</pre></div>

<p>Monolog has a variety of additional handlers you may use for logging. If needed, you may access the underlying Monolog instance being used by Laravel:</p>
<div class="highlight"><pre><span></span><span class="nx">$monolog</span> <span class="o">=</span> <span class="nx">Log</span><span class="o">::</span><span class="nx">getMonolog</span><span class="p">();</span>
</pre></div>

<p>You may also register an event to catch all messages passed to the log:</p>

<h4>Registering A Log Event Listener</h4>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$level</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Events</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#queued-event-handlers">Queued Event Handlers</a></li>
<li><a href="#event-subscribers">Event Subscribers</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>The Laravel event facilities provides a simple observer implementation, allowing you to subscribe and listen for events in your application. Event classes are typically stored in the <code>app/Events</code> directory, while their handlers are stored in <code>app/Handlers/Events</code>.</p>

<p>You can generate a new event class using the Artisan CLI tool:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">event</span> <span class="nx">PodcastWasPurchased</span>
</pre></div>

<h4>Subscribing To An Event</h4>

<p>The <code>EventServiceProvider</code> included with your Laravel application provides a convenient place to register all event handlers. The <code>listen</code> property contains an array of all events (keys) and their handlers (values). Of course, you may add as many events to this array as your application requires. For example, let&#39;s add our <code>PodcastWasPurchased</code> event:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event handler mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;App\Events\PodcastWasPurchased&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Handlers\Events\EmailPurchaseConfirmation&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p>To generate a handler for an event, use the <code>handler:event</code> Artisan CLI command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">handler</span><span class="o">:</span><span class="nx">event</span> <span class="nx">EmailPurchaseConfirmation</span> <span class="o">--</span><span class="nx">event</span><span class="o">=</span><span class="nx">PodcastWasPurchased</span>
</pre></div>

<p>Of course, manually running the <code>make:event</code> and <code>handler:event</code> commands each time you need a handler or event is cumbersome. Instead, simply add handlers and events to your <code>EventServiceProvider</code> and use the <code>event:generate</code> command. This command will generate any events or handlers that are listed in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">event</span><span class="o">:</span><span class="nx">generate</span>
</pre></div>

<h4>Firing An Event</h4>

<p>Now we are ready to fire our event using the <code>Event</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p>The <code>fire</code> method returns an array of responses that you can use to control what happens next in your application.</p>

<p>You may also use the <code>event</code> helper to fire an event:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<h4>Closure Listeners</h4>

<p>You can even listen to events without creating a separate handler class at all. For example, in the <code>boot</code> method of your <code>EventServiceProvider</code>, you could do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;App\Events\PodcastWasPurchased&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Handle the event...</span>
<span class="p">});</span>
</pre></div>

<h4>Stopping The Propagation Of An Event</h4>

<p>Sometimes, you may wish to stop the propagation of an event to other listeners. You may do so using by returning <code>false</code> from your handler:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;App\Events\PodcastWasPurchased&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Handle the event...</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="queued-event-handlers"></a></p>

<h2>Queued Event Handlers</h2>

<p>Need to <a href="/docs/%7B%7Bversion%7D%7D/queues">queue</a> an event handler? It couldn&#39;t be any easier. When generating the handler, simply use the <code>--queued</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">handler</span><span class="o">:</span><span class="nx">event</span> <span class="nx">SendPurchaseConfirmation</span> <span class="o">--</span><span class="nx">event</span><span class="o">=</span><span class="nx">PodcastWasPurchased</span> <span class="o">--</span><span class="nx">queued</span>
</pre></div>

<p>This will generate a handler class that implements the <code>Illuminate\Contracts\Queue\ShouldBeQueued</code> interface. That&#39;s it! Now when this handler is called for an event, it will be queued automatically by the event dispatcher.</p>

<p>If no exceptions are thrown when the handler is executed by the queue, the queued job will be deleted automatically after it has processed. If you need to access the queued job&#39;s <code>delete</code> and <code>release</code> methods manually, you may do so. The <code>Illuminate\Queue\InteractsWithQueue</code> trait, which is included by default on queued handlers, gives you access to these methods:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">PodcastWasPurchased</span> <span class="nx">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you have an existing handler that you would like to convert to a queued handler, simply add the <code>ShouldBeQueued</code> interface to the class manually.</p>

<p><a name="event-subscribers"></a></p>

<h2>Event Subscribers</h2>

<h4>Defining An Event Subscriber</h4>

<p>Event subscribers are classes that may subscribe to multiple events from within the class itself. Subscribers should define a <code>subscribe</code> method, which will be passed an event dispatcher instance:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserEventHandler</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Handle user login events.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">onUserLogin</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Handle user logout events.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">onUserLogout</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Register the listeners for the subscriber.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  Illuminate\Events\Dispatcher  $events</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">$events</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;App\Events\UserLoggedIn&#39;</span><span class="p">,</span> <span class="s1">&#39;UserEventHandler@onUserLogin&#39;</span><span class="p">);</span>

        <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;App\Events\UserLoggedOut&#39;</span><span class="p">,</span> <span class="s1">&#39;UserEventHandler@onUserLogout&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Registering An Event Subscriber</h4>

<p>Once the subscriber has been defined, it may be registered with the <code>Event</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">$subscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserEventHandler</span><span class="p">;</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">$subscriber</span><span class="p">);</span>
</pre></div>

<p>You may also use the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> to resolve your subscriber. To do so, simply pass the name of your subscriber to the <code>subscribe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;UserEventHandler&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Extending The Framework</h1>

<ul>
<li><a href="#managers-and-factories">Managers &amp; Factories</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#session">Session</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#container-based-extension">Service Container Based Extension</a></li>
</ul>

<p><a name="managers-and-factories"></a></p>

<h2>Managers &amp; Factories</h2>

<p>Laravel has several <code>Manager</code> classes that manage the creation of driver-based components. These include the cache, session, authentication, and queue components. The manager class is responsible for creating a particular driver implementation based on the application&#39;s configuration. For example, the <code>CacheManager</code> class can create APC, Memcached, File, and various other implementations of cache drivers.</p>

<p>Each of these managers includes an <code>extend</code> method which may be used to easily inject new driver resolution functionality into the manager. We&#39;ll cover each of these managers below, with examples of how to inject custom driver support into each of them.</p>

<blockquote>
<p><strong>Note:</strong> Take a moment to explore the various <code>Manager</code> classes that ship with Laravel, such as the <code>CacheManager</code> and <code>SessionManager</code>. Reading through these classes will give you a more thorough understanding of how Laravel works under the hood. All manager classes extend the <code>Illuminate\Support\Manager</code> base class, which provides some helpful, common functionality for each manager.</p>
</blockquote>

<p><a name="cache"></a></p>

<h2>Cache</h2>

<p>To extend the Laravel cache facility, we will use the <code>extend</code> method on the <code>CacheManager</code>, which is used to bind a custom driver resolver to the manager, and is common across all manager classes. For example, to register a new cache driver named &quot;mongo&quot;, we would do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>extend</code> method is the name of the driver. This will correspond to your <code>driver</code> option in the <code>config/cache.php</code> configuration file. The second argument is a Closure that should return an <code>Illuminate\Cache\Repository</code> instance. The Closure will be passed an <code>$app</code> instance, which is an instance of <code>Illuminate\Foundation\Application</code> and a service container.</p>

<p>The call to <code>Cache::extend</code> could be done in the <code>boot</code> method of the default <code>App\Providers\AppServiceProvider</code> that ships with fresh Laravel applications, or you may create your own service provider to house the extension - just don&#39;t forget to register the provider in the <code>config/app.php</code> provider array.</p>

<p>To create our custom cache driver, we first need to implement the <code>Illuminate\Contracts\Cache\Store</code> contract. So, our MongoDB cache implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MongoStore</span> <span class="kr">implements</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Cache</span><span class="err">\</span><span class="nx">Store</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">get</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">put</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">decrement</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">forever</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">forget</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">flush</span><span class="p">()</span> <span class="p">{}</span>

<span class="p">}</span>
</pre></div>

<p>We just need to implement each of these methods using a MongoDB connection. Once our implementation is complete, we can finish our custom driver registration:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you&#39;re wondering where to put your custom cache driver code, consider making it available on Packagist! Or, you could create an <code>Extensions</code> namespace within your <code>app</code> directory. However, keep in mind that Laravel does not have a rigid application structure and you are free to organize your application according to your preferences.</p>

<p><a name="session"></a></p>

<h2>Session</h2>

<p>Extending Laravel with a custom session driver is just as easy as extending the cache system. Again, we will use the <code>extend</code> method to register our custom code:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Return implementation of SessionHandlerInterface</span>
<span class="p">});</span>
</pre></div>

<h3>Where To Extend The Session</h3>

<p>You should place your session extension code in the <code>boot</code> method of your <code>AppServiceProvider</code>.</p>

<h3>Writing The Session Extension</h3>

<p>Note that our custom session driver should implement the <code>SessionHandlerInterface</code>. This interface contains just a few simple methods we need to implement. A stubbed MongoDB implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MongoHandler</span> <span class="kr">implements</span> <span class="nx">SessionHandlerInterface</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">open</span><span class="p">(</span><span class="nx">$savePath</span><span class="p">,</span> <span class="nx">$sessionName</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">close</span><span class="p">()</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">read</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">write</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">gc</span><span class="p">(</span><span class="nx">$lifetime</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">}</span>
</pre></div>

<p>Since these methods are not as readily understandable as the cache <code>StoreInterface</code>, let&#39;s quickly cover what each of the methods do:</p>

<ul>
<li>The <code>open</code> method would typically be used in file based session store systems. Since Laravel ships with a <code>file</code> session driver, you will almost never need to put anything in this method. You can leave it as an empty stub. It is simply a fact of poor interface design (which we&#39;ll discuss later) that PHP requires us to implement this method.</li>
<li>The <code>close</code> method, like the <code>open</code> method, can also usually be disregarded. For most drivers, it is not needed.</li>
<li>The <code>read</code> method should return the string version of the session data associated with the given <code>$sessionId</code>. There is no need to do any serialization or other encoding when retrieving or storing session data in your driver, as Laravel will perform the serialization for you.</li>
<li>The <code>write</code> method should write the given <code>$data</code> string associated with the <code>$sessionId</code> to some persistent storage system, such as MongoDB, Dynamo, etc.</li>
<li>The <code>destroy</code> method should remove the data associated with the <code>$sessionId</code> from persistent storage.</li>
<li>The <code>gc</code> method should destroy all session data that is older than the given <code>$lifetime</code>, which is a UNIX timestamp. For self-expiring systems like Memcached and Redis, this method may be left empty.</li>
</ul>

<p>Once the <code>SessionHandlerInterface</code> has been implemented, we are ready to register it with the Session manager:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MongoHandler</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Once the session driver has been registered, we may use the <code>mongo</code> driver in our <code>config/session.php</code> configuration file.</p>

<blockquote>
<p><strong>Note:</strong> Remember, if you write a custom session handler, share it on Packagist!</p>
</blockquote>

<p><a name="authentication"></a></p>

<h2>Authentication</h2>

<p>Authentication may be extended the same way as the cache and session facilities. Again, we will use the <code>extend</code> method we have become familiar with:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Return implementation of Illuminate\Contracts\Auth\UserProvider</span>
<span class="p">});</span>
</pre></div>

<p>The <code>UserProvider</code> implementations are only responsible for fetching a <code>Illuminate\Contracts\Auth\Authenticatable</code> implementation out of a persistent storage system, such as MySQL, Riak, etc. These two interfaces allow the Laravel authentication mechanisms to continue functioning regardless of how the user data is stored or what type of class is used to represent it.</p>

<p>Let&#39;s take a look at the <code>UserProvider</code> contract:</p>
<div class="highlight"><pre><span></span><span class="kr">interface</span> <span class="nx">UserProvider</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveById</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByToken</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">updateRememberToken</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByCredentials</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$credentials</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">validateCredentials</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$credentials</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>The <code>retrieveById</code> function typically receives a numeric key representing the user, such as an auto-incrementing ID from a MySQL database. The <code>Authenticatable</code> implementation matching the ID should be retrieved and returned by the method.</p>

<p>The <code>retrieveByToken</code> function retrieves a user by their unique <code>$identifier</code> and &quot;remember me&quot; <code>$token</code>, stored in a field <code>remember_token</code>. As with the previous method, the <code>Authenticatable</code> implementation should be returned.</p>

<p>The <code>updateRememberToken</code> method updates the <code>$user</code> field <code>remember_token</code> with the new <code>$token</code>. The new token can be either a fresh token, assigned on successful &quot;remember me&quot; login attempt, or a null when user is logged out.</p>

<p>The <code>retrieveByCredentials</code> method receives the array of credentials passed to the <code>Auth::attempt</code> method when attempting to sign into an application. The method should then &quot;query&quot; the underlying persistent storage for the user matching those credentials. Typically, this method will run a query with a &quot;where&quot; condition on <code>$credentials[&#39;username&#39;]</code>. The method should then return an implementation of <code>UserInterface</code>. <strong>This method should not attempt to do any password validation or authentication.</strong></p>

<p>The <code>validateCredentials</code> method should compare the given <code>$user</code> with the <code>$credentials</code> to authenticate the user. For example, this method might compare the <code>$user-&gt;getAuthPassword()</code> string to a <code>Hash::make</code> of <code>$credentials[&#39;password&#39;]</code>. This method should only validate the user&#39;s credentials and return boolean.</p>

<p>Now that we have explored each of the methods on the <code>UserProvider</code>, let&#39;s take a look at the <code>Authenticatable</code>. Remember, the provider should return implementations of this interface from the <code>retrieveById</code> and <code>retrieveByCredentials</code> methods:</p>
<div class="highlight"><pre><span></span><span class="kr">interface</span> <span class="nx">Authenticatable</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAuthIdentifier</span><span class="p">();</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAuthPassword</span><span class="p">();</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberToken</span><span class="p">();</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">setRememberToken</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberTokenName</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>

<p>This interface is simple. The <code>getAuthIdentifier</code> method should return the &quot;primary key&quot; of the user. In a MySQL back-end, again, this would be the auto-incrementing primary key. The <code>getAuthPassword</code> should return the user&#39;s hashed password. This interface allows the authentication system to work with any User class, regardless of what ORM or storage abstraction layer you are using. By default, Laravel includes a <code>User</code> class in the <code>app</code> directory which implements this interface, so you may consult this class for an implementation example.</p>

<p>Finally, once we have implemented the <code>UserProvider</code>, we are ready to register our extension with the <code>Auth</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">RiakUserProvider</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;riak.connection&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>After you have registered the driver with the <code>extend</code> method, you switch to the new driver in your <code>config/auth.php</code> configuration file.</p>

<p><a name="container-based-extension"></a></p>

<h2>Service Container Based Extension</h2>

<p>Almost every service provider included with the Laravel framework binds objects into the service container. You can find a list of your application&#39;s service providers in the <code>config/app.php</code> configuration file. As you have time, you should skim through each of these provider&#39;s source code. By doing so, you will gain a much better understanding of what each provider adds to the framework, as well as what keys are used to bind various services into the service container.</p>

<p>For example, the <code>HashServiceProvider</code> binds a <code>hash</code> key into the service container, which resolves into a <code>Illuminate\Hashing\BcryptHasher</code> instance. You can easily extend and override this class within your own application by overriding this binding. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SnappyHashProvider</span> <span class="k">extends</span> <span class="nx">\Illuminate\Hashing\HashServiceProvider</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">boot</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bindShared</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">\Snappy\Hashing\ScryptHasher</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Note that this class extends the <code>HashServiceProvider</code>, not the default <code>ServiceProvider</code> base class. Once you have extended the service provider, swap out the <code>HashServiceProvider</code> in your <code>config/app.php</code> configuration file with the name of your extended provider.</p>

<p>This is the general method of extending any core class that is bound in the container. Essentially every core class is bound in the container in this fashion, and can be overridden. Again, reading through the included framework service providers will familiarize you with where various classes are bound into the container, and what keys they are bound by. This is a great way to learn more about how Laravel is put together.</p>
<div style="page-break-after: always;" ></div><h1>Facades</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#explanation">Explanation</a></li>
<li><a href="#practical-usage">Practical Usage</a></li>
<li><a href="#creating-facades">Creating Facades</a></li>
<li><a href="#mocking-facades">Mocking Facades</a></li>
<li><a href="#facade-class-reference">Facade Class Reference</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Facades provide a &quot;static&quot; interface to classes that are available in the application&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. Laravel ships with many facades, and you have probably been using them without even knowing it! Laravel &quot;facades&quot; serve as &quot;static proxies&quot; to underlying classes in the service container, providing the benefit of a terse, expressive syntax while maintaining more testability and flexibility than traditional static methods.</p>

<p>Occasionally, you may wish to create your own facades for your application&#39;s and packages, so let&#39;s explore the concept, development and usage of these classes.</p>

<blockquote>
<p><strong>Note:</strong> Before digging into facades, it is strongly recommended that you become very familiar with the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>
</blockquote>

<p><a name="explanation"></a></p>

<h2>Explanation</h2>

<p>In the context of a Laravel application, a facade is a class that provides access to an object from the container. The machinery that makes this work is in the <code>Facade</code> class. Laravel&#39;s facades, and any custom facades you create, will extend the base <code>Facade</code> class.</p>

<p>Your facade class only needs to implement a single method: <code>getFacadeAccessor</code>. It&#39;s the <code>getFacadeAccessor</code> method&#39;s job to define what to resolve from the container. The <code>Facade</code> base class makes use of the <code>__callStatic()</code> magic-method to defer calls from your facade to the resolved object.</p>

<p>So, when you make a facade call like <code>Cache::get</code>, Laravel resolves the Cache manager class out of the service container and calls the <code>get</code> method on the class. In technical terms, Laravel Facades are a convenient syntax for using the Laravel service container as a service locator.</p>

<p><a name="practical-usage"></a></p>

<h2>Practical Usage</h2>

<p>In the example below, a call is made to the Laravel cache system. By glancing at this code, one might assume that the static method <code>get</code> is being called on the <code>Cache</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>However, if we look at that <code>Illuminate\Support\Facades\Cache</code> class, you&#39;ll see that there is no static method <code>get</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Cache</span> <span class="kr">extends</span> <span class="nx">Facade</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the registered name of the component.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;cache&#39;</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The Cache class extends the base <code>Facade</code> class and defines a method <code>getFacadeAccessor()</code>. Remember, this method&#39;s job is to return the name of a service container binding.</p>

<p>When a user references any static method on the <code>Cache</code> facade, Laravel resolves the <code>cache</code> binding from the service container and runs the requested method (in this case, <code>get</code>) against that object.</p>

<p>So, our <code>Cache::get</code> call could be re-written like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Importing Facades</h4>

<p>Remember, if you are using a facade in a controller that is namespaced, you will need to import the facade class into the namespace. All facades live in the global namespace:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PhotosController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Get all of the application photos.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$photos</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="creating-facades"></a></p>

<h2>Creating Facades</h2>

<p>Creating a facade for your own application or package is simple. You only need 3 things:</p>

<ul>
<li>A service container binding.</li>
<li>A facade class.</li>
<li>A facade alias configuration.</li>
</ul>

<p>Let&#39;s look at an example. Here, we have a class defined as <code>PaymentGateway\Payment</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">namespace</span> <span class="nx">PaymentGateway</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Payment</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">process</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>We need to be able to resolve this class from the service container. So, let&#39;s add a binding to a service provider:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;payment&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="err">\</span><span class="nx">PaymentGateway</span><span class="err">\</span><span class="nx">Payment</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>A great place to register this binding would be to create a new <a href="/docs/%7B%7Bversion%7D%7D/container#service-providers">service provider</a> named <code>PaymentServiceProvider</code>, and add this binding to the <code>register</code> method. You can then configure Laravel to load your service provider from the <code>config/app.php</code> configuration file.</p>

<p>Next, we can create our own facade class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Facade</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Payment</span> <span class="kr">extends</span> <span class="nx">Facade</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;payment&#39;</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Finally, if we wish, we can add an alias for our facade to the <code>aliases</code> array in the <code>config/app.php</code> configuration file. Now, we can call the <code>process</code> method on an instance of the <code>Payment</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">Payment</span><span class="o">::</span><span class="nx">process</span><span class="p">();</span>
</pre></div>

<h3>A Note On Auto-Loading Aliases</h3>

<p>Classes in the <code>aliases</code> array are not available in some instances because <a href="https://bugs.php.net/bug.php?id=39003">PHP will not attempt to autoload undefined type-hinted classes</a>. If <code>\ServiceWrapper\ApiTimeoutException</code> is aliased to <code>ApiTimeoutException</code>, a <code>catch(ApiTimeoutException $e)</code> outside of the namespace <code>\ServiceWrapper</code> will never catch the exception, even if one is thrown. A similar problem is found in classes which have type hints to aliased classes. The only workaround is to forego aliasing and <code>use</code> the classes you wish to type hint at the top of each file which requires them.</p>

<p><a name="mocking-facades"></a></p>

<h2>Mocking Facades</h2>

<p>Unit testing is an important aspect of why facades work the way that they do. In fact, testability is the primary reason for facades to even exist. For more information, check out the <a href="/docs/%7B%7Bversion%7D%7D/testing#mocking-facades">mocking facades</a> section of the documentation.</p>

<p><a name="facade-class-reference"></a></p>

<h2>Facade Class Reference</h2>

<p>Below you will find every facade and its underlying class. This is a useful tool for quickly digging into the API documentation for a given facade root. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container binding</a> key is also included where applicable.</p>

<p>Facade  |  Class  |  Service Container Binding
------------- | ------------- | -------------
App  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a>  | <code>app</code>
Artisan  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Console/Application.html">Illuminate\Console\Application</a>  |  <code>artisan</code>
Auth  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a>  |  <code>auth</code>
Auth (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Guard.html">Illuminate\Auth\Guard</a>  |
Blade  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a>  |  <code>blade.compiler</code>
Bus  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a>  |
Cache  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cache/Repository.html">Illuminate\Cache\CacheManager</a>  |  <code>cache</code>
Config  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a>  |  <code>config</code>
Cookie  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a>  |  <code>cookie</code>
Crypt  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a>  |  <code>encrypter</code>
DB  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a>  |  <code>db</code>
DB (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a>  |
Event  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a>  |  <code>events</code>
File  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a>  |  <code>files</code>
Hash  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a>  |  <code>hash</code>
Input  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Lang  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a>  |  <code>translator</code>
Log  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Log/Writer.html">Illuminate\Log\Writer</a>  |  <code>log</code>
Mail  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a>  |  <code>mailer</code>
Password  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a>  |  <code>auth.password</code>
Queue  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a>  |  <code>queue</code>
Queue (Instance) |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/QueueInterface.html">Illuminate\Queue\QueueInterface</a>  |
Queue (Base Class) |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a>  |
Redirect  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a>  |  <code>redirect</code>
Redis  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Redis/Database.html">Illuminate\Redis\Database</a>  |  <code>redis</code>
Request  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Response  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a>  |
Route  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a>  |  <code>router</code>
Schema  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Schema/Blueprint.html">Illuminate\Database\Schema\Blueprint</a>  |
Session  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a>  |  <code>session</code>
Session (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/Store.html">Illuminate\Session\Store</a>  |
Storage  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Filesystem/Factory.html">Illuminate\Contracts\Filesystem\Factory</a>  |  <code>filesystem</code>
URL  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a>  |  <code>url</code>
Validator  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a>  |  <code>validator</code>
Validator (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a> |
View  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Factory.html">Illuminate\View\Factory</a>  |  <code>view</code>
View (Instance)  |  <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/View.html">Illuminate\View\View</a>  |</p>
<div style="page-break-after: always;" ></div><h1>Filesystem / Cloud Storage</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#custom-filesystems">Custom Filesystems</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a wonderful filesystem abstraction thanks to the <a href="https://github.com/thephpleague/flysystem">Flysystem</a> PHP package by Frank de Jonge. The Laravel Flysystem integration provides simple to use drivers for working with local filesystems, Amazon S3, and Rackspace Cloud Storage. Even better, it&#39;s amazingly simple to switch between these storage options as the API remains the same for each system!</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The filesystem configuration file is located at <code>config/filesystems.php</code>. Within this file you may configure all of your &quot;disks&quot;. Each disk represents a particular storage driver and storage location. Example configurations for each supported driver is included in the configuration file. So, simply modify the configuration to reflect your storage preferences and credentials!</p>

<p>Before using the S3 or Rackspace drivers, you will need to install the appropriate package via Composer:</p>

<ul>
<li>Amazon S3: <code>league/flysystem-aws-s3-v2 ~1.0</code></li>
<li>Rackspace: <code>league/flysystem-rackspace ~1.0</code></li>
</ul>

<p>Of course, you may configure as many disks as you like, and may even have multiple disks that use the same driver.</p>

<p>When using the <code>local</code> driver, note that all file operations are relative to the <code>root</code> directory defined in your configuration file. By default, this value is set to the <code>storage/app</code> directory. Therefore, the following method would store a file in <code>storage/app/file.txt</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;Contents&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>The <code>Storage</code> facade may be used to interact with any of your configured disks. Alternatively, you may type-hint the <code>Illuminate\Contracts\Filesystem\Factory</code> contract on any class that is resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<h4>Retrieving A Particular Disk</h4>
<div class="highlight"><pre><span></span><span class="nx">$disk</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">);</span>

<span class="nx">$disk</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If A File Exists</h4>
<div class="highlight"><pre><span></span><span class="nx">$exists</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Calling Methods On The Default Disk</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Storage</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving A File&#39;s Contents</h4>
<div class="highlight"><pre><span></span><span class="nx">$contents</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Setting A File&#39;s Contents</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$contents</span><span class="p">);</span>
</pre></div>

<h4>Prepend To A File</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Prepended Text&#39;</span><span class="p">);</span>
</pre></div>

<h4>Append To A File</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Appended Text&#39;</span><span class="p">);</span>
</pre></div>

<h4>Delete A File</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">([</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;file2.jpg&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Copy A File To A New Location</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;old/file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Move A File To A New Location</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">move</span><span class="p">(</span><span class="s1">&#39;old/file1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Get File Size</h4>
<div class="highlight"><pre><span></span><span class="nx">$size</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">size</span><span class="p">(</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Get The Last Modification Time (UNIX)</h4>
<div class="highlight"><pre><span></span><span class="nx">$time</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">lastModified</span><span class="p">(</span><span class="s1">&#39;file1.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h4>Get All Files Within A Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">files</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="c1">// Recursive...</span>
<span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allFiles</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Get All Directories Within A Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">directories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="c1">// Recursive...</span>
<span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allDirectories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Create A Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">makeDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Delete A Directory</h4>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">deleteDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<p><a name="custom-filesystems"></a></p>

<h2>Custom Filesystems</h2>

<p>Laravel&#39;s Flysystem integration provides drivers for several &quot;drivers&quot; out of the box; however, Flysystem is not limited to these and has adapters for many other storage systems. You can create a custom driver if you want to use one of these additional adapters in your Laravel application. Don&#39;t worry, it&#39;s not too hard!</p>

<p>In order to set up the custom filesystem you will need to create a service provider such as <code>DropboxFilesystemServiceProvider</code>. In the provider&#39;s <code>boot</code> method, you can inject an instance of the <code>Illuminate\Contracts\Filesystem\Factory</code> contract and call the <code>extend</code> method of the injected instance. Alternatively, you may use the <code>Disk</code> facade&#39;s <code>extend</code> method.</p>

<p>The first argument of the <code>extend</code> method is the name of the driver and the second is a Closure that receives the <code>$app</code> and <code>$config</code> variables. The resolver Closure must return an instance of <code>League\Flysystem\Filesystem</code>.</p>

<blockquote>
<p><strong>Note:</strong> The $config variable will already contain the values defined in <code>config/filesystems.php</code> for the specified disk.</p>
</blockquote>

<h4>Dropbox Example</h4>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">League\Flysystem\Filesystem</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Dropbox\Client</span> <span class="k">as</span> <span class="nx">DropboxClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">League\Flysystem\Dropbox\DropboxAdapter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DropboxFilesystemServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;dropbox&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$config</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DropboxClient</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;accessToken&#39;</span><span class="p">],</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;clientIdentifier&#39;</span><span class="p">]);</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">Filesystem</span><span class="p">(</span><span class="k">new</span> <span class="nx">DropboxAdapter</span><span class="p">(</span><span class="nv">$client</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Hashing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Hash</code> facade provides secure Bcrypt hashing for storing user passwords. If you are using the <code>AuthController</code> controller that is included with your Laravel application, it will be take care of verifying the Bcrypt password against the un-hashed version provided by the user.</p>

<p>Likewise, the user <code>Registrar</code> service that ships with Laravel makes the proper <code>bcrypt</code> function call to hash stored passwords.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Hashing A Password Using Bcrypt</h4>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also use the <code>bcrypt</code> helper function:</p>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
</pre></div>

<h4>Verifying A Password Against A Hash</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="nx">$hashedPassword</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The passwords match...</span>
<span class="p">}</span>
</pre></div>

<h4>Checking If A Password Needs To Be Rehashed</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">needsRehash</span><span class="p">(</span><span class="nx">$hashed</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Helper Functions</h1>

<ul>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#paths">Paths</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#strings">Strings</a></li>
<li><a href="#urls">URLs</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
</ul>

<p><a name="arrays"></a></p>

<h2>Arrays</h2>

<h3>array_add</h3>

<p>The <code>array_add</code> function adds a given key / value pair to the array if the given key doesn&#39;t already exist in the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_add</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_divide</h3>

<p>The <code>array_divide</code> function returns two arrays, one containing the keys, and the other containing the values of the original array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">];</span>

<span class="nx">list</span><span class="p">(</span><span class="nx">$keys</span><span class="p">,</span> <span class="nx">$values</span><span class="p">)</span> <span class="o">=</span> <span class="nx">array_divide</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>
</pre></div>

<h3>array_dot</h3>

<p>The <code>array_dot</code> function flattens a multi-dimensional array into a single level array that uses &quot;dot&quot; notation to indicate depth.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">]];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_dot</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;foo.bar&#39; =&gt; &#39;baz&#39;];</span>
</pre></div>

<h3>array_except</h3>

<p>The <code>array_except</code> method removes the given key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_except</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">]);</span>
</pre></div>

<h3>array_fetch</h3>

<p>The <code>array_fetch</code> method returns a flattened array containing the selected nested element.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]]</span>
<span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_fetch</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;Taylor&#39;, &#39;Dayle&#39;];</span>
</pre></div>

<h3>array_first</h3>

<p>The <code>array_first</code> method returns the first element of an array passing a given truth test.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>A default value may also be passed as the third parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<h3>array_last</h3>

<p>The <code>array_last</code> method returns the last element of an array passing a given truth test.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">350</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 500</span>
</pre></div>

<p>A default value may also be passed as the third parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<h3>array_flatten</h3>

<p>The <code>array_flatten</code> method will flatten a multi-dimensional array into a single level.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">]];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_flatten</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;Joe&#39;, &#39;PHP&#39;, &#39;Ruby&#39;];</span>
</pre></div>

<h3>array_forget</h3>

<p>The <code>array_forget</code> method will remove a given key / value pair from a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;joe&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;programmer&#39;</span><span class="p">]]];</span>

<span class="nx">array_forget</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.joe&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_get</h3>

<p>The <code>array_get</code> method will retrieve a given value from a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;joe&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;programmer&#39;</span><span class="p">]]];</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.joe&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.john&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Want something like <code>array_get</code> but for objects instead? Use <code>object_get</code>.</p>
</blockquote>

<h3>array_only</h3>

<p>The <code>array_only</code> method will return only the specified key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_only</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span><span class="p">]);</span>
</pre></div>

<h3>array_pluck</h3>

<p>The <code>array_pluck</code> method will pluck a list of the given key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;Taylor&#39;, &#39;Dayle&#39;];</span>
</pre></div>

<h3>array_pull</h3>

<p>The <code>array_pull</code> method will return a given key / value pair from the array, as well as remove it.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">27</span><span class="p">];</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">array_pull</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_set</h3>

<p>The <code>array_set</code> method will set a value within a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;programmer&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">]];</span>

<span class="nx">array_set</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.editor&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_sort</h3>

<p>The <code>array_sort</code> method sorts the array by the results of the given Closure.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jill&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Barry&#39;</span><span class="p">]</span>
<span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">array_sort</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}));</span>
</pre></div>

<h3>array_where</h3>

<p>Filter the array using the given Closure.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_where</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">is_string</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Array ( [1] =&gt; 200 [3] =&gt; 400 )</span>
</pre></div>

<h3>head</h3>

<p>Return the first element in the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">head</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">returnsArray</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
</pre></div>

<h3>last</h3>

<p>Return the last element in the array. Useful for method chaining.</p>
<div class="highlight"><pre><span></span><span class="nx">$last</span> <span class="o">=</span> <span class="nx">last</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">returnsArray</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="paths"></a></p>

<h2>Paths</h2>

<h3>app_path</h3>

<p>Get the fully qualified path to the <code>app</code> directory.</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">();</span>
</pre></div>

<h3>base_path</h3>

<p>Get the fully qualified path to the root of the application install.</p>

<h3>config_path</h3>

<p>Get the fully qualified path to the <code>config</code> directory.</p>

<h3>public_path</h3>

<p>Get the fully qualified path to the <code>public</code> directory.</p>

<h3>storage_path</h3>

<p>Get the fully qualified path to the <code>storage</code> directory.</p>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<h3>get</h3>

<p>Register a new GET route with the router.</p>
<div class="highlight"><pre><span></span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h3>post</h3>

<p>Register a new POST route with the router.</p>
<div class="highlight"><pre><span></span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;FooController@action&#39;</span><span class="p">);</span>
</pre></div>

<h3>put</h3>

<p>Register a new PUT route with the router.</p>
<div class="highlight"><pre><span></span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;FooController@action&#39;</span><span class="p">);</span>
</pre></div>

<h3>patch</h3>

<p>Register a new PATCH route with the router.</p>
<div class="highlight"><pre><span></span><span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;FooController@action&#39;</span><span class="p">);</span>
</pre></div>

<h3>delete</h3>

<p>Register a new DELETE route with the router.</p>
<div class="highlight"><pre><span></span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;FooController@action&#39;</span><span class="p">);</span>
</pre></div>

<h3>resource</h3>

<p>Register a new RESTful resource route with the router.</p>
<div class="highlight"><pre><span></span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooController&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="strings"></a></p>

<h2>Strings</h2>

<h3>camel_case</h3>

<p>Convert the given string to <code>camelCase</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$camel</span> <span class="o">=</span> <span class="nx">camel_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// fooBar</span>
</pre></div>

<h3>class_basename</h3>

<p>Get the class name of the given class, without any namespace names.</p>
<div class="highlight"><pre><span></span><span class="nx">$class</span> <span class="o">=</span> <span class="nx">class_basename</span><span class="p">(</span><span class="s1">&#39;Foo\Bar\Baz&#39;</span><span class="p">);</span>

<span class="c1">// Baz</span>
</pre></div>

<h3>e</h3>

<p>Run <code>htmlentities</code> over the given string, with UTF-8 support.</p>
<div class="highlight"><pre><span></span><span class="nx">$entities</span> <span class="o">=</span> <span class="nx">e</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;foo&lt;/html&gt;&#39;</span><span class="p">);</span>
</pre></div>

<h3>ends_with</h3>

<p>Determine if the given haystack ends with a given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">ends_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h3>snake_case</h3>

<p>Convert the given string to <code>snake_case</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$snake</span> <span class="o">=</span> <span class="nx">snake_case</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">);</span>

<span class="c1">// foo_bar</span>
</pre></div>

<h3>str_limit</h3>

<p>Limit the number of characters in a string.</p>
<div class="highlight"><pre><span></span><span class="nx">str_limit</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$limit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">$end</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
</pre></div>

<p>Example:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_limit</span><span class="p">(</span><span class="s1">&#39;The PHP framework for web artisans.&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="c1">// The PHP...</span>
</pre></div>

<h3>starts_with</h3>

<p>Determine if the given haystack begins with the given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">starts_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_contains</h3>

<p>Determine if the given haystack contains the given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_contains</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_finish</h3>

<p>Add a single instance of the given needle to the haystack. Remove any extra instances.</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_finish</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>
</pre></div>

<h3>str_is</h3>

<p>Determine if a given string matches a given pattern. Asterisks may be used to indicate wildcards.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_is</span><span class="p">(</span><span class="s1">&#39;foo*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_plural</h3>

<p>Convert a string to its plural form (English only).</p>
<div class="highlight"><pre><span></span><span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_random</h3>

<p>Generate a random string of the given length.</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
</pre></div>

<h3>str_singular</h3>

<p>Convert a string to its singular form (English only).</p>
<div class="highlight"><pre><span></span><span class="nx">$singular</span> <span class="o">=</span> <span class="nx">str_singular</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_slug</h3>

<p>Generate a URL friendly &quot;slug&quot; from a given string.</p>
<div class="highlight"><pre><span></span><span class="nx">str_slug</span><span class="p">(</span><span class="nx">$title</span><span class="p">,</span> <span class="nx">$separator</span><span class="p">);</span>
</pre></div>

<p>Example:</p>
<div class="highlight"><pre><span></span><span class="nx">$title</span> <span class="o">=</span> <span class="nx">str_slug</span><span class="p">(</span><span class="s2">&quot;Laravel 5 Framework&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">);</span>

<span class="c1">// laravel-5-framework</span>
</pre></div>

<h3>studly_case</h3>

<p>Convert the given string to <code>StudlyCase</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">studly_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// FooBar</span>
</pre></div>

<h3>trans</h3>

<p>Translate a given language line. Alias of <code>Lang::get</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;validation.required&#39;</span><span class="p">)</span><span class="o">:</span>
</pre></div>

<h3>trans_choice</h3>

<p>Translate a given language line with inflection. Alias of <code>Lang::choice</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="nx">$count</span><span class="p">);</span>
</pre></div>

<p><a name="urls"></a></p>

<h2>URLs</h2>

<h3>action</h3>

<p>Generate a URL for a given controller action.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@getIndex&#39;</span><span class="p">,</span> <span class="nx">$params</span><span class="p">);</span>
</pre></div>

<h3>route</h3>

<p>Generate a URL for a given named route.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">,</span> <span class="nx">$params</span><span class="p">);</span>
</pre></div>

<h3>asset</h3>

<p>Generate a URL for an asset.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h3>secure_asset</h3>

<p>Generate a URL for an asset using HTTPS.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">secure_asset</span><span class="p">(</span><span class="s1">&#39;foo/bar.zip&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="p">[]);</span>
</pre></div>

<h3>secure_url</h3>

<p>Generate a fully qualified URL to a given path using HTTPS.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">secure_url</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="p">[]);</span>
</pre></div>

<h3>url</h3>

<p>Generate a fully qualified URL to the given path.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="miscellaneous"></a></p>

<h2>Miscellaneous</h2>

<h3>csrf_token</h3>

<p>Get the value of the current CSRF token.</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">csrf_token</span><span class="p">();</span>
</pre></div>

<h3>dd</h3>

<p>Dump the given variable and end execution of the script.</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
</pre></div>

<h3>elixir</h3>

<p>Get the path to a versioned Elixir file.</p>
<div class="highlight"><pre><span></span><span class="nx">elixir</span><span class="p">(</span><span class="nx">$file</span><span class="p">);</span>
</pre></div>

<h3>env</h3>

<p>Gets the value of an environment variable or return a default value.</p>
<div class="highlight"><pre><span></span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">)</span>
</pre></div>

<h3>event</h3>

<p>Fire an event.</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="s1">&#39;my.event&#39;</span><span class="p">);</span>
</pre></div>

<h3>value</h3>

<p>If the given value is a <code>Closure</code>, return the value returned by the <code>Closure</code>. Otherwise, return the value.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h3>view</h3>

<p>Get a View instance for the given view path.</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">);</span>
</pre></div>

<h3>with</h3>

<p>Return the given object.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="k">new</span> <span class="nx">Foo</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">doWork</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Homestead</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#included-software">Included Software</a></li>
<li><a href="#installation-and-setup">Installation &amp; Setup</a></li>
<li><a href="#daily-usage">Daily Usage</a></li>
<li><a href="#ports">Ports</a></li>
<li><a href="#blackfire-profiler">Blackfire Profiler</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel strives to make the entire PHP development experience delightful, including your local development environment. <a href="http://vagrantup.com">Vagrant</a> provides a simple, elegant way to manage and provision Virtual Machines.</p>

<p>Laravel Homestead is an official, pre-packaged Vagrant &quot;box&quot; that provides you a wonderful development environment without requiring you to install PHP, HHVM, a web server, and any other server software on your local machine. No more worrying about messing up your operating system! Vagrant boxes are completely disposable. If something goes wrong, you can destroy and re-create the box in minutes!</p>

<p>Homestead runs on any Windows, Mac, or Linux system, and includes the Nginx web server, PHP 5.6, MySQL, Postgres, Redis, Memcached, and all of the other goodies you need to develop amazing Laravel applications.</p>

<blockquote>
<p><strong>Note:</strong> If you are using Windows, you may need to enable hardware virtualization (VT-x). It can usually be enabled via your BIOS.</p>
</blockquote>

<p>Homestead is currently built and tested using Vagrant 1.7.</p>

<p><a name="included-software"></a></p>

<h2>Included Software</h2>

<ul>
<li>Ubuntu 14.04</li>
<li>PHP 5.6</li>
<li>HHVM</li>
<li>Nginx</li>
<li>MySQL</li>
<li>Postgres</li>
<li>Node (With Bower, Grunt, and Gulp)</li>
<li>Redis</li>
<li>Memcached</li>
<li>Beanstalkd</li>
<li><a href="/docs/%7B%7Bversion%7D%7D/envoy">Laravel Envoy</a></li>
<li><a href="#blackfire-profiler">Blackfire Profiler</a></li>
</ul>

<p><a name="installation-and-setup"></a></p>

<h2>Installation &amp; Setup</h2>

<h3>Installing VirtualBox / VMware &amp; Vagrant</h3>

<p>Before launching your Homestead environment, you must install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> and <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>. Both of these software packages provide easy-to-use visual installers for all popular operating systems.</p>

<h4>VMware</h4>

<p>In addition to VirtualBox, Homestead also supports VMware. To use the VMware provider, you will need to purchase both VMware Fusion / Desktop and the <a href="http://www.vagrantup.com/vmware">VMware Vagrant plug-in</a>. VMware provides much faster shared folder performance out of the box.</p>

<h3>Adding The Vagrant Box</h3>

<p>Once VirtualBox / VMware and Vagrant have been installed, you should add the <code>laravel/homestead</code> box to your Vagrant installation using the following command in your terminal. It will take a few minutes to download the box, depending on your Internet connection speed:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span>
</pre></div>

<p>If this command fails, you may have an old version of Vagrant that requires the full URL:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//atlas.hashicorp.com/laravel/boxes/homestead</span>
</pre></div>

<h3>Installing Homestead</h3>

<p>You may install Homestead manually by simply cloning the repository. Consider cloning the repository into a <code>Homestead</code> folder within your &quot;home&quot; directory, as the Homestead box will serve as the host to all of your Laravel (and PHP) projects:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/homestead.git Homestead</span>
</pre></div>

<p>Once you have cloned the Homestead repository, run the <code>bash init.sh</code> command from the Homestead directory to create the <code>Homestead.yaml</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">bash</span> <span class="nx">init</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>

<p>The <code>Homestead.yaml</code> file will be placed in your <code>~/.homestead</code> directory.</p>

<h3>Configure Your Provider</h3>

<p>The <code>provider</code> key in your <code>Homestead.yaml</code> file indicates which Vagrant provider should be used: <code>virtualbox</code>, <code>vmware_fusion</code> (Mac OS X) or <code>vmware_workstation</code> (Windows). You may set this to whichever provider you prefer.</p>
<div class="highlight"><pre><span></span><span class="nx">provider</span><span class="o">:</span> <span class="nx">virtualbox</span>
</pre></div>

<h3>Set Your SSH Key</h3>

<p>Next, you should edit the <code>Homestead.yaml</code> file. In this file, you can configure the path to your public SSH key, as well as the folders you wish to be shared between your main machine and the Homestead virtual machine.</p>

<p>Don&#39;t have an SSH key? On Mac and Linux, you can generally create an SSH key pair using the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span> <span class="o">-</span><span class="nx">C</span> <span class="s2">&quot;you@homestead&quot;</span>
</pre></div>

<p>On Windows, you may install <a href="http://git-scm.com/">Git</a> and use the <code>Git Bash</code> shell included with Git to issue the command above. Alternatively, you may use <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">PuTTY</a> and <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">PuTTYgen</a>.</p>

<p>Once you have created a SSH key, specify the key&#39;s path in the <code>authorize</code> property of your <code>Homestead.yaml</code> file.</p>

<h3>Configure Your Shared Folders</h3>

<p>The <code>folders</code> property of the <code>Homestead.yaml</code> file lists all of the folders you wish to share with your Homestead environment. As files within these folders are changed, they will be kept in sync between your local machine and the Homestead environment. You may configure as many shared folders as necessary!</p>

<p>To enable <a href="http://docs.vagrantup.com/v2/synced-folders/nfs.html">NFS</a>, just add a simple flag to your synced folder:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/Code</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;nfs&quot;</span>
</pre></div>

<h3>Configure Your Nginx Sites</h3>

<p>Not familiar with Nginx? No problem. The <code>sites</code> property allows you to easily map a &quot;domain&quot; to a folder on your Homestead environment. A sample site configuration is included in the <code>Homestead.yaml</code> file. Again, you may add as many sites to your Homestead environment as necessary. Homestead can serve as a convenient, virtualized environment for every Laravel project you are working on!</p>

<p>You can make any Homestead site use <a href="http://hhvm.com">HHVM</a> by setting the <code>hhvm</code> option to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code/Laravel/public</span>
      <span class="nx">hhvm</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>Each site will be accessible by HTTP via port 8000 and HTTPS via port 44300.</p>

<h3>Bash Aliases</h3>

<p>To add Bash aliases to your Homestead box, simply add to the <code>aliases</code> file in the root of the <code>~/.homestead</code> directory.</p>

<h3>Launch The Vagrant Box</h3>

<p>Once you have edited the <code>Homestead.yaml</code> to your liking, run the <code>vagrant up</code> command from your Homestead directory.</p>

<p>Vagrant will boot the virtual machine, and configure your shared folders and Nginx sites automatically! To destroy the machine, you may use the <code>vagrant destroy --force</code> command.</p>

<p>Don&#39;t forget to add the &quot;domains&quot; for your Nginx sites to the <code>hosts</code> file on your machine! The <code>hosts</code> file will redirect your requests for the local domains into your Homestead environment. On Mac and Linux, this file is located at <code>/etc/hosts</code>. On Windows, it is located at <code>C:\Windows\System32\drivers\etc\hosts</code>. The lines you add to this file will look like the following:</p>
<div class="highlight"><pre><span></span><span class="mf">192.168.10.10</span>  <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
</pre></div>

<p>Make sure the IP address listed is the one you set in your <code>Homestead.yaml</code> file. Once you have added the domain to your <code>hosts</code> file, you can access the site via your web browser!</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//homestead.app</span>
</pre></div>

<p>To learn how to connect to your databases, read on!</p>

<p><a name="daily-usage"></a></p>

<h2>Daily Usage</h2>

<h3>Connecting Via SSH</h3>

<p>Since you will probably need to SSH into your Homestead machine frequently, consider creating an &quot;alias&quot; on your host machine to quickly SSH into the Homestead box:</p>
<div class="highlight"><pre><span></span><span class="nx">alias</span> <span class="nx">vm</span><span class="o">=</span><span class="s2">&quot;ssh vagrant@127.0.0.1 -p 2222&quot;</span>
</pre></div>

<p>Once you create this alias, you can simply use the &quot;vm&quot; command to SSH into your Homestead machine from anywhere on your system.</p>

<p>Alternatively, you can use the <code>vagrant ssh</code> command from your Homestead directory.</p>

<h3>Connecting To Your Databases</h3>

<p>A <code>homestead</code> database is configured for both MySQL and Postgres out of the box. For even more convenience, Laravel&#39;s <code>local</code> database configuration is set to use this database by default.</p>

<p>To connect to your MySQL or Postgres database from your main machine via Navicat or Sequel Pro, you should connect to <code>127.0.0.1</code> and port 33060 (MySQL) or 54320 (Postgres). The username and password for both databases is <code>homestead</code> / <code>secret</code>.</p>

<blockquote>
<p><strong>Note:</strong> You should only use these non-standard ports when connecting to the databases from your main machine. You will use the default 3306 and 5432 ports in your Laravel database configuration file since Laravel is running <em>within</em> the Virtual Machine.</p>
</blockquote>

<h3>Adding Additional Sites</h3>

<p>Once your Homestead environment is provisioned and running, you may want to add additional Nginx sites for your Laravel applications. You can run as many Laravel installations as you wish on a single Homestead environment. There are two ways to do this: First, you may simply add the sites to your <code>Homestead.yaml</code> file and then run <code>vagrant provision</code> from your Homestead directory.</p>

<blockquote>
<p><strong>Note:</strong> This process is destructive. When running the <code>provision</code> command, your existing databases will be destroyed and recreated.</p>
</blockquote>

<p>Alternatively, you may use the <code>serve</code> script that is available on your Homestead environment. To use the <code>serve</code> script, SSH into your Homestead environment and run the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">serve</span> <span class="nx">domain</span><span class="p">.</span><span class="nx">app</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">vagrant</span><span class="o">/</span><span class="nx">Code</span><span class="o">/</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="kr">public</span><span class="o">/</span><span class="nx">directory</span> <span class="mi">80</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> After running the <code>serve</code> command, do not forget to add the new site to the <code>hosts</code> file on your main machine!</p>
</blockquote>

<p><a name="ports"></a></p>

<h2>Ports</h2>

<p>The following ports are forwarded to your Homestead environment:</p>

<ul>
<li><strong>SSH:</strong> 2222 &rarr; Forwards To 22</li>
<li><strong>HTTP:</strong> 8000 &rarr; Forwards To 80</li>
<li><strong>HTTPS:</strong> 44300 &rarr; Forwards To 443</li>
<li><strong>MySQL:</strong> 33060 &rarr; Forwards To 3306</li>
<li><strong>Postgres:</strong> 54320 &rarr; Forwards To 5432</li>
</ul>

<h3>Adding Additional Ports</h3>

<p>If you wish, you may forward additional ports to the Vagrant box, as well as specify their protocol:</p>
<div class="highlight"><pre><span></span><span class="nx">ports</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">93000</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">9300</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">7777</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">777</span>
      <span class="nx">protocol</span><span class="o">:</span> <span class="nx">udp</span>
</pre></div>

<p><a name="blackfire-profiler"></a></p>

<h2>Blackfire Profiler</h2>

<p><a href="https://blackfire.io">Blackfire Profiler</a> by SensioLabs automatically gathers data about your code&#39;s execution, such as RAM, CPU time, and disk I/O. Homestead makes it a breeze to use this profiler for your own applications.</p>

<p>All of the proper packages have already been installed on your Homestead box, you simply need to set a Blackfire <strong>Server</strong> ID and token in your <code>Homestead.yaml</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">blackfire</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">id</span>
      <span class="nx">token</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">server</span><span class="o">-</span><span class="nx">token</span>
      <span class="nx">client</span><span class="o">-</span><span class="nx">id</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">client</span><span class="o">-</span><span class="nx">id</span>
      <span class="nx">client</span><span class="o">-</span><span class="nx">token</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">client</span><span class="o">-</span><span class="nx">token</span>
</pre></div>

<p>Once you have configured your Blackfire credentials, re-provision the box using <code>vagrant provision</code> from your Homestead directory. Of course, be sure to review the <a href="https://blackfire.io/getting-started">Blackfire documentation</a> to learn how to install the Blackfire companion extension for your web browser.</p>
<div style="page-break-after: always;" ></div><h1>Installation</h1>

<ul>
<li><a href="#install-composer">Install Composer</a></li>
<li><a href="#install-laravel">Install Laravel</a></li>
<li><a href="#server-requirements">Server Requirements</a></li>
</ul>

<p><a name="install-composer"></a></p>

<h2>Install Composer</h2>

<p>Laravel utilizes <a href="http://getcomposer.org">Composer</a> to manage its dependencies. So, before using Laravel, you will need to make sure you have Composer installed on your machine.</p>

<p><a name="install-laravel"></a></p>

<h2>Install Laravel</h2>

<h3>Via Laravel Installer</h3>

<p>First, download the Laravel installer using Composer.</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/installer=~1.1&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>laravel</code> executable can be located by your system.</p>

<p>Once installed, the simple <code>laravel new</code> command will create a fresh Laravel installation in the directory you specify. For instance, <code>laravel new blog</code> would create a directory named <code>blog</code> containing a fresh Laravel installation with all dependencies installed. This method of installation is much faster than installing via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">laravel</span> <span class="k">new</span> <span class="nx">blog</span>
</pre></div>

<h3>Via Composer Create-Project</h3>

<p>You may also install Laravel by issuing the Composer <code>create-project</code> command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="p">{</span><span class="nx">directory</span><span class="p">}</span> <span class="s2">&quot;5.0.*&quot;</span> <span class="o">--</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">dist</span>
</pre></div>

<p>Once installed, you should upgrade to the latest packages. First, remove <code>{directory}/vendor/compiled.php</code> file then change your current directory to <code>{directory}</code> and issue <code>composer update</code> command.</p>

<h3>Scaffolding</h3>

<p>Laravel ships with scaffolding for user registration and authentication. If you would like to remove this scaffolding, use the <code>fresh</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">fresh</span>
</pre></div>

<p><a name="server-requirements"></a></p>

<h2>Server Requirements</h2>

<p>The Laravel framework has a few system requirements:</p>

<ul>
<li>PHP &gt;= 5.4, PHP &lt; 7</li>
<li>Mcrypt PHP Extension</li>
<li>OpenSSL PHP Extension</li>
<li>Mbstring PHP Extension</li>
<li>Tokenizer PHP Extension</li>
</ul>

<p>As of PHP 5.5, some OS distributions may require you to manually install the PHP JSON extension. When using Ubuntu, this can be done via <code>apt-get install php5-json</code>.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The first thing you should do after installing Laravel is set your application key to a random string. If you installed Laravel via Composer, this key has probably already been set for you by the <code>key:generate</code> command.</p>

<p>Typically, this string should be 32 characters long. The key can be set in the <code>.env</code> environment file. <strong>If the application key is not set, your user sessions and other encrypted data will not be secure!</strong></p>

<p>Laravel needs almost no other configuration out of the box. You are free to get started developing! However, you may wish to review the <code>config/app.php</code> file and its documentation. It contains several options such as <code>timezone</code> and <code>locale</code> that you may wish to change according to your application.</p>

<p>Once Laravel is installed, you should also <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">configure your local environment</a>.</p>

<blockquote>
<p><strong>Note:</strong> You should never have the <code>app.debug</code> configuration option set to <code>true</code> for a production application.</p>
</blockquote>

<p><a name="permissions"></a></p>

<h3>Permissions</h3>

<p>Laravel may require some permissions to be configured: folders within <code>storage</code> and <code>vendor</code> require write access by the web server.</p>

<p><a name="pretty-urls"></a></p>

<h2>Pretty URLs</h2>

<h3>Apache</h3>

<p>The framework ships with a <code>public/.htaccess</code> file that is used to allow URLs without <code>index.php</code>. If you use Apache to serve your Laravel application, be sure to enable the <code>mod_rewrite</code> module.</p>

<p>If the <code>.htaccess</code> file that ships with Laravel does not work with your Apache installation, try this one:</p>
<div class="highlight"><pre><span></span><span class="nx">Options</span> <span class="o">+</span><span class="nx">FollowSymLinks</span>
<span class="nx">RewriteEngine</span> <span class="nx">On</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">d</span>
<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">f</span>
<span class="nx">RewriteRule</span> <span class="o">^</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span> <span class="p">[</span><span class="nx">L</span><span class="p">]</span>
</pre></div>

<h3>Nginx</h3>

<p>On Nginx, the following directive in your site configuration will allow &quot;pretty&quot; URLs:</p>
<div class="highlight"><pre><span></span><span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
<span class="p">}</span>
</pre></div>

<p>Of course, when using <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a>, pretty URLs will be configured automatically.</p>
<div style="page-break-after: always;" ></div><h1>Request Lifecycle</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#lifecycle-overview">Lifecycle Overview</a></li>
<li><a href="#focus-on-service-providers">Focus On Service Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When using any tool in the &quot;real world&quot;, you feel more confident if you understand how that tool works. Application development is no different. When you understand how your development tools function, you feel more comfortable and confident using them.</p>

<p>The goal of this document is to give you a good, high-level overview of how the Laravel framework &quot;works&quot;. By getting to know the overall framework better, everything feels less &quot;magical&quot; and you will be more confident building your applications.</p>

<p>If you don&#39;t understand all of the terms right away, don&#39;t lose heart! Just try to get a basic grasp of what is going on, and your knowledge will grow as you explore other sections of the documentation.</p>

<p><a name="lifecycle-overview"></a></p>

<h2>Lifecycle Overview</h2>

<h4>First Things</h4>

<p>The entry point for all requests to a Laravel application is the <code>public/index.php</code> file. All requests are directed to this file by your web server (Apache / Nginx) configuration. The <code>index.php</code> file doesn&#39;t contain much code. Rather, it is simply a starting point for loading the rest of the framework.</p>

<p>The <code>index.php</code> file loads the Composer generated autoloader definition, and then retrieves an instance of the Laravel application from <code>bootstrap/app.php</code> script. The first action taken by Laravel itself is to create an instance of the application / <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<h4>HTTP / Console Kernels</h4>

<p>Next, the incoming request is sent to either the HTTP kernel or the console kernel, depending on the type of request that is entering the application. These two kernels serve as the central location that all requests flow through. For now, let&#39;s just focus on the HTTP kernel, which is located in <code>app/Http/Kernel.php</code>.</p>

<p>The HTTP kernel extends the <code>Illuminate\Foundation\Http\Kernel</code> class, which defines an array of <code>bootstrappers</code> that will be run before the request is executed. These bootstrappers configure error handling, configure logging, detect the application environment, and perform other tasks that need to be done before the request is actually handled.</p>

<p>The HTTP kernel also defines a list of HTTP <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> that all requests must pass through before being handled by the application. These middleware handle reading and writing the HTTP session, determine if the application is in maintenance mode, verifying the CSRF token, and more.</p>

<p>The method signature for the HTTP kernel&#39;s <code>handle</code> method is quite simple: receive a <code>Request</code> and return a <code>Response</code>. Think of the Kernel as being a big black box that represents your entire application. Feed it HTTP requests and it will return HTTP responses.</p>

<h4>Service Providers</h4>

<p>One of the most important Kernel bootstrapping actions is loading the service providers for your application. All of the service providers for the application are configured in the <code>config/app.php</code> configuration file&#39;s <code>providers</code> array. First, the <code>register</code> method will be called on all providers, then, once all providers have been registered, the <code>boot</code> method will be called.</p>

<h4>Dispatch Request</h4>

<p>Once the application has been bootstrapped and all service providers have been registered, the <code>Request</code> will be handed off to the router for dispatching. The router will dispatch the request to a route or controller, as well as run any route specific middleware.</p>

<p><a name="focus-on-service-providers"></a></p>

<h2>Focus On Service Providers</h2>

<p>Service providers are truly the key to bootstrapping a Laravel application. The application instance is created, the service providers are registered, and the request is handed to the bootstrapped application. It&#39;s really that simple!</p>

<p>Having a firm grasp of how a Laravel application is built and bootstrapped via service providers is very valuable. Of course, your application&#39;s default service providers are stored in the <code>app/Providers</code> directory.</p>

<p>By default, the <code>AppServiceProvider</code> is fairly empty. This provider is a great place to add your application&#39;s own bootstrapping and service container bindings. Of course, for large applications, you may wish to create several service providers, each with a more granular type of bootstrapping.</p>
<div style="page-break-after: always;" ></div><h1>Localization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#language-files">Language Files</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#pluralization">Pluralization</a></li>
<li><a href="#validation">Validation Localization</a></li>
<li><a href="#overriding-package-language-files">Overriding Package Language Files</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Lang</code> facade provides a convenient way of retrieving strings in various languages, allowing you to easily support multiple languages within your application.</p>

<p><a name="language-files"></a></p>

<h2>Language Files</h2>

<p>Language strings are stored in files within the <code>resources/lang</code> directory. Within this directory there should be a subdirectory for each language supported by the application.</p>
<div class="highlight"><pre><span></span><span class="err">/resources</span>
    <span class="err">/lang</span>
        <span class="err">/en</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
        <span class="o">/</span><span class="nx">es</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
</pre></div>

<h4>Example Language File</h4>

<p>Language files simply return an array of keyed strings. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;welcome&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to our application&#39;</span>
<span class="p">];</span>
</pre></div>

<h4>Changing The Default Language At Runtime</h4>

<p>The default language for your application is stored in the <code>config/app.php</code> configuration file. You may change the active language at any time using the <code>App::setLocale</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">setLocale</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">);</span>
</pre></div>

<h4>Setting The Fallback Language</h4>

<p>You may also configure a &quot;fallback language&quot;, which will be used when the active language does not contain a given language line. Like the default language, the fallback language is also configured in the <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;fallback_locale&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Retrieving Lines From A Language File</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<p>The first segment of the string passed to the <code>get</code> method is the name of the language file, and the second is the name of the line that should be retrieved.</p>

<blockquote>
<p><strong>Note:</strong> If a language line does not exist, the key will be returned by the <code>get</code> method.</p>
</blockquote>

<p>You may also use the <code>trans</code> helper function, which is an alias for the <code>Lang::get</code> method.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<h4>Making Replacements In Lines</h4>

<p>You may also define place-holders in your language lines:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;welcome&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Welcome, :name&#39;</span><span class="p">,</span>
</pre></div>

<p>Then, pass a second argument of replacements to the <code>Lang::get</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Determine If A Language File Contains A Line</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Lang</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="pluralization"></a></p>

<h2>Pluralization</h2>

<p>Pluralization is a complex problem, as different languages have a variety of complex rules for pluralization. You may easily manage this in your language files. By using a &quot;pipe&quot; character, you may separate the singular and plural forms of a string:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;There is one apple|There are many apples&#39;</span><span class="p">,</span>
</pre></div>

<p>You may then use the <code>Lang::choice</code> method to retrieve the line:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;messages.apples&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>You may also supply a locale argument to specify the language. For example, if you want to use the Russian (ru) language:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;товар|товара|товаров&#39;</span><span class="p">,</span> <span class="nx">$count</span><span class="p">,</span> <span class="p">[],</span> <span class="s1">&#39;ru&#39;</span><span class="p">);</span>
</pre></div>

<p>Since the Laravel translator is powered by the Symfony Translation component, you may also create more explicit pluralization rules easily:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{0} There are none|[1,19] There are some|[20,Inf] There are many&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="validation"></a></p>

<h2>Validation</h2>

<p>For localization for validation errors and messages, take a look at the <a href="/docs/{{version}}/validation#localization">documentation on Validation</a>.</p>

<p><a name="overriding-package-language-files"></a></p>

<h2>Overriding Package Language Files</h2>

<p>Many packages ship with their own language lines. Instead of hacking the package&#39;s core files to tweak these lines, you may override them by placing files in the <code>resources/lang/packages/{locale}/{package}</code> directory. So, for example, if you need to override the English language lines in <code>messages.php</code> for a package named <code>skyrim/hearthfire</code>, you would place a language file at: <code>resources/lang/packages/en/hearthfire/messages.php</code>. In this file you would define only the language lines you wish to override. Any language lines you don&#39;t override will still be loaded from the package&#39;s language files.</p>
<div style="page-break-after: always;" ></div><h1>Mail</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#embedding-inline-attachments">Embedding Inline Attachments</a></li>
<li><a href="#queueing-mail">Queueing Mail</a></li>
<li><a href="#mail-and-local-development">Mail &amp; Local Development</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides a clean, simple API over the popular <a href="http://swiftmailer.org">SwiftMailer</a> library. The mail configuration file is <code>config/mail.php</code>, and contains options allowing you to change your SMTP host, port, and credentials, as well as set a global <code>from</code> address for all messages delivered by the library. You may use any SMTP server you wish. If you wish to use the PHP <code>mail</code> function to send mail, you may change the <code>driver</code> to <code>mail</code> in the configuration file. A <code>sendmail</code> driver is also available.</p>

<h3>API Drivers</h3>

<p>Laravel also includes drivers for the Mailgun and Mandrill HTTP APIs. These APIs are often simpler and quicker than the SMTP servers. Both of these drivers require that the Guzzle 5 HTTP library be installed into your application. You can add Guzzle 5 to your project by adding the following line to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;guzzlehttp/guzzle&quot;</span><span class="o">:</span> <span class="s2">&quot;~5.0&quot;</span>
</pre></div>

<h4>Mailgun Driver</h4>

<p>To use the Mailgun driver, set the <code>driver</code> option to <code>mailgun</code> in your <code>config/mail.php</code> configuration file. Next, create an <code>config/services.php</code> configuration file if one does not already exist for your project. Verify that it contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mailgun&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-key&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>Mandrill Driver</h4>

<p>To use the Mandrill driver, set the <code>driver</code> option to <code>mandrill</code> in your <code>config/mail.php</code> configuration file. Next, create an <code>config/services.php</code> configuration file if one does not already exist for your project. Verify that it contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mandrill&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mandrill-key&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h3>Log Driver</h3>

<p>If the <code>driver</code> option of your <code>config/mail.php</code> configuration file is set to <code>log</code>, all e-mails will be written to your log files, and will not actually be sent to any of the recipients. This is primarily useful for quick, local debugging and content verification.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>The <code>Mail::send</code> method may be used to send an e-mail message:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>send</code> method is the name of the view that should be used as the e-mail body. The second is the data to be passed to the view, often as an associative array where the data items are available to the view by <code>$key</code>. The third is a Closure allowing you to specify various options on the e-mail message.</p>

<blockquote>
<p><strong>Note:</strong> A <code>$message</code> variable is always passed to e-mail views, and allows the inline embedding of attachments. So, it is best to avoid passing a <code>message</code> variable in your view payload.</p>
</blockquote>

<p>You may also specify a plain text view to use in addition to an HTML view:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">([</span><span class="s1">&#39;html.view&#39;</span><span class="p">,</span> <span class="s1">&#39;text.view&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>Or, you may specify only one type of view using the <code>html</code> or <code>text</code> keys:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">([</span><span class="s1">&#39;text&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>You may specify other options on the e-mail message such as any carbon copies or attachments as well:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;us@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When attaching files to a message, you may also specify a MIME type and / or a display name:</p>
<div class="highlight"><pre><span></span><span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="nx">$display</span><span class="p">,</span> <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="nx">$mime</span><span class="p">]);</span>
</pre></div>

<p>If you just need to e-mail a simple string instead of an entire view, use the <code>raw</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;Text to e-mail&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;us@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The message instance passed to a <code>Mail::send</code> Closure extends the SwiftMailer message class, allowing you to call any method on that class to build your e-mail messages.</p>
</blockquote>

<p><a name="embedding-inline-attachments"></a></p>

<h2>Embedding Inline Attachments</h2>

<p>Embedding inline images into your e-mails is typically cumbersome; however, Laravel provides a convenient way to attach images to your e-mails and retrieving the appropriate CID.</p>

<h4>Embedding An Image In An E-Mail View</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embed</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<h4>Embedding Raw Data In An E-Mail View</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">from</span> <span class="nx">raw</span> <span class="nx">data</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embedData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<p>Note that the <code>$message</code> variable is always passed to e-mail views by the <code>Mail</code> facade.</p>

<p><a name="queueing-mail"></a></p>

<h2>Queueing Mail</h2>

<h4>Queueing A Mail Message</h4>

<p>Since sending e-mail messages can drastically lengthen the response time of your application, many developers choose to queue e-mail messages for background sending. Laravel makes this easy using its built-in <a href="/docs/%7B%7Bversion%7D%7D/queues">unified queue API</a>. To queue a mail message, simply use the <code>queue</code> method on the <code>Mail</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may also specify the number of seconds you wish to delay the sending of the mail message using the <code>later</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">later</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to specify a specific queue or &quot;tube&quot; on which to push the message, you may do so using the <code>queueOn</code> and <code>laterOn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queueOn</span><span class="p">(</span><span class="s1">&#39;queue-name&#39;</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="mail-and-local-development"></a></p>

<h2>Mail &amp; Local Development</h2>

<p>When developing an application that sends e-mail, it&#39;s usually desirable to disable the sending of messages from your local or development environment. To do so, you may either call the <code>Mail::pretend</code> method, or set the <code>pretend</code> option in the <code>config/mail.php</code> configuration file to <code>true</code>. When the mailer is in <code>pretend</code> mode, messages will be written to your application&#39;s log files instead of being sent to the recipient.</p>

<p>If you would like to actually view the test e-mails, consider using a service like <a href="https://mailtrap.io">MailTrap</a>.</p>
<div style="page-break-after: always;" ></div><h1>HTTP Middleware</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-middleware">Defining Middleware</a></li>
<li><a href="#registering-middleware">Registering Middleware</a></li>
<li><a href="#terminable-middleware">Terminable Middleware</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>HTTP middleware provide a convenient mechanism for filtering HTTP requests entering your application. For example, Laravel includes a middleware that verifies the user of your application is authenticated. If the user is not authenticated, the middleware will redirect the user to the login screen. However, if the user is authenticated, the middleware will allow the request to proceed further into the application.</p>

<p>Of course, middleware can be written to perform a variety of tasks besides authentication. A CORS middleware might be responsible for adding the proper headers to all responses leaving your application. A logging middleware might log all incoming requests to your application.</p>

<p>There are several middleware included in the Laravel framework, including middleware for maintenance, authentication, CSRF protection, and more. All of these middleware are located in the <code>app/Http/Middleware</code> directory.</p>

<p><a name="defining-middleware"></a></p>

<h2>Defining Middleware</h2>

<p>To create a new middleware, use the <code>make:middleware</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">middleware</span> <span class="nx">OldMiddleware</span>
</pre></div>

<p>This command will place a new <code>OldMiddleware</code> class within your <code>app/Http/Middleware</code> directory. In this middleware, we will only allow access to the route if the supplied <code>age</code> is greater than 200. Otherwise, we will redirect the users back to the &quot;home&quot; URI.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OldMiddleware</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Run the request filter.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>As you can see, if the given <code>age</code> is less than <code>200</code>, the middleware will return an HTTP redirect to the client; otherwise, the request will be passed further into the application. To pass the request deeper into the application (allowing the middleware to &quot;pass&quot;), simply call the <code>$next</code> callback with the <code>$request</code>.</p>

<p>It&#39;s best to envision middleware as a series of &quot;layers&quot; HTTP requests must pass through before they hit your application. Each layer can examine the request and even reject it entirely.</p>

<h3><em>Before</em> / <em>After</em> Middleware</h3>

<p>Whether a middleware runs before or after a request depends on the middleware itself. This middleware would perform some task <strong>before</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BeforeMiddleware</span> <span class="k">implements</span> <span class="nx">Middleware</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>However, this middleware would perform its task <strong>after</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AfterMiddleware</span> <span class="k">implements</span> <span class="nx">Middleware</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-middleware"></a></p>

<h2>Registering Middleware</h2>

<h3>Global Middleware</h3>

<p>If you want a middleware to be run during every HTTP request to your application, simply list the middleware class in the <code>$middleware</code> property of your <code>app/Http/Kernel.php</code> class.</p>

<h3>Assigning Middleware To Routes</h3>

<p>If you would like to assign middleware to specific routes, you should first assign the middleware a short-hand key in your <code>app/Http/Kernel.php</code> file. By default, the <code>$routeMiddleware</code> property of this class contains entries for the middleware included with Laravel. To add your own, simply append it to this list and assign it a key of your choosing.</p>

<p>Once the middleware has been defined in the HTTP kernel, you may use the <code>middleware</code> key in the route options array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p><a name="terminable-middleware"></a></p>

<h2>Terminable Middleware</h2>

<p>Sometimes a middleware may need to do some work after the HTTP response has already been sent to the browser. For example, the &quot;session&quot; middleware included with Laravel writes the session data to storage <em>after</em> the response has been sent to the browser. To accomplish this, you may define the middleware as &quot;terminable&quot;.</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">TerminableMiddleware</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">StartSession</span> <span class="kr">implements</span> <span class="nx">TerminableMiddleware</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">terminate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Store the session data...</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>As you can see, in addition to defining a <code>handle</code> method, <code>TerminableMiddleware</code> define a <code>terminate</code> method. This method receives both the request and the response. Once you have defined a terminable middleware, you should add it to the list of global middlewares in your HTTP kernel.</p>
<div style="page-break-after: always;" ></div><h1>Migrations &amp; Seeding</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-migrations">Creating Migrations</a></li>
<li><a href="#running-migrations">Running Migrations</a></li>
<li><a href="#rolling-back-migrations">Rolling Back Migrations</a></li>
<li><a href="#database-seeding">Database Seeding</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Migrations are a type of version control for your database. They allow a team to modify the database schema and stay up to date on the current schema state. Migrations are typically paired with the <a href="/docs/%7B%7Bversion%7D%7D/schema">Schema Builder</a> to easily manage your application&#39;s schema.</p>

<p><a name="creating-migrations"></a></p>

<h2>Creating Migrations</h2>

<p>To create a migration, you may use the <code>make:migration</code> command on the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span>
</pre></div>

<p>The migration will be placed in your <code>database/migrations</code> folder, and will contain a timestamp which allows the framework to determine the order of the migrations.</p>

<p>The <code>--table</code> and <code>--create</code> options may also be used to indicate the name of the table, and whether the migration will be creating a new table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">add_votes_to_users_table</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">users</span>
</pre></div>

<p><a name="running-migrations"></a></p>

<h2>Running Migrations</h2>

<h4>Running All Outstanding Migrations</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If you receive a &quot;class not found&quot; error when running migrations, try running the <code>composer dump-autoload</code> command.</p>
</blockquote>

<h3>Forcing Migrations In Production</h3>

<p>Some migration operations are destructive, meaning they may cause you to lose data. In order to protect you from running these commands against your production database, you will be prompted for confirmation before these commands are executed. To force the commands to run without a prompt, use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p><a name="rolling-back-migrations"></a></p>

<h2>Rolling Back Migrations</h2>

<h4>Rollback The Last Migration Operation</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">rollback</span>
</pre></div>

<h4>Rollback all migrations</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">reset</span>
</pre></div>

<h4>Rollback all migrations and run them all again</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p><a name="database-seeding"></a></p>

<h2>Database Seeding</h2>

<p>Laravel also includes a simple way to seed your database with test data using seed classes. All seed classes are stored in <code>database/seeds</code>. Seed classes may have any name you wish, but probably should follow some sensible convention, such as <code>UserTableSeeder</code>, etc. By default, a <code>DatabaseSeeder</code> class is defined for you. From this class, you may use the <code>call</code> method to run other seed classes, allowing you to control the seeding order.</p>

<h4>Example Database Seed Class</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">DatabaseSeeder</span> <span class="kr">extends</span> <span class="nx">Seeder</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;UserTableSeeder&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">command</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;User table seeded!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">UserTableSeeder</span> <span class="kr">extends</span> <span class="nx">Seeder</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

        <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo@bar.com&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>To seed your database, you may use the <code>db:seed</code> command on the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span>
</pre></div>

<p>By default, the <code>db:seed</code> command runs the <code>DatabaseSeeder</code> class, which may be used to call other seed classes. However, you may use the <code>--class</code> option to specify a specific seeder class to run individually:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="kr">class</span><span class="o">=</span><span class="nx">UserTableSeeder</span>
</pre></div>

<p>You may also seed your database using the <code>migrate:refresh</code> command, which will also rollback and re-run all of your migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Package Development</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#views">Views</a></li>
<li><a href="#translations">Translations</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#public-assets">Public Assets</a></li>
<li><a href="#publishing-file-groups">Publishing File Groups</a></li>
<li><a href="#routing">Routing</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Packages are the primary way of adding functionality to Laravel. Packages might be anything from a great way to work with dates like <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, or an entire BDD testing framework like <a href="https://github.com/Behat/Behat">Behat</a>.</p>

<p>Of course, there are different types of packages. Some packages are stand-alone, meaning they work with any framework, not just Laravel. Both Carbon and Behat are examples of stand-alone packages. Any of these packages may be used with Laravel by simply requesting them in your <code>composer.json</code> file.</p>

<p>On the other hand, other packages are specifically intended for use with Laravel. These packages may have routes, controllers, views, and configuration specifically intended to enhance a Laravel application. This guide primarily covers the development of those that are Laravel specific.</p>

<p>All Laravel packages are distributed via <a href="http://packagist.org">Packagist</a> and <a href="http://getcomposer.org">Composer</a>, so learning about these wonderful PHP package distribution tools is essential.</p>

<p><a name="views"></a></p>

<h2>Views</h2>

<p>Your package&#39;s internal structure is entirely up to you; however, typically each package will contain one or more <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a>. The service provider contains any <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> bindings, as well as instructions as to where package configuration, views, and translation files are located.</p>

<h3>Views</h3>

<p>Package views are typically referenced using a double-colon &quot;namespace&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;package::view.name&#39;</span><span class="p">);</span>
</pre></div>

<p>All you need to do is tell Laravel where the views for a given namespace are located. For example, if your package is named &quot;courier&quot;, you might add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Now you may load your package views using the following syntax:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;courier::view.name&#39;</span><span class="p">);</span>
</pre></div>

<p>When you use the <code>loadViewsFrom</code> method, Laravel actually registers <strong>two</strong> locations for your views: one in the application&#39;s <code>resources/views/vendor</code> directory and one in the directory you specify. So, using our <code>courier</code> example: when requesting a package view, Laravel will first check if a custom version of the view has been provided by the developer in <code>resources/views/vendor/courier</code>. Then, if the view has not been customized, Laravel will search the package view directory you specified in your call to <code>loadViewsFrom</code>. This makes it easy for end-users to customize / override your package&#39;s views.</p>

<h4>Publishing Views</h4>

<p>To publish your package&#39;s views to the <code>resources/views/vendor</code> directory, you should use the <code>publishes</code> method from the <code>boot</code> method of your service provider:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span> <span class="p">=&gt;</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;resources/views/vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> command, your views directory will be copied to the specified location.</p>

<p>If you would like to overwrite existing files, use the <code>--force</code> switch:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You may use the <code>publishes</code> method to publish <strong>any</strong> type of file to any location you wish.</p>
</blockquote>

<p><a name="translations"></a></p>

<h2>Translations</h2>

<p>Package translation files are typically referenced using a double-colon syntax:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;package::file.line&#39;</span><span class="p">);</span>
</pre></div>

<p>All you need to do is tell Laravel where the translations for a given namespace are located. For example, if your package is named &quot;courier&quot;, you might add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadTranslationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Note that within your <code>translations</code> folder, you would have further directories for each language, such as <code>en</code>, <code>es</code>, <code>ru</code>, etc.</p>

<p>Now you may load your package translations using the following syntax:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;courier::file.line&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Typically, you will want to publish your package&#39;s configuration file to the application&#39;s own <code>config</code> directory. This will allow users of your package to easily override your default configuration options.</p>

<p>To publish a configuration file, just use the <code>publishes</code> method from the <code>boot</code> method of your service provider:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
    <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;courier.php&#39;</span><span class="p">),</span>
<span class="p">]);</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> command, your file will be copied to the specified location. Of course, once your configuration has been published, it can be accessed like any other configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;courier.option&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also choose to merge your own package configuration file with the application&#39;s copy. This allows your users to include only the options they actually want to override in the published copy of the configuration. To merge the configurations, use the <code>mergeConfigFrom</code> method within your service provider&#39;s <code>register</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mergeConfigFrom</span><span class="p">(</span>
    <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span>
<span class="p">);</span>
</pre></div>

<p><a name="public-assets"></a></p>

<h2>Public Assets</h2>

<p>Your packages may have assets such as JavaScript, CSS, and images. To publish assets, use the <code>publishes</code> method from your service provider&#39;s <code>boot</code> method. In this example, we will also add a &quot;public&quot; asset group tag.</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
    <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/assets&#39;</span> <span class="p">=&gt;</span> <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;vendor/courier&#39;</span><span class="p">),</span>
<span class="p">],</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</pre></div>

<p>Now, when your package&#39;s users execute the <code>vendor:publish</code> command, your files will be copied to the specified location. Since you typically will need to overwrite the assets every time the package is updated, you may use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="kr">public</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p>If you would like to make sure your public assets are always up-to-date, you can add this command to the <code>post-update-cmd</code> list in your <code>composer.json</code> file.</p>

<p><a name="publishing-file-groups"></a></p>

<h2>Publishing File Groups</h2>

<p>You may want to publish groups of files separately. For instance, you might want your users to be able to publish your package&#39;s configuration files and asset files separately. You can do this by &#39;tagging&#39; them:</p>
<div class="highlight"><pre><span></span><span class="c1">// Publish a config file</span>
<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
    <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../config/package.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;package.php&#39;</span><span class="p">)</span>
<span class="p">],</span> <span class="s1">&#39;config&#39;</span><span class="p">);</span>

<span class="c1">// Publish your migrations</span>
<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
    <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../database/migrations/&#39;</span> <span class="p">=&gt;</span> <span class="nx">database_path</span><span class="p">(</span><span class="s1">&#39;/migrations&#39;</span><span class="p">)</span>
<span class="p">],</span> <span class="s1">&#39;migrations&#39;</span><span class="p">);</span>
</pre></div>

<p>You can then publish these files separately by referencing their tag like so:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&quot;Vendor\Providers\PackageServiceProvider&quot;</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="s2">&quot;config&quot;</span>
</pre></div>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p>To load a routes file for your package, simply <code>include</code> it from within your service provider&#39;s <code>boot</code> method.</p>

<h4>Including A Routes File From A Service Provider</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">include</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../../routes.php&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If your package is using controllers, you will need to make sure they are properly configured in your <code>composer.json</code> file&#39;s auto-load section.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Pagination</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#appending-to-pagination-links">Appending To Pagination Links</a></li>
<li><a href="#converting-to-json">Converting To JSON</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>In other frameworks, pagination can be very painful. Laravel makes it a breeze. Laravel can generate an intelligent &quot;range&quot; of links based on the current page. The generated HTML is compatible with the Bootstrap CSS framework.</p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<p>There are several ways to paginate items. The simplest is by using the <code>paginate</code> method on the query builder or an Eloquent model.</p>

<h4>Paginating Database Results</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Currently, pagination operations that use a <code>groupBy</code> statement cannot be executed efficiently by Laravel. If you need to use a <code>groupBy</code> with a paginated result set, it is recommended that you query the database and create a paginator manually.</p>
</blockquote>

<h4>Creating A Paginator Manually</h4>

<p>Sometimes you may wish to create a pagination instance manually, passing it an array of items. You may do so by creating either an <code>Illuminate\Pagination\Paginator</code> or <code>Illuminate\Pagination\LengthAwarePaginator</code> instance, depending on your needs.</p>

<h4>Paginating An Eloquent Model</h4>

<p>You may also paginate <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models:</p>
<div class="highlight"><pre><span></span><span class="nx">$allUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

<span class="nx">$someUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>The argument passed to the <code>paginate</code> method is the number of items you wish to display per page. Once you have retrieved the results, you may display them on your view, and create the pagination links using the <code>render</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This is all it takes to create a pagination system! Note that we did not have to inform the framework of the current page. Laravel will determine this for you automatically.</p>

<p>You may also access additional pagination information via the following methods:</p>

<ul>
<li><code>currentPage</code></li>
<li><code>lastPage</code></li>
<li><code>perPage</code></li>
<li><code>hasMorePages</code></li>
<li><code>url</code></li>
<li><code>nextPageUrl</code></li>
<li><code>firstItem</code></li>
<li><code>lastItem</code></li>
<li><code>total</code></li>
<li><code>count</code></li>
</ul>

<h4>&quot;Simple Pagination&quot;</h4>

<p>If you are only showing &quot;Next&quot; and &quot;Previous&quot; links in your pagination view, you have the option of using the <code>simplePaginate</code> method to perform a more efficient query. This is useful for larger datasets when you do not require the display of exact page numbers on your view:</p>
<div class="highlight"><pre><span></span><span class="nx">$someUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<h4>Customizing The Paginator URI</h4>

<p>You may also customize the URI used by the paginator via the <code>setPath</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">();</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">setPath</span><span class="p">(</span><span class="s1">&#39;custom/url&#39;</span><span class="p">);</span>
</pre></div>

<p>The example above will create URLs like the following: http://example.com/custom/url?page=2</p>

<p><a name="appending-to-pagination-links"></a></p>

<h2>Appending To Pagination Links</h2>

<p>You can add to the query string of pagination links using the <code>appends</code> method on the Paginator:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">appends</span><span class="p">([</span><span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;votes&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This will generate URLs that look something like this:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com/something?page=2&amp;sort=votes</span>
</pre></div>

<p>If you wish to append a &quot;hash fragment&quot; to the paginator&#39;s URLs, you may use the <code>fragment</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">fragment</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This method call will generate URLs that look something like this:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com/something?page=2#foo</span>
</pre></div>

<p><a name="converting-to-json"></a></p>

<h2>Converting To JSON</h2>

<p>The <code>Paginator</code> class implements the <code>Illuminate\Contracts\Support\JsonableInterface</code> contract and exposes the <code>toJson</code> method. You may also convert a <code>Paginator</code> instance to JSON by returning it from a route. The JSON&#39;d form of the instance will include some &quot;meta&quot; information such as <code>total</code>, <code>current_page</code>, and <code>last_page</code>. The instance&#39;s data will be available via the <code>data</code> key in the JSON array.</p>
<div style="page-break-after: always;" ></div><h1>Service Providers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-provider-example">Basic Provider Example</a></li>
<li><a href="#registering-providers">Registering Providers</a></li>
<li><a href="#deferred-providers">Deferred Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Service providers are the central place of all Laravel application bootstrapping. Your own application, as well as all of Laravel&#39;s core services are bootstrapped via service providers.</p>

<p>But, what do we mean by &quot;bootstrapped&quot;? In general, we mean <strong>registering</strong> things, including registering service container bindings, event listeners, filters, and even routes. Service providers are the central place to configure your application.</p>

<p>If you open the <code>config/app.php</code> file included with Laravel, you will see a <code>providers</code> array. These are all of the service provider classes that will be loaded for your application. Of course, many of them are &quot;deferred&quot; providers, meaning they will not be loaded on every request, but only when the services they provide are actually needed.</p>

<p>In this overview you will learn how to write your own service providers and register them with your Laravel application.</p>

<p><a name="basic-provider-example"></a></p>

<h2>Basic Provider Example</h2>

<p>All service providers extend the <code>Illuminate\Support\ServiceProvider</code> class. This abstract class requires that you define at least one method on your provider: <code>register</code>. Within the <code>register</code> method, you should <strong>only bind things into the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a></strong>. You should never attempt to register any event listeners, routes, or any other piece of functionality within the <code>register</code> method.</p>

<p>The Artisan CLI can easily generate a new provider via the <code>make:provider</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">provider</span> <span class="nx">RiakServiceProvider</span>
</pre></div>

<h3>The Register Method</h3>

<p>Now, let&#39;s take a look at a basic service provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;riak&#39;</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>This service provider only defines a <code>register</code> method, and uses that method to define an implementation of <code>Riak\Contracts\Connection</code> in the service container. If you don&#39;t understand how the service container works, don&#39;t worry, <a href="/docs/%7B%7Bversion%7D%7D/container">we&#39;ll cover that soon</a>.</p>

<p>This class is namespaced under <code>App\Providers</code> since that is the default location for service providers in Laravel. However, you are free to change this as you wish. Your service providers may be placed anywhere that Composer can autoload them.</p>

<h3>The Boot Method</h3>

<p>So, what if we need to register an event listener within our service provider? This should be done within the <code>boot</code> method. <strong>This method is called after all other service providers have been registered</strong>, meaning you have access to all other services that have been registered by the framework.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="s1">&#39;SomeEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;SomeEventHandler&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>We are able to type-hint dependencies for our <code>boot</code> method. The service container will automatically inject any dependencies you need:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">Dispatcher</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">Dispatcher</span> <span class="nx">$events</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;SomeEvent&#39;</span><span class="p">,</span> <span class="s1">&#39;SomeEventHandler&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-providers"></a></p>

<h2>Registering Providers</h2>

<p>All service providers are registered in the <code>config/app.php</code> configuration file. This file contains a <code>providers</code> array where you can list the names of your service providers. By default, a set of Laravel core service providers are listed in this array. These providers bootstrap the core Laravel components, such as the mailer, queue, cache, and others.</p>

<p>To register your provider, simply add it to the array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// Other Service Providers</span>

    <span class="s1">&#39;App\Providers\AppServiceProvider&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="deferred-providers"></a></p>

<h2>Deferred Providers</h2>

<p>If your provider is <strong>only</strong> registering bindings in the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, you may choose to defer its registration until one of the registered bindings is actually needed. Deferring the loading of such a provider will improve the performance of your application, since it is not loaded from the filesystem on every request.</p>

<p>To defer the loading of a provider, set the <code>defer</code> property to <code>true</code> and define a <code>provides</code> method. The <code>provides</code> method returns the service container bindings that the provider registers:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Indicates if loading of the provider is deferred.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$defer</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;riak&#39;</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the services provided by the provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Riak\Contracts\Connection&#39;</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Laravel compiles and stores a list of all of the services supplied by deferred service providers, along with the name of its service provider class. Then, only when you attempt to resolve one of these services does Laravel load the service provider.</p>
<div style="page-break-after: always;" ></div><h1>Query Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#selects">Selects</a></li>
<li><a href="#joins">Joins</a></li>
<li><a href="#advanced-wheres">Advanced Wheres</a></li>
<li><a href="#aggregates">Aggregates</a></li>
<li><a href="#raw-expressions">Raw Expressions</a></li>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a></li>
<li><a href="#deletes">Deletes</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#pessimistic-locking">Pessimistic Locking</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The database query builder provides a convenient, fluent interface to creating and running database queries. It can be used to perform most database operations in your application, and works on all supported database systems.</p>

<blockquote>
<p><strong>Note:</strong> The Laravel query builder uses PDO parameter binding throughout to protect your application against SQL injection attacks. There is no need to clean strings being passed as bindings.</p>
</blockquote>

<p><a name="selects"></a></p>

<h2>Selects</h2>

<h4>Retrieving All Rows From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Chunking Results From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>You may stop further chunks from being processed by returning <code>false</code> from the <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Retrieving A Single Row From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Single Column From A Row</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A List Of Column Values</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
</pre></div>

<p>This method will return an array of role titles. You may also specify a custom key column for the returned array:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Specifying A Select Clause</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">distinct</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name as user_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Adding A Select Clause To An Existing Query</h4>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">addSelect</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Operators</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Or Statements</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Between</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Not Between</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where In With An Array</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Null To Find Records With Unset Values</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Dynamic Where Clauses</h4>

<p>You may even use &quot;dynamic&quot; where statements to fluently build where statements using magic methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$admin</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whereId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$john</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereIdAndEmail</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;john@doe.com&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$jane</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNameOrAge</span><span class="p">(</span><span class="s1">&#39;Jane&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<h4>Order By, Group By, And Having</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">having</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Offset &amp; Limit</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="joins"></a></p>

<h2>Joins</h2>

<p>The query builder may also be used to write join statements. Take a look at the following examples:</p>

<h4>Basic Join Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.phone&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.price&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Left Join Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">leftJoin</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;posts.user_id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify more advanced join clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$join</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orOn</span><span class="p">(...);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you would like to use a &quot;where&quot; style clause on your joins, you may use the <code>where</code> and <code>orWhere</code> methods on a join. Instead of comparing two columns, these methods will compare the column against a value:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$join</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;contacts.user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="advanced-wheres"></a></p>

<h2>Advanced Wheres</h2>

<h4>Parameter Grouping</h4>

<p>Sometimes you may need to create more advanced where clauses such as &quot;where exists&quot; or nested parameter groupings. The Laravel query builder can handle these as well:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">or</span> <span class="p">(</span><span class="nx">votes</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="nx">and</span> <span class="nx">title</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
</pre></div>

<h4>Exists Statements</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereExists</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                      <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;orders.user_id = users.id&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span>
<span class="nx">where</span> <span class="nx">exists</span> <span class="p">(</span>
    <span class="nx">select</span> <span class="mi">1</span> <span class="nx">from</span> <span class="nx">orders</span> <span class="nx">where</span> <span class="nx">orders</span><span class="p">.</span><span class="nx">user_id</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
<span class="p">)</span>
</pre></div>

<p><a name="aggregates"></a></p>

<h2>Aggregates</h2>

<p>The query builder also provides a variety of aggregate methods, such as <code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, and <code>sum</code>.</p>

<h4>Using Aggregate Methods</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$total</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="raw-expressions"></a></p>

<h2>Raw Expressions</h2>

<p>Sometimes you may need to use a raw expression in a query. These expressions will be injected into the query as strings, so be careful not to create any SQL injection points! To create a raw expression, you may use the <code>DB::raw</code> method:</p>

<h4>Using A Raw Expression</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;count(*) as user_count, status&#39;</span><span class="p">))</span>
                     <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="inserts"></a></p>

<h2>Inserts</h2>

<h4>Inserting Records Into A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<h4>Inserting Records Into A Table With An Auto-Incrementing ID</h4>

<p>If the table has an auto-incrementing id, use <code>insertGetId</code> to insert a record and retrieve the id:</p>
<div class="highlight"><pre><span></span><span class="nx">$id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insertGetId</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When using PostgreSQL the insertGetId method expects the auto-incrementing column to be named &quot;id&quot;.</p>
</blockquote>

<h4>Inserting Multiple Records Into A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>

<p><a name="updates"></a></p>

<h2>Updates</h2>

<h4>Updating Records In A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Incrementing or decrementing a value of a column</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may also specify additional columns to update:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="deletes"></a></p>

<h2>Deletes</h2>

<h4>Deleting Records In A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting All Records From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Truncating A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">truncate</span><span class="p">();</span>
</pre></div>

<p><a name="unions"></a></p>

<h2>Unions</h2>

<p>The query builder also provides a quick way to &quot;union&quot; two queries together:</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">union</span><span class="p">(</span><span class="nx">$first</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>unionAll</code> method is also available, and has the same method signature as <code>union</code>.</p>

<p><a name="pessimistic-locking"></a></p>

<h2>Pessimistic Locking</h2>

<p>The query builder includes a few functions to help you do &quot;pessimistic locking&quot; on your SELECT statements.</p>

<p>To run the SELECT statement with a &quot;shared lock&quot;, you may use the <code>sharedLock</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sharedLock</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>To &quot;lock for update&quot; on a SELECT statement, you may use the <code>lockForUpdate</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lockForUpdate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Queues</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#queueing-closures">Queueing Closures</a></li>
<li><a href="#running-the-queue-listener">Running The Queue Listener</a></li>
<li><a href="#daemon-queue-worker">Daemon Queue Worker</a></li>
<li><a href="#push-queues">Push Queues</a></li>
<li><a href="#failed-jobs">Failed Jobs</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The Laravel Queue component provides a unified API across a variety of different queue services. Queues allow you to defer the processing of a time consuming task, such as sending an e-mail, until a later time, thus drastically speeding up the web requests to your application.</p>

<p>The queue configuration file is stored in <code>config/queue.php</code>. In this file you will find connection configurations for each of the queue drivers that are included with the framework, which includes a database, <a href="http://kr.github.com/beanstalkd">Beanstalkd</a>, <a href="http://iron.io">IronMQ</a>, <a href="http://aws.amazon.com/sqs">Amazon SQS</a>, <a href="http://redis.io">Redis</a>, null, and synchronous (for local use) driver. The <code>null</code> queue driver simply discards queued jobs so they are never run.</p>

<h3>Queue Database Table</h3>

<p>In order to use the <code>database</code> queue driver, you will need a database table to hold the jobs. To generate a migration to create this table, run the <code>queue:table</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">table</span>
</pre></div>

<h3>Other Queue Dependencies</h3>

<p>The following dependencies are needed for the listed queue drivers:</p>

<ul>
<li>Amazon SQS: <code>aws/aws-sdk-php</code></li>
<li>Beanstalkd: <code>pda/pheanstalk ~3.0</code></li>
<li>IronMQ: <code>iron-io/iron_mq ~1.5</code></li>
<li>Redis: <code>predis/predis ~1.0</code></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Pushing A Job Onto The Queue</h4>

<p>All of the queueable jobs for your application are stored in the <code>App\Commands</code> directory. You may generate a new queued command using the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">SendEmail</span> <span class="o">--</span><span class="nx">queued</span>
</pre></div>

<p>To push a new job onto the queue, use the <code>Queue::push</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">SendEmail</span><span class="p">(</span><span class="nx">$message</span><span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> In this example, we are using the <code>Queue</code> facade directly; however, typically you would dispatch queued command via the <a href="/docs/%7B%7Bversion%7D%7D/bus">Command Bus</a>. We will continue to use the <code>Queue</code> facade throughout this page; however, familiarize with the command bus as well, since it is used to dispatch both queued and synchronous commands for your application.</p>
</blockquote>

<p>By default, the <code>make:command</code> Artisan command generates a &quot;self-handling&quot; command, meaning a <code>handle</code> method is added to the command itself. This method will be called when the job is executed by the queue. You may type-hint any dependencies you need on the <code>handle</code> method and the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject them:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nx">$users</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you would like your command to have a separate handler class, you should add the <code>--handler</code> flag to the <code>make:command</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">SendEmail</span> <span class="o">--</span><span class="nx">queued</span> <span class="o">--</span><span class="nx">handler</span>
</pre></div>

<p>The generated handler will be placed in <code>App\Handlers\Commands</code> and will be resolved out of the IoC container.</p>

<h4>Specifying The Queue / Tube For A Job</h4>

<p>You may also specify the queue / tube a job should be sent to:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">pushOn</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">SendEmail</span><span class="p">(</span><span class="nx">$message</span><span class="p">));</span>
</pre></div>

<h4>Passing The Same Payload To Multiple Jobs</h4>

<p>If you need to pass the same data to several queue jobs, you may use the <code>Queue::bulk</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">bulk</span><span class="p">([</span><span class="k">new</span> <span class="nx">SendEmail</span><span class="p">(</span><span class="nx">$message</span><span class="p">),</span> <span class="k">new</span> <span class="nx">AnotherCommand</span><span class="p">]);</span>
</pre></div>

<h4>Delaying The Execution Of A Job</h4>

<p>Sometimes you may wish to delay the execution of a queued job. For instance, you may wish to queue a job that sends a customer an e-mail 15 minutes after sign-up. You can accomplish this using the <code>Queue::later</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$date</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

<span class="nx">Queue</span><span class="o">::</span><span class="nx">later</span><span class="p">(</span><span class="nx">$date</span><span class="p">,</span> <span class="k">new</span> <span class="nx">SendEmail</span><span class="p">(</span><span class="nx">$message</span><span class="p">));</span>
</pre></div>

<p>In this example, we&#39;re using the <a href="https://github.com/briannesbitt/Carbon">Carbon</a> date library to specify the delay we wish to assign to the job. Alternatively, you may pass the number of seconds you wish to delay as an integer.</p>

<blockquote>
<p><strong>Note:</strong> The Amazon SQS service has a delay limit of 900 seconds (15 minutes).</p>
</blockquote>

<h4>Queues And Eloquent Models</h4>

<p>If your queued job accepts an Eloquent model in its constructor, only the identifier for the model will be serialized onto the queue. When the job is actually handled, the queue system will automatically re-retrieve the full model instance from the database. It&#39;s all totally transparent to your application and prevents issues that can arise from serializing full Eloquent model instances.</p>

<h4>Deleting A Processed Job</h4>

<p>Once you have processed a job, it must be deleted from the queue. If no exception is thrown during the execution of your job, this will be done automatically.</p>

<p>If you would like to <code>delete</code> or <code>release</code> the job manually, the <code>Illuminate\Queue\InteractsWithQueue</code> trait provides access to the queue job <code>release</code> and <code>delete</code> methods. The <code>release</code> method accepts a single value: the number of seconds you wish to wait until the job is made available again.</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">SendEmail</span> <span class="nx">$command</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Releasing A Job Back Onto The Queue</h4>

<p>IF an exception is thrown while the job is being processed, it will automatically be released back onto the queue so it may be attempted again. The job will continue to be released until it has been attempted the maximum number of times allowed by your application. The number of maximum attempts is defined by the <code>--tries</code> switch used on the <code>queue:listen</code> or <code>queue:work</code> Artisan commands.</p>

<h4>Checking The Number Of Run Attempts</h4>

<p>If an exception occurs while the job is being processed, it will automatically be released back onto the queue. You may check the number of attempts that have been made to run the job using the <code>attempts</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attempts</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Your command / handler must use the <code>Illuminate\Queue\InteractsWithQueue</code> trait in order to call this method.</p>
</blockquote>

<p><a name="queueing-closures"></a></p>

<h2>Queueing Closures</h2>

<p>You may also push a Closure onto the queue. This is very convenient for quick, simple tasks that need to be queued:</p>

<h4>Pushing A Closure Onto The Queue</h4>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$job</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">Account</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>

    <span class="nx">$job</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Instead of making objects available to queued Closures via the <code>use</code> directive, consider passing primary keys and re-pulling the associated models from within your queue job. This often avoids unexpected serialization behavior.</p>
</blockquote>

<p>When using Iron.io <a href="#push-queues">push queues</a>, you should take extra precaution queueing Closures. The end-point that receives your queue messages should check for a token to verify that the request is actually from Iron.io. For example, your push queue end-point should be something like: <code>https://yourapp.com/queue/receive?token=SecretToken</code>. You may then check the value of the secret token in your application before marshalling the queue request.</p>

<p><a name="running-the-queue-listener"></a></p>

<h2>Running The Queue Listener</h2>

<p>Laravel includes an Artisan task that will run new jobs as they are pushed onto the queue. You may run this task using the <code>queue:listen</code> command:</p>

<h4>Starting The Queue Listener</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span>
</pre></div>

<p>You may also specify which queue connection the listener should utilize:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span>
</pre></div>

<p>Note that once this task has started, it will continue to run until it is manually stopped. You may use a process monitor such as <a href="http://supervisord.org/">Supervisor</a> to ensure that the queue listener does not stop running.</p>

<p>You may pass a comma-delimited list of queue connections to the <code>listen</code> command to set queue priorities:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">high</span><span class="p">,</span><span class="nx">low</span>
</pre></div>

<p>In this example, jobs on the <code>high</code> connection will always be processed before moving onto jobs from the <code>low</code> connection.</p>

<h4>Specifying The Job Timeout Parameter</h4>

<p>You may also set the length of time (in seconds) each job should be allowed to run:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">60</span>
</pre></div>

<h4>Specifying Queue Sleep Duration</h4>

<p>In addition, you may specify the number of seconds to wait before polling for new jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">5</span>
</pre></div>

<p>Note that the queue only &quot;sleeps&quot; if no jobs are on the queue. If more jobs are available, the queue will continue to work them without sleeping.</p>

<h4>Processing The First Job On The Queue</h4>

<p>To process only the first job on the queue, you may use the <code>queue:work</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span>
</pre></div>

<p><a name="daemon-queue-worker"></a></p>

<h2>Daemon Queue Worker</h2>

<p>The <code>queue:work</code> also includes a <code>--daemon</code> option for forcing the queue worker to continue processing jobs without ever re-booting the framework. This results in a significant reduction of CPU usage when compared to the <code>queue:listen</code> command, but at the added complexity of needing to drain the queues of currently executing jobs during your deployments.</p>

<p>To start a queue worker in daemon mode, use the <code>--daemon</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>As you can see, the <code>queue:work</code> command supports most of the same options available to <code>queue:listen</code>. You may use the <code>php artisan help queue:work</code> command to view all of the available options.</p>

<h3>Deploying With Daemon Queue Workers</h3>

<p>The simplest way to deploy an application using daemon queue workers is to put the application in maintenance mode at the beginning of your deployment. This can be done using the <code>php artisan down</code> command. Once the application is in maintenance mode, Laravel will not accept any new jobs off of the queue, but will continue to process existing jobs.</p>

<p>The easiest way to restart your workers is to include the following command in your deployment script:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">restart</span>
</pre></div>

<p>This command will instruct all queue workers to restart after they finish processing their current job.</p>

<blockquote>
<p><strong>Note:</strong> This command relies on the cache system to schedule the restart. By default, APCu does not work for CLI commands. If you are using APCu, add <code>apc.enable_cli=1</code> to your APCu configuration.</p>
</blockquote>

<h3>Coding For Daemon Queue Workers</h3>

<p>Daemon queue workers do not restart the framework before processing each job. Therefore, you should be careful to free any heavy resources before your job finishes. For example, if you are doing image manipulation with the GD library, you should free the memory with <code>imagedestroy</code> when you are done.</p>

<p>Similarly, your database connection may disconnect when being used by long-running daemon. You may use the <code>DB::reconnect</code> method to ensure you have a fresh connection.</p>

<p><a name="push-queues"></a></p>

<h2>Push Queues</h2>

<p>Push queues allow you to utilize the powerful Laravel 5 queue facilities without running any daemons or background listeners. Currently, push queues are only supported by the <a href="http://iron.io">Iron.io</a> driver. Before getting started, create an Iron.io account, and add your Iron credentials to the <code>config/queue.php</code> configuration file.</p>

<h4>Registering A Push Queue Subscriber</h4>

<p>Next, you may use the <code>queue:subscribe</code> Artisan command to register a URL end-point that will receive newly pushed queue jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">subscribe</span> <span class="nx">queue_name</span> <span class="nx">queue</span><span class="o">/</span><span class="nx">receive</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">subscribe</span> <span class="nx">queue_name</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//foo.com/queue/receive</span>
</pre></div>

<p>Now, when you login to your Iron dashboard, you will see your new push queue, as well as the subscribed URL. You may subscribe as many URLs as you wish to a given queue. Next, create a route for your <code>queue/receive</code> end-point and return the response from the <code>Queue::marshal</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;queue/receive&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Queue</span><span class="o">::</span><span class="nx">marshal</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The <code>marshal</code> method will take care of firing the correct job handler class. To fire jobs onto the push queue, just use the same <code>Queue::push</code> method used for conventional queues.</p>

<p><a name="failed-jobs"></a></p>

<h2>Failed Jobs</h2>

<p>Since things don&#39;t always go as planned, sometimes your queued jobs will fail. Don&#39;t worry, it happens to the best of us! Laravel includes a convenient way to specify the maximum number of times a job should be attempted. After a job has exceeded this amount of attempts, it will be inserted into a <code>failed_jobs</code> table. The failed jobs table name can be configured via the <code>config/queue.php</code> configuration file.</p>

<p>To create a migration for the <code>failed_jobs</code> table, you may use the <code>queue:failed-table</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span><span class="o">-</span><span class="nx">table</span>
</pre></div>

<p>You can specify the maximum number of times a job should be attempted using the <code>--tries</code> switch on the <code>queue:listen</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span><span class="o">-</span><span class="nx">name</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>If you would like to register an event that will be called when a queue job fails, you may use the <code>Queue::failing</code> method. This event is a great opportunity to notify your team via e-mail or <a href="https://www.hipchat.com">HipChat</a>.</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">failing</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$connection</span><span class="p">,</span> <span class="nx">$job</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may also define a <code>failed</code> method directly on a queue job class, allowing you to perform job specific actions when a failure occurs:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">failed</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Called when the job is failing...</span>
<span class="p">}</span>
</pre></div>

<p>If your job is not self-handling and has a seperate handler class the <code>failed</code> method needs to be defined there instead.</p>

<h3>Retrying Failed Jobs</h3>

<p>To view all of your failed jobs, you may use the <code>queue:failed</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span>
</pre></div>

<p>The <code>queue:failed</code> command will list the job ID, connection, queue, and failure time. The job ID may be used to retry the failed job. For instance, to retry a failed job that has an ID of 5, the following command should be issued:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="mi">5</span>
</pre></div>

<p>If you would like to delete a failed job, you may use the <code>queue:forget</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">forget</span> <span class="mi">5</span>
</pre></div>

<p>To delete all of your failed jobs, you may use the <code>queue:flush</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">flush</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Redis</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#pipelining">Pipelining</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="http://redis.io">Redis</a> is an open source, advanced key-value store. It is often referred to as a data structure server since keys can contain <a href="http://redis.io/topics/data-types#strings">strings</a>, <a href="http://redis.io/topics/data-types#hashes">hashes</a>, <a href="http://redis.io/topics/data-types#lists">lists</a>, <a href="http://redis.io/topics/data-types#sets">sets</a>, and <a href="http://redis.io/topics/data-types#sorted-sets">sorted sets</a>.</p>

<p>Before using Redis with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<blockquote>
<p><strong>Note:</strong> If you have the Redis PHP extension installed via PECL, you will need to rename the alias for Redis in your <code>config/app.php</code> file.</p>
</blockquote>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The Redis configuration for your application is stored in the <code>config/database.php</code> file. Within this file, you will see a <code>redis</code> array containing the Redis servers used by your application:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;cluster&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">6379</span><span class="p">],</span>

<span class="p">],</span>
</pre></div>

<p>The default server configuration should suffice for development. However, you are free to modify this array based on your environment. Simply give each Redis server a name, and specify the host and port used by the server.</p>

<p>The <code>cluster</code> option will tell the Laravel Redis client to perform client-side sharding across your Redis nodes, allowing you to pool nodes and create a large amount of available RAM. However, note that client-side sharding does not handle failover; therefore, is primarily suited for cached data that is available from another primary data store.</p>

<p>If your Redis server requires authentication, you may supply a password by adding a <code>password</code> key / value pair to your Redis server configuration array.</p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<p>You may get a Redis instance by calling the <code>Redis::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">();</span>
</pre></div>

<p>This will give you an instance of the default Redis server. If you are not using server clustering, you may pass the server name to the <code>connection</code> method to get a specific server as defined in your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">);</span>
</pre></div>

<p>Once you have an instance of the Redis client, we may issue any of the <a href="http://redis.io/commands">Redis commands</a> to the instance. Laravel uses magic methods to pass the commands to the Redis server:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>Notice the arguments to the command are simply passed into the magic method. Of course, you are not required to use the magic methods, you may also pass commands to the server using the <code>command</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$values</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;lrange&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>
</pre></div>

<p>When you are simply executing commands against the default connection, just use static magic methods on the <code>Redis</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Redis <a href="/docs/%7B%7Bversion%7D%7D/cache">cache</a> and <a href="/docs/%7B%7Bversion%7D%7D/session">session</a> drivers are included with Laravel.</p>
</blockquote>

<p><a name="pipelining"></a></p>

<h2>Pipelining</h2>

<p>Pipelining should be used when you need to send many commands to the server in one operation. To get started, use the <code>pipeline</code> command:</p>

<h4>Piping Many Commands To Your Servers</h4>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">pipeline</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$pipe</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$pipe</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;key:$i&quot;</span><span class="p">,</span> <span class="nx">$i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Release Notes</h1>

<ul>
<li><a href="#support-policy">Support Policy</a></li>
<li><a href="#laravel-5.0">Laravel 5.0</a></li>
<li><a href="#laravel-4.2">Laravel 4.2</a></li>
<li><a href="#laravel-4.1">Laravel 4.1</a></li>
</ul>

<p><a name="support-policy"></a></p>

<h2>Support Policy</h2>

<p>Security fixes are <strong>always</strong> applied to the previous major version of Laravel. Currently, <strong>all</strong> security fixes and patches will be applied to both Laravel 5.x <strong>and</strong> Laravel 4.x.</p>

<p>When feasible, security fixes will also be applied to even older releases of the framework, such as Laravel 3.x.</p>

<p><a name="laravel-5.0"></a></p>

<h2>Laravel 5.0</h2>

<p>Laravel 5.0 introduces a fresh application structure to the default Laravel project. This new structure serves as a better foundation for building robust application in Laravel, as well as embraces new auto-loading standards (PSR-4) throughout the application. First, let&#39;s examine some of the major changes:</p>

<h3>New Folder Structure</h3>

<p>The old <code>app/models</code> directory has been entirely removed. Instead, all of your code lives directly within the <code>app</code> folder, and, by default, is organized to the <code>App</code> namespace. This default namespace can be quickly changed using the new <code>app:name</code> Artisan command.</p>

<p>Controllers, middleware, and requests (a new type of class in Laravel 5.0) are now grouped under the <code>app/Http</code> directory, as they are all classes related to the HTTP transport layer of your application. Instead of a single, flat file of route filters, all middleware are now broken into their own class files.</p>

<p>A new <code>app/Providers</code> directory replaces the <code>app/start</code> files from previous versions of Laravel 4.x. These service providers provide various bootstrapping functions to your application, such as error handling, logging, route loading, and more. Of course, you are free to create additional service providers for your application.</p>

<p>Application language files and views have been moved to the <code>resources</code> directory.</p>

<h3>Contracts</h3>

<p>All major Laravel components implement interfaces which are located in the <code>illuminate/contracts</code> repository. This repository has no external dependencies. Having a convenient, centrally located set of interfaces you may use for decoupling and dependency injection will serve as an easy alternative option to Laravel Facades.</p>

<p>For more information on contracts, consult the <a href="/docs/%7B%7Bversion%7D%7D/contracts">full documentation</a>.</p>

<h3>Route Cache</h3>

<p>If your application is made up entirely of controller routes, you may utilize the new <code>route:cache</code> Artisan command to drastically speed up the registration of your routes. This is primarily useful on applications with 100+ routes and will <strong>drastically</strong> speed up this portion of your application.</p>

<h3>Route Middleware</h3>

<p>In addition to Laravel 4 style route &quot;filters&quot;, Laravel 5 now supports HTTP middleware, and the included authentication and CSRF &quot;filters&quot; have been converted to middleware. Middleware provides a single, consistent interface to replace all types of filters, allowing you to easily inspect, and even reject, requests before they enter your application.</p>

<p>For more information on middleware, check out <a href="/docs/%7B%7Bversion%7D%7D/middleware">the documentation</a>.</p>

<h3>Controller Method Injection</h3>

<p>In addition to the existing constructor injection, you may now type-hint dependencies on controller methods. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject the dependencies, even if the route contains other parameters:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">createPost</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">PostRepository</span> <span class="nx">$posts</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h3>Authentication Scaffolding</h3>

<p>User registration, authentication, and password reset controllers are now included out of the box, as well as simple corresponding views, which are located at <code>resources/views/auth</code>. In addition, a &quot;users&quot; table migration has been included with the framework. Including these simple resources allows rapid development of application ideas without bogging down on authentication boilerplate. The authentication views may be accessed on the <code>auth/login</code> and <code>auth/register</code> routes. The <code>App\Services\Auth\Registrar</code> service is responsible for user validation and creation.</p>

<h3>Event Objects</h3>

<p>You may now define events as objects instead of simply using strings. For example, check out the following event:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">PodcastWasPurchased</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="nx">$podcast</span><span class="p">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nx">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span> <span class="o">=</span> <span class="nx">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The event may be dispatched like normal:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p>Of course, your event handler will receive the event object instead of a list of data:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">ReportPodcastPurchase</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">PodcastWasPurchased</span> <span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>For more information on working with events, check out the <a href="/docs/%7B%7Bversion%7D%7D/events">full documentation</a>.</p>

<h3>Commands / Queueing</h3>

<p>In addition to the queue job format supported in Laravel 4, Laravel 5 allows you to represent your queued jobs as simple command objects. These commands live in the <code>app/Commands</code> directory. Here&#39;s a sample command:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">PurchasePodcast</span> <span class="kr">extends</span> <span class="nx">Command</span> <span class="kr">implements</span> <span class="nx">SelfHandling</span><span class="p">,</span> <span class="nx">ShouldBeQueued</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Create a new command instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">Podcast</span> <span class="nx">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">$user</span><span class="p">;</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span> <span class="o">=</span> <span class="nx">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Execute the command.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Handle the logic to purchase the podcast...</span>

        <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">PodcastWasPurchased</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">,</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The base Laravel controller utilizes the new <code>DispatchesCommands</code> trait, allowing you to easily dispatch your commands for execution:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">PurchasePodcastCommand</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">));</span>
</pre></div>

<p>Of course, you may also use commands for tasks that are executed synchronously (are not queued). In fact, using commands is a great way to encapsulate complex tasks your application needs to perform. For more information, check out the <a href="/docs/%7B%7Bversion%7D%7D/bus">command bus</a> documentation.</p>

<h3>Database Queue</h3>

<p>A <code>database</code> queue driver is now included in Laravel, providing a simple, local queue driver that requires no extra package installation beyond your database software.</p>

<h3>Laravel Scheduler</h3>

<p>In the past, developers have generated a Cron entry for each console command they wished to schedule. However, this is a headache. Your console schedule is no longer in source control, and you must SSH into your server to add the Cron entries. Let&#39;s make our lives easier. The Laravel command scheduler allows you to fluently and expressively define your command schedule within Laravel itself, and only a single Cron entry is needed on your server.</p>

<p>It looks like this:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;artisan:command&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dailyAt</span><span class="p">(</span><span class="s1">&#39;15:00&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, check out the <a href="/docs/%7B%7Bversion%7D%7D/artisan#scheduling-artisan-commands">full documentation</a> to learn all about the scheduler!</p>

<h3>Tinker / Psysh</h3>

<p>The <code>php artisan tinker</code> command now utilizes <a href="https://github.com/bobthecow/psysh">Psysh</a> by Justin Hileman, a more robust REPL for PHP. If you liked Boris in Laravel 4, you&#39;re going to love Psysh. Even better, it works on Windows! To get started, just try:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">tinker</span>
</pre></div>

<h3>DotEnv</h3>

<p>Instead of a variety of confusing, nested environment configuration directories, Laravel 5 now utilizes <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> by Vance Lucas. This library provides a super simple way to manage your environment configuration, and makes environment detection in Laravel 5 a breeze. For more details, check out the full <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">configuration documentation</a>.</p>

<h3>Laravel Elixir</h3>

<p>Laravel Elixir, by Jeffrey Way, provides a fluent, expressive interface to compiling and concatenating your assets. If you&#39;ve ever been intimidated by learning Grunt or Gulp, fear no more. Elixir makes it a cinch to get started using Gulp to compile your Less, Sass, and CoffeeScript. It can even run your tests for you!</p>

<p>For more information on Elixir, check out the <a href="/docs/%7B%7Bversion%7D%7D/elixir">full documentation</a>.</p>

<h3>Laravel Socialite</h3>

<p>Laravel Socialite is an optional, Laravel 5.0+ compatible package that provides totally painless authentication with OAuth providers. Currently, Socialite supports Facebook, Twitter, Google, and GitHub. Here&#39;s what it looks like:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">redirectForAuth</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getUserFromProvider</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialize</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>No more spending hours writing OAuth authentication flows. Get started in minutes! The <a href="/docs/%7B%7Bversion%7D%7D/authentication#social-authentication">full documentation</a> has all the details.</p>

<h3>Flysystem Integration</h3>

<p>Laravel now includes the powerful <a href="https://github.com/thephpleague/flysystem">Flysystem</a> filesystem abstraction library, providing pain free integration with local, Amazon S3, and Rackspace cloud storage - all with one, unified and elegant API! Storing a file in Amazon S3 is now as simple as:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">);</span>
</pre></div>

<p>For more information on the Laravel Flysystem integration, consult the <a href="/docs/%7B%7Bversion%7D%7D/filesystem">full documentation</a>.</p>

<h3>Form Requests</h3>

<p>Laravel 5.0 introduces <strong>form requests</strong>, which extend the <code>Illuminate\Foundation\Http\FormRequest</code> class. These request objects can be combined with controller method injection to provide a boiler-plate free method of validating user input. Let&#39;s dig in and look at a sample <code>FormRequest</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegisterRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|confirmed|min:8&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Once the class has been defined, we can type-hint it on our controller action:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="nx">RegisterRequest</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>When the Laravel service container identifies that the class it is injecting is a <code>FormRequest</code> instance, the request will <strong>automatically be validated</strong>. This means that if your controller action is called, you can safely assume the HTTP request input has been validated according to the rules you specified in your form request class. Even more, if the request is invalid, an HTTP redirect, which you may customize, will automatically be issued, and the error messages will be either flashed to the session or converted to JSON. <strong>Form validation has never been more simple.</strong> For more information on <code>FormRequest</code> validation, check out the <a href="/docs/%7B%7Bversion%7D%7D/validation#form-request-validation">documentation</a>.</p>

<h3>Simple Controller Request Validation</h3>

<p>The Laravel 5 base controller now includes a <code>ValidatesRequests</code> trait. This trait provides a simple <code>validate</code> method to validate incoming requests. If <code>FormRequests</code> are a little too much for your application, check this out:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">createPost</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>If the validation fails, an exception will be thrown and the proper HTTP response will automatically be sent back to the browser. The validation errors will even be flashed to the session! If the request was an AJAX request, Laravel even takes care of sending a JSON representation of the validation errors back to you.</p>

<p>For more information on this new method, check out <a href="/docs/%7B%7Bversion%7D%7D/validation#controller-validation">the documentation</a>.</p>

<h3>New Generators</h3>

<p>To complement the new default application structure, new Artisan generator commands have been added to the framework. See <code>php artisan list</code> for more details.</p>

<h3>Configuration Cache</h3>

<p>You may now cache all of your configuration in a single file using the <code>config:cache</code> command.</p>

<h3>Symfony VarDumper</h3>

<p>The popular <code>dd</code> helper function, which dumps variable debug information, has been upgraded to use the amazing Symfony VarDumper. This provides color-coded output and even collapsing of arrays. Just try the following in your project:</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p><a name="laravel-4.2"></a></p>

<h2>Laravel 4.2</h2>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.2 installation, or by <a href="https://github.com/laravel/framework/blob/4.2/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<blockquote>
<p><strong>Note:</strong> During the 4.2 release cycle, many small bug fixes and enhancements were incorporated into the various Laravel 4.1 point releases. So, be sure to check the change list for Laravel 4.1 as well!</p>
</blockquote>

<h3>PHP 5.4 Requirement</h3>

<p>Laravel 4.2 requires PHP 5.4 or greater. This upgraded PHP requirement allows us to use new PHP features such as traits to provide more expressive interfaces for tools like <a href="/docs/billing">Laravel Cashier</a>. PHP 5.4 also brings significant speed and performance improvements over PHP 5.3.</p>

<h3>Laravel Forge</h3>

<p>Laravel Forge, a new web based application, provides a simple way to create and manage PHP servers on the cloud of your choice, including Linode, DigitalOcean, Rackspace, and Amazon EC2. Supporting automated Nginx configuration, SSH key access, Cron job automation, server monitoring via NewRelic &amp; Papertrail, &quot;Push To Deploy&quot;, Laravel queue worker configuration, and more, Forge provides the simplest and most affordable way to launch all of your Laravel applications.</p>

<p>The default Laravel 4.2 installation&#39;s <code>app/config/database.php</code> configuration file is now configured for Forge usage by default, allowing for more convenient deployment of fresh applications onto the platform.</p>

<p>More information about Laravel Forge can be found on the <a href="https://forge.laravel.com">official Forge website</a>.</p>

<h3>Laravel Homestead</h3>

<p>Laravel Homestead is an official Vagrant environment for developing robust Laravel and PHP applications. The vast majority of the boxes&#39; provisioning needs are handled before the box is packaged for distribution, allowing the box to boot extremely quickly. Homestead includes Nginx 1.6, PHP 5.6, MySQL, Postgres, Redis, Memcached, Beanstalk, Node, Gulp, Grunt, &amp; Bower. Homestead includes a simple <code>Homestead.yaml</code> configuration file for managing multiple Laravel applications on a single box.</p>

<p>The default Laravel 4.2 installation now includes an <code>app/config/local/database.php</code> configuration file that is configured to use the Homestead database out of the box, making Laravel initial installation and configuration more convenient.</p>

<p>The official documentation has also been updated to include <a href="/docs/homestead">Homestead documentation</a>.</p>

<h3>Laravel Cashier</h3>

<p>Laravel Cashier is a simple, expressive library for managing subscription billing with Stripe. With the introduction of Laravel 4.2, we are including Cashier documentation along with the main Laravel documentation, though installation of the component itself is still optional. This release of Cashier brings numerous bug fixes, multi-currency support, and compatibility with the latest Stripe API.</p>

<h3>Daemon Queue Workers</h3>

<p>The Artisan <code>queue:work</code> command now supports a <code>--daemon</code> option to start a worker in &quot;daemon mode&quot;, meaning the worker will continue to process jobs without ever re-booting the framework. This results in a significant reduction in CPU usage at the cost of a slightly more complex application deployment process.</p>

<p>More information about daemon queue workers can be found in the <a href="/docs/queues#daemon-queue-worker">queue documentation</a>.</p>

<h3>Mail API Drivers</h3>

<p>Laravel 4.2 introduces new Mailgun and Mandrill API drivers for the <code>Mail</code> functions. For many applications, this provides a faster and more reliable method of sending e-mails than the SMTP options. The new drivers utilize the Guzzle 4 HTTP library.</p>

<h3>Soft Deleting Traits</h3>

<p>A much cleaner architecture for &quot;soft deletes&quot; and other &quot;global scopes&quot; has been introduced via PHP 5.4 traits. This new architecture allows for the easier construction of similar global traits, and a cleaner separation of concerns within the framework itself.</p>

<p>More information on the new <code>SoftDeletingTrait</code> may be found in the <a href="/docs/eloquent#soft-deleting">Eloquent documentation</a>.</p>

<h3>Convenient Auth &amp; Remindable Traits</h3>

<p>The default Laravel 4.2 installation now uses simple traits for including the needed properties for the authentication and password reminder user interfaces. This provides a much cleaner default <code>User</code> model file out of the box.</p>

<h3>&quot;Simple Paginate&quot;</h3>

<p>A new <code>simplePaginate</code> method was added to the query and Eloquent builder which allows for more efficient queries when using simple &quot;Next&quot; and &quot;Previous&quot; links in your pagination view.</p>

<h3>Migration Confirmation</h3>

<p>In production, destructive migration operations will now ask for confirmation. Commands may be forced to run without any prompts using the <code>--force</code> command.</p>

<p><a name="laravel-4.1"></a></p>

<h2>Laravel 4.1</h2>

<h3>Full Change List</h3>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.1 installation, or by <a href="https://github.com/laravel/framework/blob/4.1/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<h3>New SSH Component</h3>

<p>An entirely new <code>SSH</code> component has been introduced with this release. This feature allows you to easily SSH into remote servers and run commands. To learn more, consult the <a href="/docs/4.1/ssh">SSH component documentation</a>.</p>

<p>The new <code>php artisan tail</code> command utilizes the new SSH component. For more information, consult the <code>tail</code> <a href="http://laravel.com/docs/4.1/ssh#tailing-remote-logs">command documentation</a>.</p>

<h3>Boris In Tinker</h3>

<p>The <code>php artisan tinker</code> command now utilizes the <a href="https://github.com/d11wtq/boris">Boris REPL</a> if your system supports it. The <code>readline</code> and <code>pcntl</code> PHP extensions must be installed to use this feature. If you do not have these extensions, the shell from 4.0 will be used.</p>

<h3>Eloquent Improvements</h3>

<p>A new <code>hasManyThrough</code> relationship has been added to Eloquent. To learn how to use it, consult the <a href="/docs/eloquent#has-many-through">Eloquent documentation</a>.</p>

<p>A new <code>whereHas</code> method has also been introduced to allow <a href="/docs/eloquent#querying-relations">retrieving models based on relationship constraints</a>.</p>

<h3>Database Read / Write Connections</h3>

<p>Automatic handling of separate read / write connections is now available throughout the database layer, including the query builder and Eloquent. For more information, consult <a href="/docs/database#read-write-connections">the documentation</a>.</p>

<h3>Queue Priority</h3>

<p>Queue priorities are now supported by passing a comma-delimited list to the <code>queue:listen</code> command.</p>

<h3>Failed Queue Job Handling</h3>

<p>The queue facilities now include automatic handling of failed jobs when using the new <code>--tries</code> switch on <code>queue:listen</code>. More information on handling failed jobs can be found in the <a href="/docs/queues#failed-jobs">queue documentation</a>.</p>

<h3>Cache Tags</h3>

<p>Cache &quot;sections&quot; have been superseded by &quot;tags&quot;. Cache tags allow you to assign multiple &quot;tags&quot; to a cache item, and flush all items assigned to a single tag. More information on using cache tags may be found in the <a href="/docs/cache#cache-tags">cache documentation</a>.</p>

<h3>Flexible Password Reminders</h3>

<p>The password reminder engine has been changed to provide greater developer flexibility when validating passwords, flashing status messages to the session, etc. For more information on using the enhanced password reminder engine, <a href="/docs/4.1/security#password-reminders-and-reset">consult the documentation</a>.</p>

<h3>Improved Routing Engine</h3>

<p>Laravel 4.1 features a totally re-written routing layer. The API is the same; however, registering routes is a full 100% faster compared to 4.0. The entire engine has been greatly simplified, and the dependency on Symfony Routing has been minimized to the compiling of route expressions.</p>

<h3>Improved Session Engine</h3>

<p>With this release, we&#39;re also introducing an entirely new session engine. Similar to the routing improvements, the new session layer is leaner and faster. We are no longer using Symfony&#39;s (and therefore PHP&#39;s) session handling facilities, and are using a custom solution that is simpler and easier to maintain.</p>

<h3>Doctrine DBAL</h3>

<p>If you are using the <code>renameColumn</code> function in your migrations, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file. This package is no longer included in Laravel by default.</p>
<div style="page-break-after: always;" ></div><h1>HTTP Requests</h1>

<ul>
<li><a href="#obtaining-a-request-instance">Obtaining A Request Instance</a></li>
<li><a href="#retrieving-input">Retrieving Input</a></li>
<li><a href="#old-input">Old Input</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#files">Files</a></li>
<li><a href="#other-request-information">Other Request Information</a></li>
</ul>

<p><a name="obtaining-a-request-instance"></a></p>

<h2>Obtaining A Request Instance</h2>

<h3>Via Facade</h3>

<p>The <code>Request</code> facade will grant you access to the current request that is bound in the container. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>Remember, if you are in a namespace, you will have to import the <code>Request</code> facade using a <code>use Request;</code> statement at the top of your class file.</p>

<h3>Via Dependency Injection</h3>

<p>To obtain an instance of the current HTTP request via dependency injection, you should type-hint the class on your controller constructor or method. The current request instance will automatically be injected by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If your controller method is also expecting input from a route parameter, simply list your route arguments after your other dependencies:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the specified user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="retrieving-input"></a></p>

<h2>Retrieving Input</h2>

<h4>Retrieving An Input Value</h4>

<p>Using a few simple methods, you may access all user input from your <code>Illuminate\Http\Request</code> instance. You do not need to worry about the HTTP verb used for the request, as input is accessed in the same way for all verbs.</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Default Value If The Input Value Is Absent</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If An Input Value Is Present</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Getting All Input For The Request</h4>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Getting Only Some Of The Request Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;credit_card&#39;</span><span class="p">);</span>
</pre></div>

<p>When working on forms with &quot;array&quot; inputs, you may use dot notation to access the arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;products.0.name&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="old-input"></a></p>

<h2>Old Input</h2>

<p>Laravel also allows you to keep input from one request during the next request. For example, you may need to re-populate a form after checking it for validation errors.</p>

<h4>Flashing Input To The Session</h4>

<p>The <code>flash</code> method will flash the current input to the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a> so that it is available during the user&#39;s next request to the application:</p>
<div class="highlight"><pre><span></span><span class="nx">Request</span><span class="o">::</span><span class="nx">flash</span><span class="p">();</span>
</pre></div>

<h4>Flashing Only Some Input To The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Request</span><span class="o">::</span><span class="nx">flashOnly</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">);</span>

<span class="nx">Request</span><span class="o">::</span><span class="nx">flashExcept</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>

<h4>Flash &amp; Redirect</h4>

<p>Since you often will want to flash input in association with a redirect to the previous page, you may easily chain input flashing onto a redirect.</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">));</span>
</pre></div>

<h4>Retrieving Old Data</h4>

<p>To retrieve flashed input from the previous request, use the <code>old</code> method on the <code>Request</code> instance.</p>
<div class="highlight"><pre><span></span><span class="nx">$username</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>

<p>If you are displaying old input within a Blade template, it is more convenient to use the <code>old</code> helper:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p><a name="cookies"></a></p>

<h2>Cookies</h2>

<p>All cookies created by the Laravel framework are encrypted and signed with an authentication code, meaning they will be considered invalid if they have been changed by the client.</p>

<h4>Retrieving A Cookie Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Attaching A New Cookie To A Response</h4>

<p>The <code>cookie</code> helper serves as a simple factory for generating new <code>Symfony\Component\HttpFoundation\Cookie</code> instances. The cookies may be attached to a <code>Response</code> instance using the <code>withCookie</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>

<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">));</span>
</pre></div>

<h4>Creating A Cookie That Lasts Forever*</h4>

<p><em>By &quot;forever&quot;, we really mean five years.</em></p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">));</span>
</pre></div>

<h4>Queueing Cookies</h4>

<p>You may also &quot;queue&quot; a cookie to be added to the outgoing response, even before that response has been created:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cookie</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Routing\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update a resource</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">()</span>
     <span class="p">{</span>
        <span class="nx">Cookie</span><span class="o">::</span><span class="na">queue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="files"></a></p>

<h2>Files</h2>

<h4>Retrieving An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$file</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If A File Was Uploaded</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">hasFile</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The object returned by the <code>file</code> method is an instance of the <code>Symfony\Component\HttpFoundation\File\UploadedFile</code> class, which extends the PHP <code>SplFileInfo</code> class and provides a variety of methods for interacting with the file.</p>

<h4>Determining If An Uploaded File Is Valid</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Moving An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">Request</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">);</span>

<span class="nx">Request</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">,</span> <span class="nx">$fileName</span><span class="p">);</span>
</pre></div>

<h3>Other File Methods</h3>

<p>There are a variety of other methods available on <code>UploadedFile</code> instances. Check out the <a href="http://api.symfony.com/2.5/Symfony/Component/HttpFoundation/File/UploadedFile.html">API documentation for the class</a> for more information regarding these methods.</p>

<p><a name="other-request-information"></a></p>

<h2>Other Request Information</h2>

<p>The <code>Request</code> class provides many methods for examining the HTTP request for your application and extends the <code>Symfony\Component\HttpFoundation\Request</code> class. Here are some of the highlights.</p>

<h4>Retrieving The Request URI</h4>
<div class="highlight"><pre><span></span><span class="nx">$uri</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">path</span><span class="p">();</span>
</pre></div>

<h4>Determine If The Request Is Using AJAX</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">ajax</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Request Method</h4>
<div class="highlight"><pre><span></span><span class="nx">$method</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">method</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">isMethod</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If The Request Path Matches A Pattern</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Get The Current Request URL</h4>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">url</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Responses</h1>

<ul>
<li><a href="#basic-responses">Basic Responses</a></li>
<li><a href="#redirects">Redirects</a></li>
<li><a href="#other-responses">Other Responses</a></li>
<li><a href="#response-macros">Response Macros</a></li>
</ul>

<p><a name="basic-responses"></a></p>

<h2>Basic Responses</h2>

<h4>Returning Strings From Routes</h4>

<p>The most basic response from a Laravel route is a string:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Creating Custom Responses</h4>

<p>However, for most routes and controller actions, you will be returning a full <code>Illuminate\Http\Response</code> instance or a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a>. Returning a full <code>Response</code> instance allows you to customize the response&#39;s HTTP status code and headers. A <code>Response</code> instance inherits from the <code>Symfony\Component\HttpFoundation\Response</code> class, providing a variety of methods for building HTTP responses:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Response</span><span class="p">;</span>

<span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">$status</span><span class="p">))</span>
              <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p>For convenience, you may also use the <code>response</code> helper:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">$status</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> For a full list of available <code>Response</code> methods, check out its <a href="http://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Response.html">API documentation</a> and the <a href="http://api.symfony.com/2.5/Symfony/Component/HttpFoundation/Response.html">Symfony API documentation</a>.</p>
</blockquote>

<h4>Sending A View In A Response</h4>

<p>If you need access to the <code>Response</code> class methods, but want to return a view as the response content, you may use the <code>view</code> method for convenience:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">);</span>
</pre></div>

<h4>Attaching Cookies To Responses</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">));</span>
</pre></div>

<h4>Method Chaining</h4>

<p>Keep in mind that most <code>Response</code> methods are chainable, allowing for the fluent building of responses:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="redirects"></a></p>

<h2>Redirects</h2>

<p>Redirect responses are typically instances of the <code>Illuminate\Http\RedirectResponse</code> class, and contain the proper headers needed to redirect the user to another URL.</p>

<h4>Returning A Redirect</h4>

<p>There are several ways to generate a <code>RedirectResponse</code> instance. The simplest method is to use the <code>redirect</code> helper method. When testing, it is not common to mock the creation of a redirect response, so using the helper method is almost always acceptable:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Redirect With Flash Data</h4>

<p>Redirecting to a new URL and <a href="/docs/%7B%7Bversion%7D%7D/session">flashing data to the session</a> are typically done at the same time. So, for convenience, you may create a <code>RedirectResponse</code> instance <strong>and</strong> flash data to the session in a single method chain:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;Login Failed&#39;</span><span class="p">);</span>
</pre></div>

<h4>Redirecting To The Previous URL</h4>

<p>You may wish to redirect the user to their previous location, for example, after a form submission. You can do so by using the <code>back</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">back</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>
</pre></div>

<h4>Returning A Redirect To A Named Route</h4>

<p>When you call the <code>redirect</code> helper with no parameters, an instance of <code>Illuminate\Routing\Redirector</code> is returned, allowing you to call any method on the <code>Redirector</code> instance. For example, to generate a <code>RedirectResponse</code> to a named route, you may use the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Redirect To A Named Route With Parameters</h4>

<p>If your route has parameters, you may pass them as the second argument to the <code>route</code> method.</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>If you are redirecting to a route with an &quot;ID&quot; parameter that is being populated from an Eloquent model, you may simply pass the model itself. The ID will be extracted automatically:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$user</span><span class="p">]);</span>
</pre></div>

<h4>Returning A Redirect To A Named Route Using Named Parameters</h4>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{user}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Returning A Redirect To A Controller Action</h4>

<p>Similarly to generating <code>RedirectResponse</code> instances to named routes, you may also generate redirects to <a href="/docs/%7B%7Bversion%7D%7D/controllers">controller actions</a>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You do not need to specify the full namespace to the controller if you have registered a root controller namespace via <code>URL::setRootControllerNamespace</code>.</p>
</blockquote>

<h4>Returning A Redirect To A Controller Action With Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Returning A Redirect To A Controller Action Using Named Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="other-responses"></a></p>

<h2>Other Responses</h2>

<p>The <code>response</code> helper may be used to conveniently generate other types of response instances. When the <code>response</code> helper is called without arguments, an implementation of the <code>Illuminate\Contracts\Routing\ResponseFactory</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a> is returned. This contract provides several helpful methods for generating responses.</p>

<h4>Creating A JSON Response</h4>

<p>The <code>json</code> method will automatically set the <code>Content-Type</code> header to <code>application/json</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Creating A JSONP Response</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">])</span>
                 <span class="o">-&gt;</span><span class="nx">setCallback</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">));</span>
</pre></div>

<h4>Creating A File Download Response</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">deleteFileAfterSend</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Symfony HttpFoundation, which manages file downloads, requires the file being downloaded to have an ASCII file name.</p>
</blockquote>

<p><a name="response-macros"></a></p>

<h2>Response Macros</h2>

<p>If you would like to define a custom response that you can re-use in a variety of your routes and controllers, you may use the <code>macro</code> method on an implementation of <code>Illuminate\Contracts\Routing\ResponseFactory</code>.</p>

<p>For example, from a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider&#39;s</a> <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ResponseMacroServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Perform post-registration booting of services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Response</span><span class="o">::</span><span class="na">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>macro</code> function accepts a name as its first argument, and a Closure as its second. The macro&#39;s Closure will be executed when calling the macro name from a <code>ResponseFactory</code> implementation or the <code>response</code> helper:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">caps</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Routing</h1>

<ul>
<li><a href="#basic-routing">Basic Routing</a></li>
<li><a href="#csrf-protection">CSRF Protection</a></li>
<li><a href="#method-spoofing">Method Spoofing</a></li>
<li><a href="#route-parameters">Route Parameters</a></li>
<li><a href="#named-routes">Named Routes</a></li>
<li><a href="#route-groups">Route Groups</a></li>
<li><a href="#route-model-binding">Route Model Binding</a></li>
<li><a href="#throwing-404-errors">Throwing 404 Errors</a></li>
</ul>

<p><a name="basic-routing"></a></p>

<h2>Basic Routing</h2>

<p>You will define most of the routes for your application in the <code>app/Http/routes.php</code> file, which is loaded by the <code>App\Providers\RouteServiceProvider</code> class. The most basic Laravel routes simply accept a URI and a <code>Closure</code>:</p>

<h4>Basic GET Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Other Basic Routes</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Route For Multiple Verbs</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">match</span><span class="p">([</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">],</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Route That Responds To Any HTTP Verb</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">any</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Often, you will need to generate URLs to your routes, you may do so using the <code>url</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="csrf-protection"></a></p>

<h2>CSRF Protection</h2>

<p>Laravel makes it easy to protect your application from <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgeries</a>. Cross-site request forgeries are a type of malicious exploit whereby unauthorized commands are performed on behalf of the authenticated user.</p>

<p>Laravel automatically generates a CSRF &quot;token&quot; for each active user session managed by the application. This token is used to verify that the authenticated user is the one actually making the requests to the application.</p>

<h4>Insert The CSRF Token Into A Form</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">csrf_token</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>Of course, using the Blade <a href="/docs/%7B%7Bversion%7D%7D/templates">templating engine</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>You do not need to manually verify the CSRF token on POST, PUT, or DELETE requests. The <code>VerifyCsrfToken</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">HTTP middleware</a> will verify token in the request input matches the token stored in the session.</p>

<h4>X-CSRF-TOKEN</h4>

<p>In addition to looking for the CSRF token as a &quot;POST&quot; parameter, the middleware will also check for the <code>X-CSRF-TOKEN</code> request header. You could, for example, store the token in a &quot;meta&quot; tag and instruct jQuery to add it to all request headers:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;csrf-token&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span> <span class="o">/&gt;</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;X-CSRF-TOKEN&#39;</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></div>

<p>Now all AJAX requests will automatically include the CSRF token:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
   <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/foo/bar&quot;</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>

<h4>X-XSRF-TOKEN</h4>

<p>Laravel also stores the CSRF token in a <code>XSRF-TOKEN</code> cookie. You can use the cookie value to set the <code>X-XSRF-TOKEN</code> request header. Some JavaScript frameworks, like Angular, do this automatically for you.</p>

<blockquote>
<p>Note: The difference between the <code>X-CSRF-TOKEN</code> and <code>X-XSRF-TOKEN</code> is that the first uses a plain text value and the latter uses an encrypted value, because cookies in Laravel are always encrypted. If you use the <code>csrf_token()</code> function to supply the token value, you probably want to use the <code>X-CSRF-TOKEN</code> header.</p>
</blockquote>

<p><a name="method-spoofing"></a></p>

<h2>Method Spoofing</h2>

<p>HTML forms do not support <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> actions. So, when defining <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> routes that are called from an HTML form, you will need to add a hidden <code>_method</code> field to the form.</p>

<p>The value sent with the <code>_method</code> field will be used as the HTTP request method. For example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">csrf_token</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="route-parameters"></a></p>

<h2>Route Parameters</h2>

<p>Of course, you can capture segments of the request URI within your route:</p>

<h4>Basic Route Parameter</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;User &#39;</span><span class="p">.</span><span class="nx">$id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Route parameters cannot contain the <code>-</code> character. Use an underscore (<code>_</code>) instead.</p>
</blockquote>

<h4>Optional Route Parameters</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Optional Route Parameters With Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Regular Expression Parameter Constraints</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;[A-Za-z]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>
</pre></div>

<h4>Passing An Array Of Constraints</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[a-z]+&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Defining Global Patterns</h4>

<p>If you would like a route parameter to always be constrained by a given regular expression, you may use the <code>pattern</code> method. You should define these patterns in the <code>boot</code> method of your <code>RouteServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the pattern has been defined, it is applied to all routes using that parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Only called if {id} is numeric.</span>
<span class="p">});</span>
</pre></div>

<h4>Accessing A Route Parameter Value</h4>

<p>If you need to access a route parameter value outside of a route, use the <code>input</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$route</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also access the current route parameters via the <code>Illuminate\Http\Request</code> instance. The request instance for the current request may be accessed via the <code>Request</code> facade, or by type-hinting the <code>Illuminate\Http\Request</code> where dependencies are injected:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="named-routes"></a></p>

<h2>Named Routes</h2>

<p>Named routes allow you to conveniently generate URLs or redirects for a specific route. You may specify a name for a route with the <code>as</code> array key:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}]);</span>
</pre></div>

<p>You may also specify route names for controller actions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>Now, you may use the route&#39;s name when generating URLs or redirects:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="nx">$redirect</span> <span class="o">=</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>currentRouteName</code> method returns the name of the route handling the current request:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteName</span><span class="p">();</span>
</pre></div>

<p><a name="route-groups"></a></p>

<h2>Route Groups</h2>

<p>Sometimes many of your routes will share common requirements such as URL segments, middleware, namespaces, etc. Instead of specifying each of these options on every route individually, you may use a route group to apply attributes to many routes.</p>

<p>Shared attributes are specified in an array format as the first parameter to the <code>Route::group</code> method.</p>

<p><a name="route-group-middleware"></a></p>

<h3>Middleware</h3>

<p>Middleware are applied to all routes within the group by defining the list of middleware with the <code>middleware</code> parameter on the group attribute array. Middleware will be executed in the order you define this array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Has Foo And Bar Middleware</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Has Foo And Bar Middleware</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p><a name="route-group-namespace"></a></p>

<h3>Namespaces</h3>

<p>You may use the <code>namespace</code> parameter in your group attribute array to specify the namespace for all controllers within the group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;namespace&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Controllers Within The &quot;App\Http\Controllers\Admin&quot; Namespace</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;namespace&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Controllers Within The &quot;App\Http\Controllers\Admin\User&quot; Namespace</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, the <code>RouteServiceProvider</code> includes your <code>routes.php</code> file within a namespace group, allowing you to register controller routes without specifying the full <code>App\Http\Controllers</code> namespace prefix.</p>
</blockquote>

<p><a name="sub-domain-routing"></a></p>

<h3>Sub-Domain Routing</h3>

<p>Laravel routes also handle wildcard sub-domains, and will pass your wildcard parameters from the domain:</p>

<h4>Registering Sub-Domain Routes</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{account}.myapp.com&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$account</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p><a name="route-prefixing"></a></p>

<h3>Route Prefixing</h3>

<p>A group of routes may be prefixed by using the <code>prefix</code> option in the attributes array of a group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Matches The &quot;/admin/users&quot; URL</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>You can also utilize the <code>prefix</code> parameter to pass common parameters to your routes:</p>

<h4>Registering a URL parameter in a route prefix</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;accounts/{account_id}&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$account_id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>You can even define parameter constraints for the named parameters in your prefix:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span>
    <span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;accounts/{account_id}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;where&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">],</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Define Routes Here</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-model-binding"></a></p>

<h2>Route Model Binding</h2>

<p>Laravel model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user&#39;s ID, you can inject the entire User class instance that matches the given ID.</p>

<p>First, use the router&#39;s <code>model</code> method to specify the class for a given parameter. You should define your model bindings in the <code>RouteServiceProvider::boot</code> method:</p>

<h4>Binding A Parameter To A Model</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">Router</span> <span class="nx">$router</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">(</span><span class="nx">$router</span><span class="p">);</span>

    <span class="nx">$router</span><span class="o">-&gt;</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;App\User&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Next, define a route that contains a <code>{user}</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Since we have bound the <code>{user}</code> parameter to the <code>App\User</code> model, a <code>User</code> instance will be injected into the route. So, for example, a request to <code>profile/1</code> will inject the <code>User</code> instance which has an ID of 1.</p>

<blockquote>
<p><strong>Note:</strong> If a matching model instance is not found in the database, a 404 error will be thrown.</p>
</blockquote>

<p>If you wish to specify your own &quot;not found&quot; behavior, pass a Closure as the third argument to the <code>model</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to use your own resolution logic, you should use the <code>Route::bind</code> method. The Closure you pass to the <code>bind</code> method will receive the value of the URI segment, and should return an instance of the class you want to be injected into the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="throwing-404-errors"></a></p>

<h2>Throwing 404 Errors</h2>

<p>There are two ways to manually trigger a 404 error from a route. First, you may use the <code>abort</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>The <code>abort</code> helper simply throws a <code>Symfony\Component\HttpKernel\Exception\HttpException</code> with the specified status code.</p>

<p>Secondly, you may manually throw an instance of <code>Symfony\Component\HttpKernel\Exception\NotFoundHttpException</code>.</p>

<p>More information on handling 404 exceptions and using custom responses for these errors may be found in the <a href="/docs/%7B%7Bversion%7D%7D/errors#http-exceptions">errors</a> section of the documentation.</p>
<div style="page-break-after: always;" ></div><h1>Schema Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-and-dropping-tables">Creating &amp; Dropping Tables</a></li>
<li><a href="#adding-columns">Adding Columns</a></li>
<li><a href="#changing-columns">Changing Columns</a></li>
<li><a href="#renaming-columns">Renaming Columns</a></li>
<li><a href="#dropping-columns">Dropping Columns</a></li>
<li><a href="#checking-existence">Checking Existence</a></li>
<li><a href="#adding-indexes">Adding Indexes</a></li>
<li><a href="#foreign-keys">Foreign Keys</a></li>
<li><a href="#dropping-indexes">Dropping Indexes</a></li>
<li><a href="#dropping-timestamps">Dropping Timestamps &amp; Soft Deletes</a></li>
<li><a href="#storage-engines">Storage Engines</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Schema</code> class provides a database agnostic way of manipulating tables. It works well with all of the databases supported by Laravel, and has a unified API across all of these systems.</p>

<p><a name="creating-and-dropping-tables"></a></p>

<h2>Creating &amp; Dropping Tables</h2>

<p>To create a new database table, the <code>Schema::create</code> method is used:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>create</code> method is the name of the table, and the second is a <code>Closure</code> which will receive a <code>Blueprint</code> object which may be used to define the new table.</p>

<p>To rename an existing database table, the <code>rename</code> method may be used:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">rename</span><span class="p">(</span><span class="nx">$from</span><span class="p">,</span> <span class="nx">$to</span><span class="p">);</span>
</pre></div>

<p>To specify which connection the schema operation should take place on, use the <code>Schema::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>To drop a table, you may use the <code>Schema::drop</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>

<span class="nx">Schema</span><span class="o">::</span><span class="nx">dropIfExists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="adding-columns"></a></p>

<h2>Adding Columns</h2>

<p>To update an existing table, we will use the <code>Schema::table</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The table builder contains a variety of column types that you may use when building your tables:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;bigIncrements(&#39;id&#39;);</code>  |  Incrementing ID using a &quot;big integer&quot; equivalent
<code>$table-&gt;bigInteger(&#39;votes&#39;);</code>  |  BIGINT equivalent to the table
<code>$table-&gt;binary(&#39;data&#39;);</code>  |  BLOB equivalent to the table
<code>$table-&gt;boolean(&#39;confirmed&#39;);</code>  |  BOOLEAN equivalent to the table
<code>$table-&gt;char(&#39;name&#39;, 4);</code>  |  CHAR equivalent with a length
<code>$table-&gt;date(&#39;created_at&#39;);</code>  |  DATE equivalent to the table
<code>$table-&gt;dateTime(&#39;created_at&#39;);</code>  |  DATETIME equivalent to the table
<code>$table-&gt;decimal(&#39;amount&#39;, 5, 2);</code>  |  DECIMAL equivalent with a precision and scale
<code>$table-&gt;double(&#39;column&#39;, 15, 8);</code>  |  DOUBLE equivalent with precision, 15 digits in total and 8 after the decimal point
<code>$table-&gt;enum(&#39;choices&#39;, [&#39;foo&#39;, &#39;bar&#39;]);</code> | ENUM equivalent to the table
<code>$table-&gt;float(&#39;amount&#39;);</code>  |  FLOAT equivalent to the table
<code>$table-&gt;increments(&#39;id&#39;);</code>  |  Incrementing ID to the table (primary key)
<code>$table-&gt;integer(&#39;votes&#39;);</code>  |  INTEGER equivalent to the table
<code>$table-&gt;json(&#39;options&#39;);</code>  |  JSON equivalent to the table
<code>$table-&gt;jsonb(&#39;options&#39;);</code>  |  JSONB equivalent to the table
<code>$table-&gt;longText(&#39;description&#39;);</code>  |  LONGTEXT equivalent to the table
<code>$table-&gt;mediumInteger(&#39;numbers&#39;);</code>  |  MEDIUMINT equivalent to the table
<code>$table-&gt;mediumText(&#39;description&#39;);</code>  |  MEDIUMTEXT equivalent to the table
<code>$table-&gt;morphs(&#39;taggable&#39;);</code>  |  Adds INTEGER <code>taggable_id</code> and STRING <code>taggable_type</code>
<code>$table-&gt;nullableTimestamps();</code>  |  Same as <code>timestamps()</code>, except allows NULLs
<code>$table-&gt;smallInteger(&#39;votes&#39;);</code>  |  SMALLINT equivalent to the table
<code>$table-&gt;tinyInteger(&#39;numbers&#39;);</code>  |  TINYINT equivalent to the table
<code>$table-&gt;softDeletes();</code>  |  Adds <strong>deleted_at</strong> column for soft deletes
<code>$table-&gt;string(&#39;email&#39;);</code>  |  VARCHAR equivalent column
<code>$table-&gt;string(&#39;name&#39;, 100);</code>  |  VARCHAR equivalent with a length
<code>$table-&gt;text(&#39;description&#39;);</code>  |  TEXT equivalent to the table
<code>$table-&gt;time(&#39;sunrise&#39;);</code>  |  TIME equivalent to the table
<code>$table-&gt;timestamp(&#39;added_on&#39;);</code>  |  TIMESTAMP equivalent to the table
<code>$table-&gt;timestamps();</code>  |  Adds <strong>created_at</strong> and <strong>updated_at</strong> columns
<code>$table-&gt;rememberToken();</code>  |  Adds <code>remember_token</code> as VARCHAR(100) NULL
<code>-&gt;nullable()</code>  |  Designate that the column allows NULL values
<code>-&gt;default($value)</code>  |  Declare a default value for a column
<code>-&gt;unsigned()</code>  |  Set INTEGER to UNSIGNED</p>

<h4>Using After On MySQL</h4>

<p>If you are using the MySQL database, you may use the <code>after</code> method to specify the order of columns:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="changing-columns"></a></p>

<h2>Changing Columns</h2>

<p><strong>Note:</strong> Before changing a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file.</p>

<p>Sometimes you may need to modify an existing column. For example, you may wish to increase the size of a string column. The <code>change</code> method makes it easy! For example, let&#39;s increase the size of the <code>name</code> column from 25 to 50:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>We could also modify a column to be nullable:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="renaming-columns"></a></p>

<h2>Renaming Columns</h2>

<p>To rename a column, you may use the <code>renameColumn</code> method on the Schema builder. Before renaming a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file.</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">renameColumn</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Renaming columns in a table with <code>enum</code> column is currently not supported.</p>
</blockquote>

<p><a name="dropping-columns"></a></p>

<h2>Dropping Columns</h2>

<p>To drop a column, you may use the <code>dropColumn</code> method on the Schema builder. Before dropping a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file.</p>

<h4>Dropping A Column From A Database Table</h4>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Dropping Multiple Columns From A Database Table</h4>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p><a name="checking-existence"></a></p>

<h2>Checking Existence</h2>

<h4>Checking For Existence Of Table</h4>

<p>You may easily check for the existence of a table or column using the <code>hasTable</code> and <code>hasColumn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasTable</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Checking For Existence Of Columns</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasColumn</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="adding-indexes"></a></p>

<h2>Adding Indexes</h2>

<p>The schema builder supports several types of indexes. There are two ways to add them. First, you may fluently define them on a column definition, or you may add them separately:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
</pre></div>

<p>Or, you may choose to add the indexes on separate lines. Below is a list of all available index types:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;primary(&#39;id&#39;);</code>  |  Adding a primary key
<code>$table-&gt;primary([&#39;first&#39;, &#39;last&#39;]);</code>  |  Adding composite keys
<code>$table-&gt;unique(&#39;email&#39;);</code>  |  Adding a unique index
<code>$table-&gt;index(&#39;state&#39;);</code>  |  Adding a basic index</p>

<p><a name="foreign-keys"></a></p>

<h2>Foreign Keys</h2>

<p>Laravel also provides support for adding foreign key constraints to your tables:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unsigned</span><span class="p">();</span>
<span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<p>In this example, we are stating that the <code>user_id</code> column references the <code>id</code> column on the <code>users</code> table. Make sure to create the foreign key column first!</p>

<p>You may also specify options for the &quot;on delete&quot; and &quot;on update&quot; actions of the constraint:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">onDelete</span><span class="p">(</span><span class="s1">&#39;cascade&#39;</span><span class="p">);</span>
</pre></div>

<p>To drop a foreign key, you may use the <code>dropForeign</code> method. A similar naming convention is used for foreign keys as is used for other indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">(</span><span class="s1">&#39;posts_user_id_foreign&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When creating a foreign key that references an incrementing integer, remember to always make the foreign key column <code>unsigned</code>.</p>
</blockquote>

<p><a name="dropping-indexes"></a></p>

<h2>Dropping Indexes</h2>

<p>To drop an index you must specify the index&#39;s name. Laravel assigns a reasonable name to the indexes by default. Simply concatenate the table name, the names of the column in the index, and the index type. Here are some examples:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;dropPrimary(&#39;users_id_primary&#39;);</code>  |  Dropping a primary key from the &quot;users&quot; table
<code>$table-&gt;dropUnique(&#39;users_email_unique&#39;);</code>  |  Dropping a unique index from the &quot;users&quot; table
<code>$table-&gt;dropIndex(&#39;geo_state_index&#39;);</code>  |  Dropping a basic index from the &quot;geo&quot; table</p>

<p><a name="dropping-timestamps"></a></p>

<h2>Dropping Timestamps &amp; SoftDeletes</h2>

<p>To drop the <code>timestamps</code>, <code>nullableTimestamps</code> or <code>softDeletes</code> column types, you may use the following methods:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;dropTimestamps();</code>  |  Dropping the <strong>created_at</strong> and <strong>updated_at</strong> columns from the table
<code>$table-&gt;dropSoftDeletes();</code>  |  Dropping <strong>deleted_at</strong> column from the table</p>

<p><a name="storage-engines"></a></p>

<h2>Storage Engines</h2>

<p>To set the storage engine for a table, set the <code>engine</code> property on the schema builder:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">engine</span> <span class="o">=</span> <span class="s1">&#39;InnoDB&#39;</span><span class="p">;</span>

    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Session</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#session-usage">Session Usage</a></li>
<li><a href="#flash-data">Flash Data</a></li>
<li><a href="#database-sessions">Database Sessions</a></li>
<li><a href="#session-drivers">Session Drivers</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Since HTTP driven applications are stateless, sessions provide a way to store information about the user across requests. Laravel ships with a variety of session back-ends available for use through a clean, unified API. Support for popular back-ends such as <a href="http://memcached.org">Memcached</a>, <a href="http://redis.io">Redis</a>, and databases is included out of the box.</p>

<p>The session configuration is stored in <code>config/session.php</code>. Be sure to review the well documented options available to you in this file. By default, Laravel is configured to use the <code>file</code> session driver, which will work well for the majority of applications.</p>

<p>Before using Redis sessions with Laravel, you will need to install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<blockquote>
<p><strong>Note:</strong> If you need all stored session data to be encrypted, set the <code>encrypt</code> configuration option to <code>true</code>.</p>

<p><strong>Note:</strong> When using the <code>cookie</code> session driver, you should <strong>never</strong> remove the <code>EncryptCookie</code> middleware from your HTTP kernel. If you remove this middleware, your application will be vulnerable to remote code injection.</p>
</blockquote>

<h4>Reserved Keys</h4>

<p>The Laravel framework uses the <code>flash</code> session key internally, so you should not add an item to the session by that name.</p>

<p><a name="session-usage"></a></p>

<h2>Session Usage</h2>

<p>The session may be accessed in several ways, via the HTTP request&#39;s <code>session</code> method, the <code>Session</code> facade, or the <code>session</code> helper function. When the <code>session</code> helper is called without arguments, it will return the entire session object. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">regenerate</span><span class="p">();</span>
</pre></div>

<h4>Storing An Item In The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>

<span class="nx">session</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Push A Value Onto An Array Session Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;user.teams&#39;</span><span class="p">,</span> <span class="s1">&#39;developers&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item Or Returning A Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h4>Retrieving An Item And Forgetting It</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Data From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Determining If An Item Exists In The Session</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Removing An Item From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Removing All Items From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<h4>Regenerating The Session ID</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">regenerate</span><span class="p">();</span>
</pre></div>

<p><a name="flash-data"></a></p>

<h2>Flash Data</h2>

<p>Sometimes you may wish to store items in the session only for the next request. You may do so using the <code>Session::flash</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h4>Reflashing The Current Flash Data For Another Request</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">reflash</span><span class="p">();</span>
</pre></div>

<h4>Reflashing Only A Subset Of Flash Data</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">keep</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="database-sessions"></a></p>

<h2>Database Sessions</h2>

<p>When using the <code>database</code> session driver, you will need to setup a table to contain the session items. Below is an example <code>Schema</code> declaration for the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;last_activity&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, you may use the <code>session:table</code> Artisan command to generate this migration for you!</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">session</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">composer</span> <span class="nx">dump</span><span class="o">-</span><span class="nx">autoload</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="session-drivers"></a></p>

<h2>Session Drivers</h2>

<p>The session &quot;driver&quot; defines where session data will be stored for each request. Laravel ships with several great drivers out of the box:</p>

<ul>
<li><code>file</code> - sessions will be stored in <code>storage/framework/sessions</code>.</li>
<li><code>cookie</code> - sessions will be stored in secure, encrypted cookies.</li>
<li><code>database</code> - sessions will be stored in a database used by your application.</li>
<li><code>memcached</code> / <code>redis</code> - sessions will be stored in one of these fast, cached based stores.</li>
<li><code>array</code> - sessions will be stored in a simple PHP array and will not be persisted across requests.</li>
</ul>

<blockquote>
<p><strong>Note:</strong> The array driver is typically used for running <a href="/docs/%7B%7Bversion%7D%7D/testing">unit tests</a>, so no session data will be persisted.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Application Structure</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-root-directory">The Root Directory</a></li>
<li><a href="#the-app-directory">The App Directory</a></li>
<li><a href="#namespacing-your-application">Namespacing Your Application</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The default Laravel application structure is intended to provide a great starting point for both large and small applications. Of course, you are free to organize your application however you like. Laravel imposes almost no restrictions on where any given class is located - as long as Composer can autoload the class.</p>

<p><a name="the-root-directory"></a></p>

<h2>The Root Directory</h2>

<p>The root directory of a fresh Laravel installation contains a variety of folders:</p>

<p>The <code>app</code> directory, as you might expect, contains the core code of your application. We&#39;ll explore this folder in more detail soon.</p>

<p>The <code>bootstrap</code> folder contains a few files that bootstrap the framework and configure autoloading.</p>

<p>The <code>config</code> directory, as the name implies, contains all of your application&#39;s configuration files.</p>

<p>The <code>database</code> folder contains your database migration and seeds.</p>

<p>The <code>public</code> directory contains the front controller and your assets (images, JavaScript, CSS, etc.).</p>

<p>The <code>resources</code> directory contains your views, raw assets (LESS, SASS, CoffeeScript), and &quot;language&quot; files.</p>

<p>The <code>storage</code> directory contains compiled Blade templates, file based sessions, file caches, and other files generated by the framework.</p>

<p>The <code>tests</code> directory contains your automated tests.</p>

<p>The <code>vendor</code> directory contains your Composer dependencies.</p>

<p><a name="the-app-directory"></a></p>

<h2>The App Directory</h2>

<p>The &quot;meat&quot; of your application lives in the <code>app</code> directory. By default, this directory is namespaced under <code>App</code> and is autoloaded by Composer using the <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 autoloading standard</a>. <strong>You may change this namespace using the <code>app:name</code> Artisan command</strong>.</p>

<p>The <code>app</code> directory ships with a variety of additional directories such as <code>Console</code>, <code>Http</code>, and <code>Providers</code>. Think of the <code>Console</code> and <code>Http</code> directories as providing an API into the &quot;core&quot; of your application. The HTTP protocol and CLI are both mechanisms to interact with your application, but do not actually contain application logic. In other words, they are simply two ways of issuing commands to your application. The <code>Console</code> directory contains all of your Artisan commands, while the <code>Http</code> directory contains your controllers, filters, and requests.</p>

<p>The <code>Commands</code> directory, of course, houses the commands for your application. Commands represent jobs that can be queued by your application, as well as tasks that you can run synchronously within the current request lifecycle.</p>

<p>The <code>Events</code> directory, as you might expect, houses event classes. Of course, using classes to represent events is not required; however, if you choose to use them, this directory is the default location they will be created by the Artisan command line.</p>

<p>The <code>Handlers</code> directory contains the handler classes for both commands and events. Handlers receive a command or event and perform logic in response to that command or event being fired.</p>

<p>The <code>Services</code> directory contains various &quot;helper&quot; services your application needs to function. For example, the <code>Registrar</code> service included with Laravel is responsible for validating and creating new users of your application. Other examples might be services to interact with external APIs, metrics systems, or even services that aggregate data from your own application.</p>

<p>The <code>Exceptions</code> directory contains your application&#39;s exception handler and is also a good place to stick any exceptions thrown by your application.</p>

<blockquote>
<p><strong>Note:</strong> Many of the classes in the <code>app</code> directory can be generated by Artisan via commands. To review the available commands, run the <code>php artisan list make</code> command in your terminal.</p>
</blockquote>

<p><a name="namespacing-your-application"></a></p>

<h2>Namespacing Your Application</h2>

<p>As discussed above, the default application namespace is <code>App</code>; however, you may change this namespace to match the name of your application, which is easily done via the <code>app:name</code> Artisan command. For example, if your application is named &quot;SocialNet&quot;, you would run the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">app</span><span class="o">:</span><span class="nx">name</span> <span class="nx">SocialNet</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Templates</h1>

<ul>
<li><a href="#blade-templating">Blade Templating</a></li>
<li><a href="#other-blade-control-structures">Other Blade Control Structures</a></li>
</ul>

<p><a name="blade-templating"></a></p>

<h2>Blade Templating</h2>

<p>Blade is a simple, yet powerful templating engine provided with Laravel. Unlike controller layouts, Blade is driven by <em>template inheritance</em> and <em>sections</em>. All Blade templates should use the <code>.blade.php</code> extension.</p>

<h4>Defining A Blade Layout</h4>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">layouts</span><span class="o">/</span><span class="nx">master</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">App</span> <span class="nx">Name</span> <span class="o">-</span> <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
            <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span>
        <span class="err">@</span><span class="nx">show</span>

        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<h4>Using A Blade Layout</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.master&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Page Title&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
    <span class="err">@@</span><span class="nx">parent</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">appended</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">stop</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">my</span> <span class="nx">body</span> <span class="nx">content</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">stop</span>
</pre></div>

<p>Note that views which <code>extend</code> a Blade layout simply override sections from the layout. Content of the layout can be included in a child view using the <code>@@parent</code> directive in a section, allowing you to append to the contents of a layout section such as a sidebar or footer.</p>

<p>Sometimes, such as when you are not sure if a section has been defined, you may wish to pass a default value to the <code>@yield</code> directive. You may pass the default value as the second argument:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;Default Content&#39;</span><span class="p">)</span>
</pre></div>

<p><a name="other-blade-control-structures"></a></p>

<h2>Other Blade Control Structures</h2>

<h4>Echoing Data</h4>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">$name</span> <span class="p">}}.</span>

<span class="nx">The</span> <span class="nx">current</span> <span class="nx">UNIX</span> <span class="nx">timestamp</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">time</span><span class="p">()</span> <span class="p">}}.</span>
</pre></div>

<h4>Echoing Data After Checking For Existence</h4>

<p>Sometimes you may wish to echo a variable, but you aren&#39;t sure if the variable has been set. Basically, you want to do this:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$name</span> <span class="o">:</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}</span>
</pre></div>

<p>However, instead of writing a ternary statement, Blade allows you to use the following convenient short-cut:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$name</span> <span class="nx">or</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}</span>
</pre></div>

<h4>Displaying Raw Text With Curly Braces</h4>

<p>If you need to display a string that is wrapped in curly braces, you may escape the Blade behavior by prefixing your text with an <code>@</code> symbol:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="p">{{</span> <span class="nx">This</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">processed</span> <span class="nx">by</span> <span class="nx">Blade</span> <span class="p">}}</span>
</pre></div>

<p>If you don&#39;t want the data to be escaped, you may use the following syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{</span><span class="o">!!</span> <span class="nx">$name</span> <span class="o">!!</span><span class="p">}.</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Be very careful when echoing content that is supplied by users of your application. Always use the double curly brace syntax to escape any HTML entities in the content.</p>
</blockquote>

<h4>If Statements</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">one</span> <span class="nx">record</span><span class="o">!</span>
<span class="err">@</span><span class="nx">elseif</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">multiple</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="k">else</span>
    <span class="nx">I</span> <span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">have</span> <span class="nx">any</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="nx">endif</span>

<span class="err">@</span><span class="nx">unless</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
    <span class="nx">You</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">signed</span> <span class="k">in</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endunless</span>
</pre></div>

<h4>Loops</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">The</span> <span class="nx">current</span> <span class="nx">value</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">$i</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endfor</span>

<span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">user</span> <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>

<span class="err">@</span><span class="nx">forelse</span><span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="err">@</span><span class="nx">empty</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">users</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforelse</span>

<span class="err">@</span><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">I</span><span class="err">&#39;</span><span class="nx">m</span> <span class="nx">looping</span> <span class="nx">forever</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endwhile</span>
</pre></div>

<h4>Including Sub-Views</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">)</span>
</pre></div>

<p>You may also pass an array of data to the included view:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<h4>Overwriting Sections</h4>

<p>To overwrite a section entirely, you may use the <code>overwrite</code> statement:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;list.item.container&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;list.item.content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">type</span> <span class="p">{{</span> <span class="nx">$item</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">overwrite</span>
</pre></div>

<h4>Displaying Language Lines</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;language.line&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;language.line&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<h4>Comments</h4>
<div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">--</span> <span class="nx">This</span> <span class="nx">comment</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">rendered</span> <span class="nx">HTML</span> <span class="o">--</span><span class="p">}}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Testing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-and-running-tests">Defining &amp; Running Tests</a></li>
<li><a href="#test-environment">Test Environment</a></li>
<li><a href="#calling-routes-from-tests">Calling Routes From Tests</a></li>
<li><a href="#mocking-facades">Mocking Facades</a></li>
<li><a href="#framework-assertions">Framework Assertions</a></li>
<li><a href="#helper-methods">Helper Methods</a></li>
<li><a href="#refreshing-the-application">Refreshing The Application</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel is built with unit testing in mind. In fact, support for testing with PHPUnit is included out of the box, and a <code>phpunit.xml</code> file is already setup for your application.</p>

<p>An example test file is provided in the <code>tests</code> directory. After installing a new Laravel application, simply run <code>phpunit</code> on the command line to run your tests.</p>

<p><a name="defining-and-running-tests"></a></p>

<h2>Defining &amp; Running Tests</h2>

<p>To create a test case, simply create a new test file in the <code>tests</code> directory. The test class should extend <code>TestCase</code>. You may then define test methods as you normally would when using PHPUnit.</p>

<h4>An Example Test Class</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">FooTest</span> <span class="kr">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">testSomethingIsTrue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertTrue</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may run all of the tests for your application by executing the <code>phpunit</code> command from your terminal.</p>

<blockquote>
<p><strong>Note:</strong> If you define your own <code>setUp</code> method, be sure to call <code>parent::setUp</code>.</p>
</blockquote>

<p><a name="test-environment"></a></p>

<h2>Test Environment</h2>

<p>When running unit tests, Laravel will automatically set the configuration environment to <code>testing</code>. Also, Laravel includes configuration files for <code>session</code> and <code>cache</code> in the test environment. Both of these drivers are set to <code>array</code> while in the test environment, meaning no session or cache data will be persisted while testing. You are free to create other testing environment configurations as necessary.</p>

<p>The <code>testing</code> environment variables may be configured in the <code>phpunit.xml</code> file.</p>

<p><a name="calling-routes-from-tests"></a></p>

<h2>Calling Routes From Tests</h2>

<h4>Calling A Route From A Test</h4>

<p>You may easily call one of your routes for a test using the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;user/profile&#39;</span><span class="p">);</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="nx">$method</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">,</span> <span class="nx">$cookies</span><span class="p">,</span> <span class="nx">$files</span><span class="p">,</span> <span class="nx">$server</span><span class="p">,</span> <span class="nx">$content</span><span class="p">);</span>
</pre></div>

<p>You may then inspect the <code>Illuminate\Http\Response</code> object:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getContent</span><span class="p">());</span>
</pre></div>

<h4>Calling A Controller From A Test</h4>

<p>You may also call a controller from a test:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You do not need to specify the full controller namespace when using the <code>action</code> method. Only specify the portion of the class name that follows the <code>App\Http\Controllers</code> namespace.</p>
</blockquote>

<p>The <code>getContent</code> method will return the evaluated string contents of the response. If your route returns a <code>View</code>, you may access it using the <code>original</code> property:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">original</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$view</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</pre></div>

<p>To call a HTTPS route, you may use the <code>callSecure</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">callSecure</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;foo/bar&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="mocking-facades"></a></p>

<h2>Mocking Facades</h2>

<p>When testing, you may often want to mock a call to a Laravel static facade. For example, consider the following controller action:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIndex</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>

    <span class="k">return</span> <span class="s1">&#39;All done!&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>We can mock the call to the <code>Event</code> class by using the <code>shouldReceive</code> method on the facade, which will return an instance of a <a href="https://github.com/padraic/mockery">Mockery</a> mock.</p>

<h4>Mocking A Facade</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testGetIndex</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;fire&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">once</span><span class="p">()</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You should not mock the <code>Request</code> facade. Instead, pass the input you desire into the <code>call</code> method when running your test.</p>
</blockquote>

<p><a name="framework-assertions"></a></p>

<h2>Framework Assertions</h2>

<p>Laravel ships with several <code>assert</code> methods to make testing a little easier:</p>

<h4>Asserting Responses Are OK</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting Response Statuses</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertResponseStatus</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
</pre></div>

<h4>Asserting Responses Are Redirects</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedTo</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedToRoute</span><span class="p">(</span><span class="s1">&#39;route.name&#39;</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedToAction</span><span class="p">(</span><span class="s1">&#39;Controller@method&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asserting A View Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertViewHas</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertViewHas</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting The Session Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHas</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHas</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting The Session Has Errors</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">();</span>

    <span class="c1">// Asserting the session has errors for a given key...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

    <span class="c1">// Asserting the session has errors for several keys...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting Old Input Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertHasOldInput</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="helper-methods"></a></p>

<h2>Helper Methods</h2>

<p>The <code>TestCase</code> class contains several helper methods to make testing your application easier.</p>

<h4>Setting And Flushing Sessions From Tests</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">flushSession</span><span class="p">();</span>
</pre></div>

<h4>Setting The Currently Authenticated User</h4>

<p>You may set the currently authenticated user using the <code>be</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">be</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<h4>Re-Seeding Database From Tests</h4>

<p>You may re-seed your database from a test using the <code>seed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">seed</span><span class="p">();</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">seed</span><span class="p">(</span><span class="s1">&#39;DatabaseSeeder&#39;</span><span class="p">);</span>
</pre></div>

<p>More information on creating seeds may be found in the <a href="/docs/migrations#database-seeding">migrations and seeding</a> section of the documentation.</p>

<p><a name="refreshing-the-application"></a></p>

<h2>Refreshing The Application</h2>

<p>As you may already know, you can access your Application (<a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>) via <code>$this-&gt;app</code> from any test method. This service container instance is refreshed for each test class. If you wish to manually force the Application to be refreshed for a given method, you may use the <code>refreshApplication</code> method from your test method. This will reset any extra bindings, such as mocks, that have been placed in the IoC container since the test case started running.</p>
<div style="page-break-after: always;" ></div><h1>Upgrade Guide</h1>

<ul>
<li><a href="#upgrade-5.0.16">Upgrading To 5.0.16</a></li>
<li><a href="#upgrade-5.0">Upgrading To 5.0 From 4.2</a></li>
<li><a href="#upgrade-4.2">Upgrading To 4.2 From 4.1</a></li>
<li><a href="#upgrade-4.1.29">Upgrading To 4.1.29 From &lt;= 4.1.x</a></li>
<li><a href="#upgrade-4.1.26">Upgrading To 4.1.26 From &lt;= 4.1.25</a></li>
<li><a href="#upgrade-4.1">Upgrading To 4.1 From 4.0</a></li>
</ul>

<p><a name="upgrade-5.0.16"></a></p>

<h2>Upgrading To 5.0.16</h2>

<p>In your <code>bootstrap/autoload.php</code> file, update the <code>$compiledPath</code> variable to:</p>
<div class="highlight"><pre><span></span><span class="nx">$compiledPath</span> <span class="o">=</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../vendor/compiled.php&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="upgrade-5.0"></a></p>

<h2>Upgrading To 5.0 From 4.2</h2>

<h3>Fresh Install, Then Migrate</h3>

<p>The recommended method of upgrading is to create a new Laravel <code>5.0</code> install and then to copy your <code>4.2</code> site&#39;s unique application files into the new application. This would include controllers, routes, Eloquent models, Artisan commands, assets, and other code specific to your application.</p>

<p>To start, <a href="/docs/%7B%7Bversion%7D%7D/installation">install a new Laravel 5 application</a> into a fresh directory in your local environment. We&#39;ll discuss each piece of the migration process in further detail below.</p>

<h3>Composer Dependencies &amp; Packages</h3>

<p>Don&#39;t forget to copy any additional Composer dependencies into your 5.0 application. This includes third-party code such as SDKs.</p>

<p>Some Laravel-specific packages may not be compatible with Laravel 5 on initial release. Check with your package&#39;s maintainer to determine the proper version of the package for Laravel 5. Once you have added any additional Composer dependencies your application needs, run <code>composer update</code>.</p>

<h3>Namespacing</h3>

<p>By default, Laravel 4 applications did not utilize namespacing within your application code. So, for example, all Eloquent models and controllers simply lived in the &quot;global&quot; namespace. For a quicker migration, you can simply leave these classes in the global namespace in Laravel 5 as well.</p>

<h3>Configuration</h3>

<h4>Migrating Environment Variables</h4>

<p>Copy the new <code>.env.example</code> file to <code>.env</code>, which is the <code>5.0</code> equivalent of the old <code>.env.php</code> file. Set any appropriate values there, like your <code>APP_ENV</code> and <code>APP_KEY</code> (your encryption key), your database credentials, and your cache and session drivers.</p>

<p>Additionally, copy any custom values you had in your old <code>.env.php</code> file and place them in both <code>.env</code> (the real value for your local environment) and <code>.env.example</code> (a sample instructional value for other team members).</p>

<p>For more information on environment configuration, view the <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">full documentation</a>.</p>

<blockquote>
<p><strong>Note:</strong> You will need to place the appropriate <code>.env</code> file and values on your production server before deploying your Laravel 5 application.</p>
</blockquote>

<h4>Configuration Files</h4>

<p>Laravel 5.0 no longer uses <code>app/config/{environmentName}/</code> directories to provide specific configuration files for a given environment. Instead, move any configuration values that vary by environment into <code>.env</code>, and then access them in your configuration files using <code>env(&#39;key&#39;, &#39;default value&#39;)</code>. You will see examples of this in the <code>config/database.php</code> configuration file.</p>

<p>Set the config files in the <code>config/</code> directory to represent either the values that are consistent across all of your environments, or set them to use <code>env()</code> to load values that vary by environment.</p>

<p>Remember, if you add more keys to <code>.env</code> file, add sample values to the <code>.env.example</code> file as well. This will help your other team members create their own <code>.env</code> files.</p>

<h3>Routes</h3>

<p>Copy and paste your old <code>routes.php</code> file into your new <code>app/Http/routes.php</code>.</p>

<h3>Controllers</h3>

<p>Next, move all of your controllers into the <code>app/Http/Controllers</code> directory. Since we are not going to migrate to full namespacing in this guide, add the <code>app/Http/Controllers</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file. Next, you can remove the namespace from the abstract <code>app/Http/Controllers/Controller.php</code> base class. Verify that your migrated controllers are extending this base class.</p>

<p>In your <code>app/Providers/RouteServiceProvider.php</code> file, set the <code>namespace</code> property to <code>null</code>.</p>

<h3>Route Filters</h3>

<p>Copy your filter bindings from <code>app/filters.php</code> and place them into the <code>boot()</code> method of <code>app/Providers/RouteServiceProvider.php</code>. Add <code>use Illuminate\Support\Facades\Route;</code> in the <code>app/Providers/RouteServiceProvider.php</code> in order to continue using the <code>Route</code> Facade.</p>

<p>You do not need to move over any of the default Laravel 4.0 filters such as <code>auth</code> and <code>csrf</code>; they&#39;re all here, but as middleware. Edit any routes or controllers that reference the old default filters (e.g. <code>[&#39;before&#39; =&gt; &#39;auth&#39;]</code>) and change them to reference the new middleware (e.g. <code>[&#39;middleware&#39; =&gt; &#39;auth&#39;].</code>)</p>

<p>Filters are not removed in Laravel 5. You can still bind and use your own custom filters using <code>before</code> and <code>after</code>.</p>

<h3>Global CSRF</h3>

<p>By default, <a href="/docs/%7B%7Bversion%7D%7D/routing#csrf-protection">CSRF protection</a> is enabled on all routes. If you&#39;d like to disable this, or only manually enable it on certain routes, remove this line from <code>App\Http\Kernel</code>&#39;s <code>middleware</code> array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;App\Http\Middleware\VerifyCsrfToken&#39;</span><span class="p">,</span>
</pre></div>

<p>If you want to use it elsewhere, add this line to <code>$routeMiddleware</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;csrf&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App\Http\Middleware\VerifyCsrfToken&#39;</span><span class="p">,</span>
</pre></div>

<p>Now you can add the middleware to individual routes / controllers using <code>[&#39;middleware&#39; =&gt; &#39;csrf&#39;]</code> on the route. For more information on middleware, consult the <a href="/docs/%7B%7Bversion%7D%7D/middleware">full documentation</a>.</p>

<h3>Eloquent Models</h3>

<p>Feel free to create a new <code>app/Models</code> directory to house your Eloquent models. Again, add this directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>

<p>Update any models using <code>SoftDeletingTrait</code> to use <code>Illuminate\Database\Eloquent\SoftDeletes</code>.</p>

<h4>Eloquent Caching</h4>

<p>Eloquent no longer provides the <code>remember</code> method for caching queries. You now are responsible for caching your queries manually using the <code>Cache::remember</code> function. For more information on caching, consult the <a href="/docs/%7B%7Bversion%7D%7D/cache">full documentation</a>.</p>

<h3>User Authentication Model</h3>

<p>To upgrade your <code>User</code> model for Laravel 5&#39;s authentication system, follow these instructions:</p>

<p><strong>Delete the following from your <code>use</code> block:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">UserInterface</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Reminders</span><span class="err">\</span><span class="nx">RemindableInterface</span><span class="p">;</span>
</pre></div>

<p><strong>Add the following to your <code>use</code> block:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Authenticatable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Passwords</span><span class="err">\</span><span class="nx">CanResetPassword</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Authenticatable</span> <span class="nx">as</span> <span class="nx">AuthenticatableContract</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">CanResetPassword</span> <span class="nx">as</span> <span class="nx">CanResetPasswordContract</span><span class="p">;</span>
</pre></div>

<p><strong>Remove the UserInterface and RemindableInterface interfaces.</strong></p>

<p><strong>Mark the class as implementing the following interfaces:</strong></p>
<div class="highlight"><pre><span></span><span class="kr">implements</span> <span class="nx">AuthenticatableContract</span><span class="p">,</span> <span class="nx">CanResetPasswordContract</span>
</pre></div>

<p><strong>Include the following traits within the class declaration:</strong></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Authenticatable</span><span class="p">,</span> <span class="nx">CanResetPassword</span><span class="p">;</span>
</pre></div>

<p><strong>If you used them, remove <code>Illuminate\Auth\Reminders\RemindableTrait</code>  and <code>Illuminate\Auth\UserTrait</code> from your use block and your class declaration.</strong></p>

<h3>Cashier User Changes</h3>

<p>The name of the trait and interface used by <a href="/docs/%7B%7Bversion%7D%7D/billing">Laravel Cashier</a> has changed. Instead of using <code>BillableTrait</code>, use the <code>Laravel\Cashier\Billable</code> trait. And, instead of <code>Laravel\Cashier\BillableInterface</code> implement the <code>Laravel\Cashier\Contracts\Billable</code> interface instead. No other method changes are required.</p>

<h3>Artisan Commands</h3>

<p>Move all of your command classes from your old <code>app/commands</code> directory to the new <code>app/Console/Commands</code> directory. Next, add the <code>app/Console/Commands</code> directory to the <code>classmap</code> directive of your <code>composer.json</code> file.</p>

<p>Then, copy your list of Artisan commands from <code>start/artisan.php</code> into the <code>commands</code> array of the <code>app/Console/Kernel.php</code> file.</p>

<h3>Database Migrations &amp; Seeds</h3>

<p>Delete the two migrations included with Laravel 5.0, since you should already have the users table in your database.</p>

<p>Move all of your migration classes from the old <code>app/database/migrations</code> directory to the new <code>database/migrations</code>. All of your seeds should be moved from <code>app/database/seeds</code> to <code>database/seeds</code>.</p>

<h3>Global IoC Bindings</h3>

<p>If you have any <a href="/docs/%7B%7Bversion%7D%7D/container">IoC</a> bindings in <code>start/global.php</code>, move them all to the <code>register</code> method of the <code>app/Providers/AppServiceProvider.php</code> file. You may need to import the <code>App</code> facade.</p>

<p>Optionally, you may break these bindings up into separate service providers by category.</p>

<h3>Views</h3>

<p>Move your views from <code>app/views</code> to the new <code>resources/views</code> directory.</p>

<h3>Blade Tag Changes</h3>

<p>For better security by default, Laravel 5.0 escapes all output from both the <code>{{ }}</code> and <code>{{{ }}}</code> Blade directives. A new <code>{!! !!}</code> directive has been introduced to display raw, unescaped output. The most secure option when upgrading your application is to only use the new <code>{!! !!}</code> directive when you are <strong>certain</strong> that it is safe to display raw output.</p>

<p>However, if you <strong>must</strong> use the old Blade syntax, add the following lines at the bottom of <code>AppServiceProvider@register</code>:</p>
<div class="highlight"><pre><span></span><span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setRawTags</span><span class="p">(</span><span class="s1">&#39;{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}&#39;</span><span class="p">);</span>
<span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setContentTags</span><span class="p">(</span><span class="s1">&#39;{{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}}&#39;</span><span class="p">);</span>
<span class="err">\</span><span class="nx">Blade</span><span class="o">::</span><span class="nx">setEscapedContentTags</span><span class="p">(</span><span class="s1">&#39;{{{&#39;</span><span class="p">,</span> <span class="s1">&#39;}}}&#39;</span><span class="p">);</span>
</pre></div>

<p>This should not be done lightly, and may make your application more vulnerable to XSS exploits. Also, comments with <code>{{--</code> will no longer work.</p>

<h3>Translation Files</h3>

<p>Move your language files from <code>app/lang</code> to the new <code>resources/lang</code> directory.</p>

<h3>Public Directory</h3>

<p>Copy your application&#39;s public assets from your <code>4.2</code> application&#39;s <code>public</code> directory to your new application&#39;s <code>public</code> directory. Be sure to keep the <code>5.0</code> version of <code>index.php</code>.</p>

<h3>Tests</h3>

<p>Move your tests from <code>app/tests</code> to the new <code>tests</code> directory.</p>

<h3>Misc. Files</h3>

<p>Copy in any other files in your project. For example, <code>.scrutinizer.yml</code>, <code>bower.json</code> and other similar tooling configuration files.</p>

<p>You may move your Sass, Less, or CoffeeScript to any location you wish. The <code>resources/assets</code> directory could be a good default location.</p>

<h3>Form &amp; HTML Helpers</h3>

<p>If you&#39;re using Form or HTML helpers, you will see an error stating <code>class &#39;Form&#39; not found</code> or <code>class &#39;Html&#39; not found</code>. The Form and HTML helpers have been deprecated in Laravel 5.0; however, there are community-driven replacements such as those maintained by the <a href="http://laravelcollective.com/docs/%7B%7Bversion%7D%7D/html">Laravel Collective</a>.</p>

<p>For example, you may add <code>&quot;laravelcollective/html&quot;: &quot;~5.0&quot;</code> to your <code>composer.json</code> file&#39;s <code>require</code> section.</p>

<p>You&#39;ll also need to add the Form and HTML facades and service provider. Edit <code>config/app.php</code> and add this line to the &#39;providers&#39; array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Collective\Html\HtmlServiceProvider&#39;</span><span class="p">,</span>
</pre></div>

<p>Next, add these lines to the &#39;aliases&#39; array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;Form&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Collective\Html\FormFacade&#39;</span><span class="p">,</span>
<span class="s1">&#39;Html&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Collective\Html\HtmlFacade&#39;</span><span class="p">,</span>
</pre></div>

<h3>CacheManager</h3>

<p>If your application code was injecting <code>Illuminate\Cache\CacheManager</code> to get a non-Facade version of Laravel&#39;s cache, inject <code>Illuminate\Contracts\Cache\Repository</code> instead.</p>

<h3>Pagination</h3>

<p>Replace any calls to <code>$paginator-&gt;links()</code> with <code>$paginator-&gt;render()</code>.</p>

<p>Replace any calls to <code>$paginator-&gt;getFrom()</code> and <code>$paginator-&gt;getTo()</code> with <code>$paginator-&gt;firstItem()</code> and <code>$paginator-&gt;lastItem()</code> respectively.</p>

<p>Remove the &quot;get&quot; prefix from calls to <code>$paginator-&gt;getPerPage()</code>, <code>$paginator-&gt;getCurrentPage()</code>, <code>$paginator-&gt;getLastPage()</code> and <code>$paginator-&gt;getTotal()</code> (e.g. <code>$paginator-&gt;perPage()</code>).</p>

<h3>Beanstalk Queuing</h3>

<p>Laravel 5.0 now requires <code>&quot;pda/pheanstalk&quot;: &quot;~3.0&quot;</code> instead of <code>&quot;pda/pheanstalk&quot;: &quot;~2.1&quot;</code>.</p>

<h3>Remote</h3>

<p>The Remote component has been deprecated.</p>

<h3>Workbench</h3>

<p>The Workbench component has been deprecated.</p>

<p><a name="upgrade-4.2"></a></p>

<h2>Upgrading To 4.2 From 4.1</h2>

<h3>PHP 5.4+</h3>

<p>Laravel 4.2 requires PHP 5.4.0 or greater.</p>

<h3>Encryption Defaults</h3>

<p>Add a new <code>cipher</code> option in your <code>app/config/app.php</code> configuration file. The value of this option should be <code>MCRYPT_RIJNDAEL_256</code>.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;cipher&#39;</span> <span class="p">=&gt;</span> <span class="nx">MCRYPT_RIJNDAEL_256</span>
</pre></div>

<p>This setting may be used to control the default cipher used by the Laravel encryption facilities.</p>

<blockquote>
<p><strong>Note:</strong> In Laravel 4.2, the default cipher is <code>MCRYPT_RIJNDAEL_128</code> (AES), which is considered to be the most secure cipher. Changing the cipher back to <code>MCRYPT_RIJNDAEL_256</code> is required to decrypt cookies/values that were encrypted in Laravel &lt;= 4.1</p>
</blockquote>

<h3>Soft Deleting Models Now Use Traits</h3>

<p>If you are using soft deleting models, the <code>softDeletes</code> property has been removed. You must now use the <code>SoftDeletingTrait</code> like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">SoftDeletingTrait</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You must also manually add the <code>deleted_at</code> column to your <code>dates</code> property:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>The API for all soft delete operations remains the same.</p>

<blockquote>
<p><strong>Note:</strong> The <code>SoftDeletingTrait</code> can not be applied on a base model. It must be used on an actual model class.</p>
</blockquote>

<h3>View / Pagination Environment Renamed</h3>

<p>If you are directly referencing the <code>Illuminate\View\Environment</code> class or <code>Illuminate\Pagination\Environment</code> class, update your code to reference <code>Illuminate\View\Factory</code> and <code>Illuminate\Pagination\Factory</code> instead. These two classes have been renamed to better reflect their function.</p>

<h3>Additional Parameter On Pagination Presenter</h3>

<p>If you are extending the <code>Illuminate\Pagination\Presenter</code> class, the abstract method <code>getPageLinkWrapper</code> signature has changed to add the <code>rel</code> argument:</p>
<div class="highlight"><pre><span></span><span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getPageLinkWrapper</span><span class="p">(</span><span class="nx">$url</span><span class="p">,</span> <span class="nx">$page</span><span class="p">,</span> <span class="nx">$rel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<h3>Iron.Io Queue Encryption</h3>

<p>If you are using the Iron.io queue driver, you will need to add a new <code>encrypt</code> option to your queue configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;encrypt&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span>
</pre></div>

<p><a name="upgrade-4.1.29"></a></p>

<h2>Upgrading To 4.1.29 From &lt;= 4.1.x</h2>

<p>Laravel 4.1.29 improves the column quoting for all database drivers. This protects your application from some mass assignment vulnerabilities when <strong>not</strong> using the <code>fillable</code> property on models. If you are using the <code>fillable</code> property on your models to protect against mass assignment, your application is not vulnerable. However, if you are using <code>guarded</code> and are passing a user controlled array into an &quot;update&quot; or &quot;save&quot; type function, you should upgrade to <code>4.1.29</code> immediately as your application may be at risk of mass assignment.</p>

<p>To upgrade to Laravel 4.1.29, simply <code>composer update</code>. No breaking changes are introduced in this release.</p>

<p><a name="upgrade-4.1.26"></a></p>

<h2>Upgrading To 4.1.26 From &lt;= 4.1.25</h2>

<p>Laravel 4.1.26 introduces security improvements for &quot;remember me&quot; cookies. Before this update, if a remember cookie was hijacked by another malicious user, the cookie would remain valid for a long period of time, even after the true owner of the account reset their password, logged out, etc.</p>

<p>This change requires the addition of a new <code>remember_token</code> column to your <code>users</code> (or equivalent) database table. After this change, a fresh token will be assigned to the user each time they login to your application. The token will also be refreshed when the user logs out of the application. The implications of this change are: if a &quot;remember me&quot; cookie is hijacked, simply logging out of the application will invalidate the cookie.</p>

<h3>Upgrade Path</h3>

<p>First, add a new, nullable <code>remember_token</code> of VARCHAR(100), TEXT, or equivalent to your <code>users</code> table.</p>

<p>Next, if you are using the Eloquent authentication driver, update your <code>User</code> class with the following three methods:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberToken</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">setRememberToken</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span> <span class="o">=</span> <span class="nx">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberTokenName</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;remember_token&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All existing &quot;remember me&quot; sessions will be invalidated by this change, so all users will be forced to re-authenticate with your application.</p>
</blockquote>

<h3>Package Maintainers</h3>

<p>Two new methods were added to the <code>Illuminate\Auth\UserProviderInterface</code> interface. Sample implementations may be found in the default drivers:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByToken</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">updateRememberToken</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
</pre></div>

<p>The <code>Illuminate\Auth\UserInterface</code> also received the three new methods described in the &quot;Upgrade Path&quot;.</p>

<p><a name="upgrade-4.1"></a></p>

<h2>Upgrading To 4.1 From 4.0</h2>

<h3>Upgrading Your Composer Dependency</h3>

<p>To upgrade your application to Laravel 4.1, change your <code>laravel/framework</code> version to <code>4.1.*</code> in your <code>composer.json</code> file.</p>

<h3>Replacing Files</h3>

<p>Replace your <code>public/index.php</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/index.php">this fresh copy from the repository</a>.</p>

<p>Replace your <code>artisan</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/artisan">this fresh copy from the repository</a>.</p>

<h3>Adding Configuration Files &amp; Options</h3>

<p>Update your <code>aliases</code> and <code>providers</code> arrays in your <code>app/config/app.php</code> configuration file. The updated values for these arrays can be found <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/app.php">in this file</a>. Be sure to add your custom and package service providers / aliases back to the arrays.</p>

<p>Add the new <code>app/config/remote.php</code> file <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/config/remote.php">from the repository</a>.</p>

<p>Add the new <code>expire_on_close</code> configuration option to your <code>app/config/session.php</code> file. The default value should be <code>false</code>.</p>

<p>Add the new <code>failed</code> configuration section to your <code>app/config/queue.php</code> file. Here are the default values for the section:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;failed&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;failed_jobs&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><strong>(Optional)</strong> Update the <code>pagination</code> configuration option in your <code>app/config/view.php</code> file to <code>pagination::slider-3</code>.</p>

<h3>Controller Updates</h3>

<p>If <code>app/controllers/BaseController.php</code> has a <code>use</code> statement at the top, change <code>use Illuminate\Routing\Controllers\Controller;</code> to <code>use Illuminate\Routing\Controller;</code>.</p>

<h3>Password Reminders Updates</h3>

<p>Password reminders have been overhauled for greater flexibility. You may examine the new stub controller by running the <code>php artisan auth:reminders-controller</code> Artisan command. You may also browse the <a href="/docs/4.1/security#password-reminders-and-reset">updated documentation</a> and update your application accordingly.</p>

<p>Update your <code>app/lang/en/reminders.php</code> language file to match <a href="https://github.com/laravel/laravel/blob/v4.1.0/app/lang/en/reminders.php">this updated file</a>.</p>

<h3>Environment Detection Updates</h3>

<p>For security reasons, URL domains may no longer be used to detect your application environment. These values are easily spoofable and allow attackers to modify the environment for a request. You should convert your environment detection to use machine host names (<code>hostname</code> command on Mac, Linux, and Windows).</p>

<h3>Simpler Log Files</h3>

<p>Laravel now generates a single log file: <code>app/storage/logs/laravel.log</code>. However, you may still configure this behavior in your <code>app/start/global.php</code> file.</p>

<h3>Removing Redirect Trailing Slash</h3>

<p>In your <code>bootstrap/start.php</code> file, remove the call to <code>$app-&gt;redirectIfTrailingSlash()</code>. This method is no longer needed as this functionality is now handled by the <code>.htaccess</code> file included with the framework.</p>

<p>Next, replace your Apache <code>.htaccess</code> file with <a href="https://github.com/laravel/laravel/blob/v4.1.0/public/.htaccess">this new one</a> that handles trailing slashes.</p>

<h3>Current Route Access</h3>

<p>The current route is now accessed via <code>Route::current()</code> instead of <code>Route::getCurrentRoute()</code>.</p>

<h3>Composer Update</h3>

<p>Once you have completed the changes above, you can run the <code>composer update</code> function to update your core application files! If you receive class load errors, try running the <code>update</code> command with the <code>--no-scripts</code> option enabled like so: <code>composer update --no-scripts</code>.</p>

<h3>Wildcard Event Listeners</h3>

<p>The wildcard event listeners no longer append the event to your handler functions parameters. If you require finding the event that was fired you should use <code>Event::firing()</code>.</p>
<div style="page-break-after: always;" ></div><h1>Validation</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#controller-validation">Controller Validation</a></li>
<li><a href="#form-request-validation">Form Request Validation</a></li>
<li><a href="#working-with-error-messages">Working With Error Messages</a></li>
<li><a href="#error-messages-and-views">Error Messages &amp; Views</a></li>
<li><a href="#available-validation-rules">Available Validation Rules</a></li>
<li><a href="#conditionally-adding-rules">Conditionally Adding Rules</a></li>
<li><a href="#custom-error-messages">Custom Error Messages</a></li>
<li><a href="#custom-validation-rules">Custom Validation Rules</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>Laravel ships with a simple, convenient facility for validating data and retrieving validation error messages via the <code>Validator</code> class.</p>

<h4>Basic Validation Example</h4>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|min:5&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p>The first argument passed to the <code>make</code> method is the data under validation. The second argument is the validation rules that should be applied to the data.</p>

<h4>Using Arrays To Specify Rules</h4>

<p>Multiple rules may be delimited using either a &quot;pipe&quot; character, or as separate elements of an array.</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min:5&#39;</span><span class="p">]]</span>
<span class="p">);</span>
</pre></div>

<h4>Validating Multiple Fields</h4>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;lamepassword&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email@example.com&#39;</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|min:8&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p>Once a <code>Validator</code> instance has been created, the <code>fails</code> (or <code>passes</code>) method may be used to perform the validation.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// The given data did not pass validation</span>
<span class="p">}</span>
</pre></div>

<p>If validation has failed, you may retrieve the error messages from the validator.</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">messages</span><span class="p">();</span>
</pre></div>

<p>You may also access an array of the failed validation rules, without messages. To do so, use the <code>failed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$failed</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">failed</span><span class="p">();</span>
</pre></div>

<h4>Validating Files</h4>

<p>The <code>Validator</code> class provides several rules for validating files, such as <code>size</code>, <code>mimes</code>, and others. When validating files, you may simply pass them into the validator with your other data.</p>

<h3>After Validation Hook</h3>

<p>The validator also allows you to attach callbacks to be run after validation is completed. This allows you to easily perform further validation, and even add more error messages to the message collection. To get started, use the <code>after</code> method on a validator instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(...);</span>

<span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$validator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">somethingElseIsInvalid</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;Something is wrong with this field!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may add as many <code>after</code> callbacks to a validator as needed.</p>

<p><a name="controller-validation"></a></p>

<h2>Controller Validation</h2>

<p>Of course, manually creating and checking a <code>Validator</code> instance each time you do validation is a headache. Don&#39;t worry, you have other options! The base <code>App\Http\Controllers\Controller</code> class included with Laravel uses a <code>ValidatesRequests</code> trait. This trait provides a single, convenient method for validating incoming HTTP requests. Here&#39;s what it looks like:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store the incoming blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If validation passes, your code will keep executing normally. However, if validation fails, an <code>Illuminate\Contracts\Validation\ValidationException</code> will be thrown. This exception is automatically caught and a redirect is generated to the user&#39;s previous location. The validation errors are even automatically flashed to the session!</p>

<p>If the incoming request was an AJAX request, no redirect will be generated. Instead, an HTTP response with a 422 status code will be returned to the browser containing a JSON representation of the validation errors.</p>

<p>For example, here is the equivalent code written manually:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store the incoming blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h3>Customizing The Flashed Error Format</h3>

<p>If you wish to customize the format of the validation errors that are flashed to the session when validation fails, override the <code>formatValidationErrors</code> on your base controller. Don&#39;t forget to import the <code>Illuminate\Validation\Validator</code> class at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * {@inheritdoc}</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">formatValidationErrors</span><span class="p">(</span><span class="nx">Validator</span> <span class="nx">$validator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="form-request-validation"></a></p>

<h2>Form Request Validation</h2>

<p>For more complex validation scenarios, you may wish to create a &quot;form request&quot;. Form requests are custom request classes that contain validation logic. To create a form request class, use the <code>make:request</code> Artisan CLI command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">request</span> <span class="nx">StoreBlogPostRequest</span>
</pre></div>

<p>The generated class will be placed in the <code>app/Http/Requests</code> directory. Let&#39;s add a few validation rules to the <code>rules</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the validation rules that apply to the request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">rules</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>So, how are the validation rules executed? All you need to do is type-hint the request on your controller method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store the incoming blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  StoreBlogPostRequest  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">StoreBlogPostRequest</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// The incoming request is valid...</span>
<span class="p">}</span>
</pre></div>

<p>The incoming form request is validated before the controller method is called, meaning you do not need to clutter your controller with any validation logic. It has already been validated!</p>

<p>If validation fails, a redirect response will be generated to send the user back to their previous location. The errors will also be flashed to the session so they are available for display. If the request was an AJAX request, a HTTP response with a 422 status code will be returned to the user including a JSON representation of the validation errors.</p>

<h3>Authorizing Form Requests</h3>

<p>The form request class also contains an <code>authorize</code> method. Within this method, you may check if the authenticated user actually has the authority to update a given resource. For example, if a user is attempting to update a blog post comment, do they actually own that comment? For example:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$commentId</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span>
                  <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">id</span><span class="p">())</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Note the call to the <code>route</code> method in the example above. This method grants you access to the URI parameters defined on the route being called, such as the <code>{comment}</code> parameter in the example below:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;comment/{comment}&#39;</span><span class="p">);</span>
</pre></div>

<p>If the <code>authorize</code> method returns <code>false</code>, a HTTP response with a 403 status code will automatically be returned and your controller method will not execute.</p>

<p>If you plan to have authorization logic in another part of your application, simply return <code>true</code> from the <code>authorize</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h3>Customizing The Flashed Error Format</h3>

<p>If you wish to customize the format of the validation errors that are flashed to the session when validation fails, override the <code>formatErrors</code> on your base request (<code>App\Http\Requests\Request</code>). Don&#39;t forget to import the <code>Illuminate\Validation\Validator</code> class at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * {@inheritdoc}</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">formatErrors</span><span class="p">(</span><span class="nx">Validator</span> <span class="nx">$validator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="working-with-error-messages"></a></p>

<h2>Working With Error Messages</h2>

<p>After calling the <code>messages</code> method on a <code>Validator</code> instance, you will receive a <code>MessageBag</code> instance, which has a variety of convenient methods for working with error messages.</p>

<h4>Retrieving The First Error Message For A Field</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Error Messages For A Field</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving All Error Messages For All Fields</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If Messages Exist For A Field</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving An Error Message With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;:message&lt;/p&gt;&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, messages are formatted using Bootstrap compatible syntax.</p>
</blockquote>

<h4>Retrieving All Error Messages With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;:message&lt;/li&gt;&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="error-messages-and-views"></a></p>

<h2>Error Messages &amp; Views</h2>

<p>Once you have performed validation, you will need an easy way to get the error messages back to your views. This is conveniently handled by Laravel. Consider the following routes as an example:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;user.register&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$rules</span> <span class="o">=</span> <span class="p">[...];</span>

    <span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">all</span><span class="p">(),</span> <span class="nx">$rules</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>Note that when validation fails, we pass the <code>Validator</code> instance to the Redirect using the <code>withErrors</code> method. This method will flash the error messages to the session so that they are available on the next request.</p>

<p>However, notice that we do not have to explicitly bind the error messages to the view in our GET route. This is because Laravel will always check for errors in the session data, and automatically bind them to the view if they are available. <strong>So, it is important to note that an <code>$errors</code> variable will always be available in all of your views, on every request</strong>, allowing you to conveniently assume the <code>$errors</code> variable is always defined and can be safely used. The <code>$errors</code> variable will be an instance of <code>MessageBag</code>.</p>

<p>So, after redirection, you may utilize the automatically bound <code>$errors</code> variable in your view:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<h3>Named Error Bags</h3>

<p>If you have multiple forms on a single page, you may wish to name the <code>MessageBag</code> of errors. This will allow you to retrieve the error messages for a specific form. Simply pass a name as the second argument to <code>withErrors</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>You may then access the named <code>MessageBag</code> instance from the <code>$errors</code> variable:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">login</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<p><a name="available-validation-rules"></a></p>

<h2>Available Validation Rules</h2>

<p>Below is a list of all available validation rules and their function:</p>

<ul>
<li><a href="#rule-accepted">Accepted</a></li>
<li><a href="#rule-active-url">Active URL</a></li>
<li><a href="#rule-after">After (Date)</a></li>
<li><a href="#rule-alpha">Alpha</a></li>
<li><a href="#rule-alpha-dash">Alpha Dash</a></li>
<li><a href="#rule-alpha-num">Alpha Numeric</a></li>
<li><a href="#rule-array">Array</a></li>
<li><a href="#rule-before">Before (Date)</a></li>
<li><a href="#rule-between">Between</a></li>
<li><a href="#rule-boolean">Boolean</a></li>
<li><a href="#rule-confirmed">Confirmed</a></li>
<li><a href="#rule-date">Date</a></li>
<li><a href="#rule-date-format">Date Format</a></li>
<li><a href="#rule-different">Different</a></li>
<li><a href="#rule-digits">Digits</a></li>
<li><a href="#rule-digits-between">Digits Between</a></li>
<li><a href="#rule-email">E-Mail</a></li>
<li><a href="#rule-exists">Exists (Database)</a></li>
<li><a href="#rule-image">Image (File)</a></li>
<li><a href="#rule-in">In</a></li>
<li><a href="#rule-integer">Integer</a></li>
<li><a href="#rule-ip">IP Address</a></li>
<li><a href="#rule-max">Max</a></li>
<li><a href="#rule-mimes">MIME Types</a></li>
<li><a href="#rule-min">Min</a></li>
<li><a href="#rule-not-in">Not In</a></li>
<li><a href="#rule-numeric">Numeric</a></li>
<li><a href="#rule-regex">Regular Expression</a></li>
<li><a href="#rule-required">Required</a></li>
<li><a href="#rule-required-if">Required If</a></li>
<li><a href="#rule-required-with">Required With</a></li>
<li><a href="#rule-required-with-all">Required With All</a></li>
<li><a href="#rule-required-without">Required Without</a></li>
<li><a href="#rule-required-without-all">Required Without All</a></li>
<li><a href="#rule-same">Same</a></li>
<li><a href="#rule-size">Size</a></li>
<li><a href="#rule-string">String</a></li>
<li><a href="#rule-timezone">Timezone</a></li>
<li><a href="#rule-unique">Unique (Database)</a></li>
<li><a href="#rule-url">URL</a></li>
</ul>

<p><a name="rule-accepted"></a></p>

<h4>accepted</h4>

<p>The field under validation must be <em>yes</em>, <em>on</em>, <em>1</em>, or <em>true</em>. This is useful for validating &quot;Terms of Service&quot; acceptance.</p>

<p><a name="rule-active-url"></a></p>

<h4>active_url</h4>

<p>The field under validation must be a valid URL according to the <code>checkdnsrr</code> PHP function.</p>

<p><a name="rule-after"></a></p>

<h4>after:<em>date</em></h4>

<p>The field under validation must be a value after a given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-alpha"></a></p>

<h4>alpha</h4>

<p>The field under validation must be entirely alphabetic characters.</p>

<p><a name="rule-alpha-dash"></a></p>

<h4>alpha_dash</h4>

<p>The field under validation may have alpha-numeric characters, as well as dashes and underscores.</p>

<p><a name="rule-alpha-num"></a></p>

<h4>alpha_num</h4>

<p>The field under validation must be entirely alpha-numeric characters.</p>

<p><a name="rule-array"></a></p>

<h4>array</h4>

<p>The field under validation must be of type array.</p>

<p><a name="rule-before"></a></p>

<h4>before:<em>date</em></h4>

<p>The field under validation must be a value preceding the given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-between"></a></p>

<h4>between:<em>min</em>,<em>max</em></h4>

<p>The field under validation must have a size between the given <em>min</em> and <em>max</em>. Strings, numerics, and files are evaluated in the same fashion as the <code>size</code> rule.</p>

<p><a name="rule-boolean"></a></p>

<h4>boolean</h4>

<p>The field under validation must be able to be cast as a boolean. Accepted input are <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code>, <code>&quot;1&quot;</code> and <code>&quot;0&quot;</code>.</p>

<p><a name="rule-confirmed"></a></p>

<h4>confirmed</h4>

<p>The field under validation must have a matching field of <code>foo_confirmation</code>. For example, if the field under validation is <code>password</code>, a matching <code>password_confirmation</code> field must be present in the input.</p>

<p><a name="rule-date"></a></p>

<h4>date</h4>

<p>The field under validation must be a valid date according to the <code>strtotime</code> PHP function.</p>

<p><a name="rule-date-format"></a></p>

<h4>date<em>format:</em>format_</h4>

<p>The field under validation must match the <em>format</em> defined according to the <code>date_parse_from_format</code> PHP function.</p>

<p><a name="rule-different"></a></p>

<h4>different:<em>field</em></h4>

<p>The given <em>field</em> must be different than the field under validation.</p>

<p><a name="rule-digits"></a></p>

<h4>digits:<em>value</em></h4>

<p>The field under validation must be <em>numeric</em> and must have an exact length of <em>value</em>.</p>

<p><a name="rule-digits-between"></a></p>

<h4>digits<em>between:</em>min<em>,</em>max_</h4>

<p>The field under validation must have a length between the given <em>min</em> and <em>max</em>.</p>

<p><a name="rule-email"></a></p>

<h4>email</h4>

<p>The field under validation must be formatted as an e-mail address.</p>

<p><a name="rule-exists"></a></p>

<h4>exists:<em>table</em>,<em>column</em></h4>

<p>The field under validation must exist on a given database table.</p>

<h4>Basic Usage Of Exists Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states&#39;</span>
</pre></div>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states,abbreviation&#39;</span>
</pre></div>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,account_id,1&#39;</span>
</pre></div>

<p>Passing <code>NULL</code> as a &quot;where&quot; clause value will add a check for a <code>NULL</code> database value:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,deleted_at,NULL&#39;</span>
</pre></div>

<p><a name="rule-image"></a></p>

<h4>image</h4>

<p>The file under validation must be an image (jpeg, png, bmp, gif, or svg)</p>

<p><a name="rule-in"></a></p>

<h4>in:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be included in the given list of values.</p>

<p><a name="rule-integer"></a></p>

<h4>integer</h4>

<p>The field under validation must have an integer value.</p>

<p><a name="rule-ip"></a></p>

<h4>ip</h4>

<p>The field under validation must be formatted as an IP address.</p>

<p><a name="rule-max"></a></p>

<h4>max:<em>value</em></h4>

<p>The field under validation must be less than or equal to a maximum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-mimes"></a></p>

<h4>mimes:<em>foo</em>,<em>bar</em>,...</h4>

<p>The file under validation must have a MIME type corresponding to one of the listed extensions.</p>

<h4>Basic Usage Of MIME Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;photo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mimes:jpeg,bmp,png&#39;</span>
</pre></div>

<p><a name="rule-min"></a></p>

<h4>min:<em>value</em></h4>

<p>The field under validation must have a minimum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-not-in"></a></p>

<h4>not<em>in:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must not be included in the given list of values.</p>

<p><a name="rule-numeric"></a></p>

<h4>numeric</h4>

<p>The field under validation must have a numeric value.</p>

<p><a name="rule-regex"></a></p>

<h4>regex:<em>pattern</em></h4>

<p>The field under validation must match the given regular expression.</p>

<p><strong>Note:</strong> When using the <code>regex</code> pattern, it may be necessary to specify rules in an array instead of using pipe delimiters, especially if the regular expression contains a pipe character.</p>

<p><a name="rule-required"></a></p>

<h4>required</h4>

<p>The field under validation must be present in the input data.</p>

<p><a name="rule-required-if"></a></p>

<h4>required<em>if:</em>field<em>,</em>value_,...</h4>

<p>The field under validation must be present if the <em>field</em> is equal to any <em>value</em>.</p>

<p><a name="rule-required-with"></a></p>

<h4>required<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only if</em> any of the other specified fields are present.</p>

<p><a name="rule-required-with-all"></a></p>

<h4>required<em>with</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only if</em> all of the other specified fields are present.</p>

<p><a name="rule-required-without"></a></p>

<h4>required<em>without:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only when</em> any of the other specified fields are not present.</p>

<p><a name="rule-required-without-all"></a></p>

<h4>required<em>without</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only when</em> all of the other specified fields are not present.</p>

<p><a name="rule-same"></a></p>

<h4>same:<em>field</em></h4>

<p>The given <em>field</em> must match the field under validation.</p>

<p><a name="rule-size"></a></p>

<h4>size:<em>value</em></h4>

<p>The field under validation must have a size matching the given <em>value</em>. For string data, <em>value</em> corresponds to the number of characters. For numeric data, <em>value</em> corresponds to a given integer value. For files, <em>size</em> corresponds to the file size in kilobytes.</p>

<p><a name="rule-string"></a></p>

<h4>string</h4>

<p>The field under validation must be a string type.</p>

<p><a name="rule-timezone"></a></p>

<h4>timezone</h4>

<p>The field under validation must be a valid timezone identifier according to the <code>timezone_identifiers_list</code> PHP function.</p>

<p><a name="rule-unique"></a></p>

<h4>unique:<em>table</em>,<em>column</em>,<em>except</em>,<em>idColumn</em></h4>

<p>The field under validation must be unique on a given database table. If the <code>column</code> option is not specified, the field name will be used.</p>

<p>Occasionally, you may need to set a custom connection for database queries made by the Validator. As seen above, setting <code>unique:users</code> as a validation rule will use the default database connection to query the database. To override this, do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">$verifier</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;validation.presence&#39;</span><span class="p">);</span>

<span class="nx">$verifier</span><span class="o">-&gt;</span><span class="nx">setConnection</span><span class="p">(</span><span class="s1">&#39;connectionName&#39;</span><span class="p">);</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|min:8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">setPresenceVerifier</span><span class="p">(</span><span class="nx">$verifier</span><span class="p">);</span>
</pre></div>

<h4>Basic Usage Of Unique Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users&#39;</span>
</pre></div>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address&#39;</span>
</pre></div>

<h4>Forcing A Unique Rule To Ignore A Given ID</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,10&#39;</span>
</pre></div>

<h4>Adding Additional Where Clauses</h4>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,NULL,id,account_id,1&#39;</span>
</pre></div>

<p>In the rule above, only rows with an <code>account_id</code> of <code>1</code> would be included in the unique check.</p>

<p><a name="rule-url"></a></p>

<h4>url</h4>

<p>The field under validation must be formatted as an URL.</p>

<blockquote>
<p><strong>Note:</strong> This function uses PHP&#39;s <code>filter_var</code> method.</p>
</blockquote>

<p><a name="conditionally-adding-rules"></a></p>

<h2>Conditionally Adding Rules</h2>

<p>In some situations, you may wish to run validation checks against a field <strong>only</strong> if that field is present in the input array. To quickly accomplish this, add the <code>sometimes</code> rule to your rule list:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sometimes|required|email&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>In the example above, the <code>email</code> field will only be validated if it is present in the <code>$data</code> array.</p>

<h4>Complex Conditional Validation</h4>

<p>Sometimes you may wish to require a given field only if another field has a greater value than 100. Or you may need two fields to have a given value only when another field is present. Adding these validation rules doesn&#39;t have to be a pain. First, create a <code>Validator</code> instance with your <em>static rules</em> that never change:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;games&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|numeric&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Let&#39;s assume our web application is for game collectors. If a game collector registers with our application and they own more than 100 games, we want them to explain why they own so many games. For example, perhaps they run a game re-sell shop, or maybe they just enjoy collecting. To conditionally add this requirement, we can use the <code>sometimes</code> method on the <code>Validator</code> instance.</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;required|max:500&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>sometimes</code> method is the name of the field we are conditionally validating. The second argument is the rules we want to add. If the <code>Closure</code> passed as the third argument returns <code>true</code>, the rules will be added. This method makes it a breeze to build complex conditional validations. You may even add conditional validations for several fields at once:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">([</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;cost&#39;</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>$input</code> parameter passed to your <code>Closure</code> will be an instance of <code>Illuminate\Support\Fluent</code> and may be used as an object to access your input and files.</p>
</blockquote>

<p><a name="custom-error-messages"></a></p>

<h2>Custom Error Messages</h2>

<p>If needed, you may use custom error messages for validation instead of the defaults. There are several ways to specify custom messages.</p>

<h4>Passing Custom Messages Into Validator</h4>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute field is required.&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><em>Note:</em> The <code>:attribute</code> place-holder will be replaced by the actual name of the field under validation. You may also utilize other place-holders in validation messages.</p>
</blockquote>

<h4>Other Validation Place-Holders</h4>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;same&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute and :other must match.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be exactly :size.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;between&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be between :min - :max.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;in&#39;</span>      <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be one of the following types: :values&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<h4>Specifying A Custom Message For A Given Attribute</h4>

<p>Sometimes you may wish to specify a custom error messages only for a specific field:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;email.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="localization"></a></p>

<h4>Specifying Custom Messages In Language Files</h4>

<p>In some cases, you may wish to specify your custom messages in a language file instead of passing them directly to the <code>Validator</code>. To do so, add your messages to <code>custom</code> array in the <code>resources/lang/xx/validation.php</code> language file.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="custom-validation-rules"></a></p>

<h2>Custom Validation Rules</h2>

<h4>Registering A Custom Validation Rule</h4>

<p>Laravel provides a variety of helpful validation rules; however, you may wish to specify some of your own. One method of registering custom validation rules is using the <code>Validator::extend</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The custom validator Closure receives three arguments: the name of the <code>$attribute</code> being validated, the <code>$value</code> of the attribute, and an array of <code>$parameters</code> passed to the rule.</p>

<p>You may also pass a class and method to the <code>extend</code> method instead of a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooValidator@validate&#39;</span><span class="p">);</span>
</pre></div>

<p>Note that you will also need to define an error message for your custom rules. You can do so either using an inline custom message array or by adding an entry in the validation language file.</p>

<h4>Extending The Validator Class</h4>

<p>Instead of using Closure callbacks to extend the Validator, you may also extend the Validator class itself. To do so, write a Validator class that extends <code>Illuminate\Validation\Validator</code>. You may add validation methods to the class by prefixing them with <code>validate</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">CustomValidator</span> <span class="k">extends</span> <span class="nx">\Illuminate\Validation\Validator</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateFoo</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Registering A Custom Validator Resolver</h4>

<p>Next, you need to register your custom Validator extension:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">resolver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$translator</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomValidator</span><span class="p">(</span><span class="nx">$translator</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When creating a custom validation rule, you may sometimes need to define custom place-holder replacements for error messages. You may do so by creating a custom Validator as described above, and adding a <code>replaceXXX</code> function to the validator.</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="kd">function</span> <span class="nx">replaceFoo</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;:foo&#39;</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">$message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to add a custom message &quot;replacer&quot; without extending the <code>Validator</code> class, you may use the <code>Validator::replacer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">replacer</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Views</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#view-composers">View Composers</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>Views contain the HTML served by your application, and serve as a convenient method of separating your controller and domain logic from your presentation logic. Views are stored in the <code>resources/views</code> directory.</p>

<p>A simple view looks like this:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">View</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$name</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>The view may be returned to the browser like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;James&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the first argument passed to the <code>view</code> helper corresponds to the name of the view file in the <code>resources/views</code> directory. The second argument passed to helper is an array of data that should be made available to the view.</p>

<p>Of course, views may also be nested within sub-directories of the <code>resources/views</code> directory. For example, if your view is stored at <code>resources/views/admin/profile.php</code>, it should be returned like so:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;admin.profile&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<h4>Passing Data To Views</h4>
<div class="highlight"><pre><span></span><span class="c1">// Using conventional approach</span>
<span class="nx">$view</span> <span class="o">=</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">);</span>

<span class="c1">// Using Magic Methods</span>
<span class="nx">$view</span> <span class="o">=</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withName</span><span class="p">(</span><span class="s1">&#39;Victoria&#39;</span><span class="p">);</span>
</pre></div>

<p>In the example above, the variable <code>$name</code> is made accessible to the view and contains <code>Victoria</code>.</p>

<p>If you wish, you may pass an array of data as the second parameter to the <code>view</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greetings&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p>When passing information in this manner, <code>$data</code> should be an array with key/value pairs. Inside your view, you can then access each value using it&#39;s corresponding key, like <code>{{ $key }}</code> (assuming <code>$data[&#39;key&#39;]</code> exists).</p>

<h4>Sharing Data With All Views</h4>

<p>Occasionally, you may need to share a piece of data with all views that are rendered by your application. You have several options: the <code>view</code> helper, the <code>Illuminate\Contracts\View\Factory</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a>, or a wildcard <a href="#view-composers">view composer</a>.</p>

<p>For example, using the <code>view</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">share</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>You may also use the <code>View</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">share</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>Typically, you would place calls to the <code>share</code> method within a service provider&#39;s <code>boot</code> method. You are free to add them to the <code>AppServiceProvider</code> or generate a separate service provider to house them.</p>

<blockquote>
<p><strong>Note:</strong> When the <code>view</code> helper is called without arguments, it returns an implementation of the <code>Illuminate\Contracts\View\Factory</code> contract.</p>
</blockquote>

<h4>Determining If A View Exists</h4>

<p>If you need to determine if a view exists, you may use the <code>exists</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;emails.customer&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Returning A View From A File Path</h4>

<p>If you wish, you may generate a view from a fully-qualified file path:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="view-composers"></a></p>

<h2>View Composers</h2>

<p>View composers are callbacks or class methods that are called when a view is rendered. If you have data that you want to be bound to a view each time that view is rendered, a view composer organizes that logic into a single location.</p>

<h4>Defining A View Composer</h4>

<p>Let&#39;s organize our view composers within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. We&#39;ll use the <code>View</code> facade to access the underlying <code>Illuminate\Contracts\View\Factory</code> contract implementation:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">View</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ComposerServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Register bindings in the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Using class based composers...</span>
        <span class="nx">View</span><span class="o">::</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\ViewComposers\ProfileComposer&#39;</span><span class="p">);</span>

        <span class="c1">// Using Closure based composers...</span>
        <span class="nx">View</span><span class="o">::</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$view</span><span class="p">)</span>
        <span class="p">{</span>

        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the service provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Laravel does not include a default directory for view composers. You are free to organize them however you wish. For example, you could create an <code>App\Http\ViewComposers</code> directory.</p>
</blockquote>

<p>Remember, you will need to add the service provider to the <code>providers</code> array in the <code>config/app.php</code> configuration file.</p>

<p>Now that we have registered the composer, the <code>ProfileComposer@compose</code> method will be executed each time the <code>profile</code> view is being rendered. So, let&#39;s define the composer class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">App\Http\ViewComposers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\View\View</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Users\Repository</span> <span class="k">as</span> <span class="nx">UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileComposer</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * The user repository implementation.</span>
<span class="sd">     *</span>
<span class="sd">     * @var UserRepository</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new profile composer.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Dependencies automatically resolved by service container...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bind data to the view.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  View  $view</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compose</span><span class="p">(</span><span class="nx">View</span> <span class="nv">$view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Just before the view is rendered, the composer&#39;s <code>compose</code> method is called with the <code>Illuminate\Contracts\View\View</code> instance. You may use the <code>with</code> method to bind data to the view.</p>

<blockquote>
<p><strong>Note:</strong> All view composers are resolved via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so you may type-hint any dependencies you need within a composer&#39;s constructor.</p>
</blockquote>

<h4>Wildcard View Composers</h4>

<p>The <code>composer</code> method accepts the <code>*</code> character as a wildcard, so you may attach a composer to all views like so:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$view</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Attaching A Composer To Multiple Views</h4>

<p>You may also attach a view composer to multiple views at once:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">([</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;dashboard&#39;</span><span class="p">],</span> <span class="s1">&#39;App\Http\ViewComposers\MyViewComposer&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining Multiple Composers</h4>

<p>You may use the <code>composers</code> method to register a group of composers at the same time:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composers</span><span class="p">([</span>
    <span class="s1">&#39;App\Http\ViewComposers\AdminComposer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;admin.index&#39;</span><span class="p">,</span> <span class="s1">&#39;admin.profile&#39;</span><span class="p">],</span>
    <span class="s1">&#39;App\Http\ViewComposers\UserComposer&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;App\Http\ViewComposers\ProductComposer&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;product&#39;</span>
<span class="p">]);</span>
</pre></div>

<h3>View Creators</h3>

<p>View <strong>creators</strong> work almost exactly like view composers; however, they are fired immediately when the view is instantiated. To register a view creator, use the <code>creator</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">creator</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\ViewCreators\ProfileCreator&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div></div></body></html>