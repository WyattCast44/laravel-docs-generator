<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="resources/code.css"><link rel="stylesheet" href="resources/tailwind.css"></head><body><div class="prose prose-xl mx-auto my-10"><h1>Artisan CLI</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Artisan is the name of the command-line interface included with Laravel. It provides a number of helpful commands for your use while developing your application. It is driven by the powerful Symfony Console component.</p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<h4>Listing All Available Commands</h4>

<p>To view a list of all available Artisan commands, you may use the <code>list</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">list</span>
</pre></div>

<h4>Viewing The Help Screen For A Command</h4>

<p>Every command also includes a &quot;help&quot; screen which displays and describes the command&#39;s available arguments and options. To view a help screen, simply precede the name of the command with <code>help</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">help</span> <span class="nx">migrate</span>
</pre></div>

<h4>Specifying The Configuration Environment</h4>

<p>You may specify the configuration environment that should be used while running a command using the <code>--env</code> switch:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">env</span><span class="o">=</span><span class="nx">local</span>
</pre></div>

<h4>Displaying Your Current Laravel Version</h4>

<p>You may also view the current version of your Laravel installation using the <code>--version</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="o">--</span><span class="nx">version</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Cashier</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#subscribing-to-a-plan">Subscribing To A Plan</a></li>
<li><a href="#no-card-up-front">No Card Up Front</a></li>
<li><a href="#swapping-subscriptions">Swapping Subscriptions</a></li>
<li><a href="#subscription-quantity">Subscription Quantity</a></li>
<li><a href="#cancelling-a-subscription">Cancelling A Subscription</a></li>
<li><a href="#resuming-a-subscription">Resuming A Subscription</a></li>
<li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
<li><a href="#handling-failed-payments">Handling Failed Payments</a></li>
<li><a href="#handling-other-stripe-webhooks">Handling Other Stripe Webhooks</a></li>
<li><a href="#invoices">Invoices</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Cashier provides an expressive, fluent interface to <a href="https://stripe.com">Stripe&#39;s</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading writing. In addition to basic subscription management, Cashier can handle coupons, swapping subscription, subscription &quot;quantities&quot;, cancellation grace periods, and even generate invoice PDFs.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<h4>Composer</h4>

<p>First, add the Cashier package to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;laravel/cashier&quot;</span><span class="o">:</span> <span class="s2">&quot;~2.0&quot;</span>
</pre></div>

<h4>Service Provider</h4>

<p>Next, register the <code>Laravel\Cashier\CashierServiceProvider</code> in your <code>app</code> configuration file.</p>

<h4>Migration</h4>

<p>Before using Cashier, we&#39;ll need to add several columns to your database. Don&#39;t worry, you can use the <code>cashier:table</code> Artisan command to create a migration to add the necessary column. For example, to add the column to the users table use <code>php artisan cashier:table users</code>. Once the migration has been created, simply run the <code>migrate</code> command.</p>

<h4>Model Setup</h4>

<p>Next, add the BillableTrait and appropriate date mutators to your model definition:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">BillableTrait</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">BillableInterface</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="kr">implements</span> <span class="nx">BillableInterface</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">BillableTrait</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trial_ends_at&#39;</span><span class="p">,</span> <span class="s1">&#39;subscription_ends_at&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<h4>Stripe Key</h4>

<p>Finally, set your Stripe key in one of your bootstrap files:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">setStripeKey</span><span class="p">(</span><span class="s1">&#39;stripe-key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="subscribing-to-a-plan"></a></p>

<h2>Subscribing To A Plan</h2>

<p>Once you have a model instance, you can easily subscribe that user to a given Stripe plan:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">withCoupon</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>The <code>subscription</code> method will automatically create the Stripe subscription, as well as update your database with Stripe customer ID and other relevant billing information. If your plan has a trial configured in Stripe, the trial end date will also automatically be set on the user record.</p>

<p>If your plan has a trial period that is <strong>not</strong> configured in Stripe, you must set the trial end date manually after subscribing:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h3>Specifying Additional User Details</h3>

<p>If you would like to specify additional customer details, you may do so by passing them as second argument to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Our First Customer&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>To learn more about the additional fields supported by Stripe, check out Stripe&#39;s <a href="https://stripe.com/docs/api#create_customer">documentation on customer creation</a>.</p>

<p><a name="no-card-up-front"></a></p>

<h2>No Card Up Front</h2>

<p>If your application offers a free-trial with no credit-card up front, set the <code>cardUpFront</code> property on your model to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$cardUpFront</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>

<p>On account creation, be sure to set the trial end date on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="swapping-subscriptions"></a></p>

<h2>Swapping Subscriptions</h2>

<p>To swap a user to a new subscription, use the <code>swap</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;premium&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">();</span>
</pre></div>

<p>If the user is on trial, the trial will be maintained as normal. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p>

<p><a name="subscription-quantity"></a></p>

<h2>Subscription Quantity</h2>

<p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge $10 per month per user on an account. To easily increment or decrement your subscription quantity, use the <code>increment</code> and <code>decrement</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">();</span>

<span class="c1">// Add five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">();</span>

<span class="c1">// Subtract five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p><a name="cancelling-a-subscription"></a></p>

<h2>Cancelling A Subscription</h2>

<p>Cancelling a subscription is a walk in the park:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
</pre></div>

<p>When a subscription is cancelled, Cashier will automatically set the <code>subscription_ends_at</code> column on your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p>

<p><a name="resuming-a-subscription"></a></p>

<h2>Resuming A Subscription</h2>

<p>If a user has cancelled their subscription and you wish to resume it, use the <code>resume</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">resume</span><span class="p">(</span><span class="nx">$creditCardToken</span><span class="p">);</span>
</pre></div>

<p>If the user cancels a subscription and then resumes that subscription before the subscription has fully expired, they will not be billed immediately. Their subscription will simply be re-activated, and they will be billed on the original billing cycle.</p>

<p><a name="checking-subscription-status"></a></p>

<h2>Checking Subscription Status</h2>

<p>To verify that a user is subscribed to your application, use the <code>subscribed</code> command:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribed</code> method makes a great candidate for a route filter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;subscribed&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>You may also determine if the user is still within their trial period (if applicable) using the <code>onTrial</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was scheduled to end on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>everSubscribed</code> method may be used to determine if the user has ever subscribed to a plan in your application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">everSubscribed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>onPlan</code> method may be used to determine if the user is subscribed to a given plan based on its ID:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onPlan</span><span class="p">(</span><span class="s1">&#39;monthly&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="handling-failed-payments"></a></p>

<h2>Handling Failed Payments</h2>

<p>What if a customer&#39;s credit card expires? No worries - Cashier includes a Webhook controller that can easily cancel the customer&#39;s subscription for you. Just point a route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;stripe/webhook&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel\Cashier\WebhookController@handleWebhook&#39;</span><span class="p">);</span>
</pre></div>

<p>That&#39;s it! Failed payments will be captured and handled by the controller. The controller will cancel the customer&#39;s subscription after three failed payment attempts. The <code>stripe/webhook</code> URI in this example is just for example. You will need to configure the URI in your Stripe settings.</p>

<p><a name="handling-other-stripe-webhooks"></a></p>

<h2>Handling Other Stripe Webhooks</h2>

<p>If you have additional Stripe webhook events you would like to handle, simply extend the Webhook controller. Your method names should correspond to Cashier&#39;s expected convention, specifically, methods should be prefixed with <code>handle</code> and the name of the Stripe webhook you wish to handle. For example, if you wish to handle the <code>invoice.payment_succeeded</code> webhook, you should add a <code>handleInvoicePaymentSucceeded</code> method to the controller.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">WebhookController</span> <span class="kr">extends</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">WebhookController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handleInvoicePaymentSucceeded</span><span class="p">(</span><span class="nx">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle The Event</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> In addition to updating the subscription information in your database, the Webhook controller will also cancel the subscription via the Stripe API.</p>
</blockquote>

<p><a name="invoices"></a></p>

<h2>Invoices</h2>

<p>You can easily retrieve an array of a user&#39;s invoices using the <code>invoices</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoices</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoices</span><span class="p">();</span>
</pre></div>

<p>When listing the invoices for the customer, you may use these helper methods to display the relevant invoice information:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span>

<span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dateString</span><span class="p">()</span> <span class="p">}}</span>

<span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">dollars</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>Use the <code>downloadInvoice</code> method to generate a PDF download of the invoice. Yes, it&#39;s really this easy:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">downloadInvoice</span><span class="p">(</span><span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;vendor&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;Your Company&#39;</span><span class="p">,</span>
    <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Product&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Cache</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#cache-usage">Cache Usage</a></li>
<li><a href="#increments-and-decrements">Increments &amp; Decrements</a></li>
<li><a href="#cache-tags">Cache Tags</a></li>
<li><a href="#database-cache">Database Cache</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides a unified API for various caching systems. The cache configuration is located at <code>app/config/cache.php</code>. In this file you may specify which cache driver you would like used by default throughout your application. Laravel supports popular caching backends like <a href="http://memcached.org">Memcached</a> and <a href="http://redis.io">Redis</a> out of the box.</p>

<p>The cache configuration file also contains various other options, which are documented within the file, so make sure to read over these options. By default, Laravel is configured to use the <code>file</code> cache driver, which stores the serialized, cached objects in the filesystem. For larger applications, it is recommended that you use an in-memory cache such as Memcached or APC.</p>

<p><a name="cache-usage"></a></p>

<h2>Cache Usage</h2>

<h4>Storing An Item In The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<h4>Using Carbon Objects To Set Expire Time</h4>
<div class="highlight"><pre><span></span><span class="nx">$expiresAt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$expiresAt</span><span class="p">);</span>
</pre></div>

<h4>Storing An Item In The Cache If It Doesn&#39;t Exist</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>The <code>add</code> method will return <code>true</code> if the item is actually <strong>added</strong> to the cache. Otherwise, the method will return <code>false</code>.</p>

<h4>Checking For Existence In Cache</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving An Item From The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item Or Returning A Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h4>Storing An Item In The Cache Permanently</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p>Sometimes you may wish to retrieve an item from the cache, but also store a default value if the requested item doesn&#39;t exist. You may do this using the <code>Cache::remember</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>You may also combine the <code>remember</code> and <code>forever</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">rememberForever</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Note that all items stored in the cache are serialized, so you are free to store any type of data.</p>

<h4>Pulling An Item From The Cache</h4>

<p>If you need to retrieve an item from the cache and then delete it, you may use the <code>pull</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Removing An Item From The Cache</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="increments-and-decrements"></a></p>

<h2>Increments &amp; Decrements</h2>

<p>All drivers except <code>file</code> and <code>database</code> support the <code>increment</code> and <code>decrement</code> operations:</p>

<h4>Incrementing A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<h4>Decrementing A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<p><a name="cache-tags"></a></p>

<h2>Cache Tags</h2>

<blockquote>
<p><strong>Note:</strong> Cache tags are not supported when using the <code>file</code> or <code>database</code> cache drivers. Furthermore, when using multiple tags with caches that are stored &quot;forever&quot;, performance will be best with a driver such as <code>memcached</code>, which automatically purges stale records.</p>
</blockquote>

<h4>Accessing A Tagged Cache</h4>

<p>Cache tags allow you to tag related items in the cache, and then flush all caches tagged with a given name. To access a tagged cache, use the <code>tags</code> method.</p>

<p>You may store a tagged cache by passing in an ordered list of tag names as arguments, or as an ordered array of tag names:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$john</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">,</span> <span class="nx">$anne</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>You may use any cache storage method in combination with tags, including <code>remember</code>, <code>forever</code>, and <code>rememberForever</code>. You may also access cached items from the tagged cache, as well as use the other cache methods such as <code>increment</code> and <code>decrement</code>.</p>

<h4>Accessing Items In A Tagged Cache</h4>

<p>To access a tagged cache, pass the same ordered list of tags used to save it.</p>
<div class="highlight"><pre><span></span><span class="nx">$anne</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">);</span>

<span class="nx">$john</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">);</span>
</pre></div>

<p>You may flush all items tagged with a name or list of names. For example, this statement would remove all caches tagged with either <code>people</code>, <code>authors</code>, or both. So, both &quot;Anne&quot; and &quot;John&quot; would be removed from the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p>In contrast, this statement would remove only caches tagged with <code>authors</code>, so &quot;John&quot; would be removed, but not &quot;Anne&quot;.</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p><a name="database-cache"></a></p>

<h2>Database Cache</h2>

<p>When using the <code>database</code> cache driver, you will need to setup a table to contain the cache items. You&#39;ll find an example <code>Schema</code> declaration for the table below:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;expiration&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Artisan Development</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#building-a-command">Building A Command</a></li>
<li><a href="#registering-commands">Registering Commands</a></li>
<li><a href="#calling-other-commands">Calling Other Commands</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to the commands provided with Artisan, you may also build your own custom commands for working with your application. You may store your custom commands in the <code>app/commands</code> directory; however, you are free to choose your own storage location as long as your commands can be autoloaded based on your <code>composer.json</code> settings.</p>

<p><a name="building-a-command"></a></p>

<h2>Building A Command</h2>

<h3>Generating The Class</h3>

<p>To create a new command, you may use the <code>command:make</code> Artisan command, which will generate a command stub to help you get started:</p>

<h4>Generate A New Command Class</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">command</span><span class="o">:</span><span class="nx">make</span> <span class="nx">FooCommand</span>
</pre></div>

<p>By default, generated commands will be stored in the <code>app/commands</code> directory; however, you may specify custom path or namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">command</span><span class="o">:</span><span class="nx">make</span> <span class="nx">FooCommand</span> <span class="o">--</span><span class="nx">path</span><span class="o">=</span><span class="nx">app</span><span class="o">/</span><span class="nx">classes</span> <span class="o">--</span><span class="nx">namespace</span><span class="o">=</span><span class="nx">Classes</span>
</pre></div>

<p>When creating the command, the <code>--command</code> option may be used to assign the terminal command name:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">command</span><span class="o">:</span><span class="nx">make</span> <span class="nx">AssignUsers</span> <span class="o">--</span><span class="nx">command</span><span class="o">=</span><span class="nx">users</span><span class="o">:</span><span class="nx">assign</span>
</pre></div>

<h3>Writing The Command</h3>

<p>Once your command is generated, you should fill out the <code>name</code> and <code>description</code> properties of the class, which will be used when displaying your command on the <code>list</code> screen.</p>

<p>The <code>fire</code> method will be called when your command is executed. You may place any command logic in this method.</p>

<h3>Arguments &amp; Options</h3>

<p>The <code>getArguments</code> and <code>getOptions</code> methods are where you may define any arguments or options your command receives. Both of these methods return an array of commands, which are described by a list of array options.</p>

<p>When defining <code>arguments</code>, the array definition values represent the following:</p>
<div class="highlight"><pre><span></span><span class="nx">array</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$mode</span><span class="p">,</span> <span class="nx">$description</span><span class="p">,</span> <span class="nx">$defaultValue</span><span class="p">)</span>
</pre></div>

<p>The argument <code>mode</code> may be any of the following: <code>InputArgument::REQUIRED</code> or <code>InputArgument::OPTIONAL</code>.</p>

<p>When defining <code>options</code>, the array definition values represent the following:</p>
<div class="highlight"><pre><span></span><span class="nx">array</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$shortcut</span><span class="p">,</span> <span class="nx">$mode</span><span class="p">,</span> <span class="nx">$description</span><span class="p">,</span> <span class="nx">$defaultValue</span><span class="p">)</span>
</pre></div>

<p>For options, the argument <code>mode</code> may be: <code>InputOption::VALUE_REQUIRED</code>, <code>InputOption::VALUE_OPTIONAL</code>, <code>InputOption::VALUE_IS_ARRAY</code>, <code>InputOption::VALUE_NONE</code>.</p>

<p>The <code>VALUE_IS_ARRAY</code> mode indicates that the switch may be used multiple times when calling the command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">option</span><span class="o">=</span><span class="nx">bar</span> <span class="o">--</span><span class="nx">option</span><span class="o">=</span><span class="nx">baz</span>
</pre></div>

<p>The <code>VALUE_NONE</code> option indicates that the option is simply used as a &quot;switch&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">option</span>
</pre></div>

<h3>Retrieving Input</h3>

<p>While your command is executing, you will obviously need to access the values for the arguments and options accepted by your application. To do so, you may use the <code>argument</code> and <code>option</code> methods:</p>

<h4>Retrieving The Value Of A Command Argument</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Arguments</h4>
<div class="highlight"><pre><span></span><span class="nx">$arguments</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Value Of A Command Option</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Options</h4>
<div class="highlight"><pre><span></span><span class="nx">$options</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">();</span>
</pre></div>

<h3>Writing Output</h3>

<p>To send output to the console, you may use the <code>info</code>, <code>comment</code>, <code>question</code> and <code>error</code> methods. Each of these methods will use the appropriate ANSI colors for their purpose.</p>

<h4>Sending Information To The Console</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
</pre></div>

<h4>Sending An Error Message To The Console</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">);</span>
</pre></div>

<h3>Asking Questions</h3>

<p>You may also use the <code>ask</code> and <code>confirm</code> methods to prompt the user for input:</p>

<h4>Asking The User For Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">ask</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking The User For Secret Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">secret</span><span class="p">(</span><span class="s1">&#39;What is the password?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking The User For Confirmation</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;Do you wish to continue? [yes|no]&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify a default value to the <code>confirm</code> method, which should be <code>true</code> or <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="nx">$question</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="registering-commands"></a></p>

<h2>Registering Commands</h2>

<h4>Registering An Artisan Command</h4>

<p>Once your command is finished, you need to register it with Artisan so it will be available for use. This is typically done in the <code>app/start/artisan.php</code> file. Within this file, you may use the <code>Artisan::add</code> method to register the command:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">CustomCommand</span><span class="p">);</span>
</pre></div>

<h4>Registering A Command That Is In The IoC Container</h4>

<p>If your command is registered in the application <a href="/docs/4.2/ioc">IoC container</a>, you may use the <code>Artisan::resolve</code> method to make it available to Artisan:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;binding.name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Registering Commands In A Service Provider</h4>

<p>If you need to register commands from within a service provider, you should call the <code>commands</code> method from the provider&#39;s <code>boot</code> method, passing the <a href="/docs/4.2/ioc">IoC container</a> binding for the command:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">commands</span><span class="p">(</span><span class="s1">&#39;command.binding&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="calling-other-commands"></a></p>

<h2>Calling Other Commands</h2>

<p>Sometimes you may wish to call other commands from your command. You may do so using the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;command:name&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;argument&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;--option&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">));</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Configuration</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#environment-configuration">Environment Configuration</a></li>
<li><a href="#provider-configuration">Provider Configuration</a></li>
<li><a href="#protecting-sensitive-configuration">Protecting Sensitive Configuration</a></li>
<li><a href="#maintenance-mode">Maintenance Mode</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>All of the configuration files for the Laravel framework are stored in the <code>app/config</code> directory. Each option in every file is documented, so feel free to look through the files and get familiar with the options available to you.</p>

<p>Sometimes you may need to access configuration values at run-time. You may do so using the <code>Config</code> class:</p>

<h4>Accessing A Configuration Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also specify a default value to return if the configuration option does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$timezone</span> <span class="o">=</span> <span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;UTC&#39;</span><span class="p">);</span>
</pre></div>

<h4>Setting A Configuration Value</h4>

<p>Notice that &quot;dot&quot; style syntax may be used to access values in the various files. You may also set configuration values at run-time:</p>
<div class="highlight"><pre><span></span><span class="nx">Config</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;database.default&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">);</span>
</pre></div>

<p>Configuration values that are set at run-time are only set for the current request, and will not be carried over to subsequent requests.</p>

<p><a name="environment-configuration"></a></p>

<h2>Environment Configuration</h2>

<p>It is often helpful to have different configuration values based on the environment the application is running in. For example, you may wish to use a different cache driver on your local development machine than on the production server. It is easy to accomplish this using environment based configuration.</p>

<p>Simply create a folder within the <code>config</code> directory that matches your environment name, such as <code>local</code>. Next, create the configuration files you wish to override and specify the options for that environment. For example, to override the cache driver for the local environment, you would create a <code>cache.php</code> file in <code>app/config/local</code> with the following content:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="k">array</span><span class="p">(</span>

    <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span>

<span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Do not use &#39;testing&#39; as an environment name. This is reserved for unit testing.</p>
</blockquote>

<p>Notice that you do not have to specify <em>every</em> option that is in the base configuration file, but only the options you wish to override. The environment configuration files will &quot;cascade&quot; over the base files.</p>

<p>Next, we need to instruct the framework how to determine which environment it is running in. The default environment is always <code>production</code>. However, you may setup other environments within the <code>bootstrap/start.php</code> file at the root of your installation. In this file you will find an <code>$app-&gt;detectEnvironment</code> call. The array passed to this method is used to determine the current environment. You may add other environments and machine names to the array as needed.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$env</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">detectEnvironment</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>

    <span class="s1">&#39;local&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;your-machine-name&#39;</span><span class="p">),</span>

<span class="p">));</span>
</pre></div>

<p>In this example, &#39;local&#39; is the name of the environment and &#39;your-machine-name&#39; is the hostname of your server. On Linux and Mac, you may determine your hostname using the <code>hostname</code> terminal command.</p>

<p>If you need more flexible environment detection, you may pass a <code>Closure</code> to the <code>detectEnvironment</code> method, allowing you to implement environment detection however you wish:</p>
<div class="highlight"><pre><span></span><span class="nx">$env</span> <span class="o">=</span> <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">detectEnvironment</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$_SERVER</span><span class="p">[</span><span class="s1">&#39;MY_LARAVEL_ENV&#39;</span><span class="p">];</span>
<span class="p">});</span>
</pre></div>

<h4>Accessing The Current Application Environment</h4>

<p>You may access the current application environment via the <code>environment</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p>You may also pass arguments to the <code>environment</code> method to check if the environment matches a given value:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The environment is local</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The environment is either local OR staging...</span>
<span class="p">}</span>
</pre></div>

<p><a name="provider-configuration"></a></p>

<h3>Provider Configuration</h3>

<p>When using environment configuration, you may want to &quot;append&quot; environment <a href="/docs/4.2/ioc#service-providers">service providers</a> to your primary <code>app</code> configuration file. However, if you try this, you will notice the environment <code>app</code> providers are overriding the providers in your primary <code>app</code> configuration file. To force the providers to be appended, use the <code>append_config</code> helper method in your environment <code>app</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="nx">append_config</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;LocalOnlyServiceProvider&#39;</span><span class="p">,</span>
<span class="p">))</span>
</pre></div>

<p><a name="protecting-sensitive-configuration"></a></p>

<h2>Protecting Sensitive Configuration</h2>

<p>For &quot;real&quot; applications, it is advisable to keep all of your sensitive configuration out of your configuration files. Things such as database passwords, Stripe API keys, and encryption keys should be kept out of your configuration files whenever possible. So, where should we place them? Thankfully, Laravel provides a very simple solution to protecting these types of configuration items using &quot;dot&quot; files.</p>

<p>First, <a href="/docs/4.2/configuration#environment-configuration">configure your application</a> to recognize your machine as being in the <code>local</code> environment. Next, create a <code>.env.local.php</code> file within the root of your project, which is usually the same directory that contains your <code>composer.json</code> file. The <code>.env.local.php</code> should return an array of key-value pairs, much like a typical Laravel configuration file:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="k">array</span><span class="p">(</span>

    <span class="s1">&#39;TEST_STRIPE_KEY&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;super-secret-sauce&#39;</span><span class="p">,</span>

<span class="p">);</span>
</pre></div>

<p>All of the key-value pairs returned by this file will automatically be available via the <code>$_ENV</code> and <code>$_SERVER</code> PHP &quot;superglobals&quot;. You may now reference these globals from within your configuration files:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="nx">$_ENV</span><span class="p">[</span><span class="s1">&#39;TEST_STRIPE_KEY&#39;</span><span class="p">]</span>
</pre></div>

<p>Be sure to add the <code>.env.local.php</code> file to your <code>.gitignore</code> file. This will allow other developers on your team to create their own local environment configuration, as well as hide your sensitive configuration items from source control.</p>

<p>Now, on your production server, create a <code>.env.php</code> file in your project root that contains the corresponding values for your production environment. Like the <code>.env.local.php</code> file, the production <code>.env.php</code> file should never be included in source control.</p>

<blockquote>
<p><strong>Note:</strong> You may create a file for each environment supported by your application. For example, the <code>development</code> environment will load the <code>.env.development.php</code> file if it exists. However, the <code>production</code> environment always uses the <code>.env.php</code> file.</p>
</blockquote>

<p><a name="maintenance-mode"></a></p>

<h2>Maintenance Mode</h2>

<p>When your application is in maintenance mode, a custom view will be displayed for all routes into your application. This makes it easy to &quot;disable&quot; your application while it is updating or when you are performing maintenance. A call to the <code>App::down</code> method is already present in your <code>app/start/global.php</code> file. The response from this method will be sent to users when your application is in maintenance mode.</p>

<p>To enable maintenance mode, simply execute the <code>down</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span>
</pre></div>

<p>To disable maintenance mode, use the <code>up</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">up</span>
</pre></div>

<p>To show a custom view when your application is in maintenance mode, you may add something like the following to your application&#39;s <code>app/start/global.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">down</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;maintenance&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(),</span> <span class="mi">503</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If the Closure passed to the <code>down</code> method returns <code>NULL</code>, maintenance mode will be ignored for that request.</p>

<h3>Maintenance Mode &amp; Queues</h3>

<p>While your application is in maintenance mode, no <a href="/docs/4.2/queues">queue jobs</a> will be handled. The jobs will continue to be handled as normal once the application is out of maintenance mode.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guidelines</h1>

<p>If you are submitting documentation for the <strong>current stable release</strong>, submit it to the corresponding branch. For example, documentation for Laravel 4.2 would be submitted to the <code>4.2</code> branch. Documentation intended for the next release of Laravel should be submitted to the <code>master</code> branch.</p>
<div style="page-break-after: always;" ></div><h1>Contribution Guide</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#core-development-discussion">Core Development Discussion</a></li>
<li><a href="#new-features">New Features</a></li>
<li><a href="#bugs">Bugs</a></li>
<li><a href="#creating-liferaft-applications">Creating Liferaft Applications</a></li>
<li><a href="#grabbing-liferaft-applications">Grabbing Liferaft Applications</a></li>
<li><a href="#which-branch">Which Branch?</a></li>
<li><a href="#security-vulnerabilities">Security Vulnerabilities</a></li>
<li><a href="#coding-style">Coding Style</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel is an open-source project and anyone may contribute to Laravel for its improvement. We welcome contributors, regardless of skill level, gender, race, religion, or nationality. Having a diverse, vibrant community is one of the core values of the framework!</p>

<p>To encourage active collaboration, Laravel currently only accepts pull requests, not bug reports. &quot;Bug reports&quot; may be sent in the form of a pull request containing a failing unit test. Alternatively, a demonstration of the bug within a sandbox Laravel application may be sent as a pull request to the <a href="https://github.com/laravel/laravel">main Laravel repository</a>. A failing unit test or sandbox application provides the development team &quot;proof&quot; that the bug exists, and, after the development team addresses the bug, serves as a reliable indicator that the bug remains fixed.</p>

<p>The Laravel source code is managed on Github, and there are repositories for each of the Laravel projects:</p>

<ul>
<li><a href="https://github.com/laravel/framework">Laravel Framework</a></li>
<li><a href="https://github.com/laravel/laravel">Laravel Application</a></li>
<li><a href="https://github.com/laravel/docs">Laravel Documentation</a></li>
<li><a href="https://github.com/laravel/cashier">Laravel Cashier</a></li>
<li><a href="https://github.com/laravel/envoy">Laravel Envoy</a></li>
<li><a href="https://github.com/laravel/homestead">Laravel Homestead</a></li>
<li><a href="https://github.com/laravel/settler">Laravel Homestead Build Scripts</a></li>
<li><a href="https://github.com/laravel/laravel.com">Laravel Website</a></li>
<li><a href="https://github.com/laravel/art">Laravel Art</a></li>
</ul>

<p><a name="core-development-discussion"></a></p>

<h2>Core Development Discussion</h2>

<p>Discussion regarding bugs, new features, and implementation of existing features takes place in the <code>#laravel-dev</code> IRC channel (Freenode). Taylor Otwell, the maintainer of Laravel, is typically present in the channel on weekdays from 8am-5pm (UTC-06:00 or America/Chicago), and sporadically present in the channel at other times.</p>

<p>The <code>#laravel-dev</code> IRC channel is open to all. All are welcome to join the channel either to participate or simply observe the discussions!</p>

<p><a name="new-features"></a></p>

<h2>New Features</h2>

<p>Before sending pull requests for new features, please contact Taylor Otwell via the <code>#laravel-dev</code> IRC channel (Freenode). If the feature is found to be a good fit for the framework, you are free to make a pull request. If the feature is rejected, don&#39;t give up! You are still free to turn your feature into a package which can be released to the world via <a href="https://packagist.org/">Packagist</a>.</p>

<p>When adding new features, don&#39;t forget to add unit tests! Unit tests help ensure the stability and reliability of the framework as new features are added.</p>

<p><a name="bugs"></a></p>

<h2>Bugs</h2>

<h3>Via Unit Test</h3>

<p>Pull requests for bugs may be sent without prior discussion with the Laravel development team. When submitting a bug fix, try to include a unit test that ensures the bug never appears again!</p>

<p>If you believe you have found a bug in the framework, but are unsure how to fix it, please send a pull request containing a failing unit test. A failing unit test provides the development team &quot;proof&quot; that the bug exists, and, after the development team addresses the bug, serves as a reliable indicator that the bug remains fixed.</p>

<p>If are unsure how to write a failing unit test for a bug, review the other unit tests included with the framework. If you&#39;re still lost, you may ask for help in the <code>#laravel</code> IRC channel (Freenode).</p>

<p><a name="which-branch"></a></p>

<h2>Which Branch?</h2>

<blockquote>
<p><strong>Note:</strong> This section primarly applies to those sending pull requests to the <a href="https://github.com/laravel/framework">laravel/framework</a> repository, not Liferaft applications.</p>
</blockquote>

<p><strong>All</strong> bug fixes should be sent to the latest stable branch. Bug fixes should <strong>never</strong> be sent to the <code>master</code> branch unless they fix features that exist only in the upcoming release.</p>

<p><strong>Minor</strong> features that are <strong>fully backwards compatible</strong> with the current Laravel release may be sent to the latest stable branch.</p>

<p><strong>Major</strong> new features should always be sent to the <code>master</code> branch, which contains the upcoming Laravel release.</p>

<p>If you are unsure if your feature qualifies as a major or minor, please ask Taylor Otwell in the <code>#laravel-dev</code> IRC channel (Freenode).</p>

<p><a name="security-vulnerabilities"></a></p>

<h2>Security Vulnerabilities</h2>

<p>If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell at <a href="mailto:taylorotwell@gmail.com">taylorotwell@gmail.com</a>. All security vulnerabilities will be promptly addressed.</p>

<p><a name="coding-style"></a></p>

<h2>Coding Style</h2>

<p>Laravel follows the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md">PSR-0</a> and <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md">PSR-1</a> coding standards. In addition to these standards, the following coding standards should be followed:</p>

<ul>
<li>The class namespace declaration must be on the same line as <code>&lt;?php</code>.</li>
<li>A class&#39; opening <code>{</code> must be on the same line as the class name.</li>
<li>Functions and control structures must use Allman style braces.</li>
<li>Indent with tabs, align with spaces.</li>
</ul>
<div style="page-break-after: always;" ></div><h1>Controllers</h1>

<ul>
<li><a href="#basic-controllers">Basic Controllers</a></li>
<li><a href="#controller-filters">Controller Filters</a></li>
<li><a href="#implicit-controllers">Implicit Controllers</a></li>
<li><a href="#restful-resource-controllers">RESTful Resource Controllers</a></li>
<li><a href="#handling-missing-methods">Handling Missing Methods</a></li>
</ul>

<p><a name="basic-controllers"></a></p>

<h2>Basic Controllers</h2>

<p>Instead of defining all of your route-level logic in a single <code>routes.php</code> file, you may wish to organize this behavior using Controller classes. Controllers can group related route logic into a class, as well as take advantage of more advanced framework features such as automatic <a href="/docs/4.2/ioc">dependency injection</a>.</p>

<p>Controllers are typically stored in the <code>app/controllers</code> directory, and this directory is registered in the <code>classmap</code> option of your <code>composer.json</code> file by default. However, controllers can technically live in any directory or any sub-directory. Route declarations are not dependent on the location of the controller class file on disk. So, as long as Composer knows how to autoload the controller class, it may be placed anywhere you wish.</p>

<p>Here is an example of a basic controller class:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Show the profile for the given user.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">showProfile</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>All controllers should extend the <code>BaseController</code> class. The <code>BaseController</code> is also stored in the <code>app/controllers</code> directory, and may be used as a place to put shared controller logic. The <code>BaseController</code> extends the framework&#39;s <code>Controller</code> class. Now, we can route to this controller action like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">);</span>
</pre></div>

<p>If you choose to nest or organize your controller using PHP namespaces, simply use the fully qualified class name when defining the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Namespace\FooController@method&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Since we&#39;re using <a href="http://getcomposer.org">Composer</a> to auto-load our PHP classes, controllers may live anywhere on the file system, as long as composer knows how to load them. The controller directory does not enforce any folder structure for your application. Routing to controllers is entirely de-coupled from the file system.</p>
</blockquote>

<p>You may also specify names on controller routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;FooController@method&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;name&#39;</span><span class="p">));</span>
</pre></div>

<p>To generate a URL to a controller action, you may use the <code>URL::action</code> method or the <code>action</code> helper method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;FooController@method&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;FooController@method&#39;</span><span class="p">);</span>
</pre></div>

<p>You may access the name of the controller action being run using the <code>currentRouteAction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$action</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteAction</span><span class="p">();</span>
</pre></div>

<p><a name="controller-filters"></a></p>

<h2>Controller Filters</h2>

<p><a href="/docs/4.2/routing#route-filters">Filters</a> may be specified on controller routes similar to &quot;regular&quot; routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span>
            <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">));</span>
</pre></div>

<p>However, you may also specify filters from within your controller:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new UserController instance.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">beforeFilter</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;getLogin&#39;</span><span class="p">));</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">beforeFilter</span><span class="p">(</span><span class="s1">&#39;csrf&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;post&#39;</span><span class="p">));</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">afterFilter</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span>
                            <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;fooAction&#39;</span><span class="p">,</span> <span class="s1">&#39;barAction&#39;</span><span class="p">)));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may also specify controller filters inline using a Closure:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new UserController instance.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">beforeFilter</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If you would like to use another method on the controller as a filter, you may use <code>@</code> syntax to define the filter:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new UserController instance.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">beforeFilter</span><span class="p">(</span><span class="s1">&#39;@filterRequests&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Filter the incoming requests.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">filterRequests</span><span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="implicit-controllers"></a></p>

<h2>Implicit Controllers</h2>

<p>Laravel allows you to easily define a single route to handle every action in a controller. First, define the route using the <code>Route::controller</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>controller</code> method accepts two arguments. The first is the base URI the controller handles, while the second is the class name of the controller. Next, just add methods to your controller, prefixed with the HTTP verb they respond to:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">postProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">anyLogin</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>index</code> methods will respond to the root URI handled by the controller, which, in this case, is <code>users</code>.</p>

<p>If your controller action contains multiple words, you may access the action using &quot;dash&quot; syntax in the URI. For example, the following controller action on our <code>UserController</code> would respond to the <code>users/admin-profile</code> URI:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAdminProfile</span><span class="p">()</span> <span class="p">{}</span>
</pre></div>

<p><a name="restful-resource-controllers"></a></p>

<h2>RESTful Resource Controllers</h2>

<p>Resource controllers make it easier to build RESTful controllers around resources. For example, you may wish to create a controller that manages &quot;photos&quot; stored by your application. Using the <code>controller:make</code> command via the Artisan CLI and the <code>Route::resource</code> method, we can quickly create such a controller.</p>

<p>To create the controller via the command line, execute the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">controller</span><span class="o">:</span><span class="nx">make</span> <span class="nx">PhotoController</span>
</pre></div>

<p>Now we can register a resourceful route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p>This single route declaration creates multiple routes to handle a variety of RESTful actions on the photo resource. Likewise, the generated controller will already have stubbed methods for each of these actions with notes informing you which URIs and verbs they handle.</p>

<h4>Actions Handled By Resource Controller</h4>

<p>Verb      | Path                        | Action       | Route Name
----------|-----------------------------|--------------|---------------------
GET       | /resource                   | index        | resource.index
GET       | /resource/create            | create       | resource.create
POST      | /resource                   | store        | resource.store
GET       | /resource/{resource}        | show         | resource.show
GET       | /resource/{resource}/edit   | edit         | resource.edit
PUT/PATCH | /resource/{resource}        | update       | resource.update
DELETE    | /resource/{resource}        | destroy      | resource.destroy</p>

<p>Sometimes you may only need to handle a subset of the resource actions:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">controller</span><span class="o">:</span><span class="nx">make</span> <span class="nx">PhotoController</span> <span class="o">--</span><span class="nx">only</span><span class="o">=</span><span class="nx">index</span><span class="p">,</span><span class="nx">show</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">controller</span><span class="o">:</span><span class="nx">make</span> <span class="nx">PhotoController</span> <span class="o">--</span><span class="nx">except</span><span class="o">=</span><span class="nx">index</span>
</pre></div>

<p>And, you may also specify a subset of actions to handle on the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;only&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">)));</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;except&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">)));</span>
</pre></div>

<p>By default, all resource controller actions have a route name; however, you can override these names by passing a <code>names</code> array with your options:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">,</span>
                <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;photo.build&#39;</span><span class="p">)));</span>
</pre></div>

<h4>Handling Nested Resource Controllers</h4>

<p>To &quot;nest&quot; resource controllers, use &quot;dot&quot; notation in your route declaration:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoCommentController&#39;</span><span class="p">);</span>
</pre></div>

<p>This route will register a &quot;nested&quot; resource that may be accessed with URLs like the following: <code>photos/{photoResource}/comments/{commentResource}</code>.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">PhotoCommentController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">$photoId</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Adding Additional Routes To Resource Controllers</h4>

<p>If it becomes necessary for you to add additional routes to a resource controller beyond the default resource routes, you should define those routes before your call to <code>Route::resource</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;photos/popular&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController@method&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="s1">&#39;PhotoController&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="handling-missing-methods"></a></p>

<h2>Handling Missing Methods</h2>

<p>When using <code>Route::controller</code>, a catch-all method may be defined which will be called when no other matching method is found on a given controller. The method should be named <code>missingMethod</code>, and receives the method and parameter array for the request:</p>

<h4>Defining A Catch-All Method</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">missingMethod</span><span class="p">(</span><span class="nx">$parameters</span> <span class="o">=</span> <span class="nx">array</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you are using resource controllers, you should define a <code>__call</code> magic method on the controller to handle any missing methods.</p>
<div style="page-break-after: always;" ></div><h1>Basic Database Usage</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#read-write-connections">Read / Write Connections</a></li>
<li><a href="#running-queries">Running Queries</a></li>
<li><a href="#database-transactions">Database Transactions</a></li>
<li><a href="#accessing-connections">Accessing Connections</a></li>
<li><a href="#query-logging">Query Logging</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel makes connecting with databases and running queries extremely simple. The database configuration file is <code>app/config/database.php</code>. In this file you may define all of your database connections, as well as specify which connection should be used by default. Examples for all of the supported database systems are provided in this file.</p>

<p>Currently Laravel supports four database systems: MySQL, Postgres, SQLite, and SQL Server.</p>

<p><a name="read-write-connections"></a></p>

<h2>Read / Write Connections</h2>

<p>Sometimes you may wish to use one database connection for SELECT statements, and another for INSERT, UPDATE, and DELETE statements. Laravel makes this a breeze, and the proper connections will always be used whether you are using raw queries, the query builder, or the Eloquent ORM.</p>

<p>To see how read / write connections should be configured, let&#39;s look at this example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mysql&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;read&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">&#39;write&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;196.168.1.2&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;driver&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;charset&#39;</span>   <span class="p">=&gt;</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;collation&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;utf8_unicode_ci&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prefix&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">),</span>
</pre></div>

<p>Note that two keys have been added to the configuration array: <code>read</code> and <code>write</code>. Both of these keys have array values containing a single key: <code>host</code>. The rest of the database options for the <code>read</code> and <code>write</code> connections will be merged from the main <code>mysql</code> array. So, we only need to place items in the <code>read</code> and <code>write</code> arrays if we wish to override the values in the main array. So, in this case, <code>192.168.1.1</code> will be used as the &quot;read&quot; connection, while <code>192.168.1.2</code> will be used as the &quot;write&quot; connection. The database credentials, prefix, character set, and all other options in the main <code>mysql</code> array will be shared across both connections.</p>

<p><a name="running-queries"></a></p>

<h2>Running Queries</h2>

<p>Once you have configured your database connection, you may run queries using the <code>DB</code> class.</p>

<h4>Running A Select Query</h4>
<div class="highlight"><pre><span></span><span class="nx">$results</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;select * from users where id = ?&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>

<p>The <code>select</code> method will always return an <code>array</code> of results.</p>

<h4>Running An Insert Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">insert</span><span class="p">(</span><span class="s1">&#39;insert into users (id, name) values (?, ?)&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">));</span>
</pre></div>

<h4>Running An Update Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;update users set votes = 100 where name = ?&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">));</span>
</pre></div>

<h4>Running A Delete Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;delete from users&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>update</code> and <code>delete</code> statements return the number of rows affected by the operation.</p>
</blockquote>

<h4>Running A General Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">statement</span><span class="p">(</span><span class="s1">&#39;drop table users&#39;</span><span class="p">);</span>
</pre></div>

<h4>Listening For Query Events</h4>

<p>You may listen for query events using the <code>DB::listen</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$sql</span><span class="p">,</span> <span class="nx">$bindings</span><span class="p">,</span> <span class="nx">$time</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="database-transactions"></a></p>

<h2>Database Transactions</h2>

<p>To run a set of operations within a database transaction, you may use the <code>transaction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">));</span>

    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Any exception thrown within the <code>transaction</code> closure will cause the transaction to be rolled back automatically.</p>
</blockquote>

<p>Sometimes you may need to begin a transaction yourself:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">beginTransaction</span><span class="p">();</span>
</pre></div>

<p>You can rollback a transaction via the <code>rollback</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">rollback</span><span class="p">();</span>
</pre></div>

<p>Lastly, you can commit a transaction via the <code>commit</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>

<p><a name="accessing-connections"></a></p>

<h2>Accessing Connections</h2>

<p>When using multiple connections, you may access them via the <code>DB::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(...);</span>
</pre></div>

<p>You may also access the raw, underlying PDO instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$pdo</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">getPdo</span><span class="p">();</span>
</pre></div>

<p>Sometimes you may need to reconnect to a given database:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">reconnect</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to disconnect from the given database due to exceeding the underlying PDO instance&#39;s <code>max_connections</code> limit, use the <code>disconnect</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">disconnect</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="query-logging"></a></p>

<h2>Query Logging</h2>

<p>By default, Laravel keeps a log in memory of all queries that have been run for the current request. However, in some cases, such as when inserting a large number of rows, this can cause the application to use excess memory. To disable the log, you may use the <code>disableQueryLog</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">disableQueryLog</span><span class="p">();</span>
</pre></div>

<p>To get an array of the executed queries, you may use the <code>getQueryLog</code> method:</p>
<div class="highlight"><pre><span></span>   <span class="nx">$queries</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">getQueryLog</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><ul>
<li>## Preface

<ul>
<li><a href="/docs/4.2/introduction">Introduction</a></li>
<li><a href="/docs/4.2/quick">Quickstart</a></li>
<li><a href="/docs/4.2/releases">Release Notes</a></li>
<li><a href="/docs/4.2/upgrade">Upgrade Guide</a></li>
<li><a href="/docs/4.2/contributions">Contribution Guide</a></li>
<li><a href="/api/4.2/">API Documentation</a></li>
</ul></li>
<li>## Getting Started

<ul>
<li><a href="/docs/4.2/installation">Installation</a></li>
<li><a href="/docs/4.2/configuration">Configuration</a></li>
<li><a href="/docs/4.2/homestead">Homestead</a></li>
<li><a href="/docs/4.2/lifecycle">Request Lifecycle</a></li>
<li><a href="/docs/4.2/routing">Routing</a></li>
<li><a href="/docs/4.2/requests">Requests &amp; Input</a></li>
<li><a href="/docs/4.2/responses">Views &amp; Responses</a></li>
<li><a href="/docs/4.2/controllers">Controllers</a></li>
<li><a href="/docs/4.2/errors">Errors &amp; Logging</a></li>
</ul></li>
<li>## Learning More

<ul>
<li><a href="/docs/4.2/security">Authentication</a></li>
<li><a href="/docs/4.2/billing">Billing</a></li>
<li><a href="/docs/4.2/cache">Cache</a></li>
<li><a href="/docs/4.2/extending">Core Extension</a></li>
<li><a href="/docs/4.2/events">Events</a></li>
<li><a href="/docs/4.2/facades">Facades</a></li>
<li><a href="/docs/4.2/html">Forms &amp; HTML</a></li>
<li><a href="/docs/4.2/helpers">Helpers</a></li>
<li><a href="/docs/4.2/ioc">IoC Container</a></li>
<li><a href="/docs/4.2/localization">Localization</a></li>
<li><a href="/docs/4.2/mail">Mail</a></li>
<li><a href="/docs/4.2/packages">Package Development</a></li>
<li><a href="/docs/4.2/pagination">Pagination</a></li>
<li><a href="/docs/4.2/queues">Queues</a></li>
<li><a href="/docs/4.2/security">Security</a></li>
<li><a href="/docs/4.2/session">Session</a></li>
<li><a href="/docs/4.2/ssh">SSH</a></li>
<li><a href="/docs/4.2/templates">Templates</a></li>
<li><a href="/docs/4.2/testing">Unit Testing</a></li>
<li><a href="/docs/4.2/validation">Validation</a></li>
</ul></li>
<li>## Database

<ul>
<li><a href="/docs/4.2/database">Basic Usage</a></li>
<li><a href="/docs/4.2/queries">Query Builder</a></li>
<li><a href="/docs/4.2/eloquent">Eloquent ORM</a></li>
<li><a href="/docs/4.2/schema">Schema Builder</a></li>
<li><a href="/docs/4.2/migrations">Migrations &amp; Seeding</a></li>
<li><a href="/docs/4.2/redis">Redis</a></li>
</ul></li>
<li>## Artisan CLI

<ul>
<li><a href="/docs/4.2/artisan">Overview</a></li>
<li><a href="/docs/4.2/commands">Development</a></li>
</ul></li>
</ul>
<div style="page-break-after: always;" ></div><h1>Eloquent ORM</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#mass-assignment">Mass Assignment</a></li>
<li><a href="#insert-update-delete">Insert, Update, Delete</a></li>
<li><a href="#soft-deleting">Soft Deleting</a></li>
<li><a href="#timestamps">Timestamps</a></li>
<li><a href="#query-scopes">Query Scopes</a></li>
<li><a href="#global-scopes">Global Scopes</a></li>
<li><a href="#relationships">Relationships</a></li>
<li><a href="#querying-relations">Querying Relations</a></li>
<li><a href="#eager-loading">Eager Loading</a></li>
<li><a href="#inserting-related-models">Inserting Related Models</a></li>
<li><a href="#touching-parent-timestamps">Touching Parent Timestamps</a></li>
<li><a href="#working-with-pivot-tables">Working With Pivot Tables</a></li>
<li><a href="#collections">Collections</a></li>
<li><a href="#accessors-and-mutators">Accessors &amp; Mutators</a></li>
<li><a href="#date-mutators">Date Mutators</a></li>
<li><a href="#model-events">Model Events</a></li>
<li><a href="#model-observers">Model Observers</a></li>
<li><a href="#converting-to-arrays-or-json">Converting To Arrays / JSON</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &quot;Model&quot; which is used to interact with that table.</p>

<p>Before getting started, be sure to configure a database connection in <code>app/config/database.php</code>.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>To get started, create an Eloquent model. Models typically live in the <code>app/models</code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code>composer.json</code> file.</p>

<h4>Defining An Eloquent Model</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{}</span>
</pre></div>

<p>Note that we did not tell Eloquent which table to use for our <code>User</code> model. The lower-case, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Eloquent will assume the <code>User</code> model stores records in the <code>users</code> table. You may specify a custom table by defining a <code>table</code> property on your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$table</span> <span class="o">=</span> <span class="s1">&#39;my_users&#39;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Eloquent will also assume that each table has a primary key column named <code>id</code>. You may define a <code>primaryKey</code> property to override this convention. Likewise, you may define a <code>connection</code> property to override the name of the database connection that should be used when utilizing the model.</p>
</blockquote>

<p>Once a model is defined, you are ready to start retrieving and creating records in your table. Note that you will need to place <code>updated_at</code> and <code>created_at</code> columns on your table by default. If you do not wish to have these columns automatically maintained, set the <code>$timestamps</code> property on your model to <code>false</code>.</p>

<h4>Retrieving All Models</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Retrieving A Record By Primary Key</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All methods available on the <a href="/docs/4.2/queries">query builder</a> are also available when querying Eloquent models.</p>
</blockquote>

<h4>Retrieving A Model By Primary Key Or Throw An Exception</h4>

<p>Sometimes you may wish to throw an exception if a model is not found, allowing you to catch the exceptions using an <code>App::error</code> handler and display a 404 page.</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
</pre></div>

<p>To register the error handler, listen for the <code>ModelNotFoundException</code></p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">ModelNotFoundException</span><span class="p">;</span>

<span class="nx">App</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ModelNotFoundException</span> <span class="nx">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;Not Found&#39;</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Querying Using Eloquent Models</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Eloquent Aggregates</h4>

<p>Of course, you may also use the query builder aggregate functions.</p>
<div class="highlight"><pre><span></span><span class="nx">$count</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>
</pre></div>

<p>If you are unable to generate the query you need via the fluent interface, feel free to use <code>whereRaw</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;age &gt; ? and votes = 100&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">25</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Chunking Results</h4>

<p>If you need to process a lot (thousands) of Eloquent records, using the <code>chunk</code> command will allow you to do without eating all of your RAM:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$users</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the method is the number of records you wish to receive per &quot;chunk&quot;. The Closure passed as the second argument will be called for each chunk that is pulled from the database.</p>

<h4>Specifying The Query Connection</h4>

<p>You may also specify which database connection should be used when running an Eloquent query. Simply use the <code>on</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection-name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p><a name="mass-assignment"></a></p>

<h2>Mass Assignment</h2>

<p>When creating a new model, you pass an array of attributes to the model constructor. These attributes are then assigned to the model via mass-assignment. This is convenient; however, can be a <strong>serious</strong> security concern when blindly passing user input into a model. If user input is blindly passed into a model, the user is free to modify <strong>any</strong> and <strong>all</strong> of the model&#39;s attributes. For this reason, all Eloquent models protect against mass-assignment by default.</p>

<p>To get started, set the <code>fillable</code> or <code>guarded</code> properties on your model.</p>

<h4>Defining Fillable Attributes On A Model</h4>

<p>The <code>fillable</code> property specifies which attributes should be mass-assignable. This can be set at the class or instance level.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$fillable</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>In this example, only the three listed attributes will be mass-assignable.</p>

<h4>Defining Guarded Attributes On A Model</h4>

<p>The inverse of <code>fillable</code> is <code>guarded</code>, and serves as a &quot;black-list&quot; instead of a &quot;white-list&quot;:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When using <code>guarded</code>, you should still never pass <code>Input::get()</code> or any raw array of user controlled input into a <code>save</code> or <code>update</code> method, as any column that is not guarded may be updated.</p>
</blockquote>

<h4>Blocking All Attributes From Mass Assignment</h4>

<p>In the example above, the <code>id</code> and <code>password</code> attributes may <strong>not</strong> be mass assigned. All other attributes will be mass assignable. You may also block <strong>all</strong> attributes from mass assignment using the guard property:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="insert-update-delete"></a></p>

<h2>Insert, Update, Delete</h2>

<p>To create a new record in the database from a model, simply create a new model instance and call the <code>save</code> method.</p>

<h4>Saving A New Model</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Typically, your Eloquent models will have auto-incrementing keys. However, if you wish to specify your own keys, set the <code>incrementing</code> property on your model to <code>false</code>.</p>
</blockquote>

<p>You may also use the <code>create</code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code>fillable</code> or <code>guarded</code> attribute on the model, as all Eloquent models protect against mass-assignment.</p>

<p>After saving or creating a new model that uses auto-incrementing IDs, you may retrieve the ID by accessing the object&#39;s <code>id</code> attribute:</p>
<div class="highlight"><pre><span></span><span class="nx">$insertedId</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>
</pre></div>

<h4>Setting The Guarded Attributes On The Model</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<h4>Using The Model Create Method</h4>
<div class="highlight"><pre><span></span><span class="c1">// Create a new user in the database...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">));</span>

<span class="c1">// Retrieve the user by the attributes, or create it if it doesn&#39;t exist...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">firstOrCreate</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">));</span>

<span class="c1">// Retrieve the user by the attributes, or instantiate a new instance...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">firstOrNew</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">));</span>
</pre></div>

<h4>Updating A Retrieved Model</h4>

<p>To update a model, you may retrieve it, change an attribute, and use the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span> <span class="o">=</span> <span class="s1">&#39;john@foo.com&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h4>Saving A Model And Relationships</h4>

<p>Sometimes you may wish to save not only a model, but also all of its relationships. To do so, you may use the <code>push</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">();</span>
</pre></div>

<p>You may also run updates as queries against a set of models:</p>
<div class="highlight"><pre><span></span><span class="nx">$affectedRows</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> No model events are fired when updating a set of models via the Eloquent query builder.</p>
</blockquote>

<h4>Deleting An Existing Model</h4>

<p>To delete a model, simply call the <code>delete</code> method on the instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting An Existing Model By Key</h4>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></div>

<p>Of course, you may also run a delete query on a set of models:</p>
<div class="highlight"><pre><span></span><span class="nx">$affectedRows</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Updating Only The Model&#39;s Timestamps</h4>

<p>If you wish to simply update the timestamps on a model, you may use the <code>touch</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">touch</span><span class="p">();</span>
</pre></div>

<p><a name="soft-deleting"></a></p>

<h2>Soft Deleting</h2>

<p>When soft deleting a model, it is not actually removed from your database. Instead, a <code>deleted_at</code> timestamp is set on the record. To enable soft deletes for a model, apply the <code>SoftDeletingTrait</code> to the model:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">SoftDeletingTrait</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>

<span class="p">}</span>
</pre></div>

<p>To add a <code>deleted_at</code> column to your table, you may use the <code>softDeletes</code> method from a migration:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">softDeletes</span><span class="p">();</span>
</pre></div>

<p>Now, when you call the <code>delete</code> method on the model, the <code>deleted_at</code> column will be set to the current timestamp. When querying a model that uses soft deletes, the &quot;deleted&quot; models will not be included in query results.</p>

<h4>Forcing Soft Deleted Models Into Results</h4>

<p>To force soft deleted models to appear in a result set, use the <code>withTrashed</code> method on the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>withTrashed</code> method may be used on a defined relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you wish to <strong>only</strong> receive soft deleted models in your results, you may use the <code>onlyTrashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">onlyTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>To restore a soft deleted model into an active state, use the <code>restore</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>restore</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>Like with <code>withTrashed</code>, the <code>restore</code> method may also be used on relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>If you wish to truly remove a model from the database, you may use the <code>forceDelete</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p>The <code>forceDelete</code> method also works on relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p>To determine if a given model instance has been soft deleted, you may use the <code>trashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">trashed</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="timestamps"></a></p>

<h2>Timestamps</h2>

<p>By default, Eloquent will maintain the <code>created_at</code> and <code>updated_at</code> columns on your database table automatically. Simply add these <code>timestamp</code> columns to your table and Eloquent will take care of the rest. If you do not wish for Eloquent to maintain these columns, add the following property to your model:</p>

<h4>Disabling Auto Timestamps</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$table</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span><span class="p">;</span>

    <span class="kr">public</span> <span class="nx">$timestamps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

<h4>Providing A Custom Timestamp Format</h4>

<p>If you wish to customize the format of your timestamps, you may override the <code>getDateFormat</code> method in your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="kd">function</span> <span class="nx">getDateFormat</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="query-scopes"></a></p>

<h2>Query Scopes</h2>

<h4>Defining A Query Scope</h4>

<p>Scopes allow you to easily re-use query logic in your models. To define a scope, simply prefix a model method with <code>scope</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopePopular</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopeWomen</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">whereGender</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Utilizing A Query Scope</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">women</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Dynamic Scopes</h4>

<p>Sometimes you may wish to define a scope that accepts parameters. Just add your parameters to your scope function:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">scopeOfType</span><span class="p">(</span><span class="nx">$query</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">whereType</span><span class="p">(</span><span class="nx">$type</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Then pass the parameter into the scope call:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">ofType</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="global-scopes"></a></p>

<h2>Global Scopes</h2>

<p>Sometimes you may wish to define a scope that applies to all queries performed on a model. In essence, this is how Eloquent&#39;s own &quot;soft delete&quot; feature works. Global scopes are defined using a combination of PHP traits and an implementation of <code>Illuminate\Database\Eloquent\ScopeInterface</code>.</p>

<p>First, let&#39;s define a trait. For this example, we&#39;ll use the <code>SoftDeletingTrait</code> that ships with Laravel:</p>
<div class="highlight"><pre><span></span><span class="nx">trait</span> <span class="nx">SoftDeletingTrait</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Boot the soft deleting trait for a model.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">bootSoftDeletingTrait</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kr">static</span><span class="o">::</span><span class="nx">addGlobalScope</span><span class="p">(</span><span class="k">new</span> <span class="nx">SoftDeletingScope</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If an Eloquent model uses a trait that has a method matching the <code>bootNameOfTrait</code> naming convention, that trait method will be called when the Eloquent model is booted, giving you an opportunity to register a global scope, or do anything else you want. A scope must implement <code>ScopeInterface</code>, which specifies two methods: <code>apply</code> and <code>remove</code>.</p>

<p>The <code>apply</code> method receives an <code>Illuminate\Database\Eloquent\Builder</code> query builder object, and is responsible for adding any additional <code>where</code> clauses that the scope wishes to add. The <code>remove</code> method also receives a <code>Builder</code> object and is responsible for reversing the action taken by <code>apply</code>. In other words, <code>remove</code> should remove the <code>where</code> clause (or any other clause) that was added. So, for our <code>SoftDeletingScope</code>, the methods look something like this:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Apply the scope to a given Eloquent query builder.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Builder  $builder</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">apply</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$model</span> <span class="o">=</span> <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">getModel</span><span class="p">();</span>

    <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="nx">$model</span><span class="o">-&gt;</span><span class="nx">getQualifiedDeletedAtColumn</span><span class="p">());</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Remove the scope from the given Eloquent query builder.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Database\Eloquent\Builder  $builder</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$column</span> <span class="o">=</span> <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">getModel</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">getQualifiedDeletedAtColumn</span><span class="p">();</span>

    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">$builder</span><span class="o">-&gt;</span><span class="nx">getQuery</span><span class="p">();</span>

    <span class="nx">foreach</span> <span class="p">((</span><span class="nx">array</span><span class="p">)</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span> <span class="nx">as</span> <span class="nx">$key</span> <span class="p">=&gt;</span> <span class="nx">$where</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// If the where clause is a soft delete date constraint, we will remove it from</span>
        <span class="c1">// the query and reset the keys on the wheres. This allows this developer to</span>
        <span class="c1">// include deleted model in a relationship result set that is lazy loaded.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">isSoftDeleteConstraint</span><span class="p">(</span><span class="nx">$where</span><span class="p">,</span> <span class="nx">$column</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nx">unset</span><span class="p">(</span><span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span><span class="p">[</span><span class="nx">$key</span><span class="p">]);</span>

            <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">wheres</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="relationships"></a></p>

<h2>Relationships</h2>

<p>Of course, your database tables are probably related to one another. For example, a blog post may have many comments, or an order could be related to the user who placed it. Eloquent makes managing and working with these relationships easy. Laravel supports many types of relationships:</p>

<ul>
<li><a href="#one-to-one">One To One</a></li>
<li><a href="#one-to-many">One To Many</a></li>
<li><a href="#many-to-many">Many To Many</a></li>
<li><a href="#has-many-through">Has Many Through</a></li>
<li><a href="#polymorphic-relations">Polymorphic Relations</a></li>
<li><a href="#many-to-many-polymorphic-relations">Many To Many Polymorphic Relations</a></li>
</ul>

<p><a name="one-to-one"></a></p>

<h3>One To One</h3>

<h4>Defining A One To One Relation</h4>

<p>A one-to-one relationship is a very basic relation. For example, a <code>User</code> model might have one <code>Phone</code>. We can define this relation in Eloquent:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">phone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasOne</code> method is the name of the related model. Once the relationship is defined, we may retrieve it using Eloquent&#39;s <a href="#dynamic-properties">dynamic properties</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$phone</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">phone</span><span class="p">;</span>
</pre></div>

<p>The SQL performed by this statement will be as follows:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">phones</span> <span class="nx">where</span> <span class="nx">user_id</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>Take note that Eloquent assumes the foreign key of the relationship based on the model name. In this case, <code>Phone</code> model is assumed to use a <code>user_id</code> foreign key. If you wish to override this convention, you may pass a second argument to the <code>hasOne</code> method. Furthermore, you may pass a third argument to the method to specify which local column that should be used for the association:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of A Relation</h4>

<p>To define the inverse of the relationship on the <code>Phone</code> model, we use the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In the example above, Eloquent will look for a <code>user_id</code> column on the <code>phones</code> table. If you would like to define a different foreign key column, you may pass it as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Additionally, you pass a third parameter which specifies the name of the associated column on the parent table:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_key&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="one-to-many"></a></p>

<h3>One To Many</h3>

<p>An example of a one-to-many relation is a blog post that &quot;has many&quot; comments. We can model this relation like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;Comment&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now we can access the post&#39;s comments through the <a href="#dynamic-properties">dynamic property</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">;</span>
</pre></div>

<p>If you need to add further constraints to which comments are retrieved, you may call the <code>comments</code> method and continue chaining conditions:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<p>Again, you may override the conventional foreign key by passing a second argument to the <code>hasMany</code> method. And, like the <code>hasOne</code> relation, the local column may also be specified:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of A Relation</h4>

<p>To define the inverse of the relationship on the <code>Comment</code> model, we use the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Comment</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="many-to-many"></a></p>

<h3>Many To Many</h3>

<p>Many-to-many relations are a more complicated relationship type. An example of such a relationship is a user with many roles, where the roles are also shared by other users. For example, many users may have the role of &quot;Admin&quot;. Three database tables are needed for this relationship: <code>users</code>, <code>roles</code>, and <code>role_user</code>. The <code>role_user</code> table is derived from the alphabetical order of the related model names, and should have <code>user_id</code> and <code>role_id</code> columns.</p>

<p>We can define a many-to-many relation using the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">roles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;Role&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, we can retrieve the roles through the <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>
</pre></div>

<p>If you would like to use an unconventional table name for your pivot table, you may pass it as the second argument to the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also override the conventional associated keys:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;user_roles&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;foo_id&#39;</span><span class="p">);</span>
</pre></div>

<p>Of course, you may also define the inverse of the relationship on the <code>Role</code> model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Role</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="has-many-through"></a></p>

<h3>Has Many Through</h3>

<p>The &quot;has many through&quot; relation provides a convenient short-cut for accessing distant relations via an intermediate relation. For example, a <code>Country</code> model might have many <code>Post</code> through a <code>User</code> model. The tables for this relationship would look like this:</p>
<div class="highlight"><pre><span></span><span class="nx">countries</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">country_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">user_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Even though the <code>posts</code> table does not contain a <code>country_id</code> column, the <code>hasManyThrough</code> relation will allow us to access a country&#39;s posts via <code>$country-&gt;posts</code>. Let&#39;s define the relationship:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If you would like to manually specify the keys of the relationship, you may pass them as the third and fourth arguments to the method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="polymorphic-relations"></a></p>

<h3>Polymorphic Relations</h3>

<p>Polymorphic relations allow a model to belong to more than one other model, on a single association. For example, you might have a photo model that belongs to either a staff model or an order model. We would define this relation like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Photo</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">imageable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphTo</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Staff</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphMany</span><span class="p">(</span><span class="s1">&#39;Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Order</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">photos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphMany</span><span class="p">(</span><span class="s1">&#39;Photo&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Retrieving A Polymorphic Relation</h4>

<p>Now, we can retrieve the photos for either a staff member or an order:</p>
<div class="highlight"><pre><span></span><span class="nx">$staff</span> <span class="o">=</span> <span class="nx">Staff</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$staff</span><span class="o">-&gt;</span><span class="nx">photos</span> <span class="nx">as</span> <span class="nx">$photo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Owner Of A Polymorphic Relation</h4>

<p>However, the true &quot;polymorphic&quot; magic is when you access the staff or order from the <code>Photo</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$photo</span> <span class="o">=</span> <span class="nx">Photo</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$imageable</span> <span class="o">=</span> <span class="nx">$photo</span><span class="o">-&gt;</span><span class="nx">imageable</span><span class="p">;</span>
</pre></div>

<p>The <code>imageable</code> relation on the <code>Photo</code> model will return either a <code>Staff</code> or <code>Order</code> instance, depending on which type of model owns the photo.</p>

<h4>Polymorphic Relation Table Structure</h4>

<p>To help understand how this works, let&#39;s explore the database structure for a polymorphic relation:</p>
<div class="highlight"><pre><span></span><span class="nx">staff</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">orders</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">price</span> <span class="o">-</span> <span class="nx">integer</span>

<span class="nx">photos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">path</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">imageable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">imageable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>The key fields to notice here are the <code>imageable_id</code> and <code>imageable_type</code> on the <code>photos</code> table. The ID will contain the ID value of, in this example, the owning staff or order, while the type will contain the class name of the owning model. This is what allows the ORM to determine which type of owning model to return when accessing the <code>imageable</code> relation.</p>

<p><a name="many-to-many-polymorphic-relations"></a></p>

<h3>Many To Many Polymorphic Relations</h3>

<h4>Polymorphic Many To Many Relation Table Structure</h4>

<p>In addition to traditional polymorphic relations, you may also specify many-to-many polymorphic relations. For example, a blog <code>Post</code> and <code>Video</code> model could share a polymorphic relation to a <code>Tag</code> model. First, let&#39;s examine the table structure:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">videos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">tags</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">taggables</span>
    <span class="nx">tag_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Next, we&#39;re ready to setup the relationships on the model. The <code>Post</code> and <code>Video</code> model will both have a <code>morphToMany</code> relationship via a <code>tags</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">tags</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphToMany</span><span class="p">(</span><span class="s1">&#39;Tag&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The <code>Tag</code> model may define a method for each of its relationships:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Tag</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphedByMany</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">videos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphedByMany</span><span class="p">(</span><span class="s1">&#39;Video&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="querying-relations"></a></p>

<h2>Querying Relations</h2>

<h4>Querying Relations When Selecting</h4>

<p>When accessing the records for a model, you may wish to limit your results based on the existence of a relationship. For example, you wish to pull all blog posts that have at least one comment. To do so, you may use the <code>has</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify an operator and a count:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need even more power, you may use the <code>whereHas</code> and <code>orWhereHas</code> methods to put &quot;where&quot; conditions on your <code>has</code> queries:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$q</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$q</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>

<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="dynamic-properties"></a></p>

<h3>Dynamic Properties</h3>

<p>Eloquent allows you to access your relations via dynamic properties. Eloquent will automatically load the relationship for you, and is even smart enough to know whether to call the <code>get</code> (for one-to-many relationships) or <code>first</code> (for one-to-one relationships) method.  It will then be accessible via a dynamic property by the same name as the relation. For example, with the following model <code>$phone</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Phone</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="nx">$phone</span> <span class="o">=</span> <span class="nx">Phone</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>Instead of echoing the user&#39;s email like this:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$phone</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
</pre></div>

<p>It may be shortened to simply:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$phone</span><span class="o">-&gt;</span><span class="nx">user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Relationships that return many results will return an instance of the <code>Illuminate\Database\Eloquent\Collection</code> class.</p>
</blockquote>

<p><a name="eager-loading"></a></p>

<h2>Eager Loading</h2>

<p>Eager loading exists to alleviate the N + 1 query problem. For example, consider a <code>Book</code> model that is related to <code>Author</code>. The relationship is defined like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Book</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">author</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;Author&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, consider the following code:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This loop will execute 1 query to retrieve all of the books on the table, then another query for each book to retrieve the author. So, if we have 25 books, this loop would run 26 queries.</p>

<p>Thankfully, we can use eager loading to drastically reduce the number of queries. The relationships that should be eager loaded may be specified via the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>In the loop above, only two queries will be executed:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">books</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">authors</span> <span class="nx">where</span> <span class="nx">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>

<p>Wise use of eager loading can drastically increase the performance of your application.</p>

<p>Of course, you may eager load multiple relationships at one time:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may even eager load nested relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author.contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In the example above, the <code>author</code> relationship will be eager loaded, and the author&#39;s <code>contacts</code> relation will also be loaded.</p>

<h3>Eager Load Constraints</h3>

<p>Sometimes you may wish to eager load a relationship, but also specify a condition for the eager load. Here&#39;s an example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;%first%&#39;</span><span class="p">);</span>

<span class="p">}))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In this example, we&#39;re eager loading the user&#39;s posts, but only if the post&#39;s title column contains the word &quot;first&quot;.</p>

<p>Of course, eager loading Closures aren&#39;t limited to &quot;constraints&quot;. You may also apply orders:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>

<span class="p">}))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h3>Lazy Eager Loading</h3>

<p>It is also possible to eagerly load related models directly from an already existing model collection. This may be useful when dynamically deciding whether to load related models or not, or in combination with caching.</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="inserting-related-models"></a></p>

<h2>Inserting Related Models</h2>

<h4>Attaching A Related Model</h4>

<p>You will often need to insert new related models. For example, you may wish to insert a new comment for a post. Instead of manually setting the <code>post_id</code> foreign key on the model, you may insert the new comment from its parent <code>Post</code> model directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">));</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>
</pre></div>

<p>In this example, the <code>post_id</code> field will automatically be set on the inserted comment.</p>

<p>If you need to save multiple related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Another comment.&#39;</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">Comment</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The latest comment.&#39;</span><span class="p">))</span>
<span class="p">);</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">saveMany</span><span class="p">(</span><span class="nx">$comments</span><span class="p">);</span>
</pre></div>

<h3>Associating Models (Belongs To)</h3>

<p>When updating a <code>belongsTo</code> relationship, you may use the <code>associate</code> method. This method will set the foreign key on the child model:</p>
<div class="highlight"><pre><span></span><span class="nx">$account</span> <span class="o">=</span> <span class="nx">Account</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">associate</span><span class="p">(</span><span class="nx">$account</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h3>Inserting Related Models (Many To Many)</h3>

<p>You may also insert related models when working with many-to-many relations. Let&#39;s continue using our <code>User</code> and <code>Role</code> models as examples. We can easily attach new roles to a user using the <code>attach</code> method:</p>

<h4>Attaching Many To Many Models</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>You may also pass an array of attributes that should be stored on the pivot table for the relation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">));</span>
</pre></div>

<p>Of course, the opposite of <code>attach</code> is <code>detach</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>Both <code>attach</code> and <code>detach</code> also take arrays of IDs as input:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;attribute1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value1&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Using Sync To Attach Many To Many Models</h4>

<p>You may also use the <code>sync</code> method to attach related models. The <code>sync</code> method accepts an array of IDs to place on the pivot table. After this operation is complete, only the IDs in the array will be on the intermediate table for the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</pre></div>

<h4>Adding Pivot Data When Syncing</h4>

<p>You may also associate other pivot table values with the given IDs:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">)));</span>
</pre></div>

<p>Sometimes you may wish to create a new related model and attach it in a single command. For this operation, you may use the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$role</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Editor&#39;</span><span class="p">));</span>

<span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">);</span>
</pre></div>

<p>In this example, the new <code>Role</code> model will be saved and attached to the user model. You may also pass an array of attributes to place on the joining table for this operation:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">));</span>
</pre></div>

<p><a name="touching-parent-timestamps"></a></p>

<h2>Touching Parent Timestamps</h2>

<p>When a model <code>belongsTo</code> another model, such as a <code>Comment</code> which belongs to a <code>Post</code>, it is often helpful to update the parent&#39;s timestamp when the child model is updated. For example, when a <code>Comment</code> model is updated, you may want to automatically touch the <code>updated_at</code> timestamp of the owning <code>Post</code>. Eloquent makes it easy. Just add a <code>touches</code> property containing the names of the relationships to the child model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Comment</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$touches</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">);</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now, when you update a <code>Comment</code>, the owning <code>Post</code> will have its <code>updated_at</code> column updated:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;Edit to this comment!&#39;</span><span class="p">;</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="working-with-pivot-tables"></a></p>

<h2>Working With Pivot Tables</h2>

<p>As you have already learned, working with many-to-many relations requires the presence of an intermediate table. Eloquent provides some very helpful ways of interacting with this table. For example, let&#39;s assume our <code>User</code> object has many <code>Role</code> objects that it is related to. After accessing this relationship, we may access the <code>pivot</code> table on the models:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">pivot</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Notice that each <code>Role</code> model we retrieve is automatically assigned a <code>pivot</code> attribute. This attribute contains a model representing the intermediate table, and may be used as any other Eloquent model.</p>

<p>By default, only the keys will be present on the <code>pivot</code> object. If your pivot table contains extra attributes, you must specify them when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withPivot</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
</pre></div>

<p>Now the <code>foo</code> and <code>bar</code> attributes will be accessible on our <code>pivot</code> object for the <code>Role</code> model.</p>

<p>If you want your pivot table to have automatically maintained <code>created_at</code> and <code>updated_at</code> timestamps, use the <code>withTimestamps</code> method on the relationship definition:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withTimestamps</span><span class="p">();</span>
</pre></div>

<h4>Deleting Records On A Pivot Table</h4>

<p>To delete all records on the pivot table for a model, you may use the <code>detach</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">();</span>
</pre></div>

<p>Note that this operation does not delete records from the <code>roles</code> table, but only from the pivot table.</p>

<h4>Updating A Record On A Pivot Table</h4>

<p>Sometimes you may need to update your pivot table, but not detach it. If you wish to update your pivot table in place you may use <code>updateExistingPivot</code> method like so:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateExistingPivot</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">,</span> <span class="nx">$attributes</span><span class="p">);</span>
</pre></div>

<h4>Defining A Custom Pivot Model</h4>

<p>Laravel also allows you to define a custom Pivot model. To define a custom model, first create your own &quot;Base&quot; model class that extends <code>Eloquent</code>. In your other Eloquent models, extend this custom base model instead of the default <code>Eloquent</code> base. In your base model, add the following function that returns an instance of your custom Pivot model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">newPivot</span><span class="p">(</span><span class="nx">Model</span> <span class="nx">$parent</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$exists</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">YourCustomPivot</span><span class="p">(</span><span class="nx">$parent</span><span class="p">,</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">$table</span><span class="p">,</span> <span class="nx">$exists</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="collections"></a></p>

<h2>Collections</h2>

<p>All multi-result sets returned by Eloquent, either via the <code>get</code> method or a <code>relationship</code>, will return a collection object. This object implements the <code>IteratorAggregate</code> PHP interface so it can be iterated over like an array. However, this object also has a variety of other helpful methods for working with result sets.</p>

<h4>Checking If A Collection Contains A Key</h4>

<p>For example, we may determine if a result set contains a given primary key using the <code>contains</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Collections may also be converted to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>
</pre></div>

<p>If a collection is cast to a string, it will be returned as JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>
</pre></div>

<h4>Iterating Collections</h4>

<p>Eloquent collections also contain a few helpful methods for looping and filtering the items they contain:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Filtering Collections</h4>

<p>When filtering collections, the callback provided will be used as callback for <a href="http://php.net/manual/en/function.array-filter.php">array_filter</a>.</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When filtering a collection and converting it to JSON, try calling the <code>values</code> function first to reset the array&#39;s keys.</p>
</blockquote>

<h4>Applying A Callback To Each Collection Object</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">;</span>

<span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Sorting A Collection By A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$role</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Sorting A Collection By A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">$roles</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Custom Collection Type</h4>

<p>Sometimes, you may wish to return a custom Collection object with your own added methods. You may specify this on your Eloquent model by overriding the <code>newCollection</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">newCollection</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$models</span> <span class="o">=</span> <span class="nx">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomCollection</span><span class="p">(</span><span class="nx">$models</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="accessors-and-mutators"></a></p>

<h2>Accessors &amp; Mutators</h2>

<h4>Defining An Accessor</h4>

<p>Eloquent provides a convenient way to transform your model attributes when getting or setting them. Simply define a <code>getFooAttribute</code> method on your model to declare an accessor. Keep in mind that the methods should follow camel-casing, even though your database columns are snake-case:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getFirstNameAttribute</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In the example above, the <code>first_name</code> column has an accessor. Note that the value of the attribute is passed to the accessor.</p>

<h4>Defining A Mutator</h4>

<p>Mutators are declared in a similar fashion:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">setFirstNameAttribute</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="date-mutators"></a></p>

<h2>Date Mutators</h2>

<p>By default, Eloquent will convert the <code>created_at</code> and <code>updated_at</code> columns to instances of <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, which provides an assortment of helpful methods, and extends the native PHP <code>DateTime</code> class.</p>

<p>You may customize which fields are automatically mutated, and even completely disable this mutation, by overriding the <code>getDates</code> method of the model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getDates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>When a column is considered a date, you may set its value to a UNIX timestamp, date string (<code>Y-m-d</code>), date-time string, and of course a <code>DateTime</code> / <code>Carbon</code> instance.</p>

<p>To totally disable date mutations, simply return an empty array from the <code>getDates</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getDates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="model-events"></a></p>

<h2>Model Events</h2>

<p>Eloquent models fire several events, allowing you to hook into various points in the model&#39;s lifecycle using the following methods: <code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>, <code>restoring</code>, <code>restored</code>.</p>

<p>Whenever a new item is saved for the first time, the <code>creating</code> and <code>created</code> events will fire. If an item is not new and the <code>save</code> method is called, the <code>updating</code> / <code>updated</code> events will fire. In both cases, the <code>saving</code> / <code>saved</code> events will fire.</p>

<h4>Cancelling Save Operations Via Events</h4>

<p>If <code>false</code> is returned from the <code>creating</code>, <code>updating</code>, <code>saving</code>, or <code>deleting</code> events, the action will be cancelled:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">creating</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Setting A Model Boot Method</h4>

<p>Eloquent models also contain a static <code>boot</code> method, which may provide a convenient place to register your event bindings.</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">();</span>

        <span class="c1">// Setup event bindings...</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="model-observers"></a></p>

<h2>Model Observers</h2>

<p>To consolidate the handling of model events, you may register a model observer. An observer class may have methods that correspond to the various model events. For example, <code>creating</code>, <code>updating</code>, <code>saving</code> methods may be on an observer, in addition to any other model event name.</p>

<p>So, for example, a model observer might look like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserObserver</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">saving</span><span class="p">(</span><span class="nx">$model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">saved</span><span class="p">(</span><span class="nx">$model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may register an observer instance using the <code>observe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">observe</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserObserver</span><span class="p">);</span>
</pre></div>

<p><a name="converting-to-arrays-or-json"></a></p>

<h2>Converting To Arrays / JSON</h2>

<h4>Converting A Model To An Array</h4>

<p>When building JSON APIs, you may often need to convert your models and relationships to arrays or JSON. So, Eloquent includes methods for doing so. To convert a model and its loaded relationship to an array, you may use the <code>toArray</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p>Note that entire collections of models may also be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<h4>Converting A Model To JSON</h4>

<p>To convert a model to JSON, you may use the <code>toJson</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>
</pre></div>

<h4>Returning A Model From A Route</h4>

<p>Note that when a model or collection is cast to a string, it will be converted to JSON, meaning you can return Eloquent objects directly from your application&#39;s routes!</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Hiding Attributes From Array Or JSON Conversion</h4>

<p>Sometimes you may wish to limit the attributes that are included in your model&#39;s array or JSON form, such as passwords. To do so, add a <code>hidden</code> property definition to your model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="nx">$hidden</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When hiding relationships, use the relationship&#39;s <strong>method</strong> name, not the dynamic accessor name.</p>
</blockquote>

<p>Alternatively, you may use the <code>visible</code> property to define a white-list:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$visible</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="array-appends"></a>
Occasionally, you may need to add array attributes that do not have a corresponding column in your database. To do so, simply define an accessor for the value:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIsAdminAttribute</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">attributes</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Once you have created the accessor, just add the value to the <code>appends</code> property on the model:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$appends</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the attribute has been added to the <code>appends</code> list, it will be included in both the model&#39;s array and JSON forms. Attributes in the <code>appends</code> array respect the <code>visible</code> and <code>hidden</code> configuration on the model.</p>
<div style="page-break-after: always;" ></div><h1>Errors &amp; Logging</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#handling-errors">Handling Errors</a></li>
<li><a href="#http-exceptions">HTTP Exceptions</a></li>
<li><a href="#handling-404-errors">Handling 404 Errors</a></li>
<li><a href="#logging">Logging</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The logging handler for your application is registered in the <code>app/start/global.php</code> <a href="/docs/4.2/lifecycle#start-files">start file</a>. By default, the logger is configured to use a single log file; however, you may customize this behavior as needed. Since Laravel uses the popular <a href="https://github.com/Seldaek/monolog">Monolog</a> logging library, you can take advantage of the variety of handlers that Monolog offers.</p>

<p>For example, if you wish to use daily log files instead of a single, large file, you can make the following change to your start file:</p>
<div class="highlight"><pre><span></span><span class="nx">$logFile</span> <span class="o">=</span> <span class="s1">&#39;laravel.log&#39;</span><span class="p">;</span>

<span class="nx">Log</span><span class="o">::</span><span class="nx">useDailyFiles</span><span class="p">(</span><span class="nx">storage_path</span><span class="p">().</span><span class="s1">&#39;/logs/&#39;</span><span class="p">.</span><span class="nx">$logFile</span><span class="p">);</span>
</pre></div>

<h3>Error Detail</h3>

<p>By default, error detail is enabled for your application. This means that when an error occurs you will be shown an error page with a detailed stack trace and error message. You may turn off error details by setting the <code>debug</code> option in your <code>app/config/app.php</code> file to <code>false</code>.</p>

<blockquote>
<p><strong>Note:</strong> It is strongly recommended that you turn off error detail in a production environment.</p>
</blockquote>

<p><a name="handling-errors"></a></p>

<h2>Handling Errors</h2>

<p>By default, the <code>app/start/global.php</code> file contains an error handler for all exceptions:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">Exception</span> <span class="nx">$exception</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="nx">$exception</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>This is the most basic error handler. However, you may specify more handlers if needed. Handlers are called based on the type-hint of the Exception they handle. For example, you may create a handler that only handles <code>RuntimeException</code> instances:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">RuntimeException</span> <span class="nx">$exception</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Handle the exception...</span>
<span class="p">});</span>
</pre></div>

<p>If an exception handler returns a response, that response will be sent to the browser and no other error handlers will be called:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">InvalidUserException</span> <span class="nx">$exception</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="nx">$exception</span><span class="p">);</span>

    <span class="k">return</span> <span class="s1">&#39;Sorry! Something is wrong with this account!&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>To listen for PHP fatal errors, you may use the <code>App::fatal</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">fatal</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$exception</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If you have several exception handlers, they should be defined from most generic to most specific. So, for example, a handler that handles all exceptions of type <code>Exception</code> should be defined before a custom exception type such as <code>Illuminate\Encryption\DecryptException</code>.</p>

<h3>Where To Place Error Handlers</h3>

<p>There is no default &quot;home&quot; for error handler registrations. Laravel offers you freedom in this area. One option is to define the handlers in your <code>start/global.php</code> file. In general, this is a convenient location to place any &quot;bootstrapping&quot; code. If that file is getting crowded, you could create an <code>app/errors.php</code> file, and <code>require</code> that file from your <code>start/global.php</code> script. A third option is to create a <a href="/docs/4.2/ioc#service-providers">service provider</a> that registers the handlers. Again, there is no single &quot;correct&quot; answer. Choose a location that you are comfortable with.</p>

<p><a name="http-exceptions"></a></p>

<h2>HTTP Exceptions</h2>

<p>Some exceptions describe HTTP error codes from the server. For example, this may be a &quot;page not found&quot; error (404), an &quot;unauthorized error&quot; (401) or even a developer generated 500 error. In order to return such a response, use the following:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>Optionally, you may provide a response:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
</pre></div>

<p>This method may be used at any time during the request&#39;s lifecycle.</p>

<p><a name="handling-404-errors"></a></p>

<h2>Handling 404 Errors</h2>

<p>You may register an error handler that handles all &quot;404 Not Found&quot; errors in your application, allowing you to easily return custom 404 error pages:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">missing</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$exception</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;errors.missing&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(),</span> <span class="mi">404</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="logging"></a></p>

<h2>Logging</h2>

<p>The Laravel logging facilities provide a simple layer on top of the powerful <a href="http://github.com/seldaek/monolog">Monolog</a> library. By default, Laravel is configured to create a single log file for your application, and this file is stored in <code>app/storage/logs/laravel.log</code>. You may write information to the log like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;This is some useful information.&#39;</span><span class="p">);</span>

<span class="nx">Log</span><span class="o">::</span><span class="nx">warning</span><span class="p">(</span><span class="s1">&#39;Something could be going wrong.&#39;</span><span class="p">);</span>

<span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something is really going wrong.&#39;</span><span class="p">);</span>
</pre></div>

<p>The logger provides the seven logging levels defined in <a href="http://tools.ietf.org/html/rfc5424">RFC 5424</a>: <strong>debug</strong>, <strong>info</strong>, <strong>notice</strong>, <strong>warning</strong>, <strong>error</strong>, <strong>critical</strong>, and <strong>alert</strong>.</p>

<p>An array of contextual data may also be passed to the log methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Log message&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;context&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Other helpful information&#39;</span><span class="p">));</span>
</pre></div>

<p>Monolog has a variety of additional handlers you may use for logging. If needed, you may access the underlying Monolog instance being used by Laravel:</p>
<div class="highlight"><pre><span></span><span class="nx">$monolog</span> <span class="o">=</span> <span class="nx">Log</span><span class="o">::</span><span class="nx">getMonolog</span><span class="p">();</span>
</pre></div>

<p>You may also register an event to catch all messages passed to the log:</p>

<h4>Registering A Log Listener</h4>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$level</span><span class="p">,</span> <span class="nx">$message</span><span class="p">,</span> <span class="nx">$context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Events</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#wildcard-listeners">Wildcard Listeners</a></li>
<li><a href="#using-classes-as-listeners">Using Classes As Listeners</a></li>
<li><a href="#queued-events">Queued Events</a></li>
<li><a href="#event-subscribers">Event Subscribers</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>The Laravel <code>Event</code> class provides a simple observer implementation, allowing you to subscribe and listen for events in your application.</p>

<h4>Subscribing To An Event</h4>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">last_login</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">;</span>

    <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Firing An Event</h4>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
</pre></div>

<p>The <code>fire</code> method returns an array of responses that you can use to control what happens next in your application.</p>

<h4>Subscribing To Events With Priority</h4>

<p>You may also specify a priority when subscribing to events. Listeners with higher priority will be run first, while listeners that have the same priority will be run in order of subscription.</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="s1">&#39;LoginHandler&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="s1">&#39;OtherHandler&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<h4>Stopping The Propagation Of An Event</h4>

<p>Sometimes, you may wish to stop the propagation of an event to other listeners. You may do so using by returning <code>false</code> from your listener:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Handle the event...</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h3>Where To Register Events</h3>

<p>So, you know how to register events, but you may be wondering <em>where</em> to register them. Don&#39;t worry, this is a common question. Unfortunately, it&#39;s a hard question to answer because you can register an event almost anywhere! But, here are some tips. Again, like most other bootstrapping code, you may register events in one of your <code>start</code> files such as <code>app/start/global.php</code>.</p>

<p>If your <code>start</code> files are getting too crowded, you could create a separate <code>app/events.php</code> file that is included from a <code>start</code> file. This is a simple solution that keeps your event registration cleanly separated from the rest of your bootstrapping.</p>

<p>If you prefer a class based approach, you may register your events in a <a href="/docs/4.2/ioc#service-providers">service provider</a>. Since none of these approaches is inherently &quot;correct&quot;, choose an approach you feel comfortable with based on the size of your application.</p>

<p><a name="wildcard-listeners"></a></p>

<h2>Wildcard Listeners</h2>

<h4>Registering Wildcard Event Listeners</h4>

<p>When registering an event listener, you may use asterisks to specify wildcard listeners:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;foo.*&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$param</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Handle the event...</span>
<span class="p">});</span>
</pre></div>

<p>This listener will handle all events that begin with <code>foo.</code>.</p>

<p>You may use the <code>Event::firing</code> method to determine exactly which event was fired:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;foo.*&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$param</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Event</span><span class="o">::</span><span class="nx">firing</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;foo.bar&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="using-classes-as-listeners"></a></p>

<h2>Using Classes As Listeners</h2>

<p>In some cases, you may wish to use a class to handle an event rather than a Closure. Class event listeners will be resolved out of the <a href="/docs/4.2/ioc">Laravel IoC container</a>, providing you the full power of dependency injection on your listeners.</p>

<h4>Registering A Class Listener</h4>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="s1">&#39;LoginHandler&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining An Event Listener Class</h4>

<p>By default, the <code>handle</code> method on the <code>LoginHandler</code> class will be called:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">LoginHandler</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Specifying Which Method To Subscribe</h4>

<p>If you do not wish to use the default <code>handle</code> method, you may specify the method that should be subscribed:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="s1">&#39;LoginHandler@onLogin&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="queued-events"></a></p>

<h2>Queued Events</h2>

<h4>Registering A Queued Event</h4>

<p>Using the <code>queue</code> and <code>flush</code> methods, you may &quot;queue&quot; an event for firing, but not fire it immediately:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
</pre></div>

<p>You may run the &quot;flusher&quot; and flush all queued events using the <code>flush</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">flush</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="event-subscribers"></a></p>

<h2>Event Subscribers</h2>

<h4>Defining An Event Subscriber</h4>

<p>Event subscribers are classes that may subscribe to multiple events from within the class itself. Subscribers should define a <code>subscribe</code> method, which will be passed an event dispatcher instance:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserEventHandler</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Handle user login events.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">onUserLogin</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Handle user logout events.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">onUserLogout</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Register the listeners for the subscriber.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  Illuminate\Events\Dispatcher  $events</span>
<span class="cm">     * @return array</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">$events</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">,</span> <span class="s1">&#39;UserEventHandler@onUserLogin&#39;</span><span class="p">);</span>

        <span class="nx">$events</span><span class="o">-&gt;</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;auth.logout&#39;</span><span class="p">,</span> <span class="s1">&#39;UserEventHandler@onUserLogout&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Registering An Event Subscriber</h4>

<p>Once the subscriber has been defined, it may be registered with the <code>Event</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">$subscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserEventHandler</span><span class="p">;</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">$subscriber</span><span class="p">);</span>
</pre></div>

<p>You may also use the <a href="/docs/4.2/ioc">Laravel IoC container</a> to resolve your subscriber. To do so, simply pass the name of your subscriber to the <code>subscribe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;UserEventHandler&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Extending The Framework</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#managers-and-factories">Managers &amp; Factories</a></li>
<li><a href="#where-to-extend">Where To Extend</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#session">Session</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#ioc-based-extension">IoC Based Extension</a></li>
<li><a href="#request-extension">Request Extension</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel offers many extension points for you to customize the behavior of the framework&#39;s core components, or even replace them entirely. For example, the hashing facilities are defined by a <code>HasherInterface</code> contract, which you may implement based on your application&#39;s requirements. You may also extend the <code>Request</code> object, allowing you to add your own convenient &quot;helper&quot; methods. You may even add entirely new authentication, cache, and session drivers!</p>

<p>Laravel components are generally extended in two ways: binding new implementations in the IoC container, or registering an extension with a <code>Manager</code> class, which are implementations of the &quot;Factory&quot; design pattern. In this chapter we&#39;ll explore the various methods of extending the framework and examine the necessary code.</p>

<blockquote>
<p><strong>Note:</strong> Remember, Laravel components are typically extended in one of two ways: IoC bindings and the <code>Manager</code> classes. The manager classes serve as an implementation of the &quot;factory&quot; design pattern, and are responsible for instantiating driver based facilities such as cache and session.</p>
</blockquote>

<p><a name="managers-and-factories"></a></p>

<h2>Managers &amp; Factories</h2>

<p>Laravel has several <code>Manager</code> classes that manage the creation of driver-based components. These include the cache, session, authentication, and queue components. The manager class is responsible for creating a particular driver implementation based on the application&#39;s configuration. For example, the <code>CacheManager</code> class can create APC, Memcached, File, and various other implementations of cache drivers.</p>

<p>Each of these managers includes an <code>extend</code> method which may be used to easily inject new driver resolution functionality into the manager. We&#39;ll cover each of these managers below, with examples of how to inject custom driver support into each of them.</p>

<blockquote>
<p><strong>Note:</strong> Take a moment to explore the various <code>Manager</code> classes that ship with Laravel, such as the <code>CacheManager</code> and <code>SessionManager</code>. Reading through these classes will give you a more thorough understanding of how Laravel works under the hood. All manager classes extend the <code>Illuminate\Support\Manager</code> base class, which provides some helpful, common functionality for each manager.</p>
</blockquote>

<p><a name="where-to-extend"></a></p>

<h2>Where To Extend</h2>

<p>This documentation covers how to extend a variety of Laravel&#39;s components, but you may be wondering where to place your extension code. Like most other bootstrapping code, you are free to place some extensions in your <code>start</code> files. Cache and Auth extensions are good candidates for this approach. Other extensions, like <code>Session</code>, must be placed in the <code>register</code> method of a service provider since they are needed very early in the request life-cycle.</p>

<p><a name="cache"></a></p>

<h2>Cache</h2>

<p>To extend the Laravel cache facility, we will use the <code>extend</code> method on the <code>CacheManager</code>, which is used to bind a custom driver resolver to the manager, and is common across all manager classes. For example, to register a new cache driver named &quot;mongo&quot;, we would do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Return Illuminate\Cache\Repository instance...</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>extend</code> method is the name of the driver. This will correspond to your <code>driver</code> option in the <code>app/config/cache.php</code> configuration file. The second argument is a Closure that should return an <code>Illuminate\Cache\Repository</code> instance. The Closure will be passed an <code>$app</code> instance, which is an instance of <code>Illuminate\Foundation\Application</code> and an IoC container.</p>

<p>To create our custom cache driver, we first need to implement the <code>Illuminate\Cache\StoreInterface</code> contract. So, our MongoDB cache implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MongoStore</span> <span class="kr">implements</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Cache</span><span class="err">\</span><span class="nx">StoreInterface</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">get</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">put</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">decrement</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">forever</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">forget</span><span class="p">(</span><span class="nx">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">flush</span><span class="p">()</span> <span class="p">{}</span>

<span class="p">}</span>
</pre></div>

<p>We just need to implement each of these methods using a MongoDB connection. Once our implementation is complete, we can finish our custom driver registration:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Cache</span><span class="err">\</span><span class="nx">Repository</span><span class="p">;</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see in the example above, you may use the base <code>Illuminate\Cache\Repository</code> when creating custom cache drivers. There is typically no need to create your own repository class.</p>

<p>If you&#39;re wondering where to put your custom cache driver code, consider making it available on Packagist! Or, you could create an <code>Extensions</code> namespace within your application&#39;s primary folder. For example, if the application is named <code>Snappy</code>, you could place the cache extension in <code>app/Snappy/Extensions/MongoStore.php</code>. However, keep in mind that Laravel does not have a rigid application structure and you are free to organize your application according to your preferences.</p>

<blockquote>
<p><strong>Note:</strong> If you&#39;re ever wondering where to put a piece of code, always consider a service provider. As we&#39;ve discussed, using a service provider to organize framework extensions is a great way to organize your code.</p>
</blockquote>

<p><a name="session"></a></p>

<h2>Session</h2>

<p>Extending Laravel with a custom session driver is just as easy as extending the cache system. Again, we will use the <code>extend</code> method to register our custom code:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Return implementation of SessionHandlerInterface</span>
<span class="p">});</span>
</pre></div>

<h3>Where To Extend The Session</h3>

<p>Session extensions need to be registered differently than other extensions like Cache and Auth. Since sessions are started very early in the request-lifecycle, registering the extensions in a <code>start</code> file will happen too late. Instead, a <a href="/docs/4.2/ioc#service-providers">service provider</a> will be needed. You should place your session extension code in the <code>register</code> method of your service provider, and the provider should be placed <strong>below</strong> the default <code>Illuminate\Session\SessionServiceProvider</code> in the <code>providers</code> configuration array.</p>

<h3>Writing The Session Extension</h3>

<p>Note that our custom session driver should implement the <code>SessionHandlerInterface</code>. This interface is included in the PHP 5.4+ core. If you are using PHP 5.3, the interface will be defined for you by Laravel so you have forward-compatibility. This interface contains just a few simple methods we need to implement. A stubbed MongoDB implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MongoHandler</span> <span class="kr">implements</span> <span class="nx">SessionHandlerInterface</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">open</span><span class="p">(</span><span class="nx">$savePath</span><span class="p">,</span> <span class="nx">$sessionName</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">close</span><span class="p">()</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">read</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">write</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">gc</span><span class="p">(</span><span class="nx">$lifetime</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">}</span>
</pre></div>

<p>Since these methods are not as readily understandable as the cache <code>StoreInterface</code>, let&#39;s quickly cover what each of the methods do:</p>

<ul>
<li>The <code>open</code> method would typically be used in file based session store systems. Since Laravel ships with a <code>file</code> session driver, you will almost never need to put anything in this method. You can leave it as an empty stub. It is simply a fact of poor interface design (which we&#39;ll discuss later) that PHP requires us to implement this method.</li>
<li>The <code>close</code> method, like the <code>open</code> method, can also usually be disregarded. For most drivers, it is not needed.</li>
<li>The <code>read</code> method should return the string version of the session data associated with the given <code>$sessionId</code>. There is no need to do any serialization or other encoding when retrieving or storing session data in your driver, as Laravel will perform the serialization for you.</li>
<li>The <code>write</code> method should write the given <code>$data</code> string associated with the <code>$sessionId</code> to some persistent storage system, such as MongoDB, Dynamo, etc.</li>
<li>The <code>destroy</code> method should remove the data associated with the <code>$sessionId</code> from persistent storage.</li>
<li>The <code>gc</code> method should destroy all session data that is older than the given <code>$lifetime</code>, which is a UNIX timestamp. For self-expiring systems like Memcached and Redis, this method may be left empty.</li>
</ul>

<p>Once the <code>SessionHandlerInterface</code> has been implemented, we are ready to register it with the Session manager:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MongoHandler</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Once the session driver has been registered, we may use the <code>mongo</code> driver in our <code>app/config/session.php</code> configuration file.</p>

<blockquote>
<p><strong>Note:</strong> Remember, if you write a custom session handler, share it on Packagist!</p>
</blockquote>

<p><a name="authentication"></a></p>

<h2>Authentication</h2>

<p>Authentication may be extended the same way as the cache and session facilities. Again, we will use the <code>extend</code> method we have become familiar with:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Return implementation of Illuminate\Auth\UserProviderInterface</span>
<span class="p">});</span>
</pre></div>

<p>The <code>UserProviderInterface</code> implementations are only responsible for fetching a <code>UserInterface</code> implementation out of a persistent storage system, such as MySQL, Riak, etc. These two interfaces allow the Laravel authentication mechanisms to continue functioning regardless of how the user data is stored or what type of class is used to represent it.</p>

<p>Let&#39;s take a look at the <code>UserProviderInterface</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">interface</span> <span class="nx">UserProviderInterface</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveById</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByToken</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">updateRememberToken</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByCredentials</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$credentials</span><span class="p">);</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">validateCredentials</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$credentials</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>

<p>The <code>retrieveById</code> function typically receives a numeric key representing the user, such as an auto-incrementing ID from a MySQL database. The <code>UserInterface</code> implementation matching the ID should be retrieved and returned by the method.</p>

<p>The <code>retrieveByToken</code> function retrieves a user by their unique <code>$identifier</code> and &quot;remember me&quot; <code>$token</code>, stored in a field <code>remember_token</code>. As with with previous method, the <code>UserInterface</code> implementation should be returned.</p>

<p>The <code>updateRememberToken</code> method updates the <code>$user</code> field <code>remember_token</code> with the new <code>$token</code>. The new token can be either a fresh token, assigned on successfull &quot;remember me&quot; login attempt, or a null when user is logged out.</p>

<p>The <code>retrieveByCredentials</code> method receives the array of credentials passed to the <code>Auth::attempt</code> method when attempting to sign into an application. The method should then &quot;query&quot; the underlying persistent storage for the user matching those credentials. Typically, this method will run a query with a &quot;where&quot; condition on <code>$credentials[&#39;username&#39;]</code>. <strong>This method should not attempt to do any password validation or authentication.</strong></p>

<p>The <code>validateCredentials</code> method should compare the given <code>$user</code> with the <code>$credentials</code> to authenticate the user. For example, this method might compare the <code>$user-&gt;getAuthPassword()</code> string to a <code>Hash::make</code> of <code>$credentials[&#39;password&#39;]</code>.</p>

<p>Now that we have explored each of the methods on the <code>UserProviderInterface</code>, let&#39;s take a look at the <code>UserInterface</code>. Remember, the provider should return implementations of this interface from the <code>retrieveById</code> and <code>retrieveByCredentials</code> methods:</p>
<div class="highlight"><pre><span></span><span class="kr">interface</span> <span class="nx">UserInterface</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAuthIdentifier</span><span class="p">();</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getAuthPassword</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>

<p>This interface is simple. The <code>getAuthIdentifier</code> method should return the &quot;primary key&quot; of the user. In a MySQL back-end, again, this would be the auto-incrementing primary key. The <code>getAuthPassword</code> should return the user&#39;s hashed password. This interface allows the authentication system to work with any User class, regardless of what ORM or storage abstraction layer you are using. By default, Laravel includes a <code>User</code> class in the <code>app/models</code> directory which implements this interface, so you may consult this class for an implementation example.</p>

<p>Finally, once we have implemented the <code>UserProviderInterface</code>, we are ready to register our extension with the <code>Auth</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">RiakUserProvider</span><span class="p">(</span><span class="nx">$app</span><span class="p">[</span><span class="s1">&#39;riak.connection&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>After you have registered the driver with the <code>extend</code> method, you switch to the new driver in your <code>app/config/auth.php</code> configuration file.</p>

<p><a name="ioc-based-extension"></a></p>

<h2>IoC Based Extension</h2>

<p>Almost every service provider included with the Laravel framework binds objects into the IoC container. You can find a list of your application&#39;s service providers in the <code>app/config/app.php</code> configuration file. As you have time, you should skim through each of these provider&#39;s source code. By doing so, you will gain a much better understanding of what each provider adds to the framework, as well as what keys are used to bind various services into the IoC container.</p>

<p>For example, the <code>HashServiceProvider</code> binds a <code>hash</code> key into the IoC container, which resolves into a <code>Illuminate\Hashing\BcryptHasher</code> instance. You can easily extend and override this class within your own application by overriding this IoC binding. For example:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">SnappyHashProvider</span> <span class="kr">extends</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Hashing</span><span class="err">\</span><span class="nx">HashServiceProvider</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">App</span><span class="o">::</span><span class="nx">bindShared</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Snappy</span><span class="err">\</span><span class="nx">Hashing</span><span class="err">\</span><span class="nx">ScryptHasher</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">parent</span><span class="o">::</span><span class="nx">boot</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Note that this class extends the <code>HashServiceProvider</code>, not the default <code>ServiceProvider</code> base class. Once you have extended the service provider, swap out the <code>HashServiceProvider</code> in your <code>app/config/app.php</code> configuration file with the name of your extended provider.</p>

<p>This is the general method of extending any core class that is bound in the container. Essentially every core class is bound in the container in this fashion, and can be overridden. Again, reading through the included framework service providers will familiarize you with where various classes are bound into the container, and what keys they are bound by. This is a great way to learn more about how Laravel is put together.</p>

<p><a name="request-extension"></a></p>

<h2>Request Extension</h2>

<p>Because it is such a foundational piece of the framework and is instantiated very early in the request cycle, extending the <code>Request</code> class works a little differently than the previous examples.</p>

<p>First, extend the class like normal:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">QuickBill\Extensions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Request</span> <span class="k">extends</span> <span class="nx">\Illuminate\Http\Request</span> <span class="p">{</span>

    <span class="c1">// Custom, helpful methods here...</span>

<span class="p">}</span>
</pre></div>

<p>Once you have extended the class, open the <code>bootstrap/start.php</code> file. This file is one of the very first files to be included on each request to your application. Note that the first action performed is the creation of the Laravel <code>$app</code> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Foundation</span><span class="err">\</span><span class="nx">Application</span><span class="p">;</span>
</pre></div>

<p>When a new application instance is created, it will create a new <code>Illuminate\Http\Request</code> instance and bind it to the IoC container using the <code>request</code> key. So, we need a way to specify a custom class that should be used as the &quot;default&quot; request type, right? And, thankfully, the <code>requestClass</code> method on the application instance does just this! So, we can add this line at the very top of our <code>bootstrap/start.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Foundation</span><span class="err">\</span><span class="nx">Application</span><span class="p">;</span>

<span class="nx">Application</span><span class="o">::</span><span class="nx">requestClass</span><span class="p">(</span><span class="s1">&#39;QuickBill\Extensions\Request&#39;</span><span class="p">);</span>
</pre></div>

<p>Once you have specified the custom request class, Laravel will use this class anytime it creates a <code>Request</code> instance, conveniently allowing you to always have an instance of your custom request class available, even in unit tests!</p>
<div style="page-break-after: always;" ></div><h1>Facades</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#explanation">Explanation</a></li>
<li><a href="#practical-usage">Practical Usage</a></li>
<li><a href="#creating-facades">Creating Facades</a></li>
<li><a href="#mocking-facades">Mocking Facades</a></li>
<li><a href="#facade-class-reference">Facade Class Reference</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Facades provide a &quot;static&quot; interface to classes that are available in the application&#39;s <a href="/docs/4.2/ioc">IoC container</a>. Laravel ships with many facades, and you have probably been using them without even knowing it! Laravel &quot;facades&quot; serve as &quot;static proxies&quot; to underlying classes in the IoC container, providing the benefit of a terse, expressive syntax while maintaining more testability and flexibility than traditional static methods.</p>

<p>Occasionally, You may wish to create your own facades for your applications and packages, so let&#39;s explore the concept, development and usage of these classes.</p>

<blockquote>
<p><strong>Note:</strong> Before digging into facades, it is strongly recommended that you become very familiar with the Laravel <a href="/docs/4.2/ioc">IoC container</a>.</p>
</blockquote>

<p><a name="explanation"></a></p>

<h2>Explanation</h2>

<p>In the context of a Laravel application, a facade is a class that provides access to an object from the container. The machinery that makes this work is in the <code>Facade</code> class. Laravel&#39;s facades, and any custom facades you create, will extend the base <code>Facade</code> class.</p>

<p>Your facade class only needs to implement a single method: <code>getFacadeAccessor</code>. It&#39;s the <code>getFacadeAccessor</code> method&#39;s job to define what to resolve from the container. The <code>Facade</code> base class makes use of the <code>__callStatic()</code> magic-method to defer calls from your facade to the resolved object.</p>

<p>So, when you make a facade call like <code>Cache::get</code>, Laravel resolves the Cache manager class out of the IoC container and calls the <code>get</code> method on the class. In technical terms, Laravel Facades are a convenient syntax for using the Laravel IoC container as a service locator.</p>

<p><a name="practical-usage"></a></p>

<h2>Practical Usage</h2>

<p>In the example below, a call is made to the Laravel cache system. By glancing at this code, one might assume that the static method <code>get</code> is being called on the <code>Cache</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>However, if we look at that <code>Illuminate\Support\Facades\Cache</code> class, you&#39;ll see that there is no static method <code>get</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Cache</span> <span class="kr">extends</span> <span class="nx">Facade</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the registered name of the component.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;cache&#39;</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>The Cache class extends the base <code>Facade</code> class and defines a method <code>getFacadeAccessor()</code>. Remember, this method&#39;s job is to return the name of an IoC binding.</p>

<p>When a user references any static method on the <code>Cache</code> facade, Laravel resolves the <code>cache</code> binding from the IoC container and runs the requested method (in this case, <code>get</code>) against that object.</p>

<p>So, our <code>Cache::get</code> call could be re-written like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="creating-facades"></a></p>

<h2>Creating Facades</h2>

<p>Creating a facade for your own application or package is simple. You only need 3 things:</p>

<ul>
<li>An IoC binding.</li>
<li>A facade class.</li>
<li>A facade alias configuration.</li>
</ul>

<p>Let&#39;s look at an example. Here, we have a class defined as <code>PaymentGateway\Payment</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">namespace</span> <span class="nx">PaymentGateway</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Payment</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">process</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>This class might live in your <code>app/models</code> directory, or any other directory that Composer knows how to auto-load.</p>

<p>We need to be able to resolve this class from the IoC container. So, let&#39;s add a binding:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;payment&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="err">\</span><span class="nx">PaymentGateway</span><span class="err">\</span><span class="nx">Payment</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>A great place to register this binding would be to create a new <a href="/docs/4.2/ioc#service-providers">service provider</a> named <code>PaymentServiceProvider</code>, and add this binding to the <code>register</code> method. You can then configure Laravel to load your service provider from the <code>app/config/app.php</code> configuration file.</p>

<p>Next, we can create our own facade class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Facade</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Payment</span> <span class="kr">extends</span> <span class="nx">Facade</span> <span class="p">{</span>

    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;payment&#39;</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Finally, if we wish, we can add an alias for our facade to the <code>aliases</code> array in the <code>app/config/app.php</code> configuration file. Now, we can call the <code>process</code> method on an instance of the <code>Payment</code> class.</p>
<div class="highlight"><pre><span></span><span class="nx">Payment</span><span class="o">::</span><span class="nx">process</span><span class="p">();</span>
</pre></div>

<h3>A Note On Auto-Loading Aliases</h3>

<p>Classes in the <code>aliases</code> array are not available in some instances because <a href="https://bugs.php.net/bug.php?id=39003">PHP will not attempt to autoload undefined type-hinted classes</a>. If <code>\ServiceWrapper\ApiTimeoutException</code> is aliased to <code>ApiTimeoutException</code>, a <code>catch(ApiTimeoutException $e)</code> outside of the namespace <code>\ServiceWrapper</code> will never catch the exception, even if one is thrown. A similar problem is found in Models which have type hints to aliased classes. The only workaround is to forego aliasing and <code>use</code> the classes you wish to type hint at the top of each file which requires them.</p>

<p><a name="mocking-facades"></a></p>

<h2>Mocking Facades</h2>

<p>Unit testing is an important aspect of why facades work the way that they do. In fact, testability is the primary reason for facades to even exist. For more information, check out the <a href="/docs/4.2/testing#mocking-facades">mocking facades</a> section of the documentation.</p>

<p><a name="facade-class-reference"></a></p>

<h2>Facade Class Reference</h2>

<p>Below you will find every facade and its underlying class. This is a useful tool for quickly digging into the API documentation for a given facade root. The <a href="/docs/4.2/ioc">IoC binding</a> key is also included where applicable.</p>

<p>Facade  |  Class  |  IoC Binding
------------- | ------------- | -------------
App  |  <a href="http://laravel.com/api/4.2/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a>  | <code>app</code>
Artisan  |  <a href="http://laravel.com/api/4.2/Illuminate/Console/Application.html">Illuminate\Console\Application</a>  |  <code>artisan</code>
Auth  |  <a href="http://laravel.com/api/4.2/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a>  |  <code>auth</code>
Auth (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Auth/Guard.html">Illuminate\Auth\Guard</a>  |
Blade  |  <a href="http://laravel.com/api/4.2/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a>  |  <code>blade.compiler</code>
Cache  |  <a href="http://laravel.com/api/4.2/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a>  |  <code>cache</code>
Config  |  <a href="http://laravel.com/api/4.2/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a>  |  <code>config</code>
Cookie  |  <a href="http://laravel.com/api/4.2/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a>  |  <code>cookie</code>
Crypt  |  <a href="http://laravel.com/api/4.2/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a>  |  <code>encrypter</code>
DB  |  <a href="http://laravel.com/api/4.2/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a>  |  <code>db</code>
DB (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a>  |
Event  |  <a href="http://laravel.com/api/4.2/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a>  |  <code>events</code>
File  |  <a href="http://laravel.com/api/4.2/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a>  |  <code>files</code>
Form  |  <a href="http://laravel.com/api/4.2/Illuminate/Html/FormBuilder.html">Illuminate\Html\FormBuilder</a>  |  <code>form</code>
Hash  |  <a href="http://laravel.com/api/4.2/Illuminate/Hashing/HasherInterface.html">Illuminate\Hashing\HasherInterface</a>  |  <code>hash</code>
HTML  |  <a href="http://laravel.com/api/4.2/Illuminate/Html/HtmlBuilder.html">Illuminate\Html\HtmlBuilder</a>  |  <code>html</code>
Input  |  <a href="http://laravel.com/api/4.2/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Lang  |  <a href="http://laravel.com/api/4.2/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a>  |  <code>translator</code>
Log  |  <a href="http://laravel.com/api/4.2/Illuminate/Log/Writer.html">Illuminate\Log\Writer</a>  |  <code>log</code>
Mail  |  <a href="http://laravel.com/api/4.2/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a>  |  <code>mailer</code>
Paginator  |  <a href="http://laravel.com/api/4.2/Illuminate/Pagination/Factory.html">Illuminate\Pagination\Factory</a>  |  <code>paginator</code>
Paginator (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Pagination/Paginator.html">Illuminate\Pagination\Paginator</a>  |
Password  |  <a href="http://laravel.com/api/4.2/Illuminate/Auth/Reminders/PasswordBroker.html">Illuminate\Auth\Reminders\PasswordBroker</a>  |  <code>auth.reminder</code>
Queue  |  <a href="http://laravel.com/api/4.2/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a>  |  <code>queue</code>
Queue (Instance) |  <a href="http://laravel.com/api/4.2/Illuminate/Queue/QueueInterface.html">Illuminate\Queue\QueueInterface</a>  |
Queue (Base Class) |  <a href="http://laravel.com/api/4.2/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a>  |
Redirect  |  <a href="http://laravel.com/api/4.2/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a>  |  <code>redirect</code>
Redis  |  <a href="http://laravel.com/api/4.2/Illuminate/Redis/Database.html">Illuminate\Redis\Database</a>  |  <code>redis</code>
Request  |  <a href="http://laravel.com/api/4.2/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Response  |  <a href="http://laravel.com/api/4.2/Illuminate/Support/Facades/Response.html">Illuminate\Support\Facades\Response</a>  |
Route  |  <a href="http://laravel.com/api/4.2/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a>  |  <code>router</code>
Schema  |  <a href="http://laravel.com/api/4.2/Illuminate/Database/Schema/Blueprint.html">Illuminate\Database\Schema\Blueprint</a>  |
Session  |  <a href="http://laravel.com/api/4.2/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a>  |  <code>session</code>
Session (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Session/Store.html">Illuminate\Session\Store</a>  |
SSH  |  <a href="http://laravel.com/api/4.2/Illuminate/Remote/RemoteManager.html">Illuminate\Remote\RemoteManager</a>  |  <code>remote</code>
SSH (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Remote/Connection.html">Illuminate\Remote\Connection</a>  |
URL  |  <a href="http://laravel.com/api/4.2/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a>  |  <code>url</code>
Validator  |  <a href="http://laravel.com/api/4.2/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a>  |  <code>validator</code>
Validator (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a> |
View  |  <a href="http://laravel.com/api/4.2/Illuminate/View/Factory.html">Illuminate\View\Factory</a>  |  <code>view</code>
View (Instance)  |  <a href="http://laravel.com/api/4.2/Illuminate/View/View.html">Illuminate\View\View</a>  |</p>
<div style="page-break-after: always;" ></div><h1>Helper Functions</h1>

<ul>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#paths">Paths</a></li>
<li><a href="#strings">Strings</a></li>
<li><a href="#urls">URLs</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
</ul>

<p><a name="arrays"></a></p>

<h2>Arrays</h2>

<h3>array_add</h3>

<p>The <code>array_add</code> function adds a given key / value pair to the array if the given key doesn&#39;t already exist in the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_add</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_divide</h3>

<p>The <code>array_divide</code> function returns two arrays, one containing the keys, and the other containing the values of the original array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>

<span class="nx">list</span><span class="p">(</span><span class="nx">$keys</span><span class="p">,</span> <span class="nx">$values</span><span class="p">)</span> <span class="o">=</span> <span class="nx">array_divide</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>
</pre></div>

<h3>array_dot</h3>

<p>The <code>array_dot</code> function flattens a multi-dimensional array into a single level array that uses &quot;dot&quot; notation to indicate depth.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">));</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_dot</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// array(&#39;foo.bar&#39; =&gt; &#39;baz&#39;);</span>
</pre></div>

<h3>array_except</h3>

<p>The <code>array_except</code> method removes the given key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_except</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">));</span>
</pre></div>

<h3>array_fetch</h3>

<p>The <code>array_fetch</code> method returns a flattened array containing the selected nested element.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">)),</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">)),</span>
<span class="p">);</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_fetch</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">);</span>

<span class="c1">// array(&#39;Taylor&#39;, &#39;Dayle&#39;);</span>
</pre></div>

<h3>array_first</h3>

<p>The <code>array_first</code> method returns the first element of an array passing a given truth test.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>A default value may also be passed as the third parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<h3>array_last</h3>

<p>The <code>array_last</code> method returns the last element of an array passing a given truth test.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 500</span>
</pre></div>

<p>A default value may also be passed as the third parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<h3>array_flatten</h3>

<p>The <code>array_flatten</code> method will flatten a multi-dimensional array into a single level.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">));</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_flatten</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// array(&#39;Joe&#39;, &#39;PHP&#39;, &#39;Ruby&#39;);</span>
</pre></div>

<h3>array_forget</h3>

<p>The <code>array_forget</code> method will remove a given key / value pair from a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;joe&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;programmer&#39;</span><span class="p">)));</span>

<span class="nx">array_forget</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.joe&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_get</h3>

<p>The <code>array_get</code> method will retrieve a given value from a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;joe&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;programmer&#39;</span><span class="p">)));</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.joe&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.john&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Want something like <code>array_get</code> but for objects instead? Use <code>object_get</code>.</p>
</blockquote>

<h3>array_only</h3>

<p>The <code>array_only</code> method will return only the specified key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">);</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_only</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span><span class="p">));</span>
</pre></div>

<h3>array_pluck</h3>

<p>The <code>array_pluck</code> method will pluck a list of the given key / value pairs from the array.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">),</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">));</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// array(&#39;Taylor&#39;, &#39;Dayle&#39;);</span>
</pre></div>

<h3>array_pull</h3>

<p>The <code>array_pull</code> method will return a given key / value pair from the array, as well as remove it.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">27</span><span class="p">);</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">array_pull</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_set</h3>

<p>The <code>array_set</code> method will set a value within a deeply nested array using &quot;dot&quot; notation.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;names&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;programmer&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">));</span>

<span class="nx">array_set</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;names.editor&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>
</pre></div>

<h3>array_sort</h3>

<p>The <code>array_sort</code> method sorts the array by the results of the given Closure.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jill&#39;</span><span class="p">),</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Barry&#39;</span><span class="p">),</span>
<span class="p">);</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">array_sort</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}));</span>
</pre></div>

<h3>array_where</h3>

<p>Filter the array using the given Closure.</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">array_where</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">is_string</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Array ( [1] =&gt; 200 [3] =&gt; 400 )</span>
</pre></div>

<h3>head</h3>

<p>Return the first element in the array. Useful for method chaining in PHP 5.3.x.</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">head</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">returnsArray</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
</pre></div>

<h3>last</h3>

<p>Return the last element in the array. Useful for method chaining.</p>
<div class="highlight"><pre><span></span><span class="nx">$last</span> <span class="o">=</span> <span class="nx">last</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">returnsArray</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="paths"></a></p>

<h2>Paths</h2>

<h3>app_path</h3>

<p>Get the fully qualified path to the <code>app</code> directory.</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">();</span>
</pre></div>

<h3>base_path</h3>

<p>Get the fully qualified path to the root of the application install.</p>

<h3>public_path</h3>

<p>Get the fully qualified path to the <code>public</code> directory.</p>

<h3>storage_path</h3>

<p>Get the fully qualified path to the <code>app/storage</code> directory.</p>

<p><a name="strings"></a></p>

<h2>Strings</h2>

<h3>camel_case</h3>

<p>Convert the given string to <code>camelCase</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$camel</span> <span class="o">=</span> <span class="nx">camel_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// fooBar</span>
</pre></div>

<h3>class_basename</h3>

<p>Get the class name of the given class, without any namespace names.</p>
<div class="highlight"><pre><span></span><span class="nx">$class</span> <span class="o">=</span> <span class="nx">class_basename</span><span class="p">(</span><span class="s1">&#39;Foo\Bar\Baz&#39;</span><span class="p">);</span>

<span class="c1">// Baz</span>
</pre></div>

<h3>e</h3>

<p>Run <code>htmlentities</code> over the given string, with UTF-8 support.</p>
<div class="highlight"><pre><span></span><span class="nx">$entities</span> <span class="o">=</span> <span class="nx">e</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;foo&lt;/html&gt;&#39;</span><span class="p">);</span>
</pre></div>

<h3>ends_with</h3>

<p>Determine if the given haystack ends with a given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">ends_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h3>snake_case</h3>

<p>Convert the given string to <code>snake_case</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$snake</span> <span class="o">=</span> <span class="nx">snake_case</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">);</span>

<span class="c1">// foo_bar</span>
</pre></div>

<h3>str_limit</h3>

<p>Limit the number of characters in a string.</p>
<div class="highlight"><pre><span></span><span class="nx">str_limit</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$limit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">$end</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
</pre></div>

<p>Example:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_limit</span><span class="p">(</span><span class="s1">&#39;The PHP framework for web artisans.&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="c1">// The PHP...</span>
</pre></div>

<h3>starts_with</h3>

<p>Determine if the given haystack begins with the given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">starts_with</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_contains</h3>

<p>Determine if the given haystack contains the given needle.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_contains</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_finish</h3>

<p>Add a single instance of the given needle to the haystack. Remove any extra instances.</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_finish</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>
</pre></div>

<h3>str_is</h3>

<p>Determine if a given string matches a given pattern. Asterisks may be used to indicate wildcards.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">str_is</span><span class="p">(</span><span class="s1">&#39;foo*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_plural</h3>

<p>Convert a string to its plural form (English only).</p>
<div class="highlight"><pre><span></span><span class="nx">$plural</span> <span class="o">=</span> <span class="nx">str_plural</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">);</span>
</pre></div>

<h3>str_random</h3>

<p>Generate a random string of the given length.</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
</pre></div>

<h3>str_singular</h3>

<p>Convert a string to its singular form (English only).</p>
<div class="highlight"><pre><span></span><span class="nx">$singular</span> <span class="o">=</span> <span class="nx">str_singular</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">);</span>
</pre></div>

<h3>studly_case</h3>

<p>Convert the given string to <code>StudlyCase</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">studly_case</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// FooBar</span>
</pre></div>

<h3>trans</h3>

<p>Translate a given language line. Alias of <code>Lang::get</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;validation.required&#39;</span><span class="p">)</span><span class="o">:</span>
</pre></div>

<h3>trans_choice</h3>

<p>Translate a given language line with inflection. Alias of <code>Lang::choice</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="nx">$count</span><span class="p">);</span>
</pre></div>

<p><a name="urls"></a></p>

<h2>URLs</h2>

<h3>action</h3>

<p>Generate a URL for a given controller action.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@getIndex&#39;</span><span class="p">,</span> <span class="nx">$params</span><span class="p">);</span>
</pre></div>

<h3>route</h3>

<p>Generate a URL for a given named route.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">,</span> <span class="nx">$params</span><span class="p">);</span>
</pre></div>

<h3>asset</h3>

<p>Generate a URL for an asset.</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<h3>link_to</h3>

<p>Generate a HTML link to the given URL.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">link_to</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(),</span> <span class="nx">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<h3>link<em>to</em>asset</h3>

<p>Generate a HTML link to the given asset.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">link_to_asset</span><span class="p">(</span><span class="s1">&#39;foo/bar.zip&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(),</span> <span class="nx">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<h3>link<em>to</em>route</h3>

<p>Generate a HTML link to the given route.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">link_to_route</span><span class="p">(</span><span class="s1">&#39;route.name&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(),</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
</pre></div>

<h3>link<em>to</em>action</h3>

<p>Generate a HTML link to the given controller action.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">link_to_action</span><span class="p">(</span><span class="s1">&#39;HomeController@getIndex&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(),</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
</pre></div>

<h3>secure_asset</h3>

<p>Generate a HTML link to the given asset using HTTPS.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">secure_asset</span><span class="p">(</span><span class="s1">&#39;foo/bar.zip&#39;</span><span class="p">,</span> <span class="nx">$title</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
</pre></div>

<h3>secure_url</h3>

<p>Generate a fully qualified URL to a given path using HTTPS.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">secure_url</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
</pre></div>

<h3>url</h3>

<p>Generate a fully qualified URL to the given path.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="nx">$parameters</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(),</span> <span class="nx">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="miscellaneous"></a></p>

<h2>Miscellaneous</h2>

<h3>csrf_token</h3>

<p>Get the value of the current CSRF token.</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">csrf_token</span><span class="p">();</span>
</pre></div>

<h3>dd</h3>

<p>Dump the given variable and end execution of the script.</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
</pre></div>

<h3>value</h3>

<p>If the given value is a <code>Closure</code>, return the value returned by the <code>Closure</code>. Otherwise, return the value.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h3>with</h3>

<p>Return the given object. Useful for method chaining constructors in PHP 5.3.x.</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="k">new</span> <span class="nx">Foo</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">doWork</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Homestead</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#included-software">Included Software</a></li>
<li><a href="#installation-and-setup">Installation &amp; Setup</a></li>
<li><a href="#daily-usage">Daily Usage</a></li>
<li><a href="#ports">Ports</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel strives to make the entire PHP development experience delightful, including your local development environment. <a href="http://vagrantup.com">Vagrant</a> provides a simple, elegant way to manage and provision Virtual Machines.</p>

<p>Laravel Homestead is an official, pre-packaged Vagrant &quot;box&quot; that provides you a wonderful development environment without requiring you to install PHP, HHVM, a web server, and any other server software on your local machine. No more worrying about messing up your operating system! Vagrant boxes are completely disposable. If something goes wrong, you can destroy and re-create the box in minutes!</p>

<p>Homestead runs on any Windows, Mac, or Linux system, and includes the Nginx web server, PHP 5.6, MySQL, Postgres, Redis, Memcached, and all of the other goodies you need to develop amazing Laravel applications.</p>

<blockquote>
<p><strong>Note:</strong> If you are using Windows, you may need to enable hardware virtualization (VT-x). It can usually be enabled via your BIOS.</p>
</blockquote>

<p>Homestead is currently built and tested using Vagrant 1.6.</p>

<p><a name="included-software"></a></p>

<h2>Included Software</h2>

<ul>
<li>Ubuntu 14.04</li>
<li>PHP 5.6</li>
<li>HHVM</li>
<li>Nginx</li>
<li>MySQL</li>
<li>Postgres</li>
<li>Node (With Bower, Grunt, and Gulp)</li>
<li>Redis</li>
<li>Memcached</li>
<li>Beanstalkd</li>
<li><a href="/docs/4.2/ssh#envoy-task-runner">Laravel Envoy</a></li>
<li>Fabric + HipChat Extension</li>
</ul>

<p><a name="installation-and-setup"></a></p>

<h2>Installation &amp; Setup</h2>

<h3>Installing VirtualBox &amp; Vagrant</h3>

<p>Before launching your Homestead environment, you must install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> and <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>. Both of these software packages provide easy-to-use visual installers for all popular operating systems.</p>

<h3>Adding The Vagrant Box</h3>

<p>Once VirtualBox and Vagrant have been installed, you should add the <code>laravel/homestead</code> box to your Vagrant installation using the following command in your terminal. It will take a few minutes to download the box, depending on your Internet connection speed:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span>
</pre></div>

<p>If this fails, you may have an older version of vagrant that requires the url of the box. The following should work:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//atlas.hashicorp.com/laravel/boxes/homestead</span>
</pre></div>

<h3>Installing Homestead</h3>

<h4>With Composer + PHP Tool</h4>

<p>Once the box has been added to your Vagrant installation, you are ready to install the Homestead CLI tool using the Composer <code>global</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/homestead=~2.0&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>homestead</code> executable is found when you run the <code>homestead</code> command in your terminal.</p>

<p>Once you have installed the Homestead CLI tool, run the <code>init</code> command to create the <code>Homestead.yaml</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">homestead</span> <span class="nx">init</span>
</pre></div>

<p>The <code>Homestead.yaml</code> file will be placed in the <code>~/.homestead</code> directory. If you&#39;re using a Mac or Linux system, you may edit <code>Homestead.yaml</code> file by running the <code>homestead edit</code> command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">homestead</span> <span class="nx">edit</span>
</pre></div>

<h4>Manually Via Git (No Local PHP)</h4>

<p>Alternatively, if you do not want to install PHP on your local machine, you may install Homestead manually by simply cloning the repository. Consider cloning the repository into a central <code>Homestead</code> directory where you keep all of your Laravel projects, as the Homestead box will serve as the host to all of your Laravel (and PHP) projects:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/homestead.git Homestead</span>
</pre></div>

<p>Once you have installed the Homestead CLI tool, run the <code>bash init.sh</code> command to create the <code>Homestead.yaml</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">bash</span> <span class="nx">init</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>

<p>The <code>Homestead.yaml</code> file will be placed in the <code>~/.homestead</code> directory.</p>

<h3>Set Your SSH Key</h3>

<p>Next, you should edit the <code>Homestead.yaml</code> file. In this file, you can configure the path to your public SSH key, as well as the folders you wish to be shared between your main machine and the Homestead virtual machine.</p>

<p>Don&#39;t have an SSH key? On Mac and Linux, you can generally create an SSH key pair using the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span> <span class="o">-</span><span class="nx">C</span> <span class="s2">&quot;you@homestead&quot;</span>
</pre></div>

<p>On Windows, you may install <a href="http://git-scm.com/">Git</a> and use the <code>Git Bash</code> shell included with Git to issue the command above. Alternatively, you may use <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">PuTTY</a> and <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">PuTTYgen</a>.</p>

<p>Once you have created a SSH key, specify the key&#39;s path in the <code>authorize</code> property of your <code>Homestead.yaml</code> file.</p>

<h3>Configure Your Shared Folders</h3>

<p>The <code>folders</code> property of the <code>Homestead.yaml</code> file lists all of the folders you wish to share with your Homestead environment. As files within these folders are changed, they will be kept in sync between your local machine and the Homestead environment. You may configure as many shared folders as necessary!</p>

<h3>Configure Your Nginx Sites</h3>

<p>Not familiar with Nginx? No problem. The <code>sites</code> property allows you to easily map a &quot;domain&quot; to a folder on your Homestead environment. A sample site configuration is included in the <code>Homestead.yaml</code> file. Again, you may add as many sites to your Homestead environment as necessary. Homestead can serve as a convenient, virtualized environment for every Laravel project you are working on!</p>

<p>You can make any Homestead site use <a href="http://hhvm.com">HHVM</a> by setting the <code>hhvm</code> option to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/Code/Laravel/public</span>
      <span class="nx">hhvm</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<h3>Bash Aliases</h3>

<p>To add Bash aliases to your Homestead box, simply add to the <code>aliases</code> file in the root of the <code>~/.homestead</code> directory.</p>

<h3>Launch The Vagrant Box</h3>

<p>Once you have edited the <code>Homestead.yaml</code> to your liking, run the <code>homestead up</code> command in your terminal. If you installed Homestead manually and are not using the PHP <code>homestead</code> tool, run <code>vagrant up</code> from the directory that contains your cloned Homestead Git repository.</p>

<p>Vagrant will boot the virtual machine, and configure your shared folders and Nginx sites automatically! To destroy the machine, you may use the <code>homestead destroy</code> command. For a complete list of available Homestead commands, run <code>homestead list</code>.</p>

<p>Don&#39;t forget to add the &quot;domains&quot; for your Nginx sites to the <code>hosts</code> file on your machine! The <code>hosts</code> file will redirect your requests for the local domains into your Homestead environment. On Mac and Linux, this file is located at <code>/etc/hosts</code>. On Windows, it is located at <code>C:\Windows\System32\drivers\etc\hosts</code>. The lines you add to this file will look like the following:</p>
<div class="highlight"><pre><span></span><span class="mf">192.168.10.10</span>  <span class="nx">homestead</span><span class="p">.</span><span class="nx">app</span>
</pre></div>

<p>Make sure the IP address listed is the one you set in your <code>Homestead.yaml</code> file. Once you have added the domain to your <code>hosts</code> file, you can access the site via your web browser!</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//homestead.app</span>
</pre></div>

<p>To learn how to connect to your databases, read on!</p>

<p><a name="daily-usage"></a></p>

<h2>Daily Usage</h2>

<h3>Connecting Via SSH</h3>

<p>To connect to your Homestead environment via SSH, issue the <code>homestead ssh</code> command in your terminal.</p>

<h3>Connecting To Your Databases</h3>

<p>A <code>homestead</code> database is configured for both MySQL and Postgres out of the box. For even more convenience, Laravel&#39;s <code>local</code> database configuration is set to use this database by default.</p>

<p>To connect to your MySQL or Postgres database from your main machine via Navicat or Sequel Pro, you should connect to <code>127.0.0.1</code> and port 33060 (MySQL) or 54320 (Postgres). The username and password for both databases is <code>homestead</code> / <code>secret</code>.</p>

<blockquote>
<p><strong>Note:</strong> You should only use these non-standard ports when connecting to the databases from your main machine. You will use the default 3306 and 5432 ports in your Laravel database configuration file since Laravel is running <em>within</em> the Virtual Machine.</p>
</blockquote>

<h3>Adding Additional Sites</h3>

<p>Once your Homestead environment is provisioned and running, you may want to add additional Nginx sites for your Laravel applications. You can run as many Laravel installations as you wish on a single Homestead environment. There are two ways to do this: First, you may simply add the sites to your <code>Homestead.yaml</code> file and then run <code>vagrant provision</code>.</p>

<p>Alternatively, you may use the <code>serve</code> script that is available on your Homestead environment. To use the <code>serve</code> script, SSH into your Homestead environment and run the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">serve</span> <span class="nx">domain</span><span class="p">.</span><span class="nx">app</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">vagrant</span><span class="o">/</span><span class="nx">Code</span><span class="o">/</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="kr">public</span><span class="o">/</span><span class="nx">directory</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> After running the <code>serve</code> command, do not forget to add the new site to the <code>hosts</code> file on your main machine!</p>
</blockquote>

<p><a name="ports"></a></p>

<h2>Ports</h2>

<p>The following ports are forwarded to your Homestead environment:</p>

<ul>
<li><strong>SSH:</strong> 2222 -&gt; Forwards To 22</li>
<li><strong>HTTP:</strong> 8000 -&gt; Forwards To 80</li>
<li><strong>MySQL:</strong> 33060 -&gt; Forwards To 3306</li>
<li><strong>Postgres:</strong> 54320 -&gt; Forwards To 5432</li>
</ul>
<div style="page-break-after: always;" ></div><h1>Forms &amp; HTML</h1>

<ul>
<li><a href="#opening-a-form">Opening A Form</a></li>
<li><a href="#csrf-protection">CSRF Protection</a></li>
<li><a href="#form-model-binding">Form Model Binding</a></li>
<li><a href="#labels">Labels</a></li>
<li><a href="#text">Text, Text Area, Password &amp; Hidden Fields</a></li>
<li><a href="#checkboxes-and-radio-buttons">Checkboxes and Radio Buttons</a></li>
<li><a href="#file-input">File Input</a></li>
<li><a href="#number">Number Input</a></li>
<li><a href="#drop-down-lists">Drop-Down Lists</a></li>
<li><a href="#buttons">Buttons</a></li>
<li><a href="#custom-macros">Custom Macros</a></li>
<li><a href="#generating-urls">Generating URLs</a></li>
</ul>

<p><a name="opening-a-form"></a></p>

<h2>Opening A Form</h2>

<h4>Opening A Form</h4>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo/bar&#39;</span><span class="p">))</span> <span class="p">}}</span>
    <span class="c1">//</span>
<span class="p">{{</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">close</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>By default, a <code>POST</code> method will be assumed; however, you are free to specify another method:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;put&#39;</span><span class="p">))</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Since HTML forms only support <code>POST</code> and <code>GET</code>, <code>PUT</code> and <code>DELETE</code> methods will be spoofed by automatically adding a <code>_method</code> hidden field to your form.</p>
</blockquote>

<p>You may also open forms that point to named routes or controller actions:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;route&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;route.name&#39;</span><span class="p">))</span>

<span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Controller@method&#39;</span><span class="p">))</span>
</pre></div>

<p>You may pass in route parameters as well:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;route&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;route.name&#39;</span><span class="p">,</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">)))</span>

<span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;action&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;Controller@method&#39;</span><span class="p">,</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">)))</span>
</pre></div>

<p>If your form is going to accept file uploads, add a <code>files</code> option to your array:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">open</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="s1">&#39;files&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">))</span>
</pre></div>

<p><a name="csrf-protection"></a></p>

<h2>CSRF Protection</h2>

<h4>Adding The CSRF Token To A Form</h4>

<p>Laravel provides an easy method of protecting your application from cross-site request forgeries. First, a random token is placed in your user&#39;s session. If you use the <code>Form::open</code> method with <code>POST</code>, <code>PUT</code> or <code>DELETE</code> the CSRF token will be added to your forms as a hidden field automatically. Alternatively, if you wish to generate the HTML for the hidden CSRF field, you may use the <code>token</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">token</span><span class="p">();</span>
</pre></div>

<h4>Attaching The CSRF Filter To A Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;csrf&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}));</span>
</pre></div>

<p><a name="form-model-binding"></a></p>

<h2>Form Model Binding</h2>

<h4>Opening A Model Form</h4>

<p>Often, you will want to populate a form based on the contents of a model. To do so, use the <code>Form::model</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">model</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;route&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;user.update&#39;</span><span class="p">,</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">)))</span>
</pre></div>

<p>Now, when you generate a form element, like a text input, the model&#39;s value matching the field&#39;s name will automatically be set as the field value. So, for example, for a text input named <code>email</code>, the user model&#39;s <code>email</code> attribute would be set as the value. However, there&#39;s more! If there is an item in the Session flash data matching the input name, that will take precedence over the model&#39;s value. So, the priority looks like this:</p>

<ol>
<li>Session Flash Data (Old Input)</li>
<li>Explicitly Passed Value</li>
<li>Model Attribute Data</li>
</ol>

<p>This allows you to quickly build forms that not only bind to model values, but easily re-populate if there is a validation error on the server!</p>

<blockquote>
<p><strong>Note:</strong> When using <code>Form::model</code>, be sure to close your form with <code>Form::close</code>!</p>
</blockquote>

<p><a name="labels"></a></p>

<h2>Labels</h2>

<h4>Generating A Label Element</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">label</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;E-Mail Address&#39;</span><span class="p">);</span>
</pre></div>

<h4>Specifying Extra HTML Attributes</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">label</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;E-Mail Address&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;class&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;awesome&#39;</span><span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> After creating a label, any form element you create with a name matching the label name will automatically receive an ID matching the label name as well.</p>
</blockquote>

<p><a name="text"></a></p>

<h2>Text, Text Area, Password &amp; Hidden Fields</h2>

<h4>Generating A Text Input</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>

<h4>Specifying A Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;example@gmail.com&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <em>hidden</em> and <em>textarea</em> methods have the same signature as the <em>text</em> method.</p>
</blockquote>

<h4>Generating A Password Input</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">password</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>

<h4>Generating Other Inputs</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">email</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
<span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$attributes</span> <span class="o">=</span> <span class="nx">array</span><span class="p">());</span>
</pre></div>

<p><a name="checkboxes-and-radio-buttons"></a></p>

<h2>Checkboxes and Radio Buttons</h2>

<h4>Generating A Checkbox Or Radio Input</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">checkbox</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">radio</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h4>Generating A Checkbox Or Radio Input That Is Checked</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">checkbox</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">radio</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="number"></a></p>

<h2>Number</h2>

<h4>Generating A Number Input</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">number</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="file-input"></a></p>

<h2>File Input</h2>

<h4>Generating A File Input</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The form must have been opened with the <code>files</code> option set to <code>true</code>.</p>
</blockquote>

<p><a name="drop-down-lists"></a></p>

<h2>Drop-Down Lists</h2>

<h4>Generating A Drop-Down List</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Large&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Small&#39;</span><span class="p">));</span>
</pre></div>

<h4>Generating A Drop-Down List With Selected Default</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Large&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Small&#39;</span><span class="p">),</span> <span class="s1">&#39;S&#39;</span><span class="p">);</span>
</pre></div>

<h4>Generating A Grouped List</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;animal&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;Cats&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;leopard&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Leopard&#39;</span><span class="p">),</span>
    <span class="s1">&#39;Dogs&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;spaniel&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Spaniel&#39;</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>

<h4>Generating A Drop-Down List With A Range</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">selectRange</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</pre></div>

<h4>Generating A List With Month Names</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">selectMonth</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="buttons"></a></p>

<h2>Buttons</h2>

<h4>Generating A Submit Button</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">submit</span><span class="p">(</span><span class="s1">&#39;Click Me!&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Need to create a button element? Try the <em>button</em> method. It has the same signature as <em>submit</em>.</p>
</blockquote>

<p><a name="custom-macros"></a></p>

<h2>Custom Macros</h2>

<h4>Registering A Form Macro</h4>

<p>It&#39;s easy to define your own custom Form class helpers called &quot;macros&quot;. Here&#39;s how it works. First, simply register the macro with a given name and a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">Form</span><span class="o">::</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;myField&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;input type=&quot;awesome&quot;&gt;&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Now you can call your macro using its name:</p>

<h4>Calling A Custom Form Macro</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Form</span><span class="o">::</span><span class="nx">myField</span><span class="p">();</span>
</pre></div>

<p><a name="generating-urls"></a></p>

<h2>Generating URLs</h2>

<p>For more information on generating URL&#39;s, check out the documentation on <a href="/docs/4.2/helpers#urls">helpers</a>.</p>
<div style="page-break-after: always;" ></div><h1>Installation</h1>

<ul>
<li><a href="#install-composer">Install Composer</a></li>
<li><a href="#install-laravel">Install Laravel</a></li>
<li><a href="#server-requirements">Server Requirements</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#pretty-urls">Pretty URLs</a></li>
</ul>

<p><a name="install-composer"></a></p>

<h2>Install Composer</h2>

<p>Laravel utilizes <a href="http://getcomposer.org">Composer</a> to manage its dependencies. First, download a copy of the <code>composer.phar</code>. Once you have the PHAR archive, you can either keep it in your local project directory or move to <code>usr/local/bin</code> to use it globally on your system. On Windows, you can use the Composer <a href="https://getcomposer.org/Composer-Setup.exe">Windows installer</a>.</p>

<p><a name="install-laravel"></a></p>

<h2>Install Laravel</h2>

<h3>Via Laravel Installer</h3>

<p>First, download the Laravel installer using Composer.</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/installer=~1.1&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>laravel</code> executable is found when you run the <code>laravel</code> command in your terminal.</p>

<p>Once installed, the simple <code>laravel new</code> command will create a fresh Laravel installation in the directory you specify. For instance, <code>laravel new blog</code> would create a directory named <code>blog</code> containing a fresh Laravel installation with all dependencies installed. This method of installation is much faster than installing via Composer.</p>

<h3>Via Composer Create-Project</h3>

<p>You may also install Laravel by issuing the Composer <code>create-project</code> command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="p">{</span><span class="nx">directory</span><span class="p">}</span> <span class="mf">4.2</span> <span class="o">--</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">dist</span>
</pre></div>

<h3>Via Download</h3>

<p>Once Composer is installed, download the <a href="https://github.com/laravel/laravel/archive/v4.2.11.zip">4.2 version</a> of the Laravel framework and extract its contents into a directory on your server. Next, in the root of your Laravel application, run the <code>php composer.phar install</code> (or <code>composer install</code>) command to install all of the framework&#39;s dependencies. This process requires Git to be installed on the server to successfully complete the installation.</p>

<p>If you want to update the Laravel framework, you may issue the <code>php composer.phar update</code> command.</p>

<p><a name="server-requirements"></a></p>

<h2>Server Requirements</h2>

<p>The Laravel framework has a few system requirements:</p>

<ul>
<li>PHP &gt;= 5.4</li>
<li>MCrypt PHP Extension</li>
</ul>

<p>As of PHP 5.5, some OS distributions may require you to manually install the PHP JSON extension. When using Ubuntu, this can be done via <code>apt-get install php5-json</code>.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The first thing you should do after installing Laravel is set your application key to a random string. If you installed Laravel via Composer, this key has probably already been set for you by the <code>key:generate</code> command. Typically, this string should be 32 characters long. The key can be set in the <code>app.php</code> configuration file. <strong>If the application key is not set, your user sessions and other encrypted data will not be secure.</strong></p>

<p>Laravel needs almost no other configuration out of the box. You are free to get started developing! However, you may wish to review the <code>app/config/app.php</code> file and its documentation. It contains several options such as <code>timezone</code> and <code>locale</code> that you may wish to change according to your application.</p>

<p>Once Laravel is installed, you should also <a href="/docs/4.2/configuration#environment-configuration">configure your local environment</a>. This will allow you to receive detailed error messages when developing on your local machine. By default, detailed error reporting is disabled in your production configuration file.</p>

<blockquote>
<p><strong>Note:</strong> You should never have <code>app.debug</code> set to <code>true</code> for a production application. Never, ever do it.</p>
</blockquote>

<p><a name="permissions"></a></p>

<h3>Permissions</h3>

<p>Laravel may require one set of permissions to be configured: folders within <code>app/storage</code> require write access by the web server.</p>

<p><a name="paths"></a></p>

<h3>Paths</h3>

<p>Several of the framework directory paths are configurable. To change the location of these directories, check out the <code>bootstrap/paths.php</code> file.</p>

<p><a name="pretty-urls"></a></p>

<h2>Pretty URLs</h2>

<h3>Apache</h3>

<p>The framework ships with a <code>public/.htaccess</code> file that is used to allow URLs without <code>index.php</code>. If you use Apache to serve your Laravel application, be sure to enable the <code>mod_rewrite</code> module.</p>

<p>If the <code>.htaccess</code> file that ships with Laravel does not work with your Apache installation, try this one:</p>
<div class="highlight"><pre><span></span><span class="nx">Options</span> <span class="o">+</span><span class="nx">FollowSymLinks</span>
<span class="nx">RewriteEngine</span> <span class="nx">On</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">d</span>
<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">f</span>
<span class="nx">RewriteRule</span> <span class="o">^</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span> <span class="p">[</span><span class="nx">L</span><span class="p">]</span>
</pre></div>

<h3>Nginx</h3>

<p>On Nginx, the following directive in your site configuration will allow &quot;pretty&quot; URLs:</p>
<div class="highlight"><pre><span></span><span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Introduction</h1>

<ul>
<li><a href="#where-to-start">Where To Start</a></li>
<li><a href="#laravel-philosophy">Laravel Philosophy</a></li>
</ul>

<p><a name="where-to-start"></a></p>

<h2>Where To Start</h2>

<p>Learning a new framework can be daunting, but it&#39;s also exciting. To smooth your transition, we&#39;ve attempted to create very clear, concise documentation for Laravel. Here are some recommendations for what to read first:</p>

<ul>
<li><a href="/docs/4.2/installation">Installation</a> and <a href="/docs/4.2/configuration">Configuration</a></li>
<li><a href="/docs/4.2/routing">Routing</a></li>
<li><a href="/docs/4.2/requests">Requests &amp; Input</a></li>
<li><a href="/docs/4.2/responses">Views &amp; Responses</a></li>
<li><a href="/docs/4.2/controllers">Controllers</a></li>
</ul>

<p>After reading through these documents, you should have a good grasp on basic request / response handling in Laravel. Next, you may wish to read about <a href="/docs/4.2/database">configuring your database</a>, the <a href="/docs/4.2/queries">fluent query builder</a>, and the <a href="/docs/4.2/eloquent">Eloquent ORM</a>. Or, you may wish to read about <a href="/docs/4.2/security">authentication and security</a> so you can start signing people into your application.</p>

<p><a name="laravel-philosophy"></a></p>

<h2>Laravel Philosophy</h2>

<p>Laravel is a web application framework with expressive, elegant syntax. We believe development must be an enjoyable, creative experience to be truly fulfilling. Laravel attempts to take the pain out of development by easing common tasks used in the majority of web projects, such as authentication, routing, sessions, and caching.</p>

<p>Laravel aims to make the development process a pleasing one for the developer without sacrificing application functionality. Happy developers make the best code. To this end, we&#39;ve attempted to combine the very best of what we have seen in other web frameworks, including frameworks implemented in other languages, such as Ruby on Rails, ASP.NET MVC, and Sinatra.</p>

<p>Laravel is accessible, yet powerful, providing powerful tools needed for large, robust applications. A superb inversion of control container, expressive migration system, and tightly integrated unit testing support give you the tools you need to build any application with which you are tasked.</p>
<div style="page-break-after: always;" ></div><h1>IoC Container</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#where-to-register">Where To Register Bindings</a></li>
<li><a href="#automatic-resolution">Automatic Resolution</a></li>
<li><a href="#practical-usage">Practical Usage</a></li>
<li><a href="#service-providers">Service Providers</a></li>
<li><a href="#container-events">Container Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel inversion of control container is a powerful tool for managing class dependencies. Dependency injection is a method of removing hard-coded class dependencies. Instead, the dependencies are injected at run-time, allowing for greater flexibility as dependency implementations may be swapped easily.</p>

<p>Understanding the Laravel IoC container is essential to building a powerful, large application, as well as for contributing to the Laravel core itself.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Binding A Type Into The Container</h4>

<p>There are two ways the IoC container can resolve dependencies: via Closure callbacks or automatic resolution. First, we&#39;ll explore Closure callbacks. First, a &quot;type&quot; may be bound into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$app</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Resolving A Type From The Container</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p>When the <code>App::make</code> method is called, the Closure callback is executed and the result is returned.</p>

<h4>Binding A &quot;Shared&quot; Type Into The Container</h4>

<p>Sometimes, you may wish to bind something into the container that should only be resolved once, and the same instance should be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">singleton</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">FooBar</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Binding An Existing Instance Into The Container</h4>

<p>You may also bind an existing object instance into the container using the <code>instance</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">;</span>

<span class="nx">App</span><span class="o">::</span><span class="nx">instance</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">$foo</span><span class="p">);</span>
</pre></div>

<p><a name="where-to-register"></a></p>

<h2>Where To Register Bindings</h2>

<p>IoC bindings, like event handlers or route filters, generally fall under the title of &quot;bootstrap code&quot;. In other words, they prepare your application to actually handle requests, and usually need to be executed before a route or controller is actually called. Like most other bootstrap code, the <code>start</code> files are always an option for registering IoC bindings. Alternatively, you could create an <code>app/ioc.php</code> (filename does not matter) file and require that file from your <code>start</code> file.</p>

<p>If your application has a very large number of IoC bindings, or you simply wish to organize your IoC bindings in separate files by category, you may register your bindings in a <a href="#service-providers">service provider</a>.</p>

<p><a name="automatic-resolution"></a></p>

<h2>Automatic Resolution</h2>

<h4>Resolving A Class</h4>

<p>The IoC container is powerful enough to resolve classes without any configuration at all in many scenarios. For example:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">FooBar</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">Baz</span> <span class="nx">$baz</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">baz</span> <span class="o">=</span> <span class="nx">$baz</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="nx">$fooBar</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;FooBar&#39;</span><span class="p">);</span>
</pre></div>

<p>Note that even though we did not register the FooBar class in the container, the container will still be able to resolve the class, even injecting the <code>Baz</code> dependency automatically!</p>

<p>When a type is not bound in the container, it will use PHP&#39;s Reflection facilities to inspect the class and read the constructor&#39;s type-hints. Using this information, the container can automatically build an instance of the class.</p>

<h4>Binding An Interface To An Implementation</h4>

<p>However, in some cases, a class may depend on an interface implementation, not a &quot;concrete type&quot;. When this is the case, the <code>App::bind</code> method must be used to inform the container which interface implementation to inject:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;UserRepositoryInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;DbUserRepository&#39;</span><span class="p">);</span>
</pre></div>

<p>Now consider the following controller:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">UserRepositoryInterface</span> <span class="nx">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">$users</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Since we have bound the <code>UserRepositoryInterface</code> to a concrete type, the <code>DbUserRepository</code> will automatically be injected into this controller when it is created.</p>

<p><a name="practical-usage"></a></p>

<h2>Practical Usage</h2>

<p>Laravel provides several opportunities to use the IoC container to increase the flexibility and testability of your application. One primary example is when resolving controllers. All controllers are resolved through the IoC container, meaning you can type-hint dependencies in a controller constructor, and they will automatically be injected.</p>

<h4>Type-Hinting Controller Dependencies</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">OrderController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">OrderRepository</span> <span class="nx">$orders</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">orders</span> <span class="o">=</span> <span class="nx">$orders</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$all</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">orders</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>In this example, the <code>OrderRepository</code> class will automatically be injected into the controller. This means that when <a href="/docs/4.2/testing">unit testing</a> a &quot;mock&quot; <code>OrderRepository</code> may be bound into the container and injected into the controller, allowing for painless stubbing of database layer interaction.</p>

<h4>Other Examples Of IoC Usage</h4>

<p><a href="/docs/4.2/routing#route-filters">Filters</a>, <a href="/docs/4.2/responses#view-composers">composers</a>, and <a href="/docs/4.2/events#using-classes-as-listeners">event handlers</a> may also be resolved out of the IoC container. When registering them, simply give the name of the class that should be used:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooFilter&#39;</span><span class="p">);</span>

<span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooComposer&#39;</span><span class="p">);</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooHandler&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="service-providers"></a></p>

<h2>Service Providers</h2>

<p>Service providers are a great way to group related IoC registrations in a single location. Think of them as a way to bootstrap components in your application. Within a service provider, you might register a custom authentication driver, register your application&#39;s repository classes with the IoC container, or even setup a custom Artisan command.</p>

<p>In fact, most of the core Laravel components include service providers. All of the registered service providers for your application are listed in the <code>providers</code> array of the <code>app/config/app.php</code> configuration file.</p>

<h4>Defining A Service Provider</h4>

<p>To create a service provider, simply extend the <code>Illuminate\Support\ServiceProvider</code> class and define a <code>register</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">FooServiceProvider</span> <span class="kr">extends</span> <span class="nx">ServiceProvider</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Note that in the <code>register</code> method, the application IoC container is available to you via the <code>$this-&gt;app</code> property. Once you have created a provider and are ready to register it with your application, simply add it to the <code>providers</code> array in your <code>app</code> configuration file.</p>

<h4>Registering A Service Provider At Run-Time</h4>

<p>You may also register a service provider at run-time using the <code>App::register</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;FooServiceProvider&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="container-events"></a></p>

<h2>Container Events</h2>

<h4>Registering A Resolving Listener</h4>

<p>The container fires an event each time it resolves an object. You may listen to this event using the <code>resolving</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">resolvingAny</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$object</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">App</span><span class="o">::</span><span class="nx">resolving</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Note that the object that was resolved will be passed to the callback.</p>
<div style="page-break-after: always;" ></div><h1>Request Lifecycle</h1>

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#request-lifecycle">Request Lifecycle</a></li>
<li><a href="#start-files">Start Files</a></li>
<li><a href="#application-events">Application Events</a></li>
</ul>

<p><a name="overview"></a></p>

<h2>Overview</h2>

<p>When using any tool in the &quot;real world&quot;, you feel more confident if you understand how that tool works. Application development is no different. When you understand how your development tools function, you feel more comfortable and confident using them. The goal of this document is to give you a good, high-level overview of how the Laravel framework &quot;works&quot;. By getting to know the overall framework better, everything feels less &quot;magical&quot; and you will be more confident building your applications. In addition to a high-level overview of the request lifecycle, we&#39;ll cover &quot;start&quot; files and application events.</p>

<p>If you don&#39;t understand all of the terms right away, don&#39;t lose heart! Just try to get a basic grasp of what is going on, and your knowledge will grow as you explore other sections of the documentation.</p>

<p><a name="request-lifecycle"></a></p>

<h2>Request Lifecycle</h2>

<p>All requests into your application are directed through the <code>public/index.php</code> script. When using Apache, the <code>.htaccess</code> file that ships with Laravel handles the passing of all requests to <code>index.php</code>. From here, Laravel begins the process of handling the requests and returning a response to the client. Getting a general idea for the Laravel bootstrap process will be useful, so we&#39;ll cover that now!</p>

<p>By far, the most important concept to grasp when learning about Laravel&#39;s bootstrap process is <strong>Service Providers</strong>. You can find a list of service providers by opening your <code>app/config/app.php</code> configuration file and finding the <code>providers</code> array. These providers serve as the primary bootstrapping mechanism for Laravel. But, before we dig into service providers, let&#39;s go back to <code>index.php</code>. After a request enters your <code>index.php</code> file, the <code>bootstrap/start.php</code> file will be loaded. This file creates the new Laravel <code>Application</code> object, which also serves as an <a href="/docs/4.2/ioc">IoC container</a>.</p>

<p>After creating the <code>Application</code> object, a few project paths will be set and <a href="/docs/4.2/configuration#environment-configuration">environment detection</a> will be performed. Then, an internal Laravel bootstrap script will be called. This file lives deep within the Laravel source, and sets a few more settings based on your configuration files, such as timezone, error reporting, etc. But, in addition to setting these rather trivial configuration options, it also does something very important: registers all of the service providers configured for your application.</p>

<p>Simple service providers only have one method: <code>register</code>. This <code>register</code> method is called when the service provider is registered with the application object via the application&#39;s own <code>register</code> method. Within this method, service providers register things with the <a href="/docs/4.2/ioc">IoC container</a>. Essentially, each service provider binds one or more <a href="http://us3.php.net/manual/en/functions.anonymous.php">closures</a> into the container, which allows you to access those bound services within your application. So, for example, the <code>QueueServiceProvider</code> registers closures that resolve the various <a href="/docs/4.2/queues">Queue</a> related classes. Of course, service providers may be used for any bootstrapping task, not just registering things with the IoC container. A service provider may register event listeners, view composers, Artisan commands, and more.</p>

<p>After all of the service providers have been registered, your <code>app/start</code> files will be loaded. Lastly, your <code>app/routes.php</code> file will be loaded. Once your <code>routes.php</code> file has been loaded, the Request object is sent to the application so that it may be dispatched to a route.</p>

<p>So, let&#39;s summarize:</p>

<ol>
<li>Request enters <code>public/index.php</code> file.</li>
<li><code>bootstrap/start.php</code> file creates Application and detects environment.</li>
<li>Internal <code>framework/start.php</code> file configures settings and loads service providers.</li>
<li>Application <code>app/start</code> files are loaded.</li>
<li>Application <code>app/routes.php</code> file is loaded.</li>
<li>Request object sent to Application, which returns Response object.</li>
<li>Response object sent back to client.</li>
</ol>

<p>Now that you have a good idea of how a request to a Laravel application is handled, let&#39;s take a closer look at &quot;start&quot; files!</p>

<p><a name="start-files"></a></p>

<h2>Start Files</h2>

<p>Your application&#39;s start files are stored at <code>app/start</code>. By default, three are included with your application: <code>global.php</code>, <code>local.php</code>, and <code>artisan.php</code>. For more information about <code>artisan.php</code>, refer to the documentation on the <a href="/docs/4.2/commands#registering-commands">Artisan command line</a>.</p>

<p>The <code>global.php</code> start file contains a few basic items by default, such as the registration of the <a href="/docs/4.2/errors">Logger</a> and the inclusion of your <code>app/filters.php</code> file. However, you are free to add anything to this file that you wish. It will be automatically included on <em>every</em> request to your application, regardless of environment. The <code>local.php</code> file, on the other hand, is only called when the application is executing in the <code>local</code> environment. For more information on environments, check out the <a href="/docs/4.2/configuration">configuration</a> documentation.</p>

<p>Of course, if you have other environments in addition to <code>local</code>, you may create start files for those environments as well. They will be automatically included when your application is running in that environment. So, for example, if you have a <code>development</code> environment configured in your <code>bootstrap/start.php</code> file, you may create a <code>app/start/development.php</code> file, which will be included when any requests enter the application in that environment.</p>

<h3>What To Place In Start Files</h3>

<p>Start files serve as a simple place to place any &quot;bootstrapping&quot; code. For example, you could register a View composer, configure your logging preferences, set some PHP settings, etc. It&#39;s totally up to you. Of course, throwing all of your bootstrapping code into your start files can get messy. For large applications, or if you feel your start files are getting messy, consider moving some bootstrapping code into <a href="/docs/4.2/ioc#service-providers">service providers</a>.</p>

<p><a name="application-events"></a></p>

<h2>Application Events</h2>

<h4>Registering Application Events</h4>

<p>You may also do pre and post request processing by registering <code>before</code>, <code>after</code>, <code>finish</code>, and <code>shutdown</code> application events:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">App</span><span class="o">::</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">$response</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Listeners to these events will be run <code>before</code> and <code>after</code> each request to your application. These events can be helpful for global filtering or global modification of responses. You may register them in one of your <code>start</code> files or in a <a href="/docs/4.2/ioc#service-providers">service provider</a>.</p>

<p>You may also register a listener on the <code>matched</code> event, which is fired when an incoming request has been matched to a route but that route has not yet been executed:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">matched</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>The <code>finish</code> event is called after the response from your application has been sent back to the client. This is a good place to do any last minute processing your application requires. The <code>shutdown</code> event is called immediately after all of the <code>finish</code> event handlers finish processing, and is the last opportunity to do any work before the script terminates. Most likely, you will not have a need to use either of these events.</p>
<div style="page-break-after: always;" ></div><h1>Localization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#language-files">Language Files</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#pluralization">Pluralization</a></li>
<li><a href="#validation">Validation Localization</a></li>
<li><a href="#overriding-package-language-files">Overriding Package Language Files</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Lang</code> class provides a convenient way of retrieving strings in various languages, allowing you to easily support multiple languages within your application.</p>

<p><a name="language-files"></a></p>

<h2>Language Files</h2>

<p>Language strings are stored in files within the <code>app/lang</code> directory. Within this directory there should be a subdirectory for each language supported by the application.</p>
<div class="highlight"><pre><span></span><span class="err">/app</span>
    <span class="err">/lang</span>
        <span class="err">/en</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
        <span class="o">/</span><span class="nx">es</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
</pre></div>

<h4>Example Language File</h4>

<p>Language files simply return an array of keyed strings. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;welcome&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to our application&#39;</span>
<span class="p">);</span>
</pre></div>

<h4>Changing The Default Language At Runtime</h4>

<p>The default language for your application is stored in the <code>app/config/app.php</code> configuration file. You may change the active language at any time using the <code>App::setLocale</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">setLocale</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">);</span>
</pre></div>

<h4>Setting The Fallback Language</h4>

<p>You may also configure a &quot;fallback language&quot;, which will be used when the active language does not contain a given language line. Like the default language, the fallback language is also configured in the <code>app/config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;fallback_locale&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Retrieving Lines From A Language File</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<p>The first segment of the string passed to the <code>get</code> method is the name of the language file, and the second is the name of the line that should be retrieved.</p>

<blockquote>
<p><strong>Note:</strong> If a language line does not exist, the key will be returned by the <code>get</code> method.</p>
</blockquote>

<p>You may also use the <code>trans</code> helper function, which is an alias for the <code>Lang::get</code> method.</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<h4>Making Replacements In Lines</h4>

<p>You may also define place-holders in your language lines:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;welcome&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Welcome, :name&#39;</span><span class="p">,</span>
</pre></div>

<p>Then, pass a second argument of replacements to the <code>Lang::get</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">));</span>
</pre></div>

<h4>Determine If A Language File Contains A Line</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Lang</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="pluralization"></a></p>

<h2>Pluralization</h2>

<p>Pluralization is a complex problem, as different languages have a variety of complex rules for pluralization. You may easily manage this in your language files. By using a &quot;pipe&quot; character, you may separate the singular and plural forms of a string:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;There is one apple|There are many apples&#39;</span><span class="p">,</span>
</pre></div>

<p>You may then use the <code>Lang::choice</code> method to retrieve the line:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;messages.apples&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>You may also supply a locale argument to specify the language. For example, if you want to use the Russian (ru) language:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">Lang</span><span class="o">::</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;товар|товара|товаров&#39;</span><span class="p">,</span> <span class="nx">$count</span><span class="p">,</span> <span class="nx">array</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">);</span>
</pre></div>

<p>Since the Laravel translator is powered by the Symfony Translation component, you may also create more explicit pluralization rules easily:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{0} There are none|[1,19] There are some|[20,Inf] There are many&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="validation"></a></p>

<h2>Validation</h2>

<p>For localization for validation errors and messages, take a look at the <a href="/docs/4.2/validation#localization">documentation on Validation</a>.</p>

<p><a name="overriding-package-language-files"></a></p>

<h2>Overriding Package Language Files</h2>

<p>Many packages ship with their own language lines. Instead of hacking the package&#39;s core files to tweak these lines, you may override them by placing files in the <code>app/lang/packages/{locale}/{package}</code> directory. So, for example, if you need to override the English language lines in <code>messages.php</code> for a package named <code>skyrim/hearthfire</code>, you would place a language file at: <code>app/lang/packages/en/hearthfire/messages.php</code>. In this file you would define only the language lines you wish to override. Any language lines you don&#39;t override will still be loaded from the package&#39;s language files.</p>
<div style="page-break-after: always;" ></div><h1>Mail</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#embedding-inline-attachments">Embedding Inline Attachments</a></li>
<li><a href="#queueing-mail">Queueing Mail</a></li>
<li><a href="#mail-and-local-development">Mail &amp; Local Development</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides a clean, simple API over the popular <a href="http://swiftmailer.org">SwiftMailer</a> library. The mail configuration file is <code>app/config/mail.php</code>, and contains options allowing you to change your SMTP host, port, and credentials, as well as set a global <code>from</code> address for all messages delivered by the library. You may use any SMTP server you wish. If you wish to use the PHP <code>mail</code> function to send mail, you may change the <code>driver</code> to <code>mail</code> in the configuration file. A <code>sendmail</code> driver is also available.</p>

<h3>API Drivers</h3>

<p>Laravel also includes drivers for the Mailgun and Mandrill HTTP APIs. These APIs are often simpler and quicker than the SMTP servers. Both of these drivers require that the Guzzle 4 HTTP library be installed into your application. You can add Guzzle 4 to your project by adding the following line to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;guzzlehttp/guzzle&quot;</span><span class="o">:</span> <span class="s2">&quot;~4.0&quot;</span>
</pre></div>

<h4>Mailgun Driver</h4>

<p>To use the Mailgun driver, set the <code>driver</code> option to <code>mailgun</code> in your <code>app/config/mail.php</code> configuration file. Next, create an <code>app/config/services.php</code> configuration file if one does not already exist for your project. Verify that it contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mailgun&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-key&#39;</span><span class="p">,</span>
<span class="p">),</span>
</pre></div>

<h4>Mandrill Driver</h4>

<p>To use the Mandrill driver, set the <code>driver</code> option to <code>mandrill</code> in your <code>app/config/mail.php</code> configuration file. Next, create an <code>app/config/services.php</code> configuration file if one does not already exist for your project. Verify that it contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mandrill&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mandrill-key&#39;</span><span class="p">,</span>
<span class="p">),</span>
</pre></div>

<h3>Log Driver</h3>

<p>If the <code>driver</code> option of your <code>app/config/mail.php</code> configuration file is set to <code>log</code>, all e-mails will be written to your log files, and will not actually be sent to any of the recipients. This is primarily useful for quick, local debugging and content verification.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>The <code>Mail::send</code> method may be used to send an e-mail message:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>send</code> method is the name of the view that should be used as the e-mail body. The second is the data to be passed to the view, often as an associative array where the data items are available to the view by <code>$key</code>. The third is a Closure allowing you to specify various options on the e-mail message.</p>

<blockquote>
<p><strong>Note:</strong> A <code>$message</code> variable is always passed to e-mail views, and allows the inline embedding of attachments. So, it is best to avoid passing a <code>message</code> variable in your view payload.</p>
</blockquote>

<p>You may also specify a plain text view to use in addition to an HTML view:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;html.view&#39;</span><span class="p">,</span> <span class="s1">&#39;text.view&#39;</span><span class="p">),</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>Or, you may specify only one type of view using the <code>html</code> or <code>text</code> keys:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;text&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>You may specify other options on the e-mail message such as any carbon copies or attachments as well:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;us@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="s1">&#39;bar@example.com&#39;</span><span class="p">);</span>

    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When attaching files to a message, you may also specify a MIME type and / or a display name:</p>
<div class="highlight"><pre><span></span><span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="nx">$display</span><span class="p">,</span> <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="nx">$mime</span><span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The message instance passed to a <code>Mail::send</code> Closure extends the SwiftMailer message class, allowing you to call any method on that class to build your e-mail messages.</p>
</blockquote>

<p><a name="embedding-inline-attachments"></a></p>

<h2>Embedding Inline Attachments</h2>

<p>Embedding inline images into your e-mails is typically cumbersome; however, Laravel provides a convenient way to attach images to your e-mails and retrieving the appropriate CID.</p>

<h4>Embedding An Image In An E-Mail View</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embed</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<h4>Embedding Raw Data In An E-Mail View</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">from</span> <span class="nx">raw</span> <span class="nx">data</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">embedData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<p>Note that the <code>$message</code> variable is always passed to e-mail views by the <code>Mail</code> class.</p>

<p><a name="queueing-mail"></a></p>

<h2>Queueing Mail</h2>

<h4>Queueing A Mail Message</h4>

<p>Since sending e-mail messages can drastically lengthen the response time of your application, many developers choose to queue e-mail messages for background sending. Laravel makes this easy using its built-in <a href="/docs/4.2/queues">unified queue API</a>. To queue a mail message, simply use the <code>queue</code> method on the <code>Mail</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may also specify the number of seconds you wish to delay the sending of the mail message using the <code>later</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">later</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If you wish to specify a specific queue or &quot;tube&quot; on which to push the message, you may do so using the <code>queueOn</code> and <code>laterOn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">queueOn</span><span class="p">(</span><span class="s1">&#39;queue-name&#39;</span><span class="p">,</span> <span class="s1">&#39;emails.welcome&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Welcome!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="mail-and-local-development"></a></p>

<h2>Mail &amp; Local Development</h2>

<p>When developing an application that sends e-mail, it&#39;s usually desirable to disable the sending of messages from your local or development environment. To do so, you may either call the <code>Mail::pretend</code> method, or set the <code>pretend</code> option in the <code>app/config/mail.php</code> configuration file to <code>true</code>. When the mailer is in <code>pretend</code> mode, messages will be written to your application&#39;s log files instead of being sent to the recipient.</p>

<h4>Enabling Pretend Mail Mode</h4>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">pretend</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Migrations &amp; Seeding</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-migrations">Creating Migrations</a></li>
<li><a href="#running-migrations">Running Migrations</a></li>
<li><a href="#rolling-back-migrations">Rolling Back Migrations</a></li>
<li><a href="#database-seeding">Database Seeding</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Migrations are a type of version control for your database. They allow a team to modify the database schema and stay up to date on the current schema state. Migrations are typically paired with the <a href="/docs/4.2/schema">Schema Builder</a> to easily manage your application&#39;s schema.</p>

<p><a name="creating-migrations"></a></p>

<h2>Creating Migrations</h2>

<p>To create a migration, you may use the <code>migrate:make</code> command on the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">create_users_table</span>
</pre></div>

<p>The migration will be placed in your <code>app/database/migrations</code> folder, and will contain a timestamp which allows the framework to determine the order of the migrations.</p>

<p>You may also specify a <code>--path</code> option when creating the migration. The path should be relative to the root directory of your installation:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">foo</span> <span class="o">--</span><span class="nx">path</span><span class="o">=</span><span class="nx">app</span><span class="o">/</span><span class="nx">migrations</span>
</pre></div>

<p>The <code>--table</code> and <code>--create</code> options may also be used to indicate the name of the table, and whether the migration will be creating a new table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">add_votes_to_user_table</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">create_users_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">users</span>
</pre></div>

<p><a name="running-migrations"></a></p>

<h2>Running Migrations</h2>

<h4>Running All Outstanding Migrations</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h4>Running All Outstanding Migrations For A Path</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">path</span><span class="o">=</span><span class="nx">app</span><span class="o">/</span><span class="nx">foo</span><span class="o">/</span><span class="nx">migrations</span>
</pre></div>

<h4>Running All Outstanding Migrations For A Package</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="kr">package</span><span class="o">=</span><span class="nx">vendor</span><span class="o">/</span><span class="kr">package</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If you receive a &quot;class not found&quot; error when running migrations, try running the <code>composer dump-autoload</code> command.</p>
</blockquote>

<h3>Forcing Migrations In Production</h3>

<p>Some migration operations are destructive, meaning they may cause you to lose data. In order to protect you from running these commands against your production database, you will be prompted for confirmation before these commands are executed. To force the commands to run without a prompt, use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p><a name="rolling-back-migrations"></a></p>

<h2>Rolling Back Migrations</h2>

<h4>Rollback The Last Migration Operation</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">rollback</span>
</pre></div>

<h4>Rollback all migrations</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">reset</span>
</pre></div>

<h4>Rollback all migrations and run them all again</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p><a name="database-seeding"></a></p>

<h2>Database Seeding</h2>

<p>Laravel also includes a simple way to seed your database with test data using seed classes. All seed classes are stored in <code>app/database/seeds</code>. Seed classes may have any name you wish, but probably should follow some sensible convention, such as <code>UserTableSeeder</code>, etc. By default, a <code>DatabaseSeeder</code> class is defined for you. From this class, you may use the <code>call</code> method to run other seed classes, allowing you to control the seeding order.</p>

<h4>Example Database Seed Class</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">DatabaseSeeder</span> <span class="kr">extends</span> <span class="nx">Seeder</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;UserTableSeeder&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">command</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;User table seeded!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kr">class</span> <span class="nx">UserTableSeeder</span> <span class="kr">extends</span> <span class="nx">Seeder</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

        <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo@bar.com&#39;</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>To seed your database, you may use the <code>db:seed</code> command on the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span>
</pre></div>

<p>By default, the <code>db:seed</code> command runs the <code>DatabaseSeeder</code> class, which may be used to call other seed classes. However, you may use the <code>--class</code> option to specify a specific seeder class to run individually:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="kr">class</span><span class="o">=</span><span class="nx">UserTableSeeder</span>
</pre></div>

<p>You may also seed your database using the <code>migrate:refresh</code> command, which will also rollback and re-run all of your migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Package Development</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-a-package">Creating A Package</a></li>
<li><a href="#package-structure">Package Structure</a></li>
<li><a href="#service-providers">Service Providers</a></li>
<li><a href="#deferred-providers">Deferred Providers</a></li>
<li><a href="#package-conventions">Package Conventions</a></li>
<li><a href="#development-workflow">Development Workflow</a></li>
<li><a href="#package-routing">Package Routing</a></li>
<li><a href="#package-configuration">Package Configuration</a></li>
<li><a href="#package-views">Package Views</a></li>
<li><a href="#package-migrations">Package Migrations</a></li>
<li><a href="#package-assets">Package Assets</a></li>
<li><a href="#publishing-packages">Publishing Packages</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Packages are the primary way of adding functionality to Laravel. Packages might be anything from a great way to work with dates like <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, or an entire BDD testing framework like <a href="https://github.com/Behat/Behat">Behat</a>.</p>

<p>Of course, there are different types of packages. Some packages are stand-alone, meaning they work with any framework, not just Laravel. Both Carbon and Behat are examples of stand-alone packages. Any of these packages may be used with Laravel by simply requesting them in your <code>composer.json</code> file.</p>

<p>On the other hand, other packages are specifically intended for use with Laravel. In previous versions of Laravel, these types of packages were called &quot;bundles&quot;. These packages may have routes, controllers, views, configuration, and migrations specifically intended to enhance a Laravel application. As no special process is needed to develop stand-alone packages, this guide primarily covers the development of those that are Laravel specific.</p>

<p>All Laravel packages are distributed via <a href="http://packagist.org">Packagist</a> and <a href="http://getcomposer.org">Composer</a>, so learning about these wonderful PHP package distribution tools is essential.</p>

<p><a name="creating-a-package"></a></p>

<h2>Creating A Package</h2>

<p>The easiest way to create a new package for use with Laravel is the <code>workbench</code> Artisan command. First, you will need to set a few options in the <code>app/config/workbench.php</code> file. In that file, you will find a <code>name</code> and <code>email</code> option. These values will be used to generate a <code>composer.json</code> file for your new package. Once you have supplied those values, you are ready to build a workbench package!</p>

<h4>Issuing The Workbench Artisan Command</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">workbench</span> <span class="nx">vendor</span><span class="o">/</span><span class="kr">package</span> <span class="o">--</span><span class="nx">resources</span>
</pre></div>

<p>The vendor name is a way to distinguish your package from other packages of the same name from different authors. For example, if I (Taylor Otwell) were to create a new package named &quot;Zapper&quot;, the vendor name could be <code>Taylor</code> while the package name would be <code>Zapper</code>. By default, the workbench will create framework agnostic packages; however, the <code>resources</code> command tells the workbench to generate the package with Laravel specific directories such as <code>migrations</code>, <code>views</code>, <code>config</code>, etc.</p>

<p>Once the <code>workbench</code> command has been executed, your package will be available within the <code>workbench</code> directory of your Laravel installation. Next, you should register the <code>ServiceProvider</code> that was created for your package. You may register the provider by adding it to the <code>providers</code> array in the <code>app/config/app.php</code> file. This will instruct Laravel to load your package when your application starts. Service providers use a <code>[Package]ServiceProvider</code> naming convention. So, using the example above, you would add <code>Taylor\Zapper\ZapperServiceProvider</code> to the <code>providers</code> array.</p>

<p>Once the provider has been registered, you are ready to start developing your package! However, before diving in, you may wish to review the sections below to get more familiar with the package structure and development workflow.</p>

<blockquote>
<p><strong>Note:</strong> If your service provider cannot be found, run the <code>php artisan dump-autoload</code> command from your application&#39;s root directory</p>
</blockquote>

<p><a name="package-structure"></a></p>

<h2>Package Structure</h2>

<p>When using the <code>workbench</code> command, your package will be setup with conventions that allow the package to integrate well with other parts of the Laravel framework:</p>

<h4>Basic Package Directory Structure</h4>
<div class="highlight"><pre><span></span><span class="err">/src</span>
    <span class="err">/Vendor</span>
        <span class="err">/Package</span>
            <span class="nx">PackageServiceProvider</span><span class="p">.</span><span class="nx">php</span>
    <span class="o">/</span><span class="nx">config</span>
    <span class="o">/</span><span class="nx">lang</span>
    <span class="o">/</span><span class="nx">migrations</span>
    <span class="o">/</span><span class="nx">views</span>
<span class="err">/tests</span>
<span class="err">/public</span>
</pre></div>

<p>Let&#39;s explore this structure further. The <code>src/Vendor/Package</code> directory is the home of all of your package&#39;s classes, including the <code>ServiceProvider</code>. The <code>config</code>, <code>lang</code>, <code>migrations</code>, and <code>views</code> directories, as you might guess, contain the corresponding resources for your package. Packages may have any of these resources, just like &quot;regular&quot; applications.</p>

<p><a name="service-providers"></a></p>

<h2>Service Providers</h2>

<p>Service providers are simply bootstrap classes for packages. By default, they contain two methods: <code>boot</code> and <code>register</code>. Within these methods you may do anything you like: include a routes file, register bindings in the IoC container, attach to events, or anything else you wish to do.</p>

<p>The <code>register</code> method is called immediately when the service provider is registered, while the <code>boot</code> command is only called right before a request is routed. So, if actions in your service provider rely on another service provider already being registered, or you are overriding services bound by another provider, you should use the <code>boot</code> method.</p>

<p>When creating a package using the <code>workbench</code>, the <code>boot</code> command will already contain one action:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="kr">package</span><span class="p">(</span><span class="s1">&#39;vendor/package&#39;</span><span class="p">);</span>
</pre></div>

<p>This method allows Laravel to know how to properly load the views, configuration, and other resources for your application. In general, there should be no need for you to change this line of code, as it will setup the package using the workbench conventions.</p>

<p>By default, after registering a package, its resources will be available using the &quot;package&quot; half of <code>vendor/package</code>. However, you may pass a second argument into the <code>package</code> method to override this behavior. For example:</p>
<div class="highlight"><pre><span></span><span class="c1">// Passing custom namespace to package method</span>
<span class="nx">$this</span><span class="o">-&gt;</span><span class="kr">package</span><span class="p">(</span><span class="s1">&#39;vendor/package&#39;</span><span class="p">,</span> <span class="s1">&#39;custom-namespace&#39;</span><span class="p">);</span>

<span class="c1">// Package resources now accessed via custom-namespace</span>
<span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;custom-namespace::foo&#39;</span><span class="p">);</span>
</pre></div>

<p>There is not a &quot;default location&quot; for service provider classes. You may put them anywhere you like, perhaps organizing them in a <code>Providers</code> namespace within your <code>app</code> directory. The file may be placed anywhere, as long as Composer&#39;s <a href="http://getcomposer.org/doc/01-basic-usage.md#autoloading">auto-loading facilities</a> know how to load the class.</p>

<p>If you have changed the location of your package&#39;s resources, such as configuration files or views, you should pass a third argument to the <code>package</code> method which specifies the location of your resources:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="kr">package</span><span class="p">(</span><span class="s1">&#39;vendor/package&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;/path/to/resources&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="deferred-providers"></a></p>

<h2>Deferred Providers</h2>

<p>If you are writing a service provider that does not register any resources such as configuration or views, you may choose to make your provider &quot;deferred&quot;. A deferred service provider is only loaded and registered when one of the services it provides is actually needed by the application IoC container. If none of the provider&#39;s services are needed for a given request cycle, the provider is never loaded.</p>

<p>To defer the execution of your service provider, set the <code>defer</code> property on the provider to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$defer</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>

<p>Next you should override the <code>provides</code> method from the base <code>Illuminate\Support\ServiceProvider</code> class and return an array of all of the bindings that your provider adds to the IoC container. For example, if your provider registers <code>package.service</code> and <code>package.another-service</code> in the IoC container, your <code>provides</code> method should look like this:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">provides</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;package.service&#39;</span><span class="p">,</span> <span class="s1">&#39;package.another-service&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="package-conventions"></a></p>

<h2>Package Conventions</h2>

<p>When utilizing resources from a package, such as configuration items or views, a double-colon syntax will generally be used:</p>

<h4>Loading A View From A Package</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;package::view.name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Package Configuration Item</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;package::group.option&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If your package contains migrations, consider prefixing the migration name with your package name to avoid potential class name conflicts with other packages.</p>
</blockquote>

<p><a name="development-workflow"></a></p>

<h2>Development Workflow</h2>

<p>When developing a package, it is useful to be able to develop within the context of an application, allowing you to easily view and experiment with your templates, etc. So, to get started, install a fresh copy of the Laravel framework, then use the <code>workbench</code> command to create your package structure.</p>

<p>After the <code>workbench</code> command has created your package. You may <code>git init</code> from the <code>workbench/[vendor]/[package]</code> directory and <code>git push</code> your package straight from the workbench! This will allow you to conveniently develop the package in an application context without being bogged down by constant <code>composer update</code> commands.</p>

<p>Since your packages are in the <code>workbench</code> directory, you may be wondering how Composer knows to autoload your package&#39;s files. When the <code>workbench</code> directory exists, Laravel will intelligently scan it for packages, loading their Composer autoload files when the application starts!</p>

<p>If you need to regenerate your package&#39;s autoload files, you may use the <code>php artisan dump-autoload</code> command. This command will regenerate the autoload files for your root project, as well as any workbenches you have created.</p>

<h4>Running The Artisan Autoload Command</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">dump</span><span class="o">-</span><span class="nx">autoload</span>
</pre></div>

<p><a name="package-routing"></a></p>

<h2>Package Routing</h2>

<p>In prior versions of Laravel, a <code>handles</code> clause was used to specify which URIs a package could respond to. However, in Laravel 4, a package may respond to any URI. To load a routes file for your package, simply <code>include</code> it from within your service provider&#39;s <code>boot</code> method.</p>

<h4>Including A Routes File From A Service Provider</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="kr">package</span><span class="p">(</span><span class="s1">&#39;vendor/package&#39;</span><span class="p">);</span>

    <span class="nx">include</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../../routes.php&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> If your package is using controllers, you will need to make sure they are properly configured in your <code>composer.json</code> file&#39;s auto-load section.</p>
</blockquote>

<p><a name="package-configuration"></a></p>

<h2>Package Configuration</h2>

<h4>Accessing Package Configuration Files</h4>

<p>Some packages may require configuration files. These files should be defined in the same way as typical application configuration files. And, when using the default <code>$this-&gt;package</code> method of registering resources in your service provider, may be accessed using the usual &quot;double-colon&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;package::file.option&#39;</span><span class="p">);</span>
</pre></div>

<h4>Accessing Single File Package Configuration</h4>

<p>However, if your package contains a single configuration file, you may simply name the file <code>config.php</code>. When this is done, you may access the options directly, without specifying the file name:</p>
<div class="highlight"><pre><span></span><span class="nx">Config</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;package::option&#39;</span><span class="p">);</span>
</pre></div>

<h4>Registering A Resource Namespace Manually</h4>

<p>Sometimes, you may wish to register package resources such as views outside of the typical <code>$this-&gt;package</code> method. Typically, this would only be done if the resources were not in a conventional location. To register the resources manually, you may use the <code>addNamespace</code> method of the <code>View</code>, <code>Lang</code>, and <code>Config</code> classes:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">addNamespace</span><span class="p">(</span><span class="s1">&#39;package&#39;</span><span class="p">,</span> <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the namespace has been registered, you may use the namespace name and the &quot;double colon&quot; syntax to access the resources:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;package::view.name&#39;</span><span class="p">);</span>
</pre></div>

<p>The method signature for <code>addNamespace</code> is identical on the <code>View</code>, <code>Lang</code>, and <code>Config</code> classes.</p>

<h3>Cascading Configuration Files</h3>

<p>When other developers install your package, they may wish to override some of the configuration options. However, if they change the values in your package source code, they will be overwritten the next time Composer updates the package. Instead, the <code>config:publish</code> artisan command should be used:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">config</span><span class="o">:</span><span class="nx">publish</span> <span class="nx">vendor</span><span class="o">/</span><span class="kr">package</span>
</pre></div>

<p>When this command is executed, the configuration files for your application will be copied to <code>app/config/packages/vendor/package</code> where they can be safely modified by the developer!</p>

<blockquote>
<p><strong>Note:</strong> The developer may also create environment specific configuration files for your package by placing them in <code>app/config/packages/vendor/package/environment</code>.</p>
</blockquote>

<p><a name="package-views"></a></p>

<h2>Package Views</h2>

<p>If you are using a package in your application, you may occasionally wish to customize the package&#39;s views. You can easily export the package views to your own <code>app/views</code> directory using the <code>view:publish</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">view</span><span class="o">:</span><span class="nx">publish</span> <span class="nx">vendor</span><span class="o">/</span><span class="kr">package</span>
</pre></div>

<p>This command will move the package&#39;s views into the <code>app/views/packages</code> directory. If this directory doesn&#39;t already exist, it will be created when you run the command. Once the views have been published, you may tweak them to your liking! The exported views will automatically take precedence over the package&#39;s own view files.</p>

<p><a name="package-migrations"></a></p>

<h2>Package Migrations</h2>

<h4>Creating Migrations For Workbench Packages</h4>

<p>You may easily create and run migrations for any of your packages. To create a migration for a package in the workbench, use the <code>--bench</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">create_users_table</span> <span class="o">--</span><span class="nx">bench</span><span class="o">=</span><span class="s2">&quot;vendor/package&quot;</span>
</pre></div>

<h4>Running Migrations For Workbench Packages</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">bench</span><span class="o">=</span><span class="s2">&quot;vendor/package&quot;</span>
</pre></div>

<h4>Running Migrations For An Installed Package</h4>

<p>To run migrations for a finished package that was installed via Composer into the <code>vendor</code> directory, you may use the <code>--package</code> directive:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="kr">package</span><span class="o">=</span><span class="s2">&quot;vendor/package&quot;</span>
</pre></div>

<p><a name="package-assets"></a></p>

<h2>Package Assets</h2>

<h4>Moving Package Assets To Public</h4>

<p>Some packages may have assets such as JavaScript, CSS, and images. However, we are unable to link to assets in the <code>vendor</code> or <code>workbench</code> directories, so we need a way to move these assets into the <code>public</code> directory of our application. The <code>asset:publish</code> command will take care of this for you:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">asset</span><span class="o">:</span><span class="nx">publish</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">asset</span><span class="o">:</span><span class="nx">publish</span> <span class="nx">vendor</span><span class="o">/</span><span class="kr">package</span>
</pre></div>

<p>If the package is still in the <code>workbench</code>, use the <code>--bench</code> directive:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">asset</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">bench</span><span class="o">=</span><span class="s2">&quot;vendor/package&quot;</span>
</pre></div>

<p>This command will move the assets into the <code>public/packages</code> directory according to the vendor and package name. So, a package named <code>userscape/kudos</code> would have its assets moved to <code>public/packages/userscape/kudos</code>. Using this asset publishing convention allows you to safely code asset paths in your package&#39;s views.</p>

<p><a name="publishing-packages"></a></p>

<h2>Publishing Packages</h2>

<p>When your package is ready to publish, you should submit the package to the <a href="http://packagist.org">Packagist</a> repository. If the package is specific to Laravel, consider adding a <code>laravel</code> tag to your package&#39;s <code>composer.json</code> file.</p>

<p>Also, it is courteous and helpful to tag your releases so that developers can depend on stable versions when requesting your package in their <code>composer.json</code> files. If a stable version is not ready, consider using the <code>branch-alias</code> Composer directive.</p>

<p>Once your package has been published, feel free to continue developing it within the application context created by <code>workbench</code>. This is a great way to continue to conveniently develop the package even after it has been published.</p>

<p>Some organizations choose to host their own private repository of packages for their own developers. If you are interested in doing this, review the documentation for the <a href="http://github.com/composer/satis">Satis</a> project provided by the Composer team.</p>
<div style="page-break-after: always;" ></div><h1>Pagination</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#appending-to-pagination-links">Appending To Pagination Links</a></li>
<li><a href="#converting-to-json">Converting To JSON</a></li>
<li><a href="#custom-presenters">Custom Presenters</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>In other frameworks, pagination can be very painful. Laravel makes it a breeze. There is a single configuration option in the <code>app/config/view.php</code> file. The <code>pagination</code> option specifies which view should be used to create pagination links. By default, Laravel includes two views.</p>

<p>The <code>pagination::slider</code> view will show an intelligent &quot;range&quot; of links based on the current page, while the <code>pagination::simple</code> view will simply show &quot;previous&quot; and &quot;next&quot; buttons. <strong>Both views are compatible with Twitter Bootstrap out of the box.</strong></p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<p>There are several ways to paginate items. The simplest is by using the <code>paginate</code> method on the query builder or an Eloquent model.</p>

<h4>Paginating Database Results</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Currently, pagination operations that use a <code>groupBy</code> statement cannot be executed efficiently by Laravel. If you need to use a <code>groupBy</code> with a paginated result set, it is recommended that you query the database manually and use <code>Paginator::make</code>.</p>
</blockquote>

<h4>Paginating An Eloquent Model</h4>

<p>You may also paginate <a href="/docs/4.2/eloquent">Eloquent</a> models:</p>
<div class="highlight"><pre><span></span><span class="nx">$allUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

<span class="nx">$someUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>The argument passed to the <code>paginate</code> method is the number of items you wish to display per page. Once you have retrieved the results, you may display them on your view, and create the pagination links using the <code>links</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This is all it takes to create a pagination system! Note that we did not have to inform the framework of the current page. Laravel will determine this for you automatically.</p>

<p>If you would like to specify a custom view to use for pagination, you may pass a view to the <code>links</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<p>You may also access additional pagination information via the following methods:</p>

<ul>
<li><code>getCurrentPage</code></li>
<li><code>getLastPage</code></li>
<li><code>getPerPage</code></li>
<li><code>getTotal</code></li>
<li><code>getFrom</code></li>
<li><code>getTo</code></li>
<li><code>count</code></li>
</ul>

<h4>&quot;Simple Pagination&quot;</h4>

<p>If you are only showing &quot;Next&quot; and &quot;Previous&quot; links in your pagination view, you have the option of using the <code>simplePaginate</code> method to perform a more efficient query. This is useful for larger datasets when you do not require the display of exact page numbers on your view:</p>
<div class="highlight"><pre><span></span><span class="nx">$someUsers</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<h4>Creating A Paginator Manually</h4>

<p>Sometimes you may wish to create a pagination instance manually, passing it an array of items. You may do so using the <code>Paginator::make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$paginator</span> <span class="o">=</span> <span class="nx">Paginator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$items</span><span class="p">,</span> <span class="nx">$totalItems</span><span class="p">,</span> <span class="nx">$perPage</span><span class="p">);</span>
</pre></div>

<h4>Customizing The Paginator URI</h4>

<p>You may also customize the URI used by the paginator via the <code>setBaseUrl</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">();</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">setBaseUrl</span><span class="p">(</span><span class="s1">&#39;custom/url&#39;</span><span class="p">);</span>
</pre></div>

<p>The example above will create URLs like the following: http://example.com/custom/url?page=2</p>

<p><a name="appending-to-pagination-links"></a></p>

<h2>Appending To Pagination Links</h2>

<p>You can add to the query string of pagination links using the <code>appends</code> method on the Paginator:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">appends</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;votes&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This will generate URLs that look something like this:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com/something?page=2&amp;sort=votes</span>
</pre></div>

<p>If you wish to append a &quot;hash fragment&quot; to the paginator&#39;s URLs, you may use the <code>fragment</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">fragment</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">();</span> <span class="cp">?&gt;</span>
</pre></div>

<p>This method call will generate URLs that look something like this:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com/something?page=2#foo</span>
</pre></div>

<p><a name="converting-to-json"></a></p>

<h2>Converting To JSON</h2>

<p>The <code>Paginator</code> class implements the <code>Illuminate\Support\Contracts\JsonableInterface</code> contract and exposes the <code>toJson</code> method. You may also convert a <code>Paginator</code> instance to JSON by returning it from a route. The JSON&#39;d form of the instance will include some &quot;meta&quot; information such as <code>total</code>, <code>current_page</code>, <code>last_page</code>, <code>from</code>, and <code>to</code>. The instance&#39;s data will be available via the <code>data</code> key in the JSON array.</p>

<p><a name="custom-presenters"></a></p>

<h2>Custom Presenters</h2>

<p>The default pagination presenter is Bootstrap compatible out of the box; however, you may customize this with a presenter of your choice.</p>

<h3>Extending The Abstract Presenter</h3>

<p>Extend the <code>Illuminate\Pagination\Presenter</code> class and implement its abstract methods. An example presenter for Zurb Foundation might look like this:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">ZurbPresenter</span> <span class="kr">extends</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Pagination</span><span class="err">\</span><span class="nx">Presenter</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getActivePageWrapper</span><span class="p">(</span><span class="nx">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;li class=&quot;current&quot;&gt;&lt;a href=&quot;&quot;&gt;&#39;</span><span class="p">.</span><span class="nx">$text</span><span class="p">.</span><span class="s1">&#39;&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getDisabledTextWrapper</span><span class="p">(</span><span class="nx">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;li class=&quot;unavailable&quot;&gt;&lt;a href=&quot;&quot;&gt;&#39;</span><span class="p">.</span><span class="nx">$text</span><span class="p">.</span><span class="s1">&#39;&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getPageLinkWrapper</span><span class="p">(</span><span class="nx">$url</span><span class="p">,</span> <span class="nx">$page</span><span class="p">,</span> <span class="nx">$rel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;&#39;</span><span class="p">.</span><span class="nx">$url</span><span class="p">.</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">.</span><span class="nx">$page</span><span class="p">.</span><span class="s1">&#39;&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h3>Using The Custom Presenter</h3>

<p>First, create a view in your <code>app/views</code> directory that will serve as your custom presenter. Then, replace <code>pagination</code> option in the <code>app/config/view.php</code> configuration file with the new view&#39;s name. Finally, the following code would be placed in your custom presenter view:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;pagination&quot;</span><span class="o">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">with</span><span class="p">(</span><span class="k">new</span> <span class="nx">ZurbPresenter</span><span class="p">(</span><span class="nv">$paginator</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span> <span class="cp">?&gt;</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Query Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#selects">Selects</a></li>
<li><a href="#joins">Joins</a></li>
<li><a href="#advanced-wheres">Advanced Wheres</a></li>
<li><a href="#aggregates">Aggregates</a></li>
<li><a href="#raw-expressions">Raw Expressions</a></li>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a></li>
<li><a href="#deletes">Deletes</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#pessimistic-locking">Pessimistic Locking</a></li>
<li><a href="#caching-queries">Caching Queries</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The database query builder provides a convenient, fluent interface to creating and running database queries. It can be used to perform most database operations in your application, and works on all supported database systems.</p>

<blockquote>
<p><strong>Note:</strong> The Laravel query builder uses PDO parameter binding throughout to protect your application against SQL injection attacks. There is no need to clean strings being passed as bindings.</p>
</blockquote>

<p><a name="selects"></a></p>

<h2>Selects</h2>

<h4>Retrieving All Rows From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving A Single Row From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">var_dump</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Single Column From A Row</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A List Of Column Values</h4>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
</pre></div>

<p>This method will return an array of role titles. You may also specify a custom key column for the returned array:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lists</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Specifying A Select Clause</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">distinct</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name as user_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Adding A Select Clause To An Existing Query</h4>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">addSelect</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Operators</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Or Statements</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Between</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Not Between</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where In With An Array</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Using Where Null To Find Records With Unset Values</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Order By, Group By, And Having</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">having</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Offset &amp; Limit</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="joins"></a></p>

<h2>Joins</h2>

<p>The query builder may also be used to write join statements. Take a look at the following examples:</p>

<h4>Basic Join Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.phone&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.price&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Left Join Statement</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">leftJoin</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;posts.user_id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify more advanced join clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$join</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orOn</span><span class="p">(...);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you would like to use a &quot;where&quot; style clause on your joins, you may use the <code>where</code> and <code>orWhere</code> methods on a join. Instead of comparing two columns, these methods will compare the column against a value:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$join</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;contacts.user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="advanced-wheres"></a></p>

<h2>Advanced Wheres</h2>

<h4>Parameter Grouping</h4>

<p>Sometimes you may need to create more advanced where clauses such as &quot;where exists&quot; or nested parameter groupings. The Laravel query builder can handle these as well:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">or</span> <span class="p">(</span><span class="nx">votes</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="nx">and</span> <span class="nx">title</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
</pre></div>

<h4>Exists Statements</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereExists</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                      <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;orders.user_id = users.id&#39;</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span>
<span class="nx">where</span> <span class="nx">exists</span> <span class="p">(</span>
    <span class="nx">select</span> <span class="mi">1</span> <span class="nx">from</span> <span class="nx">orders</span> <span class="nx">where</span> <span class="nx">orders</span><span class="p">.</span><span class="nx">user_id</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
<span class="p">)</span>
</pre></div>

<p><a name="aggregates"></a></p>

<h2>Aggregates</h2>

<p>The query builder also provides a variety of aggregate methods, such as <code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, and <code>sum</code>.</p>

<h4>Using Aggregate Methods</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$total</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="raw-expressions"></a></p>

<h2>Raw Expressions</h2>

<p>Sometimes you may need to use a raw expression in a query. These expressions will be injected into the query as strings, so be careful not to create any SQL injection points! To create a raw expression, you may use the <code>DB::raw</code> method:</p>

<h4>Using A Raw Expression</h4>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;count(*) as user_count, status&#39;</span><span class="p">))</span>
                     <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="inserts"></a></p>

<h2>Inserts</h2>

<h4>Inserting Records Into A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<h4>Inserting Records Into A Table With An Auto-Incrementing ID</h4>

<p>If the table has an auto-incrementing id, use <code>insertGetId</code> to insert a record and retrieve the id:</p>
<div class="highlight"><pre><span></span><span class="nx">$id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insertGetId</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When using PostgreSQL the insertGetId method expects the auto-incrementing column to be named &quot;id&quot;.</p>
</blockquote>

<h4>Inserting Multiple Records Into A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">));</span>
</pre></div>

<p><a name="updates"></a></p>

<h2>Updates</h2>

<h4>Updating Records In A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">update</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>

<h4>Incrementing or decrementing a value of a column</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may also specify additional columns to update:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="deletes"></a></p>

<h2>Deletes</h2>

<h4>Deleting Records In A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting All Records From A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Truncating A Table</h4>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">truncate</span><span class="p">();</span>
</pre></div>

<p><a name="unions"></a></p>

<h2>Unions</h2>

<p>The query builder also provides a quick way to &quot;union&quot; two queries together:</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">union</span><span class="p">(</span><span class="nx">$first</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>unionAll</code> method is also available, and has the same method signature as <code>union</code>.</p>

<p><a name="pessimistic-locking"></a></p>

<h2>Pessimistic Locking</h2>

<p>The query builder includes a few functions to help you do &quot;pessimistic locking&quot; on your SELECT statements.</p>

<p>To run the SELECT statement with a &quot;shared lock&quot;, you may use the <code>sharedLock</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sharedLock</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>To &quot;lock for update&quot; on a SELECT statement, you may use the <code>lockForUpdate</code> method on a query:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lockForUpdate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="caching-queries"></a></p>

<h2>Caching Queries</h2>

<p>You may easily cache the results of a query using the <code>remember</code> or <code>rememberForever</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">remember</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In this example, the results of the query will be cached for ten minutes. While the results are cached, the query will not be run against the database, and the results will be loaded from the default cache driver specified for your application.</p>

<p>If you are using a <a href="/docs/4.2/cache#cache-tags">supported cache driver</a>, you can also add tags to the caches:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cacheTags</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">remember</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Queues</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#queueing-closures">Queueing Closures</a></li>
<li><a href="#running-the-queue-listener">Running The Queue Listener</a></li>
<li><a href="#daemon-queue-worker">Daemon Queue Worker</a></li>
<li><a href="#push-queues">Push Queues</a></li>
<li><a href="#failed-jobs">Failed Jobs</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The Laravel Queue component provides a unified API across a variety of different queue services. Queues allow you to defer the processing of a time consuming task, such as sending an e-mail, until a later time, thus drastically speeding up the web requests to your application.</p>

<p>The queue configuration file is stored in <code>app/config/queue.php</code>. In this file you will find connection configurations for each of the queue drivers that are included with the framework, which includes a <a href="http://kr.github.com/beanstalkd">Beanstalkd</a>, <a href="http://iron.io">IronMQ</a>, <a href="http://aws.amazon.com/sqs">Amazon SQS</a>, <a href="http://redis.io">Redis</a>, and synchronous (for local use) driver.</p>

<p>The following dependencies are needed for the listed queue drivers:</p>

<ul>
<li>Beanstalkd: <code>pda/pheanstalk ~2.0</code></li>
<li>Amazon SQS: <code>aws/aws-sdk-php</code></li>
<li>IronMQ: <code>iron-io/iron_mq</code></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Pushing A Job Onto The Queue</h4>

<p>To push a new job onto the queue, use the <code>Queue::push</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;SendEmail&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="nx">$message</span><span class="p">));</span>
</pre></div>

<h4>Defining A Job Handler</h4>

<p>The first argument given to the <code>push</code> method is the name of the class that should be used to process the job. The second argument is an array of data that should be passed to the handler. A job handler should be defined like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">SendEmail</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">fire</span><span class="p">(</span><span class="nx">$job</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Notice the only method that is required is <code>fire</code>, which receives a <code>Job</code> instance as well as the array of <code>data</code> that was pushed onto the queue.</p>

<h4>Specifying A Custom Handler Method</h4>

<p>If you want the job to use a method other than <code>fire</code>, you may specify the method when you push the job:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;SendEmail@send&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="nx">$message</span><span class="p">));</span>
</pre></div>

<h4>Specifying The Queue / Tube For A Job</h4>

<p>You may also specify the queue / tube a job should be sent to:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;SendEmail@send&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="nx">$message</span><span class="p">),</span> <span class="s1">&#39;emails&#39;</span><span class="p">);</span>
</pre></div>

<h4>Passing The Same Payload To Multiple Jobs</h4>

<p>If you need to pass the same data to several queue jobs, you may use the <code>Queue::bulk</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;SendEmail&#39;</span><span class="p">,</span> <span class="s1">&#39;NotifyUser&#39;</span><span class="p">),</span> <span class="nx">$payload</span><span class="p">);</span>
</pre></div>

<h4>Delaying The Execution Of A Job</h4>

<p>Sometimes you may wish to delay the execution of a queued job. For instance, you may wish to queue a job that sends a customer an e-mail 15 minutes after sign-up. You can accomplish this using the <code>Queue::later</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$date</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

<span class="nx">Queue</span><span class="o">::</span><span class="nx">later</span><span class="p">(</span><span class="nx">$date</span><span class="p">,</span> <span class="s1">&#39;SendEmail@send&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="nx">$message</span><span class="p">));</span>
</pre></div>

<p>In this example, we&#39;re using the <a href="https://github.com/briannesbitt/Carbon">Carbon</a> date library to specify the delay we wish to assign to the job. Alternatively, you may pass the number of seconds you wish to delay as an integer.</p>

<blockquote>
<p><strong>Note:</strong> The Amazon SQS service has a delay limit of 900 seconds (15 minutes).</p>
</blockquote>

<h4>Deleting A Processed Job</h4>

<p>Once you have processed a job, it must be deleted from the queue, which can be done via the <code>delete</code> method on the <code>Job</code> instance:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">fire</span><span class="p">(</span><span class="nx">$job</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Process the job...</span>

    <span class="nx">$job</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>Releasing A Job Back Onto The Queue</h4>

<p>If you wish to release a job back onto the queue, you may do so via the <code>release</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">fire</span><span class="p">(</span><span class="nx">$job</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Process the job...</span>

    <span class="nx">$job</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify the number of seconds to wait before the job is released:</p>
<div class="highlight"><pre><span></span><span class="nx">$job</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<h4>Checking The Number Of Run Attempts</h4>

<p>If an exception occurs while the job is being processed, it will automatically be released back onto the queue. You may check the number of attempts that have been made to run the job using the <code>attempts</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$job</span><span class="o">-&gt;</span><span class="nx">attempts</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Accessing The Job ID</h4>

<p>You may also access the job identifier:</p>
<div class="highlight"><pre><span></span><span class="nx">$job</span><span class="o">-&gt;</span><span class="nx">getJobId</span><span class="p">();</span>
</pre></div>

<p><a name="queueing-closures"></a></p>

<h2>Queueing Closures</h2>

<p>You may also push a Closure onto the queue. This is very convenient for quick, simple tasks that need to be queued:</p>

<h4>Pushing A Closure Onto The Queue</h4>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$job</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">Account</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>

    <span class="nx">$job</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Instead of making objects available to queued Closures via the <code>use</code> directive, consider passing primary keys and re-pulling the associated models from within your queue job. This often avoids unexpected serialization behavior.</p>
</blockquote>

<p>When using Iron.io <a href="#push-queues">push queues</a>, you should take extra precaution queueing Closures. The end-point that receives your queue messages should check for a token to verify that the request is actually from Iron.io. For example, your push queue end-point should be something like: <code>https://yourapp.com/queue/receive?token=SecretToken</code>. You may then check the value of the secret token in your application before marshalling the queue request.</p>

<p><a name="running-the-queue-listener"></a></p>

<h2>Running The Queue Listener</h2>

<p>Laravel includes an Artisan task that will run new jobs as they are pushed onto the queue. You may run this task using the <code>queue:listen</code> command:</p>

<h4>Starting The Queue Listener</h4>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span>
</pre></div>

<p>You may also specify which queue connection the listener should utilize:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span>
</pre></div>

<p>Note that once this task has started, it will continue to run until it is manually stopped. You may use a process monitor such as <a href="http://supervisord.org/">Supervisor</a> to ensure that the queue listener does not stop running.</p>

<p>You may pass a comma-delimited list of queue connections to the <code>listen</code> command to set queue priorities:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">high</span><span class="p">,</span><span class="nx">low</span>
</pre></div>

<p>In this example, jobs on the <code>high</code> connection will always be processed before moving onto jobs from the <code>low</code> connection.</p>

<h4>Specifying The Job Timeout Parameter</h4>

<p>You may also set the length of time (in seconds) each job should be allowed to run:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">60</span>
</pre></div>

<h4>Specifying Queue Sleep Duration</h4>

<p>In addition, you may specify the number of seconds to wait before polling for new jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">5</span>
</pre></div>

<p>Note that the queue only &quot;sleeps&quot; if no jobs are on the queue. If more jobs are available, the queue will continue to work them without sleeping.</p>

<h4>Processing The First Job On The Queue</h4>

<p>To process only the first job on the queue, you may use the <code>queue:work</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span>
</pre></div>

<p><a name="daemon-queue-worker"></a></p>

<h2>Daemon Queue Worker</h2>

<p>The <code>queue:work</code> also includes a <code>--daemon</code> option for forcing the queue worker to continue processing jobs without ever re-booting the framework. This results in a significant reduction of CPU usage when compared to the <code>queue:listen</code> command, but at the added complexity of needing to drain the queues of currently executing jobs during your deployments.</p>

<p>To start a queue worker in daemon mode, use the <code>--daemon</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">connection</span> <span class="o">--</span><span class="nx">daemon</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>As you can see, the <code>queue:work</code> command supports most of the same options available to <code>queue:listen</code>. You may use the <code>php artisan help queue:work</code> command to view all of the available options.</p>

<h3>Deploying With Daemon Queue Workers</h3>

<p>The simplest way to deploy an application using daemon queue workers is to put the application in maintenance mode at the beginning of your deployment. This can be done using the <code>php artisan down</code> command. Once the application is in maintenance mode, Laravel will not accept any new jobs off of the queue, but will continue to process existing jobs.</p>

<p>The easiest way to restart your workers is to include the following command in your deployment script:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">restart</span>
</pre></div>

<p>This command will instruct all queue workers to restart after they finish processing their current job.</p>

<blockquote>
<p><strong>Note:</strong> This command relies on the cache system to schedule the restart. By default, APCu does not work for CLI commands. If you are using APCu, add <code>apc.enable_cli=1</code> to your APCu configuration.</p>
</blockquote>

<h3>Coding For Daemon Queue Workers</h3>

<p>Daemon queue workers do not restart the framework before processing each job. Therefore, you should be careful to free any heavy resources before your job finishes. For example, if you are doing image manipulation with the GD library, you should free the memory with <code>imagedestroy</code> when you are done.</p>

<p>Similarly, your database connection may disconnect when being used by long-running daemon. You may use the <code>DB::reconnect</code> method to ensure you have a fresh connection.</p>

<p><a name="push-queues"></a></p>

<h2>Push Queues</h2>

<p>Push queues allow you to utilize the powerful Laravel 4 queue facilities without running any daemons or background listeners. Currently, push queues are only supported by the <a href="http://iron.io">Iron.io</a> driver. Before getting started, create an Iron.io account, and add your Iron credentials to the <code>app/config/queue.php</code> configuration file.</p>

<h4>Registering A Push Queue Subscriber</h4>

<p>Next, you may use the <code>queue:subscribe</code> Artisan command to register a URL end-point that will receive newly pushed queue jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">subscribe</span> <span class="nx">queue_name</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//foo.com/queue/receive</span>
</pre></div>

<p>Now, when you login to your Iron dashboard, you will see your new push queue, as well as the subscribed URL. You may subscribe as many URLs as you wish to a given queue. Next, create a route for your <code>queue/receive</code> end-point and return the response from the <code>Queue::marshal</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;queue/receive&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Queue</span><span class="o">::</span><span class="nx">marshal</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The <code>marshal</code> method will take care of firing the correct job handler class. To fire jobs onto the push queue, just use the same <code>Queue::push</code> method used for conventional queues.</p>

<p><a name="failed-jobs"></a></p>

<h2>Failed Jobs</h2>

<p>Since things don&#39;t always go as planned, sometimes your queued jobs will fail. Don&#39;t worry, it happens to the best of us! Laravel includes a convenient way to specify the maximum number of times a job should be attempted. After a job has exceeded this amount of attempts, it will be inserted into a <code>failed_jobs</code> table. The failed jobs table name can be configured via the <code>app/config/queue.php</code> configuration file.</p>

<p>To create a migration for the <code>failed_jobs</code> table, you may use the <code>queue:failed-table</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span><span class="o">-</span><span class="nx">table</span>
</pre></div>

<p>You can specify the maximum number of times a job should be attempted using the <code>--tries</code> switch on the <code>queue:listen</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span> <span class="nx">connection</span><span class="o">-</span><span class="nx">name</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>If you would like to register an event that will be called when a queue job fails, you may use the <code>Queue::failing</code> method. This event is a great opportunity to notify your team via e-mail or <a href="https://www.hipchat.com">HipChat</a>.</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">failing</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$connection</span><span class="p">,</span> <span class="nx">$job</span><span class="p">,</span> <span class="nx">$data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>To view all of your failed jobs, you may use the <code>queue:failed</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span>
</pre></div>

<p>The <code>queue:failed</code> command will list the job ID, connection, queue, and failure time. The job ID may be used to retry the failed job. For instance, to retry a failed job that has an ID of 5, the following command should be issued:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="mi">5</span>
</pre></div>

<p>If you would like to delete a failed job, you may use the <code>queue:forget</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">forget</span> <span class="mi">5</span>
</pre></div>

<p>To delete all of your failed jobs, you may use the <code>queue:flush</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">flush</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Quickstart</h1>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#local-development-environment">Local Development Environment</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#creating-a-view">Creating A View</a></li>
<li><a href="#creating-a-migration">Creating A Migration</a></li>
<li><a href="#eloquent-orm">Eloquent ORM</a></li>
<li><a href="#displaying-data">Displaying Data</a></li>
<li><a href="#deploying-your-application">Deploying Your Application</a></li>
</ul>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<h3>Via Laravel Installer</h3>

<p>First, download the Laravel installer using Composer.</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/installer=~1.1&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH (or <code>C:\%HOMEPATH%\AppData\Roaming\Composer\vendor\bin</code> if working with Windows) so the <code>laravel</code> executable is found when you run the <code>laravel</code> command in your terminal.</p>

<p>Once installed, the simple <code>laravel new</code> command will create a fresh Laravel installation in the directory you specify. For instance, <code>laravel new blog</code> would create a directory named <code>blog</code> containing a fresh Laravel installation with all dependencies installed. This method of installation is much faster than installing via Composer.</p>

<h3>Via Composer</h3>

<p>The Laravel framework utilizes <a href="http://getcomposer.org">Composer</a> for installation and dependency management. If you haven&#39;t already, start by <a href="http://getcomposer.org/doc/00-intro.md">installing Composer</a>.</p>

<p>Now you can install Laravel by issuing the following command from your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="nx">your</span><span class="o">-</span><span class="nx">project</span><span class="o">-</span><span class="nx">name</span> <span class="mf">4.2</span><span class="p">.</span><span class="o">*</span>
</pre></div>

<p>This command will download and install a fresh copy of Laravel in a new <code>your-project-name</code> folder within your current directory.</p>

<p>If you prefer, you can alternatively download a copy of the <a href="https://github.com/laravel/docs/archive/4.2.zip">Laravel repository from GitHub</a> manually. Next run the <code>composer install</code> command in the root of your manually created project directory. This command will download and install the framework&#39;s dependencies.</p>

<h3>Permissions</h3>

<p>After installing Laravel, you may need to grant the web server write permissions to the <code>app/storage</code> directories. See the <a href="/docs/4.2/installation">Installation</a> documentation for more details on configuration.</p>

<h3>Serving Laravel</h3>

<p>Typically, you may use a web server such as Apache or Nginx to serve your Laravel applications. If you are on PHP 5.4+ and would like to use PHP&#39;s built-in development server, you may use the <code>serve</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">serve</span>
</pre></div>

<p>By default the HTTP-server will listen to port 8000. However if that port is already in use or you wish to serve multiple applications this way, you might want to specify what port to use. Just add the --port argument:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">serve</span> <span class="o">--</span><span class="nx">port</span><span class="o">=</span><span class="mi">8080</span>
</pre></div>

<p><a name="directories"></a></p>

<h3>Directory Structure</h3>

<p>After installing the framework, take a glance around the project to familiarize yourself with the directory structure. The <code>app</code> directory contains folders such as <code>views</code>, <code>controllers</code>, and <code>models</code>. Most of your application&#39;s code will reside somewhere in this directory. You may also wish to explore the <code>app/config</code> directory and the configuration options that are available to you.</p>

<p><a name="local-development-environment"></a></p>

<h2>Local Development Environment</h2>

<p>In the past, configuring a local PHP development environment on your machine was a headache. Installing the proper version of PHP, required extensions, and other needed components is time consuming and confusing. Instead, consider using <a href="/docs/4.2/homestead">Laravel Homestead</a>. Homestead is a simple virtual machine designed for Laravel and <a href="http://vagrantup.com">Vagrant</a>. Since the Homestead Vagrant box is pre-packaged with all of the software you need to build robust PHP applications, you can create a virtualized, isolated development environment in seconds. Here is a list of some of the goodies included with Homestead:</p>

<ul>
<li>Nginx</li>
<li>PHP 5.6</li>
<li>MySQL</li>
<li>Redis</li>
<li>Memcached</li>
<li>Beanstalk</li>
</ul>

<p>Don&#39;t worry, even though &quot;virtualized&quot; sounds complicated, it&#39;s painless. VirtualBox and Vagrant, which are Homestead&#39;s two dependencies, both include simple, graphical installers for all popular operating systems. Check out the <a href="/docs/4.2/homestead">Homestead documentation</a> to get started.</p>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p>To get started, let&#39;s create our first route. In Laravel, the simplest route is a route to a Closure. Pop open the <code>app/routes.php</code> file and add the following route to the bottom of the file:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Users!&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Now, if you hit the <code>/users</code> route in your web browser, you should see <code>Users!</code> displayed as the response. Great! You&#39;ve just created your first route.</p>

<p>Routes can also be attached to controller classes. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@getIndex&#39;</span><span class="p">);</span>
</pre></div>

<p>This route informs the framework that requests to the <code>/users</code> route should call the <code>getIndex</code> method on the <code>UserController</code> class. For more information on controller routing, check out the <a href="/docs/4.2/controllers">controller documentation</a>.</p>

<p><a name="creating-a-view"></a></p>

<h2>Creating A View</h2>

<p>Next, we&#39;ll create a simple view to display our user data. Views live in the <code>app/views</code> directory and contain the HTML of your application. We&#39;re going to place two new views in this directory: <code>layout.blade.php</code> and <code>users.blade.php</code>. First, let&#39;s create our <code>layout.blade.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Laravel</span> <span class="nx">Quickstart</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

        <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>Next, we&#39;ll create our <code>users.blade.php</code> view:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="nx">Users</span><span class="o">!</span>
<span class="err">@</span><span class="nx">stop</span>
</pre></div>

<p>Some of this syntax probably looks quite strange to you. That&#39;s because we&#39;re using Laravel&#39;s templating system: Blade. Blade is very fast, because it is simply a handful of regular expressions that are run against your templates to compile them to pure PHP. Blade provides powerful functionality like template inheritance, as well as some syntax sugar on typical PHP control structures such as <code>if</code> and <code>for</code>. Check out the <a href="/docs/4.2/templates">Blade documentation</a> for more details.</p>

<p>Now that we have our views, let&#39;s return it from our <code>/users</code> route. Instead of returning <code>Users!</code> from the route, return the view instead:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Wonderful! Now you have setup a simple view that extends a layout. Next, let&#39;s start working on our database layer.</p>

<p><a name="creating-a-migration"></a></p>

<h2>Creating A Migration</h2>

<p>To create a table to hold our data, we&#39;ll use the Laravel migration system. Migrations let you expressively define modifications to your database, and easily share them with the rest of your team.</p>

<p>First, let&#39;s configure a database connection. You may configure all of your database connections from the <code>app/config/database.php</code> file. By default, Laravel is configured to use MySQL, and you will need to supply connection credentials within the database configuration file. If you wish, you may change the <code>driver</code> option to <code>sqlite</code> and it will use the SQLite database included in the <code>app/database</code> directory.</p>

<p>Next, to create the migration, we&#39;ll use the <a href="/docs/4.2/artisan">Artisan CLI</a>. From the root of your project, run the following from your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">make</span> <span class="nx">create_users_table</span>
</pre></div>

<p>Next, find the generated migration file in the <code>app/database/migrations</code> folder. This file contains a class with two methods: <code>up</code> and <code>down</code>. In the <code>up</code> method, you should make the desired changes to your database tables, and in the <code>down</code> method you simply reverse them.</p>

<p>Let&#39;s define a migration that looks like this:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">up</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">timestamps</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">down</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Next, we can run our migrations from our terminal using the <code>migrate</code> command. Simply execute this command from the root of your project:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>If you wish to rollback a migration, you may issue the <code>migrate:rollback</code> command. Now that we have a database table, let&#39;s start pulling some data!</p>

<p><a name="eloquent-orm"></a></p>

<h2>Eloquent ORM</h2>

<p>Laravel ships with a superb ORM: Eloquent. If you have used the Ruby on Rails framework, you will find Eloquent familiar, as it follows the ActiveRecord ORM style of database interaction.</p>

<p>First, let&#39;s define a model. An Eloquent model can be used to query an associated database table, as well as represent a given row within that table. Don&#39;t worry, it will all make sense soon! Models are typically stored in the <code>app/models</code> directory. Let&#39;s define a <code>User.php</code> model in that directory like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{}</span>
</pre></div>

<p>Note that we do not have to tell Eloquent which table to use. Eloquent has a variety of conventions, one of which is to use the plural form of the model name as the model&#39;s database table. Convenient!</p>

<p>Using your preferred database administration tool, insert a few rows into your <code>users</code> table, and we&#39;ll use Eloquent to retrieve them and pass them to our view.</p>

<p>Now let&#39;s modify our <code>/users</code> route to look like this:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$users</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Let&#39;s walk through this route. First, the <code>all</code> method on the <code>User</code> model will retrieve all of the rows in the <code>users</code> table. Next, we&#39;re passing these records to the view via the <code>with</code> method. The <code>with</code> method accepts a key and a value, and is used to make a piece of data available to a view.</p>

<p>Awesome. Now we&#39;re ready to display the users in our view!</p>

<p><a name="displaying-data"></a></p>

<h2>Displaying Data</h2>

<p>Now that we have made the <code>users</code> available to our view, we can display them like so:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">foreach</span><span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="err">@</span><span class="nx">stop</span>
</pre></div>

<p>You may be wondering where to find our <code>echo</code> statements. When using Blade, you may echo data by surrounding it with double curly braces. It&#39;s a cinch. Now, you should be able to hit the <code>/users</code> route and see the names of your users displayed in the response.</p>

<p>This is just the beginning. In this tutorial, you&#39;ve seen the very basics of Laravel, but there are so many more exciting things to learn. Keep reading through the documentation and dig deeper into the powerful features available to you in <a href="/docs/4.2/eloquent">Eloquent</a> and <a href="/docs/4.2/templates">Blade</a>. Or, maybe you&#39;re more interested in <a href="/docs/4.2/queues">Queues</a> and <a href="/docs/4.2/testing">Unit Testing</a>. Then again, maybe you want to flex your architecture muscles with the <a href="/docs/4.2/ioc">IoC Container</a>. The choice is yours!</p>

<p><a name="deploying-your-application"></a></p>

<h2>Deploying Your Application</h2>

<p>One of Laravel&#39;s goals is to make PHP application development enjoyable from download to deploy, and <a href="https://forge.laravel.com">Laravel Forge</a> provides a simple way to deploy your Laravel applications onto blazing fast servers. Forge can configure and provision servers on DigitalOcean, Linode, Rackspace, and Amazon EC2. Like Homestead, all of the latest goodies are included: Nginx, PHP 5.6, MySQL, Postgres, Redis, Memcached, and more. Forge &quot;Quick Deploy&quot; can even deploy your code for you each time you push changes out to GitHub or Bitbucket!</p>

<p>On top of that, Forge can help you configure queue workers, SSL, Cron jobs, sub-domains, and more. For more information, visit the <a href="https://forge.laravel.com">Forge website</a>.</p>
<div style="page-break-after: always;" ></div><h1>Redis</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#pipelining">Pipelining</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="http://redis.io">Redis</a> is an open source, advanced key-value store. It is often referred to as a data structure server since keys can contain <a href="http://redis.io/topics/data-types#strings">strings</a>, <a href="http://redis.io/topics/data-types#hashes">hashes</a>, <a href="http://redis.io/topics/data-types#lists">lists</a>, <a href="http://redis.io/topics/data-types#sets">sets</a>, and <a href="http://redis.io/topics/data-types#sorted-sets">sorted sets</a>.</p>

<blockquote>
<p><strong>Note:</strong> If you have the Redis PHP extension installed via PECL, you will need to rename the alias for Redis in your <code>app/config/app.php</code> file.</p>
</blockquote>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The Redis configuration for your application is stored in the <strong>app/config/database.php</strong> file. Within this file, you will see a <strong>redis</strong> array containing the Redis servers used by your application:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>

    <span class="s1">&#39;cluster&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">6379</span><span class="p">),</span>

<span class="p">),</span>
</pre></div>

<p>The default server configuration should suffice for development. However, you are free to modify this array based on your environment. Simply give each Redis server a name, and specify the host and port used by the server.</p>

<p>The <code>cluster</code> option will tell the Laravel Redis client to perform client-side sharding across your Redis nodes, allowing you to pool nodes and create a large amount of available RAM. However, note that client-side sharding does not handle failover; therefore, is primarily suited for cached data that is available from another primary data store.</p>

<p>If your Redis server requires authentication, you may supply a password by adding a <code>password</code> key / value pair to your Redis server configuration array.</p>

<p><a name="usage"></a></p>

<h2>Usage</h2>

<p>You may get a Redis instance by calling the <code>Redis::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">();</span>
</pre></div>

<p>This will give you an instance of the default Redis server. If you are not using server clustering, you may pass the server name to the <code>connection</code> method to get a specific server as defined in your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">);</span>
</pre></div>

<p>Once you have an instance of the Redis client, we may issue any of the <a href="http://redis.io/commands">Redis commands</a> to the instance. Laravel uses magic methods to pass the commands to the Redis server:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>Notice the arguments to the command are simply passed into the magic method. Of course, you are not required to use the magic methods, you may also pass commands to the server using the <code>command</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$values</span> <span class="o">=</span> <span class="nx">$redis</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;lrange&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
</pre></div>

<p>When you are simply executing commands against the default connection, just use static magic methods on the <code>Redis</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Redis <a href="/docs/4.2/cache">cache</a> and <a href="/docs/4.2/session">session</a> drivers are included with Laravel.</p>
</blockquote>

<p><a name="pipelining"></a></p>

<h2>Pipelining</h2>

<p>Pipelining should be used when you need to send many commands to the server in one operation. To get started, use the <code>pipeline</code> command:</p>

<h4>Piping Many Commands To Your Servers</h4>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">pipeline</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$pipe</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$pipe</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;key:$i&quot;</span><span class="p">,</span> <span class="nx">$i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Release Notes</h1>

<ul>
<li><a href="#laravel-4.2">Laravel 4.2</a></li>
<li><a href="#laravel-4.1">Laravel 4.1</a></li>
</ul>

<p><a name="laravel-4.2"></a></p>

<h2>Laravel 4.2</h2>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.2 installation, or by <a href="https://github.com/laravel/framework/blob/4.2/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<blockquote>
<p><strong>Note:</strong> During the 4.2 release cycle, many small bug fixes and enhancements were incorporated into the various Laravel 4.1 point releases. So, be sure to check the change list for Laravel 4.1 as well!</p>
</blockquote>

<h3>PHP 5.4 Requirement</h3>

<p>Laravel 4.2 requires PHP 5.4 or greater. This upgraded PHP requirement allows us to use new PHP features such as traits to provide more expressive interfaces for tools like <a href="/docs/4.2/billing">Laravel Cashier</a>. PHP 5.4 also brings significant speed and performance improvements over PHP 5.3.</p>

<h3>Laravel Forge</h3>

<p>Laravel Forge, a new web based application, provides a simple way to create and manage PHP servers on the cloud of your choice, including Linode, DigitalOcean, Rackspace, and Amazon EC2. Supporting automated Nginx configuration, SSH key access, Cron job automation, server monitoring via NewRelic &amp; Papertrail, &quot;Push To Deploy&quot;, Laravel queue worker configuration, and more, Forge provides the simplest and most affordable way to launch all of your Laravel applications.</p>

<p>The default Laravel 4.2 installation&#39;s <code>app/config/database.php</code> configuration file is now configured for Forge usage by default, allowing for more convenient deployment of fresh applications onto the platform.</p>

<p>More information about Laravel Forge can be found on the <a href="https://forge.laravel.com">official Forge website</a>.</p>

<h3>Laravel Homestead</h3>

<p>Laravel Homestead is an official Vagrant environment for developing robust Laravel and PHP applications. The vast majority of the boxes&#39; provisioning needs are handled before the box is packaged for distribution, allowing the box to boot extremely quickly. Homestead includes Nginx 1.6, PHP 5.6, MySQL, Postgres, Redis, Memcached, Beanstalk, Node, Gulp, Grunt, &amp; Bower. Homestead includes a simple <code>Homestead.yaml</code> configuration file for managing multiple Laravel applications on a single box.</p>

<p>The default Laravel 4.2 installation now includes an <code>app/config/local/database.php</code> configuration file that is configured to use the Homestead database out of the box, making Laravel initial installation and configuration more convenient.</p>

<p>The official documentation has also been updated to include <a href="/docs/4.2/homestead">Homestead documentation</a>.</p>

<h3>Laravel Cashier</h3>

<p>Laravel Cashier is a simple, expressive library for managing subscription billing with Stripe. With the introduction of Laravel 4.2, we are including Cashier documentation along with the main Laravel documentation, though installation of the component itself is still optional. This release of Cashier brings numerous bug fixes, multi-currency support, and compatibility with the latest Stripe API.</p>

<h3>Daemon Queue Workers</h3>

<p>The Artisan <code>queue:work</code> command now supports a <code>--daemon</code> option to start a worker in &quot;daemon mode&quot;, meaning the worker will continue to process jobs without ever re-booting the framework. This results in a significant reduction in CPU usage at the cost of a slightly more complex application deployment process.</p>

<p>More information about daemon queue workers can be found in the <a href="/docs/4.2/queues#daemon-queue-worker">queue documentation</a>.</p>

<h3>Mail API Drivers</h3>

<p>Laravel 4.2 introduces new Mailgun and Mandrill API drivers for the <code>Mail</code> functions. For many applications, this provides a faster and more reliable method of sending e-mails than the SMTP options. The new drivers utilize the Guzzle 4 HTTP library.</p>

<h3>Soft Deleting Traits</h3>

<p>A much cleaner architecture for &quot;soft deletes&quot; and other &quot;global scopes&quot; has been introduced via PHP 5.4 traits. This new architecture allows for the easier construction of similar global traits, and a cleaner separation of concerns within the framework itself.</p>

<p>More information on the new <code>SoftDeletingTrait</code> may be found in the <a href="/docs/4.2/eloquent#soft-deleting">Eloquent documentation</a>.</p>

<h3>Convenient Auth &amp; Remindable Traits</h3>

<p>The default Laravel 4.2 installation now uses simple traits for including the needed properties for the authentication and password reminder user interfaces. This provides a much cleaner default <code>User</code> model file out of the box.</p>

<h3>&quot;Simple Paginate&quot;</h3>

<p>A new <code>simplePaginate</code> method was added to the query and Eloquent builder which allows for more efficient queries when using simple &quot;Next&quot; and &quot;Previous&quot; links in your pagination view.</p>

<h3>Migration Confirmation</h3>

<p>In production, destructive migration operations will now ask for confirmation. Commands may be forced to run without any prompts using the <code>--force</code> command.</p>

<p><a name="laravel-4.1"></a></p>

<h2>Laravel 4.1</h2>

<h3>Full Change List</h3>

<p>The full change list for this release by running the <code>php artisan changes</code> command from a 4.1 installation, or by <a href="https://github.com/laravel/framework/blob/4.1/src/Illuminate/Foundation/changes.json">viewing the change file on Github</a>. These notes only cover the major enhancements and changes for the release.</p>

<h3>New SSH Component</h3>

<p>An entirely new <code>SSH</code> component has been introduced with this release. This feature allows you to easily SSH into remote servers and run commands. To learn more, consult the <a href="/docs/4.2/ssh">SSH component documentation</a>.</p>

<p>The new <code>php artisan tail</code> command utilizes the new SSH component. For more information, consult the <code>tail</code> <a href="http://laravel.com/docs/4.2/ssh#tailing-remote-logs">command documentation</a>.</p>

<h3>Boris In Tinker</h3>

<p>The <code>php artisan tinker</code> command now utilizes the <a href="https://github.com/d11wtq/boris">Boris REPL</a> if your system supports it. The <code>readline</code> and <code>pcntl</code> PHP extensions must be installed to use this feature. If you do not have these extensions, the shell from 4.0 will be used.</p>

<h3>Eloquent Improvements</h3>

<p>A new <code>hasManyThrough</code> relationship has been added to Eloquent. To learn how to use it, consult the <a href="/docs/4.2/eloquent#has-many-through">Eloquent documentation</a>.</p>

<p>A new <code>whereHas</code> method has also been introduced to allow <a href="/docs/4.2/eloquent#querying-relations">retrieving models based on relationship constraints</a>.</p>

<h3>Database Read / Write Connections</h3>

<p>Automatic handling of separate read / write connections is now available throughout the database layer, including the query builder and Eloquent. For more information, consult <a href="/docs/4.2/database#read-write-connections">the documentation</a>.</p>

<h3>Queue Priority</h3>

<p>Queue priorities are now supported by passing a comma-delimited list to the <code>queue:listen</code> command.</p>

<h3>Failed Queue Job Handling</h3>

<p>The queue facilities now include automatic handling of failed jobs when using the new <code>--tries</code> switch on <code>queue:listen</code>. More information on handling failed jobs can be found in the <a href="/docs/4.2/queues#failed-jobs">queue documentation</a>.</p>

<h3>Cache Tags</h3>

<p>Cache &quot;sections&quot; have been superseded by &quot;tags&quot;. Cache tags allow you to assign multiple &quot;tags&quot; to a cache item, and flush all items assigned to a single tag. More information on using cache tags may be found in the <a href="/docs/4.2/cache#cache-tags">cache documentation</a>.</p>

<h3>Flexible Password Reminders</h3>

<p>The password reminder engine has been changed to provide greater developer flexibility when validating passwords, flashing status messages to the session, etc. For more information on using the enhanced password reminder engine, <a href="/docs/4.2/security#password-reminders-and-reset">consult the documentation</a>.</p>

<h3>Improved Routing Engine</h3>

<p>Laravel 4.1 features a totally re-written routing layer. The API is the same; however, registering routes is a full 100% faster compared to 4.0. The entire engine has been greatly simplified, and the dependency on Symfony Routing has been minimized to the compiling of route expressions.</p>

<h3>Improved Session Engine</h3>

<p>With this release, we&#39;re also introducing an entirely new session engine. Similar to the routing improvements, the new session layer is leaner and faster. We are no longer using Symfony&#39;s (and therefore PHP&#39;s) session handling facilities, and are using a custom solution that is simpler and easier to maintain.</p>

<h3>Doctrine DBAL</h3>

<p>If you are using the <code>renameColumn</code> function in your migrations, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file. This package is no longer included in Laravel by default.</p>
<div style="page-break-after: always;" ></div><h1>Requests &amp; Input</h1>

<ul>
<li><a href="#basic-input">Basic Input</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#old-input">Old Input</a></li>
<li><a href="#files">Files</a></li>
<li><a href="#request-information">Request Information</a></li>
</ul>

<p><a name="basic-input"></a></p>

<h2>Basic Input</h2>

<p>You may access all user input with a few simple methods. You do not need to worry about the HTTP verb used for the request, as input is accessed in the same way for all verbs.</p>

<h4>Retrieving An Input Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Default Value If The Input Value Is Absent</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If An Input Value Is Present</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Getting All Input For The Request</h4>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Getting Only Some Of The Request Input</h4>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;credit_card&#39;</span><span class="p">);</span>
</pre></div>

<p>When working on forms with &quot;array&quot; inputs, you may use dot notation to access the arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;products.0.name&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Some JavaScript libraries such as Backbone may send input to the application as JSON. You may access this data via <code>Input::get</code> like normal.</p>
</blockquote>

<p><a name="cookies"></a></p>

<h2>Cookies</h2>

<p>All cookies created by the Laravel framework are encrypted and signed with an authentication code, meaning they will be considered invalid if they have been changed by the client.</p>

<h4>Retrieving A Cookie Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Attaching A New Cookie To A Response</h4>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>

<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">));</span>
</pre></div>

<h4>Queueing A Cookie For The Next Response</h4>

<p>If you would like to set a cookie before a response has been created, use the <code>Cookie::queue()</code> method. The cookie will automatically be attached to the final response from your application.</p>
<div class="highlight"><pre><span></span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<h4>Creating A Cookie That Lasts Forever</h4>
<div class="highlight"><pre><span></span><span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="o">::</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="old-input"></a></p>

<h2>Old Input</h2>

<p>You may need to keep input from one request until the next request. For example, you may need to re-populate a form after checking it for validation errors.</p>

<h4>Flashing Input To The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Input</span><span class="o">::</span><span class="nx">flash</span><span class="p">();</span>
</pre></div>

<h4>Flashing Only Some Input To The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Input</span><span class="o">::</span><span class="nx">flashOnly</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">);</span>

<span class="nx">Input</span><span class="o">::</span><span class="nx">flashExcept</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>

<p>Since you often will want to flash input in association with a redirect to the previous page, you may easily chain input flashing onto a redirect.</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You may flash other data across requests using the <a href="/docs/4.2/session">Session</a> class.</p>
</blockquote>

<h4>Retrieving Old Data</h4>
<div class="highlight"><pre><span></span><span class="nx">Input</span><span class="o">::</span><span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="files"></a></p>

<h2>Files</h2>

<h4>Retrieving An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$file</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If A File Was Uploaded</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">hasFile</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The object returned by the <code>file</code> method is an instance of the <code>Symfony\Component\HttpFoundation\File\UploadedFile</code> class, which extends the PHP <code>SplFileInfo</code> class and provides a variety of methods for interacting with the file.</p>

<h4>Determining If An Uploaded File Is Valid</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Moving An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">);</span>

<span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">move</span><span class="p">(</span><span class="nx">$destinationPath</span><span class="p">,</span> <span class="nx">$fileName</span><span class="p">);</span>
</pre></div>

<h4>Retrieving The Path To An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getRealPath</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Original Name Of An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getClientOriginalName</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Extension Of An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$extension</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getClientOriginalExtension</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Size Of An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$size</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getSize</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The MIME Type Of An Uploaded File</h4>
<div class="highlight"><pre><span></span><span class="nx">$mime</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getMimeType</span><span class="p">();</span>
</pre></div>

<p><a name="request-information"></a></p>

<h2>Request Information</h2>

<p>The <code>Request</code> class provides many methods for examining the HTTP request for your application and extends the <code>Symfony\Component\HttpFoundation\Request</code> class. Here are some of the highlights.</p>

<h4>Retrieving The Request URI</h4>
<div class="highlight"><pre><span></span><span class="nx">$uri</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">path</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Request Method</h4>
<div class="highlight"><pre><span></span><span class="nx">$method</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">method</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">isMethod</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If The Request Path Matches A Pattern</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Get The Request URL</h4>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">url</span><span class="p">();</span>
</pre></div>

<h4>Retrieve A Request URI Segment</h4>
<div class="highlight"><pre><span></span><span class="nx">$segment</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">segment</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Request Header</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving Values From $_SERVER</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="nx">server</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If The Request Is Over HTTPS</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">secure</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determine If The Request Is Using AJAX</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">ajax</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determine If The Request Has JSON Content Type</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">isJson</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determine If The Request Is Asking For JSON</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">wantsJson</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Checking The Requested Response Format</h4>

<p>The <code>Request::format</code> method will return the requested response format based on the HTTP Accept header:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="nx">format</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Views &amp; Responses</h1>

<ul>
<li><a href="#basic-responses">Basic Responses</a></li>
<li><a href="#redirects">Redirects</a></li>
<li><a href="#views">Views</a></li>
<li><a href="#view-composers">View Composers</a></li>
<li><a href="#special-responses">Special Responses</a></li>
<li><a href="#response-macros">Response Macros</a></li>
</ul>

<p><a name="basic-responses"></a></p>

<h2>Basic Responses</h2>

<h4>Returning Strings From Routes</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Creating Custom Responses</h4>

<p>A <code>Response</code> instance inherits from the <code>Symfony\Component\HttpFoundation\Response</code> class, providing a variety of methods for building HTTP responses.</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$contents</span><span class="p">,</span> <span class="nx">$statusCode</span><span class="p">);</span>

<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$response</span><span class="p">;</span>
</pre></div>

<p>If you need access to the <code>Response</code> class methods, but want to return a view as the response content, you may use the <code>Response::view</code> method for convenience:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">);</span>
</pre></div>

<h4>Attaching Cookies To Responses</h4>
<div class="highlight"><pre><span></span><span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">$cookie</span><span class="p">);</span>
</pre></div>

<p><a name="redirects"></a></p>

<h2>Redirects</h2>

<h4>Returning A Redirect</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Redirect With Flash Data</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;Login Failed&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Since the <code>with</code> method flashes data to the session, you may retrieve the data using the typical <code>Session::get</code> method.</p>
</blockquote>

<h4>Returning A Redirect To A Named Route</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Redirect To A Named Route With Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>

<h4>Returning A Redirect To A Named Route Using Named Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>

<h4>Returning A Redirect To A Controller Action</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<h4>Returning A Redirect To A Controller Action With Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>

<h4>Returning A Redirect To A Controller Action Using Named Parameters</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>

<p><a name="views"></a></p>

<h2>Views</h2>

<p>Views typically contain the HTML of your application and provide a convenient way of separating your controller and domain logic from your presentation logic. Views are stored in the <code>app/views</code> directory.</p>

<p>A simple view could look something like this:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">View</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">app</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$name</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>This view may be returned to the browser like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>The second argument passed to <code>View::make</code> is an array of data that should be made available to the view.</p>

<h4>Passing Data To Views</h4>
<div class="highlight"><pre><span></span><span class="c1">// Using conventional approach</span>
<span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">);</span>

<span class="c1">// Using Magic Methods</span>
<span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withName</span><span class="p">(</span><span class="s1">&#39;steve&#39;</span><span class="p">);</span>
</pre></div>

<p>In the example above the variable <code>$name</code> would be accessible from the view, and would contain <code>Steve</code>.</p>

<p>If you wish, you may pass an array of data as the second parameter given to the <code>make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greetings&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p>You may also share a piece of data across all views:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">share</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">);</span>
</pre></div>

<h4>Passing A Sub-View To A View</h4>

<p>Sometimes you may wish to pass a view into another view. For example, given a sub-view stored at <code>app/views/child/view.php</code>, we could pass it to another view like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nest</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;child.view&#39;</span><span class="p">);</span>

<span class="nx">$view</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nest</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;child.view&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p>The sub-view can then be rendered from the parent view:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="o">!&lt;</span><span class="err">/h1&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$child</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<h4>Determining If A View Exists</h4>

<p>If you need to check if a view exists, use the <code>View::exists</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">View</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;emails.customer&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="view-composers"></a></p>

<h2>View Composers</h2>

<p>View composers are callbacks or class methods that are called when a view is rendered. If you have data that you want bound to a given view each time that view is rendered throughout your application, a view composer can organize that code into a single location. Therefore, view composers may function like &quot;view models&quot; or &quot;presenters&quot;.</p>

<h4>Defining A View Composer</h4>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$view</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$view</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">User</span><span class="o">::</span><span class="nx">count</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>Now each time the <code>profile</code> view is rendered, the <code>count</code> data will be bound to the view.</p>

<p>You may also attach a view composer to multiple views at once:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span><span class="s1">&#39;dashboard&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$view</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$view</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">User</span><span class="o">::</span><span class="nx">count</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>If you would rather use a class based composer, which will provide the benefits of being resolved through the application <a href="/docs/4.2/ioc">IoC Container</a>, you may do so:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;ProfileComposer&#39;</span><span class="p">);</span>
</pre></div>

<p>A view composer class should be defined like so:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">ProfileComposer</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">$view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$view</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">User</span><span class="o">::</span><span class="nx">count</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Defining Multiple Composers</h4>

<p>You may use the <code>composers</code> method to register a group of composers at the same time:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composers</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;AdminComposer&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;admin.index&#39;</span><span class="p">,</span> <span class="s1">&#39;admin.profile&#39;</span><span class="p">),</span>
    <span class="s1">&#39;UserComposer&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ProductComposer@create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;product&#39;</span>
<span class="p">));</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> There is no convention on where composer classes may be stored. You are free to store them anywhere as long as they can be autoloaded using the directives in your <code>composer.json</code> file.</p>
</blockquote>

<h3>View Creators</h3>

<p>View <strong>creators</strong> work almost exactly like view composers; however, they are fired immediately when the view is instantiated. To register a view creator, simply use the <code>creator</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">creator</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$view</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$view</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">User</span><span class="o">::</span><span class="nx">count</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p><a name="special-responses"></a></p>

<h2>Special Responses</h2>

<h4>Creating A JSON Response</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">json</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">));</span>
</pre></div>

<h4>Creating A JSONP Response</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">json</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">setCallback</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">));</span>
</pre></div>

<h4>Creating A File Download Response</h4>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Symfony HttpFoundation, which manages file downloads, requires the file being downloaded to have an ASCII file name.</p>
</blockquote>

<p><a name="response-macros"></a></p>

<h2>Response Macros</h2>

<p>If you would like to define a custom response that you can re-use in a variety of your routes and controllers, you may use the <code>Response::macro</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Response</span><span class="o">::</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$value</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>The <code>macro</code> function accepts a name as its first argument, and a Closure as its second. The macro&#39;s Closure will be executed when calling the macro name on the <code>Response</code> class:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">caps</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p>You may define your macros in one of your <code>app/start</code> files. Alternatively, you may organize your macros into a separate file which is included from one of your <code>start</code> files.</p>
<div style="page-break-after: always;" ></div><h1>Routing</h1>

<ul>
<li><a href="#basic-routing">Basic Routing</a></li>
<li><a href="#route-parameters">Route Parameters</a></li>
<li><a href="#route-filters">Route Filters</a></li>
<li><a href="#named-routes">Named Routes</a></li>
<li><a href="#route-groups">Route Groups</a></li>
<li><a href="#sub-domain-routing">Sub-Domain Routing</a></li>
<li><a href="#route-prefixing">Route Prefixing</a></li>
<li><a href="#route-model-binding">Route Model Binding</a></li>
<li><a href="#throwing-404-errors">Throwing 404 Errors</a></li>
<li><a href="#routing-to-controllers">Routing To Controllers</a></li>
</ul>

<p><a name="basic-routing"></a></p>

<h2>Basic Routing</h2>

<p>Most of the routes for your application will be defined in the <code>app/routes.php</code> file. The simplest Laravel routes consist of a URI and a Closure callback.</p>

<h4>Basic GET Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Basic POST Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;foo/bar&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Route For Multiple Verbs</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">match</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">),</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Registering A Route Responding To Any HTTP Verb</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">any</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Forcing A Route To Be Served Over HTTPS</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Must be over HTTPS&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<p>Often, you will need to generate URLs to your routes, you may do so using the <code>URL::to</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="route-parameters"></a></p>

<h2>Route Parameters</h2>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;User &#39;</span><span class="p">.</span><span class="nx">$id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Optional Route Parameters</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Optional Route Parameters With Defaults</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Regular Expression Route Constraints</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;[A-Za-z]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>
</pre></div>

<h4>Passing An Array Of Wheres</h4>

<p>Of course, you may pass an array of constraints when necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[a-z]+&#39;</span><span class="p">))</span>
</pre></div>

<h4>Defining Global Patterns</h4>

<p>If you would like a route parameter to always be constrained by a given regular expression, you may use the <code>pattern</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Only called if {id} is numeric.</span>
<span class="p">});</span>
</pre></div>

<h4>Accessing A Route Parameter Value</h4>

<p>If you need to access a route parameter value outside of a route, you may use the <code>Route::input</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Route</span><span class="o">::</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-filters"></a></p>

<h2>Route Filters</h2>

<p>Route filters provide a convenient way of limiting access to a given route, which is useful for creating areas of your site which require authentication. There are several filters included in the Laravel framework, including an <code>auth</code> filter, an <code>auth.basic</code> filter, a <code>guest</code> filter, and a <code>csrf</code> filter. These are located in the <code>app/filters.php</code> file.</p>

<blockquote>
<p><strong>Note:</strong> Filters are disabled when the application environment is <code>testing</code>.</p>
</blockquote>

<h4>Defining A Route Filter</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>If the filter returns a response, that response is considered the response to the request and the route will not execute. Any <code>after</code> filters on the route are also cancelled.</p>

<h4>Attaching A Filter To A Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;You are over 200 years old!&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<h4>Attaching A Filter To A Controller Action</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">));</span>
</pre></div>

<h4>Attaching Multiple Filters To A Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth|old&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;You are authenticated and over 200 years old!&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<h4>Attaching Multiple Filters Via Array</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;old&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;You are authenticated and over 200 years old!&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<h4>Specifying Filter Parameters</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;age:200&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<p>After filters receive a <code>$response</code> as the third argument passed to the filter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$response</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Pattern Based Filters</h4>

<p>You may also specify that a filter applies to an entire set of routes based on their URI.</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">);</span>
</pre></div>

<p>In the example above, the <code>admin</code> filter would be applied to all routes beginning with <code>admin/</code>. The asterisk is used as a wildcard, and will match any combination of characters.</p>

<p>You may also constrain pattern filters by HTTP verbs:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">));</span>
</pre></div>

<h4>Filter Classes</h4>

<p>For advanced filtering, you may wish to use a class instead of a Closure. Since filter classes are resolved out of the application <a href="/docs/4.2/ioc">IoC Container</a>, you will be able to utilize dependency injection in these filters for greater testability.</p>

<h4>Registering A Class Based Filter</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooFilter&#39;</span><span class="p">);</span>
</pre></div>

<p>By default, the <code>filter</code> method on the <code>FooFilter</code> class will be called:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">FooFilter</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">filter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Filter logic...</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>If you do not wish to use the <code>filter</code> method, just specify another method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooFilter@foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="named-routes"></a></p>

<h2>Named Routes</h2>

<p>Named routes make referring to routes when generating redirects or URLs more convenient. You may specify a name for a route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}));</span>
</pre></div>

<p>You may also specify route names for controller actions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;uses&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UserController@showProfile&#39;</span><span class="p">));</span>
</pre></div>

<p>Now, you may use the route&#39;s name when generating URLs or redirects:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="nx">$redirect</span> <span class="o">=</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>You may access the name of a route that is running via the <code>currentRouteName</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteName</span><span class="p">();</span>
</pre></div>

<p><a name="route-groups"></a></p>

<h2>Route Groups</h2>

<p>Sometimes you may need to apply filters to a group of routes. Instead of specifying the filter on each route, you may use a route group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Has Auth Filter</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Has Auth Filter</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>You may also use the <code>namespace</code> parameter within your <code>group</code> array to specify all controllers within that group as being in a given namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;namespace&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="sub-domain-routing"></a></p>

<h2>Sub-Domain Routing</h2>

<p>Laravel routes are also able to handle wildcard sub-domains, and will pass your wildcard parameters from the domain:</p>

<h4>Registering Sub-Domain Routes</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{account}.myapp.com&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$account</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p><a name="route-prefixing"></a></p>

<h2>Route Prefixing</h2>

<p>A group of routes may be prefixed by using the <code>prefix</code> option in the attributes array of a group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p><a name="route-model-binding"></a></p>

<h2>Route Model Binding</h2>

<p>Model binding provides a convenient way to inject model instances into your routes. For example, instead of injecting a user&#39;s ID, you can inject the entire User model instance that matches the given ID. First, use the <code>Route::model</code> method to specify the model that should be used for a given parameter:</p>

<h4>Binding A Parameter To A Model</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">);</span>
</pre></div>

<p>Next, define a route that contains a <code>{user}</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Since we have bound the <code>{user}</code> parameter to the <code>User</code> model, a <code>User</code> instance will be injected into the route. So, for example, a request to <code>profile/1</code> will inject the <code>User</code> instance which has an ID of 1.</p>

<blockquote>
<p><strong>Note:</strong> If a matching model instance is not found in the database, a 404 error will be thrown.</p>
</blockquote>

<p>If you wish to specify your own &quot;not found&quot; behavior, you may pass a Closure as the third argument to the <code>model</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Sometimes you may wish to use your own resolver for route parameters. Simply use the <code>Route::bind</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$route</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="throwing-404-errors"></a></p>

<h2>Throwing 404 Errors</h2>

<p>There are two ways to manually trigger a 404 error from a route. First, you may use the <code>App::abort</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="o">::</span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>Second, you may throw an instance of <code>Symfony\Component\HttpKernel\Exception\NotFoundHttpException</code>.</p>

<p>More information on handling 404 exceptions and using custom responses for these errors may be found in the <a href="/docs/4.2/errors#handling-404-errors">errors</a> section of the documentation.</p>

<p><a name="routing-to-controllers"></a></p>

<h2>Routing To Controllers</h2>

<p>Laravel allows you to not only route to Closures, but also to controller classes, and even allows the creation of <a href="/docs/4.2/controllers#restful-resource-controllers">resource controllers</a>.</p>

<p>See the documentation on <a href="/docs/4.2/controllers">Controllers</a> for more details.</p>
<div style="page-break-after: always;" ></div><h1>Schema Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-and-dropping-tables">Creating &amp; Dropping Tables</a></li>
<li><a href="#adding-columns">Adding Columns</a></li>
<li><a href="#renaming-columns">Renaming Columns</a></li>
<li><a href="#dropping-columns">Dropping Columns</a></li>
<li><a href="#checking-existence">Checking Existence</a></li>
<li><a href="#adding-indexes">Adding Indexes</a></li>
<li><a href="#foreign-keys">Foreign Keys</a></li>
<li><a href="#dropping-indexes">Dropping Indexes</a></li>
<li><a href="#dropping-timestamps">Dropping Timestamps &amp; Soft Deletes</a></li>
<li><a href="#storage-engines">Storage Engines</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Schema</code> class provides a database agnostic way of manipulating tables. It works well with all of the databases supported by Laravel, and has a unified API across all of these systems.</p>

<p><a name="creating-and-dropping-tables"></a></p>

<h2>Creating &amp; Dropping Tables</h2>

<p>To create a new database table, the <code>Schema::create</code> method is used:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>create</code> method is the name of the table, and the second is a <code>Closure</code> which will receive a <code>Blueprint</code> object which may be used to define the new table.</p>

<p>To rename an existing database table, the <code>rename</code> method may be used:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">rename</span><span class="p">(</span><span class="nx">$from</span><span class="p">,</span> <span class="nx">$to</span><span class="p">);</span>
</pre></div>

<p>To specify which connection the schema operation should take place on, use the <code>Schema::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>To drop a table, you may use the <code>Schema::drop</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>

<span class="nx">Schema</span><span class="o">::</span><span class="nx">dropIfExists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="adding-columns"></a></p>

<h2>Adding Columns</h2>

<p>To update an existing table, we will use the <code>Schema::table</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The table builder contains a variety of column types that you may use when building your tables:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;bigIncrements(&#39;id&#39;);</code>  |  Incrementing ID using a &quot;big integer&quot; equivalent.
<code>$table-&gt;bigInteger(&#39;votes&#39;);</code>  |  BIGINT equivalent to the table
<code>$table-&gt;binary(&#39;data&#39;);</code>  |  BLOB equivalent to the table
<code>$table-&gt;boolean(&#39;confirmed&#39;);</code>  |  BOOLEAN equivalent to the table
<code>$table-&gt;char(&#39;name&#39;, 4);</code>  |  CHAR equivalent with a length
<code>$table-&gt;date(&#39;created_at&#39;);</code>  |  DATE equivalent to the table
<code>$table-&gt;dateTime(&#39;created_at&#39;);</code>  |  DATETIME equivalent to the table
<code>$table-&gt;decimal(&#39;amount&#39;, 5, 2);</code>  |  DECIMAL equivalent with a precision and scale
<code>$table-&gt;double(&#39;column&#39;, 15, 8);</code>  |  DOUBLE equivalent with precision, 15 digits in total and 8 after the decimal point 
<code>$table-&gt;enum(&#39;choices&#39;, array(&#39;foo&#39;, &#39;bar&#39;));</code> | ENUM equivalent to the table
<code>$table-&gt;float(&#39;amount&#39;);</code>  |  FLOAT equivalent to the table
<code>$table-&gt;increments(&#39;id&#39;);</code>  |  Incrementing ID to the table (primary key).
<code>$table-&gt;integer(&#39;votes&#39;);</code>  |  INTEGER equivalent to the table
<code>$table-&gt;longText(&#39;description&#39;);</code>  |  LONGTEXT equivalent to the table
<code>$table-&gt;mediumInteger(&#39;numbers&#39;);</code>  |  MEDIUMINT equivalent to the table
<code>$table-&gt;mediumText(&#39;description&#39;);</code>  |  MEDIUMTEXT equivalent to the table
<code>$table-&gt;morphs(&#39;taggable&#39;);</code>  |  Adds INTEGER <code>taggable_id</code> and STRING <code>taggable_type</code>
<code>$table-&gt;nullableTimestamps();</code>  |  Same as <code>timestamps()</code>, except allows NULLs
<code>$table-&gt;smallInteger(&#39;votes&#39;);</code>  |  SMALLINT equivalent to the table
<code>$table-&gt;tinyInteger(&#39;numbers&#39;);</code>  |  TINYINT equivalent to the table
<code>$table-&gt;softDeletes();</code>  |  Adds <strong>deleted_at</strong> column for soft deletes
<code>$table-&gt;string(&#39;email&#39;);</code>  |  VARCHAR equivalent column
<code>$table-&gt;string(&#39;name&#39;, 100);</code>  |  VARCHAR equivalent with a length
<code>$table-&gt;text(&#39;description&#39;);</code>  |  TEXT equivalent to the table
<code>$table-&gt;time(&#39;sunrise&#39;);</code>  |  TIME equivalent to the table
<code>$table-&gt;timestamp(&#39;added_on&#39;);</code>  |  TIMESTAMP equivalent to the table
<code>$table-&gt;timestamps();</code>  |  Adds <strong>created_at</strong> and <strong>updated_at</strong> columns
<code>$table-&gt;rememberToken();</code>  |  Adds <code>remember_token</code> as VARCHAR(100) NULL
<code>-&gt;nullable()</code>  |  Designate that the column allows NULL values
<code>-&gt;default($value)</code>  |  Declare a default value for a column
<code>-&gt;unsigned()</code>  |  Set INTEGER to UNSIGNED</p>

<h4>Using After On MySQL</h4>

<p>If you are using the MySQL database, you may use the <code>after</code> method to specify the order of columns:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="renaming-columns"></a></p>

<h2>Renaming Columns</h2>

<p>To rename a column, you may use the <code>renameColumn</code> method on the Schema builder. Before renaming a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file.</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">renameColumn</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Renaming <code>enum</code> column types is not supported.</p>
</blockquote>

<p><a name="dropping-columns"></a></p>

<h2>Dropping Columns</h2>

<p>To drop a column, you may use the <code>dropColumn</code> method on the Schema builder. Before dropping a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file.</p>

<h4>Dropping A Column From A Database Table</h4>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Dropping Multiple Columns From A Database Table</h4>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p><a name="checking-existence"></a></p>

<h2>Checking Existence</h2>

<h4>Checking For Existence Of Table</h4>

<p>You may easily check for the existence of a table or column using the <code>hasTable</code> and <code>hasColumn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasTable</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Checking For Existence Of Columns</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasColumn</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="adding-indexes"></a></p>

<h2>Adding Indexes</h2>

<p>The schema builder supports several types of indexes. There are two ways to add them. First, you may fluently define them on a column definition, or you may add them separately:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
</pre></div>

<p>Or, you may choose to add the indexes on separate lines. Below is a list of all available index types:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;primary(&#39;id&#39;);</code>  |  Adding a primary key
<code>$table-&gt;primary(array(&#39;first&#39;, &#39;last&#39;));</code>  |  Adding composite keys
<code>$table-&gt;unique(&#39;email&#39;);</code>  |  Adding a unique index
<code>$table-&gt;index(&#39;state&#39;);</code>  |  Adding a basic index</p>

<p><a name="foreign-keys"></a></p>

<h2>Foreign Keys</h2>

<p>Laravel also provides support for adding foreign key constraints to your tables:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unsigned</span><span class="p">();</span>
<span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<p>In this example, we are stating that the <code>user_id</code> column references the <code>id</code> column on the <code>users</code> table. Make sure to create the foreign key column first!</p>

<p>You may also specify options for the &quot;on delete&quot; and &quot;on update&quot; actions of the constraint:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">onDelete</span><span class="p">(</span><span class="s1">&#39;cascade&#39;</span><span class="p">);</span>
</pre></div>

<p>To drop a foreign key, you may use the <code>dropForeign</code> method. A similar naming convention is used for foreign keys as is used for other indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">(</span><span class="s1">&#39;posts_user_id_foreign&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> When creating a foreign key that references an incrementing integer, remember to always make the foreign key column <code>unsigned</code>.</p>
</blockquote>

<p><a name="dropping-indexes"></a></p>

<h2>Dropping Indexes</h2>

<p>To drop an index you must specify the index&#39;s name. Laravel assigns a reasonable name to the indexes by default. Simply concatenate the table name, the names of the column in the index, and the index type. Here are some examples:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;dropPrimary(&#39;users_id_primary&#39;);</code>  |  Dropping a primary key from the &quot;users&quot; table
<code>$table-&gt;dropUnique(&#39;users_email_unique&#39;);</code>  |  Dropping a unique index from the &quot;users&quot; table
<code>$table-&gt;dropIndex(&#39;geo_state_index&#39;);</code>  |  Dropping a basic index from the &quot;geo&quot; table</p>

<p><a name="dropping-timestamps"></a></p>

<h2>Dropping Timestamps &amp; SoftDeletes</h2>

<p>To drop the <code>timestamps</code>, <code>nullableTimestamps</code> or <code>softDeletes</code> column types, you may use the following methods:</p>

<p>Command  | Description
------------- | -------------
<code>$table-&gt;dropTimestamps();</code>  |  Dropping the <strong>created_at</strong> and <strong>updated_at</strong> columns from the table
<code>$table-&gt;dropSoftDeletes();</code>  |  Dropping <strong>deleted_at</strong> column from the table</p>

<p><a name="storage-engines"></a></p>

<h2>Storage Engines</h2>

<p>To set the storage engine for a table, set the <code>engine</code> property on the schema builder:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">engine</span> <span class="o">=</span> <span class="s1">&#39;InnoDB&#39;</span><span class="p">;</span>

    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Security</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#storing-passwords">Storing Passwords</a></li>
<li><a href="#authenticating-users">Authenticating Users</a></li>
<li><a href="#manually">Manually Logging In Users</a></li>
<li><a href="#protecting-routes">Protecting Routes</a></li>
<li><a href="#http-basic-authentication">HTTP Basic Authentication</a></li>
<li><a href="#password-reminders-and-reset">Password Reminders &amp; Reset</a></li>
<li><a href="#encryption">Encryption</a></li>
<li><a href="#authentication-drivers">Authentication Drivers</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel aims to make implementing authentication very simple. In fact, almost everything is configured for you out of the box. The authentication configuration file is located at <code>app/config/auth.php</code>, which contains several well documented options for tweaking the behavior of the authentication facilities.</p>

<p>By default, Laravel includes a <code>User</code> model in your <code>app/models</code> directory which may be used with the default Eloquent authentication driver. Please remember when building the Schema for this Model to ensure that the password field is a minimum of 60 characters.</p>

<p>If your application is not using Eloquent, you may use the <code>database</code> authentication driver which uses the Laravel query builder.</p>

<blockquote>
<p><strong>Note:</strong> Before getting started, make sure that your <code>users</code> (or equivalent) table contains a nullable, string <code>remember_token</code> column of 100 characters. This column will be used to store a token for &quot;remember me&quot; sessions being maintained by your application. This can be done by using <code>$table-&gt;rememberToken();</code> in a migration.</p>
</blockquote>

<p><a name="storing-passwords"></a></p>

<h2>Storing Passwords</h2>

<p>The Laravel <code>Hash</code> class provides secure Bcrypt hashing:</p>

<h4>Hashing A Password Using Bcrypt</h4>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
</pre></div>

<h4>Verifying A Password Against A Hash</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="nx">$hashedPassword</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The passwords match...</span>
<span class="p">}</span>
</pre></div>

<h4>Checking If A Password Needs To Be Rehashed</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">needsRehash</span><span class="p">(</span><span class="nx">$hashed</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="authenticating-users"></a></p>

<h2>Authenticating Users</h2>

<p>To log a user into your application, you may use the <code>Auth::attempt</code> method.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">)))</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">intended</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Take note that <code>email</code> is not a required option, it is merely used for example. You should use whatever column name corresponds to a &quot;username&quot; in your database. The <code>Redirect::intended</code> function will redirect the user to the URL they were trying to access before being caught by the authentication filter. A fallback URI may be given to this method in case the intended destination is not available.</p>

<p>When the <code>attempt</code> method is called, the <code>auth.attempt</code> <a href="/docs/4.2/events">event</a> will be fired. If the authentication attempt is successful and the user is logged in, the <code>auth.login</code> event will be fired as well.</p>

<h4>Determining If A User Is Authenticated</h4>

<p>To determine if the user is already logged into your application, you may use the <code>check</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// The user is logged in...</span>
<span class="p">}</span>
</pre></div>

<h4>Authenticating A User And &quot;Remembering&quot; Them</h4>

<p>If you would like to provide &quot;remember me&quot; functionality in your application, you may pass <code>true</code> as the second argument to the <code>attempt</code> method, which will keep the user authenticated indefinitely (or until they manually logout). Of course, your <code>users</code> table must include the string <code>remember_token</code> column, which will be used to store the &quot;remember me&quot; token.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">),</span> <span class="kc">true</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// The user is being remembered...</span>
<span class="p">}</span>
</pre></div>

<p><strong>Note:</strong> If the <code>attempt</code> method returns <code>true</code>, the user is considered logged into the application.</p>

<h4>Determining If User Authed Via Remember</h4>

<p>If you are &quot;remembering&quot; user logins, you may use the <code>viaRemember</code> method to determine if the user was authenticated using the &quot;remember me&quot; cookie:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">viaRemember</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Authenticating A User With Conditions</h4>

<p>You also may add extra conditions to the authenticating query:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">{</span>
    <span class="c1">// The user is active, not suspended, and exists.</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> For added protection against session fixation, the user&#39;s session ID will automatically be regenerated after authenticating.</p>
</blockquote>

<h4>Accessing The Logged In User</h4>

<p>Once a user is authenticated, you may access the User model / record:</p>
<div class="highlight"><pre><span></span><span class="nx">$email</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
</pre></div>

<p>To retrieve the authenticated user&#39;s ID, you may use the <code>id</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$id</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">id</span><span class="p">();</span>
</pre></div>

<p>To simply log a user into the application by their ID, use the <code>loginUsingId</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">loginUsingId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<h4>Validating User Credentials Without Login</h4>

<p>The <code>validate</code> method allows you to validate a user&#39;s credentials without actually logging them into the application:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">validate</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Logging A User In For A Single Request</h4>

<p>You may also use the <code>once</code> method to log a user into the application for a single request. No sessions or cookies will be utilized.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">once</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Logging A User Out Of The Application</h4>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">logout</span><span class="p">();</span>
</pre></div>

<p><a name="manually"></a></p>

<h2>Manually Logging In Users</h2>

<p>If you need to log an existing user instance into your application, you may simply call the <code>login</code> method with the instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">Auth</span><span class="o">::</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<p>This is equivalent to logging in a user via credentials using the <code>attempt</code> method.</p>

<p><a name="protecting-routes"></a></p>

<h2>Protecting Routes</h2>

<p>Route filters may be used to allow only authenticated users to access a given route. Laravel provides the <code>auth</code> filter by default, and it is defined in <code>app/filters.php</code>.</p>

<h4>Protecting A Route</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}));</span>
</pre></div>

<h3>CSRF Protection</h3>

<p>Laravel provides an easy method of protecting your application from cross-site request forgeries.</p>

<h4>Inserting CSRF Token Into Form</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nx">csrf_token</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</pre></div>

<h4>Validate The Submitted CSRF Token</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;csrf&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;You gave a valid CSRF token!&#39;</span><span class="p">;</span>
<span class="p">}));</span>
</pre></div>

<p><a name="http-basic-authentication"></a></p>

<h2>HTTP Basic Authentication</h2>

<p>HTTP Basic Authentication provides a quick way to authenticate users of your application without setting up a dedicated &quot;login&quot; page. To get started, attach the <code>auth.basic</code> filter to your route:</p>

<h4>Protecting A Route With HTTP Basic</h4>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;before&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;auth.basic&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">}));</span>
</pre></div>

<p>By default, the <code>basic</code> filter will use the <code>email</code> column on the user record when authenticating. If you wish to use another column you may pass the column name as the first parameter to the <code>basic</code> method in your <code>app/filters.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;auth.basic&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">basic</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Setting Up A Stateless HTTP Basic Filter</h4>

<p>You may also use HTTP Basic Authentication without setting a user identifier cookie in the session, which is particularly useful for API authentication. To do so, define a filter that returns the <code>onceBasic</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;basic.once&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">onceBasic</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If you are using PHP FastCGI, HTTP Basic authentication will not work correctly by default. The following lines should be added to your <code>.htaccess</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}</span> <span class="o">^</span><span class="p">(.</span><span class="o">+</span><span class="p">)</span><span class="nx">$</span>
<span class="nx">RewriteRule</span> <span class="p">.</span><span class="o">*</span> <span class="o">-</span> <span class="p">[</span><span class="nx">E</span><span class="o">=</span><span class="nx">HTTP_AUTHORIZATION</span><span class="o">:%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}]</span>
</pre></div>

<p><a name="password-reminders-and-reset"></a></p>

<h2>Password Reminders &amp; Reset</h2>

<h3>Model &amp; Table</h3>

<p>Most web applications provide a way for users to reset their forgotten passwords. Rather than forcing you to re-implement this on each application, Laravel provides convenient methods for sending password reminders and performing password resets. To get started, verify that your <code>User</code> model implements the <code>Illuminate\Auth\Reminders\RemindableInterface</code> contract. Of course, the <code>User</code> model included with the framework already implements this interface, and uses the <code>Illuminate\Auth\Reminders\RemindableTrait</code> to include the methods needed to implement the interface.</p>

<h4>Implementing The RemindableInterface</h4>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Reminders</span><span class="err">\</span><span class="nx">RemindableTrait</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Reminders</span><span class="err">\</span><span class="nx">RemindableInterface</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="kr">implements</span> <span class="nx">RemindableInterface</span> <span class="p">{</span>

    <span class="nx">use</span> <span class="nx">RemindableTrait</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>

<h4>Generating The Reminder Table Migration</h4>

<p>Next, a table must be created to store the password reset tokens. To generate a migration for this table, simply execute the <code>auth:reminders-table</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">auth</span><span class="o">:</span><span class="nx">reminders</span><span class="o">-</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h3>Password Reminder Controller</h3>

<p>Now we&#39;re ready to generate the password reminder controller. To automatically generate a controller, you may use the <code>auth:reminders-controller</code> Artisan command, which will create a <code>RemindersController.php</code> file in your <code>app/controllers</code> directory.</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">auth</span><span class="o">:</span><span class="nx">reminders</span><span class="o">-</span><span class="nx">controller</span>
</pre></div>

<p>The generated controller will already have a <code>getRemind</code> method that handles showing your password reminder form. All you need to do is create a <code>password.remind</code> <a href="/docs/4.2/templates">Template</a> by creating a file <code>remind.blade.php</code> in the <code>app/views/password/</code> directory.
This view should have a basic form with an <code>email</code> field. The form should POST to the <code>RemindersController@postRemind</code> action.</p>

<p>A simple form on the <code>password.remind</code> view might look like this:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;{{ action(&#39;RemindersController@postRemind&#39;) }}&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Send Reminder&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>In addition to <code>getRemind</code>, the generated controller will already have a <code>postRemind</code> method that handles sending the password reminder e-mails to your users. This method expects the <code>email</code> field to be present in the <code>POST</code> variables. If the reminder e-mail is successfully sent to the user, a <code>status</code> message will be flashed to the session. If the reminder fails, an <code>error</code> message will be flashed instead.</p>

<p>Within the <code>postRemind</code> controller method you may modify the message instance before it is sent to the user:</p>
<div class="highlight"><pre><span></span><span class="nx">Password</span><span class="o">::</span><span class="nx">remind</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Password Reminder&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Your user will receive an e-mail with a link that points to the <code>getReset</code> method of the controller. The password reminder token, which is used to identify a given password reminder attempt, will also be passed to the controller method. The action is already configured to return a <code>password.reset</code> template which you should build. The <code>token</code> will be passed to the view, and you should place this token in a hidden form field named <code>token</code>. In addition to the <code>token</code>, your password reset form should contain <code>email</code>, <code>password</code>, and <code>password_confirmation</code> fields. The form should POST to the <code>RemindersController@postReset</code> method.</p>

<p>A simple form on the <code>password.reset</code> view might look like this:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;{{ action(&#39;RemindersController@postReset&#39;) }}&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ $token }}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password_confirmation&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Reset Password&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>Finally, the <code>postReset</code> method is responsible for actually changing the password in storage. In this controller action, the Closure passed to the <code>Password::reset</code> method sets the <code>password</code> attribute on the <code>User</code> and calls the <code>save</code> method. Of course, this Closure is assuming your <code>User</code> model is an <a href="/docs/4.2/eloquent">Eloquent model</a>; however, you are free to change this Closure as needed to be compatible with your application&#39;s database storage system.</p>

<p>If the password is successfully reset, the user will be redirected to the root of your application. Again, you are free to change this redirect URL. If the password reset fails, the user will be redirect back to the reset form, and an <code>error</code> message will be flashed to the session.</p>

<h3>Password Validation</h3>

<p>By default, the <code>Password::reset</code> method will verify that the passwords match and are &gt;= six characters. You may customize these rules using the <code>Password::validator</code> method, which accepts a Closure. Within this Closure, you may do any password validation you wish. Note that you are not required to verify that the passwords match, as this will be done automatically by the framework.</p>
<div class="highlight"><pre><span></span><span class="nx">Password</span><span class="o">::</span><span class="nx">validator</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">strlen</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, password reset tokens expire after one hour. You may change this via the <code>reminder.expire</code> option of your <code>app/config/auth.php</code> file.</p>
</blockquote>

<p><a name="encryption"></a></p>

<h2>Encryption</h2>

<p>Laravel provides facilities for strong AES encryption via the mcrypt PHP extension:</p>

<h4>Encrypting A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$encrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">encrypt</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Be sure to set a 16, 24, or 32 character random string in the <code>key</code> option of the <code>app/config/app.php</code> file. Otherwise, encrypted values will not be secure.</p>
</blockquote>

<h4>Decrypting A Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$decrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">$encryptedValue</span><span class="p">);</span>
</pre></div>

<h4>Setting The Cipher &amp; Mode</h4>

<p>You may also set the cipher and mode used by the encrypter:</p>
<div class="highlight"><pre><span></span><span class="nx">Crypt</span><span class="o">::</span><span class="nx">setMode</span><span class="p">(</span><span class="s1">&#39;ctr&#39;</span><span class="p">);</span>

<span class="nx">Crypt</span><span class="o">::</span><span class="nx">setCipher</span><span class="p">(</span><span class="nx">$cipher</span><span class="p">);</span>
</pre></div>

<p><a name="authentication-drivers"></a></p>

<h2>Authentication Drivers</h2>

<p>Laravel offers the <code>database</code> and <code>eloquent</code> authentication drivers out of the box. For more information about adding additional authentication drivers, check out the <a href="/docs/4.2/extending#authentication">Authentication extension documentation</a>.</p>
<div style="page-break-after: always;" ></div><h1>Session</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#session-usage">Session Usage</a></li>
<li><a href="#flash-data">Flash Data</a></li>
<li><a href="#database-sessions">Database Sessions</a></li>
<li><a href="#session-drivers">Session Drivers</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Since HTTP driven applications are stateless, sessions provide a way to store information about the user across requests. Laravel ships with a variety of session back-ends available for use through a clean, unified API. Support for popular back-ends such as <a href="http://memcached.org">Memcached</a>, <a href="http://redis.io">Redis</a>, and databases is included out of the box.</p>

<p>The session configuration is stored in <code>app/config/session.php</code>. Be sure to review the well documented options available to you in this file. By default, Laravel is configured to use the <code>file</code> session driver, which will work well for the majority of applications.</p>

<h4>Reserved Keys</h4>

<p>The Laravel framework uses the <code>flash</code> session key internally, so you should not add an item to the session by that name.</p>

<p><a name="session-usage"></a></p>

<h2>Session Usage</h2>

<h4>Storing An Item In The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h4>Push A Value Onto An Array Session Value</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;user.teams&#39;</span><span class="p">,</span> <span class="s1">&#39;developers&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving An Item Or Returning A Default Value</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span> <span class="p">});</span>
</pre></div>

<h4>Retrieving An Item And Forgetting It</h4>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Data From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="nx">Session</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Determining If An Item Exists In The Session</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Session</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Removing An Item From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Removing All Items From The Session</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<h4>Regenerating The Session ID</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">regenerate</span><span class="p">();</span>
</pre></div>

<p><a name="flash-data"></a></p>

<h2>Flash Data</h2>

<p>Sometimes you may wish to store items in the session only for the next request. You may do so using the <code>Session::flash</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<h4>Reflashing The Current Flash Data For Another Request</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">reflash</span><span class="p">();</span>
</pre></div>

<h4>Reflashing Only A Subset Of Flash Data</h4>
<div class="highlight"><pre><span></span><span class="nx">Session</span><span class="o">::</span><span class="nx">keep</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="database-sessions"></a></p>

<h2>Database Sessions</h2>

<p>When using the <code>database</code> session driver, you will need to setup a table to contain the session items. Below is an example <code>Schema</code> declaration for the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$table</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;last_activity&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Of course, you may use the <code>session:table</code> Artisan command to generate this migration for you!</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">session</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">composer</span> <span class="nx">dump</span><span class="o">-</span><span class="nx">autoload</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="session-drivers"></a></p>

<h2>Session Drivers</h2>

<p>The session &quot;driver&quot; defines where session data will be stored for each request. Laravel ships with several great drivers out of the box:</p>

<ul>
<li><code>file</code> - sessions will be stored in <code>app/storage/sessions</code>.</li>
<li><code>cookie</code> - sessions will be stored in secure, encrypted cookies.</li>
<li><code>database</code> - sessions will be stored in a database used by your application.</li>
<li><code>memcached</code> / <code>redis</code> - sessions will be stored in one of these fast, cached based stores.</li>
<li><code>array</code> - sessions will be stored in a simple PHP array and will not be persisted across requests.</li>
</ul>

<blockquote>
<p><strong>Note:</strong> The array driver is typically used for running <a href="/docs/4.2/testing">unit tests</a>, so no session data will be persisted.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>SSH</h1>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#tasks">Tasks</a></li>
<li><a href="#sftp-downloads">SFTP Downloads</a></li>
<li><a href="#sftp-uploads">SFTP Uploads</a></li>
<li><a href="#tailing-remote-logs">Tailing Remote Logs</a></li>
<li><a href="#envoy-task-runner">Envoy Task Runner</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel includes a simple way to SSH into remote servers and run commands, allowing you to easily build Artisan tasks that work on remote servers. The <code>SSH</code> facade provides the access point to connecting to your remote servers and running commands.</p>

<p>The configuration file is located at <code>app/config/remote.php</code>, and contains all of the options you need to configure your remote connections. The <code>connections</code> array contains a list of your servers keyed by name. Simply populate the credentials in the <code>connections</code> array and you will be ready to start running remote tasks. Note that the <code>SSH</code> can authenticate using either a password or an SSH key.</p>

<blockquote>
<p><strong>Note:</strong> Need to easily run a variety of tasks on your remote server? Check out the <a href="#envoy-task-runner">Envoy task runner</a>!</p>
</blockquote>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<h4>Running Commands On The Default Server</h4>

<p>To run commands on your <code>default</code> remote connection, use the <code>SSH::run</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">run</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;cd /var/www&#39;</span><span class="p">,</span>
    <span class="s1">&#39;git pull origin master&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>

<h4>Running Commands On A Specific Connection</h4>

<p>Alternatively, you may run commands on a specific connection using the <code>into</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">run</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;cd /var/www&#39;</span><span class="p">,</span>
    <span class="s1">&#39;git pull origin master&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>

<h4>Catching Output From Commands</h4>

<p>You may catch the &quot;live&quot; output of your remote commands by passing a Closure into the <code>run</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">run</span><span class="p">(</span><span class="nx">$commands</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$line</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$line</span><span class="p">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h2>Tasks</h2>

<p><a name="tasks"></a></p>

<p>If you need to define a group of commands that should always be run together, you may use the <code>define</code> method to define a <code>task</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;cd /var/www&#39;</span><span class="p">,</span>
    <span class="s1">&#39;git pull origin master&#39;</span><span class="p">,</span>
    <span class="s1">&#39;php artisan migrate&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>

<p>Once the task has been defined, you may use the <code>task</code> method to run it:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$line</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$line</span><span class="p">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="sftp-downloads"></a></p>

<h2>SFTP Downloads</h2>

<p>The <code>SSH</code> class includes a simple way to download files using the <code>get</code> and <code>getString</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="nx">$remotePath</span><span class="p">,</span> <span class="nx">$localPath</span><span class="p">);</span>

<span class="nx">$contents</span> <span class="o">=</span> <span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getString</span><span class="p">(</span><span class="nx">$remotePath</span><span class="p">);</span>
</pre></div>

<p><a name="sftp-uploads"></a></p>

<h2>SFTP Uploads</h2>

<p>The <code>SSH</code> class also includes a simple way to upload files, or even strings, to the server using the <code>put</code> and <code>putString</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="nx">$localFile</span><span class="p">,</span> <span class="nx">$remotePath</span><span class="p">);</span>

<span class="nx">SSH</span><span class="o">::</span><span class="nx">into</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">putString</span><span class="p">(</span><span class="nx">$remotePath</span><span class="p">,</span> <span class="s1">&#39;Foo&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="tailing-remote-logs"></a></p>

<h2>Tailing Remote Logs</h2>

<p>Laravel includes a helpful command for tailing the <code>laravel.log</code> files on any of your remote connections. Simply use the <code>tail</code> Artisan command and specify the name of the remote connection you would like to tail:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">tail</span> <span class="nx">staging</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">tail</span> <span class="nx">staging</span> <span class="o">--</span><span class="nx">path</span><span class="o">=</span><span class="err">/path/to/log.file</span>
</pre></div>

<p><a name="envoy-task-runner"></a></p>

<h2>Envoy Task Runner</h2>

<ul>
<li><a href="#envoy-installation">Installation</a></li>
<li><a href="#envoy-running-tasks">Running Tasks</a></li>
<li><a href="#envoy-multiple-servers">Multiple Servers</a></li>
<li><a href="#envoy-parallel-execution">Parallel Execution</a></li>
<li><a href="#envoy-task-macros">Task Macros</a></li>
<li><a href="#envoy-notifications">Notifications</a></li>
<li><a href="#envoy-updating-envoy">Updating Envoy</a></li>
</ul>

<p>Laravel Envoy provides a clean, minimal syntax for defining common tasks you run on your remote servers. Using a <a href="/docs/4.2/templates#blade-templating">Blade</a> style syntax, you can easily setup tasks for deployment, Artisan commands, and more.</p>

<blockquote>
<p><strong>Note:</strong> Envoy requires PHP version 5.4 or greater, and only runs on Mac / Linux operating systems.</p>
</blockquote>

<p><a name="envoy-installation"></a></p>

<h3>Installation</h3>

<p>First, install Envoy using the Composer <code>global</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="s2">&quot;laravel/envoy=~1.0&quot;</span>
</pre></div>

<p>Make sure to place the <code>~/.composer/vendor/bin</code> directory in your PATH so the <code>envoy</code> executable is found when you run the <code>envoy</code> command in your terminal.</p>

<p>Next, create an <code>Envoy.blade.php</code> file in the root of your project. Here&#39;s an example to get you started:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>As you can see, an array of <code>@servers</code> is defined at the top of the file. You can reference these servers in the <code>on</code> option of your task declarations. Within your <code>@task</code> declarations you should place the Bash code that will be run on your server when the task is executed.</p>

<p>The <code>init</code> command may be used to easily create a stub Envoy file:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">init</span> <span class="nx">user</span><span class="err">@</span><span class="mf">192.168.1.1</span>
</pre></div>

<p><a name="envoy-running-tasks"></a></p>

<h3>Running Tasks</h3>

<p>To run a task, use the <code>run</code> command of your Envoy installation:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">foo</span>
</pre></div>

<p>If needed, you may pass variables into the Envoy file using command line switches:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span> <span class="o">--</span><span class="nx">branch</span><span class="o">=</span><span class="nx">master</span>
</pre></div>

<p>You may use the options via the Blade syntax you are used to:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<h4>Bootstrapping</h4>

<p>You may use the <code>@setup</code> directive to declare variables and do general PHP work inside the Envoy file:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">setup</span>
    <span class="nx">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>

    <span class="nx">$environment</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$env</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$env</span> <span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">endsetup</span>
</pre></div>

<p>You may also use <code>@include</code> to include any PHP files:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="envoy-multiple-servers"></a></p>

<h3>Multiple Servers</h3>

<p>You may easily run a task across multiple servers. Simply list the servers in the task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">]])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>By default, the task will be executed on each server serially. Meaning, the task will finish running on the first server before proceeding to execute on the next server.</p>

<p><a name="envoy-parallel-execution"></a></p>

<h3>Parallel Execution</h3>

<p>If you would like to run a task across multiple servers in parallel, simply add the <code>parallel</code> option to your task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">],</span> <span class="s1">&#39;parallel&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="envoy-task-macros"></a></p>

<h3>Task Macros</h3>

<p>Macros allow you to define a set of tasks to be run in sequence using a single command. For instance:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
    <span class="nx">foo</span>
    <span class="nx">bar</span>
<span class="err">@</span><span class="nx">endmacro</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="nx">echo</span> <span class="s2">&quot;HELLO&quot;</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="nx">echo</span> <span class="s2">&quot;WORLD&quot;</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>The <code>deploy</code> macro can now be run via a single, simple command:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span>
</pre></div>

<p><a name="envoy-notifications"></a>
<a name="envoy-hipchat-notifications"></a></p>

<h3>Notifications</h3>

<h4>HipChat</h4>

<p>After running a task, you may send a notification to your team&#39;s HipChat room using the simple <code>@hipchat</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>You can also specify a custom message to the hipchat room. Any variables declared in <code>@setup</code> or included with <code>@include</code> will be available for use in the message:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">hipchat</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;Envoy&#39;</span><span class="p">,</span> <span class="s2">&quot;$task ran on [$environment]&quot;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p>This is an amazingly simple way to keep your team notified of the tasks being run on the server.</p>

<h4>Slack</h4>

<p>The following syntax may be used to send a notification to <a href="https://slack.com">Slack</a>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">after</span>
    <span class="err">@</span><span class="nx">slack</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endafter</span>
</pre></div>

<p><a name="envoy-updating-envoy"></a></p>

<h3>Updating Envoy</h3>

<p>To update Envoy, simply run the <code>self-update</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">self</span><span class="o">-</span><span class="nx">update</span>
</pre></div>

<p>If your Envoy installation is in <code>/usr/local/bin</code>, you may need to use <code>sudo</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">update</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Templates</h1>

<ul>
<li><a href="#controller-layouts">Controller Layouts</a></li>
<li><a href="#blade-templating">Blade Templating</a></li>
<li><a href="#other-blade-control-structures">Other Blade Control Structures</a></li>
<li><a href="#extending-blade">Extending Blade</a></li>
</ul>

<p><a name="controller-layouts"></a></p>

<h2>Controller Layouts</h2>

<p>One method of using templates in Laravel is via controller layouts. By specifying the <code>layout</code> property on the controller, the view specified will be created for you and will be the assumed response that should be returned from actions.</p>

<h4>Defining A Layout On A Controller</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * The layout that should be used for responses.</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="nx">$layout</span> <span class="o">=</span> <span class="s1">&#39;layouts.master&#39;</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Show the user profile.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">showProfile</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">layout</span><span class="o">-&gt;</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p><a name="blade-templating"></a></p>

<h2>Blade Templating</h2>

<p>Blade is a simple, yet powerful templating engine provided with Laravel. Unlike controller layouts, Blade is driven by <em>template inheritance</em> and <em>sections</em>. All Blade templates should use the <code>.blade.php</code> extension.</p>

<h4>Defining A Blade Layout</h4>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">app</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">layouts</span><span class="o">/</span><span class="nx">master</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
            <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span>
        <span class="err">@</span><span class="nx">show</span>

        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<h4>Using A Blade Layout</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.master&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
    <span class="err">@@</span><span class="nx">parent</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">appended</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">stop</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">my</span> <span class="nx">body</span> <span class="nx">content</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">stop</span>
</pre></div>

<p>Note that views which <code>extend</code> a Blade layout simply override sections from the layout. Content of the layout can be included in a child view using the <code>@@parent</code> directive in a section, allowing you to append to the contents of a layout section such as a sidebar or footer.</p>

<p>Sometimes, such as when you are not sure if a section has been defined, you may wish to pass a default value to the <code>@yield</code> directive. You may pass the default value as the second argument:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="s1">&#39;Default Content&#39;</span><span class="p">)</span>
</pre></div>

<p><a name="other-blade-control-structures"></a></p>

<h2>Other Blade Control Structures</h2>

<h4>Echoing Data</h4>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{{</span> <span class="nx">$name</span> <span class="p">}}}.</span>

<span class="nx">The</span> <span class="nx">current</span> <span class="nx">UNIX</span> <span class="nx">timestamp</span> <span class="nx">is</span> <span class="p">{{{</span> <span class="nx">time</span><span class="p">()</span> <span class="p">}}}.</span>
</pre></div>

<h4>Echoing Data After Checking For Existence</h4>

<p>Sometimes you may wish to echo a variable, but you aren&#39;t sure if the variable has been set. Basically, you want to do this:</p>
<div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$name</span> <span class="o">:</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}}</span>
</pre></div>

<p>However, instead of writing a ternary statement, Blade allows you to use the following convenient short-cut:</p>
<div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="nx">$name</span> <span class="nx">or</span> <span class="s1">&#39;Default&#39;</span> <span class="p">}}}</span>
</pre></div>

<h4>Displaying Raw Text With Curly Braces</h4>

<p>If you need to display a string that is wrapped in curly braces, you may escape the Blade behavior by prefixing your text with an <code>@</code> symbol:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="p">{{</span> <span class="nx">This</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">processed</span> <span class="nx">by</span> <span class="nx">Blade</span> <span class="p">}}</span>
</pre></div>

<p>Of course, all user supplied data should be escaped or purified. To escape the output, you may use the triple curly brace syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{{</span> <span class="nx">$name</span> <span class="p">}}}.</span>
</pre></div>

<p>If you don&#39;t want the data to be escaped, you may use double curly-braces:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">$name</span> <span class="p">}}.</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Be very careful when echoing content that is supplied by users of your application. Always use the triple curly brace syntax to escape any HTML entities in the content.</p>
</blockquote>

<h4>If Statements</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">one</span> <span class="nx">record</span><span class="o">!</span>
<span class="err">@</span><span class="nx">elseif</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">multiple</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="k">else</span>
    <span class="nx">I</span> <span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">have</span> <span class="nx">any</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="nx">endif</span>

<span class="err">@</span><span class="nx">unless</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
    <span class="nx">You</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">signed</span> <span class="k">in</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endunless</span>
</pre></div>

<h4>Loops</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">The</span> <span class="nx">current</span> <span class="nx">value</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">$i</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endfor</span>

<span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">user</span> <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>

<span class="err">@</span><span class="nx">forelse</span><span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="err">@</span><span class="nx">empty</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">users</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforelse</span>

<span class="err">@</span><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">I</span><span class="err">&#39;</span><span class="nx">m</span> <span class="nx">looping</span> <span class="nx">forever</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endwhile</span>
</pre></div>

<h4>Including Sub-Views</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">)</span>
</pre></div>

<p>You may also pass an array of data to the included view:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;some&#39;</span><span class="p">=&gt;</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>
</pre></div>

<h4>Overwriting Sections</h4>

<p>To overwrite a section entirely, you may use the <code>overwrite</code> statement:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;list.item.container&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;list.item.content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">type</span> <span class="p">{{</span> <span class="nx">$item</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">overwrite</span>
</pre></div>

<h4>Displaying Language Lines</h4>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;language.line&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;language.line&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<h4>Comments</h4>
<div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">--</span> <span class="nx">This</span> <span class="nx">comment</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">rendered</span> <span class="nx">HTML</span> <span class="o">--</span><span class="p">}}</span>
</pre></div>

<p><a name="extending-blade"></a></p>

<h2>Extending Blade</h2>

<p>Blade even allows you to define your own custom control structures. When a Blade file is compiled, each custom extension is called with the view contents, allowing you to do anything from simple <code>str_replace</code> manipulations to more complex regular expressions.</p>

<p>The Blade compiler comes with the helper methods <code>createMatcher</code> and <code>createPlainMatcher</code>, which generate the expression you need to build your own custom directives.</p>

<p>The <code>createPlainMatcher</code> method is used for directives with no arguments like <code>@endif</code> and <code>@stop</code>, while <code>createMatcher</code> is used for directives with arguments.</p>

<p>The following example creates a <code>@datetime($var)</code> directive which simply calls <code>-&gt;format()</code> on <code>$var</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Blade</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$view</span><span class="p">,</span> <span class="nx">$compiler</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$pattern</span> <span class="o">=</span> <span class="nx">$compiler</span><span class="o">-&gt;</span><span class="nx">createMatcher</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nx">$pattern</span><span class="p">,</span> <span class="err">&#39;</span><span class="nx">$1</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="err">$</span><span class="mi">2</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nx">\</span><span class="s1">&#39;m/d/Y H:i\&#39;); ?&gt;&#39;</span><span class="p">,</span> <span class="nv">$view</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Testing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-and-running-tests">Defining &amp; Running Tests</a></li>
<li><a href="#test-environment">Test Environment</a></li>
<li><a href="#calling-routes-from-tests">Calling Routes From Tests</a></li>
<li><a href="#mocking-facades">Mocking Facades</a></li>
<li><a href="#framework-assertions">Framework Assertions</a></li>
<li><a href="#helper-methods">Helper Methods</a></li>
<li><a href="#refreshing-the-application">Refreshing The Application</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel is built with unit testing in mind. In fact, support for testing with PHPUnit is included out of the box, and a <code>phpunit.xml</code> file is already setup for your application. In addition to PHPUnit, Laravel also utilizes the Symfony HttpKernel, DomCrawler, and BrowserKit components to allow you to inspect and manipulate your views while testing, allowing to simulate a web browser.</p>

<p>An example test file is provided in the <code>app/tests</code> directory. After installing a new Laravel application, simply run <code>phpunit</code> on the command line to run your tests.</p>

<p><a name="defining-and-running-tests"></a></p>

<h2>Defining &amp; Running Tests</h2>

<p>To create a test case, simply create a new test file in the <code>app/tests</code> directory. The test class should extend <code>TestCase</code>. You may then define test methods as you normally would when using PHPUnit.</p>

<h4>An Example Test Class</h4>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">FooTest</span> <span class="kr">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">testSomethingIsTrue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertTrue</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You may run all of the tests for your application by executing the <code>phpunit</code> command from your terminal.</p>

<blockquote>
<p><strong>Note:</strong> If you define your own <code>setUp</code> method, be sure to call <code>parent::setUp</code>.</p>
</blockquote>

<p><a name="test-environment"></a></p>

<h2>Test Environment</h2>

<p>When running unit tests, Laravel will automatically set the configuration environment to <code>testing</code>. Also, Laravel includes configuration files for <code>session</code> and <code>cache</code> in the test environment. Both of these drivers are set to <code>array</code> while in the test environment, meaning no session or cache data will be persisted while testing. You are free to create other testing environment configurations as necessary.</p>

<p><a name="calling-routes-from-tests"></a></p>

<h2>Calling Routes From Tests</h2>

<h4>Calling A Route From A Test</h4>

<p>You may easily call one of your routes for a test using the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;user/profile&#39;</span><span class="p">);</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="nx">$method</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">,</span> <span class="nx">$files</span><span class="p">,</span> <span class="nx">$server</span><span class="p">,</span> <span class="nx">$content</span><span class="p">);</span>
</pre></div>

<p>You may then inspect the <code>Illuminate\Http\Response</code> object:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getContent</span><span class="p">());</span>
</pre></div>

<h4>Calling A Controller From A Test</h4>

<p>You may also call a controller from a test:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>

<p>The <code>getContent</code> method will return the evaluated string contents of the response. If your route returns a <code>View</code>, you may access it using the <code>original</code> property:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">original</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$view</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</pre></div>

<p>To call a HTTPS route, you may use the <code>callSecure</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">callSecure</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;foo/bar&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Route filters are disabled when in the testing environment. To enable them, add <code>Route::enableFilters()</code> to your test.</p>
</blockquote>

<h3>DOM Crawler</h3>

<p>You may also call a route and receive a DOM Crawler instance that you may use to inspect the content:</p>
<div class="highlight"><pre><span></span><span class="nx">$crawler</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">client</span><span class="o">-&gt;</span><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertTrue</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">client</span><span class="o">-&gt;</span><span class="nx">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isOk</span><span class="p">());</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">$crawler</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;h1:contains(&quot;Hello World!&quot;)&#39;</span><span class="p">));</span>
</pre></div>

<p>For more information on how to use the crawler, refer to its <a href="http://symfony.com/doc/master/components/dom_crawler.html">official documentation</a>.</p>

<p><a name="mocking-facades"></a></p>

<h2>Mocking Facades</h2>

<p>When testing, you may often want to mock a call to a Laravel static facade. For example, consider the following controller action:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getIndex</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="s1">&#39;All done!&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>We can mock the call to the <code>Event</code> class by using the <code>shouldReceive</code> method on the facade, which will return an instance of a <a href="https://github.com/padraic/mockery">Mockery</a> mock.</p>

<h4>Mocking A Facade</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testGetIndex</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;fire&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">once</span><span class="p">()</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">));</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> You should not mock the <code>Request</code> facade. Instead, pass the input you desire into the <code>call</code> method when running your test.</p>
</blockquote>

<p><a name="framework-assertions"></a></p>

<h2>Framework Assertions</h2>

<p>Laravel ships with several <code>assert</code> methods to make testing a little easier:</p>

<h4>Asserting Responses Are OK</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting Response Statuses</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertResponseStatus</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
</pre></div>

<h4>Asserting Responses Are Redirects</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedTo</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedToRoute</span><span class="p">(</span><span class="s1">&#39;route.name&#39;</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertRedirectedToAction</span><span class="p">(</span><span class="s1">&#39;Controller@method&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asserting A View Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertViewHas</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertViewHas</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting The Session Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHas</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHas</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting The Session Has Errors</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">();</span>

    <span class="c1">// Asserting the session has errors for a given key...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

    <span class="c1">// Asserting the session has errors for several keys...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<h4>Asserting Old Input Has Some Data</h4>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertHasOldInput</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="helper-methods"></a></p>

<h2>Helper Methods</h2>

<p>The <code>TestCase</code> class contains several helper methods to make testing your application easier.</p>

<h4>Setting And Flushing Sessions From Tests</h4>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">flushSession</span><span class="p">();</span>
</pre></div>

<h4>Setting The Currently Authenticated User</h4>

<p>You may set the currently authenticated user using the <code>be</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">));</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">be</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<h4>Re-Seeding Database From Tests</h4>

<p>You may re-seed your database from a test using the <code>seed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">seed</span><span class="p">();</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">seed</span><span class="p">(</span><span class="s1">&#39;DatabaseSeeder&#39;</span><span class="p">);</span>
</pre></div>

<p>More information on creating seeds may be found in the <a href="/docs/4.2/migrations#database-seeding">migrations and seeding</a> section of the documentation.</p>

<p><a name="refreshing-the-application"></a></p>

<h2>Refreshing The Application</h2>

<p>As you may already know, you can access your Laravel <code>Application</code> / IoC Container via <code>$this-&gt;app</code> from any test method. This Application instance is refreshed for each test class. If you wish to manually force the Application to be refreshed for a given method, you may use the <code>refreshApplication</code> method from your test method. This will reset any extra bindings, such as mocks, that have been placed in the IoC container since the test case started running.</p>
<div style="page-break-after: always;" ></div><h1>Upgrade Guide</h1>

<ul>
<li><a href="#upgrade-4.2">Upgrading To 4.2 From 4.1</a></li>
<li><a href="#upgrade-4.1.29">Upgrading To 4.1.29 From &lt;= 4.1.x</a></li>
<li><a href="#upgrade-4.1.26">Upgrading To 4.1.26 From &lt;= 4.1.25</a></li>
<li><a href="#upgrade-4.1">Upgrading To 4.1 From 4.0</a></li>
</ul>

<p><a name="upgrade-4.2"></a></p>

<h2>Upgrading To 4.2 From 4.1</h2>

<h3>PHP 5.4+</h3>

<p>Laravel 4.2 requires PHP 5.4.0 or greater.</p>

<h3>Encryption Defaults</h3>

<p>Add a new <code>cipher</code> option in your <code>app/config/app.php</code> configuration file. The value of this option should be <code>MCRYPT_RIJNDAEL_256</code>.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;cipher&#39;</span> <span class="p">=&gt;</span> <span class="nx">MCRYPT_RIJNDAEL_256</span>
</pre></div>

<p>This setting may be used to control the default cipher used by the Laravel encryption facilities.</p>

<blockquote>
<p><strong>Note:</strong> Laravel 4.2 changes the default cipher from <code>MCRYPT_RIJNDAEL_256</code> to <code>MCRYPT_RIJNDAEL_128</code> (AES), which is considered to be the most secure cipher. Changing the cipher back to <code>MCRYPT_RIJNDAEL_256</code>, as has been suggested above, is required to decrypt cookies/values that were encrypted in Laravel &lt;= 4.1.</p>
</blockquote>

<h3>Soft Deleting Models Now Use Traits</h3>

<p>If you are using soft deleting models, the <code>softDeletes</code> property has been removed. You must now use the <code>SoftDeletingTrait</code> like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">SoftDeletingTrait</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You must also manually add the <code>deleted_at</code> column to your <code>dates</code> property:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
    <span class="nx">use</span> <span class="nx">SoftDeletingTrait</span><span class="p">;</span>

    <span class="kr">protected</span> <span class="nx">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>The API for all soft delete operations remains the same.</p>

<blockquote>
<p><strong>Note:</strong> The <code>SoftDeletingTrait</code> can not be applied on a base model. It must be used on an actual model class.</p>
</blockquote>

<h3>View / Pagination Environment Renamed</h3>

<p>If you are directly referencing the <code>Illuminate\View\Environment</code> class or <code>Illuminate\Pagination\Environment</code> class, update your code to reference <code>Illuminate\View\Factory</code> and <code>Illuminate\Pagination\Factory</code> instead. These two classes have been renamed to better reflect their function.</p>

<h3>Additional Parameter On Pagination Presenter</h3>

<p>If you are extending the <code>Illuminate\Pagination\Presenter</code> class, the abstract method <code>getPageLinkWrapper</code> signature has changed to add the <code>rel</code> argument:</p>
<div class="highlight"><pre><span></span><span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getPageLinkWrapper</span><span class="p">(</span><span class="nx">$url</span><span class="p">,</span> <span class="nx">$page</span><span class="p">,</span> <span class="nx">$rel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<h3>Iron.Io Queue Encryption</h3>

<p>If you are using the Iron.io queue driver, you will need to add a new <code>encrypt</code> option to your queue configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;encrypt&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span>
</pre></div>

<p><a name="upgrade-4.1.29"></a></p>

<h2>Upgrading To 4.1.29 From &lt;= 4.1.x</h2>

<p>Laravel 4.1.29 improves the column quoting for all database drivers. This protects your application from some mass assignment vulnerabilities when <strong>not</strong> using the <code>fillable</code> property on models. If you are using the <code>fillable</code> property on your models to protect against mass assignment, your application is not vulnerable. However, if you are using <code>guarded</code> and are passing a user controlled array into an &quot;update&quot; or &quot;save&quot; type function, you should upgrade to <code>4.1.29</code> immediately as your application may be at risk of mass assignment.</p>

<p>To upgrade to Laravel 4.1.29, simply <code>composer update</code>. No breaking changes are introduced in this release.</p>

<p><a name="upgrade-4.1.26"></a></p>

<h2>Upgrading To 4.1.26 From &lt;= 4.1.25</h2>

<p>Laravel 4.1.26 introduces security improvements for &quot;remember me&quot; cookies. Before this update, if a remember cookie was hijacked by another malicious user, the cookie would remain valid for a long period of time, even after the true owner of the account reset their password, logged out, etc.</p>

<p>This change requires the addition of a new <code>remember_token</code> column to your <code>users</code> (or equivalent) database table. After this change, a fresh token will be assigned to the user each time they login to your application. The token will also be refreshed when the user logs out of the application. The implications of this change are: if a &quot;remember me&quot; cookie is hijacked, simply logging out of the application will invalidate the cookie.</p>

<h3>Upgrade Path</h3>

<p>First, add a new, nullable <code>remember_token</code> of VARCHAR(100), TEXT, or equivalent to your <code>users</code> table.</p>

<p>Next, if you are using the Eloquent authentication driver, update your <code>User</code> class with the following three methods:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberToken</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">setRememberToken</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">remember_token</span> <span class="o">=</span> <span class="nx">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRememberTokenName</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;remember_token&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> All existing &quot;remember me&quot; sessions will be invalidated by this change, so all users will be forced to re-authenticate with your application.</p>
</blockquote>

<h3>Package Maintainers</h3>

<p>Two new methods were added to the <code>Illuminate\Auth\UserProviderInterface</code> interface. Sample implementations may be found in the default drivers:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">retrieveByToken</span><span class="p">(</span><span class="nx">$identifier</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">updateRememberToken</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">$token</span><span class="p">);</span>
</pre></div>

<p>The <code>Illuminate\Auth\UserInterface</code> also received the three new methods described in the &quot;Upgrade Path&quot;.</p>

<p><a name="upgrade-4.1"></a></p>

<h2>Upgrading To 4.1 From 4.0</h2>

<h3>Upgrading Your Composer Dependency</h3>

<p>To upgrade your application to Laravel 4.1, change your <code>laravel/framework</code> version to <code>4.1.*</code> in your <code>composer.json</code> file.</p>

<h3>Replacing Files</h3>

<p>Replace your <code>public/index.php</code> file with <a href="https://github.com/laravel/laravel/blob/master/public/index.php">this fresh copy from the repository</a>.</p>

<p>Replace your <code>artisan</code> file with <a href="https://github.com/laravel/laravel/blob/master/artisan">this fresh copy from the repository</a>.</p>

<h3>Adding Configuration Files &amp; Options</h3>

<p>Update your <code>aliases</code> and <code>providers</code> arrays in your <code>app/config/app.php</code> configuration file. The updated values for these arrays can be found <a href="https://github.com/laravel/laravel/blob/master/app/config/app.php">in this file</a>. Be sure to add your custom and package service providers / aliases back to the arrays.</p>

<p>Add the new <code>app/config/remote.php</code> file <a href="https://github.com/laravel/laravel/blob/master/app/config/remote.php">from the repository</a>.</p>

<p>Add the new <code>expire_on_close</code> configuration option to your <code>app/config/session.php</code> file. The default value should be <code>false</code>.</p>

<p>Add the new <code>failed</code> configuration section to your <code>app/config/queue.php</code> file. Here are the default values for the section:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;failed&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;failed_jobs&#39;</span><span class="p">,</span>
<span class="p">),</span>
</pre></div>

<p><strong>(Optional)</strong> Update the <code>pagination</code> configuration option in your <code>app/config/view.php</code> file to <code>pagination::slider-3</code>.</p>

<h3>Controller Updates</h3>

<p>If <code>app/controllers/BaseController.php</code> has a <code>use</code> statement at the top, change <code>use Illuminate\Routing\Controllers\Controller;</code> to <code>use Illuminate\Routing\Controller;</code>.</p>

<h3>Password Reminders Updates</h3>

<p>Password reminders have been overhauled for greater flexibility. You may examine the new stub controller by running the <code>php artisan auth:reminders-controller</code> Artisan command. You may also browse the <a href="/docs/4.2/security#password-reminders-and-reset">updated documentation</a> and update your application accordingly.</p>

<p>Update your <code>app/lang/en/reminders.php</code> language file to match <a href="https://github.com/laravel/laravel/blob/master/app/lang/en/reminders.php">this updated file</a>.</p>

<h3>Environment Detection Updates</h3>

<p>For security reasons, URL domains may no longer be used to detect your application environment. These values are easily spoofable and allow attackers to modify the environment for a request. You should convert your environment detection to use machine host names (<code>hostname</code> command on Mac, Linux, and Windows).</p>

<h3>Simpler Log Files</h3>

<p>Laravel now generates a single log file: <code>app/storage/logs/laravel.log</code>. However, you may still configure this behavior in your <code>app/start/global.php</code> file.</p>

<h3>Removing Redirect Trailing Slash</h3>

<p>In your <code>bootstrap/start.php</code> file, remove the call to <code>$app-&gt;redirectIfTrailingSlash()</code>. This method is no longer needed as this functionality is now handled by the <code>.htaccess</code> file included with the framework.</p>

<p>Next, replace your Apache <code>.htaccess</code> file with <a href="https://github.com/laravel/laravel/blob/master/public/.htaccess">this new one</a> that handles trailing slashes.</p>

<h3>Current Route Access</h3>

<p>The current route is now accessed via <code>Route::current()</code> instead of <code>Route::getCurrentRoute()</code>.</p>

<h3>Composer Update</h3>

<p>Once you have completed the changes above, you can run the <code>composer update</code> function to update your core application files! If you receive class load errors, try running the <code>update</code> command with the <code>--no-scripts</code> option enabled like so: <code>composer update --no-scripts</code>.</p>

<h3>Wildcard Event Listeners</h3>

<p>The wildcard event listeners no longer append the event to your handler functions parameters. If you require finding the event that was fired you should use <code>Event::firing()</code>.</p>
<div style="page-break-after: always;" ></div><h1>Validation</h1>

<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#working-with-error-messages">Working With Error Messages</a></li>
<li><a href="#error-messages-and-views">Error Messages &amp; Views</a></li>
<li><a href="#available-validation-rules">Available Validation Rules</a></li>
<li><a href="#conditionally-adding-rules">Conditionally Adding Rules</a></li>
<li><a href="#custom-error-messages">Custom Error Messages</a></li>
<li><a href="#custom-validation-rules">Custom Validation Rules</a></li>
</ul>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>Laravel ships with a simple, convenient facility for validating data and retrieving validation error messages via the <code>Validation</code> class.</p>

<h4>Basic Validation Example</h4>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">),</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|min:5&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<p>The first argument passed to the <code>make</code> method is the data under validation. The second argument is the validation rules that should be applied to the data.</p>

<h4>Using Arrays To Specify Rules</h4>

<p>Multiple rules may be delimited using either a &quot;pipe&quot; character, or as separate elements of an array.</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">),</span>
    <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min:5&#39;</span><span class="p">))</span>
<span class="p">);</span>
</pre></div>

<h4>Validating Multiple Fields</h4>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span>
    <span class="nx">array</span><span class="p">(</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;lamepassword&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email@example.com&#39;</span>
    <span class="p">),</span>
    <span class="nx">array</span><span class="p">(</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|min:8&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>

<p>Once a <code>Validator</code> instance has been created, the <code>fails</code> (or <code>passes</code>) method may be used to perform the validation.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// The given data did not pass validation</span>
<span class="p">}</span>
</pre></div>

<p>If validation has failed, you may retrieve the error messages from the validator.</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">messages</span><span class="p">();</span>
</pre></div>

<p>You may also access an array of the failed validation rules, without messages. To do so, use the <code>failed</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$failed</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">failed</span><span class="p">();</span>
</pre></div>

<h4>Validating Files</h4>

<p>The <code>Validator</code> class provides several rules for validating files, such as <code>size</code>, <code>mimes</code>, and others. When validating files, you may simply pass them into the validator with your other data.</p>

<p><a name="working-with-error-messages"></a></p>

<h2>Working With Error Messages</h2>

<p>After calling the <code>messages</code> method on a <code>Validator</code> instance, you will receive a <code>MessageBag</code> instance, which has a variety of convenient methods for working with error messages.</p>

<h4>Retrieving The First Error Message For A Field</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Error Messages For A Field</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving All Error Messages For All Fields</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If Messages Exist For A Field</h4>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving An Error Message With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;:message&lt;/p&gt;&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> By default, messages are formatted using Bootstrap compatible syntax.</p>
</blockquote>

<h4>Retrieving All Error Messages With A Format</h4>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$messages</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;:message&lt;/li&gt;&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="error-messages-and-views"></a></p>

<h2>Error Messages &amp; Views</h2>

<p>Once you have performed validation, you will need an easy way to get the error messages back to your views. This is conveniently handled by Laravel. Consider the following routes as an example:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;user.register&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$rules</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(...);</span>

    <span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="nx">all</span><span class="p">(),</span> <span class="nx">$rules</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>Note that when validation fails, we pass the <code>Validator</code> instance to the Redirect using the <code>withErrors</code> method. This method will flash the error messages to the session so that they are available on the next request.</p>

<p>However, notice that we do not have to explicitly bind the error messages to the view in our GET route. This is because Laravel will always check for errors in the session data, and automatically bind them to the view if they are available. <strong>So, it is important to note that an <code>$errors</code> variable will always be available in all of your views, on every request</strong>, allowing you to conveniently assume the <code>$errors</code> variable is always defined and can be safely used. The <code>$errors</code> variable will be an instance of <code>MessageBag</code>.</p>

<p>So, after redirection, you may utilize the automatically bound <code>$errors</code> variable in your view:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<h3>Named Error Bags</h3>

<p>If you have multiple forms on a single page, you may wish to name the <code>MessageBag</code> of errors. This will allow you to retrieve the error messages for a specific form. Simply pass a name as the second argument to <code>withErrors</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>You may then access the named <code>MessageBag</code> instance from the <code>$errors</code> variable:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$errors</span><span class="o">-&gt;</span><span class="na">login</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<p><a name="available-validation-rules"></a></p>

<h2>Available Validation Rules</h2>

<p>Below is a list of all available validation rules and their function:</p>

<ul>
<li><a href="#rule-accepted">Accepted</a></li>
<li><a href="#rule-active-url">Active URL</a></li>
<li><a href="#rule-after">After (Date)</a></li>
<li><a href="#rule-alpha">Alpha</a></li>
<li><a href="#rule-alpha-dash">Alpha Dash</a></li>
<li><a href="#rule-alpha-num">Alpha Numeric</a></li>
<li><a href="#rule-array">Array</a></li>
<li><a href="#rule-before">Before (Date)</a></li>
<li><a href="#rule-between">Between</a></li>
<li><a href="#rule-boolean">Boolean</a></li>
<li><a href="#rule-confirmed">Confirmed</a></li>
<li><a href="#rule-date">Date</a></li>
<li><a href="#rule-date-format">Date Format</a></li>
<li><a href="#rule-different">Different</a></li>
<li><a href="#rule-digits">Digits</a></li>
<li><a href="#rule-digits-between">Digits Between</a></li>
<li><a href="#rule-email">E-Mail</a></li>
<li><a href="#rule-exists">Exists (Database)</a></li>
<li><a href="#rule-image">Image (File)</a></li>
<li><a href="#rule-in">In</a></li>
<li><a href="#rule-integer">Integer</a></li>
<li><a href="#rule-ip">IP Address</a></li>
<li><a href="#rule-max">Max</a></li>
<li><a href="#rule-mimes">MIME Types</a></li>
<li><a href="#rule-min">Min</a></li>
<li><a href="#rule-not-in">Not In</a></li>
<li><a href="#rule-numeric">Numeric</a></li>
<li><a href="#rule-regex">Regular Expression</a></li>
<li><a href="#rule-required">Required</a></li>
<li><a href="#rule-required-if">Required If</a></li>
<li><a href="#rule-required-with">Required With</a></li>
<li><a href="#rule-required-with-all">Required With All</a></li>
<li><a href="#rule-required-without">Required Without</a></li>
<li><a href="#rule-required-without-all">Required Without All</a></li>
<li><a href="#rule-same">Same</a></li>
<li><a href="#rule-size">Size</a></li>
<li><a href="#rule-string">String</a></li>
<li><a href="#rule-timezone">Timezone</a></li>
<li><a href="#rule-unique">Unique (Database)</a></li>
<li><a href="#rule-url">URL</a></li>
</ul>

<p><a name="rule-accepted"></a></p>

<h4>accepted</h4>

<p>The field under validation must be <em>yes</em>, <em>on</em>, or <em>1</em>. This is useful for validating &quot;Terms of Service&quot; acceptance.</p>

<p><a name="rule-active-url"></a></p>

<h4>active_url</h4>

<p>The field under validation must be a valid URL according to the <code>checkdnsrr</code> PHP function.</p>

<p><a name="rule-after"></a></p>

<h4>after:<em>date</em></h4>

<p>The field under validation must be a value after a given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-alpha"></a></p>

<h4>alpha</h4>

<p>The field under validation must be entirely alphabetic characters.</p>

<p><a name="rule-alpha-dash"></a></p>

<h4>alpha_dash</h4>

<p>The field under validation may have alpha-numeric characters, as well as dashes and underscores.</p>

<p><a name="rule-alpha-num"></a></p>

<h4>alpha_num</h4>

<p>The field under validation must be entirely alpha-numeric characters.</p>

<p><a name="rule-array"></a></p>

<h4>array</h4>

<p>The field under validation must be of type array.</p>

<p><a name="rule-before"></a></p>

<h4>before:<em>date</em></h4>

<p>The field under validation must be a value preceding the given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-between"></a></p>

<h4>between:<em>min</em>,<em>max</em></h4>

<p>The field under validation must have a size between the given <em>min</em> and <em>max</em>. Strings, numerics, and files are evaluated in the same fashion as the <code>size</code> rule.</p>

<p><a name="rule-boolean"></a></p>

<h4>boolean</h4>

<p>The field under validation must be able to be cast as a boolean. Accepted input are <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code>, <code>&quot;1&quot;</code> and <code>&quot;0&quot;</code>.</p>

<p><a name="rule-confirmed"></a></p>

<h4>confirmed</h4>

<p>The field under validation must have a matching field of <code>foo_confirmation</code>. For example, if the field under validation is <code>password</code>, a matching <code>password_confirmation</code> field must be present in the input.</p>

<p><a name="rule-date"></a></p>

<h4>date</h4>

<p>The field under validation must be a valid date according to the <code>strtotime</code> PHP function.</p>

<p><a name="rule-date-format"></a></p>

<h4>date<em>format:</em>format_</h4>

<p>The field under validation must match the <em>format</em> defined according to the <code>date_parse_from_format</code> PHP function.</p>

<p><a name="rule-different"></a></p>

<h4>different:<em>field</em></h4>

<p>The given <em>field</em> must be different than the field under validation.</p>

<p><a name="rule-digits"></a></p>

<h4>digits:<em>value</em></h4>

<p>The field under validation must be <em>numeric</em> and must have an exact length of <em>value</em>.</p>

<p><a name="rule-digits-between"></a></p>

<h4>digits<em>between:</em>min<em>,</em>max_</h4>

<p>The field under validation must have a length between the given <em>min</em> and <em>max</em>.</p>

<p><a name="rule-email"></a></p>

<h4>email</h4>

<p>The field under validation must be formatted as an e-mail address.</p>

<p><a name="rule-exists"></a></p>

<h4>exists:<em>table</em>,<em>column</em></h4>

<p>The field under validation must exist on a given database table.</p>

<h4>Basic Usage Of Exists Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states&#39;</span>
</pre></div>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states,abbreviation&#39;</span>
</pre></div>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,account_id,1&#39;</span>
</pre></div>

<p>Passing <code>NULL</code> as a &quot;where&quot; clause value will add a check for a <code>NULL</code> database value:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:staff,email,deleted_at,NULL&#39;</span>
</pre></div>

<p><a name="rule-image"></a></p>

<h4>image</h4>

<p>The file under validation must be an image (jpeg, png, bmp, or gif)</p>

<p><a name="rule-in"></a></p>

<h4>in:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be included in the given list of values.</p>

<p><a name="rule-integer"></a></p>

<h4>integer</h4>

<p>The field under validation must have an integer value.</p>

<p><a name="rule-ip"></a></p>

<h4>ip</h4>

<p>The field under validation must be formatted as an IP address.</p>

<p><a name="rule-max"></a></p>

<h4>max:<em>value</em></h4>

<p>The field under validation must be less than or equal to a maximum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-mimes"></a></p>

<h4>mimes:<em>foo</em>,<em>bar</em>,...</h4>

<p>The file under validation must have a MIME type corresponding to one of the listed extensions.</p>

<h4>Basic Usage Of MIME Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;photo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mimes:jpeg,bmp,png&#39;</span>
</pre></div>

<p><a name="rule-min"></a></p>

<h4>min:<em>value</em></h4>

<p>The field under validation must have a minimum <em>value</em>. Strings, numerics, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-not-in"></a></p>

<h4>not<em>in:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must not be included in the given list of values.</p>

<p><a name="rule-numeric"></a></p>

<h4>numeric</h4>

<p>The field under validation must have a numeric value.</p>

<p><a name="rule-regex"></a></p>

<h4>regex:<em>pattern</em></h4>

<p>The field under validation must match the given regular expression.</p>

<p><strong>Note:</strong> When using the <code>regex</code> pattern, it may be necessary to specify rules in an array instead of using pipe delimiters, especially if the regular expression contains a pipe character.</p>

<p><a name="rule-required"></a></p>

<h4>required</h4>

<p>The field under validation must be present in the input data.</p>

<p><a name="rule-required-if"></a></p>

<h4>required<em>if:</em>field<em>,</em>value_,...</h4>

<p>The field under validation must be present if the <em>field</em> field is equal to any <em>value</em>.</p>

<p><a name="rule-required-with"></a></p>

<h4>required<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only if</em> any of the other specified fields are present.</p>

<p><a name="rule-required-with-all"></a></p>

<h4>required<em>with</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only if</em> all of the other specified fields are present.</p>

<p><a name="rule-required-without"></a></p>

<h4>required<em>without:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present <em>only when</em> any of the other specified fields are not present.</p>

<p><a name="rule-required-without-all"></a></p>

<h4>required<em>without</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present <em>only when</em> all of the other specified fields are not present.</p>

<p><a name="rule-same"></a></p>

<h4>same:<em>field</em></h4>

<p>The given <em>field</em> must match the field under validation.</p>

<p><a name="rule-size"></a></p>

<h4>size:<em>value</em></h4>

<p>The field under validation must have a size matching the given <em>value</em>. For string data, <em>value</em> corresponds to the number of characters. For numeric data, <em>value</em> corresponds to a given integer value. For files, <em>size</em> corresponds to the file size in kilobytes.</p>

<p><a name="rule-string"></a></p>

<h4>string:<em>value</em></h4>

<p>The field under validation must be a string type.</p>

<p><a name="rule-timezone"></a></p>

<h4>timezone</h4>

<p>The field under validation must be a valid timezone identifier according to the <code>timezone_identifiers_list</code> PHP function.</p>

<p><a name="rule-unique"></a></p>

<h4>unique:<em>table</em>,<em>column</em>,<em>except</em>,<em>idColumn</em></h4>

<p>The field under validation must be unique on a given database table. If the <code>column</code> option is not specified, the field name will be used.</p>

<h4>Basic Usage Of Unique Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users&#39;</span>
</pre></div>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address&#39;</span>
</pre></div>

<h4>Forcing A Unique Rule To Ignore A Given ID</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,10&#39;</span>
</pre></div>

<h4>Adding Additional Where Clauses</h4>

<p>You may also specify more conditions that will be added as &quot;where&quot; clauses to the query:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address,NULL,id,account_id,1&#39;</span>
</pre></div>

<p>In the rule above, only rows with an <code>account_id</code> of <code>1</code> would be included in the unique check.</p>

<p><a name="rule-url"></a></p>

<h4>url</h4>

<p>The field under validation must be formatted as an URL.</p>

<blockquote>
<p><strong>Note:</strong> This function uses PHP&#39;s <code>filter_var</code> method.</p>
</blockquote>

<p><a name="conditionally-adding-rules"></a></p>

<h2>Conditionally Adding Rules</h2>

<p>In some situations, you may wish to run validation checks against a field <strong>only</strong> if that field is present in the input array. To quickly accomplish this, add the <code>sometimes</code> rule to your rule list:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sometimes|required|email&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>

<p>In the example above, the <code>email</code> field will only be validated if it is present in the <code>$data</code> array.</p>

<h4>Complex Conditional Validation</h4>

<p>Sometimes you may wish to require a given field only if another field has a greater value than 100. Or you may need two fields to have a given value only when another field is present. Adding these validation rules doesn&#39;t have to be a pain. First, create a <code>Validator</code> instance with your <em>static rules</em> that never change:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;games&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|numeric&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>

<p>Let&#39;s assume our web application is for game collectors. If a game collector registers with our application and they own more than 100 games, we want them to explain why they own so many games. For example, perhaps they run a game re-sell shop, or maybe they just enjoy collecting. To conditionally add this requirement, we can use the <code>sometimes</code> method on the <code>Validator</code> instance.</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;required|max:500&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>sometimes</code> method is the name of the field we are conditionally validating. The second argument is the rules we want to add. If the <code>Closure</code> passed as the third argument returns <code>true</code>, the rules will be added. This method makes it a breeze to build complex conditional validations. You may even add conditional validations for several fields at once:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">(</span><span class="nx">array</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;cost&#39;</span><span class="p">),</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> The <code>$input</code> parameter passed to your <code>Closure</code> will be an instance of <code>Illuminate\Support\Fluent</code> and may be used as an object to access your input and files.</p>
</blockquote>

<p><a name="custom-error-messages"></a></p>

<h2>Custom Error Messages</h2>

<p>If needed, you may use custom error messages for validation instead of the defaults. There are several ways to specify custom messages.</p>

<h4>Passing Custom Messages Into Validator</h4>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute field is required.&#39;</span><span class="p">,</span>
<span class="p">);</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><em>Note:</em> The <code>:attribute</code> place-holder will be replaced by the actual name of the field under validation. You may also utilize other place-holders in validation messages.</p>
</blockquote>

<h4>Other Validation Place-Holders</h4>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;same&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute and :other must match.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span>    <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be exactly :size.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;between&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be between :min - :max.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;in&#39;</span>      <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be one of the following types: :values&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>

<h4>Specifying A Custom Message For A Given Attribute</h4>

<p>Sometimes you may wish to specify a custom error messages only for a specific field:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;email.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>

<p><a name="localization"></a></p>

<h4>Specifying Custom Messages In Language Files</h4>

<p>In some cases, you may wish to specify your custom messages in a language file instead of passing them directly to the <code>Validator</code>. To do so, add your messages to <code>custom</code> array in the <code>app/lang/xx/validation.php</code> language file.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">array</span><span class="p">(</span>
        <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>

<p><a name="custom-validation-rules"></a></p>

<h2>Custom Validation Rules</h2>

<h4>Registering A Custom Validation Rule</h4>

<p>Laravel provides a variety of helpful validation rules; however, you may wish to specify some of your own. One method of registering custom validation rules is using the <code>Validator::extend</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The custom validator Closure receives three arguments: the name of the <code>$attribute</code> being validated, the <code>$value</code> of the attribute, and an array of <code>$parameters</code> passed to the rule.</p>

<p>You may also pass a class and method to the <code>extend</code> method instead of a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooValidator@validate&#39;</span><span class="p">);</span>
</pre></div>

<p>Note that you will also need to define an error message for your custom rules. You can do so either using an inline custom message array or by adding an entry in the validation language file.</p>

<h4>Extending The Validator Class</h4>

<p>Instead of using Closure callbacks to extend the Validator, you may also extend the Validator class itself. To do so, write a Validator class that extends <code>Illuminate\Validation\Validator</code>. You may add validation methods to the class by prefixing them with <code>validate</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">CustomValidator</span> <span class="k">extends</span> <span class="nx">Illuminate\Validation\Validator</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateFoo</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<h4>Registering A Custom Validator Resolver</h4>

<p>Next, you need to register your custom Validator extension:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">resolver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$translator</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomValidator</span><span class="p">(</span><span class="nx">$translator</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When creating a custom validation rule, you may sometimes need to define custom place-holder replacements for error messages. You may do so by creating a custom Validator as described above, and adding a <code>replaceXXX</code> function to the validator.</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="kd">function</span> <span class="nx">replaceFoo</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;:foo&#39;</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">$message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to add a custom message &quot;replacer&quot; without extending the <code>Validator</code> class, you may use the <code>Validator::replacer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">replacer</span><span class="p">(</span><span class="s1">&#39;rule&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div></div></body></html>