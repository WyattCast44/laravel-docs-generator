<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><link rel="stylesheet" href="resources/code.css"><link rel="stylesheet" href="resources/tailwind.css"></head><body><div class="prose prose-xl mx-auto my-10"><p>The MIT License (MIT)</p>

<p>Copyright (c) Taylor Otwell</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
<div style="page-break-after: always;" ></div><h1>Artisan Console</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#tinker">Tinker (REPL)</a></li>
</ul></li>
<li><a href="#writing-commands">Writing Commands</a>

<ul>
<li><a href="#generating-commands">Generating Commands</a></li>
<li><a href="#command-structure">Command Structure</a></li>
<li><a href="#closure-commands">Closure Commands</a></li>
</ul></li>
<li><a href="#defining-input-expectations">Defining Input Expectations</a>

<ul>
<li><a href="#arguments">Arguments</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#input-arrays">Input Arrays</a></li>
<li><a href="#input-descriptions">Input Descriptions</a></li>
</ul></li>
<li><a href="#command-io">Command I/O</a>

<ul>
<li><a href="#retrieving-input">Retrieving Input</a></li>
<li><a href="#prompting-for-input">Prompting For Input</a></li>
<li><a href="#writing-output">Writing Output</a></li>
</ul></li>
<li><a href="#registering-commands">Registering Commands</a></li>
<li><a href="#programmatically-executing-commands">Programmatically Executing Commands</a>

<ul>
<li><a href="#calling-commands-from-other-commands">Calling Commands From Other Commands</a></li>
</ul></li>
<li><a href="#stub-customization">Stub Customization</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Artisan is the command-line interface included with Laravel. It provides a number of helpful commands that can assist you while you build your application. To view a list of all available Artisan commands, you may use the <code>list</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">list</span>
</pre></div>

<p>Every command also includes a &quot;help&quot; screen which displays and describes the command&#39;s available arguments and options. To view a help screen, precede the name of the command with <code>help</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">help</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="tinker"></a></p>

<h3>Tinker (REPL)</h3>

<p>Laravel Tinker is a powerful REPL for the Laravel framework, powered by the <a href="https://github.com/bobthecow/psysh">PsySH</a> package.</p>

<h4>Installation</h4>

<p>All Laravel applications include Tinker by default. However, you may install it manually if needed using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">tinker</span>
</pre></div>

<h4>Usage</h4>

<p>Tinker allows you to interact with your entire Laravel application on the command line, including the Eloquent ORM, jobs, events, and more. To enter the Tinker environment, run the <code>tinker</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">tinker</span>
</pre></div>

<p>You can publish Tinker&#39;s configuration file using the <code>vendor:publish</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&quot;Laravel\Tinker\TinkerServiceProvider&quot;</span>
</pre></div>

<blockquote>
<p>{note} The <code>dispatch</code> helper function and <code>dispatch</code> method on the <code>Dispatchable</code> class depends on garbage collection to place the job on the queue. Therefore, when using tinker, you should use <code>Bus::dispatch</code> or <code>Queue::push</code> to dispatch jobs.</p>
</blockquote>

<h4>Command Whitelist</h4>

<p>Tinker utilizes a white-list to determine which Artisan commands are allowed to be run within its shell. By default, you may run the <code>clear-compiled</code>, <code>down</code>, <code>env</code>, <code>inspire</code>, <code>migrate</code>, <code>optimize</code>, and <code>up</code> commands. If you would like to white-list more commands you may add them to the <code>commands</code> array in your <code>tinker.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;commands&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// App\Console\Commands\ExampleCommand::class,</span>
<span class="p">],</span>
</pre></div>

<h4>Classes That Should Not Be Aliased</h4>

<p>Typically, Tinker automatically aliases classes as you require them in Tinker. However, you may wish to never alias some classes. You may accomplish this by listing the classes in the <code>dont_alias</code> array of your <code>tinker.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;dont_alias&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="writing-commands"></a></p>

<h2>Writing Commands</h2>

<p>In addition to the commands provided with Artisan, you may also build your own custom commands. Commands are typically stored in the <code>app/Console/Commands</code> directory; however, you are free to choose your own storage location as long as your commands can be loaded by Composer.</p>

<p><a name="generating-commands"></a></p>

<h3>Generating Commands</h3>

<p>To create a new command, use the <code>make:command</code> Artisan command. This command will create a new command class in the <code>app/Console/Commands</code> directory. Don&#39;t worry if this directory does not exist in your application, since it will be created the first time you run the <code>make:command</code> Artisan command. The generated command will include the default set of properties and methods that are present on all commands:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">SendEmails</span>
</pre></div>

<p><a name="command-structure"></a></p>

<h3>Command Structure</h3>

<p>After generating your command, you should fill in the <code>signature</code> and <code>description</code> properties of the class, which will be used when displaying your command on the <code>list</code> screen. The <code>handle</code> method will be called when your command is executed. You may place your command logic in this method.</p>

<blockquote>
<p>{tip} For greater code reuse, it is good practice to keep your console commands light and let them defer to application services to accomplish their tasks. In the example below, note that we inject a service class to do the &quot;heavy lifting&quot; of sending the e-mails.</p>
</blockquote>

<p>Let&#39;s take a look at an example command. Note that we are able to inject any dependencies we need into the command&#39;s <code>handle</code> method. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject all dependencies that are type-hinted in this method&#39;s signature:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Support\DripEmailer</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendEmails</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user}&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;Send drip e-mails to a user&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new command instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Support\DripEmailer  $drip</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">DripEmailer</span> <span class="nv">$drip</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$drip</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">argument</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="closure-commands"></a></p>

<h3>Closure Commands</h3>

<p>Closure based commands provide an alternative to defining console commands as classes. In the same way that route Closures are an alternative to controllers, think of command Closures as an alternative to command classes. Within the <code>commands</code> method of your <code>app/Console/Kernel.php</code> file, Laravel loads the <code>routes/console.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register the Closure based commands for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">commands</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">require</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;routes/console.php&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Even though this file does not define HTTP routes, it defines console based entry points (routes) into your application. Within this file, you may define all of your Closure based routes using the <code>Artisan::command</code> method. The <code>command</code> method accepts two arguments: the <a href="#defining-input-expectations">command signature</a> and a Closure which receives the commands arguments and options:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;build {project}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$project</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s2">&quot;Building {$project}!&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>The Closure is bound to the underlying command instance, so you have full access to all of the helper methods you would typically be able to access on a full command class.</p>

<h4>Type-Hinting Dependencies</h4>

<p>In addition to receiving your command&#39;s arguments and options, command Closures may also type-hint additional dependencies that you would like resolved out of the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">DripEmailer</span><span class="p">;</span>

<span class="nx">Artisan</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;email:send {user}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">DripEmailer</span> <span class="nx">$drip</span><span class="p">,</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$drip</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<h4>Closure Command Descriptions</h4>

<p>When defining a Closure based command, you may use the <code>describe</code> method to add a description to the command. This description will be displayed when you run the <code>php artisan list</code> or <code>php artisan help</code> commands:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;build {project}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$project</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s2">&quot;Building {$project}!&quot;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Build the project&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="defining-input-expectations"></a></p>

<h2>Defining Input Expectations</h2>

<p>When writing console commands, it is common to gather input from the user through arguments or options. Laravel makes it very convenient to define the input you expect from the user using the <code>signature</code> property on your commands. The <code>signature</code> property allows you to define the name, arguments, and options for the command in a single, expressive, route-like syntax.</p>

<p><a name="arguments"></a></p>

<h3>Arguments</h3>

<p>All user supplied arguments and options are wrapped in curly braces. In the following example, the command defines one <strong>required</strong> argument: <code>user</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user}&#39;</span><span class="p">;</span>
</pre></div>

<p>You may also make arguments optional and define default values for arguments:</p>
<div class="highlight"><pre><span></span><span class="c1">// Optional argument...</span>
<span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="o">?</span><span class="p">}</span>

<span class="c1">// Optional argument with default value...</span>
<span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="o">=</span><span class="nx">foo</span><span class="p">}</span>
</pre></div>

<p><a name="options"></a></p>

<h3>Options</h3>

<p>Options, like arguments, are another form of user input. Options are prefixed by two hyphens (<code>--</code>) when they are specified on the command line. There are two types of options: those that receive a value and those that don&#39;t. Options that don&#39;t receive a value serve as a boolean &quot;switch&quot;. Let&#39;s take a look at an example of this type of option:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user} {--queue}&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the <code>--queue</code> switch may be specified when calling the Artisan command. If the <code>--queue</code> switch is passed, the value of the option will be <code>true</code>. Otherwise, the value will be <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="mi">1</span> <span class="o">--</span><span class="nx">queue</span>
</pre></div>

<p><a name="options-with-values"></a></p>

<h4>Options With Values</h4>

<p>Next, let&#39;s take a look at an option that expects a value. If the user must specify a value for an option, suffix the option name with a <code>=</code> sign:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send {user} {--queue=}&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the user may pass a value for the option like so:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="mi">1</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="k">default</span>
</pre></div>

<p>You may assign default values to options by specifying the default value after the option name. If no option value is passed by the user, the default value will be used:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="p">{</span><span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="k">default</span><span class="p">}</span>
</pre></div>

<p><a name="option-shortcuts"></a></p>

<h4>Option Shortcuts</h4>

<p>To assign a shortcut when defining an option, you may specify it before the option name and use a | delimiter to separate the shortcut from the full option name:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="p">{</span><span class="o">--</span><span class="nx">Q</span><span class="o">|</span><span class="nx">queue</span><span class="p">}</span>
</pre></div>

<p><a name="input-arrays"></a></p>

<h3>Input Arrays</h3>

<p>If you would like to define arguments or options to expect array inputs, you may use the <code>*</code> character. First, let&#39;s take a look at an example that specifies an array argument:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="o">*</span><span class="p">}</span>
</pre></div>

<p>When calling this method, the <code>user</code> arguments may be passed in order to the command line. For example, the following command will set the value of <code>user</code> to <code>[&#39;foo&#39;, &#39;bar&#39;]</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="nx">foo</span> <span class="nx">bar</span>
</pre></div>

<p>When defining an option that expects an array input, each option value passed to the command should be prefixed with the option name:</p>
<div class="highlight"><pre><span></span><span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span> <span class="p">{</span><span class="o">--</span><span class="nx">id</span><span class="o">=*</span><span class="p">}</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">email</span><span class="o">:</span><span class="nx">send</span> <span class="o">--</span><span class="nx">id</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="nx">id</span><span class="o">=</span><span class="mi">2</span>
</pre></div>

<p><a name="input-descriptions"></a></p>

<h3>Input Descriptions</h3>

<p>You may assign descriptions to input arguments and options by separating the parameter from the description using a colon. If you need a little extra room to define your command, feel free to spread the definition across multiple lines:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name and signature of the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$signature</span> <span class="o">=</span> <span class="s1">&#39;email:send</span>
<span class="s1">                        {user : The ID of the user}</span>
<span class="s1">                        {--queue= : Whether the job should be queued}&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="command-io"></a></p>

<h2>Command I/O</h2>

<p><a name="retrieving-input"></a></p>

<h3>Retrieving Input</h3>

<p>While your command is executing, you will obviously need to access the values for the arguments and options accepted by your command. To do so, you may use the <code>argument</code> and <code>option</code> methods:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$userId</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">argument</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you need to retrieve all of the arguments as an <code>array</code>, call the <code>arguments</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$arguments</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">arguments</span><span class="p">();</span>
</pre></div>

<p>Options may be retrieved just as easily as arguments using the <code>option</code> method. To retrieve all of the options as an array, call the <code>options</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve a specific option...</span>
<span class="nx">$queueName</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;queue&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve all options...</span>
<span class="nx">$options</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">options</span><span class="p">();</span>
</pre></div>

<p>If the argument or option does not exist, <code>null</code> will be returned.</p>

<p><a name="prompting-for-input"></a></p>

<h3>Prompting For Input</h3>

<p>In addition to displaying output, you may also ask the user to provide input during the execution of your command. The <code>ask</code> method will prompt the user with the given question, accept their input, and then return the user&#39;s input back to your command:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">ask</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>secret</code> method is similar to <code>ask</code>, but the user&#39;s input will not be visible to them as they type in the console. This method is useful when asking for sensitive information such as a password:</p>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">secret</span><span class="p">(</span><span class="s1">&#39;What is the password?&#39;</span><span class="p">);</span>
</pre></div>

<h4>Asking For Confirmation</h4>

<p>If you need to ask the user for a simple confirmation, you may use the <code>confirm</code> method. By default, this method will return <code>false</code>. However, if the user enters <code>y</code> or <code>yes</code> in response to the prompt, the method will return <code>true</code>.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;Do you wish to continue?&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Auto-Completion</h4>

<p>The <code>anticipate</code> method can be used to provide auto-completion for possible choices. The user can still choose any answer, regardless of the auto-completion hints:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">anticipate</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<p>Alternatively, you may pass a Closure as the second argument to the <code>anticipate</code> method. The Closure will be called each time the user types an input character. The Closure should accept a string parameter containing the user&#39;s input so far, and return an array of options for auto-completion:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">anticipate</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Return auto-completion options...</span>
<span class="p">});</span>
</pre></div>

<h4>Multiple Choice Questions</h4>

<p>If you need to give the user a predefined set of choices, you may use the <code>choice</code> method. You may set the array index of the default value to be returned if no option is chosen:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">],</span> <span class="nx">$defaultIndex</span><span class="p">);</span>
</pre></div>

<p>In addition, the <code>choice</code> method accepts optional fourth and fifth arguments for determining the maximum number of attempts to select a valid response and whether multiple selections are permitted:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">choice</span><span class="p">(</span>
    <span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">],</span>
    <span class="nx">$defaultIndex</span><span class="p">,</span>
    <span class="nx">$maxAttempts</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">$allowMultipleSelections</span> <span class="o">=</span> <span class="kc">false</span>
<span class="p">);</span>
</pre></div>

<p><a name="writing-output"></a></p>

<h3>Writing Output</h3>

<p>To send output to the console, use the <code>line</code>, <code>info</code>, <code>comment</code>, <code>question</code> and <code>error</code> methods. Each of these methods will use appropriate ANSI colors for their purpose. For example, let&#39;s display some general information to the user. Typically, the <code>info</code> method will display in the console as green text:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>To display an error message, use the <code>error</code> method. Error message text is typically displayed in red:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">);</span>
</pre></div>

<p>If you would like to display plain, uncolored console output, use the <code>line</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;Display this on the screen&#39;</span><span class="p">);</span>
</pre></div>

<h4>Table Layouts</h4>

<p>The <code>table</code> method makes it easy to correctly format multiple rows / columns of data. Just pass in the headers and rows to the method. The width and height will be dynamically calculated based on the given data:</p>
<div class="highlight"><pre><span></span><span class="nx">$headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">];</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">table</span><span class="p">(</span><span class="nx">$headers</span><span class="p">,</span> <span class="nx">$users</span><span class="p">);</span>
</pre></div>

<h4>Progress Bars</h4>

<p>For long running tasks, it could be helpful to show a progress indicator. Using the output object, we can start, advance and stop the Progress Bar. First, define the total number of steps the process will iterate through. Then, advance the Progress Bar after processing each item:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$bar</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">output</span><span class="o">-&gt;</span><span class="nx">createProgressBar</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$users</span><span class="p">));</span>

<span class="nx">$bar</span><span class="o">-&gt;</span><span class="nx">start</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">performTask</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>

    <span class="nx">$bar</span><span class="o">-&gt;</span><span class="nx">advance</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">$bar</span><span class="o">-&gt;</span><span class="nx">finish</span><span class="p">();</span>
</pre></div>

<p>For more advanced options, check out the <a href="https://symfony.com/doc/current/components/console/helpers/progressbar.html">Symfony Progress Bar component documentation</a>.</p>

<p><a name="registering-commands"></a></p>

<h2>Registering Commands</h2>

<p>Because of the <code>load</code> method call in your console kernel&#39;s <code>commands</code> method, all commands within the <code>app/Console/Commands</code> directory will automatically be registered with Artisan. In fact, you are free to make additional calls to the <code>load</code> method to scan other directories for Artisan commands:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register the commands for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">commands</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/Commands&#39;</span><span class="p">);</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/MoreCommands&#39;</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>You may also manually register commands by adding its class name to the <code>$commands</code> property of your <code>app/Console/Kernel.php</code> file. When Artisan boots, all the commands listed in this property will be resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and registered with Artisan:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$commands</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Commands</span><span class="err">\</span><span class="nx">SendEmails</span><span class="o">::</span><span class="kr">class</span>
<span class="p">];</span>
</pre></div>

<p><a name="programmatically-executing-commands"></a></p>

<h2>Programmatically Executing Commands</h2>

<p>Sometimes you may wish to execute an Artisan command outside of the CLI. For example, you may wish to fire an Artisan command from a route or controller. You may use the <code>call</code> method on the <code>Artisan</code> facade to accomplish this. The <code>call</code> method accepts either the command&#39;s name or class as the first argument, and an array of command parameters as the second argument. The exit code will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Alternatively, you may pass the entire Artisan command to the <code>call</code> method as a string:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send 1 --queue=default&#39;</span><span class="p">);</span>
</pre></div>

<p>Using the <code>queue</code> method on the <code>Artisan</code> facade, you may even queue Artisan commands so they are processed in the background by your <a href="/docs/%7B%7Bversion%7D%7D/queues">queue workers</a>. Before using this method, make sure you have configured your queue and are running a queue listener:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Artisan</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may also specify the connection or queue the Artisan command should be dispatched to:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">onConnection</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;commands&#39;</span><span class="p">);</span>
</pre></div>

<h4>Passing Array Values</h4>

<p>If your command defines an option that accepts an array, you may pass an array of values to that option:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--id&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<h4>Passing Boolean Values</h4>

<p>If you need to specify the value of an option that does not accept string values, such as the <code>--force</code> flag on the <code>migrate:refresh</code> command, you should pass <code>true</code> or <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$exitCode</span> <span class="o">=</span> <span class="nx">Artisan</span><span class="o">::</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;migrate:refresh&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;--force&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="calling-commands-from-other-commands"></a></p>

<h3>Calling Commands From Other Commands</h3>

<p>Sometimes you may wish to call other commands from an existing Artisan command. You may do so using the <code>call</code> method. This <code>call</code> method accepts the command name and an array of command parameters:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
    <span class="p">]);</span>

    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to call another console command and suppress all of its output, you may use the <code>callSilent</code> method. The <code>callSilent</code> method has the same signature as the <code>call</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">callSilent</span><span class="p">(</span><span class="s1">&#39;email:send&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;--queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span>
<span class="p">]);</span>
</pre></div>

<p><a name="stub-customization"></a></p>

<h2>Stub Customization</h2>

<p>The Artisan console&#39;s <code>make</code> commands are used to create a variety of classes, such as controllers, jobs, migrations, and tests. These classes are generated using &quot;stub&quot; files that are populated with values based on your input. However, you may sometimes wish to make small changes to files generated by Artisan. To accomplish this, you may use the <code>stub:publish</code> command to publish the most common stubs for customization:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">stub</span><span class="o">:</span><span class="nx">publish</span>
</pre></div>

<p>The published stubs will be located within a <code>stubs</code> directory in the root of your application. Any changes you make to these stubs will be reflected when you generate their corresponding classes using Artisan <code>make</code> commands.</p>
<div style="page-break-after: always;" ></div><h1>Authentication</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#introduction-database-considerations">Database Considerations</a></li>
</ul></li>
<li><a href="#authentication-quickstart">Authentication Quickstart</a>

<ul>
<li><a href="#included-routing">Routing</a></li>
<li><a href="#included-views">Views</a></li>
<li><a href="#included-authenticating">Authenticating</a></li>
<li><a href="#retrieving-the-authenticated-user">Retrieving The Authenticated User</a></li>
<li><a href="#protecting-routes">Protecting Routes</a></li>
<li><a href="#password-confirmation">Password Confirmation</a></li>
<li><a href="#login-throttling">Login Throttling</a></li>
</ul></li>
<li><a href="#authenticating-users">Manually Authenticating Users</a>

<ul>
<li><a href="#remembering-users">Remembering Users</a></li>
<li><a href="#other-authentication-methods">Other Authentication Methods</a></li>
</ul></li>
<li><a href="#http-basic-authentication">HTTP Basic Authentication</a>

<ul>
<li><a href="#stateless-http-basic-authentication">Stateless HTTP Basic Authentication</a></li>
</ul></li>
<li><a href="#logging-out">Logging Out</a>

<ul>
<li><a href="#invalidating-sessions-on-other-devices">Invalidating Sessions On Other Devices</a></li>
</ul></li>
<li><a href="https://github.com/laravel/socialite">Social Authentication</a></li>
<li><a href="#adding-custom-guards">Adding Custom Guards</a>

<ul>
<li><a href="#closure-request-guards">Closure Request Guards</a></li>
</ul></li>
<li><a href="#adding-custom-user-providers">Adding Custom User Providers</a>

<ul>
<li><a href="#the-user-provider-contract">The User Provider Contract</a></li>
<li><a href="#the-authenticatable-contract">The Authenticatable Contract</a></li>
</ul></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<blockquote>
<p>{tip} <strong>Want to get started fast?</strong> Install the <code>laravel/ui</code> Composer package and run <code>php artisan ui vue --auth</code> in a fresh Laravel application. After migrating your database, navigate your browser to <code>http://your-app.test/register</code> or any other URL that is assigned to your application. These commands will take care of scaffolding your entire authentication system!</p>
</blockquote>

<p>Laravel makes implementing authentication very simple. In fact, almost everything is configured for you out of the box. The authentication configuration file is located at <code>config/auth.php</code>, which contains several well documented options for tweaking the behavior of the authentication services.</p>

<p>At its core, Laravel&#39;s authentication facilities are made up of &quot;guards&quot; and &quot;providers&quot;. Guards define how users are authenticated for each request. For example, Laravel ships with a <code>session</code> guard which maintains state using session storage and cookies.</p>

<p>Providers define how users are retrieved from your persistent storage. Laravel ships with support for retrieving users using Eloquent and the database query builder. However, you are free to define additional providers as needed for your application.</p>

<p>Don&#39;t worry if this all sounds confusing now! Many applications will never need to modify the default authentication configuration.</p>

<p><a name="introduction-database-considerations"></a></p>

<h3>Database Considerations</h3>

<p>By default, Laravel includes an <code>App\Models\User</code> <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent model</a> in your <code>app/Models</code> directory. This model may be used with the default Eloquent authentication driver. If your application is not using Eloquent, you may use the <code>database</code> authentication driver which uses the Laravel query builder.</p>

<p>When building the database schema for the <code>App\Models\User</code> model, make sure the password column is at least 60 characters in length. Maintaining the default string column length of 255 characters would be a good choice.</p>

<p>Also, you should verify that your <code>users</code> (or equivalent) table contains a nullable, string <code>remember_token</code> column of 100 characters. This column will be used to store a token for users that select the &quot;remember me&quot; option when logging into your application.</p>

<p><a name="authentication-quickstart"></a></p>

<h2>Authentication Quickstart</h2>

<p><a name="included-routing"></a></p>

<h3>Routing</h3>

<p>Laravel&#39;s <code>laravel/ui</code> package provides a quick way to scaffold all of the routes and views you need for authentication using a few simple commands:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p>This command should be used on fresh applications and will install a layout view, registration and login views, as well as routes for all authentication end-points. A <code>HomeController</code> will also be generated to handle post-login requests to your application&#39;s dashboard.</p>

<p>The <code>laravel/ui</code> package also generates several pre-built authentication controllers, which are located in the <code>App\Http\Controllers\Auth</code> namespace. The <code>RegisterController</code> handles new user registration, the <code>LoginController</code> handles authentication, the <code>ForgotPasswordController</code> handles e-mailing links for resetting passwords, and the <code>ResetPasswordController</code> contains the logic to reset passwords. Each of these controllers uses a trait to include their necessary methods. For many applications, you will not need to modify these controllers at all.</p>

<blockquote>
<p>{tip} If your application doesnt need registration, you may disable it by removing the newly created <code>RegisterController</code> and modifying your route declaration: <code>Auth::routes([&#39;register&#39; =&gt; false]);</code>.</p>
</blockquote>

<h4>Creating Applications Including Authentication</h4>

<p>If you are starting a brand new application and would like to include the authentication scaffolding, you may use the <code>--auth</code> directive when creating your application. This command will create a new application with all of the authentication scaffolding compiled and installed:</p>
<div class="highlight"><pre><span></span><span class="nx">laravel</span> <span class="k">new</span> <span class="nx">blog</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p><a name="included-views"></a></p>

<h3>Views</h3>

<p>As mentioned in the previous section, the <code>laravel/ui</code> package&#39;s <code>php artisan ui vue --auth</code> command will create all of the views you need for authentication and place them in the <code>resources/views/auth</code> directory.</p>

<p>The <code>ui</code> command will also create a <code>resources/views/layouts</code> directory containing a base layout for your application. All of these views use the Bootstrap CSS framework, but you are free to customize them however you wish.</p>

<p><a name="included-authenticating"></a></p>

<h3>Authenticating</h3>

<p>Now that you have routes and views setup for the included authentication controllers, you are ready to register and authenticate new users for your application! You may access your application in a browser since the authentication controllers already contain the logic (via their traits) to authenticate existing users and store new users in the database.</p>

<h4>Path Customization</h4>

<p>When a user is successfully authenticated, they will be redirected to the <code>/home</code> URI. You can customize the post-authentication redirect path using the <code>HOME</code> constant defined in your <code>RouteServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kr">const</span> <span class="nx">HOME</span> <span class="o">=</span> <span class="s1">&#39;/home&#39;</span><span class="p">;</span>
</pre></div>

<p>If you need more robust customization of the response returned when a user is authenticated, Laravel provides an empty <code>authenticated(Request $request, $user)</code> method within the <code>AuthenticatesUsers</code> trait. This trait is used by the <code>LoginController</code> class that is installed into your application when using the <code>laravel/ui</code> package. Therefore, you can define your own <code>authenticated</code> method within the <code>LoginController</code> class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The user has been authenticated.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @param  mixed  $user</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">authenticated</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">([</span>
        <span class="c1">//</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<h4>Username Customization</h4>

<p>By default, Laravel uses the <code>email</code> field for authentication. If you would like to customize this, you may define a <code>username</code> method on your <code>LoginController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">username</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;username&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Guard Customization</h4>

<p>You may also customize the &quot;guard&quot; that is used to authenticate and register users. To get started, define a <code>guard</code> method on your <code>LoginController</code>, <code>RegisterController</code>, and <code>ResetPasswordController</code>. The method should return a guard instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">guard</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">guard</span><span class="p">(</span><span class="s1">&#39;guard-name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Validation / Storage Customization</h4>

<p>To modify the form fields that are required when a new user registers with your application, or to customize how new users are stored into your database, you may modify the <code>RegisterController</code> class. This class is responsible for validating and creating new users of your application.</p>

<p>The <code>validator</code> method of the <code>RegisterController</code> contains the validation rules for new users of the application. You are free to modify this method as you wish.</p>

<p>The <code>create</code> method of the <code>RegisterController</code> is responsible for creating new <code>App\Models\User</code> records in your database using the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>. You are free to modify this method according to the needs of your database.</p>

<p><a name="retrieving-the-authenticated-user"></a></p>

<h3>Retrieving The Authenticated User</h3>

<p>You may access the authenticated user via the <code>Auth</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="c1">// Get the currently authenticated user...</span>
<span class="nx">$user</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">();</span>

<span class="c1">// Get the currently authenticated user&#39;s ID...</span>
<span class="nx">$id</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">id</span><span class="p">();</span>
</pre></div>

<p>Alternatively, once a user is authenticated, you may access the authenticated user via an <code>Illuminate\Http\Request</code> instance. Remember, type-hinted classes will automatically be injected into your controller methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the user&#39;s profile.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// $request-&gt;user() returns an instance of the authenticated user...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If The Current User Is Authenticated</h4>

<p>To determine if the user is already logged into your application, you may use the <code>check</code> method on the <code>Auth</code> facade, which will return <code>true</code> if the user is authenticated:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// The user is logged in...</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Even though it is possible to determine if a user is authenticated using the <code>check</code> method, you will typically use a middleware to verify that the user is authenticated before allowing the user access to certain routes / controllers. To learn more about this, check out the documentation on <a href="/docs/%7B%7Bversion%7D%7D/authentication#protecting-routes">protecting routes</a>.</p>
</blockquote>

<p><a name="protecting-routes"></a></p>

<h3>Protecting Routes</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Route middleware</a> can be used to only allow authenticated users to access a given route. Laravel ships with an <code>auth</code> middleware, which is defined at <code>Illuminate\Auth\Middleware\Authenticate</code>. Since this middleware is already registered in your HTTP kernel, all you need to do is attach the middleware to a route definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
</pre></div>

<p>If you are using <a href="/docs/%7B%7Bversion%7D%7D/controllers">controllers</a>, you may call the <code>middleware</code> method from the controller&#39;s constructor instead of attaching it in the route definition directly:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Redirecting Unauthenticated Users</h4>

<p>When the <code>auth</code> middleware detects an unauthorized user, it will redirect the user to the <code>login</code> <a href="/docs/%7B%7Bversion%7D%7D/routing#named-routes">named route</a>. You may modify this behavior by updating the <code>redirectTo</code> function in your <code>app/Http/Middleware/Authenticate.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the path the user should be redirected to.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">redirectTo</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Specifying A Guard</h4>

<p>When attaching the <code>auth</code> middleware to a route, you may also specify which guard should be used to authenticate the user. The guard specified should correspond to one of the keys in the <code>guards</code> array of your <code>auth.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:api&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="password-confirmation"></a></p>

<h3>Password Confirmation</h3>

<p>Sometimes, you may wish to require the user to confirm their password before accessing a specific area of your application. For example, you may require this before the user modifies any billing settings within the application.</p>

<p>To accomplish this, Laravel provides a <code>password.confirm</code> middleware. Attaching the <code>password.confirm</code> middleware to a route will redirect users to a screen where they need to confirm their password before they can continue:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/settings/security&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Users must confirm their password before continuing...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;password.confirm&#39;</span><span class="p">]);</span>
</pre></div>

<p>After the user has successfully confirmed their password, the user is redirected to the route they originally tried to access. By default, after confirming their password, the user will not have to confirm their password again for three hours. You are free to customize the length of time before the user must re-confirm their password using the <code>auth.password_timeout</code> configuration option.</p>

<p><a name="login-throttling"></a></p>

<h3>Login Throttling</h3>

<p>If you are using Laravel&#39;s built-in <code>LoginController</code> class, the <code>Illuminate\Foundation\Auth\ThrottlesLogins</code> trait will already be included in your controller. By default, the user will not be able to login for one minute if they fail to provide the correct credentials after several attempts. The throttling is unique to the user&#39;s username / e-mail address and their IP address.</p>

<p><a name="authenticating-users"></a></p>

<h2>Manually Authenticating Users</h2>

<p>Note that you are not required to use the authentication controllers included with Laravel. If you choose to remove these controllers, you will need to manage user authentication using the Laravel authentication classes directly. Don&#39;t worry, it&#39;s a cinch!</p>

<p>We will access Laravel&#39;s authentication services via the <code>Auth</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>, so we&#39;ll need to make sure to import the <code>Auth</code> facade at the top of the class. Next, let&#39;s check out the <code>attempt</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoginController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an authentication attempt.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request $request</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticate</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$credentials</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">(</span><span class="nv">$credentials</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Authentication passed...</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">intended</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>attempt</code> method accepts an array of key / value pairs as its first argument. The values in the array will be used to find the user in your database table. So, in the example above, the user will be retrieved by the value of the <code>email</code> column. If the user is found, the hashed password stored in the database will be compared with the <code>password</code> value passed to the method via the array. You should not hash the password specified as the <code>password</code> value, since the framework will automatically hash the value before comparing it to the hashed password in the database. If the two hashed passwords match an authenticated session will be started for the user.</p>

<p>The <code>attempt</code> method will return <code>true</code> if authentication was successful. Otherwise, <code>false</code> will be returned.</p>

<p>The <code>intended</code> method on the redirector will redirect the user to the URL they were attempting to access before being intercepted by the authentication middleware. A fallback URI may be given to this method in case the intended destination is not available.</p>

<h4>Specifying Additional Conditions</h4>

<p>If you wish, you may also add extra conditions to the authentication query in addition to the user&#39;s e-mail and password. For example, we may verify that user is marked as &quot;active&quot;:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// The user is active, not suspended, and exists.</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} In these examples, <code>email</code> is not a required option, it is merely used as an example. You should use whatever column name corresponds to a &quot;username&quot; in your database.</p>
</blockquote>

<h4>Accessing Specific Guard Instances</h4>

<p>You may specify which guard instance you would like to utilize using the <code>guard</code> method on the <code>Auth</code> facade. This allows you to manage authentication for separate parts of your application using entirely separate authenticatable models or user tables.</p>

<p>The guard name passed to the <code>guard</code> method should correspond to one of the guards configured in your <code>auth.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">guard</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">attempt</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Logging Out</h4>

<p>To log users out of your application, you may use the <code>logout</code> method on the <code>Auth</code> facade. This will clear the authentication information in the user&#39;s session:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">logout</span><span class="p">();</span>
</pre></div>

<p><a name="remembering-users"></a></p>

<h3>Remembering Users</h3>

<p>If you would like to provide &quot;remember me&quot; functionality in your application, you may pass a boolean value as the second argument to the <code>attempt</code> method, which will keep the user authenticated indefinitely, or until they manually logout. Your <code>users</code> table must include the string <code>remember_token</code> column, which will be used to store the &quot;remember me&quot; token.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">attempt</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">$password</span><span class="p">],</span> <span class="nx">$remember</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user is being remembered...</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} If you are using the built-in <code>LoginController</code> that is shipped with Laravel, the proper logic to &quot;remember&quot; users is already implemented by the traits used by the controller.</p>
</blockquote>

<p>If you are &quot;remembering&quot; users, you may use the <code>viaRemember</code> method to determine if the user was authenticated using the &quot;remember me&quot; cookie:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">viaRemember</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="other-authentication-methods"></a></p>

<h3>Other Authentication Methods</h3>

<h4>Authenticate A User Instance</h4>

<p>If you need to log an existing user instance into your application, you may call the <code>login</code> method with the user instance. The given object must be an implementation of the <code>Illuminate\Contracts\Auth\Authenticatable</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a>. The <code>App\Models\User</code> model included with Laravel already implements this interface:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>

<span class="c1">// Login and &quot;remember&quot; the given user...</span>
<span class="nx">Auth</span><span class="o">::</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p>You may specify the guard instance you would like to use:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">guard</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">login</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
</pre></div>

<h4>Authenticate A User By ID</h4>

<p>To log a user into the application by their ID, you may use the <code>loginUsingId</code> method. This method accepts the primary key of the user you wish to authenticate:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">loginUsingId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Login and &quot;remember&quot; the given user...</span>
<span class="nx">Auth</span><span class="o">::</span><span class="nx">loginUsingId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<h4>Authenticate A User Once</h4>

<p>You may use the <code>once</code> method to log a user into the application for a single request. No sessions or cookies will be utilized, which means this method may be helpful when building a stateless API:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">once</span><span class="p">(</span><span class="nx">$credentials</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="http-basic-authentication"></a></p>

<h2>HTTP Basic Authentication</h2>

<p><a href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> provides a quick way to authenticate users of your application without setting up a dedicated &quot;login&quot; page. To get started, attach the <code>auth.basic</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> to your route. The <code>auth.basic</code> middleware is included with the Laravel framework, so you do not need to define it:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth.basic&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the middleware has been attached to the route, you will automatically be prompted for credentials when accessing the route in your browser. By default, the <code>auth.basic</code> middleware will use the <code>email</code> column on the user record as the &quot;username&quot;.</p>

<h4>A Note On FastCGI</h4>

<p>If you are using PHP FastCGI, HTTP Basic authentication may not work correctly out of the box. The following lines should be added to your <code>.htaccess</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}</span> <span class="o">^</span><span class="p">(.</span><span class="o">+</span><span class="p">)</span><span class="nx">$</span>
<span class="nx">RewriteRule</span> <span class="p">.</span><span class="o">*</span> <span class="o">-</span> <span class="p">[</span><span class="nx">E</span><span class="o">=</span><span class="nx">HTTP_AUTHORIZATION</span><span class="o">:%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}]</span>
</pre></div>

<p><a name="stateless-http-basic-authentication"></a></p>

<h3>Stateless HTTP Basic Authentication</h3>

<p>You may also use HTTP Basic Authentication without setting a user identifier cookie in the session, which is particularly useful for API authentication. To do so, <a href="/docs/%7B%7Bversion%7D%7D/middleware">define a middleware</a> that calls the <code>onceBasic</code> method. If no response is returned by the <code>onceBasic</code> method, the request may be passed further into the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthenticateOnceWithBasicAuth</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">onceBasic</span><span class="p">()</span> <span class="o">?:</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Next, <a href="/docs/%7B%7Bversion%7D%7D/middleware#registering-middleware">register the route middleware</a> and attach it to a route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;api/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only authenticated users may enter...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth.basic.once&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="logging-out"></a></p>

<h2>Logging Out</h2>

<p>To manually log users out of your application, you may use the <code>logout</code> method on the <code>Auth</code> facade. This will clear the authentication information in the user&#39;s session:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="nx">Auth</span><span class="o">::</span><span class="nx">logout</span><span class="p">();</span>
</pre></div>

<p><a name="invalidating-sessions-on-other-devices"></a></p>

<h3>Invalidating Sessions On Other Devices</h3>

<p>Laravel also provides a mechanism for invalidating and &quot;logging out&quot; a user&#39;s sessions that are active on other devices without invalidating the session on their current device. This feature is typically utilized when a user is changing or updating their password and you would like to invalidate sessions on other devices while keeping the current device authenticated.</p>

<p>Before getting started, you should make sure that the <code>Illuminate\Session\Middleware\AuthenticateSession</code> middleware is present and un-commented in your <code>app/Http/Kernel.php</code> class&#39; <code>web</code> middleware group:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Session</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AuthenticateSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="c1">// ...</span>
<span class="p">],</span>
</pre></div>

<p>Then, you may use the <code>logoutOtherDevices</code> method on the <code>Auth</code> facade. This method requires the user to provide their current password, which your application should accept through an input form:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="nx">Auth</span><span class="o">::</span><span class="nx">logoutOtherDevices</span><span class="p">(</span><span class="nx">$password</span><span class="p">);</span>
</pre></div>

<p>When the <code>logoutOtherDevices</code> method is invoked, the user&#39;s other sessions will be invalidated entirely, meaning they will be &quot;logged out&quot; of all guards they were previously authenticated by.</p>

<blockquote>
<p>{note} When using the <code>AuthenticateSession</code> middleware in combination with a custom route name for the <code>login</code> route, you must override the <code>unauthenticated</code> method on your application&#39;s exception handler to properly redirect users to your login page.</p>
</blockquote>

<p><a name="adding-custom-guards"></a></p>

<h2>Adding Custom Guards</h2>

<p>You may define your own authentication guards using the <code>extend</code> method on the <code>Auth</code> facade. You should place this call to <code>extend</code> within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. Since Laravel already ships with an <code>AuthServiceProvider</code>, we can place the code in that provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Services\Auth\JwtGuard</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>

        <span class="nx">Auth</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;jwt&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return an instance of Illuminate\Contracts\Auth\Guard...</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">JwtGuard</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">createUserProvider</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;provider&#39;</span><span class="p">]));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see in the example above, the callback passed to the <code>extend</code> method should return an implementation of <code>Illuminate\Contracts\Auth\Guard</code>. This interface contains a few methods you will need to implement to define a custom guard. Once your custom guard has been defined, you may use this guard in the <code>guards</code> configuration of your <code>auth.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;guards&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;jwt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="closure-request-guards"></a></p>

<h3>Closure Request Guards</h3>

<p>The simplest way to implement a custom, HTTP request based authentication system is by using the <code>Auth::viaRequest</code> method. This method allows you to quickly define your authentication process using a single Closure.</p>

<p>To get started, call the <code>Auth::viaRequest</code> method within the <code>boot</code> method of your <code>AuthServiceProvider</code>. The <code>viaRequest</code> method accepts an authentication driver name as its first argument. This name can be any string that describes your custom guard. The second argument passed to the method should be a Closure that receives the incoming HTTP request and returns a user instance or, if authentication fails, <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Auth</span><span class="o">::</span><span class="nx">viaRequest</span><span class="p">(</span><span class="s1">&#39;custom-token&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Once your custom authentication driver has been defined, you use it as a driver within <code>guards</code> configuration of your <code>auth.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;guards&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;custom-token&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="adding-custom-user-providers"></a></p>

<h2>Adding Custom User Providers</h2>

<p>If you are not using a traditional relational database to store your users, you will need to extend Laravel with your own authentication user provider. We will use the <code>provider</code> method on the <code>Auth</code> facade to define a custom user provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Extensions\RiakUserProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>

        <span class="nx">Auth</span><span class="o">::</span><span class="na">provider</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return an instance of Illuminate\Contracts\Auth\UserProvider...</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">RiakUserProvider</span><span class="p">(</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;riak.connection&#39;</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After you have registered the provider using the <code>provider</code> method, you may switch to the new user provider in your <code>auth.php</code> configuration file. First, define a <code>provider</code> that uses your new driver:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;users&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;riak&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>Finally, you may use this provider in your <code>guards</code> configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;guards&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="the-user-provider-contract"></a></p>

<h3>The User Provider Contract</h3>

<p>The <code>Illuminate\Contracts\Auth\UserProvider</code> implementations are only responsible for fetching a <code>Illuminate\Contracts\Auth\Authenticatable</code> implementation out of a persistent storage system, such as MySQL, Riak, etc. These two interfaces allow the Laravel authentication mechanisms to continue functioning regardless of how the user data is stored or what type of class is used to represent it.</p>

<p>Let&#39;s take a look at the <code>Illuminate\Contracts\Auth\UserProvider</code> contract:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Contracts\Auth</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">UserProvider</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveById</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveByToken</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateRememberToken</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveByCredentials</span><span class="p">(</span><span class="k">array</span> <span class="nv">$credentials</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateCredentials</span><span class="p">(</span><span class="nx">Authenticatable</span> <span class="nv">$user</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$credentials</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>retrieveById</code> function typically receives a key representing the user, such as an auto-incrementing ID from a MySQL database. The <code>Authenticatable</code> implementation matching the ID should be retrieved and returned by the method.</p>

<p>The <code>retrieveByToken</code> function retrieves a user by their unique <code>$identifier</code> and &quot;remember me&quot; <code>$token</code>, stored in a field <code>remember_token</code>. As with the previous method, the <code>Authenticatable</code> implementation should be returned.</p>

<p>The <code>updateRememberToken</code> method updates the <code>$user</code> field <code>remember_token</code> with the new <code>$token</code>. A fresh token is assigned on a successful &quot;remember me&quot; login attempt or when the user is logging out.</p>

<p>The <code>retrieveByCredentials</code> method receives the array of credentials passed to the <code>Auth::attempt</code> method when attempting to sign into an application. The method should then &quot;query&quot; the underlying persistent storage for the user matching those credentials. Typically, this method will run a query with a &quot;where&quot; condition on <code>$credentials[&#39;username&#39;]</code>. The method should then return an implementation of <code>Authenticatable</code>. <strong>This method should not attempt to do any password validation or authentication.</strong></p>

<p>The <code>validateCredentials</code> method should compare the given <code>$user</code> with the <code>$credentials</code> to authenticate the user. For example, this method should probably use <code>Hash::check</code> to compare the value of <code>$user-&gt;getAuthPassword()</code> to the value of <code>$credentials[&#39;password&#39;]</code>. This method should return <code>true</code> or <code>false</code> indicating on whether the password is valid.</p>

<p><a name="the-authenticatable-contract"></a></p>

<h3>The Authenticatable Contract</h3>

<p>Now that we have explored each of the methods on the <code>UserProvider</code>, let&#39;s take a look at the <code>Authenticatable</code> contract. Remember, the provider should return implementations of this interface from the <code>retrieveById</code>, <code>retrieveByToken</code>, and <code>retrieveByCredentials</code> methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Contracts\Auth</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthIdentifierName</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthIdentifier</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthPassword</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRememberToken</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setRememberToken</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRememberTokenName</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>This interface is simple. The <code>getAuthIdentifierName</code> method should return the name of the &quot;primary key&quot; field of the user and the <code>getAuthIdentifier</code> method should return the &quot;primary key&quot; of the user. In a MySQL back-end, again, this would be the auto-incrementing primary key. The <code>getAuthPassword</code> should return the user&#39;s hashed password. This interface allows the authentication system to work with any User class, regardless of what ORM or storage abstraction layer you are using. By default, Laravel includes a <code>User</code> class in the <code>app</code> directory which implements this interface, so you may consult this class for an implementation example.</p>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Laravel raises a variety of <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> during the authentication process. You may attach listeners to these events in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Illuminate\Auth\Events\Registered&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogRegisteredUser&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Attempting&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogAuthenticationAttempt&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Authenticated&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Login&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogSuccessfulLogin&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Failed&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogFailedLogin&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Validated&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogValidated&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Verified&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogVerified&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Logout&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogSuccessfulLogout&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\CurrentDeviceLogout&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogCurrentDeviceLogout&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\OtherDeviceLogout&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogOtherDeviceLogout&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\Lockout&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogLockout&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Auth\Events\PasswordReset&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogPasswordReset&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Authorization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#gates">Gates</a>

<ul>
<li><a href="#writing-gates">Writing Gates</a></li>
<li><a href="#authorizing-actions-via-gates">Authorizing Actions</a></li>
<li><a href="#gate-responses">Gate Responses</a></li>
<li><a href="#intercepting-gate-checks">Intercepting Gate Checks</a></li>
</ul></li>
<li><a href="#creating-policies">Creating Policies</a>

<ul>
<li><a href="#generating-policies">Generating Policies</a></li>
<li><a href="#registering-policies">Registering Policies</a></li>
</ul></li>
<li><a href="#writing-policies">Writing Policies</a>

<ul>
<li><a href="#policy-methods">Policy Methods</a></li>
<li><a href="#policy-responses">Policy Responses</a></li>
<li><a href="#methods-without-models">Methods Without Models</a></li>
<li><a href="#guest-users">Guest Users</a></li>
<li><a href="#policy-filters">Policy Filters</a></li>
</ul></li>
<li><a href="#authorizing-actions-using-policies">Authorizing Actions Using Policies</a>

<ul>
<li><a href="#via-the-user-model">Via The User Model</a></li>
<li><a href="#via-middleware">Via Middleware</a></li>
<li><a href="#via-controller-helpers">Via Controller Helpers</a></li>
<li><a href="#via-blade-templates">Via Blade Templates</a></li>
<li><a href="#supplying-additional-context">Supplying Additional Context</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to providing <a href="/docs/%7B%7Bversion%7D%7D/authentication">authentication</a> services out of the box, Laravel also provides a simple way to authorize user actions against a given resource. Like authentication, Laravel&#39;s approach to authorization is simple, and there are two primary ways of authorizing actions: gates and policies.</p>

<p>Think of gates and policies like routes and controllers. Gates provide a simple, Closure based approach to authorization while policies, like controllers, group their logic around a particular model or resource. We&#39;ll explore gates first and then examine policies.</p>

<p>You do not need to choose between exclusively using gates or exclusively using policies when building an application. Most applications will most likely contain a mixture of gates and policies, and that is perfectly fine! Gates are most applicable to actions which are not related to any model or resource, such as viewing an administrator dashboard. In contrast, policies should be used when you wish to authorize an action for a particular model or resource.</p>

<p><a name="gates"></a></p>

<h2>Gates</h2>

<p><a name="writing-gates"></a></p>

<h3>Writing Gates</h3>

<p>Gates are Closures that determine if a user is authorized to perform a given action and are typically defined in the <code>App\Providers\AuthServiceProvider</code> class using the <code>Gate</code> facade. Gates always receive a user instance as their first argument, and may optionally receive additional arguments such as a relevant Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;edit-settings&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">user_id</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Gates may also be defined using a class callback array, like controllers:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Policies</span><span class="err">\</span><span class="nx">PostPolicy</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">PostPolicy</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="authorizing-actions-via-gates"></a></p>

<h3>Authorizing Actions</h3>

<p>To authorize an action using gates, you should use the <code>allows</code> or <code>denies</code> methods. Note that you are not required to pass the currently authenticated user to these methods. Laravel will automatically take care of passing the user into the gate Closure:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;edit-settings&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The current user can edit settings</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The current user can update the post...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">denies</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The current user can&#39;t update the post...</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to determine if a particular user is authorized to perform an action, you may use the <code>forUser</code> method on the <code>Gate</code> facade:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">forUser</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">allows</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user can update the post...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">forUser</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">denies</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user can&#39;t update the post...</span>
<span class="p">}</span>
</pre></div>

<p>You may authorize multiple actions at a time with the <code>any</code> or <code>none</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">any</span><span class="p">([</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="s1">&#39;delete-post&#39;</span><span class="p">],</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user can update or delete the post</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">none</span><span class="p">([</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="s1">&#39;delete-post&#39;</span><span class="p">],</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The user cannot update or delete the post</span>
<span class="p">}</span>
</pre></div>

<h4>Authorizing Or Throwing Exceptions</h4>

<p>If you would like to attempt to authorize an action and automatically throw an <code>Illuminate\Auth\Access\AuthorizationException</code> if the user is not allowed to perform the given action, you may use the <code>Gate::authorize</code> method. Instances of <code>AuthorizationException</code> are automatically converted to <code>403</code> HTTP response:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;update-post&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>

<span class="c1">// The action is authorized...</span>
</pre></div>

<h4>Supplying Additional Context</h4>

<p>The gate methods for authorizing abilities (<code>allows</code>, <code>denies</code>, <code>check</code>, <code>any</code>, <code>none</code>, <code>authorize</code>, <code>can</code>, <code>cannot</code>) and the authorization <a href="#via-blade-templates">Blade directives</a> (<code>@can</code>, <code>@cannot</code>, <code>@canany</code>) can receive an array as the second argument. These array elements are passed as parameters to gate, and can be used for additional context when making authorization decisions:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;create-post&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$category</span><span class="p">,</span> <span class="nx">$extraFlag</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$category</span><span class="o">-&gt;</span><span class="nx">group</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">$extraFlag</span> <span class="o">===</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Gate</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;create-post&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$category</span><span class="p">,</span> <span class="nx">$extraFlag</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// The user can create the post...</span>
<span class="p">}</span>
</pre></div>

<p><a name="gate-responses"></a></p>

<h3>Gate Responses</h3>

<p>So far, we have only examined gates that return simple boolean values. However, sometimes you may wish to return a more detailed response, including an error message. To do so, you may return a <code>Illuminate\Auth\Access\Response</code> from your gate:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Access</span><span class="err">\</span><span class="nx">Response</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Gate</span><span class="p">;</span>

<span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;edit-settings&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isAdmin</span>
                <span class="o">?</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">allow</span><span class="p">()</span>
                <span class="o">:</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">deny</span><span class="p">(</span><span class="s1">&#39;You must be a super administrator.&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>When returning an authorization response from your gate, the <code>Gate::allows</code> method will still return a simple boolean value; however, you may use the <code>Gate::inspect</code> method to get the full authorization response returned by the gate:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Gate</span><span class="o">::</span><span class="nx">inspect</span><span class="p">(</span><span class="s1">&#39;edit-settings&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">allowed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// The action is authorized...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">message</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Of course, when using the <code>Gate::authorize</code> method to throw an <code>AuthorizationException</code> if the action is not authorized, the error message provided by the authorization response will be propagated to the HTTP response:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;edit-settings&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>

<span class="c1">// The action is authorized...</span>
</pre></div>

<p><a name="intercepting-gate-checks"></a></p>

<h3>Intercepting Gate Checks</h3>

<p>Sometimes, you may wish to grant all abilities to a specific user. You may use the <code>before</code> method to define a callback that is run before all other authorization checks:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isSuperAdmin</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>If the <code>before</code> callback returns a non-null result that result will be considered the result of the check.</p>

<p>You may use the <code>after</code> method to define a callback to be executed after all other authorization checks:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">,</span> <span class="nx">$result</span><span class="p">,</span> <span class="nx">$arguments</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isSuperAdmin</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>Similar to the <code>before</code> check, if the <code>after</code> callback returns a non-null result that result will be considered the result of the check.</p>

<p><a name="creating-policies"></a></p>

<h2>Creating Policies</h2>

<p><a name="generating-policies"></a></p>

<h3>Generating Policies</h3>

<p>Policies are classes that organize authorization logic around a particular model or resource. For example, if your application is a blog, you may have a <code>Post</code> model and a corresponding <code>PostPolicy</code> to authorize user actions such as creating or updating posts.</p>

<p>You may generate a policy using the <code>make:policy</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">artisan command</a>. The generated policy will be placed in the <code>app/Policies</code> directory. If this directory does not exist in your application, Laravel will create it for you:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">policy</span> <span class="nx">PostPolicy</span>
</pre></div>

<p>The <code>make:policy</code> command will generate an empty policy class. If you would like to generate a class with the basic &quot;CRUD&quot; policy methods already included in the class, you may specify a <code>--model</code> when executing the command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">policy</span> <span class="nx">PostPolicy</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="nx">Post</span>
</pre></div>

<blockquote>
<p>{tip} All policies are resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, allowing you to type-hint any needed dependencies in the policy&#39;s constructor to have them automatically injected.</p>
</blockquote>

<p><a name="registering-policies"></a></p>

<h3>Registering Policies</h3>

<p>Once the policy exists, it needs to be registered. The <code>AuthServiceProvider</code> included with fresh Laravel applications contains a <code>policies</code> property which maps your Eloquent models to their corresponding policies. Registering a policy will instruct Laravel which policy to utilize when authorizing actions against a given model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Policies\PostPolicy</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Gate</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The policy mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$policies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">Post</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="nx">PostPolicy</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Register any application authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Policy Auto-Discovery</h4>

<p>Instead of manually registering model policies, Laravel can auto-discover policies as long as the model and policy follow standard Laravel naming conventions. Specifically, the policies must be in a <code>Policies</code> directory at or above the directory that contains your models. So, for example, the models may be placed in the <code>app/Models</code> directory while the policies may be placed in the <code>app/Policies</code> directory. In this situation, Laravel will check for policies in <code>app/Models/Policies</code> then <code>app/Policies</code>. In addition, the policy name must match the model name and have a <code>Policy</code> suffix. So, a <code>User</code> model would correspond to a <code>UserPolicy</code> class.</p>

<p>If you would like to provide your own policy discovery logic, you may register a custom callback using the <code>Gate::guessPolicyNamesUsing</code> method. Typically, this method should be called from the <code>boot</code> method of your application&#39;s <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Gate</span><span class="p">;</span>

<span class="nx">Gate</span><span class="o">::</span><span class="nx">guessPolicyNamesUsing</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$modelClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return policy class name...</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} Any policies that are explicitly mapped in your <code>AuthServiceProvider</code> will take precedence over any potential auto-discovered policies.</p>
</blockquote>

<p><a name="writing-policies"></a></p>

<h2>Writing Policies</h2>

<p><a name="policy-methods"></a></p>

<h3>Policy Methods</h3>

<p>Once the policy has been registered, you may add methods for each action it authorizes. For example, let&#39;s define an <code>update</code> method on our <code>PostPolicy</code> which determines if a given <code>User</code> can update a given <code>Post</code> instance.</p>

<p>The <code>update</code> method will receive a <code>User</code> and a <code>Post</code> instance as its arguments, and should return <code>true</code> or <code>false</code> indicating whether the user is authorized to update the given <code>Post</code>. So, for this example, let&#39;s verify that the user&#39;s <code>id</code> matches the <code>user_id</code> on the post:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Policies</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostPolicy</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Determine if the given post can be updated by the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @param  \App\Models\Post  $post</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may continue to define additional methods on the policy as needed for the various actions it authorizes. For example, you might define <code>view</code> or <code>delete</code> methods to authorize various <code>Post</code> actions, but remember you are free to give your policy methods any name you like.</p>

<blockquote>
<p>{tip} If you used the <code>--model</code> option when generating your policy via the Artisan console, it will already contain methods for the <code>viewAny</code>, <code>view</code>, <code>create</code>, <code>update</code>, <code>delete</code>, <code>restore</code>, and <code>forceDelete</code> actions.</p>
</blockquote>

<p><a name="policy-responses"></a></p>

<h3>Policy Responses</h3>

<p>So far, we have only examined policy methods that return simple boolean values. However, sometimes you may wish to return a more detailed response, including an error message. To do so, you may return an <code>Illuminate\Auth\Access\Response</code> from your policy method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Access</span><span class="err">\</span><span class="nx">Response</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Determine if the given post can be updated by the user.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \App\Models\User  $user</span>
<span class="cm"> * @param  \App\Models\Post  $post</span>
<span class="cm"> * @return \Illuminate\Auth\Access\Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nx">$post</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">user_id</span>
                <span class="o">?</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">allow</span><span class="p">()</span>
                <span class="o">:</span> <span class="nx">Response</span><span class="o">::</span><span class="nx">deny</span><span class="p">(</span><span class="s1">&#39;You do not own this post.&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>When returning an authorization response from your policy, the <code>Gate::allows</code> method will still return a simple boolean value; however, you may use the <code>Gate::inspect</code> method to get the full authorization response returned by the gate:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Gate</span><span class="o">::</span><span class="nx">inspect</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">allowed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// The action is authorized...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">message</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Of course, when using the <code>Gate::authorize</code> method to throw an <code>AuthorizationException</code> if the action is not authorized, the error message provided by the authorization response will be propagated to the HTTP response:</p>
<div class="highlight"><pre><span></span><span class="nx">Gate</span><span class="o">::</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">);</span>

<span class="c1">// The action is authorized...</span>
</pre></div>

<p><a name="methods-without-models"></a></p>

<h3>Methods Without Models</h3>

<p>Some policy methods only receive the currently authenticated user and not an instance of the model they authorize. This situation is most common when authorizing <code>create</code> actions. For example, if you are creating a blog, you may wish to check if a user is authorized to create any posts at all.</p>

<p>When defining policy methods that will not receive a model instance, such as a <code>create</code> method, it will not receive a model instance. Instead, you should define the method as only expecting the authenticated user:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the given user can create posts.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \App\Models\User  $user</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">create</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="guest-users"></a></p>

<h3>Guest Users</h3>

<p>By default, all gates and policies automatically return <code>false</code> if the incoming HTTP request was not initiated by an authenticated user. However, you may allow these authorization checks to pass through to your gates and policies by declaring an &quot;optional&quot; type-hint or supplying a <code>null</code> default value for the user argument definition:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Policies</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostPolicy</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Determine if the given post can be updated by the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @param  \App\Models\Post  $post</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="o">?</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">optional</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="policy-filters"></a></p>

<h3>Policy Filters</h3>

<p>For certain users, you may wish to authorize all actions within a given policy. To accomplish this, define a <code>before</code> method on the policy. The <code>before</code> method will be executed before any other methods on the policy, giving you an opportunity to authorize the action before the intended policy method is actually called. This feature is most commonly used for authorizing application administrators to perform any action:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">before</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$ability</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isSuperAdmin</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to deny all authorizations for a user you should return <code>false</code> from the <code>before</code> method. If <code>null</code> is returned, the authorization will fall through to the policy method.</p>

<blockquote>
<p>{note} The <code>before</code> method of a policy class will not be called if the class doesn&#39;t contain a method with a name matching the name of the ability being checked.</p>
</blockquote>

<p><a name="authorizing-actions-using-policies"></a></p>

<h2>Authorizing Actions Using Policies</h2>

<p><a name="via-the-user-model"></a></p>

<h3>Via The User Model</h3>

<p>The <code>User</code> model that is included with your Laravel application includes two helpful methods for authorizing actions: <code>can</code> and <code>cant</code>. The <code>can</code> method receives the action you wish to authorize and the relevant model. For example, let&#39;s determine if a user is authorized to update a given <code>Post</code> model:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If a <a href="#registering-policies">policy is registered</a> for the given model, the <code>can</code> method will automatically call the appropriate policy and return the boolean result. If no policy is registered for the model, the <code>can</code> method will attempt to call the Closure based Gate matching the given action name.</p>

<h4>Actions That Don&#39;t Require Models</h4>

<p>Remember, some actions like <code>create</code> may not require a model instance. In these situations, you may pass a class name to the <code>can</code> method. The class name will be used to determine which policy to use when authorizing the action:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Executes the &quot;create&quot; method on the relevant policy...</span>
<span class="p">}</span>
</pre></div>

<p><a name="via-middleware"></a></p>

<h3>Via Middleware</h3>

<p>Laravel includes a middleware that can authorize actions before the incoming request even reaches your routes or controllers. By default, the <code>Illuminate\Auth\Middleware\Authorize</code> middleware is assigned the <code>can</code> key in your <code>App\Http\Kernel</code> class. Let&#39;s explore an example of using the <code>can</code> middleware to authorize that a user can update a blog post:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/post/{post}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Post</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The current user may update the post...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;can:update,post&#39;</span><span class="p">);</span>
</pre></div>

<p>In this example, we&#39;re passing the <code>can</code> middleware two arguments. The first is the name of the action we wish to authorize and the second is the route parameter we wish to pass to the policy method. In this case, since we are using <a href="/docs/%7B%7Bversion%7D%7D/routing#implicit-binding">implicit model binding</a>, a <code>Post</code> model will be passed to the policy method. If the user is not authorized to perform the given action, a HTTP response with a <code>403</code> status code will be generated by the middleware.</p>

<h4>Actions That Don&#39;t Require Models</h4>

<p>Again, some actions like <code>create</code> may not require a model instance. In these situations, you may pass a class name to the middleware. The class name will be used to determine which policy to use when authorizing the action:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// The current user may create posts...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;can:create,App\Models\Post&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="via-controller-helpers"></a></p>

<h3>Via Controller Helpers</h3>

<p>In addition to helpful methods provided to the <code>User</code> model, Laravel provides a helpful <code>authorize</code> method to any of your controllers which extend the <code>App\Http\Controllers\Controller</code> base class. Like the <code>can</code> method, this method accepts the name of the action you wish to authorize and the relevant model. If the action is not authorized, the <code>authorize</code> method will throw an <code>Illuminate\Auth\Access\AuthorizationException</code>, which the default Laravel exception handler will convert to an HTTP response with a <code>403</code> status code:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  Post  $post</span>
<span class="sd">     * @return Response</span>
<span class="sd">     * @throws \Illuminate\Auth\Access\AuthorizationException</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authorize</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nv">$post</span><span class="p">);</span>

        <span class="c1">// The current user can update the blog post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Actions That Don&#39;t Require Models</h4>

<p>As previously discussed, some actions like <code>create</code> may not require a model instance. In these situations, you should pass a class name to the <code>authorize</code> method. The class name will be used to determine which policy to use when authorizing the action:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Create a new blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> * @throws \Illuminate\Auth\Access\AuthorizationException</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">create</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

    <span class="c1">// The current user can create blog posts...</span>
<span class="p">}</span>
</pre></div>

<h4>Authorizing Resource Controllers</h4>

<p>If you are utilizing <a href="/docs/%7B%7Bversion%7D%7D/controllers#resource-controllers">resource controllers</a>, you may make use of the <code>authorizeResource</code> method in the controller&#39;s constructor. This method will attach the appropriate <code>can</code> middleware definitions to the resource controller&#39;s methods.</p>

<p>The <code>authorizeResource</code> method accepts the model&#39;s class name as its first argument, and the name of the route / request parameter that will contain the model&#39;s ID as its second argument. You should ensure your <a href="/docs/%7B%7Bversion%7D%7D/controllers#resource-controllers">resource controller</a> is created with the <code>--model</code> flag to have the required method signatures and type hints:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authorizeResource</span><span class="p">(</span><span class="nx">Post</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The following controller methods will be mapped to their corresponding policy method:</p>

<p>| Controller Method | Policy Method |
| --- | --- |
| index | viewAny |
| show | view |
| create | create |
| store | create |
| edit | update |
| update | update |
| destroy | delete |</p>

<blockquote>
<p>{tip} You may use the <code>make:policy</code> command with the <code>--model</code> option to quickly generate a policy class for a given model: <code>php artisan make:policy PostPolicy --model=Post</code>.</p>
</blockquote>

<p><a name="via-blade-templates"></a></p>

<h3>Via Blade Templates</h3>

<p>When writing Blade templates, you may wish to display a portion of the page only if the user is authorized to perform a given action. For example, you may wish to show an update form for a blog post only if the user can actually update the post. In this situation, you may use the <code>@can</code> and <code>@cannot</code> family of directives:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">elsecan</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Create</span> <span class="nx">New</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcan</span>

<span class="err">@</span><span class="nx">cannot</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Cannot</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">elsecannot</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Cannot</span> <span class="nx">Create</span> <span class="nx">A</span> <span class="nx">New</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcannot</span>
</pre></div>

<p>These directives are convenient shortcuts for writing <code>@if</code> and <code>@unless</code> statements. The <code>@can</code> and <code>@cannot</code> statements above respectively translate to the following statements:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endif</span>

<span class="err">@</span><span class="nx">unless</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$post</span><span class="p">))</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Cannot</span> <span class="nx">Update</span> <span class="nx">The</span> <span class="nx">Post</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endunless</span>
</pre></div>

<p>You may also determine if a user has any authorization ability from a given list of abilities. To accomplish this, use the <code>@canany</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">canany</span><span class="p">([</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">],</span> <span class="nx">$post</span><span class="p">)</span>
    <span class="c1">// The current user can update, view, or delete the post</span>
<span class="err">@</span><span class="nx">elsecanany</span><span class="p">([</span><span class="s1">&#39;create&#39;</span><span class="p">],</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="c1">// The current user can create a post</span>
<span class="err">@</span><span class="nx">endcanany</span>
</pre></div>

<h4>Actions That Don&#39;t Require Models</h4>

<p>Like most of the other authorization methods, you may pass a class name to the <code>@can</code> and <code>@cannot</code> directives if the action does not require a model instance:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span> <span class="nx">Create</span> <span class="nx">Posts</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcan</span>

<span class="err">@</span><span class="nx">cannot</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="c">&lt;!--</span> <span class="nx">The</span> <span class="nx">Current</span> <span class="nx">User</span> <span class="nx">Can</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">Create</span> <span class="nx">Posts</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">endcannot</span>
</pre></div>

<p><a name="supplying-additional-context"></a></p>

<h3>Supplying Additional Context</h3>

<p>When authorizing actions using policies, you may pass an array as the second argument to the various authorization functions and helpers. The first element in the array will be used to determine which policy should be invoked, while the rest of the array elements are passed as parameters to the policy method and can be used for additional context when making authorization decisions. For example, consider the following <code>PostPolicy</code> method definition which contains an additional <code>$category</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the given post can be updated by the user.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \App\Models\User  $user</span>
<span class="cm"> * @param  \App\Models\  $post</span>
<span class="cm"> * @param  int  $category</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nx">$post</span><span class="p">,</span> <span class="kr">int</span> <span class="nx">$category</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">user_id</span> <span class="o">&amp;&amp;</span>
           <span class="nx">$category</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>When attempting to determine if the authenticated user can update a given post, we can invoke this policy method like so:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Update the given blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @param  Post  $post</span>
<span class="cm"> * @return Response</span>
<span class="cm"> * @throws \Illuminate\Auth\Access\AuthorizationException</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">Post</span> <span class="nx">$post</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">authorize</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$post</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)]);</span>

    <span class="c1">// The current user can update the blog post...</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Cashier</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#upgrading-cashier">Upgrading Cashier</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#billable-model">Billable Model</a></li>
<li><a href="#api-keys">API Keys</a></li>
<li><a href="#currency-configuration">Currency Configuration</a></li>
<li><a href="#logging">Logging</a></li>
</ul></li>
<li><a href="#customers">Customers</a>

<ul>
<li><a href="#retrieving-customers">Retrieving Customers</a></li>
<li><a href="#creating-customers">Creating Customers</a></li>
<li><a href="#updating-customers">Updating Customers</a></li>
<li><a href="#billing-portal">Billing Portal</a></li>
</ul></li>
<li><a href="#payment-methods">Payment Methods</a>

<ul>
<li><a href="#storing-payment-methods">Storing Payment Methods</a></li>
<li><a href="#retrieving-payment-methods">Retrieving Payment Methods</a></li>
<li><a href="#check-for-a-payment-method">Determining If A User Has A Payment Method</a></li>
<li><a href="#updating-the-default-payment-method">Updating The Default Payment Method</a></li>
<li><a href="#adding-payment-methods">Adding Payment Methods</a></li>
<li><a href="#deleting-payment-methods">Deleting Payment Methods</a></li>
</ul></li>
<li><a href="#subscriptions">Subscriptions</a>

<ul>
<li><a href="#creating-subscriptions">Creating Subscriptions</a></li>
<li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
<li><a href="#changing-plans">Changing Plans</a></li>
<li><a href="#subscription-quantity">Subscription Quantity</a></li>
<li><a href="#multiplan-subscriptions">Multiplan Subscriptions</a></li>
<li><a href="#subscription-taxes">Subscription Taxes</a></li>
<li><a href="#subscription-anchor-date">Subscription Anchor Date</a></li>
<li><a href="#cancelling-subscriptions">Cancelling Subscriptions</a></li>
<li><a href="#resuming-subscriptions">Resuming Subscriptions</a></li>
</ul></li>
<li><a href="#subscription-trials">Subscription Trials</a>

<ul>
<li><a href="#with-payment-method-up-front">With Payment Method Up Front</a></li>
<li><a href="#without-payment-method-up-front">Without Payment Method Up Front</a></li>
<li><a href="#extending-trials">Extending Trials</a></li>
</ul></li>
<li><a href="#handling-stripe-webhooks">Handling Stripe Webhooks</a>

<ul>
<li><a href="#defining-webhook-event-handlers">Defining Webhook Event Handlers</a></li>
<li><a href="#handling-failed-subscriptions">Failed Subscriptions</a></li>
<li><a href="#verifying-webhook-signatures">Verifying Webhook Signatures</a></li>
</ul></li>
<li><a href="#single-charges">Single Charges</a>

<ul>
<li><a href="#simple-charge">Simple Charge</a></li>
<li><a href="#charge-with-invoice">Charge With Invoice</a></li>
<li><a href="#refunding-charges">Refunding Charges</a></li>
</ul></li>
<li><a href="#invoices">Invoices</a>

<ul>
<li><a href="#retrieving-invoices">Retrieving Invoices</a></li>
<li><a href="#generating-invoice-pdfs">Generating Invoice PDFs</a></li>
</ul></li>
<li><a href="#handling-failed-payments">Handling Failed Payments</a></li>
<li><a href="#strong-customer-authentication">Strong Customer Authentication (SCA)</a>

<ul>
<li><a href="#payments-requiring-additional-confirmation">Payments Requiring Additional Confirmation</a></li>
<li><a href="#off-session-payment-notifications">Off-session Payment Notifications</a></li>
</ul></li>
<li><a href="#stripe-sdk">Stripe SDK</a></li>
<li><a href="#testing">Testing</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Cashier provides an expressive, fluent interface to <a href="https://stripe.com">Stripe&#39;s</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading writing. In addition to basic subscription management, Cashier can handle coupons, swapping subscription, subscription &quot;quantities&quot;, cancellation grace periods, and even generate invoice PDFs.</p>

<p><a name="upgrading-cashier"></a></p>

<h2>Upgrading Cashier</h2>

<p>When upgrading to a new version of Cashier, it&#39;s important that you carefully review <a href="https://github.com/laravel/cashier-stripe/blob/master/UPGRADE.md">the upgrade guide</a>.</p>

<blockquote>
<p>{note} To prevent breaking changes, Cashier uses a fixed Stripe API version. Cashier 12 utilizes Stripe API version <code>2020-03-02</code>. The Stripe API version will be updated on minor releases in order to make use of new Stripe features and improvements.</p>
</blockquote>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>First, require the Cashier package for Stripe with Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">cashier</span>
</pre></div>

<blockquote>
<p>{note} To ensure Cashier properly handles all Stripe events, remember to <a href="#handling-stripe-webhooks">set up Cashier&#39;s webhook handling</a>.</p>
</blockquote>

<h4>Database Migrations</h4>

<p>The Cashier service provider registers its own database migration directory, so remember to migrate your database after installing the package. The Cashier migrations will add several columns to your <code>users</code> table as well as create a new <code>subscriptions</code> table to hold all of your customer&#39;s subscriptions:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>If you need to overwrite the migrations that ship with the Cashier package, you can publish them using the <code>vendor:publish</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="s2">&quot;cashier-migrations&quot;</span>
</pre></div>

<p>If you would like to prevent Cashier&#39;s migrations from running entirely, you may use the <code>ignoreMigrations</code> provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="nx">Cashier</span><span class="o">::</span><span class="nx">ignoreMigrations</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Stripe recommends that any column used for storing Stripe identifiers should be case-sensitive. Therefore, you should ensure the column collation for the <code>stripe_id</code> column is set to, for example, <code>utf8_bin</code> in MySQL. More info can be found <a href="https://stripe.com/docs/upgrades#what-changes-does-stripe-consider-to-be-backwards-compatible">in the Stripe documentation</a>.</p>
</blockquote>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p><a name="billable-model"></a></p>

<h3>Billable Model</h3>

<p>Before using Cashier, add the <code>Billable</code> trait to your model definition. This trait provides various methods to allow you to perform common billing tasks, such as creating subscriptions, applying coupons, and updating payment method information:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Billable</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">Billable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Cashier assumes your Billable model will be the <code>App\Models\User</code> class that ships with Laravel. If you wish to change this you can specify a different model in your <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_MODEL</span><span class="o">=</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span>
</pre></div>

<blockquote>
<p>{note} If you&#39;re using a model other than Laravel&#39;s supplied <code>App\Models\User</code> model, you&#39;ll need to publish and alter the <a href="#installation">migrations</a> provided to match your alternative model&#39;s table name.</p>
</blockquote>

<p><a name="api-keys"></a></p>

<h3>API Keys</h3>

<p>Next, you should configure your Stripe keys in your <code>.env</code> file. You can retrieve your Stripe API keys from the Stripe control panel.</p>
<div class="highlight"><pre><span></span><span class="nx">STRIPE_KEY</span><span class="o">=</span><span class="nx">your</span><span class="o">-</span><span class="nx">stripe</span><span class="o">-</span><span class="nx">key</span>
<span class="nx">STRIPE_SECRET</span><span class="o">=</span><span class="nx">your</span><span class="o">-</span><span class="nx">stripe</span><span class="o">-</span><span class="nx">secret</span>
</pre></div>

<p><a name="currency-configuration"></a></p>

<h3>Currency Configuration</h3>

<p>The default Cashier currency is United States Dollars (USD). You can change the default currency by setting the <code>CASHIER_CURRENCY</code> environment variable:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_CURRENCY</span><span class="o">=</span><span class="nx">eur</span>
</pre></div>

<p>In addition to configuring Cashier&#39;s currency, you may also specify a locale to be used when formatting money values for display on invoices. Internally, Cashier utilizes <a href="https://www.php.net/manual/en/class.numberformatter.php">PHP&#39;s <code>NumberFormatter</code> class</a> to set the currency locale:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_CURRENCY_LOCALE</span><span class="o">=</span><span class="nx">nl_BE</span>
</pre></div>

<blockquote>
<p>{note} In order to use locales other than <code>en</code>, ensure the <code>ext-intl</code> PHP extension is installed and configured on your server.</p>
</blockquote>

<p><a name="logging"></a></p>

<h4>Logging</h4>

<p>Cashier allows you to specify the log channel to be used when logging all Stripe related exceptions. You may specify the log channel using the <code>CASHIER_LOGGER</code> environment variable:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_LOGGER</span><span class="o">=</span><span class="nx">stack</span>
</pre></div>

<p><a name="customers"></a></p>

<h2>Customers</h2>

<p><a name="retrieving-customers"></a></p>

<h3>Retrieving Customers</h3>

<p>You can retrieve a customer by their Stripe ID using the <code>Cashier::findBillable</code> method. This will return an instance of the Billable model:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="nx">$user</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="nx">findBillable</span><span class="p">(</span><span class="nx">$stripeId</span><span class="p">);</span>
</pre></div>

<p><a name="creating-customers"></a></p>

<h3>Creating Customers</h3>

<p>Occasionally, you may wish to create a Stripe customer without beginning a subscription. You may accomplish this using the <code>createAsStripeCustomer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeCustomer</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createAsStripeCustomer</span><span class="p">();</span>
</pre></div>

<p>Once the customer has been created in Stripe, you may begin a subscription at a later date. You can also use an optional <code>$options</code> array to pass in any additional parameters which are supported by the Stripe API:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeCustomer</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createAsStripeCustomer</span><span class="p">(</span><span class="nx">$options</span><span class="p">);</span>
</pre></div>

<p>You may use the <code>asStripeCustomer</code> method if you want to return the customer object if the billable entity is already a customer within Stripe:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeCustomer</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">asStripeCustomer</span><span class="p">();</span>
</pre></div>

<p>The <code>createOrGetStripeCustomer</code> method may be used if you want to return the customer object but are not sure whether the billable entity is already a customer within Stripe. This method will create a new customer in Stripe if one does not already exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeCustomer</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createOrGetStripeCustomer</span><span class="p">();</span>
</pre></div>

<p><a name="updating-customers"></a></p>

<h3>Updating Customers</h3>

<p>Occasionally, you may wish to update the Stripe customer directly with additional information. You may accomplish this using the <code>updateStripeCustomer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeCustomer</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">updateStripeCustomer</span><span class="p">(</span><span class="nx">$options</span><span class="p">);</span>
</pre></div>

<p><a name="billing-portal"></a></p>

<h3>Billing Portal</h3>

<p>Stripe offers <a href="https://stripe.com/docs/billing/subscriptions/customer-portal">an easy way to set up a billing portal</a> so your customer can manage their subscription, payment methods, and view their billing history. You can redirect your users to the billing portal using the <code>redirectToBillingPortal</code> method from a controller or route:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">billingPortal</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">redirectToBillingPortal</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>By default, when the user is finished managing their subscription, they can return to the <code>home</code> route of your application. You may provide a custom URL the user should return to by passing the URL as an argument to the <code>redirectToBillingPortal</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">billingPortal</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">redirectToBillingPortal</span><span class="p">(</span>
        <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to only generate the URL to the billing portal, you may use the <code>billingPortalUrl</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">billingPortalUrl</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="payment-methods"></a></p>

<h2>Payment Methods</h2>

<p><a name="storing-payment-methods"></a></p>

<h3>Storing Payment Methods</h3>

<p>In order to create subscriptions or perform &quot;one off&quot; charges with Stripe, you will need to store a payment method and retrieve its identifier from Stripe. The approach used to accomplish differs based on whether you plan to use the payment method for subscriptions or single charges, so we will examine both below.</p>

<h4>Payment Methods For Subscriptions</h4>

<p>When storing credit cards to a customer for future use, the Stripe Setup Intents API must be used to securely gather the customer&#39;s payment method details. A &quot;Setup Intent&quot; indicates to Stripe the intention to charge a customer&#39;s payment method. Cashier&#39;s <code>Billable</code> trait includes the <code>createSetupIntent</code> to easily create a new Setup Intent. You should call this method from the route or controller that will render the form which gathers your customer&#39;s payment method details:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;update-payment-method&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;intent&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createSetupIntent</span><span class="p">()</span>
<span class="p">]);</span>
</pre></div>

<p>After you have created the Setup Intent and passed it to the view, you should attach its secret to the element that will gather the payment method. For example, consider this &quot;update payment method&quot; form:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-holder-name&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="o">&gt;</span>

<span class="c">&lt;!--</span> <span class="nx">Stripe</span> <span class="nx">Elements</span> <span class="nx">Placeholder</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-element&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>

<span class="o">&lt;</span><span class="nx">button</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-button&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">secret</span><span class="o">=</span><span class="s2">&quot;{{ $intent-&gt;client_secret }}&quot;</span><span class="o">&gt;</span>
    <span class="nx">Update</span> <span class="nx">Payment</span> <span class="nx">Method</span>
<span class="o">&lt;</span><span class="err">/button&gt;</span>
</pre></div>

<p>Next, the Stripe.js library may be used to attach a Stripe Element to the form and securely gather the customer&#39;s payment details:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://js.stripe.com/v3/&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kr">const</span> <span class="nx">stripe</span> <span class="o">=</span> <span class="nx">Stripe</span><span class="p">(</span><span class="s1">&#39;stripe-public-key&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">elements</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">cardElement</span> <span class="o">=</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;card&#39;</span><span class="p">);</span>

    <span class="nx">cardElement</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#card-element&#39;</span><span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>Next, the card can be verified and a secure &quot;payment method identifier&quot; can be retrieved from Stripe using <a href="https://stripe.com/docs/js/setup_intents/confirm_card_setup">Stripe&#39;s <code>confirmCardSetup</code> method</a>:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">cardHolderName</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;card-holder-name&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">cardButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;card-button&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">clientSecret</span> <span class="o">=</span> <span class="nx">cardButton</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">secret</span><span class="p">;</span>

<span class="nx">cardButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">setupIntent</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">confirmCardSetup</span><span class="p">(</span>
        <span class="nx">clientSecret</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">payment_method</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">card</span><span class="o">:</span> <span class="nx">cardElement</span><span class="p">,</span>
                <span class="nx">billing_details</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">cardHolderName</span><span class="p">.</span><span class="nx">value</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Display &quot;error.message&quot; to the user...</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// The card has been verified successfully...</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>After the card has been verified by Stripe, you may pass the resulting <code>setupIntent.payment_method</code> identifier to your Laravel application, where it can be attached to the customer. The payment method can either be <a href="#adding-payment-methods">added as a new payment method</a> or <a href="#updating-the-default-payment-method">used to update the default payment method</a>. You can also immediately use the payment method identifier to <a href="#creating-subscriptions">create a new subscription</a>.</p>

<blockquote>
<p>{tip} If you would like more information about Setup Intents and gathering customer payment details please <a href="https://stripe.com/docs/payments/save-and-reuse#php">review this overview provided by Stripe</a>.</p>
</blockquote>

<h4>Payment Methods For Single Charges</h4>

<p>Of course, when making a single charge against a customer&#39;s payment method we&#39;ll only need to use a payment method identifier a single time. Due to Stripe limitations, you may not use the stored default payment method of a customer for single charges. You must allow the customer to enter their payment method details using the Stripe.js library. For example, consider the following form:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-holder-name&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="o">&gt;</span>

<span class="c">&lt;!--</span> <span class="nx">Stripe</span> <span class="nx">Elements</span> <span class="nx">Placeholder</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-element&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>

<span class="o">&lt;</span><span class="nx">button</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;card-button&quot;</span><span class="o">&gt;</span>
    <span class="nx">Process</span> <span class="nx">Payment</span>
<span class="o">&lt;</span><span class="err">/button&gt;</span>
</pre></div>

<p>Next, the Stripe.js library may be used to attach a Stripe Element to the form and securely gather the customer&#39;s payment details:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://js.stripe.com/v3/&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kr">const</span> <span class="nx">stripe</span> <span class="o">=</span> <span class="nx">Stripe</span><span class="p">(</span><span class="s1">&#39;stripe-public-key&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">elements</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">cardElement</span> <span class="o">=</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;card&#39;</span><span class="p">);</span>

    <span class="nx">cardElement</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#card-element&#39;</span><span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>Next, the card can be verified and a secure &quot;payment method identifier&quot; can be retrieved from Stripe using <a href="https://stripe.com/docs/stripe-js/reference#stripe-create-payment-method">Stripe&#39;s <code>createPaymentMethod</code> method</a>:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">cardHolderName</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;card-holder-name&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">cardButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;card-button&#39;</span><span class="p">);</span>

<span class="nx">cardButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">paymentMethod</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">createPaymentMethod</span><span class="p">(</span>
        <span class="s1">&#39;card&#39;</span><span class="p">,</span> <span class="nx">cardElement</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">billing_details</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">cardHolderName</span><span class="p">.</span><span class="nx">value</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Display &quot;error.message&quot; to the user...</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// The card has been verified successfully...</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>If the card is verified successfully, you may pass the <code>paymentMethod.id</code> to your Laravel application and process a <a href="#simple-charge">single charge</a>.</p>

<p><a name="retrieving-payment-methods"></a></p>

<h3>Retrieving Payment Methods</h3>

<p>The <code>paymentMethods</code> method on the Billable model instance returns a collection of <code>Laravel\Cashier\PaymentMethod</code> instances:</p>
<div class="highlight"><pre><span></span><span class="nx">$paymentMethods</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">paymentMethods</span><span class="p">();</span>
</pre></div>

<p>To retrieve the default payment method, the <code>defaultPaymentMethod</code> method may be used:</p>
<div class="highlight"><pre><span></span><span class="nx">$paymentMethod</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">defaultPaymentMethod</span><span class="p">();</span>
</pre></div>

<p>You can also retrieve a specific payment method that is owned by the Billable model using the <code>findPaymentMethod</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$paymentMethod</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">findPaymentMethod</span><span class="p">(</span><span class="nx">$paymentMethodId</span><span class="p">);</span>
</pre></div>

<p><a name="check-for-a-payment-method"></a></p>

<h3>Determining If A User Has A Payment Method</h3>

<p>To determine if a Billable model has a default payment method attached to their account, use the <code>hasDefaultPaymentMethod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">hasDefaultPaymentMethod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if a Billable model has at least one payment method attached to their account, use the <code>hasPaymentMethod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">hasPaymentMethod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="updating-the-default-payment-method"></a></p>

<h3>Updating The Default Payment Method</h3>

<p>The <code>updateDefaultPaymentMethod</code> method may be used to update a customer&#39;s default payment method information. This method accepts a Stripe payment method identifier and will assign the new payment method as the default billing payment method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">updateDefaultPaymentMethod</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>To sync your default payment method information with the customer&#39;s default payment method information in Stripe, you may use the <code>updateDefaultPaymentMethodFromStripe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">updateDefaultPaymentMethodFromStripe</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} The default payment method on a customer can only be used for invoicing and creating new subscriptions. Due to limitations from Stripe, it may not be used for single charges.</p>
</blockquote>

<p><a name="adding-payment-methods"></a></p>

<h3>Adding Payment Methods</h3>

<p>To add a new payment method, you may call the <code>addPaymentMethod</code> method on the billable user, passing the payment method identifier:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">addPaymentMethod</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} To learn how to retrieve payment method identifiers please review the <a href="#storing-payment-methods">payment method storage documentation</a>.</p>
</blockquote>

<p><a name="deleting-payment-methods"></a></p>

<h3>Deleting Payment Methods</h3>

<p>To delete a payment method, you may call the <code>delete</code> method on the <code>Laravel\Cashier\PaymentMethod</code> instance you wish to delete:</p>
<div class="highlight"><pre><span></span><span class="nx">$paymentMethod</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p>The <code>deletePaymentMethods</code> method will delete all of the payment method information for the Billable model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">deletePaymentMethods</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} If a user has an active subscription, you should prevent them from deleting their default payment method.</p>
</blockquote>

<p><a name="subscriptions"></a></p>

<h2>Subscriptions</h2>

<p><a name="creating-subscriptions"></a></p>

<h3>Creating Subscriptions</h3>

<p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of <code>App\Models\User</code>. Once you have retrieved the model instance, you may use the <code>newSubscription</code> method to create the model&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_premium&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>The first argument passed to the <code>newSubscription</code> method should be the name of the subscription. If your application only offers a single subscription, you might call this <code>default</code> or <code>primary</code>. The second argument is the specific plan the user is subscribing to. This value should correspond to the plan&#39;s price identifier in Stripe.</p>

<p>The <code>create</code> method, which accepts <a href="#storing-payment-methods">a Stripe payment method identifier</a> or Stripe <code>PaymentMethod</code> object, will begin the subscription as well as update your database with the customer ID and other relevant billing information.</p>

<blockquote>
<p>{note} Passing a payment method identifier directly to the <code>create()</code> subscription method will also automatically add it to the user&#39;s stored payment methods.</p>
</blockquote>

<h4>Quantities</h4>

<p>If you would like to set a specific quantity for the plan when creating the subscription, you may use the <code>quantity</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">quantity</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<h4>Additional Details</h4>

<p>If you would like to specify additional customer or subscription details, you may do so by passing them as the second and third arguments to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span>
<span class="p">],</span> <span class="p">[</span>
    <span class="s1">&#39;metadata&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;note&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Some extra information.&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p>To learn more about the additional fields supported by Stripe, check out Stripe&#39;s documentation on <a href="https://stripe.com/docs/api#create_customer">customer creation</a> and <a href="https://stripe.com/docs/api/subscriptions/create">subscription creation</a>.</p>

<h4>Coupons</h4>

<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">withCoupon</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<h4>Adding Subscriptions</h4>

<p>If you would like to add a subscription to a customer who already has a default payment method set you can use the <code>add</code> method when using the <code>newSubscription</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_premium&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">();</span>
</pre></div>

<p><a name="checking-subscription-status"></a></p>

<h3>Checking Subscription Status</h3>

<p>Once a user is subscribed to your application, you may easily check their subscription status using a variety of convenient methods. First, the <code>subscribed</code> method returns <code>true</code> if the user has an active subscription, even if the subscription is currently within its trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribed</code> method also makes a great candidate for a <a href="/docs/%7B%7Bversion%7D%7D/middleware">route middleware</a>, allowing you to filter access to routes and controllers based on the user&#39;s subscription status:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// This user is not a paying customer...</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for displaying a warning to the user that they are still on their trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribedToPlan</code> method may be used to determine if the user is subscribed to a given plan based on a given Stripe Price ID. In this example, we will determine if the user&#39;s <code>default</code> subscription is actively subscribed to the <code>monthly</code> plan:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribedToPlan</span><span class="p">(</span><span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>By passing an array to the <code>subscribedToPlan</code> method, you may determine if the user&#39;s <code>default</code> subscription is actively subscribed to the <code>monthly</code> or the <code>yearly</code> plan:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribedToPlan</span><span class="p">([</span><span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;price_yearly&#39;</span><span class="p">],</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>recurring</code> method may be used to determine if the user is currently subscribed and is no longer within their trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">recurring</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Cancelled Subscription Status</h4>

<p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if the user has cancelled their subscription and is no longer within their &quot;grace period&quot;, you may use the <code>ended</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ended</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Subscription Scopes</h4>

<p>Most subscription states are also available as query scopes so that you may easily query your database for subscriptions that are in a given state:</p>
<div class="highlight"><pre><span></span><span class="c1">// Get all active subscriptions...</span>
<span class="nx">$subscriptions</span> <span class="o">=</span> <span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Get all of the cancelled subscriptions for a user...</span>
<span class="nx">$subscriptions</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscriptions</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>A complete list of available scopes is available below:</p>
<div class="highlight"><pre><span></span><span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">ended</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">incomplete</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notCancelled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notOnGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notOnTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pastDue</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">recurring</span><span class="p">();</span>
</pre></div>

<p><a name="incomplete-and-past-due-status"></a></p>

<h4>Incomplete and Past Due Status</h4>

<p>If a subscription requires a secondary payment action after creation the subscription will be marked as <code>incomplete</code>. Subscription statuses are stored in the <code>stripe_status</code> column of Cashier&#39;s <code>subscriptions</code> database table.</p>

<p>Similarly, if a secondary payment action is required when swapping plans the subscription will be marked as <code>past_due</code>. When your subscription is in either of these states it will not be active until the customer has confirmed their payment. Checking if a subscription has an incomplete payment can be done using the <code>hasIncompletePayment</code> method on the Billable model or a subscription instance:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">hasIncompletePayment</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">hasIncompletePayment</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>When a subscription has an incomplete payment, you should direct the user to Cashier&#39;s payment confirmation page, passing the <code>latestPayment</code> identifier. You may use the <code>latestPayment</code> method available on subscription instance to retrieve this identifier:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ route(&#39;cashier.payment&#39;, $subscription-&gt;latestPayment()-&gt;id) }}&quot;</span><span class="o">&gt;</span>
    <span class="nx">Please</span> <span class="nx">confirm</span> <span class="nx">your</span> <span class="nx">payment</span><span class="p">.</span>
<span class="o">&lt;</span><span class="err">/a&gt;</span>
</pre></div>

<p>If you would like the subscription to still be considered active when it&#39;s in a <code>past_due</code> state, you may use the <code>keepPastDueSubscriptionsActive</code> method provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Cashier</span><span class="o">::</span><span class="nx">keepPastDueSubscriptionsActive</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} When a subscription is in an <code>incomplete</code> state it cannot be changed until the payment is confirmed. Therefore, the <code>swap</code> and <code>updateQuantity</code> methods will throw an exception when the subscription is in an <code>incomplete</code> state.</p>
</blockquote>

<p><a name="changing-plans"></a></p>

<h3>Changing Plans</h3>

<p>After a user is subscribed to your application, they may occasionally want to change to a new subscription plan. To swap a user to a new subscription, pass the plan&#39;s price identifier to the <code>swap</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="s1">&#39;provider-price-id&#39;</span><span class="p">);</span>
</pre></div>

<p>If the user is on trial, the trial period will be maintained. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p>

<p>If you would like to swap plans and cancel any trial period the user is currently on, you may use the <code>skipTrial</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">skipTrial</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="s1">&#39;provider-price-id&#39;</span><span class="p">);</span>
</pre></div>

<p>If you would like to swap plans and immediately invoice the user instead of waiting for their next billing cycle, you may use the <code>swapAndInvoice</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swapAndInvoice</span><span class="p">(</span><span class="s1">&#39;provider-price-id&#39;</span><span class="p">);</span>
</pre></div>

<h4>Prorations</h4>

<p>By default, Stripe prorates charges when swapping between plans. The <code>noProrate</code> method may be used to update the subscription&#39;s without prorating the charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="s1">&#39;provider-price-id&#39;</span><span class="p">);</span>
</pre></div>

<p>For more information on subscription proration, consult the <a href="https://stripe.com/docs/billing/subscriptions/prorations">Stripe documentation</a>.</p>

<blockquote>
<p>{note} Executing the <code>noProrate</code> method before the <code>swapAndInvoice</code> method will have no affect on proration. An invoice will always be issued.</p>
</blockquote>

<p><a name="subscription-quantity"></a></p>

<h3>Subscription Quantity</h3>

<p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge $10 per month <strong>per user</strong> on an account. To easily increment or decrement your subscription quantity, use the <code>incrementQuantity</code> and <code>decrementQuantity</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">incrementQuantity</span><span class="p">();</span>

<span class="c1">// Add five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">incrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrementQuantity</span><span class="p">();</span>

<span class="c1">// Subtract five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may set a specific quantity using the <code>updateQuantity</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>The <code>noProrate</code> method may be used to update the subscription&#39;s quantity without prorating the charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>For more information on subscription quantities, consult the <a href="https://stripe.com/docs/subscriptions/quantities">Stripe documentation</a>.</p>

<blockquote>
<p>{note} Please note that when working with multiplan subscriptions, an extra &quot;plan&quot; parameter is required for the above quantity methods.</p>
</blockquote>

<p><a name="multiplan-subscriptions"></a></p>

<h3>Multiplan Subscriptions</h3>

<p><a href="https://stripe.com/docs/billing/subscriptions/multiplan">Multiplan subscriptions</a> allow you to assign multiple billing plans to a single subscription. For example, imagine you are building a customer service &quot;helpdesk&quot; application that has a base subscription of $10 per month, but offers a live chat add-on plan for an additional $15 per month:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span>
    <span class="s1">&#39;chat-plan&#39;</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>Now the customer will have two plans on their <code>default</code> subscription. Both plans will be charged for on their respective billing intervals. You can also use the <code>quantity</code> method to indicate the specific quantity for each plan:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">quantity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>Or, you may dynamically add the extra plan and its quantity using the <code>plan</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">plan</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may add a new plan to an existing subscription at a later time:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">addPlan</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<p>The example above will add the new plan and the customer will be billed for it on their next billing cycle. If you would like to bill the customer immediately you may use the <code>addPlanAndInvoice</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">addPlanAndInvoice</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<p>If you would like to add a plan with a specific quantity, you can pass the quantity as the second parameter of the <code>addPlan</code> or <code>addPlanAndInvoice</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">addPlan</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may remove plans from subscriptions using the <code>removePlan</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">removePlan</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} You may not remove the last plan on a subscription. Instead, you should simply cancel the subscription.</p>
</blockquote>

<h3>Swapping</h3>

<p>You may also change the plans attached to a multiplan subscription. For example, imagine you&#39;re on a <code>basic-plan</code> subscription with a <code>chat-plan</code> add-on and you want to upgrade to the <code>pro-plan</code> plan:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">([</span><span class="s1">&#39;pro-plan&#39;</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">]);</span>
</pre></div>

<p>When executing the code above, the underlying subscription item with the <code>basic-plan</code> is deleted and the one with the <code>chat-plan</code> is preserved. Additionally, a new subscription item for the new <code>pro-plan</code> is created.</p>

<p>You can also specify subscription item options. For example, you may need to specify the subscription plan quantities:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">([</span>
    <span class="s1">&#39;pro-plan&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;quantity&#39;</span> <span class="p">=&gt;</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;chat-plan&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>If you want to swap a single plan on a subscription, you may do so using the <code>swap</code> method on the subscription item itself. This approach is useful if you, for example, want to preserve all of the existing metadata on the subscription item.</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">findItemOrFail</span><span class="p">(</span><span class="s1">&#39;basic-plan&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="s1">&#39;pro-plan&#39;</span><span class="p">);</span>
</pre></div>

<h4>Proration</h4>

<p>By default, Stripe will prorate charges when adding or removing plans from a subscription. If you would like to make a plan adjustment without proration, you should chain the <code>noProrate</code> method onto your plan operation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">removePlan</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<h4>Quantities</h4>

<p>If you would like to update quantities on individual subscription plans, you may do so using the <a href="#subscription-quantity">existing quantity methods</a> and passing the name of the plan as an additional argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">incrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrementQuantity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} When you have multiple plans set on a subscription the <code>stripe_plan</code> and <code>quantity</code> attributes on the <code>Subscription</code> model will be <code>null</code>. To access the individual plans, you should use the <code>items</code> relationship available on the <code>Subscription</code> model.</p>
</blockquote>

<h4>Subscription Items</h4>

<p>When a subscription has multiple plans, it will have multiple subscription &quot;items&quot; stored in your database&#39;s <code>subscription_items</code> table. You may access these via the <code>items</code> relationship on the subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$subscriptionItem</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">items</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="c1">// Retrieve the Stripe plan and quantity for a specific item...</span>
<span class="nx">$stripePlan</span> <span class="o">=</span> <span class="nx">$subscriptionItem</span><span class="o">-&gt;</span><span class="nx">stripe_plan</span><span class="p">;</span>
<span class="nx">$quantity</span> <span class="o">=</span> <span class="nx">$subscriptionItem</span><span class="o">-&gt;</span><span class="nx">quantity</span><span class="p">;</span>
</pre></div>

<p>You can also retrieve a specific plan using the <code>findItemOrFail</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$subscriptionItem</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">findItemOrFail</span><span class="p">(</span><span class="s1">&#39;chat-plan&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="subscription-taxes"></a></p>

<h3>Subscription Taxes</h3>

<p>To specify the tax rates a user pays on a subscription, implement the <code>taxRates</code> method on your billable model, and return an array with the Tax Rate IDs. You can define these tax rates in <a href="https://dashboard.stripe.com/test/tax-rates">your Stripe dashboard</a>:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">taxRates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;tax-rate-id&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>The <code>taxRates</code> method enables you to apply a tax rate on a model-by-model basis, which may be helpful for a user base that spans multiple countries and tax rates. If you&#39;re working with multiplan subscriptions you can define different tax rates for each plan by implementing a <code>planTaxRates</code> method on your billable model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">planTaxRates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;plan-id&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tax-rate-id&#39;</span><span class="p">],</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} The <code>taxRates</code> method only applies to subscription charges. If you use Cashier to make &quot;one off&quot; charges, you will need to manually specify the tax rate at that time.</p>
</blockquote>

<h4>Syncing Tax Rates</h4>

<p>When changing the hard-coded Tax Rate IDs returned by the <code>taxRates</code> method, the tax settings on any existing subscriptions for the user will remain the same. If you wish to update the tax value for existing subscriptions with the returned <code>taxTaxRates</code> values, you should call the <code>syncTaxRates</code> method on the user&#39;s subscription instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">syncTaxRates</span><span class="p">();</span>
</pre></div>

<p>This will also sync any subscription item tax rates so make sure you also properly change the <code>planTaxRates</code> method.</p>

<h4>Tax Exemption</h4>

<p>Cashier also offers methods to determine if the customer is tax exempt by calling the Stripe API. The <code>isNotTaxExempt</code>, <code>isTaxExempt</code>, and <code>reverseChargeApplies</code> methods are available on the billable model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isTaxExempt</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isNotTaxExempt</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">reverseChargeApplies</span><span class="p">();</span>
</pre></div>

<p>These methods are also available on any <code>Laravel\Cashier\Invoice</code> object. However, when calling these methods on an <code>Invoice</code> object the methods will determine the exemption status at the time the invoice was created.</p>

<p><a name="subscription-anchor-date"></a></p>

<h3>Subscription Anchor Date</h3>

<p>By default, the billing cycle anchor is the date the subscription was created, or if a trial period is used, the date that the trial ends. If you would like to modify the billing anchor date, you may use the <code>anchorBillingCycleOn</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Carbon</span><span class="err">\</span><span class="nx">Carbon</span><span class="p">;</span>

<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$anchor</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;first day of next month&#39;</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_premium&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">anchorBillingCycleOn</span><span class="p">(</span><span class="nx">$anchor</span><span class="o">-&gt;</span><span class="nx">startOfDay</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>For more information on managing subscription billing cycles, consult the <a href="https://stripe.com/docs/billing/subscriptions/billing-cycle">Stripe billing cycle documentation</a></p>

<p><a name="cancelling-subscriptions"></a></p>

<h3>Cancelling Subscriptions</h3>

<p>To cancel a subscription, call the <code>cancel</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
</pre></div>

<p>When a subscription is cancelled, Cashier will automatically set the <code>ends_at</code> column in your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p>

<p>You may determine if a user has cancelled their subscription but are still on their &quot;grace period&quot; using the <code>onGracePeriod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you wish to cancel a subscription immediately, call the <code>cancelNow</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancelNow</span><span class="p">();</span>
</pre></div>

<p><a name="resuming-subscriptions"></a></p>

<h3>Resuming Subscriptions</h3>

<p>If a user has cancelled their subscription and you wish to resume it, use the <code>resume</code> method. The user <strong>must</strong> still be on their grace period in order to resume a subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">resume</span><span class="p">();</span>
</pre></div>

<p>If the user cancels a subscription and then resumes that subscription before the subscription has fully expired, they will not be billed immediately. Instead, their subscription will be re-activated, and they will be billed on the original billing cycle.</p>

<p><a name="subscription-trials"></a></p>

<h2>Subscription Trials</h2>

<p><a name="with-payment-method-up-front"></a></p>

<h3>With Payment Method Up Front</h3>

<p>If you would like to offer trial periods to your customers while still collecting payment method information up front, you should use the <code>trialDays</code> method when creating your subscriptions:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">trialDays</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>This method will set the trial period ending date on the subscription record within the database, as well as instruct Stripe to not begin billing the customer until after this date. When using the <code>trialDays</code> method, Cashier will overwrite any default trial period configured for the plan in Stripe.</p>

<blockquote>
<p>{note} If the customer&#39;s subscription is not cancelled before the trial ending date they will be charged as soon as the trial expires, so you should be sure to notify your users of their trial ending date.</p>
</blockquote>

<p>The <code>trialUntil</code> method allows you to provide a <code>DateTime</code> instance to specify when the trial period should end:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Carbon</span><span class="err">\</span><span class="nx">Carbon</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">trialUntil</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>You may determine if the user is within their trial period using either the <code>onTrial</code> method of the user instance, or the <code>onTrial</code> method of the subscription instance. The two examples below are identical:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Defining Trial Days In Stripe / Cashier</h4>

<p>You may choose to define how many trial days your plan&#39;s receive in the Stripe dashboard or always pass them explicitly using Cashier. If you choose to define your plan&#39;s trial days in Stripe you should be aware that new subscriptions, including new subscriptions for a customer that had a subscription in the past, will always receive a trial period unless you explicitly call the <code>trialDays(0)</code> method.</p>

<p><a name="without-payment-method-up-front"></a></p>

<h3>Without Payment Method Up Front</h3>

<p>If you would like to offer trial periods without collecting the user&#39;s payment method information up front, you may set the <code>trial_ends_at</code> column on the user record to your desired trial ending date. This is typically done during user registration:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span>
    <span class="c1">// Populate other user properties...</span>
    <span class="s1">&#39;trial_ends_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="p">]);</span>
</pre></div>

<blockquote>
<p>{note} Be sure to add a <a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators#date-mutators">date mutator</a> for <code>trial_ends_at</code> to your model definition.</p>
</blockquote>

<p>Cashier refers to this type of trial as a &quot;generic trial&quot;, since it is not attached to any existing subscription. The <code>onTrial</code> method on the <code>User</code> instance will return <code>true</code> if the current date is not past the value of <code>trial_ends_at</code>:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// User is within their trial period...</span>
<span class="p">}</span>
</pre></div>

<p>You may also use the <code>onGenericTrial</code> method if you wish to know specifically that the user is within their &quot;generic&quot; trial period and has not created an actual subscription yet:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGenericTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// User is within their &quot;generic&quot; trial period...</span>
<span class="p">}</span>
</pre></div>

<p>Once you are ready to create an actual subscription for the user, you may use the <code>newSubscription</code> method as usual:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;price_monthly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p><a name="extending-trials"></a></p>

<h3>Extending Trials</h3>

<p>The <code>extendTrial</code> method allows you to extend the trial period of a subscription after it&#39;s been created:</p>
<div class="highlight"><pre><span></span><span class="c1">// End the trial 7 days from now...</span>
<span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">extendTrial</span><span class="p">(</span>
    <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Add an additional 5 days to the trial...</span>
<span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">extendTrial</span><span class="p">(</span>
    <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">trial_ends_at</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<p>If the trial has already expired and the customer is already being billed for the subscription, you can still offer them an extended trial. The time spent within the trial period will be deducted from the customer&#39;s next invoice.</p>

<p><a name="handling-stripe-webhooks"></a></p>

<h2>Handling Stripe Webhooks</h2>

<blockquote>
<p>{tip} You may use <a href="https://stripe.com/docs/stripe-cli">the Stripe CLI</a> to help test webhooks during local development.</p>
</blockquote>

<p>Stripe can notify your application of a variety of events via webhooks. By default, a route that points to Cashier&#39;s webhook controller is configured through the Cashier service provider. This controller will handle all incoming webhook requests.</p>

<p>By default, this controller will automatically handle cancelling subscriptions that have too many failed charges (as defined by your Stripe settings), customer updates, customer deletions, subscription updates, and payment method changes; however, as we&#39;ll soon discover, you can extend this controller to handle any webhook event you like.</p>

<p>To ensure your application can handle Stripe webhooks, be sure to configure the webhook URL in the Stripe control panel. By default, Cashier&#39;s webhook controller listens to the <code>/stripe/webhook</code> URL path. The full list of all webhooks you should configure in the Stripe control panel are:</p>

<ul>
<li><code>customer.subscription.updated</code></li>
<li><code>customer.subscription.deleted</code></li>
<li><code>customer.updated</code></li>
<li><code>customer.deleted</code></li>
<li><code>invoice.payment_action_required</code></li>
</ul>

<blockquote>
<p>{note} Make sure you protect incoming requests with Cashier&#39;s included <a href="/docs/%7B%7Bversion%7D%7D/billing#verifying-webhook-signatures">webhook signature verification</a> middleware.</p>
</blockquote>

<h4>Webhooks &amp; CSRF Protection</h4>

<p>Since Stripe webhooks need to bypass Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/csrf">CSRF protection</a>, be sure to list the URI as an exception in your <code>VerifyCsrfToken</code> middleware or list the route outside of the <code>web</code> middleware group:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$except</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;stripe/*&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="defining-webhook-event-handlers"></a></p>

<h3>Defining Webhook Event Handlers</h3>

<p>Cashier automatically handles subscription cancellation on failed charges, but if you have additional webhook events you would like to handle, extend the Webhook controller. Your method names should correspond to Cashier&#39;s expected convention, specifically, methods should be prefixed with <code>handle</code> and the &quot;camel case&quot; name of the webhook you wish to handle. For example, if you wish to handle the <code>invoice.payment_succeeded</code> webhook, you should add a <code>handleInvoicePaymentSucceeded</code> method to the controller:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Cashier\Http\Controllers\WebhookController</span> <span class="k">as</span> <span class="nx">CashierController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WebhookController</span> <span class="k">extends</span> <span class="nx">CashierController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle invoice payment succeeded.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $payload</span>
<span class="sd">     * @return \Symfony\Component\HttpFoundation\Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleInvoicePaymentSucceeded</span><span class="p">(</span><span class="nv">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle The Event</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Next, define a route to your Cashier controller within your <code>routes/web.php</code> file. This will overwrite the default shipped route:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">WebhookController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span>
    <span class="s1">&#39;stripe/webhook&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">WebhookController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;handleWebhook&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p>Cashier emits a <code>Laravel\Cashier\Events\WebhookReceived</code> event when a webhook is received, and a <code>Laravel\Cashier\Events\WebhookHandled</code> event when a webhook was handled by Cashier. Both events contain the full payload of the Stripe webhook.</p>

<p><a name="handling-failed-subscriptions"></a></p>

<h3>Failed Subscriptions</h3>

<p>What if a customer&#39;s credit card expires? No worries - Cashier&#39;s Webhook controller will cancel the customer&#39;s subscription for you. Failed payments will automatically be captured and handled by the controller. The controller will cancel the customer&#39;s subscription when Stripe determines the subscription has failed (normally after three failed payment attempts).</p>

<p><a name="verifying-webhook-signatures"></a></p>

<h3>Verifying Webhook Signatures</h3>

<p>To secure your webhooks, you may use <a href="https://stripe.com/docs/webhooks/signatures">Stripe&#39;s webhook signatures</a>. For convenience, Cashier automatically includes a middleware which validates that the incoming Stripe webhook request is valid.</p>

<p>To enable webhook verification, ensure that the <code>STRIPE_WEBHOOK_SECRET</code> environment variable is set in your <code>.env</code> file. The webhook <code>secret</code> may be retrieved from your Stripe account dashboard.</p>

<p><a name="single-charges"></a></p>

<h2>Single Charges</h2>

<p><a name="simple-charge"></a></p>

<h3>Simple Charge</h3>

<blockquote>
<p>{note} The <code>charge</code> method accepts the amount you would like to charge in the <strong>lowest denominator of the currency used by your application</strong>.</p>
</blockquote>

<p>If you would like to make a &quot;one off&quot; charge against a subscribed customer&#39;s payment method, you may use the <code>charge</code> method on a billable model instance. You&#39;ll need to <a href="#storing-payment-methods">provide a payment method identifier</a> as the second argument:</p>
<div class="highlight"><pre><span></span><span class="c1">// Stripe Accepts Charges In Cents...</span>
<span class="nx">$stripeCharge</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>The <code>charge</code> method accepts an array as its third argument, allowing you to pass any options you wish to the underlying Stripe charge creation. Consult the Stripe documentation regarding the options available to you when creating charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">$paymentMethod</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;custom_option&#39;</span> <span class="p">=&gt;</span> <span class="nx">$value</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>You may also use the <code>charge</code> method without an underlying customer or user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$stripeCharge</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">User</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">$paymentMethod</span><span class="p">);</span>
</pre></div>

<p>The <code>charge</code> method will throw an exception if the charge fails. If the charge is successful, an instance of <code>Laravel\Cashier\Payment</code> will be returned from the method:</p>
<div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
    <span class="nx">$payment</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">$paymentMethod</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="charge-with-invoice"></a></p>

<h3>Charge With Invoice</h3>

<p>Sometimes you may need to make a one-time charge but also generate an invoice for the charge so that you may offer a PDF receipt to your customer. The <code>invoiceFor</code> method lets you do just that. For example, let&#39;s invoice the customer $5.00 for a &quot;One Time Fee&quot;:</p>
<div class="highlight"><pre><span></span><span class="c1">// Stripe Accepts Charges In Cents...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoiceFor</span><span class="p">(</span><span class="s1">&#39;One Time Fee&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
</pre></div>

<p>The invoice will be charged immediately against the user&#39;s default payment method. The <code>invoiceFor</code> method also accepts an array as its third argument. This array contains the billing options for the invoice item. The fourth argument accepted by the method is also an array. This final argument accepts the billing options for the invoice itself:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoiceFor</span><span class="p">(</span><span class="s1">&#39;Stickers&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;quantity&#39;</span> <span class="p">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">],</span> <span class="p">[</span>
    <span class="s1">&#39;default_tax_rates&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tax-rate-id&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<blockquote>
<p>{note} The <code>invoiceFor</code> method will create a Stripe invoice which will retry failed billing attempts. If you do not want invoices to retry failed charges, you will need to close them using the Stripe API after the first failed charge.</p>
</blockquote>

<p><a name="refunding-charges"></a></p>

<h3>Refunding Charges</h3>

<p>If you need to refund a Stripe charge, you may use the <code>refund</code> method. This method accepts the Stripe Payment Intent ID as its first argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$payment</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">$paymentMethod</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">refund</span><span class="p">(</span><span class="nx">$payment</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>
</pre></div>

<p><a name="invoices"></a></p>

<h2>Invoices</h2>

<p><a name="retrieving-invoices"></a></p>

<h3>Retrieving Invoices</h3>

<p>You may easily retrieve an array of a billable model&#39;s invoices using the <code>invoices</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoices</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoices</span><span class="p">();</span>

<span class="c1">// Include pending invoices in the results...</span>
<span class="nx">$invoices</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">invoicesIncludingPending</span><span class="p">();</span>
</pre></div>

<p>You may use the <code>findInvoice</code> method to retrieve a specific invoice:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoice</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">findInvoice</span><span class="p">(</span><span class="nx">$invoiceId</span><span class="p">);</span>
</pre></div>

<h4>Displaying Invoice Information</h4>

<p>When listing the invoices for the customer, you may use the invoice&#39;s helper methods to display the relevant invoice information. For example, you may wish to list every invoice in a table, allowing the user to easily download any of them:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$invoices</span> <span class="nx">as</span> <span class="nx">$invoice</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">date</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">toFormattedDateString</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">total</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/user/invoice/{{ $invoice-&gt;id }}&quot;</span><span class="o">&gt;</span><span class="nx">Download</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/td&gt;</span>
        <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>
</pre></div>

<p><a name="generating-invoice-pdfs"></a></p>

<h3>Generating Invoice PDFs</h3>

<p>From within a route or controller, use the <code>downloadInvoice</code> method to generate a PDF download of the invoice. This method will automatically generate the proper HTTP response to send the download to the browser:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/invoice/{invoice}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">,</span> <span class="nx">$invoiceId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">downloadInvoice</span><span class="p">(</span><span class="nx">$invoiceId</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;vendor&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Company&#39;</span><span class="p">,</span>
        <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Product&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>The <code>downloadInvoice</code> method also allows for an optional custom filename as the third parameter. This filename will automatically be suffixed with <code>.pdf</code> for you:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">downloadInvoice</span><span class="p">(</span><span class="nx">$invoiceId</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;vendor&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Company&#39;</span><span class="p">,</span>
    <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Your Product&#39;</span><span class="p">,</span>
<span class="p">],</span> <span class="s1">&#39;my-invoice&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="handling-failed-payments"></a></p>

<h2>Handling Failed Payments</h2>

<p>Sometimes, payments for subscriptions or single charges can fail. When this happens, Cashier will throw an <code>IncompletePayment</code> exception that informs you that this happened. After catching this exception, you have two options on how to proceed.</p>

<p>First, you could redirect your customer to the dedicated payment confirmation page which is included with Cashier. This page already has an associated route that is registered via Cashier&#39;s service provider. So, you may catch the <code>IncompletePayment</code> exception and redirect to the payment confirmation page:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Exceptions</span><span class="err">\</span><span class="nx">IncompletePayment</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">$subscription</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$planId</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="nx">$paymentMethod</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">IncompletePayment</span> <span class="nx">$exception</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span>
        <span class="s1">&#39;cashier.payment&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="nx">$exception</span><span class="o">-&gt;</span><span class="nx">payment</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;redirect&#39;</span> <span class="p">=&gt;</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>On the payment confirmation page, the customer will be prompted to enter their credit card info again and perform any additional actions required by Stripe, such as &quot;3D Secure&quot; confirmation. After confirming their payment, the user will be redirected to the URL provided by the <code>redirect</code> parameter specified above. Upon redirection, <code>message</code> (string) and <code>success</code> (integer) query string variables will be added to the URL.</p>

<p>Alternatively, you could allow Stripe to handle the payment confirmation for you. In this case, instead of redirecting to the payment confirmation page, you may <a href="https://dashboard.stripe.com/account/billing/automatic">setup Stripe&#39;s automatic billing emails</a> in your Stripe dashboard. However, if a <code>IncompletePayment</code> exception is caught, you should still inform the user they will receive an email with further payment confirmation instructions.</p>

<p>Payment exceptions may be thrown for the following methods: <code>charge</code>, <code>invoiceFor</code>, and <code>invoice</code> on the <code>Billable</code> user. When handling subscriptions, the <code>create</code> method on the <code>SubscriptionBuilder</code>, and the <code>incrementAndInvoice</code> and <code>swapAndInvoice</code> methods on the <code>Subscription</code> model may throw exceptions.</p>

<p>There are currently two types of payment exceptions which extend <code>IncompletePayment</code>. You can catch these separately if needed so that you can customize the user experience:</p>

<div class="content-list" markdown="1">
- `PaymentActionRequired`: this indicates that Stripe requires extra verification in order to confirm and process a payment.
- `PaymentFailure`: this indicates that a payment failed for various other reasons, such as being out of available funds.
</div>

<p><a name="strong-customer-authentication"></a></p>

<h2>Strong Customer Authentication</h2>

<p>If your business is based in Europe you will need to abide by the Strong Customer Authentication (SCA) regulations. These regulations were imposedin September 2019 by the European Union to prevent payment fraud. Luckily, Stripe and Cashier are prepared for building SCA compliant applications.</p>

<blockquote>
<p>{note} Before getting started, review <a href="https://stripe.com/guides/strong-customer-authentication">Stripe&#39;s guide on PSD2 and SCA</a> as well as their <a href="https://stripe.com/docs/strong-customer-authentication">documentation on the new SCA APIs</a>.</p>
</blockquote>

<p><a name="payments-requiring-additional-confirmation"></a></p>

<h3>Payments Requiring Additional Confirmation</h3>

<p>SCA regulations often require extra verification in order to confirm and process a payment. When this happens, Cashier will throw a <code>PaymentActionRequired</code> exception that informs you that this extra verification is needed. More info on how to handle these exceptions be found <a href="#handling-failed-payments">here</a>.</p>

<h4>Incomplete and Past Due State</h4>

<p>When a payment needs additional confirmation, the subscription will remain in an <code>incomplete</code> or <code>past_due</code> state as indicated by its <code>stripe_status</code> database column. Cashier will automatically activate the customer&#39;s subscription via a webhook as soon as payment confirmation is complete.</p>

<p>For more information on <code>incomplete</code> and <code>past_due</code> states, please refer to <a href="#incomplete-and-past-due-status">our additional documentation</a>.</p>

<p><a name="off-session-payment-notifications"></a></p>

<h3>Off-Session Payment Notifications</h3>

<p>Since SCA regulations require customers to occasionally verify their payment details even while their subscription is active, Cashier can send a payment notification to the customer when off-session payment confirmation is required. For example, this may occur when a subscription is renewing. Cashier&#39;s payment notification can be enabled by setting the <code>CASHIER_PAYMENT_NOTIFICATION</code> environment variable to a notification class. By default, this notification is disabled. Of course, Cashier includes a notification class you may use for this purpose, but you are free to provide your own notification class if desired:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_PAYMENT_NOTIFICATION</span><span class="o">=</span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Cashier</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">ConfirmPayment</span>
</pre></div>

<p>To ensure that off-session payment confirmation notifications are delivered, verify that <a href="#handling-stripe-webhooks">Stripe webhooks are configured</a> for your application and the <code>invoice.payment_action_required</code> webhook is enabled in your Stripe dashboard. In addition, your <code>Billable</code> model should also use Laravel&#39;s <code>Illuminate\Notifications\Notifiable</code> trait.</p>

<blockquote>
<p>{note} Notifications will be sent even when customers are manually making a payment that requires additional confirmation. Unfortunately, there is no way for Stripe to know that the payment was done manually or &quot;off-session&quot;. But, a customer will simply see a &quot;Payment Successful&quot; message if they visit the payment page after already confirming their payment. The customer will not be allowed to accidentally confirm the same payment twice and incur an accidental second charge.</p>
</blockquote>

<p><a name="stripe-sdk"></a></p>

<h2>Stripe SDK</h2>

<p>Many of Cashier&#39;s objects are wrappers around Stripe SDK objects. If you would like to interact with the Stripe objects directly, you may conveniently retrieve them using the <code>asStripe</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$stripeSubscription</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">asStripeSubscription</span><span class="p">();</span>

<span class="nx">$stripeSubscription</span><span class="o">-&gt;</span><span class="nx">application_fee_percent</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="nx">$stripeSubscription</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>updateStripeSubscription</code> method to update the Stripe subscription directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">updateStripeSubscription</span><span class="p">([</span><span class="s1">&#39;application_fee_percent&#39;</span> <span class="p">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>
</pre></div>

<p><a name="testing"></a></p>

<h2>Testing</h2>

<p>When testing an application that uses Cashier, you may mock the actual HTTP requests to the Stripe API; however, this requires you to partially re-implement Cashier&#39;s own behavior. Therefore, we recommend allowing your tests to hit the actual Stripe API. While this is slower, it provides more confidence that your application is working as expected and any slow tests may be placed within their own PHPUnit testing group.</p>

<p>When testing, remember that that Cashier itself already has a great test suite, so you should only focus on testing the subscription and payment flow of your own application and not every underlying Cashier behavior.</p>

<p>To get started, add the <strong>testing</strong> version of your Stripe secret to your <code>phpunit.xml</code> file:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">env</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;STRIPE_SECRET&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;sk_test_&lt;your-key&gt;&quot;</span><span class="o">/&gt;</span>
</pre></div>

<p>Now, whenever you interact with Cashier while testing, it will send actual API requests to your Stripe testing environment. For convenience, you should pre-fill your Stripe testing account with subscriptions / plans that you may then use during testing.</p>

<blockquote>
<p>{tip} In order to test a variety of billing scenarios, such as credit card denials and failures, you may use the vast range of <a href="https://stripe.com/docs/testing">testing card numbers and tokens</a> provided by Stripe.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Blade Templates</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#template-inheritance">Template Inheritance</a>

<ul>
<li><a href="#defining-a-layout">Defining A Layout</a></li>
<li><a href="#extending-a-layout">Extending A Layout</a></li>
</ul></li>
<li><a href="#displaying-data">Displaying Data</a>

<ul>
<li><a href="#blade-and-javascript-frameworks">Blade &amp; JavaScript Frameworks</a></li>
</ul></li>
<li><a href="#control-structures">Control Structures</a>

<ul>
<li><a href="#if-statements">If Statements</a></li>
<li><a href="#switch-statements">Switch Statements</a></li>
<li><a href="#loops">Loops</a></li>
<li><a href="#the-loop-variable">The Loop Variable</a></li>
<li><a href="#comments">Comments</a></li>
<li><a href="#php">PHP</a></li>
<li><a href="#the-once-directive">The <code>@once</code> Directive</a></li>
</ul></li>
<li><a href="#forms">Forms</a>

<ul>
<li><a href="#csrf-field">CSRF Field</a></li>
<li><a href="#method-field">Method Field</a></li>
<li><a href="#validation-errors">Validation Errors</a></li>
</ul></li>
<li><a href="#components">Components</a>

<ul>
<li><a href="#displaying-components">Displaying Components</a></li>
<li><a href="#passing-data-to-components">Passing Data To Components</a></li>
<li><a href="#managing-attributes">Managing Attributes</a></li>
<li><a href="#slots">Slots</a></li>
<li><a href="#inline-component-views">Inline Component Views</a></li>
<li><a href="#anonymous-components">Anonymous Components</a></li>
<li><a href="#dynamic-components">Dynamic Components</a></li>
</ul></li>
<li><a href="#including-subviews">Including Subviews</a>

<ul>
<li><a href="#rendering-views-for-collections">Rendering Views For Collections</a></li>
</ul></li>
<li><a href="#stacks">Stacks</a></li>
<li><a href="#service-injection">Service Injection</a></li>
<li><a href="#extending-blade">Extending Blade</a>

<ul>
<li><a href="#custom-if-statements">Custom If Statements</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Blade is the simple, yet powerful templating engine provided with Laravel. Unlike other popular PHP templating engines, Blade does not restrict you from using plain PHP code in your views. In fact, all Blade views are compiled into plain PHP code and cached until they are modified, meaning Blade adds essentially zero overhead to your application. Blade view files use the <code>.blade.php</code> file extension and are typically stored in the <code>resources/views</code> directory.</p>

<p><a name="template-inheritance"></a></p>

<h2>Template Inheritance</h2>

<p><a name="defining-a-layout"></a></p>

<h3>Defining A Layout</h3>

<p>Two of the primary benefits of using Blade are <em>template inheritance</em> and <em>sections</em>. To get started, let&#39;s take a look at a simple example. First, we will examine a &quot;master&quot; page layout. Since most web applications maintain the same general layout across various pages, it&#39;s convenient to define this layout as a single Blade view:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">layouts</span><span class="o">/</span><span class="nx">app</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">App</span> <span class="nx">Name</span> <span class="o">-</span> <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
            <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span>
        <span class="err">@</span><span class="nx">show</span>

        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>As you can see, this file contains typical HTML mark-up. However, take note of the <code>@section</code> and <code>@yield</code> directives. The <code>@section</code> directive, as the name implies, defines a section of content, while the <code>@yield</code> directive is used to display the contents of a given section.</p>

<p>Now that we have defined a layout for our application, let&#39;s define a child page that inherits the layout.</p>

<p><a name="extending-a-layout"></a></p>

<h3>Extending A Layout</h3>

<p>When defining a child view, use the Blade <code>@extends</code> directive to specify which layout the child view should &quot;inherit&quot;. Views which extend a Blade layout may inject content into the layout&#39;s sections using <code>@section</code> directives. Remember, as seen in the example above, the contents of these sections will be displayed in the layout using <code>@yield</code>:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">Stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">child</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Page Title&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;sidebar&#39;</span><span class="p">)</span>
    <span class="err">@@</span><span class="nx">parent</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">appended</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">master</span> <span class="nx">sidebar</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">my</span> <span class="nx">body</span> <span class="nx">content</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<p>In this example, the <code>sidebar</code> section is utilizing the <code>@@parent</code> directive to append (rather than overwriting) content to the layout&#39;s sidebar. The <code>@@parent</code> directive will be replaced by the content of the layout when the view is rendered.</p>

<blockquote>
<p>{tip} Contrary to the previous example, this <code>sidebar</code> section ends with <code>@endsection</code> instead of <code>@show</code>. The <code>@endsection</code> directive will only define a section while <code>@show</code> will define and <strong>immediately yield</strong> the section.</p>
</blockquote>

<p>The <code>@yield</code> directive also accepts a default value as its second parameter. This value will be rendered if the section being yielded is undefined:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">))</span>
</pre></div>

<p>Blade views may be returned from routes using the global <code>view</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;blade&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="displaying-data"></a></p>

<h2>Displaying Data</h2>

<p>You may display data passed to your Blade views by wrapping the variable in curly braces. For example, given the following route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samantha&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>You may display the contents of the <code>name</code> variable like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">$name</span> <span class="p">}}.</span>
</pre></div>

<blockquote>
<p>{tip} Blade <code>{{ }}</code> statements are automatically sent through PHP&#39;s <code>htmlspecialchars</code> function to prevent XSS attacks.</p>
</blockquote>

<p>You are not limited to displaying the contents of the variables passed to the view. You may also echo the results of any PHP function. In fact, you can put any PHP code you wish inside of a Blade echo statement:</p>
<div class="highlight"><pre><span></span><span class="nx">The</span> <span class="nx">current</span> <span class="nx">UNIX</span> <span class="nx">timestamp</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">time</span><span class="p">()</span> <span class="p">}}.</span>
</pre></div>

<h4>Displaying Unescaped Data</h4>

<p>By default, Blade <code>{{ }}</code> statements are automatically sent through PHP&#39;s <code>htmlspecialchars</code> function to prevent XSS attacks. If you do not want your data to be escaped, you may use the following syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{</span><span class="o">!!</span> <span class="nx">$name</span> <span class="o">!!</span><span class="p">}.</span>
</pre></div>

<blockquote>
<p>{note} Be very careful when echoing content that is supplied by users of your application. Always use the escaped, double curly brace syntax to prevent XSS attacks when displaying user supplied data.</p>
</blockquote>

<h4>Rendering JSON</h4>

<p>Sometimes you may pass an array to your view with the intention of rendering it as JSON in order to initialize a JavaScript variable. For example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="p">;</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>However, instead of manually calling <code>json_encode</code>, you may use the <code>@json</code> Blade directive. The <code>@json</code> directive accepts the same arguments as PHP&#39;s <code>json_encode</code> function:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="err">@</span><span class="nx">json</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="err">@</span><span class="nx">json</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<blockquote>
<p>{note} You should only use the <code>@json</code> directive to render existing variables as JSON. The Blade templating is based on regular expressions and attempts to pass a complex expression to the directive may cause unexpected failures.</p>
</blockquote>

<h4>HTML Entity Encoding</h4>

<p>By default, Blade (and the Laravel <code>e</code> helper) will double encode HTML entities. If you would like to disable double encoding, call the <code>Blade::withoutDoubleEncoding</code> method from the <code>boot</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Blade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Blade</span><span class="o">::</span><span class="na">withoutDoubleEncoding</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="blade-and-javascript-frameworks"></a></p>

<h3>Blade &amp; JavaScript Frameworks</h3>

<p>Since many JavaScript frameworks also use &quot;curly&quot; braces to indicate a given expression should be displayed in the browser, you may use the <code>@</code> symbol to inform the Blade rendering engine an expression should remain untouched. For example:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Laravel</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

<span class="nx">Hello</span><span class="p">,</span> <span class="err">@</span><span class="p">{{</span> <span class="nx">name</span> <span class="p">}}.</span>
</pre></div>

<p>In this example, the <code>@</code> symbol will be removed by Blade; however, <code>{{ name }}</code> expression will remain untouched by the Blade engine, allowing it to instead be rendered by your JavaScript framework.</p>

<p>The <code>@</code> symbol may also be used to escape Blade directives:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">--</span> <span class="nx">Blade</span> <span class="o">--</span><span class="p">}}</span>
<span class="err">@@</span><span class="nx">json</span><span class="p">()</span>

<span class="c">&lt;!--</span> <span class="nx">HTML</span> <span class="nx">output</span> <span class="o">--&gt;</span>
<span class="err">@</span><span class="nx">json</span><span class="p">()</span>
</pre></div>

<h4>The <code>@verbatim</code> Directive</h4>

<p>If you are displaying JavaScript variables in a large portion of your template, you may wrap the HTML in the <code>@verbatim</code> directive so that you do not have to prefix each Blade echo statement with an <code>@</code> symbol:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">verbatim</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
        <span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">name</span> <span class="p">}}.</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endverbatim</span>
</pre></div>

<p><a name="control-structures"></a></p>

<h2>Control Structures</h2>

<p>In addition to template inheritance and displaying data, Blade also provides convenient shortcuts for common PHP control structures, such as conditional statements and loops. These shortcuts provide a very clean, terse way of working with PHP control structures, while also remaining familiar to their PHP counterparts.</p>

<p><a name="if-statements"></a></p>

<h3>If Statements</h3>

<p>You may construct <code>if</code> statements using the <code>@if</code>, <code>@elseif</code>, <code>@else</code>, and <code>@endif</code> directives. These directives function identically to their PHP counterparts:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">one</span> <span class="nx">record</span><span class="o">!</span>
<span class="err">@</span><span class="nx">elseif</span> <span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">I</span> <span class="nx">have</span> <span class="nx">multiple</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="k">else</span>
    <span class="nx">I</span> <span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">have</span> <span class="nx">any</span> <span class="nx">records</span><span class="o">!</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<p>For convenience, Blade also provides an <code>@unless</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">unless</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">check</span><span class="p">())</span>
    <span class="nx">You</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">signed</span> <span class="k">in</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endunless</span>
</pre></div>

<p>In addition to the conditional directives already discussed, the <code>@isset</code> and <code>@empty</code> directives may be used as convenient shortcuts for their respective PHP functions:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">isset</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span>
    <span class="c1">// $records is defined and is not null...</span>
<span class="err">@</span><span class="nx">endisset</span>

<span class="err">@</span><span class="nx">empty</span><span class="p">(</span><span class="nx">$records</span><span class="p">)</span>
    <span class="c1">// $records is &quot;empty&quot;...</span>
<span class="err">@</span><span class="nx">endempty</span>
</pre></div>

<h4>Authentication Directives</h4>

<p>The <code>@auth</code> and <code>@guest</code> directives may be used to quickly determine if the current user is authenticated or is a guest:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">auth</span>
    <span class="c1">// The user is authenticated...</span>
<span class="err">@</span><span class="nx">endauth</span>

<span class="err">@</span><span class="nx">guest</span>
    <span class="c1">// The user is not authenticated...</span>
<span class="err">@</span><span class="nx">endguest</span>
</pre></div>

<p>If needed, you may specify the <a href="/docs/%7B%7Bversion%7D%7D/authentication">authentication guard</a> that should be checked when using the <code>@auth</code> and <code>@guest</code> directives:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">auth</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>
    <span class="c1">// The user is authenticated...</span>
<span class="err">@</span><span class="nx">endauth</span>

<span class="err">@</span><span class="nx">guest</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>
    <span class="c1">// The user is not authenticated...</span>
<span class="err">@</span><span class="nx">endguest</span>
</pre></div>

<h4>Section Directives</h4>

<p>You may check if a section has content using the <code>@hasSection</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">hasSection</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;pull-right&quot;</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="k">yield</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;clearfix&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<p>You may use the <code>sectionMissing</code> directive to determine if a section does not have content:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">sectionMissing</span><span class="p">(</span><span class="s1">&#39;navigation&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;pull-right&quot;</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;default-navigation&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<h4>Environment Directives</h4>

<p>You may check if the application is running in the production environment using the <code>@production</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">production</span>
    <span class="c1">// Production specific content...</span>
<span class="err">@</span><span class="nx">endproduction</span>
</pre></div>

<p>Or, you may determine if the application is running in a specific environment using the <code>@env</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;staging&#39;</span><span class="p">)</span>
    <span class="c1">// The application is running in &quot;staging&quot;...</span>
<span class="err">@</span><span class="nx">endenv</span>

<span class="err">@</span><span class="nx">env</span><span class="p">([</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">])</span>
    <span class="c1">// The application is running in &quot;staging&quot; or &quot;production&quot;...</span>
<span class="err">@</span><span class="nx">endenv</span>
</pre></div>

<p><a name="switch-statements"></a></p>

<h3>Switch Statements</h3>

<p>Switch statements can be constructed using the <code>@switch</code>, <code>@case</code>, <code>@break</code>, <code>@default</code> and <code>@endswitch</code> directives:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">switch</span><span class="p">(</span><span class="nx">$i</span><span class="p">)</span>
    <span class="err">@</span><span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">First</span> <span class="k">case</span><span class="p">...</span>
        <span class="err">@</span><span class="k">break</span>

    <span class="err">@</span><span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="nx">Second</span> <span class="k">case</span><span class="p">...</span>
        <span class="err">@</span><span class="k">break</span>

    <span class="err">@</span><span class="k">default</span>
        <span class="nx">Default</span> <span class="k">case</span><span class="p">...</span>
<span class="err">@</span><span class="nx">endswitch</span>
</pre></div>

<p><a name="loops"></a></p>

<h3>Loops</h3>

<p>In addition to conditional statements, Blade provides simple directives for working with PHP&#39;s loop structures. Again, each of these directives functions identically to their PHP counterparts:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">The</span> <span class="nx">current</span> <span class="nx">value</span> <span class="nx">is</span> <span class="p">{{</span> <span class="nx">$i</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endfor</span>

<span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">user</span> <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>

<span class="err">@</span><span class="nx">forelse</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="err">@</span><span class="nx">empty</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">No</span> <span class="nx">users</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforelse</span>

<span class="err">@</span><span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">I</span><span class="err">&#39;</span><span class="nx">m</span> <span class="nx">looping</span> <span class="nx">forever</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endwhile</span>
</pre></div>

<blockquote>
<p>{tip} When looping, you may use the <a href="#the-loop-variable">loop variable</a> to gain valuable information about the loop, such as whether you are in the first or last iteration through the loop.</p>
</blockquote>

<p>When using loops you may also end the loop or skip the current iteration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="err">@</span><span class="k">continue</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>

    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">number</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
        <span class="err">@</span><span class="k">break</span>
    <span class="err">@</span><span class="nx">endif</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p>You may also include the condition with the directive declaration in one line:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="err">@</span><span class="k">continue</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>

    <span class="err">@</span><span class="k">break</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">number</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p><a name="the-loop-variable"></a></p>

<h3>The Loop Variable</h3>

<p>When looping, a <code>$loop</code> variable will be available inside of your loop. This variable provides access to some useful bits of information such as the current loop index and whether this is the first or last iteration through the loop:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$loop</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">)</span>
        <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">iteration</span><span class="p">.</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$loop</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">)</span>
        <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">last</span> <span class="nx">iteration</span><span class="p">.</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">user</span> <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p>If you are in a nested loop, you may access the parent loop&#39;s <code>$loop</code> variable via the <code>parent</code> property:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span> <span class="nx">as</span> <span class="nx">$post</span><span class="p">)</span>
        <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$loop</span><span class="o">-&gt;</span><span class="nx">parent</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">)</span>
            <span class="nx">This</span> <span class="nx">is</span> <span class="nx">first</span> <span class="nx">iteration</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">parent</span> <span class="nx">loop</span><span class="p">.</span>
        <span class="err">@</span><span class="nx">endif</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p>The <code>$loop</code> variable also contains a variety of other useful properties:</p>

<p>Property  | Description
------------- | -------------
<code>$loop-&gt;index</code>  |  The index of the current loop iteration (starts at 0).
<code>$loop-&gt;iteration</code>  |  The current loop iteration (starts at 1).
<code>$loop-&gt;remaining</code>  |  The iterations remaining in the loop.
<code>$loop-&gt;count</code>  |  The total number of items in the array being iterated.
<code>$loop-&gt;first</code>  |  Whether this is the first iteration through the loop.
<code>$loop-&gt;last</code>  |  Whether this is the last iteration through the loop.
<code>$loop-&gt;even</code>  |  Whether this is an even iteration through the loop.
<code>$loop-&gt;odd</code>  |  Whether this is an odd iteration through the loop.
<code>$loop-&gt;depth</code>  |  The nesting level of the current loop.
<code>$loop-&gt;parent</code>  |  When in a nested loop, the parent&#39;s loop variable.</p>

<p><a name="comments"></a></p>

<h3>Comments</h3>

<p>Blade also allows you to define comments in your views. However, unlike HTML comments, Blade comments are not included in the HTML returned by your application:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">--</span> <span class="nx">This</span> <span class="nx">comment</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">present</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">rendered</span> <span class="nx">HTML</span> <span class="o">--</span><span class="p">}}</span>
</pre></div>

<p><a name="php"></a></p>

<h3>PHP</h3>

<p>In some situations, it&#39;s useful to embed PHP code into your views. You can use the Blade <code>@php</code> directive to execute a block of plain PHP within your template:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">php</span>
    <span class="c1">//</span>
<span class="err">@</span><span class="nx">endphp</span>
</pre></div>

<blockquote>
<p>{tip} While Blade provides this feature, using it frequently may be a signal that you have too much logic embedded within your template.</p>
</blockquote>

<p><a name="the-once-directive"></a></p>

<h3>The <code>@once</code> Directive</h3>

<p>The <code>@once</code> directive allows you to define a portion of the template that will only be evaluate once per rendering cycle. This may be useful for pushing a given piece of JavaScript into the page&#39;s header using <a href="#stacks">stacks</a>. For example, if you are rendering a given <a href="#components">component</a> within a loop, you may wish to only push the JavaScript to the header the the first time the component is rendered:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">once</span>
    <span class="err">@</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
            <span class="c1">// Your custom JavaScript...</span>
        <span class="o">&lt;</span><span class="err">/script&gt;</span>
    <span class="err">@</span><span class="nx">endpush</span>
<span class="err">@</span><span class="nx">endonce</span>
</pre></div>

<p><a name="forms"></a></p>

<h2>Forms</h2>

<p><a name="csrf-field"></a></p>

<h3>CSRF Field</h3>

<p>Anytime you define an HTML form in your application, you should include a hidden CSRF token field in the form so that <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/csrf">the CSRF protection</a> middleware can validate the request. You may use the <code>@csrf</code> Blade directive to generate the token field:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">csrf</span>

    <span class="p">...</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="method-field"></a></p>

<h3>Method Field</h3>

<p>Since HTML forms can&#39;t make <code>PUT</code>, <code>PATCH</code>, or <code>DELETE</code> requests, you will need to add a hidden <code>_method</code> field to spoof these HTTP verbs. The <code>@method</code> Blade directive can create this field for you:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">method</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">)</span>

    <span class="p">...</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="validation-errors"></a></p>

<h3>Validation Errors</h3>

<p>The <code>@error</code> directive may be used to quickly check if <a href="/docs/%7B%7Bversion%7D%7D/validation#quick-displaying-the-validation-errors">validation error messages</a> exist for a given attribute. Within an <code>@error</code> directive, you may echo the <code>$message</code> variable to display the error message:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/post/create.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span><span class="nx">Post</span> <span class="nx">Title</span><span class="o">&lt;</span><span class="err">/label&gt;</span>

<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;@error(&#39;title&#39;) is-invalid @enderror&quot;</span><span class="o">&gt;</span>

<span class="err">@</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">enderror</span>
</pre></div>

<p>You may pass <a href="/docs/%7B%7Bversion%7D%7D/validation#named-error-bags">the name of a specific error bag</a> as the second parameter to the <code>@error</code> directive to retrieve validation error messages on pages containing multiple forms:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/auth.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="o">&gt;</span><span class="nx">Email</span> <span class="nx">address</span><span class="o">&lt;</span><span class="err">/label&gt;</span>

<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;@error(&#39;email&#39;, &#39;login&#39;) is-invalid @enderror&quot;</span><span class="o">&gt;</span>

<span class="err">@</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">enderror</span>
</pre></div>

<p><a name="components"></a></p>

<h2>Components</h2>

<p>Components and slots provide similar benefits to sections and layouts; however, some may find the mental model of components and slots easier to understand. There are two approaches to writing components: class based components and anonymous components.</p>

<p>To create a class based component, you may use the <code>make:component</code> Artisan command. To illustrate how to use components, we will create a simple <code>Alert</code> component. The <code>make:component</code> command will place the component in the <code>App\View\Components</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">component</span> <span class="nx">Alert</span>
</pre></div>

<p>The <code>make:component</code> command will also create a view template for the component. The view will be placed in the <code>resources/views/components</code> directory.</p>

<h4>Manually Registering Package Components</h4>

<p>When writing components for your own application, components are automatically discovered within the <code>app/View/Components</code> directory and <code>resources/views/components</code> directory.</p>

<p>However, if you are building a package that utilizes Blade components, you will need to manually register your component class and its HTML tag alias. You should typically register your components in the <code>boot</code> method of your package&#39;s service provider:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Blade</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bootstrap your package&#39;s services.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Blade</span><span class="o">::</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;package-alert&#39;</span><span class="p">,</span> <span class="nx">AlertComponent</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Once your component has been registered, it may be rendered using its tag alias:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="kr">package</span><span class="o">-</span><span class="nx">alert</span><span class="o">/&gt;</span>
</pre></div>

<p><a name="displaying-components"></a></p>

<h3>Displaying Components</h3>

<p>To display a component, you may use a Blade component tag within one of your Blade templates. Blade component tags start with the string <code>x-</code> followed by the kebab case name of the component class:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">user</span><span class="o">-</span><span class="nx">profile</span><span class="o">/&gt;</span>
</pre></div>

<p>If the component class is nested deeper within the <code>App\View\Components</code> directory, you may use the <code>.</code> character to indicate directory nesting. For example, if we assume a component is located at <code>App\View\Components\Inputs\Button.php</code>, we may render it like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">button</span><span class="o">/&gt;</span>
</pre></div>

<p><a name="passing-data-to-components"></a></p>

<h3>Passing Data To Components</h3>

<p>You may pass data to Blade components using HTML attributes. Hard-coded, primitive values may be passed to the component using simple HTML attributes. PHP expressions and variables should be passed to the component via attributes that use the <code>:</code> character as a prefix:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span> <span class="o">:</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;$message&quot;</span><span class="o">/&gt;</span>
</pre></div>

<p>You should define the component&#39;s required data in its class constructor. All public properties on a component will automatically be made available to the component&#39;s view. It is not necessary to pass the data to the view from the component&#39;s <code>render</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\View\Components</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\View\Component</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Alert</span> <span class="k">extends</span> <span class="nx">Component</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The alert type.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$type</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The alert message.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$message</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create the component instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $type</span>
<span class="sd">     * @param  string  $message</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span> <span class="o">=</span> <span class="nv">$type</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="nv">$message</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the view / contents that represent the component.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\View\View|\Closure|string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;components.alert&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When your component is rendered, you may display the contents of your component&#39;s public variables by echoing the variables by name:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-{{ $type }}&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<h4>Casing</h4>

<p>Component constructor arguments should be specified using <code>camelCase</code>, while <code>kebab-case</code> should be used when referencing the argument names in your HTML attributes. For example, given the following component constructor:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Create the component instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $alertType</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">$alertType</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">alertType</span> <span class="o">=</span> <span class="nx">$alertType</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The <code>$alertType</code> argument may be provided like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">alert</span><span class="o">-</span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span> <span class="o">/&gt;</span>
</pre></div>

<h4>Component Methods</h4>

<p>In addition to public variables being available to your component template, any public methods on the component may also be executed. For example, imagine a component that has a <code>isSelected</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the given option is the current selected option.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $option</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">isSelected</span><span class="p">(</span><span class="nx">$option</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$option</span> <span class="o">===</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">selected</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You may execute this method from your component template by invoking the variable matching the name of the method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">option</span> <span class="p">{{</span> <span class="nx">$isSelected</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;selected=&quot;selected&quot;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">}}</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ $value }}&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$label</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/option&gt;</span>
</pre></div>

<h4>Using Attributes &amp; Slots Inside The Class</h4>

<p>Blade components also allow you to access the component name, attributes, and slot inside the class&#39;s render method. However, in order to access this data, you should return a Closure from your component&#39;s <code>render</code> method. The Closure will receive a <code>$data</code> array as its only argument:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the view / contents that represent the component.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\View\View|\Closure|string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $data[&#39;componentName&#39;];</span>
        <span class="c1">// $data[&#39;attributes&#39;];</span>
        <span class="c1">// $data[&#39;slot&#39;];</span>

        <span class="k">return</span> <span class="s1">&#39;&lt;div&gt;Component content&lt;/div&gt;&#39;</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>

<p>The <code>componentName</code> is equal to the name used in the HTML tag after the <code>x-</code> prefix. So <code>&lt;x-alert /&gt;</code>&#39;s <code>componentName</code> will be <code>alert</code>. The <code>attributes</code> element will contain all of the attributes that were present on the HTML tag. The <code>slot</code> element is a <code>Illuminate\Support\HtmlString</code> instance with the contents of the slot from the component.</p>

<h4>Additional Dependencies</h4>

<p>If your component requires dependencies from Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, you may list them before any of the component&#39;s data attributes and they will automatically be injected by the container:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Services</span><span class="err">\</span><span class="nx">AlertCreator</span>

<span class="cm">/**</span>
<span class="cm"> * Create the component instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \App\Services\AlertCreator  $creator</span>
<span class="cm"> * @param  string  $type</span>
<span class="cm"> * @param  string  $message</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">AlertCreator</span> <span class="nx">$creator</span><span class="p">,</span> <span class="nx">$type</span><span class="p">,</span> <span class="nx">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">creator</span> <span class="o">=</span> <span class="nx">$creator</span><span class="p">;</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">$type</span><span class="p">;</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">$message</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="managing-attributes"></a></p>

<h3>Managing Attributes</h3>

<p>We&#39;ve already examined how to pass data attributes to a component; however, sometimes you may need to specify additional HTML attributes, such as <code>class</code>, that are not part of the data required for a component to function. Typically, you want to pass these additional attributes down to the root element of the component template. For example, imagine we want to render an <code>alert</code> component like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span> <span class="o">:</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;$message&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;mt-4&quot;</span><span class="o">/&gt;</span>
</pre></div>

<p>All of the attributes that are not part of the component&#39;s constructor will automatically be added to the component&#39;s &quot;attribute bag&quot;. This attribute bag is automatically made available to the component via the <code>$attributes</code> variable. All of the attributes may be rendered within the component by echoing this variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="p">{{</span> <span class="nx">$attributes</span> <span class="p">}}</span><span class="o">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">Component</span> <span class="nx">Content</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<blockquote>
<p>{note} Using directives such as <code>@env</code> directly on a component is not supported at this time.</p>
</blockquote>

<h4>Default / Merged Attributes</h4>

<p>Sometimes you may need to specify default values for attributes or merge additional values into some of the component&#39;s attributes. To accomplish this, you may use the attribute bag&#39;s <code>merge</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="p">{{</span> <span class="nx">$attributes</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;class&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;alert alert-&#39;</span><span class="p">.</span><span class="nx">$type</span><span class="p">])</span> <span class="p">}}</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p>If we assume this component is utilized like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span> <span class="o">:</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;$message&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;mb-4&quot;</span><span class="o">/&gt;</span>
</pre></div>

<p>The final, rendered HTML of the component will appear like the following:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-error mb-4&quot;</span><span class="o">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">Contents</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">$message</span> <span class="nx">variable</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<h4>Filtering Attributes</h4>

<p>You may filter attributes using the <code>filter</code> method. This method accepts a Closure which should return <code>true</code> if you wish to retain the attribute in the attribute bag:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$attributes</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="nx">fn</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">$key</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p>For convenience, you may use the <code>whereStartsWith</code> method to retrieve all attributes whose keys begin with a given string:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$attributes</span><span class="o">-&gt;</span><span class="nx">whereStartsWith</span><span class="p">(</span><span class="s1">&#39;wire:model&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p>Using the <code>first</code> method, you may render the first attribute in a given attribute bag:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$attributes</span><span class="o">-&gt;</span><span class="nx">whereStartsWith</span><span class="p">(</span><span class="s1">&#39;wire:model&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p><a name="slots"></a></p>

<h3>Slots</h3>

<p>Often, you will need to pass additional content to your component via &quot;slots&quot;. Let&#39;s imagine that an <code>alert</code> component we created has the following markup:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/components/alert.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$slot</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p>We may pass content to the <code>slot</code> by injecting content into the component:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Whoops</span><span class="o">!&lt;</span><span class="err">/strong&gt; Something went wrong!</span>
<span class="o">&lt;</span><span class="err">/x-alert&gt;</span>
</pre></div>

<p>Sometimes a component may need to render multiple different slots in different locations within the component. Let&#39;s modify our alert component to allow for the injection of a &quot;title&quot;:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/components/alert.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">span</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert-title&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$title</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>

<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$slot</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p>You may define the content of the named slot using the <code>x-slot</code> tag. Any content not within a <code>x-slot</code> tag will be passed to the component in the <code>$slot</code> variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">slot</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span>
        <span class="nx">Server</span> <span class="nb">Error</span>
    <span class="o">&lt;</span><span class="err">/x-slot&gt;</span>

    <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Whoops</span><span class="o">!&lt;</span><span class="err">/strong&gt; Something went wrong!</span>
<span class="o">&lt;</span><span class="err">/x-alert&gt;</span>
</pre></div>

<h4>Scoped Slots</h4>

<p>If you have used a JavaScript framework such as Vue, you may be familiar with &quot;scoped slots&quot;, which allow you to access data or methods from the component within your slot. You may achieve similar behavior in Laravel by defining public methods or properties on your component and accessing the component within your slot via the <code>$component</code> variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">slot</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="nx">$component</span><span class="o">-&gt;</span><span class="nx">formatAlert</span><span class="p">(</span><span class="s1">&#39;Server Error&#39;</span><span class="p">)</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="err">/x-slot&gt;</span>

    <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Whoops</span><span class="o">!&lt;</span><span class="err">/strong&gt; Something went wrong!</span>
<span class="o">&lt;</span><span class="err">/x-alert&gt;</span>
</pre></div>

<p><a name="inline-component-views"></a></p>

<h3>Inline Component Views</h3>

<p>For very small components, it may feel cumbersome to manage both the component class and the component&#39;s view template. For this reason, you may return the component&#39;s markup directly from the <code>render</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the view / contents that represent the component.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\View\View|\Closure|string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;&lt;&lt;</span><span class="s1">&#39;blade&#39;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">$slot</span> <span class="p">}}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="nx">blade</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Generating Inline View Components</h4>

<p>To create a component that renders an inline view, you may use the <code>inline</code> option when executing the <code>make:component</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">component</span> <span class="nx">Alert</span> <span class="o">--</span><span class="nx">inline</span>
</pre></div>

<p><a name="anonymous-components"></a></p>

<h3>Anonymous Components</h3>

<p>Similar to inline components, anonymous components provide a mechanism for managing a component via a single file. However, anonymous components utilize a single view file and have no associated class. To define an anonymous component, you only need to place a Blade template within your <code>resources/views/components</code> directory. For example, assuming you have defined a component at <code>resources/views/components/alert.blade.php</code>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">alert</span><span class="o">/&gt;</span>
</pre></div>

<p>You may use the <code>.</code> character to indicate if a component is nested deeper inside the <code>components</code> directory. For example, assuming the component is defined at <code>resources/views/components/inputs/button.blade.php</code>, you may render it like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">button</span><span class="o">/&gt;</span>
</pre></div>

<h4>Data Properties / Attributes</h4>

<p>Since anonymous components do not have any associated class, you may wonder how you may differentiate which data should be passed to the component as variables and which attributes should be placed in the component&#39;s <a href="#managing-attributes">attribute bag</a>.</p>

<p>You may specify which attributes should be considered data variables using the <code>@props</code> directive at the top of your component&#39;s Blade template. All other attributes on the component will be available via the component&#39;s attribute bag. If you wish to give a data variable a default value, you may specify the variable&#39;s name as the array key and the default value as the array value:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/components/alert.blade.php --&gt;</span>

<span class="err">@</span><span class="nx">props</span><span class="p">([</span><span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">])</span>

<span class="o">&lt;</span><span class="nx">div</span> <span class="p">{{</span> <span class="nx">$attributes</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;class&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;alert alert-&#39;</span><span class="p">.</span><span class="nx">$type</span><span class="p">])</span> <span class="p">}}</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p><a name="dynamic-components"></a></p>

<h3>Dynamic Components</h3>

<p>Sometimes you may need to render a component but not know which component should be rendered until runtime. In this situation, you may use Laravel&#39;s built-in <code>dynamic-component</code> component to render the component based on a runtime value or variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">dynamic</span><span class="o">-</span><span class="nx">component</span> <span class="o">:</span><span class="nx">component</span><span class="o">=</span><span class="s2">&quot;$componentName&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;mt-4&quot;</span> <span class="o">/&gt;</span>
</pre></div>

<p><a name="including-subviews"></a></p>

<h2>Including Subviews</h2>

<p>Blade&#39;s <code>@include</code> directive allows you to include a Blade view from within another view. All variables that are available to the parent view will be made available to the included view:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;shared.errors&#39;</span><span class="p">)</span>

    <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
        <span class="c">&lt;!--</span> <span class="nx">Form</span> <span class="nx">Contents</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p>Even though the included view will inherit all data available in the parent view, you may also pass an array of extra data to the included view:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<p>If you attempt to <code>@include</code> a view which does not exist, Laravel will throw an error. If you would like to include a view that may or may not be present, you should use the <code>@includeIf</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">includeIf</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<p>If you would like to <code>@include</code> a view if a given boolean expression evaluates to <code>true</code>, you may use the <code>@includeWhen</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">includeWhen</span><span class="p">(</span><span class="nx">$boolean</span><span class="p">,</span> <span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<p>If you would like to <code>@include</code> a view if a given boolean expression evaluates to <code>false</code>, you may use the <code>@includeUnless</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">includeUnless</span><span class="p">(</span><span class="nx">$boolean</span><span class="p">,</span> <span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<p>To include the first view that exists from a given array of views, you may use the <code>includeFirst</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">includeFirst</span><span class="p">([</span><span class="s1">&#39;custom.admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;some&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>

<blockquote>
<p>{note} You should avoid using the <code>__DIR__</code> and <code>__FILE__</code> constants in your Blade views, since they will refer to the location of the cached, compiled view.</p>
</blockquote>

<h4>Aliasing Includes</h4>

<p>If your Blade includes are stored in a subdirectory, you may wish to alias them for easier access. For example, imagine a Blade include that is stored at <code>resources/views/includes/input.blade.php</code> with the following content:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;{{ $type ?? &#39;text&#39; }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>You may use the <code>include</code> method to alias the include from <code>includes.input</code> to <code>input</code>. Typically, this should be done in the <code>boot</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Blade</span><span class="p">;</span>

<span class="nx">Blade</span><span class="o">::</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;includes.input&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the include has been aliased, you may render it using the alias name as the Blade directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">input</span><span class="p">([</span><span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span>
</pre></div>

<p><a name="rendering-views-for-collections"></a></p>

<h3>Rendering Views For Collections</h3>

<p>You may combine loops and includes into one line with Blade&#39;s <code>@each</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">each</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="nx">$jobs</span><span class="p">,</span> <span class="s1">&#39;job&#39;</span><span class="p">)</span>
</pre></div>

<p>The first argument is the view partial to render for each element in the array or collection. The second argument is the array or collection you wish to iterate over, while the third argument is the variable name that will be assigned to the current iteration within the view. So, for example, if you are iterating over an array of <code>jobs</code>, typically you will want to access each job as a <code>job</code> variable within your view partial. The key for the current iteration will be available as the <code>key</code> variable within your view partial.</p>

<p>You may also pass a fourth argument to the <code>@each</code> directive. This argument determines the view that will be rendered if the given array is empty.</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">each</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="nx">$jobs</span><span class="p">,</span> <span class="s1">&#39;job&#39;</span><span class="p">,</span> <span class="s1">&#39;view.empty&#39;</span><span class="p">)</span>
</pre></div>

<blockquote>
<p>{note} Views rendered via <code>@each</code> do not inherit the variables from the parent view. If the child view requires these variables, you should use <code>@foreach</code> and <code>@include</code> instead.</p>
</blockquote>

<p><a name="stacks"></a></p>

<h2>Stacks</h2>

<p>Blade allows you to push to named stacks which can be rendered somewhere else in another view or layout. This can be particularly useful for specifying any JavaScript libraries required by your child views:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/example.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="err">@</span><span class="nx">endpush</span>
</pre></div>

<p>You may push to a stack as many times as needed. To render the complete stack contents, pass the name of the stack to the <code>@stack</code> directive:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">Head</span> <span class="nx">Contents</span> <span class="o">--&gt;</span>

    <span class="err">@</span><span class="nx">stack</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="err">/head&gt;</span>
</pre></div>

<p>If you would like to prepend content onto the beginning of a stack, you should use the <code>@prepend</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
    <span class="nx">This</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">second</span><span class="p">...</span>
<span class="err">@</span><span class="nx">endpush</span>

<span class="c1">// Later...</span>

<span class="err">@</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
    <span class="nx">This</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">first</span><span class="p">...</span>
<span class="err">@</span><span class="nx">endprepend</span>
</pre></div>

<p><a name="service-injection"></a></p>

<h2>Service Injection</h2>

<p>The <code>@inject</code> directive may be used to retrieve a service from the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. The first argument passed to <code>@inject</code> is the name of the variable the service will be placed into, while the second argument is the class or interface name of the service you wish to resolve:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">inject</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Services\MetricsService&#39;</span><span class="p">)</span>

<span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="nx">Monthly</span> <span class="nx">Revenue</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$metrics</span><span class="o">-&gt;</span><span class="nx">monthlyRevenue</span><span class="p">()</span> <span class="p">}}.</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p><a name="extending-blade"></a></p>

<h2>Extending Blade</h2>

<p>Blade allows you to define your own custom directives using the <code>directive</code> method. When the Blade compiler encounters the custom directive, it will call the provided callback with the expression that the directive contains.</p>

<p>The following example creates a <code>@datetime($var)</code> directive which formats a given <code>$var</code>, which should be an instance of <code>DateTime</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Blade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Blade</span><span class="o">::</span><span class="na">directive</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$expression</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;?php echo (</span><span class="si">$expression</span><span class="s2">)-&gt;format(&#39;m/d/Y H:i&#39;); ?&gt;&quot;</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, we will chain the <code>format</code> method onto whatever expression is passed into the directive. So, in this example, the final PHP generated by this directive will be:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="p">(</span><span class="nv">$var</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;m/d/Y H:i&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span>
</pre></div>

<blockquote>
<p>{note} After updating the logic of a Blade directive, you will need to delete all of the cached Blade views. The cached Blade views may be removed using the <code>view:clear</code> Artisan command.</p>
</blockquote>

<p><a name="custom-if-statements"></a></p>

<h3>Custom If Statements</h3>

<p>Programming a custom directive is sometimes more complex than necessary when defining simple, custom conditional statements. For that reason, Blade provides a <code>Blade::if</code> method which allows you to quickly define custom conditional directives using Closures. For example, let&#39;s define a custom conditional that checks the current application cloud provider. We may do this in the <code>boot</code> method of our <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Blade</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Blade</span><span class="o">::</span><span class="k">if</span><span class="p">(</span><span class="s1">&#39;cloud&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$provider</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;filesystems.default&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">$provider</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Once the custom conditional has been defined, we can easily use it on our templates:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">cloud</span><span class="p">(</span><span class="s1">&#39;digitalocean&#39;</span><span class="p">)</span>
    <span class="c1">// The application is using the digitalocean cloud provider...</span>
<span class="err">@</span><span class="nx">elsecloud</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="c1">// The application is using the aws provider...</span>
<span class="err">@</span><span class="k">else</span>
    <span class="c1">// The application is not using the digitalocean or aws environment...</span>
<span class="err">@</span><span class="nx">endcloud</span>

<span class="err">@</span><span class="nx">unlesscloud</span><span class="p">(</span><span class="s1">&#39;aws&#39;</span><span class="p">)</span>
    <span class="c1">// The application is not using the aws environment...</span>
<span class="err">@</span><span class="nx">endcloud</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Broadcasting</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#concept-overview">Concept Overview</a>

<ul>
<li><a href="#using-example-application">Using An Example Application</a></li>
</ul></li>
<li><a href="#defining-broadcast-events">Defining Broadcast Events</a>

<ul>
<li><a href="#broadcast-name">Broadcast Name</a></li>
<li><a href="#broadcast-data">Broadcast Data</a></li>
<li><a href="#broadcast-queue">Broadcast Queue</a></li>
<li><a href="#broadcast-conditions">Broadcast Conditions</a></li>
</ul></li>
<li><a href="#authorizing-channels">Authorizing Channels</a>

<ul>
<li><a href="#defining-authorization-routes">Defining Authorization Routes</a></li>
<li><a href="#defining-authorization-callbacks">Defining Authorization Callbacks</a></li>
<li><a href="#defining-channel-classes">Defining Channel Classes</a></li>
</ul></li>
<li><a href="#broadcasting-events">Broadcasting Events</a>

<ul>
<li><a href="#only-to-others">Only To Others</a></li>
</ul></li>
<li><a href="#receiving-broadcasts">Receiving Broadcasts</a>

<ul>
<li><a href="#installing-laravel-echo">Installing Laravel Echo</a></li>
<li><a href="#listening-for-events">Listening For Events</a></li>
<li><a href="#leaving-a-channel">Leaving A Channel</a></li>
<li><a href="#namespaces">Namespaces</a></li>
</ul></li>
<li><a href="#presence-channels">Presence Channels</a>

<ul>
<li><a href="#authorizing-presence-channels">Authorizing Presence Channels</a></li>
<li><a href="#joining-presence-channels">Joining Presence Channels</a></li>
<li><a href="#broadcasting-to-presence-channels">Broadcasting To Presence Channels</a></li>
</ul></li>
<li><a href="#client-events">Client Events</a></li>
<li><a href="#notifications">Notifications</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In many modern web applications, WebSockets are used to implement realtime, live-updating user interfaces. When some data is updated on the server, a message is typically sent over a WebSocket connection to be handled by the client. This provides a more robust, efficient alternative to continually polling your application for changes.</p>

<p>To assist you in building these types of applications, Laravel makes it easy to &quot;broadcast&quot; your <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> over a WebSocket connection. Broadcasting your Laravel events allows you to share the same event names between your server-side code and your client-side JavaScript application.</p>

<blockquote>
<p>{tip} Before diving into event broadcasting, make sure you have read all of the documentation regarding Laravel <a href="/docs/%7B%7Bversion%7D%7D/events">events and listeners</a>.</p>
</blockquote>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>All of your application&#39;s event broadcasting configuration is stored in the <code>config/broadcasting.php</code> configuration file. Laravel supports several broadcast drivers out of the box: <a href="https://pusher.com/channels">Pusher Channels</a>, <a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a>, and a <code>log</code> driver for local development and debugging. Additionally, a <code>null</code> driver is included which allows you to totally disable broadcasting. A configuration example is included for each of these drivers in the <code>config/broadcasting.php</code> configuration file.</p>

<h4>Broadcast Service Provider</h4>

<p>Before broadcasting any events, you will first need to register the <code>App\Providers\BroadcastServiceProvider</code>. In fresh Laravel applications, you only need to uncomment this provider in the <code>providers</code> array of your <code>config/app.php</code> configuration file. This provider will allow you to register the broadcast authorization routes and callbacks.</p>

<h4>CSRF Token</h4>

<p><a href="#installing-laravel-echo">Laravel Echo</a> will need access to the current session&#39;s CSRF token. You should verify that your application&#39;s <code>head</code> HTML element defines a <code>meta</code> tag containing the CSRF token:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;csrf-token&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Pusher Channels</h4>

<p>If you are broadcasting your events over <a href="https://pusher.com/channels">Pusher Channels</a>, you should install the Pusher Channels PHP SDK using the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">pusher</span><span class="o">/</span><span class="nx">pusher</span><span class="o">-</span><span class="nx">php</span><span class="o">-</span><span class="nx">server</span> <span class="s2">&quot;~4.0&quot;</span>
</pre></div>

<p>Next, you should configure your Channels credentials in the <code>config/broadcasting.php</code> configuration file. An example Channels configuration is already included in this file, allowing you to quickly specify your Channels key, secret, and application ID. The <code>config/broadcasting.php</code> file&#39;s <code>pusher</code> configuration also allows you to specify additional <code>options</code> that are supported by Channels, such as the cluster:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;options&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;cluster&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;eu&#39;</span><span class="p">,</span>
    <span class="s1">&#39;useTLS&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span>
<span class="p">],</span>
</pre></div>

<p>When using Channels and <a href="#installing-laravel-echo">Laravel Echo</a>, you should specify <code>pusher</code> as your desired broadcaster when instantiating the Echo instance in your <code>resources/js/bootstrap.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">Echo</span> <span class="nx">from</span> <span class="s2">&quot;laravel-echo&quot;</span><span class="p">;</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Pusher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pusher-js&#39;</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span>
<span class="p">});</span>
</pre></div>

<p>Finally, you will need to change your broadcast driver to <code>pusher</code> in your <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">BROADCAST_DRIVER</span><span class="o">=</span><span class="nx">pusher</span>
</pre></div>

<h4>Pusher Compatible Laravel Websockets</h4>

<p>The <a href="https://github.com/beyondcode/laravel-websockets">laravel-websockets</a> is a pure PHP, Pusher compatible websocket package for Laravel. This package allows you to leverage the full power of Laravel broadcasting without an external websocket provider or Node. For more information on installing and using this package, please consult its <a href="https://beyondco.de/docs/laravel-websockets">official documentation</a>.</p>

<h4>Redis</h4>

<p>If you are using the Redis broadcaster, you should either install the phpredis PHP extension via PECL or install the Predis library via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">predis</span><span class="o">/</span><span class="nx">predis</span>
</pre></div>

<p>Next, you should update your broadcast driver to <code>redis</code> in your <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">BROADCAST_DRIVER</span><span class="o">=</span><span class="nx">redis</span>
</pre></div>

<p>The Redis broadcaster will broadcast messages using Redis&#39; pub / sub feature; however, you will need to pair this with a WebSocket server that can receive the messages from Redis and broadcast them to your WebSocket channels.</p>

<p>When the Redis broadcaster publishes an event, it will be published on the event&#39;s specified channel names and the payload will be a JSON encoded string containing the event name, a <code>data</code> payload, and the user that generated the event&#39;s socket ID (if applicable).</p>

<h4>Socket.IO</h4>

<p>If you are going to pair the Redis broadcaster with a Socket.IO server, you will need to include the Socket.IO JavaScript client library in your application. You may install it via the NPM package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">io</span><span class="o">-</span><span class="nx">client</span>
</pre></div>

<p>Next, you will need to instantiate Echo with the <code>socket.io</code> connector and a <code>host</code>.</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">Echo</span> <span class="nx">from</span> <span class="s2">&quot;laravel-echo&quot;</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io-client&#39;</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;socket.io&#39;</span><span class="p">,</span>
    <span class="nx">host</span><span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s1">&#39;:6001&#39;</span>
<span class="p">});</span>
</pre></div>

<p>Finally, you will need to run a compatible Socket.IO server. Laravel does not include a Socket.IO server implementation; however, a community driven Socket.IO server is currently maintained at the <a href="https://github.com/tlaverdure/laravel-echo-server">tlaverdure/laravel-echo-server</a> GitHub repository.</p>

<h4>Queue Prerequisites</h4>

<p>Before broadcasting events, you will also need to configure and run a <a href="/docs/%7B%7Bversion%7D%7D/queues">queue listener</a>. All event broadcasting is done via queued jobs so that the response time of your application is not seriously affected.</p>

<p><a name="concept-overview"></a></p>

<h2>Concept Overview</h2>

<p>Laravel&#39;s event broadcasting allows you to broadcast your server-side Laravel events to your client-side JavaScript application using a driver-based approach to WebSockets. Currently, Laravel ships with <a href="https://pusher.com/channels">Pusher Channels</a> and Redis drivers. The events may be easily consumed on the client-side using the <a href="#installing-laravel-echo">Laravel Echo</a> Javascript package.</p>

<p>Events are broadcast over &quot;channels&quot;, which may be specified as public or private. Any visitor to your application may subscribe to a public channel without any authentication or authorization; however, in order to subscribe to a private channel, a user must be authenticated and authorized to listen on that channel.</p>

<blockquote>
<p>{tip} If you would like to use an open source, PHP driven alternative to Pusher, check out the <a href="https://github.com/beyondcode/laravel-websockets">laravel-websockets</a> package.</p>
</blockquote>

<p><a name="using-example-application"></a></p>

<h3>Using An Example Application</h3>

<p>Before diving into each component of event broadcasting, let&#39;s take a high level overview using an e-commerce store as an example. We won&#39;t discuss the details of configuring <a href="https://pusher.com/channels">Pusher Channels</a> or <a href="#installing-laravel-echo">Laravel Echo</a> since that will be discussed in detail in other sections of this documentation.</p>

<p>In our application, let&#39;s assume we have a page that allows users to view the shipping status for their orders. Let&#39;s also assume that a <code>ShippingStatusUpdated</code> event is fired when a shipping status update is processed by the application:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingStatusUpdated</span><span class="p">(</span><span class="nx">$update</span><span class="p">));</span>
</pre></div>

<h4>The <code>ShouldBroadcast</code> Interface</h4>

<p>When a user is viewing one of their orders, we don&#39;t want them to have to refresh the page to view status updates. Instead, we want to broadcast the updates to the application as they are created. So, we need to mark the <code>ShippingStatusUpdated</code> event with the <code>ShouldBroadcast</code> interface. This will instruct Laravel to broadcast the event when it is fired:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShippingStatusUpdated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Information about the shipping status update.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$update</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The <code>ShouldBroadcast</code> interface requires our event to define a <code>broadcastOn</code> method. This method is responsible for returning the channels that the event should broadcast on. An empty stub of this method is already defined on generated event classes, so we only need to fill in its details. We only want the creator of the order to be able to view status updates, so we will broadcast the event on a private channel that is tied to the order:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the channels the event should broadcast on.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\Broadcasting\PrivateChannel</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastOn</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;order.&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">update</span><span class="o">-&gt;</span><span class="nx">order_id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Authorizing Channels</h4>

<p>Remember, users must be authorized to listen on private channels. We may define our channel authorization rules in the <code>routes/channels.php</code> file. In this example, we need to verify that any user attempting to listen on the private <code>order.1</code> channel is actually the creator of the order:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;order.{orderId}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$orderId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">Order</span><span class="o">::</span><span class="nx">findOrNew</span><span class="p">(</span><span class="nx">$orderId</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user_id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The <code>channel</code> method accepts two arguments: the name of the channel and a callback which returns <code>true</code> or <code>false</code> indicating whether the user is authorized to listen on the channel.</p>

<p>All authorization callbacks receive the currently authenticated user as their first argument and any additional wildcard parameters as their subsequent arguments. In this example, we are using the <code>{orderId}</code> placeholder to indicate that the &quot;ID&quot; portion of the channel name is a wildcard.</p>

<h4>Listening For Event Broadcasts</h4>

<p>Next, all that remains is to listen for the event in our JavaScript application. We can do this using Laravel Echo. First, we&#39;ll use the <code>private</code> method to subscribe to the private channel. Then, we may use the <code>listen</code> method to listen for the <code>ShippingStatusUpdated</code> event. By default, all of the event&#39;s public properties will be included on the broadcast event:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`order.</span><span class="si">${</span><span class="nx">orderId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;ShippingStatusUpdated&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p><a name="defining-broadcast-events"></a></p>

<h2>Defining Broadcast Events</h2>

<p>To inform Laravel that a given event should be broadcast, implement the <code>Illuminate\Contracts\Broadcasting\ShouldBroadcast</code> interface on the event class. This interface is already imported into all event classes generated by the framework so you may easily add it to any of your events.</p>

<p>The <code>ShouldBroadcast</code> interface requires you to implement a single method: <code>broadcastOn</code>. The <code>broadcastOn</code> method should return a channel or array of channels that the event should broadcast on. The channels should be instances of <code>Channel</code>, <code>PrivateChannel</code>, or <code>PresenceChannel</code>. Instances of <code>Channel</code> represent public channels that any user may subscribe to, while <code>PrivateChannels</code> and <code>PresenceChannels</code> represent private channels that require <a href="#authorizing-channels">channel authorization</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServerCreated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the channels the event should broadcast on.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Channel|array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;user.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Then, you only need to <a href="/docs/%7B%7Bversion%7D%7D/events">fire the event</a> as you normally would. Once the event has been fired, a <a href="/docs/%7B%7Bversion%7D%7D/queues">queued job</a> will automatically broadcast the event over your specified broadcast driver.</p>

<p><a name="broadcast-name"></a></p>

<h3>Broadcast Name</h3>

<p>By default, Laravel will broadcast the event using the event&#39;s class name. However, you may customize the broadcast name by defining a <code>broadcastAs</code> method on the event:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event&#39;s broadcast name.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastAs</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;server.created&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you customize the broadcast name using the <code>broadcastAs</code> method, you should make sure to register your listener with a leading <code>.</code> character. This will instruct Echo to not prepend the application&#39;s namespace to the event:</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;.server.created&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">....</span>
<span class="p">});</span>
</pre></div>

<p><a name="broadcast-data"></a></p>

<h3>Broadcast Data</h3>

<p>When an event is broadcast, all of its <code>public</code> properties are automatically serialized and broadcast as the event&#39;s payload, allowing you to access any of its public data from your JavaScript application. So, for example, if your event has a single public <code>$user</code> property that contains an Eloquent model, the event&#39;s broadcast payload would be:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Patrick Stewart&quot;</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>However, if you wish to have more fine-grained control over your broadcast payload, you may add a <code>broadcastWith</code> method to your event. This method should return the array of data that you wish to broadcast as the event payload:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the data to broadcast.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastWith</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="broadcast-queue"></a></p>

<h3>Broadcast Queue</h3>

<p>By default, each broadcast event is placed on the default queue for the default queue connection specified in your <code>queue.php</code> configuration file. You may customize the queue used by the broadcaster by defining a <code>broadcastQueue</code> property on your event class. This property should specify the name of the queue you wish to use when broadcasting:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The name of the queue on which to place the event.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="nx">$broadcastQueue</span> <span class="o">=</span> <span class="s1">&#39;your-queue-name&#39;</span><span class="p">;</span>
</pre></div>

<p>If you want to broadcast your event using the <code>sync</code> queue instead of the default queue driver, you can implement the <code>ShouldBroadcastNow</code> interface instead of <code>ShouldBroadcast</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcastNow</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShippingStatusUpdated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcastNow</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="broadcast-conditions"></a></p>

<h3>Broadcast Conditions</h3>

<p>Sometimes you want to broadcast your event only if a given condition is true. You may define these conditions by adding a <code>broadcastWhen</code> method to your event class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if this event should broadcast.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastWhen</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="authorizing-channels"></a></p>

<h2>Authorizing Channels</h2>

<p>Private channels require you to authorize that the currently authenticated user can actually listen on the channel. This is accomplished by making an HTTP request to your Laravel application with the channel name and allowing your application to determine if the user can listen on that channel. When using <a href="#installing-laravel-echo">Laravel Echo</a>, the HTTP request to authorize subscriptions to private channels will be made automatically; however, you do need to define the proper routes to respond to these requests.</p>

<p><a name="defining-authorization-routes"></a></p>

<h3>Defining Authorization Routes</h3>

<p>Thankfully, Laravel makes it easy to define the routes to respond to channel authorization requests. In the <code>BroadcastServiceProvider</code> included with your Laravel application, you will see a call to the <code>Broadcast::routes</code> method. This method will register the <code>/broadcasting/auth</code> route to handle authorization requests:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>
</pre></div>

<p>The <code>Broadcast::routes</code> method will automatically place its routes within the <code>web</code> middleware group; however, you may pass an array of route attributes to the method if you would like to customize the assigned attributes:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">routes</span><span class="p">(</span><span class="nx">$attributes</span><span class="p">);</span>
</pre></div>

<h4>Customizing The Authorization Endpoint</h4>

<p>By default, Echo will use the <code>/broadcasting/auth</code> endpoint to authorize channel access. However, you may specify your own authorization endpoint by passing the <code>authEndpoint</code> configuration option to your Echo instance:</p>
<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span><span class="p">,</span>
    <span class="nx">authEndpoint</span><span class="o">:</span> <span class="s1">&#39;/custom/endpoint/auth&#39;</span>
<span class="p">});</span>
</pre></div>

<p><a name="defining-authorization-callbacks"></a></p>

<h3>Defining Authorization Callbacks</h3>

<p>Next, we need to define the logic that will actually perform the channel authorization. This is done in the <code>routes/channels.php</code> file that is included with your application. In this file, you may use the <code>Broadcast::channel</code> method to register channel authorization callbacks:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;order.{orderId}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$orderId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">Order</span><span class="o">::</span><span class="nx">findOrNew</span><span class="p">(</span><span class="nx">$orderId</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user_id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The <code>channel</code> method accepts two arguments: the name of the channel and a callback which returns <code>true</code> or <code>false</code> indicating whether the user is authorized to listen on the channel.</p>

<p>All authorization callbacks receive the currently authenticated user as their first argument and any additional wildcard parameters as their subsequent arguments. In this example, we are using the <code>{orderId}</code> placeholder to indicate that the &quot;ID&quot; portion of the channel name is a wildcard.</p>

<h4>Authorization Callback Model Binding</h4>

<p>Just like HTTP routes, channel routes may also take advantage of implicit and explicit <a href="/docs/%7B%7Bversion%7D%7D/routing#route-model-binding">route model binding</a>. For example, instead of receiving the string or numeric order ID, you may request an actual <code>Order</code> model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="p">;</span>

<span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;order.{order}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">Order</span> <span class="nx">$order</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">user_id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>Authorization Callback Authentication</h4>

<p>Private and presence broadcast channels authenticate the current user via your application&#39;s default authentication guard. If the user is not authenticated, channel authorization is automatically denied and the authorization callback is never executed. However, you may assign multiple, custom guards that should authenticate the incoming request if necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">},</span> <span class="p">[</span><span class="s1">&#39;guards&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]]);</span>
</pre></div>

<p><a name="defining-channel-classes"></a></p>

<h3>Defining Channel Classes</h3>

<p>If your application is consuming many different channels, your <code>routes/channels.php</code> file could become bulky. So, instead of using Closures to authorize channels, you may use channel classes. To generate a channel class, use the <code>make:channel</code> Artisan command. This command will place a new channel class in the <code>App/Broadcasting</code> directory.</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">channel</span> <span class="nx">OrderChannel</span>
</pre></div>

<p>Next, register your channel in your <code>routes/channels.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Broadcasting</span><span class="err">\</span><span class="nx">OrderChannel</span><span class="p">;</span>

<span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;order.{order}&#39;</span><span class="p">,</span> <span class="nx">OrderChannel</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>Finally, you may place the authorization logic for your channel in the channel class&#39; <code>join</code> method. This <code>join</code> method will house the same logic you would have typically placed in your channel authorization Closure. You may also take advantage of channel model binding:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Broadcasting</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderChannel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new channel instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Authenticate the user&#39;s access to the channel.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @param  \App\Models\Order  $order</span>
<span class="sd">     * @return array|bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">join</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Like many other classes in Laravel, channel classes will automatically be resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. So, you may type-hint any dependencies required by your channel in its constructor.</p>
</blockquote>

<p><a name="broadcasting-events"></a></p>

<h2>Broadcasting Events</h2>

<p>Once you have defined an event and marked it with the <code>ShouldBroadcast</code> interface, you only need to fire the event using the <code>event</code> function. The event dispatcher will notice that the event is marked with the <code>ShouldBroadcast</code> interface and will queue the event for broadcasting:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingStatusUpdated</span><span class="p">(</span><span class="nx">$update</span><span class="p">));</span>
</pre></div>

<p><a name="only-to-others"></a></p>

<h3>Only To Others</h3>

<p>When building an application that utilizes event broadcasting, you may substitute the <code>event</code> function with the <code>broadcast</code> function. Like the <code>event</code> function, the <code>broadcast</code> function dispatches the event to your server-side listeners:</p>
<div class="highlight"><pre><span></span><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingStatusUpdated</span><span class="p">(</span><span class="nx">$update</span><span class="p">));</span>
</pre></div>

<p>However, the <code>broadcast</code> function also exposes the <code>toOthers</code> method which allows you to exclude the current user from the broadcast&#39;s recipients:</p>
<div class="highlight"><pre><span></span><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingStatusUpdated</span><span class="p">(</span><span class="nx">$update</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">toOthers</span><span class="p">();</span>
</pre></div>

<p>To better understand when you may want to use the <code>toOthers</code> method, let&#39;s imagine a task list application where a user may create a new task by entering a task name. To create a task, your application might make a request to a <code>/task</code> end-point which broadcasts the task&#39;s creation and returns a JSON representation of the new task. When your JavaScript application receives the response from the end-point, it might directly insert the new task into its task list like so:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span> <span class="nx">task</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p>However, remember that we also broadcast the task&#39;s creation. If your JavaScript application is listening for this event in order to add tasks to the task list, you will have duplicate tasks in your list: one from the end-point and one from the broadcast. You may solve this by using the <code>toOthers</code> method to instruct the broadcaster to not broadcast the event to the current user.</p>

<blockquote>
<p>{note} Your event must use the <code>Illuminate\Broadcasting\InteractsWithSockets</code> trait in order to call the <code>toOthers</code> method.</p>
</blockquote>

<h4>Configuration</h4>

<p>When you initialize a Laravel Echo instance, a socket ID is assigned to the connection. If you are using <a href="https://vuejs.org">Vue</a> and <a href="https://github.com/mzabriskie/axios">Axios</a>, the socket ID will automatically be attached to every outgoing request as a <code>X-Socket-ID</code> header. Then, when you call the <code>toOthers</code> method, Laravel will extract the socket ID from the header and instruct the broadcaster to not broadcast to any connections with that socket ID.</p>

<p>If you are not using Vue and Axios, you will need to manually configure your JavaScript application to send the <code>X-Socket-ID</code> header. You may retrieve the socket ID using the <code>Echo.socketId</code> method:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">socketId</span> <span class="o">=</span> <span class="nx">Echo</span><span class="p">.</span><span class="nx">socketId</span><span class="p">();</span>
</pre></div>

<p><a name="receiving-broadcasts"></a></p>

<h2>Receiving Broadcasts</h2>

<p><a name="installing-laravel-echo"></a></p>

<h3>Installing Laravel Echo</h3>

<p>Laravel Echo is a JavaScript library that makes it painless to subscribe to channels and listen for events broadcast by Laravel. You may install Echo via the NPM package manager. In this example, we will also install the <code>pusher-js</code> package since we will be using the Pusher Channels broadcaster:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span> <span class="nx">laravel</span><span class="o">-</span><span class="nx">echo</span> <span class="nx">pusher</span><span class="o">-</span><span class="nx">js</span>
</pre></div>

<p>Once Echo is installed, you are ready to create a fresh Echo instance in your application&#39;s JavaScript. A great place to do this is at the bottom of the <code>resources/js/bootstrap.js</code> file that is included with the Laravel framework:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">Echo</span> <span class="nx">from</span> <span class="s2">&quot;laravel-echo&quot;</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span>
<span class="p">});</span>
</pre></div>

<p>When creating an Echo instance that uses the <code>pusher</code> connector, you may also specify a <code>cluster</code> as well as whether the connection must be made over TLS (by default, when <code>forceTLS</code> is <code>false</code>, a non-TLS connection will be made if the page was loaded over HTTP, or as a fallback if a TLS connection fails):</p>
<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span><span class="p">,</span>
    <span class="nx">cluster</span><span class="o">:</span> <span class="s1">&#39;eu&#39;</span><span class="p">,</span>
    <span class="nx">forceTLS</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</pre></div>

<h4>Using An Existing Client Instance</h4>

<p>If you already have a Pusher Channels or Socket.io client instance that you would like Echo to utilize, you may pass it to Echo via the <code>client</code> configuration option:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pusher-js&#39;</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span><span class="p">,</span>
    <span class="nx">client</span><span class="o">:</span> <span class="nx">client</span>
<span class="p">});</span>
</pre></div>

<p><a name="listening-for-events"></a></p>

<h3>Listening For Events</h3>

<p>Once you have installed and instantiated Echo, you are ready to start listening for event broadcasts. First, use the <code>channel</code> method to retrieve an instance of a channel, then call the <code>listen</code> method to listen for a specified event:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;OrderShipped&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p>If you would like to listen for events on a private channel, use the <code>private</code> method instead. You may continue to chain calls to the <code>listen</code> method to listen for multiple events on a single channel:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(...)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(...)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(...);</span>
</pre></div>

<p><a name="leaving-a-channel"></a></p>

<h3>Leaving A Channel</h3>

<p>To leave a channel, you may call the <code>leaveChannel</code> method on your Echo instance:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">leaveChannel</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">);</span>
</pre></div>

<p>If you would like to leave a channel and also its associated private and presence channels, you may call the <code>leave</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">leave</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="namespaces"></a></p>

<h3>Namespaces</h3>

<p>You may have noticed in the examples above that we did not specify the full namespace for the event classes. This is because Echo will automatically assume the events are located in the <code>App\Events</code> namespace. However, you may configure the root namespace when you instantiate Echo by passing a <code>namespace</code> configuration option:</p>
<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;your-pusher-channels-key&#39;</span><span class="p">,</span>
    <span class="nx">namespace</span><span class="o">:</span> <span class="s1">&#39;App.Other.Namespace&#39;</span>
<span class="p">});</span>
</pre></div>

<p>Alternatively, you may prefix event classes with a <code>.</code> when subscribing to them using Echo. This will allow you to always specify the fully-qualified class name:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;.Namespace\\Event\\Class&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
</pre></div>

<p><a name="presence-channels"></a></p>

<h2>Presence Channels</h2>

<p>Presence channels build on the security of private channels while exposing the additional feature of awareness of who is subscribed to the channel. This makes it easy to build powerful, collaborative application features such as notifying users when another user is viewing the same page.</p>

<p><a name="authorizing-presence-channels"></a></p>

<h3>Authorizing Presence Channels</h3>

<p>All presence channels are also private channels; therefore, users must be <a href="#authorizing-channels">authorized to access them</a>. However, when defining authorization callbacks for presence channels, you will not return <code>true</code> if the user is authorized to join the channel. Instead, you should return an array of data about the user.</p>

<p>The data returned by the authorization callback will be made available to the presence channel event listeners in your JavaScript application. If the user is not authorized to join the presence channel, you should return <code>false</code> or <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;chat.{roomId}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$roomId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">canJoinRoom</span><span class="p">(</span><span class="nx">$roomId</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="joining-presence-channels"></a></p>

<h3>Joining Presence Channels</h3>

<p>To join a presence channel, you may use Echo&#39;s <code>join</code> method. The <code>join</code> method will return a <code>PresenceChannel</code> implementation which, along with exposing the <code>listen</code> method, allows you to subscribe to the <code>here</code>, <code>joining</code>, and <code>leaving</code> events.</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">here</span><span class="p">((</span><span class="nx">users</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">joining</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">leaving</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p>The <code>here</code> callback will be executed immediately once the channel is joined successfully, and will receive an array containing the user information for all of the other users currently subscribed to the channel. The <code>joining</code> method will be executed when a new user joins a channel, while the <code>leaving</code> method will be executed when a user leaves the channel.</p>

<p><a name="broadcasting-to-presence-channels"></a></p>

<h3>Broadcasting To Presence Channels</h3>

<p>Presence channels may receive events just like public or private channels. Using the example of a chatroom, we may want to broadcast <code>NewMessage</code> events to the room&#39;s presence channel. To do so, we&#39;ll return an instance of <code>PresenceChannel</code> from the event&#39;s <code>broadcastOn</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the channels the event should broadcast on.</span>
<span class="cm"> *</span>
<span class="cm"> * @return Channel|array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastOn</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">PresenceChannel</span><span class="p">(</span><span class="s1">&#39;room.&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">message</span><span class="o">-&gt;</span><span class="nx">room_id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Like public or private events, presence channel events may be broadcast using the <code>broadcast</code> function. As with other events, you may use the <code>toOthers</code> method to exclude the current user from receiving the broadcast:</p>
<div class="highlight"><pre><span></span><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">NewMessage</span><span class="p">(</span><span class="nx">$message</span><span class="p">));</span>

<span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">NewMessage</span><span class="p">(</span><span class="nx">$message</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">toOthers</span><span class="p">();</span>
</pre></div>

<p>You may listen for the join event via Echo&#39;s <code>listen</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">here</span><span class="p">(...)</span>
    <span class="p">.</span><span class="nx">joining</span><span class="p">(...)</span>
    <span class="p">.</span><span class="nx">leaving</span><span class="p">(...)</span>
    <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;NewMessage&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
</pre></div>

<p><a name="client-events"></a></p>

<h2>Client Events</h2>

<blockquote>
<p>{tip} When using <a href="https://pusher.com/channels">Pusher Channels</a>, you must enable the &quot;Client Events&quot; option in the &quot;App Settings&quot; section of your <a href="https://dashboard.pusher.com/">application dashboard</a> in order to send client events.</p>
</blockquote>

<p>Sometimes you may wish to broadcast an event to other connected clients without hitting your Laravel application at all. This can be particularly useful for things like &quot;typing&quot; notifications, where you want to alert users of your application that another user is typing a message on a given screen.</p>

<p>To broadcast client events, you may use Echo&#39;s <code>whisper</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">whisper</span><span class="p">(</span><span class="s1">&#39;typing&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span>
    <span class="p">});</span>
</pre></div>

<p>To listen for client events, you may use the <code>listenForWhisper</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">listenForWhisper</span><span class="p">(</span><span class="s1">&#39;typing&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p><a name="notifications"></a></p>

<h2>Notifications</h2>

<p>By pairing event broadcasting with <a href="/docs/%7B%7Bversion%7D%7D/notifications">notifications</a>, your JavaScript application may receive new notifications as they occur without needing to refresh the page. First, be sure to read over the documentation on using <a href="/docs/%7B%7Bversion%7D%7D/notifications#broadcast-notifications">the broadcast notification channel</a>.</p>

<p>Once you have configured a notification to use the broadcast channel, you may listen for the broadcast events using Echo&#39;s <code>notification</code> method. Remember, the channel name should match the class name of the entity receiving the notifications:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`App.User.</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">notification</span><span class="p">((</span><span class="nx">notification</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<p>In this example, all notifications sent to <code>App\Models\User</code> instances via the <code>broadcast</code> channel would be received by the callback. A channel authorization callback for the <code>App.User.{id}</code> channel is included in the default <code>BroadcastServiceProvider</code> that ships with the Laravel framework.</p>
<div style="page-break-after: always;" ></div><h1>Cache</h1>

<ul>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#cache-usage">Cache Usage</a>

<ul>
<li><a href="#obtaining-a-cache-instance">Obtaining A Cache Instance</a></li>
<li><a href="#retrieving-items-from-the-cache">Retrieving Items From The Cache</a></li>
<li><a href="#storing-items-in-the-cache">Storing Items In The Cache</a></li>
<li><a href="#removing-items-from-the-cache">Removing Items From The Cache</a></li>
<li><a href="#the-cache-helper">The Cache Helper</a></li>
</ul></li>
<li><a href="#cache-tags">Cache Tags</a>

<ul>
<li><a href="#storing-tagged-cache-items">Storing Tagged Cache Items</a></li>
<li><a href="#accessing-tagged-cache-items">Accessing Tagged Cache Items</a></li>
<li><a href="#removing-tagged-cache-items">Removing Tagged Cache Items</a></li>
</ul></li>
<li><a href="#atomic-locks">Atomic Locks</a>

<ul>
<li><a href="#lock-driver-prerequisites">Driver Prerequisites</a></li>
<li><a href="#managing-locks">Managing Locks</a></li>
<li><a href="#managing-locks-across-processes">Managing Locks Across Processes</a></li>
</ul></li>
<li><a href="#adding-custom-cache-drivers">Adding Custom Cache Drivers</a>

<ul>
<li><a href="#writing-the-driver">Writing The Driver</a></li>
<li><a href="#registering-the-driver">Registering The Driver</a></li>
</ul></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Laravel provides an expressive, unified API for various caching backends. The cache configuration is located at <code>config/cache.php</code>. In this file you may specify which cache driver you would like to be used by default throughout your application. Laravel supports popular caching backends like <a href="https://memcached.org">Memcached</a> and <a href="https://redis.io">Redis</a> out of the box.</p>

<p>The cache configuration file also contains various other options, which are documented within the file, so make sure to read over these options. By default, Laravel is configured to use the <code>file</code> cache driver, which stores the serialized, cached objects in the filesystem. For larger applications, it is recommended that you use a more robust driver such as Memcached or Redis. You may even configure multiple cache configurations for the same driver.</p>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Database</h4>

<p>When using the <code>database</code> cache driver, you will need to setup a table to contain the cache items. You&#39;ll find an example <code>Schema</code> declaration for the table below:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;expiration&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} You may also use the <code>php artisan cache:table</code> Artisan command to generate a migration with the proper schema.</p>
</blockquote>

<h4>Memcached</h4>

<p>Using the Memcached driver requires the <a href="https://pecl.php.net/package/memcached">Memcached PECL package</a> to be installed. You may list all of your Memcached servers in the <code>config/cache.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">11211</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>You may also set the <code>host</code> option to a UNIX socket path. If you do this, the <code>port</code> option should be set to <code>0</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;memcached&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;/var/run/memcached/memcached.sock&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>Redis</h4>

<p>Before using a Redis cache with Laravel, you will need to either install the PhpRedis PHP extension via PECL or install the <code>predis/predis</code> package (~1.0) via Composer.</p>

<p>For more information on configuring Redis, consult its <a href="/docs/%7B%7Bversion%7D%7D/redis#configuration">Laravel documentation page</a>.</p>

<p><a name="cache-usage"></a></p>

<h2>Cache Usage</h2>

<p><a name="obtaining-a-cache-instance"></a></p>

<h3>Obtaining A Cache Instance</h3>

<p>The <code>Illuminate\Contracts\Cache\Factory</code> and <code>Illuminate\Contracts\Cache\Repository</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contracts</a> provide access to Laravel&#39;s cache services. The <code>Factory</code> contract provides access to all cache drivers defined for your application. The <code>Repository</code> contract is typically an implementation of the default cache driver for your application as specified by your <code>cache</code> configuration file.</p>

<p>However, you may also use the <code>Cache</code> facade, which is what we will use throughout this documentation. The <code>Cache</code> facade provides convenient, terse access to the underlying implementations of the Laravel cache contracts:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all users of the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Accessing Multiple Cache Stores</h4>

<p>Using the <code>Cache</code> facade, you may access various cache stores via the <code>store</code> method. The key passed to the <code>store</code> method should correspond to one of the stores listed in the <code>stores</code> configuration array in your <code>cache</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span> <span class="c1">// 10 Minutes</span>
</pre></div>

<p><a name="retrieving-items-from-the-cache"></a></p>

<h3>Retrieving Items From The Cache</h3>

<p>The <code>get</code> method on the <code>Cache</code> facade is used to retrieve items from the cache. If the item does not exist in the cache, <code>null</code> will be returned. If you wish, you may pass a second argument to the <code>get</code> method specifying the default value you wish to be returned if the item doesn&#39;t exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p>You may even pass a <code>Closure</code> as the default value. The result of the <code>Closure</code> will be returned if the specified item does not exist in the cache. Passing a Closure allows you to defer the retrieval of default values from a database or other external service:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(...)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Checking For Item Existence</h4>

<p>The <code>has</code> method may be used to determine if an item exists in the cache. This method will return <code>false</code> if the value is <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Incrementing / Decrementing Values</h4>

<p>The <code>increment</code> and <code>decrement</code> methods may be used to adjust the value of integer items in the cache. Both of these methods accept an optional second argument indicating the amount by which to increment or decrement the item&#39;s value:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
<span class="nx">Cache</span><span class="o">::</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
<span class="nx">Cache</span><span class="o">::</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$amount</span><span class="p">);</span>
</pre></div>

<h4>Retrieve &amp; Store</h4>

<p>Sometimes you may wish to retrieve an item from the cache, but also store a default value if the requested item doesn&#39;t exist. For example, you may wish to retrieve all users from the cache or, if they don&#39;t exist, retrieve them from the database and add them to the cache. You may do this using the <code>Cache::remember</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If the item does not exist in the cache, the <code>Closure</code> passed to the <code>remember</code> method will be executed and its result will be placed in the cache.</p>

<p>You may use the <code>rememberForever</code> method to retrieve an item from the cache or store it forever:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">rememberForever</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Retrieve &amp; Delete</h4>

<p>If you need to retrieve an item from the cache and then delete the item, you may use the <code>pull</code> method. Like the <code>get</code> method, <code>null</code> will be returned if the item does not exist in the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="storing-items-in-the-cache"></a></p>

<h3>Storing Items In The Cache</h3>

<p>You may use the <code>put</code> method on the <code>Cache</code> facade to store items in the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">);</span>
</pre></div>

<p>If the storage time is not passed to the <code>put</code> method, the item will be stored indefinitely:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<p>Instead of passing the number of seconds as an integer, you may also pass a <code>DateTime</code> instance representing the expiration time of the cached item:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</pre></div>

<h4>Store If Not Present</h4>

<p>The <code>add</code> method will only add the item to the cache if it does not already exist in the cache store. The method will return <code>true</code> if the item is actually added to the cache. Otherwise, the method will return <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">);</span>
</pre></div>

<h4>Storing Items Forever</h4>

<p>The <code>forever</code> method may be used to store an item in the cache permanently. Since these items will not expire, they must be manually removed from the cache using the <code>forget</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forever</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} If you are using the Memcached driver, items that are stored &quot;forever&quot; may be removed when the cache reaches its size limit.</p>
</blockquote>

<p><a name="removing-items-from-the-cache"></a></p>

<h3>Removing Items From The Cache</h3>

<p>You may remove items from the cache using the <code>forget</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also remove items by providing a zero or negative TTL:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may clear the entire cache using the <code>flush</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Flushing the cache does not respect the cache prefix and will remove all entries from the cache. Consider this carefully when clearing a cache which is shared by other applications.</p>
</blockquote>

<p><a name="the-cache-helper"></a></p>

<h3>The Cache Helper</h3>

<p>In addition to using the <code>Cache</code> facade or <a href="/docs/%7B%7Bversion%7D%7D/contracts">cache contract</a>, you may also use the global <code>cache</code> function to retrieve and store data via the cache. When the <code>cache</code> function is called with a single, string argument, it will return the value of the given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>If you provide an array of key / value pairs and an expiration time to the function, it will store values in the cache for the specified duration:</p>
<div class="highlight"><pre><span></span><span class="nx">cache</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="nx">$seconds</span><span class="p">);</span>

<span class="nx">cache</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</pre></div>

<p>When the <code>cache</code> function is called without any arguments, it returns an instance of the <code>Illuminate\Contracts\Cache\Factory</code> implementation, allowing you to call other caching methods:</p>
<div class="highlight"><pre><span></span><span class="nx">cache</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} When testing call to the global <code>cache</code> function, you may use the <code>Cache::shouldReceive</code> method just as if you were <a href="/docs/%7B%7Bversion%7D%7D/mocking#mocking-facades">testing a facade</a>.</p>
</blockquote>

<p><a name="cache-tags"></a></p>

<h2>Cache Tags</h2>

<blockquote>
<p>{note} Cache tags are not supported when using the <code>file</code>, <code>dynamodb</code>, or <code>database</code> cache drivers. Furthermore, when using multiple tags with caches that are stored &quot;forever&quot;, performance will be best with a driver such as <code>memcached</code>, which automatically purges stale records.</p>
</blockquote>

<p><a name="storing-tagged-cache-items"></a></p>

<h3>Storing Tagged Cache Items</h3>

<p>Cache tags allow you to tag related items in the cache and then flush all cached values that have been assigned a given tag. You may access a tagged cache by passing in an ordered array of tag names. For example, let&#39;s access a tagged cache and <code>put</code> value in the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="nx">$john</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">);</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">,</span> <span class="nx">$anne</span><span class="p">,</span> <span class="nx">$seconds</span><span class="p">);</span>
</pre></div>

<p><a name="accessing-tagged-cache-items"></a></p>

<h3>Accessing Tagged Cache Items</h3>

<p>To retrieve a tagged cache item, pass the same ordered list of tags to the <code>tags</code> method and then call the <code>get</code> method with the key you wish to retrieve:</p>
<div class="highlight"><pre><span></span><span class="nx">$john</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;artists&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">);</span>

<span class="nx">$anne</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Anne&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="removing-tagged-cache-items"></a></p>

<h3>Removing Tagged Cache Items</h3>

<p>You may flush all items that are assigned a tag or list of tags. For example, this statement would remove all caches tagged with either <code>people</code>, <code>authors</code>, or both. So, both <code>Anne</code> and <code>John</code> would be removed from the cache:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">([</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p>In contrast, this statement would remove only caches tagged with <code>authors</code>, so <code>Anne</code> would be removed, but not <code>John</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">tags</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p><a name="atomic-locks"></a></p>

<h2>Atomic Locks</h2>

<blockquote>
<p>{note} To utilize this feature, your application must be using the <code>memcached</code>, <code>dynamodb</code>, <code>redis</code>, <code>database</code>, or <code>array</code> cache driver as your application&#39;s default cache driver. In addition, all servers must be communicating with the same central cache server.</p>
</blockquote>

<p><a name="lock-driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Database</h4>

<p>When using the <code>database</code> cache driver, you will need to setup a table to contain the cache locks. You&#39;ll find an example <code>Schema</code> declaration for the table below:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;cache_locks&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">primary</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;expiration&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="managing-locks"></a></p>

<h3>Managing Locks</h3>

<p>Atomic locks allow for the manipulation of distributed locks without worrying about race conditions. For example, <a href="https://forge.laravel.com">Laravel Forge</a> uses atomic locks to ensure that only one remote task is being executed on a server at a time. You may create and manage locks using the <code>Cache::lock</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cache</span><span class="p">;</span>

<span class="nx">$lock</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$lock</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// Lock acquired for 10 seconds...</span>

    <span class="nx">$lock</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>The <code>get</code> method also accepts a Closure. After the Closure is executed, Laravel will automatically release the lock:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Lock acquired indefinitely and automatically released...</span>
<span class="p">});</span>
</pre></div>

<p>If the lock is not available at the moment you request it, you may instruct Laravel to wait for a specified number of seconds. If the lock can not be acquired within the specified time limit, an <code>Illuminate\Contracts\Cache\LockTimeoutException</code> will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Cache</span><span class="err">\</span><span class="nx">LockTimeoutException</span><span class="p">;</span>

<span class="nx">$lock</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">$lock</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

    <span class="c1">// Lock acquired after waiting maximum of 5 seconds...</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">LockTimeoutException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Unable to acquire lock...</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">optional</span><span class="p">(</span><span class="nx">$lock</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Lock acquired after waiting maximum of 5 seconds...</span>
<span class="p">});</span>
</pre></div>

<p><a name="managing-locks-across-processes"></a></p>

<h3>Managing Locks Across Processes</h3>

<p>Sometimes, you may wish to acquire a lock in one process and release it in another process. For example, you may acquire a lock during a web request and wish to release the lock at the end of a queued job that is triggered by that request. In this scenario, you should pass the lock&#39;s scoped &quot;owner token&quot; to the queued job so that the job can re-instantiate the lock using the given token:</p>
<div class="highlight"><pre><span></span><span class="c1">// Within Controller...</span>
<span class="nx">$podcast</span> <span class="o">=</span> <span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>

<span class="nx">$lock</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$result</span> <span class="o">=</span> <span class="nx">$lock</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">,</span> <span class="nx">$lock</span><span class="o">-&gt;</span><span class="nx">owner</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// Within ProcessPodcast Job...</span>
<span class="nx">Cache</span><span class="o">::</span><span class="nx">restoreLock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">owner</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">();</span>
</pre></div>

<p>If you would like to release a lock without respecting its current owner, you may use the <code>forceRelease</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">lock</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">forceRelease</span><span class="p">();</span>
</pre></div>

<p><a name="adding-custom-cache-drivers"></a></p>

<h2>Adding Custom Cache Drivers</h2>

<p><a name="writing-the-driver"></a></p>

<h3>Writing The Driver</h3>

<p>To create our custom cache driver, we first need to implement the <code>Illuminate\Contracts\Cache\Store</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a>. So, a MongoDB cache implementation would look something like this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Extensions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Cache\Store</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MongoStore</span> <span class="k">implements</span> <span class="nx">Store</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">many</span><span class="p">(</span><span class="k">array</span> <span class="nv">$keys</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">put</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$seconds</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">putMany</span><span class="p">(</span><span class="k">array</span> <span class="nv">$values</span><span class="p">,</span> <span class="nv">$seconds</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">increment</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">decrement</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forever</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forget</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPrefix</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>

<p>We just need to implement each of these methods using a MongoDB connection. For an example of how to implement each of these methods, take a look at the <code>Illuminate\Cache\MemcachedStore</code> in the framework source code. Once our implementation is complete, we can finish our custom driver registration.</p>
<div class="highlight"><pre><span></span><span class="nx">Cache</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} If you&#39;re wondering where to put your custom cache driver code, you could create an <code>Extensions</code> namespace within your <code>app</code> directory. However, keep in mind that Laravel does not have a rigid application structure and you are free to organize your application according to your preferences.</p>
</blockquote>

<p><a name="registering-the-driver"></a></p>

<h3>Registering The Driver</h3>

<p>To register the custom cache driver with Laravel, we will use the <code>extend</code> method on the <code>Cache</code> facade. The call to <code>Cache::extend</code> could be done in the <code>boot</code> method of the default <code>App\Providers\AppServiceProvider</code> that ships with fresh Laravel applications, or you may create your own service provider to house the extension - just don&#39;t forget to register the provider in the <code>config/app.php</code> provider array:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Extensions\MongoStore</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">repository</span><span class="p">(</span><span class="k">new</span> <span class="nx">MongoStore</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>extend</code> method is the name of the driver. This will correspond to your <code>driver</code> option in the <code>config/cache.php</code> configuration file. The second argument is a Closure that should return an <code>Illuminate\Cache\Repository</code> instance. The Closure will be passed an <code>$app</code> instance, which is an instance of the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<p>Once your extension is registered, update your <code>config/cache.php</code> configuration file&#39;s <code>driver</code> option to the name of your extension.</p>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>To execute code on every cache operation, you may listen for the <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> fired by the cache. Typically, you should place these event listeners within your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Illuminate\Cache\Events\CacheHit&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogCacheHit&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Cache\Events\CacheMissed&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogCacheMissed&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Cache\Events\KeyForgotten&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogKeyForgotten&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Illuminate\Cache\Events\KeyWritten&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogKeyWritten&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Cashier Paddle</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#upgrading-cashier">Upgrading Cashier</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#billable-model">Billable Model</a></li>
<li><a href="#api-keys">API Keys</a></li>
<li><a href="#paddle-js">Paddle JS</a></li>
<li><a href="#currency-configuration">Currency Configuration</a></li>
</ul></li>
<li><a href="#core-concepts">Core Concepts</a>

<ul>
<li><a href="#pay-links">Pay Links</a></li>
<li><a href="#inline-checkout">Inline Checkout</a></li>
<li><a href="#user-identification">User Identification</a></li>
</ul></li>
<li><a href="#prices">Prices</a></li>
<li><a href="#customers">Customers</a>

<ul>
<li><a href="#customer-defaults">Customer Defaults</a></li>
</ul></li>
<li><a href="#subscriptions">Subscriptions</a>

<ul>
<li><a href="#creating-subscriptions">Creating Subscriptions</a></li>
<li><a href="#checking-subscription-status">Checking Subscription Status</a></li>
<li><a href="#subscription-single-charges">Subscription Single Charges</a></li>
<li><a href="#updating-payment-information">Updating Payment Information</a></li>
<li><a href="#changing-plans">Changing Plans</a></li>
<li><a href="#subscription-quantity">Subscription Quantity</a></li>
<li><a href="#pausing-subscriptions">Pausing Subscriptions</a></li>
<li><a href="#cancelling-subscriptions">Cancelling Subscriptions</a></li>
</ul></li>
<li><a href="#subscription-trials">Subscription Trials</a>

<ul>
<li><a href="#with-payment-method-up-front">With Payment Method Up Front</a></li>
<li><a href="#without-payment-method-up-front">Without Payment Method Up Front</a></li>
</ul></li>
<li><a href="#handling-paddle-webhooks">Handling Paddle Webhooks</a>

<ul>
<li><a href="#defining-webhook-event-handlers">Defining Webhook Event Handlers</a></li>
<li><a href="#handling-failed-subscriptions">Failed Subscriptions</a></li>
<li><a href="#verifying-webhook-signatures">Verifying Webhook Signatures</a></li>
</ul></li>
<li><a href="#single-charges">Single Charges</a>

<ul>
<li><a href="#simple-charge">Simple Charge</a></li>
<li><a href="#charging-products">Charging Products</a></li>
<li><a href="#refunding-orders">Refunding Orders</a></li>
</ul></li>
<li><a href="#receipts">Receipts</a>

<ul>
<li><a href="#past-and-upcoming-payments">Past &amp; Upcoming Payments</a></li>
</ul></li>
<li><a href="#handling-failed-payments">Handling Failed Payments</a></li>
<li><a href="#testing">Testing</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Cashier Paddle provides an expressive, fluent interface to <a href="https://paddle.com">Paddle&#39;s</a> subscription billing services. It handles almost all of the boilerplate subscription billing code you are dreading. In addition to basic subscription management, Cashier can handle: coupons, swapping subscription, subscription &quot;quantities&quot;, cancellation grace periods, and more.</p>

<p>While working with Cashier we recommend you also refer to Paddle&#39;s <a href="https://developer.paddle.com/guides">user guides</a> and <a href="https://developer.paddle.com/api-reference/intro">API documentation</a>.</p>

<p><a name="upgrading-cashier"></a></p>

<h2>Upgrading Cashier</h2>

<p>When upgrading to a new version of Cashier, it&#39;s important that you carefully review <a href="https://github.com/laravel/cashier-paddle/blob/master/UPGRADE.md">the upgrade guide</a>.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>First, require the Cashier package for Paddle with Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">cashier</span><span class="o">-</span><span class="nx">paddle</span>
</pre></div>

<blockquote>
<p>{note} To ensure Cashier properly handles all Paddle events, remember to <a href="#handling-paddle-webhooks">set up Cashier&#39;s webhook handling</a>.</p>
</blockquote>

<h4>Database Migrations</h4>

<p>The Cashier service provider registers its own database migration directory, so remember to migrate your database after installing the package. The Cashier migrations will create a new <code>customers</code> table. In addition, a new <code>subscriptions</code> table will be created to store all of your customer&#39;s subscriptions. Finally, a new <code>receipts</code> table will be created to store all of your receipt information:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>If you need to overwrite the migrations that ship with the Cashier package, you can publish them using the <code>vendor:publish</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="s2">&quot;cashier-migrations&quot;</span>
</pre></div>

<p>If you would like to prevent Cashier&#39;s migrations from running entirely, you may use the <code>ignoreMigrations</code> provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="nx">Cashier</span><span class="o">::</span><span class="nx">ignoreMigrations</span><span class="p">();</span>
</pre></div>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p><a name="billable-model"></a></p>

<h3>Billable Model</h3>

<p>Before using Cashier, you must add the <code>Billable</code> trait to your user model definition. This trait provides various methods to allow you to perform common billing tasks, such as creating subscriptions, applying coupons and updating payment method information:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Billable</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">Billable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you have billable entities that are not users, you may also add the trait to those classes:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Billable</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Team</span> <span class="kr">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">Billable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="api-keys"></a></p>

<h3>API Keys</h3>

<p>Next, you should configure your Paddle keys in your <code>.env</code> file. You can retrieve your Paddle API keys from the Paddle control panel:</p>
<div class="highlight"><pre><span></span><span class="nx">PADDLE_VENDOR_ID</span><span class="o">=</span><span class="nx">your</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">vendor</span><span class="o">-</span><span class="nx">id</span>
<span class="nx">PADDLE_VENDOR_AUTH_CODE</span><span class="o">=</span><span class="nx">your</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">vendor</span><span class="o">-</span><span class="nx">auth</span><span class="o">-</span><span class="nx">code</span>
<span class="nx">PADDLE_PUBLIC_KEY</span><span class="o">=</span><span class="s2">&quot;your-paddle-public-key&quot;</span>
</pre></div>

<p><a name="paddle-js"></a></p>

<h3>Paddle JS</h3>

<p>Paddle relies on its own JavaScript library to initiate the Paddle checkout widget. You can load the JavaScript library by placing the <code>@paddleJS</code> directive right before your application layout&#39;s closing <code>&lt;/head&gt;</code> tag:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="p">...</span>

    <span class="err">@</span><span class="nx">paddleJS</span>
<span class="o">&lt;</span><span class="err">/head&gt;</span>
</pre></div>

<p><a name="currency-configuration"></a></p>

<h3>Currency Configuration</h3>

<p>The default Cashier currency is United States Dollars (USD). You can change the default currency by setting the <code>CASHIER_CURRENCY</code> environment variable:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_CURRENCY</span><span class="o">=</span><span class="nx">EUR</span>
</pre></div>

<p>In addition to configuring Cashier&#39;s currency, you may also specify a locale to be used when formatting money values for display on invoices. Internally, Cashier utilizes <a href="https://www.php.net/manual/en/class.numberformatter.php">PHP&#39;s <code>NumberFormatter</code> class</a> to set the currency locale:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_CURRENCY_LOCALE</span><span class="o">=</span><span class="nx">nl_BE</span>
</pre></div>

<blockquote>
<p>{note} In order to use locales other than <code>en</code>, ensure the <code>ext-intl</code> PHP extension is installed and configured on your server.</p>
</blockquote>

<p><a name="core-concepts"></a></p>

<h2>Core Concepts</h2>

<p><a name="pay-links"></a></p>

<h3>Pay Links</h3>

<p>Paddle lacks an extensive CRUD API to perform state changes. Therefore, most interactions with Paddle are done through <a href="https://developer.paddle.com/guides/how-tos/checkout/paddle-checkout">its checkout widget</a>. Before we can display the checkout widget, we will generate a &quot;pay link&quot; using Cashier:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$premium</span> <span class="o">=</span> <span class="mi">34567</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;payLink&#39;</span> <span class="p">=&gt;</span> <span class="nx">$payLink</span><span class="p">]);</span>
</pre></div>

<p>Cashier includes a <code>paddle-button</code> Blade component. We may pass the pay link URL to this component as a &quot;prop&quot;. When this button is clicked, Paddle&#39;s checkout widget will be displayed:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span><span class="o">&gt;</span>
    <span class="nx">Subscribe</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>By default, this will display a button with the standard Paddle styling. You can remove all Paddle styling by adding the <code>data-theme=&quot;none&quot;</code> attribute to the component:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">theme</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="o">&gt;</span>
    <span class="nx">Subscribe</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>The Paddle checkout widget is asynchronous. Once the user creates or updates a subscription within the widget, Paddle will send our application webhooks so that we may properly update the subscription state in our own database. Therefore, it&#39;s important that you properly <a href="#handling-paddle-webhooks">set up webhooks</a> to accommodate for state changes from Paddle.</p>

<p>After a subscription state change, the delay for receiving the corresponding webhook is typically minimal but you should account for this in your application by considering that your user&#39;s subscription might not be immediately available after completing the checkout.</p>

<p>For more information, you may review <a href="https://developer.paddle.com/api-reference/product-api/pay-links/createpaylink">the Paddle API documentation on pay link generation</a>.</p>

<p><a name="inline-checkout"></a></p>

<h3>Inline Checkout</h3>

<p>If you don&#39;t want to make use of the &quot;overlay&quot; style checkout widget, Paddle also has an option to display the widget inline. While this approach does not allow you to adjust any of the checkout&#39;s HTML fields, it allows you to embed the widget within your application.</p>

<p>To make it easy for you to get started with inline checkout, Cashier includes a <code>paddle-checkout</code> Blade component. To get started, you should <a href="#pay-links">generate a pay link</a> and pass the pay link to the component&#39;s <code>override</code> attribute:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">checkout</span> <span class="o">:</span><span class="nx">override</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;w-full&quot;</span> <span class="o">/&gt;</span>
</pre></div>

<p>To adjust the height of the inline checkout component, you may pass the <code>height</code> attribute to the Blade component:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">checkout</span> <span class="o">:</span><span class="nx">override</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;w-full&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;500&quot;</span> <span class="o">/&gt;</span>
</pre></div>

<h4>Inline Checkout Without Pay Links</h4>

<p>Alternatively, you may customize the widget with custom options instead of using a pay link:</p>
<div class="highlight"><pre><span></span><span class="nx">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="nx">$productId</span><span class="p">,</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Product Title&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">checkout</span> <span class="o">:</span><span class="nx">options</span><span class="o">=</span><span class="s2">&quot;$options&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;w-full&quot;</span> <span class="o">/&gt;</span>
</pre></div>

<p>Please consult Paddle&#39;s <a href="https://developer.paddle.com/guides/how-tos/checkout/inline-checkout">guide on Inline Checkout</a> as well as their <a href="https://developer.paddle.com/reference/paddle-js/parameters">Parameter Reference</a> for further details on available options.</p>

<blockquote>
<p>{note} If you would like to also use the <code>passthrough</code> option when specifying custom options, you should provide a key / value array since Cashier will automatically handle converting the array to a JSON string. In addition, the <code>customer_id</code> passthrough option is reserved for internal Cashier usage.</p>
</blockquote>

<p><a name="user-identification"></a></p>

<h3>User Identification</h3>

<p>In contrast to Stripe, Paddle users are unique across the whole of Paddle, not unique per Paddle account. Because of this, Paddle&#39;s API&#39;s do not currently provide a method to update a user&#39;s details such as their email address. When generating pay links, Paddle identifies users using the <code>customer_email</code> parameter. When creating a subscription, Paddle will try to match the user provided email to an existing Paddle user.</p>

<p>In light of this behavior, there are some important things to keep in mind when using Cashier and Paddle. First, you should be aware that even though subscriptions in Cashier are tied to the same application user, <strong>they could be tied to different users within Paddle&#39;s internal systems</strong>. Secondly, each subscription has its own connected payment method information and could also have different email addresses within Paddle&#39;s internal systems (depending on which email was assigned to the user when the subscription was created).</p>

<p>Therefore, when displaying subscriptions you should always inform the user which email address or payment method information is connected to the subscription on a per-subscription basis. Retrieving this information can be done with the following methods on the <code>Subscription</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$subscription</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$customerEmailAddress</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">paddleEmail</span><span class="p">();</span>
<span class="nx">$paymentMethod</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">paymentMethod</span><span class="p">();</span>
<span class="nx">$cardBrand</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">cardBrand</span><span class="p">();</span>
<span class="nx">$cardLastFour</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">cardLastFour</span><span class="p">();</span>
<span class="nx">$cardExpirationDate</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">cardExpirationDate</span><span class="p">();</span>
</pre></div>

<p>There is currently no way to modify a user&#39;s email address through the Paddle API. When a user wants to update their email address within Paddle, the only way for them to do so is to contact Paddle customer support. When communicating with Paddle, they need to provide the <code>paddleEmail</code> value of the subscription to assist Paddle in updating the correct user.</p>

<p><a name="prices"></a></p>

<h2>Prices</h2>

<p>Paddle allows you to customize prices per currency, essentially allowing you to configure different prices for different countries. Cashier Paddle allows you to retrieve all of the prices for a given product using the <code>productPrices</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="c1">// Retrieve prices for two products...</span>
<span class="nx">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="nx">productPrices</span><span class="p">([</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">]);</span>
</pre></div>

<p>The currency will be determined based on the IP address of the request; however, you may optionally provide a specific country to retrieve prices for:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="c1">// Retrieve prices for two products...</span>
<span class="nx">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="nx">productPrices</span><span class="p">([</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;customer_country&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;BE&#39;</span><span class="p">]);</span>
</pre></div>

<p>After retrieving the prices you may display them however you wish:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$prices</span> <span class="nx">as</span> <span class="nx">$price</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">product_title</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">price</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">gross</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<p>You may also display the net price (excludes tax) and display the tax amount separately:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$prices</span> <span class="nx">as</span> <span class="nx">$price</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">product_title</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">price</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">net</span><span class="p">()</span> <span class="p">}}</span> <span class="p">(</span><span class="o">+</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">price</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">tax</span><span class="p">()</span> <span class="p">}}</span> <span class="nx">tax</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<p>If you retrieved prices for subscription plans you can display their initial and recurring price separately:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$prices</span> <span class="nx">as</span> <span class="nx">$price</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">product_title</span> <span class="p">}}</span> <span class="o">-</span> <span class="nx">Initial</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">initialPrice</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">gross</span><span class="p">()</span> <span class="p">}}</span> <span class="o">-</span> <span class="nx">Recurring</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">recurringPrice</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">gross</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<p>For more information, <a href="https://developer.paddle.com/api-reference/checkout-api/prices/getprices">check Paddle&#39;s API documentation on prices</a>.</p>

<h4>Customers</h4>

<p>If a user is already a customer and you would like to display the prices that apply to that customer, you may do so by retrieving the prices directly from the customer instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="c1">// Retrieve prices for two products...</span>
<span class="nx">$prices</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">productPrices</span><span class="p">([</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">]);</span>
</pre></div>

<p>Internally, Cashier will use the user&#39;s <a href="#customer-defaults"><code>paddleCountry</code> method</a> to retrieve the prices in their currency. So, for example, a user living in the United States will see prices in USD while a user in Belgium will see prices in EUR. If no matching currency can be found the default currency of the product will be used. You can customize all prices of a product or subscription plan in the Paddle control panel.</p>

<h4>Coupons</h4>

<p>You may also choose to display prices after a coupon reduction. When calling the <code>productPrices</code> method, coupons may be passed as a comma delimited string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="nx">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="nx">productPrices</span><span class="p">([</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;coupons&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;SUMMERSALE,20PERCENTOFF&#39;</span><span class="p">]);</span>
</pre></div>

<p>Then, display the calculated prices using the <code>price</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$prices</span> <span class="nx">as</span> <span class="nx">$price</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">product_title</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">price</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">gross</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<p>You may display the original listed prices (without coupon discounts) using the <code>listPrice</code> method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$prices</span> <span class="nx">as</span> <span class="nx">$price</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">product_title</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="nx">$price</span><span class="o">-&gt;</span><span class="nx">listPrice</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">gross</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/ul&gt;</span>
</pre></div>

<blockquote>
<p>{note} When using the prices API, Paddle only allows to apply coupons to one-time purchase products and not to subscription plans.</p>
</blockquote>

<p><a name="customers"></a></p>

<h2>Customers</h2>

<p><a name="customer-defaults"></a></p>

<h3>Customer Defaults</h3>

<p>Cashier allows you to set some useful defaults for your customer when creating pay links. Setting these defaults allow you to pre-fill a customer&#39;s email address, country, and postcode so that they can immediately move on to the payment portion of the checkout widget. You can set these defaults by overriding the following methods on your billable user:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the customer&#39;s email address to associate with Paddle.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string|null</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">paddleEmail</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Get the customer&#39;s country to associate with Paddle.</span>
<span class="cm"> *</span>
<span class="cm"> * This needs to be a 2 letter code. See the link below for supported countries.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string|null</span>
<span class="cm"> * @link https://developer.paddle.com/reference/platform-parameters/supported-countries</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">paddleCountry</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Get the customer&#39;s postcode to associate with Paddle.</span>
<span class="cm"> *</span>
<span class="cm"> * See the link below for countries which require this.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string|null</span>
<span class="cm"> * @link https://developer.paddle.com/reference/platform-parameters/supported-countries#countries-requiring-postcode</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">paddlePostcode</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>These defaults will be used for every action in Cashier that generates a <a href="#pay-links">pay link</a>.</p>

<p><a name="subscriptions"></a></p>

<h2>Subscriptions</h2>

<p><a name="creating-subscriptions"></a></p>

<h3>Creating Subscriptions</h3>

<p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of <code>App\Models\User</code>. Once you have retrieved the model instance, you may use the <code>newSubscription</code> method to create the model&#39;s subscription pay link:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$premium</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;payLink&#39;</span> <span class="p">=&gt;</span> <span class="nx">$payLink</span><span class="p">]);</span>
</pre></div>

<p>The first argument passed to the <code>newSubscription</code> method should be the name of the subscription. If your application only offers a single subscription, you might call this <code>default</code> or <code>primary</code>. The second argument is the specific plan the user is subscribing to. This value should correspond to the plan&#39;s identifier in Paddle. The <code>returnTo</code> method accepts a URL that your user will be redirected to after they successfully complete the checkout.</p>

<p>The <code>create</code> method will create a pay link which you can use to generate a payment button. The payment button can be generated using the <code>paddle-button</code> Blade component that ships with Cashier Paddle:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span><span class="o">&gt;</span>
    <span class="nx">Subscribe</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>After the user has finished their checkout, a <code>subscription_created</code> webhook will be dispatched from Paddle. Cashier will receive this webhook and setup the subscription for your customer. In order to make sure all webhooks are properly received and handled by your application, ensure you have properly <a href="#handling-paddle-webhooks">setup webhook handling</a>.</p>

<h4>Additional Details</h4>

<p>If you would like to specify additional customer or subscription details, you may do so by passing them as a key / value array to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
        <span class="s1">&#39;vat_number&#39;</span> <span class="p">=&gt;</span> <span class="nx">$vatNumber</span><span class="p">,</span>
    <span class="p">]);</span>
</pre></div>

<p>To learn more about the additional fields supported by Paddle, check out Paddle&#39;s documentation on <a href="https://developer.paddle.com/api-reference/product-api/pay-links/createpaylink">generating pay links</a>.</p>

<h4>Coupons</h4>

<p>If you would like to apply a coupon when creating the subscription, you may use the <code>withCoupon</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">withCoupon</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Metadata</h4>

<p>You can also pass an array of metadata using the <code>withMetadata</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">withMetadata</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} When providing metadata, please avoid using <code>subscription_name</code> as a metadata key. This key is reserved for internal use by Cashier.</p>
</blockquote>

<p><a name="checking-subscription-status"></a></p>

<h3>Checking Subscription Status</h3>

<p>Once a user is subscribed to your application, you may check their subscription status using a variety of convenient methods. First, the <code>subscribed</code> method returns <code>true</code> if the user has an active subscription, even if the subscription is currently within its trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribed</code> method also makes a great candidate for a <a href="/docs/%7B%7Bversion%7D%7D/middleware">route middleware</a>, allowing you to filter access to routes and controllers based on the user&#39;s subscription status:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subscribed</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// This user is not a paying customer...</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for displaying a warning to the user that they are still on their trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>subscribedToPlan</code> method may be used to determine if the user is subscribed to a given plan based on a given Paddle plan ID. In this example, we will determine if the user&#39;s <code>default</code> subscription is actively subscribed to the monthly plan:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribedToPlan</span><span class="p">(</span><span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>By passing an array to the <code>subscribedToPlan</code> method, you may determine if the user&#39;s <code>default</code> subscription is actively subscribed to the monthly or the yearly plan:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscribedToPlan</span><span class="p">([</span><span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">,</span> <span class="nx">$yearly</span> <span class="o">=</span> <span class="mi">54321</span><span class="p">],</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>recurring</code> method may be used to determine if the user is currently subscribed and is no longer within their trial period:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">recurring</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Cancelled Subscription Status</h4>

<p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if the user has cancelled their subscription and is no longer within their &quot;grace period&quot;, you may use the <code>ended</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ended</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Subscription Scopes</h4>

<p>Most subscription states are also available as query scopes so that you may easily query your database for subscriptions that are in a given state:</p>
<div class="highlight"><pre><span></span><span class="c1">// Get all active subscriptions...</span>
<span class="nx">$subscriptions</span> <span class="o">=</span> <span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Get all of the cancelled subscriptions for a user...</span>
<span class="nx">$subscriptions</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscriptions</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>A complete list of available scopes is available below:</p>
<div class="highlight"><pre><span></span><span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notOnTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pastDue</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">recurring</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">ended</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">paused</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notPaused</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onPausedGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notOnPausedGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notCancelled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">notOnGracePeriod</span><span class="p">();</span>
</pre></div>

<h4>Past Due Status</h4>

<p>If a payment fails for a subscription, it will be marked as <code>past_due</code>. When your subscription is in this state it will not be active until the customer has updated their payment information. You may determine if a subscription is past due using the <code>pastDue</code> method on the subscription instance:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pastDue</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>When a subscription is past due, you should instruct the user to <a href="#updating-payment-information">update their payment information</a>. You may configure how past due subscriptions are handled in your <a href="https://vendors.paddle.com/subscription-settings">Paddle subscription settings</a>.</p>

<p>If you would like subscriptions to still be considered active when they are <code>past_due</code>, you may use the <code>keepPastDueSubscriptionsActive</code> method provided by Cashier. Typically, this method should be called in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Paddle</span><span class="err">\</span><span class="nx">Cashier</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Cashier</span><span class="o">::</span><span class="nx">keepPastDueSubscriptionsActive</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} When a subscription is in a <code>past_due</code> state it cannot be changed until payment information has been updated. Therefore, the <code>swap</code> and <code>updateQuantity</code> methods will throw an exception when the subscription is in a <code>past_due</code> state.</p>
</blockquote>

<p><a name="subscription-single-charges"></a></p>

<h3>Subscription Single Charges</h3>

<p>Subscription single charges allow you to charge subscribers with a one-time charge on top of their subscriptions:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mf">12.99</span><span class="p">,</span> <span class="s1">&#39;Support Add-on&#39;</span><span class="p">);</span>
</pre></div>

<p>In contrast to <a href="#single-charges">single charges</a>, this method will immediately charge the customer&#39;s stored payment method for the subscription. The charge amount is always in the currency of which the subscription currently is set to.</p>

<p><a name="updating-payment-information"></a></p>

<h3>Updating Payment Information</h3>

<p>Paddle always saves a payment method per subscription. If you want to update the default payment method for a subscription, you should first generate a subscription &quot;update URL&quot; using the <code>updateUrl</code> method on the subscription model:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$updateUrl</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">updateUrl</span><span class="p">();</span>
</pre></div>

<p>Then, you may use the generated URL in combination with Cashier&#39;s provided <code>paddle-button</code> Blade component to allow the user to initiate the Paddle widget and update their payment information:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$updateUrl&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span><span class="o">&gt;</span>
    <span class="nx">Update</span> <span class="nx">Card</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>When a user has finished updating their information, a <code>subscription_updated</code> webhook will be dispatched by Paddle and the subscription details will be updated in your application&#39;s database.</p>

<p><a name="changing-plans"></a></p>

<h3>Changing Plans</h3>

<p>After a user has subscribed to your application, they may occasionally want to change to a new subscription plan. To swap a user to a new subscription, you should pass the Paddle plan&#39;s identifier to the subscription&#39;s <code>swap</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="nx">$premium</span> <span class="o">=</span> <span class="mi">34567</span><span class="p">);</span>
</pre></div>

<p>If the user is on trial, the trial period will be maintained. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p>

<p>If you would like to swap plans and cancel any trial period the user is currently on, you may use the <code>skipTrial</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">skipTrial</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="nx">$premium</span> <span class="o">=</span> <span class="mi">34567</span><span class="p">);</span>
</pre></div>

<p>If you would like to swap plans and immediately invoice the user instead of waiting for their next billing cycle, you may use the <code>swapAndInvoice</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">swapAndInvoice</span><span class="p">(</span><span class="nx">$premium</span> <span class="o">=</span> <span class="mi">34567</span><span class="p">);</span>
</pre></div>

<h4>Prorations</h4>

<p>By default, Paddle prorates charges when swapping between plans. The <code>noProrate</code> method may be used to update the subscription&#39;s without prorating the charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">swap</span><span class="p">(</span><span class="nx">$premium</span> <span class="o">=</span> <span class="mi">34567</span><span class="p">);</span>
</pre></div>

<p><a name="subscription-quantity"></a></p>

<h3>Subscription Quantity</h3>

<p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge $10 per month <strong>per user</strong> on an account. To easily increment or decrement your subscription quantity, use the <code>incrementQuantity</code> and <code>decrementQuantity</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">incrementQuantity</span><span class="p">();</span>

<span class="c1">// Add five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">incrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrementQuantity</span><span class="p">();</span>

<span class="c1">// Subtract five to the subscription&#39;s current quantity...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may set a specific quantity using the <code>updateQuantity</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>The <code>noProrate</code> method may be used to update the subscription&#39;s quantity without prorating the charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p><a name="pausing-subscriptions"></a></p>

<h3>Pausing Subscriptions</h3>

<p>To pause a subscription, call the <code>pause</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pause</span><span class="p">();</span>
</pre></div>

<p>When a subscription is paused, Cashier will automatically set the <code>paused_from</code> column in your database. This column is used to know when the <code>paused</code> method should begin returning <code>true</code>. For example, if a customer pauses a subscription on March 1st, but the subscription was not scheduled to recur until March 5th, the <code>paused</code> method will continue to return <code>false</code> until March 5th.</p>

<p>You may determine if a user has paused their subscription but are still on their &quot;grace period&quot; using the <code>onPausedGracePeriod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onPausedGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To resume a paused a subscription, you may call the <code>unpause</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unpause</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} A subscription cannot be modified while it is paused. If you want to swap to a different plan or update quantities you must resume the subscription first.</p>
</blockquote>

<p><a name="cancelling-subscriptions"></a></p>

<h3>Cancelling Subscriptions</h3>

<p>To cancel a subscription, call the <code>cancel</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
</pre></div>

<p>When a subscription is cancelled, Cashier will automatically set the <code>ends_at</code> column in your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p>

<p>You may determine if a user has cancelled their subscription but are still on their &quot;grace period&quot; using the <code>onGracePeriod</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you wish to cancel a subscription immediately, you may call the <code>cancelNow</code> method on the user&#39;s subscription:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cancelNow</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Paddle&#39;s subscriptions cannot be resumed after cancellation. If your customer wishes to resume their subscription, they will have to subscribe to a new subscription.</p>
</blockquote>

<p><a name="subscription-trials"></a></p>

<h2>Subscription Trials</h2>

<p><a name="with-payment-method-up-front"></a></p>

<h3>With Payment Method Up Front</h3>

<blockquote>
<p>{note} While trialing and collecting payment method details up front, Paddle prevents any subscription changes such as swapping plans or updating quantities. If you want to allow a customer to swap plans during a trial the subscription must be cancelled and recreated.</p>
</blockquote>

<p>If you would like to offer trial periods to your customers while still collecting payment method information up front, you should use the <code>trialDays</code> method when creating your subscription pay links:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nx">trialDays</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;payLink&#39;</span> <span class="p">=&gt;</span> <span class="nx">$payLink</span><span class="p">]);</span>
</pre></div>

<p>This method will set the trial period ending date on the subscription record within the database, as well as instruct Paddle to not begin billing the customer until after this date.</p>

<blockquote>
<p>{note} If the customer&#39;s subscription is not cancelled before the trial ending date they will be charged as soon as the trial expires, so you should be sure to notify your users of their trial ending date.</p>
</blockquote>

<p>You may determine if the user is within their trial period using either the <code>onTrial</code> method of the user instance or the <code>onTrial</code> method of the subscription instance. The two examples below have identical behavior:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Defining Trial Days In Paddle / Cashier</h4>

<p>You may choose to define how many trial days your plan&#39;s receive in the Paddle dashboard or always pass them explicitly using Cashier. If you choose to define your plan&#39;s trial days in Paddle you should be aware that new subscriptions, including new subscriptions for a customer that had a subscription in the past, will always receive a trial period unless you explicitly call the <code>trialDays(0)</code> method.</p>

<p><a name="without-payment-method-up-front"></a></p>

<h3>Without Payment Method Up Front</h3>

<p>If you would like to offer trial periods without collecting the user&#39;s payment method information up front, you may set the <code>trial_ends_at</code> column on the customer record attached to your user to your desired trial ending date. This is typically done during user registration:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span>
    <span class="c1">// Other user properties...</span>
<span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createAsCustomer</span><span class="p">([</span>
    <span class="s1">&#39;trial_ends_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]);</span>
</pre></div>

<p>Cashier refers to this type of trial as a &quot;generic trial&quot;, since it is not attached to any existing subscription. The <code>onTrial</code> method on the <code>User</code> instance will return <code>true</code> if the current date is not past the value of <code>trial_ends_at</code>:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// User is within their trial period...</span>
<span class="p">}</span>
</pre></div>

<p>You may also use the <code>onGenericTrial</code> method if you wish to know specifically that the user is within their &quot;generic&quot; trial period and has not created an actual subscription yet:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">onGenericTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// User is within their &quot;generic&quot; trial period...</span>
<span class="p">}</span>
</pre></div>

<p>Once you are ready to create an actual subscription for the user, you may use the <code>newSubscription</code> method as usual:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">newSubscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">$monthly</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} There is no way to extend or modify a trial period on a Paddle subscription after it has been created.</p>
</blockquote>

<p><a name="handling-paddle-webhooks"></a></p>

<h2>Handling Paddle Webhooks</h2>

<blockquote>
<p>{tip} You may use <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/valet#sharing-sites">Valet&#39;s <code>share</code> command</a> to help test webhooks during local development.</p>
</blockquote>

<p>Paddle can notify your application of a variety of events via webhooks. By default, a route that points to Cashier&#39;s webhook controller is configured through the Cashier service provider. This controller will handle all incoming webhook requests.</p>

<p>By default, this controller will automatically handle cancelling subscriptions that have too many failed charges (<a href="https://vendors.paddle.com/subscription-settings">as defined by your Paddle subscription settings</a>), subscription updates, and payment method changes; however, as we&#39;ll soon discover, you can extend this controller to handle any webhook event you like.</p>

<p>To ensure your application can handle Paddle webhooks, be sure to <a href="https://vendors.paddle.com/alerts-webhooks">configure the webhook URL in the Paddle control panel</a>. By default, Cashier&#39;s webhook controller listens to the <code>/paddle/webhook</code> URL path. The full list of all webhooks you should configure in the Paddle control panel are:</p>

<ul>
<li>Subscription Created</li>
<li>Subscription Updated</li>
<li>Subscription Deleted</li>
<li>Payment Succeeded</li>
<li>Subscription Payment Succeeded</li>
</ul>

<blockquote>
<p>{note} Make sure you protect incoming requests with Cashier&#39;s included <a href="/docs/%7B%7Bversion%7D%7D/cashier-paddle#verifying-webhook-signatures">webhook signature verification</a> middleware.</p>
</blockquote>

<h4>Webhooks &amp; CSRF Protection</h4>

<p>Since Paddle webhooks need to bypass Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/csrf">CSRF protection</a>, be sure to list the URI as an exception in your <code>VerifyCsrfToken</code> middleware or list the route outside of the <code>web</code> middleware group:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$except</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;paddle/*&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="defining-webhook-event-handlers"></a></p>

<h3>Defining Webhook Event Handlers</h3>

<p>Cashier automatically handles subscription cancellation on failed charges, but if you have additional webhook events you would like to handle, you should extend the <code>WebhookController</code>. Your method names should correspond to Cashier&#39;s expected convention, specifically, methods should be prefixed with <code>handle</code> and the &quot;camel case&quot; name of the webhook you wish to handle. For example, if you wish to handle the <code>payment_succeeded</code> webhook, you should add a <code>handlePaymentSucceeded</code> method to the controller:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Paddle\Http\Controllers\WebhookController</span> <span class="k">as</span> <span class="nx">CashierController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WebhookController</span> <span class="k">extends</span> <span class="nx">CashierController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle payment succeeded.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $payload</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handlePaymentSucceeded</span><span class="p">(</span><span class="nv">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle The Event</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Next, define a route to your Cashier controller within your <code>routes/web.php</code> file. This will overwrite the route included with Cashier:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">WebhookController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;paddle/webhook&#39;</span><span class="p">,</span> <span class="nx">WebhookController</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>Cashier emits a <code>Laravel\Paddle\Events\WebhookReceived</code> event when a webhook is received and a <code>Laravel\Paddle\Events\WebhookHandled</code> event when a webhook was handled. Both events contain the full payload of the Paddle webhook.</p>

<p>Cashier also emit events dedicated to the type of the received webhook. In addition to the full payload from Paddle, they also contain the relevant models that were used to process the webhook such as the billable model, the subscription, or the receipt:</p>

<div class="content-list" markdown="1">
- `PaymentSucceeded`
- `SubscriptionPaymentSucceeded`
- `SubscriptionCreated`
- `SubscriptionUpdated`
- `SubscriptionCancelled`
</div>

<p>You can optionally also override the default, built-in webhook route by setting the <code>CASHIER_WEBHOOK</code> env variable in your <code>.env</code> file. This value should be the full URL to your webhook route and needs to match the URL set in your Paddle control panel:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_WEBHOOK</span><span class="o">=</span><span class="nx">https</span><span class="o">:</span><span class="c1">//example.com/my-paddle-webhook-url</span>
</pre></div>

<p><a name="handling-failed-subscriptions"></a></p>

<h3>Failed Subscriptions</h3>

<p>What if a customer&#39;s credit card expires? No worries - Cashier&#39;s Webhook controller will cancel the customer&#39;s subscription for you. Failed payments will automatically be captured and handled by the controller. The controller will cancel the customer&#39;s subscription when Paddle determines the subscription has failed (normally after three failed payment attempts).</p>

<p><a name="verifying-webhook-signatures"></a></p>

<h3>Verifying Webhook Signatures</h3>

<p>To secure your webhooks, you may use <a href="https://developer.paddle.com/webhook-reference/verifying-webhooks">Paddle&#39;s webhook signatures</a>. For convenience, Cashier automatically includes a middleware which validates that the incoming Paddle webhook request is valid.</p>

<p>To enable webhook verification, ensure that the <code>PADDLE_PUBLIC_KEY</code> environment variable is set in your <code>.env</code> file. The public key may be retrieved from your Paddle account dashboard.</p>

<p><a name="single-charges"></a></p>

<h2>Single Charges</h2>

<p><a name="simple-charge"></a></p>

<h3>Simple Charge</h3>

<p>If you would like to make a &quot;one off&quot; charge against a customer, you may use the <code>charge</code> method on a billable model instance to generate a pay link for the charge. The <code>charge</code> method accepts the charge amount (float) as its first argument and a charge description as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mf">12.99</span><span class="p">,</span> <span class="s1">&#39;Product Title&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;pay&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;payLink&#39;</span> <span class="p">=&gt;</span> <span class="nx">$payLink</span><span class="p">]);</span>
</pre></div>

<p>After generating the pay link, you may use Cashier&#39;s provided <code>paddle-button</code> Blade component to allow the user to initiate the Paddle widget and complete the charge:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span><span class="o">&gt;</span>
    <span class="nx">Buy</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>The <code>charge</code> method accepts an array as its third argument, allowing you to pass any options you wish to the underlying Paddle pay link creation. Please consult <a href="https://developer.paddle.com/api-reference/product-api/pay-links/createpaylink">the Paddle documentation</a> to learn more about the options available to you when creating charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">(</span><span class="mf">12.99</span><span class="p">,</span> <span class="s1">&#39;Product Title&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;custom_option&#39;</span> <span class="p">=&gt;</span> <span class="nx">$value</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Charges happen in the currency specified in the <code>cashier.currency</code> configuration option. By default, this is set to USD. You may override the default currency by setting the <code>CASHIER_CURRENCY</code> in your <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">CASHIER_CURRENCY</span><span class="o">=</span><span class="nx">EUR</span>
</pre></div>

<p>You can also <a href="https://developer.paddle.com/api-reference/product-api/pay-links/createpaylink#price-overrides">override prices per currency</a> using Paddle&#39;s dynamic pricing matching system. To do so, pass an array of prices instead of a fixed amount:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">charge</span><span class="p">([</span>
    <span class="s1">&#39;USD:19.99&#39;</span><span class="p">,</span>
    <span class="s1">&#39;EUR:15.99&#39;</span><span class="p">,</span>
<span class="p">],</span> <span class="s1">&#39;Product Title&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="charging-products"></a></p>

<h3>Charging Products</h3>

<p>If you would like to make a &quot;one off&quot; charge against a specific product configured within Paddle, you may use the <code>chargeProduct</code> method on a billable model instance to generate a pay link:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">chargeProduct</span><span class="p">(</span><span class="nx">$productId</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;pay&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;payLink&#39;</span> <span class="p">=&gt;</span> <span class="nx">$payLink</span><span class="p">]);</span>
</pre></div>

<p>Then, you may provide the pay link to the <code>paddle-button</code> component to allow the user to initialize the Paddle widget:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">paddle</span><span class="o">-</span><span class="nx">button</span> <span class="o">:</span><span class="nx">url</span><span class="o">=</span><span class="s2">&quot;$payLink&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;px-8 py-4&quot;</span><span class="o">&gt;</span>
    <span class="nx">Buy</span>
<span class="o">&lt;</span><span class="err">/x-paddle-button&gt;</span>
</pre></div>

<p>The <code>chargeProduct</code> method accepts an array as its second argument, allowing you to pass any options you wish to the underlying Paddle pay link creation. Please consult <a href="https://developer.paddle.com/api-reference/product-api/pay-links/createpaylink">the Paddle documentation</a> regarding the options that are available to you when creating charges:</p>
<div class="highlight"><pre><span></span><span class="nx">$payLink</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">chargeProduct</span><span class="p">(</span><span class="nx">$productId</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;custom_option&#39;</span> <span class="p">=&gt;</span> <span class="nx">$value</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="refunding-orders"></a></p>

<h3>Refunding Orders</h3>

<p>If you need to refund a Paddle order, you may use the <code>refund</code> method. This method accepts the Paddle Order ID as its first argument. You may retrieve receipts for a given billable entity using the <code>receipts</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$receipt</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">receipts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$refundRequestId</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">refund</span><span class="p">(</span><span class="nx">$receipt</span><span class="o">-&gt;</span><span class="nx">order_id</span><span class="p">);</span>
</pre></div>

<p>You may also optionally specify a specific amount to refund as well as a reason for the refund:</p>
<div class="highlight"><pre><span></span><span class="nx">$receipt</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">receipts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$refundRequestId</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">refund</span><span class="p">(</span>
    <span class="nx">$receipt</span><span class="o">-&gt;</span><span class="nx">order_id</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="s1">&#39;Unused product time&#39;</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} You can use the <code>$refundRequestId</code> as a reference for the refund when contacting Paddle support.</p>
</blockquote>

<p><a name="receipts"></a></p>

<h2>Receipts</h2>

<p>You may easily retrieve an array of a billable model&#39;s receipts using the <code>receipts</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$receipts</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">receipts</span><span class="p">();</span>
</pre></div>

<p>When listing the receipts for the customer, you may use the receipt&#39;s helper methods to display the relevant receipt information. For example, you may wish to list every receipt in a table, allowing the user to easily download any of the receipts:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$receipts</span> <span class="nx">as</span> <span class="nx">$receipt</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$receipt</span><span class="o">-&gt;</span><span class="nx">paid_at</span><span class="o">-&gt;</span><span class="nx">toFormattedDateString</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$receipt</span><span class="o">-&gt;</span><span class="nx">amount</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;{{ $receipt-&gt;receipt_url }}&quot;</span> <span class="nx">target</span><span class="o">=</span><span class="s2">&quot;_blank&quot;</span><span class="o">&gt;</span><span class="nx">Download</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/td&gt;</span>
        <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>
</pre></div>

<p><a name="past-and-upcoming-payments"></a></p>

<h3>Past &amp; Upcoming Payments</h3>

<p>You may use the <code>lastPayment</code> and <code>nextPayment</code> methods to display a customer&#39;s past or upcoming payments for recurring subscriptions:</p>
<div class="highlight"><pre><span></span><span class="nx">$subscription</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$lastPayment</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">lastPayment</span><span class="p">();</span>
<span class="nx">$nextPayment</span> <span class="o">=</span> <span class="nx">$subscription</span><span class="o">-&gt;</span><span class="nx">nextPayment</span><span class="p">();</span>
</pre></div>

<p>Both of these methods will return an instance of <code>Laravel\Paddle\Payment</code>; however, <code>nextPayment</code> will return <code>null</code> when the billing cycle has ended (such as when a subscription has been cancelled):</p>
<div class="highlight"><pre><span></span><span class="nx">Next</span> <span class="nx">payment</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$nextPayment</span><span class="o">-&gt;</span><span class="nx">amount</span><span class="p">()</span> <span class="p">}}</span> <span class="nx">due</span> <span class="nx">on</span> <span class="p">{{</span> <span class="nx">$nextPayment</span><span class="o">-&gt;</span><span class="nx">date</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;d/m/Y&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p><a name="handling-failed-payments"></a></p>

<h2>Handling Failed Payments</h2>

<p>Subscription payments fail for various reasons, such as expired cards or a card having insufficient funds. When this happens, we recommend that you let Paddle handle payment failures for you. Specifically, you may <a href="https://vendors.paddle.com/subscription-settings">setup Paddle&#39;s automatic billing emails</a> in your Paddle dashboard.</p>

<p>Alternatively, you can perform more precise customization by catching the <a href="https://developer.paddle.com/webhook-reference/subscription-alerts/subscription-payment-failed"><code>subscription_payment_failed</code></a> webhook and enabling the &quot;Subscription Payment Failed&quot; option in the Webhook settings of your Paddle dashboard:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Paddle\Http\Controllers\WebhookController</span> <span class="k">as</span> <span class="nx">CashierController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WebhookController</span> <span class="k">extends</span> <span class="nx">CashierController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle subscription payment failed.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $payload</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleSubscriptionPaymentFailed</span><span class="p">(</span><span class="nv">$payload</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Handle the failed subscription payment...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="testing"></a></p>

<h2>Testing</h2>

<p>Paddle currently lacks a proper CRUD API so you will need to manually test your billing flow. Paddle also lacks a sandboxed developer environment so any card charges you make are live charges. In order to work around this, we recommend you use coupons with a 100% discount or free products during testing.</p>
<div style="page-break-after: always;" ></div><h1>Collections</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#creating-collections">Creating Collections</a></li>
<li><a href="#extending-collections">Extending Collections</a></li>
</ul></li>
<li><a href="#available-methods">Available Methods</a></li>
<li><a href="#higher-order-messages">Higher Order Messages</a></li>
<li><a href="#lazy-collections">Lazy Collections</a>

<ul>
<li><a href="#lazy-collection-introduction">Introduction</a></li>
<li><a href="#creating-lazy-collections">Creating Lazy Collections</a></li>
<li><a href="#the-enumerable-contract">The Enumerable Contract</a></li>
<li><a href="#lazy-collection-methods">Lazy Collection Methods</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The <code>Illuminate\Support\Collection</code> class provides a fluent, convenient wrapper for working with arrays of data. For example, check out the following code. We&#39;ll use the <code>collect</code> helper to create a new collection instance from the array, run the <code>strtoupper</code> function on each element, and then remove all empty elements:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;abigail&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">empty</span><span class="p">(</span><span class="nx">$name</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the <code>Collection</code> class allows you to chain its methods to perform fluent mapping and reducing of the underlying array. In general, collections are immutable, meaning every <code>Collection</code> method returns an entirely new <code>Collection</code> instance.</p>

<p><a name="creating-collections"></a></p>

<h3>Creating Collections</h3>

<p>As mentioned above, the <code>collect</code> helper returns a new <code>Illuminate\Support\Collection</code> instance for the given array. So, creating a collection is as simple as:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<blockquote>
<p>{tip} The results of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> queries are always returned as <code>Collection</code> instances.</p>
</blockquote>

<p><a name="extending-collections"></a></p>

<h3>Extending Collections</h3>

<p>Collections are &quot;macroable&quot;, which allows you to add additional methods to the <code>Collection</code> class at run time. For example, the following code adds a <code>toUpper</code> method to the <code>Collection</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Collection</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">Collection</span><span class="o">::</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;toUpper&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">upper</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]);</span>

<span class="nx">$upper</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">toUpper</span><span class="p">();</span>

<span class="c1">// [&#39;FIRST&#39;, &#39;SECOND&#39;]</span>
</pre></div>

<p>Typically, you should declare collection macros in a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>.</p>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<p>For the remainder of this documentation, we&#39;ll discuss each method available on the <code>Collection</code> class. Remember, all of these methods may be chained to fluently manipulate the underlying array. Furthermore, almost every method returns a new <code>Collection</code> instance, allowing you to preserve the original copy of the collection when necessary:</p>

<style>
    #collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    #collection-method-list a {
        display: block;
    }
</style>

<div id="collection-method-list" markdown="1">

[all](#method-all)
[average](#method-average)
[avg](#method-avg)
[chunk](#method-chunk)
[chunkWhile](#method-chunkwhile)
[collapse](#method-collapse)
[collect](#method-collect)
[combine](#method-combine)
[concat](#method-concat)
[contains](#method-contains)
[containsStrict](#method-containsstrict)
[count](#method-count)
[countBy](#method-countBy)
[crossJoin](#method-crossjoin)
[dd](#method-dd)
[diff](#method-diff)
[diffAssoc](#method-diffassoc)
[diffKeys](#method-diffkeys)
[dump](#method-dump)
[duplicates](#method-duplicates)
[duplicatesStrict](#method-duplicatesstrict)
[each](#method-each)
[eachSpread](#method-eachspread)
[every](#method-every)
[except](#method-except)
[filter](#method-filter)
[first](#method-first)
[firstWhere](#method-first-where)
[flatMap](#method-flatmap)
[flatten](#method-flatten)
[flip](#method-flip)
[forget](#method-forget)
[forPage](#method-forpage)
[get](#method-get)
[groupBy](#method-groupby)
[has](#method-has)
[implode](#method-implode)
[intersect](#method-intersect)
[intersectByKeys](#method-intersectbykeys)
[isEmpty](#method-isempty)
[isNotEmpty](#method-isnotempty)
[join](#method-join)
[keyBy](#method-keyby)
[keys](#method-keys)
[last](#method-last)
[macro](#method-macro)
[make](#method-make)
[map](#method-map)
[mapInto](#method-mapinto)
[mapSpread](#method-mapspread)
[mapToGroups](#method-maptogroups)
[mapWithKeys](#method-mapwithkeys)
[max](#method-max)
[median](#method-median)
[merge](#method-merge)
[mergeRecursive](#method-mergerecursive)
[min](#method-min)
[mode](#method-mode)
[nth](#method-nth)
[only](#method-only)
[pad](#method-pad)
[partition](#method-partition)
[pipe](#method-pipe)
[pluck](#method-pluck)
[pop](#method-pop)
[prepend](#method-prepend)
[pull](#method-pull)
[push](#method-push)
[put](#method-put)
[random](#method-random)
[reduce](#method-reduce)
[reject](#method-reject)
[replace](#method-replace)
[replaceRecursive](#method-replacerecursive)
[reverse](#method-reverse)
[search](#method-search)
[shift](#method-shift)
[shuffle](#method-shuffle)
[skip](#method-skip)
[skipUntil](#method-skipuntil)
[skipWhile](#method-skipwhile)
[slice](#method-slice)
[some](#method-some)
[sort](#method-sort)
[sortBy](#method-sortby)
[sortByDesc](#method-sortbydesc)
[sortDesc](#method-sortdesc)
[sortKeys](#method-sortkeys)
[sortKeysDesc](#method-sortkeysdesc)
[splice](#method-splice)
[split](#method-split)
[sum](#method-sum)
[take](#method-take)
[takeUntil](#method-takeuntil)
[takeWhile](#method-takewhile)
[tap](#method-tap)
[times](#method-times)
[toArray](#method-toarray)
[toJson](#method-tojson)
[transform](#method-transform)
[union](#method-union)
[unique](#method-unique)
[uniqueStrict](#method-uniquestrict)
[unless](#method-unless)
[unlessEmpty](#method-unlessempty)
[unlessNotEmpty](#method-unlessnotempty)
[unwrap](#method-unwrap)
[values](#method-values)
[when](#method-when)
[whenEmpty](#method-whenempty)
[whenNotEmpty](#method-whennotempty)
[where](#method-where)
[whereStrict](#method-wherestrict)
[whereBetween](#method-wherebetween)
[whereIn](#method-wherein)
[whereInStrict](#method-whereinstrict)
[whereInstanceOf](#method-whereinstanceof)
[whereNotBetween](#method-wherenotbetween)
[whereNotIn](#method-wherenotin)
[whereNotInStrict](#method-wherenotinstrict)
[whereNotNull](#method-wherenotnull)
[whereNull](#method-wherenull)
[wrap](#method-wrap)
[zip](#method-zip)

</div>

<p><a name="method-listing"></a></p>

<h2>Method Listing</h2>

<style>
    #collection-method code {
        font-size: 14px;
    }

    #collection-method:not(.first-collection-method) {
        margin-top: 50px;
    }
</style>

<p><a name="method-all"></a></p>

<h4><code>all()</code> {#collection-method .first-collection-method}</h4>

<p>The <code>all</code> method returns the underlying array represented by the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<p><a name="method-average"></a></p>

<h4><code>average()</code> {#collection-method}</h4>

<p>Alias for the <a href="#method-avg"><code>avg</code></a> method.</p>

<p><a name="method-avg"></a></p>

<h4><code>avg()</code> {#collection-method}</h4>

<p>The <code>avg</code> method returns the <a href="https://en.wikipedia.org/wiki/Average">average value</a> of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$average</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">40</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 20</span>

<span class="nx">$average</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">avg</span><span class="p">();</span>

<span class="c1">// 2</span>
</pre></div>

<p><a name="method-chunk"></a></p>

<h4><code>chunk()</code> {#collection-method}</h4>

<p>The <code>chunk</code> method breaks the collection into multiple, smaller collections of a given size:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]);</span>

<span class="nx">$chunks</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">$chunks</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="c1">// [[1, 2, 3, 4], [5, 6, 7]]</span>
</pre></div>

<p>This method is especially useful in <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> when working with a grid system such as <a href="https://getbootstrap.com/docs/4.1/layout/grid/">Bootstrap</a>. Imagine you have a collection of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models you want to display in a grid:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$products</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$chunk</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
        <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$chunk</span> <span class="nx">as</span> <span class="nx">$product</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-xs-4&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$product</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="err">@</span><span class="nx">endforeach</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endforeach</span>
</pre></div>

<p><a name="method-chunkwhile"></a></p>

<h4><code>chunkWhile()</code> {#collection-method}</h4>

<p>The <code>chunkWhile</code> method breaks the collection into multiple, smaller collections based on the evaluation of the given callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">(</span><span class="nx">str_split</span><span class="p">(</span><span class="s1">&#39;AABBCCCD&#39;</span><span class="p">));</span>

<span class="nx">$chunks</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">chunkWhile</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$current</span><span class="p">,</span> <span class="nx">$key</span><span class="p">,</span> <span class="nx">$chunk</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$current</span> <span class="o">===</span> <span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">$chunks</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="c1">// [[&#39;A&#39;, &#39;A&#39;], [&#39;B&#39;, &#39;B&#39;], [&#39;C&#39;, &#39;C&#39;, &#39;C&#39;], [&#39;D&#39;]]</span>
</pre></div>

<p><a name="method-collapse"></a></p>

<h4><code>collapse()</code> {#collection-method}</h4>

<p>The <code>collapse</code> method collapses a collection of arrays into a single, flat collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]);</span>

<span class="nx">$collapsed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">collapse</span><span class="p">();</span>

<span class="nx">$collapsed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</pre></div>

<p><a name="method-combine"></a></p>

<h4><code>combine()</code> {#collection-method}</h4>

<p>The <code>combine</code> method combines the values of the collection, as keys, with the values of another array or collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">]);</span>

<span class="nx">$combined</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">combine</span><span class="p">([</span><span class="s1">&#39;George&#39;</span><span class="p">,</span> <span class="mi">29</span><span class="p">]);</span>

<span class="nx">$combined</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;George&#39;, &#39;age&#39; =&gt; 29]</span>
</pre></div>

<p><a name="method-collect"></a></p>

<h4><code>collect()</code> {#collection-method}</h4>

<p>The <code>collect</code> method returns a new <code>Collection</code> instance with the items currently in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collectionA</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$collectionB</span> <span class="o">=</span> <span class="nx">$collectionA</span><span class="o">-&gt;</span><span class="nx">collect</span><span class="p">();</span>

<span class="nx">$collectionB</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<p>The <code>collect</code> method is primarily useful for converting <a href="#lazy-collections">lazy collections</a> into standard <code>Collection</code> instances:</p>
<div class="highlight"><pre><span></span><span class="nx">$lazyCollection</span> <span class="o">=</span> <span class="nx">LazyCollection</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">yield</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">yield</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$lazyCollection</span><span class="o">-&gt;</span><span class="nx">collect</span><span class="p">();</span>

<span class="nx">get_class</span><span class="p">(</span><span class="nx">$collection</span><span class="p">);</span>

<span class="c1">// &#39;Illuminate\Support\Collection&#39;</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<blockquote>
<p>{tip} The <code>collect</code> method is especially useful when you have an instance of <code>Enumerable</code> and need a non-lazy collection instance. Since <code>collect()</code> is part of the <code>Enumerable</code> contract, you can safely use it to get a <code>Collection</code> instance.</p>
</blockquote>

<p><a name="method-concat"></a></p>

<h4><code>concat()</code> {#collection-method}</h4>

<p>The <code>concat</code> method appends the given <code>array</code> or collection values onto the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;John Doe&#39;</span><span class="p">]);</span>

<span class="nx">$concatenated</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">concat</span><span class="p">([</span><span class="s1">&#39;Jane Doe&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">concat</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Johnny Doe&#39;</span><span class="p">]);</span>

<span class="nx">$concatenated</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;John Doe&#39;, &#39;Jane Doe&#39;, &#39;Johnny Doe&#39;]</span>
</pre></div>

<p><a name="method-contains"></a></p>

<h4><code>contains()</code> {#collection-method}</h4>

<p>The <code>contains</code> method determines whether the collection contains a given item:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Desk&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>You may also pass a key / value pair to the <code>contains</code> method, which will determine if the given pair exists in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>Finally, you may also pass a callback to the <code>contains</code> method to perform your own truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// false</span>
</pre></div>

<p>The <code>contains</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value. Use the <a href="#method-containsstrict"><code>containsStrict</code></a> method to filter using &quot;strict&quot; comparisons.</p>

<p><a name="method-containsstrict"></a></p>

<h4><code>containsStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-contains"><code>contains</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-contains">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-count"></a></p>

<h4><code>count()</code> {#collection-method}</h4>

<p>The <code>count</code> method returns the total number of items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="c1">// 4</span>
</pre></div>

<p><a name="method-countBy"></a></p>

<h4><code>countBy()</code> {#collection-method}</h4>

<p>The <code>countBy</code> method counts the occurrences of values in the collection. By default, the method counts the occurrences of every element:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$counted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">countBy</span><span class="p">();</span>

<span class="nx">$counted</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1 =&gt; 1, 2 =&gt; 3, 3 =&gt; 1]</span>
</pre></div>

<p>However, you pass a callback to the <code>countBy</code> method to count all items by a custom value:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;alice@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;bob@yahoo.com&#39;</span><span class="p">,</span> <span class="s1">&#39;carlos@gmail.com&#39;</span><span class="p">]);</span>

<span class="nx">$counted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">countBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$email</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">substr</span><span class="p">(</span><span class="nx">strrchr</span><span class="p">(</span><span class="nx">$email</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$counted</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;gmail.com&#39; =&gt; 2, &#39;yahoo.com&#39; =&gt; 1]</span>
</pre></div>

<p><a name="method-crossjoin"></a></p>

<h4><code>crossJoin()</code> {#collection-method}</h4>

<p>The <code>crossJoin</code> method cross joins the collection&#39;s values among the given arrays or collections, returning a Cartesian product with all possible permutations:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$matrix</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">crossJoin</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]);</span>

<span class="nx">$matrix</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [1, &#39;a&#39;],</span>
<span class="cm">        [1, &#39;b&#39;],</span>
<span class="cm">        [2, &#39;a&#39;],</span>
<span class="cm">        [2, &#39;b&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$matrix</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">crossJoin</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;II&#39;</span><span class="p">]);</span>

<span class="nx">$matrix</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [1, &#39;a&#39;, &#39;I&#39;],</span>
<span class="cm">        [1, &#39;a&#39;, &#39;II&#39;],</span>
<span class="cm">        [1, &#39;b&#39;, &#39;I&#39;],</span>
<span class="cm">        [1, &#39;b&#39;, &#39;II&#39;],</span>
<span class="cm">        [2, &#39;a&#39;, &#39;I&#39;],</span>
<span class="cm">        [2, &#39;a&#39;, &#39;II&#39;],</span>
<span class="cm">        [2, &#39;b&#39;, &#39;I&#39;],</span>
<span class="cm">        [2, &#39;b&#39;, &#39;II&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-dd"></a></p>

<h4><code>dd()</code> {#collection-method}</h4>

<p>The <code>dd</code> method dumps the collection&#39;s items and ends execution of the script:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;Jane Doe&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">dd</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    Collection {</span>
<span class="cm">        #items: array:2 [</span>
<span class="cm">            0 =&gt; &quot;John Doe&quot;</span>
<span class="cm">            1 =&gt; &quot;Jane Doe&quot;</span>
<span class="cm">        ]</span>
<span class="cm">    }</span>
<span class="cm">*/</span>
</pre></div>

<p>If you do not want to stop executing the script, use the <a href="#method-dump"><code>dump</code></a> method instead.</p>

<p><a name="method-diff"></a></p>

<h4><code>diff()</code> {#collection-method}</h4>

<p>The <code>diff</code> method compares the collection against another collection or a plain PHP <code>array</code> based on its values. This method will return the values in the original collection that are not present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$diff</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">diff</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]);</span>

<span class="nx">$diff</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 3, 5]</span>
</pre></div>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-diff">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-diffassoc"></a></p>

<h4><code>diffAssoc()</code> {#collection-method}</h4>

<p>The <code>diffAssoc</code> method compares the collection against another collection or a plain PHP <code>array</code> based on its keys and values. This method will return the key / value pairs in the original collection that are not present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;fruit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;remain&#39;</span> <span class="p">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$diff</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">diffAssoc</span><span class="p">([</span>
    <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;fruit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;remain&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;used&#39;</span> <span class="p">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$diff</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;color&#39; =&gt; &#39;orange&#39;, &#39;remain&#39; =&gt; 6]</span>
</pre></div>

<p><a name="method-diffkeys"></a></p>

<h4><code>diffKeys()</code> {#collection-method}</h4>

<p>The <code>diffKeys</code> method compares the collection against another collection or a plain PHP <code>array</code> based on its keys. This method will return the key / value pairs in the original collection that are not present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;one&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;two&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;three&#39;</span> <span class="p">=&gt;</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s1">&#39;four&#39;</span> <span class="p">=&gt;</span> <span class="mi">40</span><span class="p">,</span>
    <span class="s1">&#39;five&#39;</span> <span class="p">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$diff</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">diffKeys</span><span class="p">([</span>
    <span class="s1">&#39;two&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;four&#39;</span> <span class="p">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;six&#39;</span> <span class="p">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;eight&#39;</span> <span class="p">=&gt;</span> <span class="mi">8</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$diff</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;one&#39; =&gt; 10, &#39;three&#39; =&gt; 30, &#39;five&#39; =&gt; 50]</span>
</pre></div>

<p><a name="method-dump"></a></p>

<h4><code>dump()</code> {#collection-method}</h4>

<p>The <code>dump</code> method dumps the collection&#39;s items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;Jane Doe&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">dump</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    Collection {</span>
<span class="cm">        #items: array:2 [</span>
<span class="cm">            0 =&gt; &quot;John Doe&quot;</span>
<span class="cm">            1 =&gt; &quot;Jane Doe&quot;</span>
<span class="cm">        ]</span>
<span class="cm">    }</span>
<span class="cm">*/</span>
</pre></div>

<p>If you want to stop executing the script after dumping the collection, use the <a href="#method-dd"><code>dd</code></a> method instead.</p>

<p><a name="method-duplicates"></a></p>

<h4><code>duplicates()</code> {#collection-method}</h4>

<p>The <code>duplicates</code> method retrieves and returns duplicate values from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">duplicates</span><span class="p">();</span>

<span class="c1">// [2 =&gt; &#39;a&#39;, 4 =&gt; &#39;b&#39;]</span>
</pre></div>

<p>If the collection contains arrays or objects, you can pass the key of the attributes that you wish to check for duplicate values:</p>
<div class="highlight"><pre><span></span><span class="nx">$employees</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;abigail@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;james@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Designer&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;victoria@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">],</span>
<span class="p">])</span>

<span class="nx">$employees</span><span class="o">-&gt;</span><span class="nx">duplicates</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">);</span>

<span class="c1">// [2 =&gt; &#39;Developer&#39;]</span>
</pre></div>

<p><a name="method-duplicatesstrict"></a></p>

<h4><code>duplicatesStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-duplicates"><code>duplicates</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<p><a name="method-each"></a></p>

<h4><code>each()</code> {#collection-method}</h4>

<p>The <code>each</code> method iterates over the items in the collection and passes each item to a callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>If you would like to stop iterating through the items, you may return <code>false</code> from your callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="cm">/* some condition */</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-eachspread"></a></p>

<h4><code>eachSpread()</code> {#collection-method}</h4>

<p>The <code>eachSpread</code> method iterates over the collection&#39;s items, passing each nested item value into the given callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Jane Doe&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">]]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">eachSpread</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$age</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may stop iterating through the items by returning <code>false</code> from the callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">eachSpread</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$age</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-every"></a></p>

<h4><code>every()</code> {#collection-method}</h4>

<p>The <code>every</code> method may be used to verify that all elements of a collection pass a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// false</span>
</pre></div>

<p>If the collection is empty, <code>every</code> will return true:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-except"></a></p>

<h4><code>except()</code> {#collection-method}</h4>

<p>The <code>except</code> method returns all items in the collection except for those with the specified keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1]</span>
</pre></div>

<p>For the inverse of <code>except</code>, see the <a href="#method-only">only</a> method.</p>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-except">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-filter"></a></p>

<h4><code>filter()</code> {#collection-method}</h4>

<p>The <code>filter</code> method filters the collection using the given callback, keeping only those items that pass a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4]</span>
</pre></div>

<p>If no callback is supplied, all entries of the collection that are equivalent to <code>false</code> will be removed:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3]</span>
</pre></div>

<p>For the inverse of <code>filter</code>, see the <a href="#method-reject">reject</a> method.</p>

<p><a name="method-first"></a></p>

<h4><code>first()</code> {#collection-method}</h4>

<p>The <code>first</code> method returns the first element in the collection that passes a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 3</span>
</pre></div>

<p>You may also call the <code>first</code> method with no arguments to get the first element in the collection. If the collection is empty, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="c1">// 1</span>
</pre></div>

<p><a name="method-first-where"></a></p>

<h4><code>firstWhere()</code> {#collection-method}</h4>

<p>The <code>firstWhere</code> method returns the first element in the collection with the given key / value pair:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Regena&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Linda&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">14</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Diego&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">23</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Linda&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">84</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">firstWhere</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Linda&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Linda&#39;, &#39;age&#39; =&gt; 14]</span>
</pre></div>

<p>You may also call the <code>firstWhere</code> method with an operator:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">firstWhere</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Diego&#39;, &#39;age&#39; =&gt; 23]</span>
</pre></div>

<p>Like the <a href="#method-where">where</a> method, you may pass one argument to the <code>firstWhere</code> method. In this scenario, the <code>firstWhere</code> method will return the first item where the given item key&#39;s value is &quot;truthy&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">firstWhere</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Linda&#39;, &#39;age&#39; =&gt; 14]</span>
</pre></div>

<p><a name="method-flatmap"></a></p>

<h4><code>flatMap()</code> {#collection-method}</h4>

<p>The <code>flatMap</code> method iterates through the collection and passes each value to the given callback. The callback is free to modify the item and return it, thus forming a new collection of modified items. Then, the array is flattened by a level:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;school&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Arkansas&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">28</span><span class="p">]</span>
<span class="p">]);</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flatMap</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$values</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">array_map</span><span class="p">(</span><span class="s1">&#39;strtoupper&#39;</span><span class="p">,</span> <span class="nx">$values</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$flattened</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;SALLY&#39;, &#39;school&#39; =&gt; &#39;ARKANSAS&#39;, &#39;age&#39; =&gt; &#39;28&#39;];</span>
</pre></div>

<p><a name="method-flatten"></a></p>

<h4><code>flatten()</code> {#collection-method}</h4>

<p>The <code>flatten</code> method flattens a multi-dimensional collection into a single dimension:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">]]);</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flatten</span><span class="p">();</span>

<span class="nx">$flattened</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;taylor&#39;, &#39;php&#39;, &#39;javascript&#39;];</span>
</pre></div>

<p>You may optionally pass the function a &quot;depth&quot; argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;Apple&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;iPhone 6S&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;Samsung&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Galaxy S7&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samsung&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$products</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$products</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;iPhone 6S&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy S7&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>In this example, calling <code>flatten</code> without providing the depth would have also flattened the nested arrays, resulting in <code>[&#39;iPhone 6S&#39;, &#39;Apple&#39;, &#39;Galaxy S7&#39;, &#39;Samsung&#39;]</code>. Providing a depth allows you to restrict the levels of nested arrays that will be flattened.</p>

<p><a name="method-flip"></a></p>

<h4><code>flip()</code> {#collection-method}</h4>

<p>The <code>flip</code> method swaps the collection&#39;s keys with their corresponding values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$flipped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">flip</span><span class="p">();</span>

<span class="nx">$flipped</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;taylor&#39; =&gt; &#39;name&#39;, &#39;laravel&#39; =&gt; &#39;framework&#39;]</span>
</pre></div>

<p><a name="method-forget"></a></p>

<h4><code>forget()</code> {#collection-method}</h4>

<p>The <code>forget</code> method removes an item from the collection by its key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;framework&#39; =&gt; &#39;laravel&#39;]</span>
</pre></div>

<blockquote>
<p>{note} Unlike most other collection methods, <code>forget</code> does not return a new modified collection; it modifies the collection it is called on.</p>
</blockquote>

<p><a name="method-forpage"></a></p>

<h4><code>forPage()</code> {#collection-method}</h4>

<p>The <code>forPage</code> method returns a new collection containing the items that would be present on a given page number. The method accepts the page number as its first argument and the number of items to show per page as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">forPage</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [4, 5, 6]</span>
</pre></div>

<p><a name="method-get"></a></p>

<h4><code>get()</code> {#collection-method}</h4>

<p>The <code>get</code> method returns the item at a given key. If the key does not exist, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// taylor</span>
</pre></div>

<p>You may optionally pass a default value as the second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;framework&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;laravel&#39;</span><span class="p">]);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;default-value&#39;</span><span class="p">);</span>

<span class="c1">// default-value</span>
</pre></div>

<p>You may even pass a callback as the default value. The result of the callback will be returned if the specified key does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;default-value&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// default-value</span>
</pre></div>

<p><a name="method-groupby"></a></p>

<h4><code>groupBy()</code> {#collection-method}</h4>

<p>The <code>groupBy</code> method groups the collection&#39;s items by a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x10&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x10&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;account-x11&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$grouped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">);</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;account-x10&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Bookcase&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;account-x11&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x11&#39;, &#39;product&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>Instead of passing a string <code>key</code>, you may pass a callback. The callback should return the value you wish to key the group by:</p>
<div class="highlight"><pre><span></span><span class="nx">$grouped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">substr</span><span class="p">(</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;account_id&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">3</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;x10&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x10&#39;, &#39;product&#39; =&gt; &#39;Bookcase&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;x11&#39; =&gt; [</span>
<span class="cm">            [&#39;account_id&#39; =&gt; &#39;account-x11&#39;, &#39;product&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>Multiple grouping criteria may be passed as an array. Each array element will be applied to the corresponding level within a multi-dimensional array:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span>
    <span class="mi">10</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;skill&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Role_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Role_3&#39;</span><span class="p">]],</span>
    <span class="mi">20</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;skill&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Role_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Role_2&#39;</span><span class="p">]],</span>
    <span class="mi">30</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;skill&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Role_1&#39;</span><span class="p">]],</span>
    <span class="mi">40</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;skill&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Role_2&#39;</span><span class="p">]],</span>
<span class="p">]);</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">$data</span><span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">([</span>
    <span class="s1">&#39;skill&#39;</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;roles&#39;</span><span class="p">];</span>
    <span class="p">},</span>
<span class="p">],</span> <span class="nx">$preserveKeys</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">[</span>
<span class="cm">    1 =&gt; [</span>
<span class="cm">        &#39;Role_1&#39; =&gt; [</span>
<span class="cm">            10 =&gt; [&#39;user&#39; =&gt; 1, &#39;skill&#39; =&gt; 1, &#39;roles&#39; =&gt; [&#39;Role_1&#39;, &#39;Role_3&#39;]],</span>
<span class="cm">            20 =&gt; [&#39;user&#39; =&gt; 2, &#39;skill&#39; =&gt; 1, &#39;roles&#39; =&gt; [&#39;Role_1&#39;, &#39;Role_2&#39;]],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;Role_2&#39; =&gt; [</span>
<span class="cm">            20 =&gt; [&#39;user&#39; =&gt; 2, &#39;skill&#39; =&gt; 1, &#39;roles&#39; =&gt; [&#39;Role_1&#39;, &#39;Role_2&#39;]],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;Role_3&#39; =&gt; [</span>
<span class="cm">            10 =&gt; [&#39;user&#39; =&gt; 1, &#39;skill&#39; =&gt; 1, &#39;roles&#39; =&gt; [&#39;Role_1&#39;, &#39;Role_3&#39;]],</span>
<span class="cm">        ],</span>
<span class="cm">    ],</span>
<span class="cm">    2 =&gt; [</span>
<span class="cm">        &#39;Role_1&#39; =&gt; [</span>
<span class="cm">            30 =&gt; [&#39;user&#39; =&gt; 3, &#39;skill&#39; =&gt; 2, &#39;roles&#39; =&gt; [&#39;Role_1&#39;]],</span>
<span class="cm">        ],</span>
<span class="cm">        &#39;Role_2&#39; =&gt; [</span>
<span class="cm">            40 =&gt; [&#39;user&#39; =&gt; 4, &#39;skill&#39; =&gt; 2, &#39;roles&#39; =&gt; [&#39;Role_2&#39;]],</span>
<span class="cm">        ],</span>
<span class="cm">    ],</span>
<span class="cm">];</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-has"></a></p>

<h4><code>has()</code> {#collection-method}</h4>

<p>The <code>has</code> method determines if a given key exists in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span> <span class="p">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">([</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">([</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-implode"></a></p>

<h4><code>implode()</code> {#collection-method}</h4>

<p>The <code>implode</code> method joins the items in a collection. Its arguments depend on the type of items in the collection. If the collection contains arrays or objects, you should pass the key of the attributes you wish to join, and the &quot;glue&quot; string you wish to place between the values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;account_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">);</span>

<span class="c1">// Desk, Chair</span>
</pre></div>

<p>If the collection contains simple strings or numeric values, pass the &quot;glue&quot; as the only argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// &#39;1-2-3-4-5&#39;</span>
</pre></div>

<p><a name="method-intersect"></a></p>

<h4><code>intersect()</code> {#collection-method}</h4>

<p>The <code>intersect</code> method removes any values from the original collection that are not present in the given <code>array</code> or collection. The resulting collection will preserve the original collection&#39;s keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Sofa&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">]);</span>

<span class="nx">$intersect</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">intersect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">]);</span>

<span class="nx">$intersect</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0 =&gt; &#39;Desk&#39;, 2 =&gt; &#39;Chair&#39;]</span>
</pre></div>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-intersect">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-intersectbykeys"></a></p>

<h4><code>intersectByKeys()</code> {#collection-method}</h4>

<p>The <code>intersectByKeys</code> method removes any keys from the original collection that are not present in the given <code>array</code> or collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;serial&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UX301&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;screen&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span> <span class="p">=&gt;</span> <span class="mi">2009</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$intersect</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">intersectByKeys</span><span class="p">([</span>
    <span class="s1">&#39;reference&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;UX404&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;tab&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span> <span class="p">=&gt;</span> <span class="mi">2011</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$intersect</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;type&#39; =&gt; &#39;screen&#39;, &#39;year&#39; =&gt; 2009]</span>
</pre></div>

<p><a name="method-isempty"></a></p>

<h4><code>isEmpty()</code> {#collection-method}</h4>

<p>The <code>isEmpty</code> method returns <code>true</code> if the collection is empty; otherwise, <code>false</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([])</span><span class="o">-&gt;</span><span class="nx">isEmpty</span><span class="p">();</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-isnotempty"></a></p>

<h4><code>isNotEmpty()</code> {#collection-method}</h4>

<p>The <code>isNotEmpty</code> method returns <code>true</code> if the collection is not empty; otherwise, <code>false</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([])</span><span class="o">-&gt;</span><span class="nx">isNotEmpty</span><span class="p">();</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-join"></a></p>

<h4><code>join()</code> {#collection-method}</h4>

<p>The <code>join</code> method joins the collection&#39;s values with a string:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span> <span class="c1">// &#39;a, b, c&#39;</span>
<span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39;, and &#39;</span><span class="p">);</span> <span class="c1">// &#39;a, b, and c&#39;</span>
<span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39; and &#39;</span><span class="p">);</span> <span class="c1">// &#39;a and b&#39;</span>
<span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39; and &#39;</span><span class="p">);</span> <span class="c1">// &#39;a&#39;</span>
<span class="nx">collect</span><span class="p">([])</span><span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39; and &#39;</span><span class="p">);</span> <span class="c1">// &#39;&#39;</span>
</pre></div>

<p><a name="method-keyby"></a></p>

<h4><code>keyBy()</code> {#collection-method}</h4>

<p>The <code>keyBy</code> method keys the collection by the given key. If multiple items have the same key, only the last one will appear in the new collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$keyed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keyBy</span><span class="p">(</span><span class="s1">&#39;product_id&#39;</span><span class="p">);</span>

<span class="nx">$keyed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;prod-100&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-100&#39;, &#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        &#39;prod-200&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-200&#39;, &#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You may also pass a callback to the method. The callback should return the value to key the collection by:</p>
<div class="highlight"><pre><span></span><span class="nx">$keyed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keyBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">$keyed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;PROD-100&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-100&#39;, &#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        &#39;PROD-200&#39; =&gt; [&#39;product_id&#39; =&gt; &#39;prod-200&#39;, &#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-keys"></a></p>

<h4><code>keys()</code> {#collection-method}</h4>

<p>The <code>keys</code> method returns all of the collection&#39;s keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;prod-100&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="s1">&#39;prod-200&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$keys</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">keys</span><span class="p">();</span>

<span class="nx">$keys</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;prod-100&#39;, &#39;prod-200&#39;]</span>
</pre></div>

<p><a name="method-last"></a></p>

<h4><code>last()</code> {#collection-method}</h4>

<p>The <code>last</code> method returns the last element in the collection that passes a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 2</span>
</pre></div>

<p>You may also call the <code>last</code> method with no arguments to get the last element in the collection. If the collection is empty, <code>null</code> is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">last</span><span class="p">();</span>

<span class="c1">// 4</span>
</pre></div>

<p><a name="method-macro"></a></p>

<h4><code>macro()</code> {#collection-method}</h4>

<p>The static <code>macro</code> method allows you to add methods to the <code>Collection</code> class at run time. Refer to the documentation on <a href="#extending-collections">extending collections</a> for more information.</p>

<p><a name="method-make"></a></p>

<h4><code>make()</code> {#collection-method}</h4>

<p>The static <code>make</code> method creates a new collection instance. See the <a href="#creating-collections">Creating Collections</a> section.</p>

<p><a name="method-map"></a></p>

<h4><code>map()</code> {#collection-method}</h4>

<p>The <code>map</code> method iterates through the collection and passes each value to the given callback. The callback is free to modify the item and return it, thus forming a new collection of modified items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$multiplied</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$multiplied</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 6, 8, 10]</span>
</pre></div>

<blockquote>
<p>{note} Like most other collection methods, <code>map</code> returns a new collection instance; it does not modify the collection it is called on. If you want to transform the original collection, use the <a href="#method-transform"><code>transform</code></a> method.</p>
</blockquote>

<p><a name="method-mapinto"></a></p>

<h4><code>mapInto()</code> {#collection-method}</h4>

<p>The <code>mapInto()</code> method iterates over the collection, creating a new instance of the given class by passing the value into the constructor:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Currency</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Create a new currency instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  string  $code</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nx">$code</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">code</span> <span class="o">=</span> <span class="nx">$code</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;GBP&#39;</span><span class="p">]);</span>

<span class="nx">$currencies</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">mapInto</span><span class="p">(</span><span class="nx">Currency</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

<span class="nx">$currencies</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [Currency(&#39;USD&#39;), Currency(&#39;EUR&#39;), Currency(&#39;GBP&#39;)]</span>
</pre></div>

<p><a name="method-mapspread"></a></p>

<h4><code>mapSpread()</code> {#collection-method}</h4>

<p>The <code>mapSpread</code> method iterates over the collection&#39;s items, passing each nested item value into the given callback. The callback is free to modify the item and return it, thus forming a new collection of modified items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]);</span>

<span class="nx">$chunks</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">$sequence</span> <span class="o">=</span> <span class="nx">$chunks</span><span class="o">-&gt;</span><span class="nx">mapSpread</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$even</span><span class="p">,</span> <span class="nx">$odd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$even</span> <span class="o">+</span> <span class="nx">$odd</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$sequence</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 5, 9, 13, 17]</span>
</pre></div>

<p><a name="method-maptogroups"></a></p>

<h4><code>mapToGroups()</code> {#collection-method}</h4>

<p>The <code>mapToGroups</code> method groups the collection&#39;s items by the given callback. The callback should return an associative array containing a single key / value pair, thus forming a new collection of grouped values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;department&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sales&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jane Doe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;department&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sales&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Johnny Doe&#39;</span><span class="p">,</span>
        <span class="s1">&#39;department&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Marketing&#39;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]);</span>

<span class="nx">$grouped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">mapToGroups</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;department&#39;</span><span class="p">]</span> <span class="p">=&gt;</span> <span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]];</span>
<span class="p">});</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;Sales&#39; =&gt; [&#39;John Doe&#39;, &#39;Jane Doe&#39;],</span>
<span class="cm">        &#39;Marketing&#39; =&gt; [&#39;Johnny Doe&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>

<span class="nx">$grouped</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Sales&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;John Doe&#39;, &#39;Jane Doe&#39;]</span>
</pre></div>

<p><a name="method-mapwithkeys"></a></p>

<h4><code>mapWithKeys()</code> {#collection-method}</h4>

<p>The <code>mapWithKeys</code> method iterates through the collection and passes each value to the given callback. The callback should return an associative array containing a single key / value pair:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
        <span class="s1">&#39;department&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sales&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jane&#39;</span><span class="p">,</span>
        <span class="s1">&#39;department&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Marketing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;jane@example.com&#39;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]);</span>

<span class="nx">$keyed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">mapWithKeys</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="p">=&gt;</span> <span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]];</span>
<span class="p">});</span>

<span class="nx">$keyed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;john@example.com&#39; =&gt; &#39;John&#39;,</span>
<span class="cm">        &#39;jane@example.com&#39; =&gt; &#39;Jane&#39;,</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-max"></a></p>

<h4><code>max()</code> {#collection-method}</h4>

<p>The <code>max</code> method returns the maximum value of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$max</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 20</span>

<span class="nx">$max</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">();</span>

<span class="c1">// 5</span>
</pre></div>

<p><a name="method-median"></a></p>

<h4><code>median()</code> {#collection-method}</h4>

<p>The <code>median</code> method returns the <a href="https://en.wikipedia.org/wiki/Median">median value</a> of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$median</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">40</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">median</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 15</span>

<span class="nx">$median</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">median</span><span class="p">();</span>

<span class="c1">// 1.5</span>
</pre></div>

<p><a name="method-merge"></a></p>

<h4><code>merge()</code> {#collection-method}</h4>

<p>The <code>merge</code> method merges the given array or collection with the original collection. If a string key in the given items matches a string key in the original collection, the given items&#39;s value will overwrite the value in the original collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]);</span>

<span class="nx">$merged</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$merged</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;price&#39; =&gt; 200, &#39;discount&#39; =&gt; false]</span>
</pre></div>

<p>If the given items&#39;s keys are numeric, the values will be appended to the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">]);</span>

<span class="nx">$merged</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span><span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;Door&#39;</span><span class="p">]);</span>

<span class="nx">$merged</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Desk&#39;, &#39;Chair&#39;, &#39;Bookcase&#39;, &#39;Door&#39;]</span>
</pre></div>

<p><a name="method-mergerecursive"></a></p>

<h4><code>mergeRecursive()</code> {#collection-method}</h4>

<p>The <code>mergeRecursive</code> method merges the given array or collection recursively with the original collection. If a string key in the given items matches a string key in the original collection, then the values for these keys are merged together into an array, and this is done recursively:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]);</span>

<span class="nx">$merged</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">mergeRecursive</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$merged</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; [1, 2], &#39;price&#39; =&gt; [100, 200], &#39;discount&#39; =&gt; false]</span>
</pre></div>

<p><a name="method-min"></a></p>

<h4><code>min()</code> {#collection-method}</h4>

<p>The <code>min</code> method returns the minimum value of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$min</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// 10</span>

<span class="nx">$min</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">min</span><span class="p">();</span>

<span class="c1">// 1</span>
</pre></div>

<p><a name="method-mode"></a></p>

<h4><code>mode()</code> {#collection-method}</h4>

<p>The <code>mode</code> method returns the <a href="https://en.wikipedia.org/wiki/Mode_(statistics)">mode value</a> of a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$mode</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="mi">40</span><span class="p">]])</span><span class="o">-&gt;</span><span class="nx">mode</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// [10]</span>

<span class="nx">$mode</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">mode</span><span class="p">();</span>

<span class="c1">// [1]</span>
</pre></div>

<p><a name="method-nth"></a></p>

<h4><code>nth()</code> {#collection-method}</h4>

<p>The <code>nth</code> method creates a new collection consisting of every n-th element:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">nth</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// [&#39;a&#39;, &#39;e&#39;]</span>
</pre></div>

<p>You may optionally pass an offset as the second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">nth</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// [&#39;b&#39;, &#39;f&#39;]</span>
</pre></div>

<p><a name="method-only"></a></p>

<h4><code>only()</code> {#collection-method}</h4>

<p>The <code>only</code> method returns the items in the collection with the specified keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;name&#39; =&gt; &#39;Desk&#39;]</span>
</pre></div>

<p>For the inverse of <code>only</code>, see the <a href="#method-except">except</a> method.</p>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-only">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-pad"></a></p>

<h4><code>pad()</code> {#collection-method}</h4>

<p>The <code>pad</code> method will fill the array with the given value until the array reaches the specified size. This method behaves like the <a href="https://secure.php.net/manual/en/function.array-pad.php">array_pad</a> PHP function.</p>

<p>To pad to the left, you should specify a negative size. No padding will take place if the absolute value of the given size is less than or equal to the length of the array:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pad</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, 0, 0]</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pad</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0, 0, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
</pre></div>

<p><a name="method-partition"></a></p>

<h4><code>partition()</code> {#collection-method}</h4>

<p>The <code>partition</code> method may be combined with the <code>list</code> PHP function to separate elements that pass a given truth test from those that do not:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]);</span>

<span class="nx">list</span><span class="p">(</span><span class="nx">$underThree</span><span class="p">,</span> <span class="nx">$equalOrAboveThree</span><span class="p">)</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">partition</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$underThree</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>

<span class="nx">$equalOrAboveThree</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4, 5, 6]</span>
</pre></div>

<p><a name="method-pipe"></a></p>

<h4><code>pipe()</code> {#collection-method}</h4>

<p>The <code>pipe</code> method passes the collection to the given callback and returns the result:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$piped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pipe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// 6</span>
</pre></div>

<p><a name="method-pluck"></a></p>

<h4><code>pluck()</code> {#collection-method}</h4>

<p>The <code>pluck</code> method retrieves all of the values for a given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-200&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Desk&#39;, &#39;Chair&#39;]</span>
</pre></div>

<p>You may also specify how you wish the resulting collection to be keyed:</p>
<div class="highlight"><pre><span></span><span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;prod-100&#39; =&gt; &#39;Desk&#39;, &#39;prod-200&#39; =&gt; &#39;Chair&#39;]</span>
</pre></div>

<p>The <code>pluck</code> method also supports retrieving nested values using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span>
        <span class="s1">&#39;speakers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;first_day&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Rosa&#39;</span><span class="p">,</span> <span class="s1">&#39;Judith&#39;</span><span class="p">],</span>
            <span class="s1">&#39;second_day&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Angela&#39;</span><span class="p">,</span> <span class="s1">&#39;Kathleen&#39;</span><span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;speakers.first_day&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Rosa&#39;, &#39;Judith&#39;]</span>
</pre></div>

<p>If duplicate keys exist, the last matching element will be inserted into the plucked collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Tesla&#39;</span><span class="p">,</span>  <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Pagani&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;white&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Tesla&#39;</span><span class="p">,</span>  <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;black&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Pagani&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$plucked</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span><span class="p">);</span>

<span class="nx">$plucked</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Tesla&#39; =&gt; &#39;black&#39;, &#39;Pagani&#39; =&gt; &#39;orange&#39;]</span>
</pre></div>

<p><a name="method-pop"></a></p>

<h4><code>pop()</code> {#collection-method}</h4>

<p>The <code>pop</code> method removes and returns the last item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pop</span><span class="p">();</span>

<span class="c1">// 5</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4]</span>
</pre></div>

<p><a name="method-prepend"></a></p>

<h4><code>prepend()</code> {#collection-method}</h4>

<p>The <code>prepend</code> method adds an item to the beginning of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0, 1, 2, 3, 4, 5]</span>
</pre></div>

<p>You may also pass a second argument to set the key of the prepended item:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;one&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;zero&#39; =&gt; 0, &#39;one&#39; =&gt; 1, &#39;two&#39; =&gt; 2]</span>
</pre></div>

<p><a name="method-pull"></a></p>

<h4><code>pull()</code> {#collection-method}</h4>

<p>The <code>pull</code> method removes and returns an item from the collection by its key:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;prod-100&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Desk&#39;</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; &#39;prod-100&#39;]</span>
</pre></div>

<p><a name="method-push"></a></p>

<h4><code>push()</code> {#collection-method}</h4>

<p>The <code>push</code> method appends an item to the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5]</span>
</pre></div>

<p><a name="method-put"></a></p>

<h4><code>put()</code> {#collection-method}</h4>

<p>The <code>put</code> method sets the given key and value in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;product_id&#39; =&gt; 1, &#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-random"></a></p>

<h4><code>random()</code> {#collection-method}</h4>

<p>The <code>random</code> method returns a random item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">random</span><span class="p">();</span>

<span class="c1">// 4 - (retrieved randomly)</span>
</pre></div>

<p>You may optionally pass an integer to <code>random</code> to specify how many items you would like to randomly retrieve. A collection of items is always returned when explicitly passing the number of items you wish to receive:</p>
<div class="highlight"><pre><span></span><span class="nx">$random</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">random</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$random</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 5] - (retrieved randomly)</span>
</pre></div>

<p>If the Collection has fewer items than requested, the method will throw an <code>InvalidArgumentException</code>.</p>

<p><a name="method-reduce"></a></p>

<h4><code>reduce()</code> {#collection-method}</h4>

<p>The <code>reduce</code> method reduces the collection to a single value, passing the result of each iteration into the subsequent iteration:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$total</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$carry</span><span class="p">,</span> <span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$carry</span> <span class="o">+</span> <span class="nx">$item</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 6</span>
</pre></div>

<p>The value for <code>$carry</code> on the first iteration is <code>null</code>; however, you may specify its initial value by passing a second argument to <code>reduce</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$carry</span><span class="p">,</span> <span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$carry</span> <span class="o">+</span> <span class="nx">$item</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">4</span><span class="p">);</span>

<span class="c1">// 10</span>
</pre></div>

<p><a name="method-reject"></a></p>

<h4><code>reject()</code> {#collection-method}</h4>

<p>The <code>reject</code> method filters the collection using the given callback. The callback should return <code>true</code> if the item should be removed from the resulting collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<p>For the inverse of the <code>reject</code> method, see the <a href="#method-filter"><code>filter</code></a> method.</p>

<p><a name="method-replace"></a></p>

<h4><code>replace()</code> {#collection-method}</h4>

<p>The <code>replace</code> method behaves similarly to <code>merge</code>; however, in addition to overwriting matching items with string keys, the <code>replace</code> method will also overwrite items in the collection that have matching numeric keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;James&#39;</span><span class="p">]);</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">replace</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">=&gt;</span> <span class="s1">&#39;Finn&#39;</span><span class="p">]);</span>

<span class="nx">$replaced</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Taylor&#39;, &#39;Victoria&#39;, &#39;James&#39;, &#39;Finn&#39;]</span>
</pre></div>

<p><a name="method-replacerecursive"></a></p>

<h4><code>replaceRecursive()</code> {#collection-method}</h4>

<p>This method works like <code>replace</code>, but it will recur into arrays and apply the same replacement process to the inner values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">,</span> <span class="s1">&#39;Finn&#39;</span><span class="p">]]);</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">replaceRecursive</span><span class="p">([</span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="s1">&#39;King&#39;</span><span class="p">]]);</span>

<span class="nx">$replaced</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;Charlie&#39;, &#39;Abigail&#39;, [&#39;James&#39;, &#39;King&#39;, &#39;Finn&#39;]]</span>
</pre></div>

<p><a name="method-reverse"></a></p>

<h4><code>reverse()</code> {#collection-method}</h4>

<p>The <code>reverse</code> method reverses the order of the collection&#39;s items, preserving the original keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]);</span>

<span class="nx">$reversed</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">reverse</span><span class="p">();</span>

<span class="nx">$reversed</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        4 =&gt; &#39;e&#39;,</span>
<span class="cm">        3 =&gt; &#39;d&#39;,</span>
<span class="cm">        2 =&gt; &#39;c&#39;,</span>
<span class="cm">        1 =&gt; &#39;b&#39;,</span>
<span class="cm">        0 =&gt; &#39;a&#39;,</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-search"></a></p>

<h4><code>search()</code> {#collection-method}</h4>

<p>The <code>search</code> method searches the collection for the given value and returns its key if found. If the item is not found, <code>false</code> is returned.</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// 1</span>
</pre></div>

<p>The search is done using a &quot;loose&quot; comparison, meaning a string with an integer value will be considered equal to an integer of the same value. To use &quot;strict&quot; comparison, pass <code>true</code> as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>Alternatively, you may pass in your own callback to search for the first item that passes your truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 2</span>
</pre></div>

<p><a name="method-shift"></a></p>

<h4><code>shift()</code> {#collection-method}</h4>

<p>The <code>shift</code> method removes and returns the first item from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">shift</span><span class="p">();</span>

<span class="c1">// 1</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 3, 4, 5]</span>
</pre></div>

<p><a name="method-shuffle"></a></p>

<h4><code>shuffle()</code> {#collection-method}</h4>

<p>The <code>shuffle</code> method randomly shuffles the items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$shuffled</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">shuffle</span><span class="p">();</span>

<span class="nx">$shuffled</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 2, 5, 1, 4] - (generated randomly)</span>
</pre></div>

<p><a name="method-skip"></a></p>

<h4><code>skip()</code> {#collection-method}</h4>

<p>The <code>skip</code> method returns a new collection, without the first given amount of items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 6, 7, 8, 9, 10]</span>
</pre></div>

<p><a name="method-skipuntil"></a></p>

<h4><code>skipUntil()</code> {#collection-method}</h4>

<p>The <code>skipUntil</code> method skips items until the given callback returns <code>true</code> and then returns the remaining items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">skipUntil</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4]</span>
</pre></div>

<p>You may also pass a simple value to the <code>skipUntil</code> method to skip all items until the given value is found:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">skipUntil</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4]</span>
</pre></div>

<blockquote>
<p>{note} If the given value is not found or the callback never returns <code>true</code>, the <code>skipUntil</code> method will return an empty collection.</p>
</blockquote>

<p><a name="method-skipwhile"></a></p>

<h4><code>skipWhile()</code> {#collection-method}</h4>

<p>The <code>skipWhile</code> method skips items while the given callback returns <code>true</code> and then returns the remaining items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">skipWhile</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [4]</span>
</pre></div>

<blockquote>
<p>{note} If the callback never returns <code>true</code>, the <code>skipWhile</code> method will return an empty collection.</p>
</blockquote>

<p><a name="method-slice"></a></p>

<h4><code>slice()</code> {#collection-method}</h4>

<p>The <code>slice</code> method returns a slice of the collection starting at the given index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">$slice</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 6, 7, 8, 9, 10]</span>
</pre></div>

<p>If you would like to limit the size of the returned slice, pass the desired size as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$slice</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">$slice</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 6]</span>
</pre></div>

<p>The returned slice will preserve keys by default. If you do not wish to preserve the original keys, you can use the <a href="#method-values"><code>values</code></a> method to reindex them.</p>

<p><a name="method-some"></a></p>

<h4><code>some()</code> {#collection-method}</h4>

<p>Alias for the <a href="#method-contains"><code>contains</code></a> method.</p>

<p><a name="method-sort"></a></p>

<h4><code>sort()</code> {#collection-method}</h4>

<p>The <code>sort</code> method sorts the collection. The sorted collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sort</span><span class="p">();</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5]</span>
</pre></div>

<p>If your sorting needs are more advanced, you may pass a callback to <code>sort</code> with your own algorithm. Refer to the PHP documentation on <a href="https://secure.php.net/manual/en/function.uasort.php#refsect1-function.uasort-parameters"><code>uasort</code></a>, which is what the collection&#39;s <code>sort</code> method calls under the hood.</p>

<blockquote>
<p>{tip} If you need to sort a collection of nested arrays or objects, see the <a href="#method-sortby"><code>sortBy</code></a> and <a href="#method-sortbydesc"><code>sortByDesc</code></a> methods.</p>
</blockquote>

<p><a name="method-sortby"></a></p>

<h4><code>sortBy()</code> {#collection-method}</h4>

<p>The <code>sortBy</code> method sorts the collection by the given key. The sorted collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Bookcase&#39;, &#39;price&#39; =&gt; 150],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You can also pass your own callback to determine how to sort the collection values:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">,</span> <span class="s1">&#39;Mahogany&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Beige&#39;</span><span class="p">,</span> <span class="s1">&#39;Brown&#39;</span><span class="p">]],</span>
<span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$product</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">(</span><span class="nx">$product</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;, &#39;colors&#39; =&gt; [&#39;Black&#39;]],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;colors&#39; =&gt; [&#39;Black&#39;, &#39;Mahogany&#39;]],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Bookcase&#39;, &#39;colors&#39; =&gt; [&#39;Red&#39;, &#39;Beige&#39;, &#39;Brown&#39;]],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-sortbydesc"></a></p>

<h4><code>sortByDesc()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-sortby"><code>sortBy</code></a> method, but will sort the collection in the opposite order.</p>

<p><a name="method-sortdesc"></a></p>

<h4><code>sortDesc()</code> {#collection-method}</h4>

<p>This method will sort the collection in the opposite order as the <a href="#method-sort"><code>sort</code></a> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortDesc</span><span class="p">();</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [5, 4, 3, 2, 1]</span>
</pre></div>

<p>Unlike <code>sort</code>, you may not pass a callback to <code>sortDesc</code>. If you wish to use a callback, you should use <a href="#method-sort"><code>sort</code></a> and invert your comparison.</p>

<p><a name="method-sortkeys"></a></p>

<h4><code>sortKeys()</code> {#collection-method}</h4>

<p>The <code>sortKeys</code> method sorts the collection by the keys of the underlying associative array:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">22345</span><span class="p">,</span>
    <span class="s1">&#39;first&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Doe&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sortKeys</span><span class="p">();</span>

<span class="nx">$sorted</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;first&#39; =&gt; &#39;John&#39;,</span>
<span class="cm">        &#39;id&#39; =&gt; 22345,</span>
<span class="cm">        &#39;last&#39; =&gt; &#39;Doe&#39;,</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-sortkeysdesc"></a></p>

<h4><code>sortKeysDesc()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-sortkeys"><code>sortKeys</code></a> method, but will sort the collection in the opposite order.</p>

<p><a name="method-splice"></a></p>

<h4><code>splice()</code> {#collection-method}</h4>

<p>The <code>splice</code> method removes and returns a slice of items starting at the specified index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3, 4, 5]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<p>You may pass a second argument to limit the size of the resulting chunk:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 4, 5]</span>
</pre></div>

<p>In addition, you can pass a third argument containing the new items to replace the items removed from the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [3]</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 10, 11, 4, 5]</span>
</pre></div>

<p><a name="method-split"></a></p>

<h4><code>split()</code> {#collection-method}</h4>

<p>The <code>split</code> method breaks a collection into the given number of groups:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$groups</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">split</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$groups</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="c1">// [[1, 2], [3, 4], [5]]</span>
</pre></div>

<p><a name="method-sum"></a></p>

<h4><code>sum()</code> {#collection-method}</h4>

<p>The <code>sum</code> method returns the sum of all items in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">();</span>

<span class="c1">// 15</span>
</pre></div>

<p>If the collection contains nested arrays or objects, you should pass a key to use for determining which values to sum:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;JavaScript: The Good Parts&#39;</span><span class="p">,</span> <span class="s1">&#39;pages&#39;</span> <span class="p">=&gt;</span> <span class="mi">176</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;JavaScript: The Definitive Guide&#39;</span><span class="p">,</span> <span class="s1">&#39;pages&#39;</span> <span class="p">=&gt;</span> <span class="mi">1096</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">);</span>

<span class="c1">// 1272</span>
</pre></div>

<p>In addition, you may pass your own callback to determine which values of the collection to sum:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Black&#39;</span><span class="p">,</span> <span class="s1">&#39;Mahogany&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Beige&#39;</span><span class="p">,</span> <span class="s1">&#39;Brown&#39;</span><span class="p">]],</span>
<span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$product</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">(</span><span class="nx">$product</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="c1">// 6</span>
</pre></div>

<p><a name="method-take"></a></p>

<h4><code>take()</code> {#collection-method}</h4>

<p>The <code>take</code> method returns a new collection with the specified number of items:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [0, 1, 2]</span>
</pre></div>

<p>You may also pass a negative integer to take the specified amount of items from the end of the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$chunk</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">$chunk</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [4, 5]</span>
</pre></div>

<p><a name="method-takeuntil"></a></p>

<h4><code>takeUntil()</code> {#collection-method}</h4>

<p>The <code>takeUntil</code> method returns items in the collection until the given callback returns <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">takeUntil</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<p>You may also pass a simple value to the <code>takeUntil</code> method to get the items until the given value is found:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">takeUntil</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<blockquote>
<p>{note} If the given value is not found or the callback never returns <code>true</code>, the <code>takeUntil</code> method will return all items in the collection.</p>
</blockquote>

<p><a name="method-takewhile"></a></p>

<h4><code>takeWhile()</code> {#collection-method}</h4>

<p>The <code>takeWhile</code> method returns items in the collection until the given callback returns <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>

<span class="nx">$subset</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">takeWhile</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$subset</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2]</span>
</pre></div>

<blockquote>
<p>{note} If the callback never returns <code>false</code>, the <code>takeWhile</code> method will return all items in the collection.</p>
</blockquote>

<p><a name="method-tap"></a></p>

<h4><code>tap()</code> {#collection-method}</h4>

<p>The <code>tap</code> method passes the collection to the given callback, allowing you to &quot;tap&quot; into the collection at a specific point and do something with the items while not affecting the collection itself:</p>
<div class="highlight"><pre><span></span><span class="nx">collect</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">sort</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nx">tap</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Log</span><span class="o">::</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Values after sorting&#39;</span><span class="p">,</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">());</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nx">shift</span><span class="p">();</span>

<span class="c1">// 1</span>
</pre></div>

<p><a name="method-times"></a></p>

<h4><code>times()</code> {#collection-method}</h4>

<p>The static <code>times</code> method creates a new collection by invoking the callback a given amount of times:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">times</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$number</span> <span class="o">*</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [9, 18, 27, 36, 45, 54, 63, 72, 81, 90]</span>
</pre></div>

<p>This method can be useful when combined with factories to create <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models:</p>
<div class="highlight"><pre><span></span><span class="nx">$categories</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">times</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Category</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s2">&quot;Category No. $number&quot;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">$categories</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;id&#39; =&gt; 1, &#39;name&#39; =&gt; &#39;Category No. 1&#39;],</span>
<span class="cm">        [&#39;id&#39; =&gt; 2, &#39;name&#39; =&gt; &#39;Category No. 2&#39;],</span>
<span class="cm">        [&#39;id&#39; =&gt; 3, &#39;name&#39; =&gt; &#39;Category No. 3&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-toarray"></a></p>

<h4><code>toArray()</code> {#collection-method}</h4>

<p>The <code>toArray</code> method converts the collection into a plain PHP <code>array</code>. If the collection&#39;s values are <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> models, the models will also be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<blockquote>
<p>{note} <code>toArray</code> also converts all of the collection&#39;s nested objects that are an instance of <code>Arrayable</code> to an array. If you want to get the raw underlying array, use the <a href="#method-all"><code>all</code></a> method instead.</p>
</blockquote>

<p><a name="method-tojson"></a></p>

<h4><code>toJson()</code> {#collection-method}</h4>

<p>The <code>toJson</code> method converts the collection into a JSON serialized string:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>

<span class="c1">// &#39;{&quot;name&quot;:&quot;Desk&quot;, &quot;price&quot;:200}&#39;</span>
</pre></div>

<p><a name="method-transform"></a></p>

<h4><code>transform()</code> {#collection-method}</h4>

<p>The <code>transform</code> method iterates over the collection and calls the given callback with each item in the collection. The items in the collection will be replaced by the values returned by the callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">transform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [2, 4, 6, 8, 10]</span>
</pre></div>

<blockquote>
<p>{note} Unlike most other collection methods, <code>transform</code> modifies the collection itself. If you wish to create a new collection instead, use the <a href="#method-map"><code>map</code></a> method.</p>
</blockquote>

<p><a name="method-union"></a></p>

<h4><code>union()</code> {#collection-method}</h4>

<p>The <code>union</code> method adds the given array to the collection. If the given array contains keys that are already in the original collection, the original collection&#39;s values will be preferred:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="mi">2</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]]);</span>

<span class="nx">$union</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">union</span><span class="p">([</span><span class="mi">3</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]]);</span>

<span class="nx">$union</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1 =&gt; [&#39;a&#39;], 2 =&gt; [&#39;b&#39;], 3 =&gt; [&#39;c&#39;]]</span>
</pre></div>

<p><a name="method-unique"></a></p>

<h4><code>unique()</code> {#collection-method}</h4>

<p>The <code>unique</code> method returns all of the unique items in the collection. The returned collection keeps the original array keys, so in this example we&#39;ll use the <a href="#method-values"><code>values</code></a> method to reset the keys to consecutively numbered indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>

<span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4]</span>
</pre></div>

<p>When dealing with nested arrays or objects, you may specify the key used to determine uniqueness:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;iPhone 6&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;iPhone 5&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple Watch&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;watch&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Galaxy S6&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samsung&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;phone&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Galaxy Gear&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Samsung&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;watch&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;brand&#39;</span><span class="p">);</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;iPhone 6&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy S6&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>You may also pass your own callback to determine item uniqueness:</p>
<div class="highlight"><pre><span></span><span class="nx">$unique</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">].</span><span class="nx">$item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
<span class="p">});</span>

<span class="nx">$unique</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;iPhone 6&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Apple Watch&#39;, &#39;brand&#39; =&gt; &#39;Apple&#39;, &#39;type&#39; =&gt; &#39;watch&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy S6&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;phone&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Galaxy Gear&#39;, &#39;brand&#39; =&gt; &#39;Samsung&#39;, &#39;type&#39; =&gt; &#39;watch&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>unique</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value. Use the <a href="#method-uniquestrict"><code>uniqueStrict</code></a> method to filter using &quot;strict&quot; comparisons.</p>

<blockquote>
<p>{tip} This method&#39;s behavior is modified when using <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#method-unique">Eloquent Collections</a>.</p>
</blockquote>

<p><a name="method-uniquestrict"></a></p>

<h4><code>uniqueStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-unique"><code>unique</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<p><a name="method-unless"></a></p>

<h4><code>unless()</code> {#collection-method}</h4>

<p>The <code>unless</code> method will execute the given callback unless the first argument given to the method evaluates to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unless</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">unless</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 5]</span>
</pre></div>

<p>For the inverse of <code>unless</code>, see the <a href="#method-when"><code>when</code></a> method.</p>

<p><a name="method-unlessempty"></a></p>

<h4><code>unlessEmpty()</code> {#collection-method}</h4>

<p>Alias for the <a href="#method-whennotempty"><code>whenNotEmpty</code></a> method.</p>

<p><a name="method-unlessnotempty"></a></p>

<h4><code>unlessNotEmpty()</code> {#collection-method}</h4>

<p>Alias for the <a href="#method-whenempty"><code>whenEmpty</code></a> method.</p>

<p><a name="method-unwrap"></a></p>

<h4><code>unwrap()</code> {#collection-method}</h4>

<p>The static <code>unwrap</code> method returns the collection&#39;s underlying items from the given value when applicable:</p>
<div class="highlight"><pre><span></span><span class="nx">Collection</span><span class="o">::</span><span class="nx">unwrap</span><span class="p">(</span><span class="nx">collect</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">));</span>

<span class="c1">// [&#39;John Doe&#39;]</span>

<span class="nx">Collection</span><span class="o">::</span><span class="nx">unwrap</span><span class="p">([</span><span class="s1">&#39;John Doe&#39;</span><span class="p">]);</span>

<span class="c1">// [&#39;John Doe&#39;]</span>

<span class="nx">Collection</span><span class="o">::</span><span class="nx">unwrap</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="c1">// &#39;John Doe&#39;</span>
</pre></div>

<p><a name="method-values"></a></p>

<h4><code>values()</code> {#collection-method}</h4>

<p>The <code>values</code> method returns a new collection with the keys reset to consecutive integers:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="mi">10</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="mi">11</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">values</span><span class="p">();</span>

<span class="nx">$values</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        0 =&gt; [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        1 =&gt; [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-when"></a></p>

<h4><code>when()</code> {#collection-method}</h4>

<p>The <code>when</code> method will execute the given callback when the first argument given to the method evaluates to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4]</span>
</pre></div>

<p>For the inverse of <code>when</code>, see the <a href="#method-unless"><code>unless</code></a> method.</p>

<p><a name="method-whenempty"></a></p>

<h4><code>whenEmpty()</code> {#collection-method}</h4>

<p>The <code>whenEmpty</code> method will execute the given callback when the collection is empty:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;michael&#39;</span><span class="p">,</span> <span class="s1">&#39;tom&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;michael&#39;, &#39;tom&#39;]</span>


<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">();</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;adam&#39;]</span>


<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;michael&#39;</span><span class="p">,</span> <span class="s1">&#39;tom&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;taylor&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;michael&#39;, &#39;tom&#39;, &#39;taylor&#39;]</span>
</pre></div>

<p>For the inverse of <code>whenEmpty</code>, see the <a href="#method-whennotempty"><code>whenNotEmpty</code></a> method.</p>

<p><a name="method-whennotempty"></a></p>

<h4><code>whenNotEmpty()</code> {#collection-method}</h4>

<p>The <code>whenNotEmpty</code> method will execute the given callback when the collection is not empty:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;michael&#39;</span><span class="p">,</span> <span class="s1">&#39;tom&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenNotEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;michael&#39;, &#39;tom&#39;, &#39;adam&#39;]</span>


<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">();</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenNotEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// []</span>


<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">();</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whenNotEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;adam&#39;</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;taylor&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;taylor&#39;]</span>
</pre></div>

<p>For the inverse of <code>whenNotEmpty</code>, see the <a href="#method-whenempty"><code>whenEmpty</code></a> method.</p>

<p><a name="method-where"></a></p>

<h4><code>where()</code> {#collection-method}</h4>

<p>The <code>where</code> method filters the collection by a given key / value pair:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Door&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>where</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value. Use the <a href="#method-wherestrict"><code>whereStrict</code></a> method to filter using &quot;strict&quot; comparisons.</p>

<p>Optionally, you may pass a comparison operator as the second parameter.</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jim&#39;</span><span class="p">,</span> <span class="s1">&#39;deleted_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;2019-01-01 00:00:00&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="s1">&#39;deleted_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;2019-01-02 00:00:00&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sue&#39;</span><span class="p">,</span> <span class="s1">&#39;deleted_at&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Jim&#39;, &#39;deleted_at&#39; =&gt; &#39;2019-01-01 00:00:00&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Sally&#39;, &#39;deleted_at&#39; =&gt; &#39;2019-01-02 00:00:00&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-wherestrict"></a></p>

<h4><code>whereStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-where"><code>where</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<p><a name="method-wherebetween"></a></p>

<h4><code>whereBetween()</code> {#collection-method}</h4>

<p>The <code>whereBetween</code> method filters the collection within a given range:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">80</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Pencil&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereBetween</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Bookcase&#39;, &#39;price&#39; =&gt; 150],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Door&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-wherein"></a></p>

<h4><code>whereIn()</code> {#collection-method}</h4>

<p>The <code>whereIn</code> method filters the collection by a given key / value contained within the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Bookcase&#39;, &#39;price&#39; =&gt; 150],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>whereIn</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value. Use the <a href="#method-whereinstrict"><code>whereInStrict</code></a> method to filter using &quot;strict&quot; comparisons.</p>

<p><a name="method-whereinstrict"></a></p>

<h4><code>whereInStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-wherein"><code>whereIn</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<p><a name="method-whereinstanceof"></a></p>

<h4><code>whereInstanceOf()</code> {#collection-method}</h4>

<p>The <code>whereInstanceOf</code> method filters the collection by a given class type:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">User</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">User</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Post</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereInstanceOf</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [App\Models\User, App\Models\User]</span>
</pre></div>

<p><a name="method-wherenotbetween"></a></p>

<h4><code>whereNotBetween()</code> {#collection-method}</h4>

<p>The <code>whereNotBetween</code> method filters the collection within a given range:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">80</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Pencil&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">30</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereNotBetween</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 80],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Pencil&#39;, &#39;price&#39; =&gt; 30],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-wherenotin"></a></p>

<h4><code>whereNotIn()</code> {#collection-method}</h4>

<p>The <code>whereNotIn</code> method filters the collection by a given key / value not contained within the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Door&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Chair&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">        [&#39;product&#39; =&gt; &#39;Door&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>The <code>whereNotIn</code> method uses &quot;loose&quot; comparisons when checking item values, meaning a string with an integer value will be considered equal to an integer of the same value. Use the <a href="#method-wherenotinstrict"><code>whereNotInStrict</code></a> method to filter using &quot;strict&quot; comparisons.</p>

<p><a name="method-wherenotinstrict"></a></p>

<h4><code>whereNotInStrict()</code> {#collection-method}</h4>

<p>This method has the same signature as the <a href="#method-wherenotin"><code>whereNotIn</code></a> method; however, all values are compared using &quot;strict&quot; comparisons.</p>

<p><a name="method-wherenotnull"></a></p>

<h4><code>whereNotNull()</code> {#collection-method}</h4>

<p>The <code>whereNotNull</code> method filters items where the given key is not null:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereNotNull</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Bookcase&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-wherenull"></a></p>

<h4><code>whereNull()</code> {#collection-method}</h4>

<p>The <code>whereNull</code> method filters items where the given key is null:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bookcase&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$filtered</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; null],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-wrap"></a></p>

<h4><code>wrap()</code> {#collection-method}</h4>

<p>The static <code>wrap</code> method wraps the given value in a collection when applicable:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">wrap</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;John Doe&#39;]</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">wrap</span><span class="p">([</span><span class="s1">&#39;John Doe&#39;</span><span class="p">]);</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;John Doe&#39;]</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">collect</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">));</span>

<span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [&#39;John Doe&#39;]</span>
</pre></div>

<p><a name="method-zip"></a></p>

<h4><code>zip()</code> {#collection-method}</h4>

<p>The <code>zip</code> method merges together the values of the given array with the values of the original collection at the corresponding index:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;Chair&#39;</span><span class="p">,</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="nx">$zipped</span> <span class="o">=</span> <span class="nx">$collection</span><span class="o">-&gt;</span><span class="nx">zip</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]);</span>

<span class="nx">$zipped</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// [[&#39;Chair&#39;, 100], [&#39;Desk&#39;, 200]]</span>
</pre></div>

<p><a name="higher-order-messages"></a></p>

<h2>Higher Order Messages</h2>

<p>Collections also provide support for &quot;higher order messages&quot;, which are short-cuts for performing common actions on collections. The collection methods that provide higher order messages are: <a href="#method-average"><code>average</code></a>, <a href="#method-avg"><code>avg</code></a>, <a href="#method-contains"><code>contains</code></a>, <a href="#method-each"><code>each</code></a>, <a href="#method-every"><code>every</code></a>, <a href="#method-filter"><code>filter</code></a>, <a href="#method-first"><code>first</code></a>, <a href="#method-flatmap"><code>flatMap</code></a>, <a href="#method-groupby"><code>groupBy</code></a>, <a href="#method-keyby"><code>keyBy</code></a>, <a href="#method-map"><code>map</code></a>, <a href="#method-max"><code>max</code></a>, <a href="#method-min"><code>min</code></a>, <a href="#method-partition"><code>partition</code></a>, <a href="#method-reject"><code>reject</code></a>, <a href="#method-skipuntil"><code>skipUntil</code></a>, <a href="#method-skipwhile"><code>skipWhile</code></a>, <a href="#method-some"><code>some</code></a>, <a href="#method-sortby"><code>sortBy</code></a>, <a href="#method-sortbydesc"><code>sortByDesc</code></a>, <a href="#method-sum"><code>sum</code></a>, <a href="#method-takeuntil"><code>takeUntil</code></a>, <a href="#method-takewhile"><code>takeWhile</code></a> and <a href="#method-unique"><code>unique</code></a>.</p>

<p>Each higher order message can be accessed as a dynamic property on a collection instance. For instance, let&#39;s use the <code>each</code> higher order message to call a method on each object within a collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">each</span><span class="o">-&gt;</span><span class="nx">markAsVip</span><span class="p">();</span>
</pre></div>

<p>Likewise, we can use the <code>sum</code> higher order message to gather the total number of &quot;votes&quot; for a collection of users:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;Development&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">sum</span><span class="o">-&gt;</span><span class="nx">votes</span><span class="p">;</span>
</pre></div>

<p><a name="lazy-collections"></a></p>

<h2>Lazy Collections</h2>

<p><a name="lazy-collection-introduction"></a></p>

<h3>Introduction</h3>

<blockquote>
<p>{note} Before learning more about Laravel&#39;s lazy collections, take some time to familiarize yourself with <a href="https://www.php.net/manual/en/language.generators.overview.php">PHP generators</a>.</p>
</blockquote>

<p>To supplement the already powerful <code>Collection</code> class, the <code>LazyCollection</code> class leverages PHP&#39;s <a href="https://www.php.net/manual/en/language.generators.overview.php">generators</a> to allow you to work with very large datasets while keeping memory usage low.</p>

<p>For example, imagine your application needs to process a multi-gigabyte log file while taking advantage of Laravel&#39;s collection methods to parse the logs. Instead of reading the entire file into memory at once, lazy collections may be used to keep only a small part of the file in memory at a given time:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">LogEntry</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">LazyCollection</span><span class="p">;</span>

<span class="nx">LazyCollection</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$handle</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">((</span><span class="nx">$line</span> <span class="o">=</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">$handle</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nx">$line</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">LogEntry</span><span class="o">::</span><span class="nx">fromLines</span><span class="p">(</span><span class="nx">$lines</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">LogEntry</span> <span class="nx">$logEntry</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Process the log entry...</span>
<span class="p">});</span>
</pre></div>

<p>Or, imagine you need to iterate through 10,000 Eloquent models. When using traditional Laravel collections, all 10,000 Eloquent models must be loaded into memory at the same time:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>However, the query builder&#39;s <code>cursor</code> method returns a <code>LazyCollection</code> instance. This allows you to still only run a single query against the database but also only keep one Eloquent model loaded in memory at a time. In this example, the <code>filter</code> callback is not executed until we actually iterate over each user individually, allowing for a drastic reduction in memory usage:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">cursor</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="creating-lazy-collections"></a></p>

<h3>Creating Lazy Collections</h3>

<p>To create a lazy collection instance, you should pass a PHP generator function to the collection&#39;s <code>make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">LazyCollection</span><span class="p">;</span>

<span class="nx">LazyCollection</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$handle</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">((</span><span class="nx">$line</span> <span class="o">=</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">$handle</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nx">$line</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="the-enumerable-contract"></a></p>

<h3>The Enumerable Contract</h3>

<p>Almost all methods available on the <code>Collection</code> class are also available on the <code>LazyCollection</code> class. Both of these classes implement the <code>Illuminate\Support\Enumerable</code> contract, which defines the following methods:</p>

<div id="collection-method-list" markdown="1">

[all](#method-all)
[average](#method-average)
[avg](#method-avg)
[chunk](#method-chunk)
[chunkWhile](#method-chunkwhile)
[collapse](#method-collapse)
[collect](#method-collect)
[combine](#method-combine)
[concat](#method-concat)
[contains](#method-contains)
[containsStrict](#method-containsstrict)
[count](#method-count)
[countBy](#method-countBy)
[crossJoin](#method-crossjoin)
[dd](#method-dd)
[diff](#method-diff)
[diffAssoc](#method-diffassoc)
[diffKeys](#method-diffkeys)
[dump](#method-dump)
[duplicates](#method-duplicates)
[duplicatesStrict](#method-duplicatesstrict)
[each](#method-each)
[eachSpread](#method-eachspread)
[every](#method-every)
[except](#method-except)
[filter](#method-filter)
[first](#method-first)
[firstWhere](#method-first-where)
[flatMap](#method-flatmap)
[flatten](#method-flatten)
[flip](#method-flip)
[forPage](#method-forpage)
[get](#method-get)
[groupBy](#method-groupby)
[has](#method-has)
[implode](#method-implode)
[intersect](#method-intersect)
[intersectByKeys](#method-intersectbykeys)
[isEmpty](#method-isempty)
[isNotEmpty](#method-isnotempty)
[join](#method-join)
[keyBy](#method-keyby)
[keys](#method-keys)
[last](#method-last)
[macro](#method-macro)
[make](#method-make)
[map](#method-map)
[mapInto](#method-mapinto)
[mapSpread](#method-mapspread)
[mapToGroups](#method-maptogroups)
[mapWithKeys](#method-mapwithkeys)
[max](#method-max)
[median](#method-median)
[merge](#method-merge)
[mergeRecursive](#method-mergerecursive)
[min](#method-min)
[mode](#method-mode)
[nth](#method-nth)
[only](#method-only)
[pad](#method-pad)
[partition](#method-partition)
[pipe](#method-pipe)
[pluck](#method-pluck)
[random](#method-random)
[reduce](#method-reduce)
[reject](#method-reject)
[replace](#method-replace)
[replaceRecursive](#method-replacerecursive)
[reverse](#method-reverse)
[search](#method-search)
[shuffle](#method-shuffle)
[skip](#method-skip)
[slice](#method-slice)
[some](#method-some)
[sort](#method-sort)
[sortBy](#method-sortby)
[sortByDesc](#method-sortbydesc)
[sortKeys](#method-sortkeys)
[sortKeysDesc](#method-sortkeysdesc)
[split](#method-split)
[sum](#method-sum)
[take](#method-take)
[tap](#method-tap)
[times](#method-times)
[toArray](#method-toarray)
[toJson](#method-tojson)
[union](#method-union)
[unique](#method-unique)
[uniqueStrict](#method-uniquestrict)
[unless](#method-unless)
[unlessEmpty](#method-unlessempty)
[unlessNotEmpty](#method-unlessnotempty)
[unwrap](#method-unwrap)
[values](#method-values)
[when](#method-when)
[whenEmpty](#method-whenempty)
[whenNotEmpty](#method-whennotempty)
[where](#method-where)
[whereStrict](#method-wherestrict)
[whereBetween](#method-wherebetween)
[whereIn](#method-wherein)
[whereInStrict](#method-whereinstrict)
[whereInstanceOf](#method-whereinstanceof)
[whereNotBetween](#method-wherenotbetween)
[whereNotIn](#method-wherenotin)
[whereNotInStrict](#method-wherenotinstrict)
[wrap](#method-wrap)
[zip](#method-zip)

</div>

<blockquote>
<p>{note} Methods that mutate the collection (such as <code>shift</code>, <code>pop</code>, <code>prepend</code> etc.) are <em>not</em> available on the <code>LazyCollection</code> class.</p>
</blockquote>

<p><a name="lazy-collection-methods"></a></p>

<h3>Lazy Collection Methods</h3>

<p>In addition to the methods defined in the <code>Enumerable</code> contract, the <code>LazyCollection</code> class contains the following methods:</p>

<p><a name="method-tapEach"></a></p>

<h4><code>tapEach()</code> {#collection-method}</h4>

<p>While the <code>each</code> method calls the given callback for each item in the collection right away, the <code>tapEach</code> method only calls the given callback as the items are being pulled out of the list one by one:</p>
<div class="highlight"><pre><span></span><span class="nx">$lazyCollection</span> <span class="o">=</span> <span class="nx">LazyCollection</span><span class="o">::</span><span class="nx">times</span><span class="p">(</span><span class="nx">INF</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">tapEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dump</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Nothing has been dumped so far...</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">$lazyCollection</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// 3</span>
</pre></div>

<p><a name="method-remember"></a></p>

<h4><code>remember()</code> {#collection-method}</h4>

<p>The <code>remember</code> method returns a new lazy collection that will remember any values that have already been enumerated and will not retrieve them again when the collection is enumerated again:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">cursor</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">remember</span><span class="p">();</span>

<span class="c1">// No query has been executed yet...</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// The query has been executed and the first 5 users have been hydrated from the database...</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>

<span class="c1">// First 5 users come from the collection&#39;s cache... The rest are hydrated from the database...</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Configuration</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#environment-configuration">Environment Configuration</a>

<ul>
<li><a href="#environment-variable-types">Environment Variable Types</a></li>
<li><a href="#retrieving-environment-configuration">Retrieving Environment Configuration</a></li>
<li><a href="#determining-the-current-environment">Determining The Current Environment</a></li>
<li><a href="#hiding-environment-variables-from-debug">Hiding Environment Variables From Debug Pages</a></li>
</ul></li>
<li><a href="#accessing-configuration-values">Accessing Configuration Values</a></li>
<li><a href="#configuration-caching">Configuration Caching</a></li>
<li><a href="#maintenance-mode">Maintenance Mode</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>All of the configuration files for the Laravel framework are stored in the <code>config</code> directory. Each option is documented, so feel free to look through the files and get familiar with the options available to you.</p>

<p><a name="environment-configuration"></a></p>

<h2>Environment Configuration</h2>

<p>It is often helpful to have different configuration values based on the environment where the application is running. For example, you may wish to use a different cache driver locally than you do on your production server.</p>

<p>To make this a cinch, Laravel utilizes the <a href="https://github.com/vlucas/phpdotenv">DotEnv</a> PHP library by Vance Lucas. In a fresh Laravel installation, the root directory of your application will contain a <code>.env.example</code> file. If you install Laravel via Composer, this file will automatically be copied to <code>.env</code>. Otherwise, you should copy the file manually.</p>

<p>Your <code>.env</code> file should not be committed to your application&#39;s source control, since each developer / server using your application could require a different environment configuration. Furthermore, this would be a security risk in the event an intruder gains access to your source control repository, since any sensitive credentials would get exposed.</p>

<p>If you are developing with a team, you may wish to continue including a <code>.env.example</code> file with your application. By putting placeholder values in the example configuration file, other developers on your team can clearly see which environment variables are needed to run your application. You may also create a <code>.env.testing</code> file. This file will override the <code>.env</code> file when running PHPUnit tests or executing Artisan commands with the <code>--env=testing</code> option.</p>

<blockquote>
<p>{tip} Any variable in your <code>.env</code> file can be overridden by external environment variables such as server-level or system-level environment variables.</p>
</blockquote>

<p><a name="environment-variable-types"></a></p>

<h3>Environment Variable Types</h3>

<p>All variables in your <code>.env</code> files are parsed as strings, so some reserved values have been created to allow you to return a wider range of types from the <code>env()</code> function:</p>

<p><code>.env</code> Value  | <code>env()</code> Value
------------- | -------------
true | (bool) true
(true) | (bool) true
false | (bool) false
(false) | (bool) false
empty | (string) &#39;&#39;
(empty) | (string) &#39;&#39;
null | (null) null
(null) | (null) null</p>

<p>If you need to define an environment variable with a value that contains spaces, you may do so by enclosing the value in double quotes.</p>
<div class="highlight"><pre><span></span><span class="nx">APP_NAME</span><span class="o">=</span><span class="s2">&quot;My Application&quot;</span>
</pre></div>

<p><a name="retrieving-environment-configuration"></a></p>

<h3>Retrieving Environment Configuration</h3>

<p>All of the variables listed in this file will be loaded into the <code>$_ENV</code> PHP super-global when your application receives a request. However, you may use the <code>env</code> helper to retrieve values from these variables in your configuration files. In fact, if you review the Laravel configuration files, you will notice several of the options already using this helper:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;debug&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_DEBUG&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">),</span>
</pre></div>

<p>The second value passed to the <code>env</code> function is the &quot;default value&quot;. This value will be used if no environment variable exists for the given key.</p>

<p><a name="determining-the-current-environment"></a></p>

<h3>Determining The Current Environment</h3>

<p>The current application environment is determined via the <code>APP_ENV</code> variable from your <code>.env</code> file. You may access this value via the <code>environment</code> method on the <code>App</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$environment</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">();</span>
</pre></div>

<p>You may also pass arguments to the <code>environment</code> method to check if the environment matches a given value. The method will return <code>true</code> if the environment matches any of the given values:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The environment is local</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">environment</span><span class="p">([</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;staging&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// The environment is either local OR staging...</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} The current application environment detection can be overridden by a server-level <code>APP_ENV</code> environment variable. This can be useful when you need to share the same application for different environment configurations, so you can set up a given host to match a given environment in your server&#39;s configurations.</p>
</blockquote>

<p><a name="hiding-environment-variables-from-debug"></a></p>

<h3>Hiding Environment Variables From Debug Pages</h3>

<p>When an exception is uncaught and the <code>APP_DEBUG</code> environment variable is <code>true</code>, the debug page will show all environment variables and their contents. In some cases you may want to obscure certain variables. You may do this by updating the <code>debug_hide</code> option in your <code>config/app.php</code> configuration file.</p>

<p>Some variables are available in both the environment variables and the server / request data. Therefore, you may need to hide them for both <code>$_ENV</code> and <code>$_SERVER</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">[</span>

    <span class="c1">// ...</span>

    <span class="s1">&#39;debug_hide&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;_ENV&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;APP_KEY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="s1">&#39;_SERVER&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;APP_KEY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="s1">&#39;_POST&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p><a name="accessing-configuration-values"></a></p>

<h2>Accessing Configuration Values</h2>

<p>You may easily access your configuration values using the global <code>config</code> helper function from anywhere in your application. The configuration values may be accessed using &quot;dot&quot; syntax, which includes the name of the file and option you wish to access. A default value may also be specified and will be returned if the configuration option does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve a default value if the configuration value does not exist...</span>
<span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;Asia/Seoul&#39;</span><span class="p">);</span>
</pre></div>

<p>To set configuration values at runtime, pass an array to the <code>config</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.timezone&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="configuration-caching"></a></p>

<h2>Configuration Caching</h2>

<p>To give your application a speed boost, you should cache all of your configuration files into a single file using the <code>config:cache</code> Artisan command. This will combine all of the configuration options for your application into a single file which will be loaded quickly by the framework.</p>

<p>You should typically run the <code>php artisan config:cache</code> command as part of your production deployment routine. The command should not be run during local development as configuration options will frequently need to be changed during the course of your application&#39;s development.</p>

<blockquote>
<p>{note} If you execute the <code>config:cache</code> command during your deployment process, you should be sure that you are only calling the <code>env</code> function from within your configuration files. Once the configuration has been cached, the <code>.env</code> file will not be loaded and all calls to the <code>env</code> function will return <code>null</code>.</p>
</blockquote>

<p><a name="maintenance-mode"></a></p>

<h2>Maintenance Mode</h2>

<p>When your application is in maintenance mode, a custom view will be displayed for all requests into your application. This makes it easy to &quot;disable&quot; your application while it is updating or when you are performing maintenance. A maintenance mode check is included in the default middleware stack for your application. If the application is in maintenance mode, a <code>MaintenanceModeException</code> will be thrown with a status code of 503.</p>

<p>To enable maintenance mode, execute the <code>down</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span>
</pre></div>

<p>You may also provide <code>message</code> and <code>retry</code> options to the <code>down</code> command. The <code>message</code> value may be used to display or log a custom message, while the <code>retry</code> value will be set as the <code>Retry-After</code> HTTP header&#39;s value:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span> <span class="o">--</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;Upgrading Database&quot;</span> <span class="o">--</span><span class="nx">retry</span><span class="o">=</span><span class="mi">60</span>
</pre></div>

<h4>Bypassing Maintenance Mode</h4>

<p>Even while in maintenance mode, you may use use the <code>secret</code> option to specify a maintenance mode bypass token:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span> <span class="o">--</span><span class="nx">secret</span><span class="o">=</span><span class="s2">&quot;1630542a-246b-4b66-afa1-dd72a4c43515&quot;</span>
</pre></div>

<p>After placing the application in maintenance mode, you may navigate to the application URL matching this token and Laravel will issue a maintenance mode bypass cookie to your browser:</p>
<div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//example.com/1630542a-246b-4b66-afa1-dd72a4c43515</span>
</pre></div>

<p>When accessing this hidden route, you will then be redirected to the <code>/</code> route of the application. Once the cookie has been issued to your browser, you will be able to browse the application normally as if it was not in maintenance mode.</p>

<h4>Pre-Rendering The Maintenace Mode View</h4>

<p>If you utilize the <code>php artisan down</code> command during deployment, your users may still occasionally encounter errors if they access the application while your Composer dependencies or other infrastructure components are updating. This occurs because a significant part of the Laravel framework must boot in order to determine your application is in maintenance mode and render the maintenance mode view using the templating engine.</p>

<p>For this reason, Laravel allows you to pre-render a maintenance mode view that will be returned at the very beginning of the request cycle. This view is rendered before any of your application&#39;s dependencies have loaded. You may pre-render a template of your choice using the <code>down</code> command&#39;s <code>render</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span> <span class="o">--</span><span class="nx">render</span><span class="o">=</span><span class="s2">&quot;errors::503&quot;</span>
</pre></div>

<h4>Redirecting Maintenance Mode Requests</h4>

<p>While in maintenance mode, Laravel will display the maintenance mode view for all application URLs the user attempts to access. If you wish, you may instruct Laravel to redirect all requests to a specific URL. This may be accomplished using the <code>redirect</code> option. For example, you may wish to redirect all requests to the <code>/</code> URI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">down</span> <span class="o">--</span><span class="nx">redirect</span><span class="o">=</span><span class="err">/</span>
</pre></div>

<h4>Disabling Maintenance Mode</h4>

<p>To disable maintenance mode, use the <code>up</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">up</span>
</pre></div>

<blockquote>
<p>{tip} You may customize the default maintenance mode template by defining your own template at <code>resources/views/errors/503.blade.php</code>.</p>
</blockquote>

<h4>Maintenance Mode &amp; Queues</h4>

<p>While your application is in maintenance mode, no <a href="/docs/%7B%7Bversion%7D%7D/queues">queued jobs</a> will be handled. The jobs will continue to be handled as normal once the application is out of maintenance mode.</p>

<h4>Alternatives To Maintenance Mode</h4>

<p>Since maintenance mode requires your application to have several seconds of downtime, consider alternatives like <a href="https://envoyer.io">Envoyer</a> to accomplish zero-downtime deployment with Laravel.</p>
<div style="page-break-after: always;" ></div><h1>Console Tests</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#expecting-input-and-output">Expecting Input / Output</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to simplifying HTTP testing, Laravel provides a simple API for testing console applications that ask for user input.</p>

<p><a name="expecting-input-and-output"></a></p>

<h2>Expecting Input / Output</h2>

<p>Laravel allows you to easily &quot;mock&quot; user input for your console commands using the <code>expectsQuestion</code> method. In addition, you may specify the exit code and text that you expect to be output by the console command using the <code>assertExitCode</code> and <code>expectsOutput</code> methods. For example, consider the following console command:</p>
<div class="highlight"><pre><span></span><span class="nx">Artisan</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;question&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$name</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">ask</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">);</span>

    <span class="nx">$language</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">choice</span><span class="p">(</span><span class="s1">&#39;Which language do you program in?&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;PHP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Ruby&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Python&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;Your name is &#39;</span><span class="p">.</span><span class="nx">$name</span><span class="p">.</span><span class="s1">&#39; and you program in &#39;</span><span class="p">.</span><span class="nx">$language</span><span class="p">.</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may test this command with the following test which utilizes the <code>expectsQuestion</code>, <code>expectsOutput</code>, and <code>assertExitCode</code> methods:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Test a console command.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testConsoleCommand</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">artisan</span><span class="p">(</span><span class="s1">&#39;question&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">expectsQuestion</span><span class="p">(</span><span class="s1">&#39;What is your name?&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor Otwell&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">expectsQuestion</span><span class="p">(</span><span class="s1">&#39;Which language do you program in?&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">expectsOutput</span><span class="p">(</span><span class="s1">&#39;Your name is Taylor Otwell and you program in PHP.&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">assertExitCode</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>When writing a command which expects a confirmation in the form of a &quot;yes&quot; or &quot;no&quot; answer, you may utilize the <code>expectsConfirmation</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">artisan</span><span class="p">(</span><span class="s1">&#39;module:import&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">expectsConfirmation</span><span class="p">(</span><span class="s1">&#39;Do you really wish to run this command?&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">assertExitCode</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Service Container</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#binding">Binding</a>

<ul>
<li><a href="#binding-basics">Binding Basics</a></li>
<li><a href="#binding-interfaces-to-implementations">Binding Interfaces To Implementations</a></li>
<li><a href="#contextual-binding">Contextual Binding</a></li>
<li><a href="#binding-primitives">Binding Primitives</a></li>
<li><a href="#binding-typed-variadics">Binding Typed Variadics</a></li>
<li><a href="#tagging">Tagging</a></li>
<li><a href="#extending-bindings">Extending Bindings</a></li>
</ul></li>
<li><a href="#resolving">Resolving</a>

<ul>
<li><a href="#the-make-method">The Make Method</a></li>
<li><a href="#automatic-injection">Automatic Injection</a></li>
</ul></li>
<li><a href="#container-events">Container Events</a></li>
<li><a href="#psr-11">PSR-11</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel service container is a powerful tool for managing class dependencies and performing dependency injection. Dependency injection is a fancy phrase that essentially means this: class dependencies are &quot;injected&quot; into the class via the constructor or, in some cases, &quot;setter&quot; methods.</p>

<p>Let&#39;s look at a simple example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Repositories\UserRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository implementation.</span>
<span class="sd">     *</span>
<span class="sd">     * @var UserRepository</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, the <code>UserController</code> needs to retrieve users from a data source. So, we will <strong>inject</strong> a service that is able to retrieve users. In this context, our <code>UserRepository</code> most likely uses <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> to retrieve user information from the database. However, since the repository is injected, we are able to easily swap it out with another implementation. We are also able to easily &quot;mock&quot;, or create a dummy implementation of the <code>UserRepository</code> when testing our application.</p>

<p>A deep understanding of the Laravel service container is essential to building a powerful, large application, as well as for contributing to the Laravel core itself.</p>

<p><a name="binding"></a></p>

<h2>Binding</h2>

<p><a name="binding-basics"></a></p>

<h3>Binding Basics</h3>

<p>Almost all of your service container bindings will be registered within <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a>, so most of these examples will demonstrate using the container in that context.</p>

<blockquote>
<p>{tip} There is no need to bind classes into the container if they do not depend on any interfaces. The container does not need to be instructed on how to build these objects, since it can automatically resolve these objects using reflection.</p>
</blockquote>

<h4>Simple Bindings</h4>

<p>Within a service provider, you always have access to the container via the <code>$this-&gt;app</code> property. We can register a binding using the <code>bind</code> method, passing the class or interface name that we wish to register along with a <code>Closure</code> that returns an instance of the class:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="err">\</span><span class="nx">HelpSpot</span><span class="err">\</span><span class="nx">API</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;HttpClient&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>Note that we receive the container itself as an argument to the resolver. We can then use the container to resolve sub-dependencies of the object we are building.</p>

<h4>Binding A Singleton</h4>

<p>The <code>singleton</code> method binds a class or interface into the container that should only be resolved one time. Once a singleton binding is resolved, the same object instance will be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">singleton</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="err">\</span><span class="nx">HelpSpot</span><span class="err">\</span><span class="nx">API</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;HttpClient&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<h4>Binding Instances</h4>

<p>You may also bind an existing object instance into the container using the <code>instance</code> method. The given instance will always be returned on subsequent calls into the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="k">new</span> <span class="err">\</span><span class="nx">HelpSpot</span><span class="err">\</span><span class="nx">API</span><span class="p">(</span><span class="k">new</span> <span class="nx">HttpClient</span><span class="p">);</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">instance</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">,</span> <span class="nx">$api</span><span class="p">);</span>
</pre></div>

<p><a name="binding-interfaces-to-implementations"></a></p>

<h3>Binding Interfaces To Implementations</h3>

<p>A very powerful feature of the service container is its ability to bind an interface to a given implementation. For example, let&#39;s assume we have an <code>EventPusher</code> interface and a <code>RedisEventPusher</code> implementation. Once we have coded our <code>RedisEventPusher</code> implementation of this interface, we can register it with the service container like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span>
    <span class="s1">&#39;App\Contracts\EventPusher&#39;</span><span class="p">,</span>
    <span class="s1">&#39;App\Services\RedisEventPusher&#39;</span>
<span class="p">);</span>
</pre></div>

<p>This statement tells the container that it should inject the <code>RedisEventPusher</code> when a class needs an implementation of <code>EventPusher</code>. Now we can type-hint the <code>EventPusher</code> interface in a constructor, or any other location where dependencies are injected by the service container:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">EventPusher</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Create a new class instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  EventPusher  $pusher</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">EventPusher</span> <span class="nx">$pusher</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">pusher</span> <span class="o">=</span> <span class="nx">$pusher</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="contextual-binding"></a></p>

<h3>Contextual Binding</h3>

<p>Sometimes you may have two classes that utilize the same interface, but you wish to inject different implementations into each class. For example, two controllers may depend on different implementations of the <code>Illuminate\Contracts\Filesystem\Filesystem</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a>. Laravel provides a simple, fluent interface for defining this behavior:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">PhotoController</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">UploadController</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">VideoController</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Filesystem</span><span class="err">\</span><span class="nx">Filesystem</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="nx">Filesystem</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">);</span>
          <span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">([</span><span class="nx">VideoController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="nx">UploadController</span><span class="o">::</span><span class="kr">class</span><span class="p">])</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="nx">Filesystem</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">);</span>
          <span class="p">});</span>
</pre></div>

<p><a name="binding-primitives"></a></p>

<h3>Binding Primitives</h3>

<p>Sometimes you may have a class that receives some injected classes, but also needs an injected primitive value such as an integer. You may easily use contextual binding to inject any value your class may need:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\UserController&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="s1">&#39;$variableName&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p>Sometimes a class may depend on an array of tagged instances. Using the <code>giveTagged</code> method, you may easily inject all of the container bindings with that tag:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">ReportAggregator</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="s1">&#39;$reports&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">giveTagged</span><span class="p">(</span><span class="s1">&#39;reports&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="binding-typed-variadics"></a></p>

<h3>Binding Typed Variadics</h3>

<p>Occasionally you may have a class that receives an array of typed objects using a variadic constructor argument:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Firewall</span>
<span class="p">{</span>
    <span class="kr">protected</span> <span class="nx">$logger</span><span class="p">;</span>
    <span class="kr">protected</span> <span class="nx">$filters</span><span class="p">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">Logger</span> <span class="nx">$logger</span><span class="p">,</span> <span class="nx">Filter</span> <span class="p">...</span><span class="nx">$filters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">logger</span> <span class="o">=</span> <span class="nx">$logger</span><span class="p">;</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">filters</span> <span class="o">=</span> <span class="nx">$filters</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Using contextual binding, you may resolve this dependency by providing the <code>give</code> method with a Closure that returns an array of resolved <code>Filter</code> instances:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">Firewall</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="nx">Filter</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="nx">NullFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">),</span>
                    <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="nx">ProfanityFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">),</span>
                    <span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="nx">TooLongFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">),</span>
                <span class="p">];</span>
          <span class="p">});</span>
</pre></div>

<p>For convenience, you may also just provide an array of class names to be resolved by the container whenever <code>Firewall</code> needs <code>Filter</code> instances:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">Firewall</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="nx">Filter</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">give</span><span class="p">([</span>
              <span class="nx">NullFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
              <span class="nx">ProfanityFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
              <span class="nx">TooLongFilter</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
          <span class="p">]);</span>
</pre></div>

<h4>Variadic Tag Dependencies</h4>

<p>Sometimes a class may have a variadic dependency that is type-hinted as a given class (<code>Report ...$reports</code>). Using the <code>needs</code> and <code>giveTagged</code> methods, you may easily inject all of the container bindings with that tag for the given dependency:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">ReportAggregator</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">needs</span><span class="p">(</span><span class="nx">Report</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">giveTagged</span><span class="p">(</span><span class="s1">&#39;reports&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="tagging"></a></p>

<h3>Tagging</h3>

<p>Occasionally, you may need to resolve all of a certain &quot;category&quot; of binding. For example, perhaps you are building a report aggregator that receives an array of many different <code>Report</code> interface implementations. After registering the <code>Report</code> implementations, you can assign them a tag using the <code>tag</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;MemoryReport&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">tag</span><span class="p">([</span><span class="s1">&#39;SpeedReport&#39;</span><span class="p">,</span> <span class="s1">&#39;MemoryReport&#39;</span><span class="p">],</span> <span class="s1">&#39;reports&#39;</span><span class="p">);</span>
</pre></div>

<p>Once the services have been tagged, you may easily resolve them all via the <code>tagged</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;ReportAggregator&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">ReportAggregator</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">tagged</span><span class="p">(</span><span class="s1">&#39;reports&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p><a name="extending-bindings"></a></p>

<h3>Extending Bindings</h3>

<p>The <code>extend</code> method allows the modification of resolved services. For example, when a service is resolved, you may run additional code to decorate or configure the service. The <code>extend</code> method accepts a Closure, which should return the modified service, as its only argument. The Closure receives the service being resolved and the container instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$service</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">DecoratedService</span><span class="p">(</span><span class="nx">$service</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="resolving"></a></p>

<h2>Resolving</h2>

<p><a name="the-make-method"></a></p>

<h4>The <code>make</code> Method</h4>

<p>You may use the <code>make</code> method to resolve a class instance out of the container. The <code>make</code> method accepts the name of the class or interface you wish to resolve:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">);</span>
</pre></div>

<p>If you are in a location of your code that does not have access to the <code>$app</code> variable, you may use the global <code>resolve</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">);</span>
</pre></div>

<p>If some of your class&#39; dependencies are not resolvable via the container, you may inject them by passing them as an associative array into the <code>makeWith</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">makeWith</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="automatic-injection"></a></p>

<h4>Automatic Injection</h4>

<p>Alternatively, and importantly, you may &quot;type-hint&quot; the dependency in the constructor of a class that is resolved by the container, including <a href="/docs/%7B%7Bversion%7D%7D/controllers">controllers</a>, <a href="/docs/%7B%7Bversion%7D%7D/events">event listeners</a>, <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a>, and more. Additionally, you may type-hint dependencies in the <code>handle</code> method of <a href="/docs/%7B%7Bversion%7D%7D/queues">queued jobs</a>. In practice, this is how most of your objects should be resolved by the container.</p>

<p>For example, you may type-hint a repository defined by your application in a controller&#39;s constructor. The repository will automatically be resolved and injected into the class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Users\Repository</span> <span class="k">as</span> <span class="nx">UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the user with the given ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="container-events"></a></p>

<h2>Container Events</h2>

<p>The service container fires an event each time it resolves an object. You may listen to this event using the <code>resolving</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$object</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Called when container resolves object of any type...</span>
<span class="p">});</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">resolving</span><span class="p">(</span><span class="err">\</span><span class="nx">HelpSpot</span><span class="err">\</span><span class="nx">API</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$api</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Called when container resolves objects of type &quot;HelpSpot\API&quot;...</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the object being resolved will be passed to the callback, allowing you to set any additional properties on the object before it is given to its consumer.</p>

<p><a name="psr-11"></a></p>

<h2>PSR-11</h2>

<p>Laravel&#39;s service container implements the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-11-container.md">PSR-11</a> interface. Therefore, you may type-hint the PSR-11 container interface to obtain an instance of the Laravel container:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Psr</span><span class="err">\</span><span class="nx">Container</span><span class="err">\</span><span class="nx">ContainerInterface</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ContainerInterface</span> <span class="nx">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$service</span> <span class="o">=</span> <span class="nx">$container</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;Service&#39;</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>An exception is thrown if the given identifier can&#39;t be resolved. The exception will be an instance of <code>Psr\Container\NotFoundExceptionInterface</code> if the identifier was never bound. If the identifier was bound but was unable to be resolved, an instance of <code>Psr\Container\ContainerExceptionInterface</code> will be thrown.</p>
<div style="page-break-after: always;" ></div><h1>Contracts</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#contracts-vs-facades">Contracts Vs. Facades</a></li>
</ul></li>
<li><a href="#when-to-use-contracts">When To Use Contracts</a>

<ul>
<li><a href="#loose-coupling">Loose Coupling</a></li>
<li><a href="#simplicity">Simplicity</a></li>
</ul></li>
<li><a href="#how-to-use-contracts">How To Use Contracts</a></li>
<li><a href="#contract-reference">Contract Reference</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s Contracts are a set of interfaces that define the core services provided by the framework. For example, a <code>Illuminate\Contracts\Queue\Queue</code> contract defines the methods needed for queueing jobs, while the <code>Illuminate\Contracts\Mail\Mailer</code> contract defines the methods needed for sending e-mail.</p>

<p>Each contract has a corresponding implementation provided by the framework. For example, Laravel provides a queue implementation with a variety of drivers, and a mailer implementation that is powered by <a href="https://swiftmailer.symfony.com/">SwiftMailer</a>.</p>

<p>All of the Laravel contracts live in <a href="https://github.com/illuminate/contracts">their own GitHub repository</a>. This provides a quick reference point for all available contracts, as well as a single, decoupled package that may be utilized by package developers.</p>

<p><a name="contracts-vs-facades"></a></p>

<h3>Contracts Vs. Facades</h3>

<p>Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/facades">facades</a> and helper functions provide a simple way of utilizing Laravel&#39;s services without needing to type-hint and resolve contracts out of the service container. In most cases, each facade has an equivalent contract.</p>

<p>Unlike facades, which do not require you to require them in your class&#39; constructor, contracts allow you to define explicit dependencies for your classes. Some developers prefer to explicitly define their dependencies in this way and therefore prefer to use contracts, while other developers enjoy the convenience of facades.</p>

<blockquote>
<p>{tip} Most applications will be fine regardless of whether you prefer facades or contracts. However, if you are building a package, you should strongly consider using contracts since they will be easier to test in a package context.</p>
</blockquote>

<p><a name="when-to-use-contracts"></a></p>

<h2>When To Use Contracts</h2>

<p>As discussed elsewhere, much of the decision to use contracts or facades will come down to personal taste and the tastes of your development team. Both contracts and facades can be used to create robust, well-tested Laravel applications. As long as you are keeping your class&#39; responsibilities focused, you will notice very few practical differences between using contracts and facades.</p>

<p>However, you may still have several questions regarding contracts. For example, why use interfaces at all? Isn&#39;t using interfaces more complicated? Let&#39;s distill the reasons for using interfaces to the following headings: loose coupling and simplicity.</p>

<p><a name="loose-coupling"></a></p>

<h3>Loose Coupling</h3>

<p>First, let&#39;s review some code that is tightly coupled to a cache implementation. Consider the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The cache instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$cache</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \SomePackage\Cache\Memcached  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">\SomePackage\Cache\Memcached</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Retrieve an Order by ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Order</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this class, the code is tightly coupled to a given cache implementation. It is tightly coupled because we are depending on a concrete Cache class from a package vendor. If the API of that package changes our code must change as well.</p>

<p>Likewise, if we want to replace our underlying cache technology (Memcached) with another technology (Redis), we again will have to modify our repository. Our repository should not have so much knowledge regarding who is providing them data or how they are providing it.</p>

<p><strong>Instead of this approach, we can improve our code by depending on a simple, vendor agnostic interface:</strong></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Orders</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Cache\Repository</span> <span class="k">as</span> <span class="nx">Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Repository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The cache instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$cache</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new repository instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Cache  $cache</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Cache</span> <span class="nv">$cache</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$cache</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now the code is not coupled to any specific vendor, or even Laravel. Since the contracts package contains no implementation and no dependencies, you may easily write an alternative implementation of any given contract, allowing you to replace your cache implementation without modifying any of your cache consuming code.</p>

<p><a name="simplicity"></a></p>

<h3>Simplicity</h3>

<p>When all of Laravel&#39;s services are neatly defined within simple interfaces, it is very easy to determine the functionality offered by a given service. <strong>The contracts serve as succinct documentation to the framework&#39;s features.</strong></p>

<p>In addition, when you depend on simple interfaces, your code is easier to understand and maintain. Rather than tracking down which methods are available to you within a large, complicated class, you can refer to a simple, clean interface.</p>

<p><a name="how-to-use-contracts"></a></p>

<h2>How To Use Contracts</h2>

<p>So, how do you get an implementation of a contract? It&#39;s actually quite simple.</p>

<p>Many types of classes in Laravel are resolved through the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, including controllers, event listeners, middleware, queued jobs, and even route Closures. So, to get an implementation of a contract, you can just &quot;type-hint&quot; the interface in the constructor of the class being resolved.</p>

<p>For example, take a look at this event listener:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderWasPlaced</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Redis\Factory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheOrderInformation</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The Redis factory implementation.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$redis</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event handler instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Factory  $redis</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Factory</span> <span class="nv">$redis</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redis</span> <span class="o">=</span> <span class="nv">$redis</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  OrderWasPlaced  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderWasPlaced</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When the event listener is resolved, the service container will read the type-hints on the constructor of the class, and inject the appropriate value. To learn more about registering things in the service container, check out <a href="/docs/%7B%7Bversion%7D%7D/container">its documentation</a>.</p>

<p><a name="contract-reference"></a></p>

<h2>Contract Reference</h2>

<p>This table provides a quick reference to all of the Laravel contracts and their equivalent facades:</p>

<p>Contract  |  References Facade
------------- | -------------
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/Access/Authorizable.php">Illuminate\Contracts\Auth\Access\Authorizable</a> |&nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/Access/Gate.php">Illuminate\Contracts\Auth\Access\Gate</a> | <code>Gate</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/Authenticatable.php">Illuminate\Contracts\Auth\Authenticatable</a> |&nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/CanResetPassword.php">Illuminate\Contracts\Auth\CanResetPassword</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/Factory.php">Illuminate\Contracts\Auth\Factory</a> | <code>Auth</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/Guard.php">Illuminate\Contracts\Auth\Guard</a> | <code>Auth::guard()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/PasswordBroker.php">Illuminate\Contracts\Auth\PasswordBroker</a> | <code>Password::broker()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/PasswordBrokerFactory.php">Illuminate\Contracts\Auth\PasswordBrokerFactory</a> | <code>Password</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/StatefulGuard.php">Illuminate\Contracts\Auth\StatefulGuard</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/SupportsBasicAuth.php">Illuminate\Contracts\Auth\SupportsBasicAuth</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Auth/UserProvider.php">Illuminate\Contracts\Auth\UserProvider</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Bus/Dispatcher.php">Illuminate\Contracts\Bus\Dispatcher</a> | <code>Bus</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Bus/QueueingDispatcher.php">Illuminate\Contracts\Bus\QueueingDispatcher</a> | <code>Bus::dispatchToQueue()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Broadcasting/Factory.php">Illuminate\Contracts\Broadcasting\Factory</a> | <code>Broadcast</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Broadcasting/Broadcaster.php">Illuminate\Contracts\Broadcasting\Broadcaster</a>  | <code>Broadcast::connection()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Broadcasting/ShouldBroadcast.php">Illuminate\Contracts\Broadcasting\ShouldBroadcast</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Broadcasting/ShouldBroadcastNow.php">Illuminate\Contracts\Broadcasting\ShouldBroadcastNow</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cache/Factory.php">Illuminate\Contracts\Cache\Factory</a> | <code>Cache</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cache/Lock.php">Illuminate\Contracts\Cache\Lock</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cache/LockProvider.php">Illuminate\Contracts\Cache\LockProvider</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cache/Repository.php">Illuminate\Contracts\Cache\Repository</a> | <code>Cache::driver()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cache/Store.php">Illuminate\Contracts\Cache\Store</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Config/Repository.php">Illuminate\Contracts\Config\Repository</a> | <code>Config</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Console/Application.php">Illuminate\Contracts\Console\Application</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Console/Kernel.php">Illuminate\Contracts\Console\Kernel</a> | <code>Artisan</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Container/Container.php">Illuminate\Contracts\Container\Container</a> | <code>App</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cookie/Factory.php">Illuminate\Contracts\Cookie\Factory</a> | <code>Cookie</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Cookie/QueueingFactory.php">Illuminate\Contracts\Cookie\QueueingFactory</a> | <code>Cookie::queue()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Database/ModelIdentifier.php">Illuminate\Contracts\Database\ModelIdentifier</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Debug/ExceptionHandler.php">Illuminate\Contracts\Debug\ExceptionHandler</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Encryption/Encrypter.php">Illuminate\Contracts\Encryption\Encrypter</a> | <code>Crypt</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Events/Dispatcher.php">Illuminate\Contracts\Events\Dispatcher</a> | <code>Event</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Filesystem/Cloud.php">Illuminate\Contracts\Filesystem\Cloud</a> | <code>Storage::cloud()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Filesystem/Factory.php">Illuminate\Contracts\Filesystem\Factory</a> | <code>Storage</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Filesystem/Filesystem.php">Illuminate\Contracts\Filesystem\Filesystem</a> | <code>Storage::disk()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Foundation/Application.php">Illuminate\Contracts\Foundation\Application</a> | <code>App</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Hashing/Hasher.php">Illuminate\Contracts\Hashing\Hasher</a> | <code>Hash</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Http/Kernel.php">Illuminate\Contracts\Http\Kernel</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Mail/MailQueue.php">Illuminate\Contracts\Mail\MailQueue</a> | <code>Mail::queue()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Mail/Mailable.php">Illuminate\Contracts\Mail\Mailable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Mail/Mailer.php">Illuminate\Contracts\Mail\Mailer</a> | <code>Mail</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Notifications/Dispatcher.php">Illuminate\Contracts\Notifications\Dispatcher</a> | <code>Notification</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Notifications/Factory.php">Illuminate\Contracts\Notifications\Factory</a> | <code>Notification</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Pagination/LengthAwarePaginator.php">Illuminate\Contracts\Pagination\LengthAwarePaginator</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Pagination/Paginator.php">Illuminate\Contracts\Pagination\Paginator</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Pipeline/Hub.php">Illuminate\Contracts\Pipeline\Hub</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Pipeline/Pipeline.php">Illuminate\Contracts\Pipeline\Pipeline</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/EntityResolver.php">Illuminate\Contracts\Queue\EntityResolver</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/Factory.php">Illuminate\Contracts\Queue\Factory</a> | <code>Queue</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/Job.php">Illuminate\Contracts\Queue\Job</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/Monitor.php">Illuminate\Contracts\Queue\Monitor</a> | <code>Queue</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/Queue.php">Illuminate\Contracts\Queue\Queue</a> | <code>Queue::connection()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/QueueableCollection.php">Illuminate\Contracts\Queue\QueueableCollection</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/QueueableEntity.php">Illuminate\Contracts\Queue\QueueableEntity</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Queue/ShouldQueue.php">Illuminate\Contracts\Queue\ShouldQueue</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Redis/Factory.php">Illuminate\Contracts\Redis\Factory</a> | <code>Redis</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Routing/BindingRegistrar.php">Illuminate\Contracts\Routing\BindingRegistrar</a> | <code>Route</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Routing/Registrar.php">Illuminate\Contracts\Routing\Registrar</a> | <code>Route</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Routing/ResponseFactory.php">Illuminate\Contracts\Routing\ResponseFactory</a> | <code>Response</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Routing/UrlGenerator.php">Illuminate\Contracts\Routing\UrlGenerator</a> | <code>URL</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Routing/UrlRoutable.php">Illuminate\Contracts\Routing\UrlRoutable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Session/Session.php">Illuminate\Contracts\Session\Session</a> | <code>Session::driver()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/Arrayable.php">Illuminate\Contracts\Support\Arrayable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/Htmlable.php">Illuminate\Contracts\Support\Htmlable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/Jsonable.php">Illuminate\Contracts\Support\Jsonable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/MessageBag.php">Illuminate\Contracts\Support\MessageBag</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/MessageProvider.php">Illuminate\Contracts\Support\MessageProvider</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/Renderable.php">Illuminate\Contracts\Support\Renderable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Support/Responsable.php">Illuminate\Contracts\Support\Responsable</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Translation/Loader.php">Illuminate\Contracts\Translation\Loader</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Translation/Translator.php">Illuminate\Contracts\Translation\Translator</a> | <code>Lang</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Validation/Factory.php">Illuminate\Contracts\Validation\Factory</a> | <code>Validator</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Validation/ImplicitRule.php">Illuminate\Contracts\Validation\ImplicitRule</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Validation/Rule.php">Illuminate\Contracts\Validation\Rule</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Validation/ValidatesWhenResolved.php">Illuminate\Contracts\Validation\ValidatesWhenResolved</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/Validation/Validator.php">Illuminate\Contracts\Validation\Validator</a> | <code>Validator::make()</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/View/Engine.php">Illuminate\Contracts\View\Engine</a> | &nbsp;
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/View/Factory.php">Illuminate\Contracts\View\Factory</a> | <code>View</code>
<a href="https://github.com/illuminate/contracts/blob/%7B%7Bversion%7D%7D/View/View.php">Illuminate\Contracts\View\View</a> | <code>View::make()</code></p>
<div style="page-break-after: always;" ></div><h1>Contribution Guide</h1>

<ul>
<li><a href="#bug-reports">Bug Reports</a></li>
<li><a href="#support-questions">Support Questions</a></li>
<li><a href="#core-development-discussion">Core Development Discussion</a></li>
<li><a href="#which-branch">Which Branch?</a></li>
<li><a href="#compiled-assets">Compiled Assets</a></li>
<li><a href="#security-vulnerabilities">Security Vulnerabilities</a></li>
<li><a href="#coding-style">Coding Style</a>

<ul>
<li><a href="#phpdoc">PHPDoc</a></li>
<li><a href="#styleci">StyleCI</a></li>
</ul></li>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
</ul>

<p><a name="bug-reports"></a></p>

<h2>Bug Reports</h2>

<p>To encourage active collaboration, Laravel strongly encourages pull requests, not just bug reports. &quot;Bug reports&quot; may also be sent in the form of a pull request containing a failing test.</p>

<p>However, if you file a bug report, your issue should contain a title and a clear description of the issue. You should also include as much relevant information as possible and a code sample that demonstrates the issue. The goal of a bug report is to make it easy for yourself - and others - to replicate the bug and develop a fix.</p>

<p>Remember, bug reports are created in the hope that others with the same problem will be able to collaborate with you on solving it. Do not expect that the bug report will automatically see any activity or that others will jump to fix it. Creating a bug report serves to help yourself and others start on the path of fixing the problem. If you want to chip in, you can help out by fixing <a href="https://github.com/issues?q=is%3Aopen+is%3Aissue+label%3Abug+user%3Alaravel+-repo%3Alaravel%2Fnova-issues">any bugs listed in our issue trackers</a>.</p>

<p>The Laravel source code is managed on GitHub, and there are repositories for each of the Laravel projects:</p>

<div class="content-list" markdown="1">
- [Laravel Application](https://github.com/laravel/laravel)
- [Laravel Art](https://github.com/laravel/art)
- [Laravel Documentation](https://github.com/laravel/docs)
- [Laravel Dusk](https://github.com/laravel/dusk)
- [Laravel Cashier Stripe](https://github.com/laravel/cashier)
- [Laravel Cashier Paddle](https://github.com/laravel/cashier-paddle)
- [Laravel Echo](https://github.com/laravel/echo)
- [Laravel Envoy](https://github.com/laravel/envoy)
- [Laravel Framework](https://github.com/laravel/framework)
- [Laravel Homestead](https://github.com/laravel/homestead)
- [Laravel Homestead Build Scripts](https://github.com/laravel/settler)
- [Laravel Horizon](https://github.com/laravel/horizon)
- [Laravel Passport](https://github.com/laravel/passport)
- [Laravel Sanctum](https://github.com/laravel/sanctum)
- [Laravel Scout](https://github.com/laravel/scout)
- [Laravel Socialite](https://github.com/laravel/socialite)
- [Laravel Telescope](https://github.com/laravel/telescope)
- [Laravel Website](https://github.com/laravel/laravel.com-next)
- [Laravel UI](https://github.com/laravel/ui)
</div>

<p><a name="support-questions"></a></p>

<h2>Support Questions</h2>

<p>Laravel&#39;s GitHub issue trackers are not intended to provide Laravel help or support. Instead, use one of the following channels:</p>

<div class="content-list" markdown="1">
- [GitHub Discussions](https://github.com/laravel/framework/discussions)
- [Laracasts Forums](https://laracasts.com/discuss)
- [Laravel.io Forums](https://laravel.io/forum)
- [StackOverflow](https://stackoverflow.com/questions/tagged/laravel)
- [Discord](https://discordapp.com/invite/KxwQuKb)
- [Larachat](https://larachat.co)
- [IRC](https://webchat.freenode.net/?nick=artisan&channels=%23laravel&prompt=1)
</div>

<p><a name="core-development-discussion"></a></p>

<h2>Core Development Discussion</h2>

<p>You may propose new features or improvements of existing Laravel behavior in the Laravel Ideas <a href="https://github.com/laravel/ideas/issues">issue board</a>. If you propose a new feature, please be willing to implement at least some of the code that would be needed to complete the feature.</p>

<p>Informal discussion regarding bugs, new features, and implementation of existing features takes place in the <code>#internals</code> channel of the <a href="https://discordapp.com/invite/mPZNm7A">Laravel Discord server</a>. Taylor Otwell, the maintainer of Laravel, is typically present in the channel on weekdays from 8am-5pm (UTC-06:00 or America/Chicago), and sporadically present in the channel at other times.</p>

<p><a name="which-branch"></a></p>

<h2>Which Branch?</h2>

<p><strong>All</strong> bug fixes should be sent to the latest stable branch or to the <a href="/docs/%7B%7Bversion%7D%7D/releases#support-policy">current LTS branch</a>. Bug fixes should <strong>never</strong> be sent to the <code>master</code> branch unless they fix features that exist only in the upcoming release.</p>

<p><strong>Minor</strong> features that are <strong>fully backward compatible</strong> with the current release may be sent to the latest stable branch.</p>

<p><strong>Major</strong> new features should always be sent to the <code>master</code> branch, which contains the upcoming release.</p>

<p>If you are unsure if your feature qualifies as a major or minor, please ask Taylor Otwell in the <code>#internals</code> channel of the <a href="https://discordapp.com/invite/mPZNm7A">Laravel Discord server</a>.</p>

<p><a name="compiled-assets"></a></p>

<h2>Compiled Assets</h2>

<p>If you are submitting a change that will affect a compiled file, such as most of the files in <code>resources/sass</code> or <code>resources/js</code> of the <code>laravel/laravel</code> repository, do not commit the compiled files. Due to their large size, they cannot realistically be reviewed by a maintainer. This could be exploited as a way to inject malicious code into Laravel. In order to defensively prevent this, all compiled files will be generated and committed by Laravel maintainers.</p>

<p><a name="security-vulnerabilities"></a></p>

<h2>Security Vulnerabilities</h2>

<p>If you discover a security vulnerability within Laravel, please send an email to Taylor Otwell at <a href="mailto:taylor@laravel.com">taylor@laravel.com</a>. All security vulnerabilities will be promptly addressed.</p>

<p><a name="coding-style"></a></p>

<h2>Coding Style</h2>

<p>Laravel follows the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md">PSR-2</a> coding standard and the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md">PSR-4</a> autoloading standard.</p>

<p><a name="phpdoc"></a></p>

<h3>PHPDoc</h3>

<p>Below is an example of a valid Laravel documentation block. Note that the <code>@param</code> attribute is followed by two spaces, the argument type, two more spaces, and finally the variable name:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register a binding with the container.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string|array  $abstract</span>
<span class="cm"> * @param  \Closure|string|null  $concrete</span>
<span class="cm"> * @param  bool  $shared</span>
<span class="cm"> * @return void</span>
<span class="cm"> *</span>
<span class="cm"> * @throws \Exception</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">bind</span><span class="p">(</span><span class="nx">$abstract</span><span class="p">,</span> <span class="nx">$concrete</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$shared</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="styleci"></a></p>

<h3>StyleCI</h3>

<p>Don&#39;t worry if your code styling isn&#39;t perfect! <a href="https://styleci.io/">StyleCI</a> will automatically merge any style fixes into the Laravel repository after pull requests are merged. This allows us to focus on the content of the contribution and not the code style.</p>

<p><a name="code-of-conduct"></a></p>

<h2>Code of Conduct</h2>

<p>The Laravel code of conduct is derived from the Ruby code of conduct. Any violations of the code of conduct may be reported to Taylor Otwell (taylor@laravel.com):</p>

<div class="content-list" markdown="1">
- Participants will be tolerant of opposing views.
- Participants must ensure that their language and actions are free of personal attacks and disparaging personal remarks.
- When interpreting the words and actions of others, participants should always assume good intentions.
- Behavior that can be reasonably considered harassment will not be tolerated.
</div>
<div style="page-break-after: always;" ></div><h1>Controllers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-controllers">Basic Controllers</a>

<ul>
<li><a href="#defining-controllers">Defining Controllers</a></li>
<li><a href="#single-action-controllers">Single Action Controllers</a></li>
</ul></li>
<li><a href="#controller-middleware">Controller Middleware</a></li>
<li><a href="#resource-controllers">Resource Controllers</a>

<ul>
<li><a href="#restful-partial-resource-routes">Partial Resource Routes</a></li>
<li><a href="#restful-nested-resources">Nested Resources</a></li>
<li><a href="#restful-naming-resource-routes">Naming Resource Routes</a></li>
<li><a href="#restful-naming-resource-route-parameters">Naming Resource Route Parameters</a></li>
<li><a href="#restful-scoping-resource-routes">Scoping Resource Routes</a></li>
<li><a href="#restful-localizing-resource-uris">Localizing Resource URIs</a></li>
<li><a href="#restful-supplementing-resource-controllers">Supplementing Resource Controllers</a></li>
</ul></li>
<li><a href="#dependency-injection-and-controllers">Dependency Injection &amp; Controllers</a></li>
<li><a href="#route-caching">Route Caching</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Instead of defining all of your request handling logic as Closures in route files, you may wish to organize this behavior using Controller classes. Controllers can group related request handling logic into a single class. Controllers are stored in the <code>app/Http/Controllers</code> directory.</p>

<p><a name="basic-controllers"></a></p>

<h2>Basic Controllers</h2>

<p><a name="defining-controllers"></a></p>

<h3>Defining Controllers</h3>

<p>Below is an example of a basic controller class. Note that the controller extends the base controller class included with Laravel. The base class provides a few convenience methods such as the <code>middleware</code> method, which may be used to attach middleware to controller actions:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return View</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You can define a route to this controller action like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">UserController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]);</span>
</pre></div>

<p>Now, when a request matches the specified route URI, the <code>show</code> method on the <code>UserController</code> class will be executed. The route parameters will also be passed to the method.</p>

<blockquote>
<p>{tip} Controllers are not <strong>required</strong> to extend a base class. However, you will not have access to convenience features such as the <code>middleware</code>, <code>validate</code>, and <code>dispatch</code> methods.</p>
</blockquote>

<p><a name="single-action-controllers"></a></p>

<h3>Single Action Controllers</h3>

<p>If you would like to define a controller that only handles a single action, you may place a single <code>__invoke</code> method on the controller:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShowProfile</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return View</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When registering routes for single action controllers, you do not need to specify a method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">ShowProfile</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="nx">ShowProfile</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>You may generate an invokable controller by using the <code>--invokable</code> option of the <code>make:controller</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">ShowProfile</span> <span class="o">--</span><span class="nx">invokable</span>
</pre></div>

<blockquote>
<p>{tip} Controller stubs may be customized using <a href="/docs/%7B%7Bversion%7D%7D/artisan#stub-customization">stub publishing</a></p>
</blockquote>

<p><a name="controller-middleware"></a></p>

<h2>Controller Middleware</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a> may be assigned to the controller&#39;s routes in your route files:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
</pre></div>

<p>However, it is more convenient to specify middleware within your controller&#39;s constructor. Using the <code>middleware</code> method from your controller&#39;s constructor, you may easily assign middleware to the controller&#39;s action. You may even restrict the middleware to only certain methods on the controller class:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">UserController</span> <span class="kr">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Instantiate a new controller instance.</span>
<span class="cm">     *</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;subscribed&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Controllers also allow you to register middleware using a Closure. This provides a convenient way to define a middleware for a single controller without defining an entire middleware class:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">$next</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} You may assign middleware to a subset of controller actions; however, it may indicate your controller is growing too large. Instead, consider breaking your controller into multiple, smaller controllers.</p>
</blockquote>

<p><a name="resource-controllers"></a></p>

<h2>Resource Controllers</h2>

<p>Laravel resource routing assigns the typical &quot;CRUD&quot; routes to a controller with a single line of code. For example, you may wish to create a controller that handles all HTTP requests for &quot;photos&quot; stored by your application. Using the <code>make:controller</code> Artisan command, we can quickly create such a controller:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">PhotoController</span> <span class="o">--</span><span class="nx">resource</span>
</pre></div>

<p>This command will generate a controller at <code>app/Http/Controllers/PhotoController.php</code>. The controller will contain a method for each of the available resource operations.</p>

<p>Next, you may register a resourceful route to the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>This single route declaration creates multiple routes to handle a variety of actions on the resource. The generated controller will already have methods stubbed for each of these actions, including notes informing you of the HTTP verbs and URIs they handle.</p>

<p>You may register many resource controllers at once by passing an array to the <code>resources</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resources</span><span class="p">([</span>
    <span class="s1">&#39;photos&#39;</span> <span class="p">=&gt;</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="nx">PostController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>Actions Handled By Resource Controller</h4>

<p>Verb      | URI                  | Action       | Route Name
----------|-----------------------|--------------|---------------------
GET       | <code>/photos</code>              | index        | photos.index
GET       | <code>/photos/create</code>       | create       | photos.create
POST      | <code>/photos</code>              | store        | photos.store
GET       | <code>/photos/{photo}</code>      | show         | photos.show
GET       | <code>/photos/{photo}/edit</code> | edit         | photos.edit
PUT/PATCH | <code>/photos/{photo}</code>      | update       | photos.update
DELETE    | <code>/photos/{photo}</code>      | destroy      | photos.destroy</p>

<h4>Specifying The Resource Model</h4>

<p>If you are using route model binding and would like the resource controller&#39;s methods to type-hint a model instance, you may use the <code>--model</code> option when generating the controller:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">PhotoController</span> <span class="o">--</span><span class="nx">resource</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="nx">Photo</span>
</pre></div>

<p><a name="restful-partial-resource-routes"></a></p>

<h3>Partial Resource Routes</h3>

<p>When declaring a resource route, you may specify a subset of actions the controller should handle instead of the full set of default actions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span>
    <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span>
<span class="p">]);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span>
    <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span>
<span class="p">]);</span>
</pre></div>

<h4>API Resource Routes</h4>

<p>When declaring resource routes that will be consumed by APIs, you will commonly want to exclude routes that present HTML templates such as <code>create</code> and <code>edit</code>. For convenience, you may use the <code>apiResource</code> method to automatically exclude these two routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">apiResource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>You may register many API resource controllers at once by passing an array to the <code>apiResources</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">apiResources</span><span class="p">([</span>
    <span class="s1">&#39;photos&#39;</span> <span class="p">=&gt;</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="nx">PostController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>To quickly generate an API resource controller that does not include the <code>create</code> or <code>edit</code> methods, use the <code>--api</code> switch when executing the <code>make:controller</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">controller</span> <span class="nx">API</span><span class="o">/</span><span class="nx">PhotoController</span> <span class="o">--</span><span class="nx">api</span>
</pre></div>

<p><a name="restful-nested-resources"></a></p>

<h3>Nested Resources</h3>

<p>Sometimes you may need to define routes to a nested resource. For example, a photo resource may have multiple comments that may be attached to the photo. To nest the resource controllers, use &quot;dot&quot; notation in your route declaration:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="nx">PhotoCommentController</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>This route will register a nested resource that may be accessed with URIs like the following:</p>
<div class="highlight"><pre><span></span><span class="sr">/photos/</span><span class="p">{</span><span class="nx">photo</span><span class="p">}</span><span class="o">/</span><span class="nx">comments</span><span class="o">/</span><span class="p">{</span><span class="nx">comment</span><span class="p">}</span>
</pre></div>

<h4>Scoping Nested Resources</h4>

<p>Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/routing#implicit-model-binding-scoping">implicit model binding</a> feature can automatically scope nested bindings such that the resolved child model is confirmed to belong to the parent model. By using the <code>scoped</code> method when defining your nested resource, you may enabling automatic scoping as well as instruct Laravel which field the child resource should be retrieved by:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="nx">PhotoCommentController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">scoped</span><span class="p">([</span>
    <span class="s1">&#39;comment&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>This route will register a scoped nested resource that may be accessed with URIs like the following:</p>
<div class="highlight"><pre><span></span><span class="sr">/photos/</span><span class="p">{</span><span class="nx">photo</span><span class="p">}</span><span class="o">/</span><span class="nx">comments</span><span class="o">/</span><span class="p">{</span><span class="nx">comment</span><span class="o">:</span><span class="nx">slug</span><span class="p">}</span>
</pre></div>

<h4>Shallow Nesting</h4>

<p>Often, it is not entirely necessary to have both the parent and the child IDs within a URI since the child ID is already a unique identifier. When using unique identifier such as auto-incrementing primary keys to identify your models in URI segments, you may choose to use &quot;shallow nesting&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos.comments&#39;</span><span class="p">,</span> <span class="nx">CommentController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">shallow</span><span class="p">();</span>
</pre></div>

<p>The route definition above will define the following routes:</p>

<p>Verb      | URI                               | Action       | Route Name
----------|-----------------------------------|--------------|---------------------
GET       | <code>/photos/{photo}/comments</code>        | index        | photos.comments.index
GET       | <code>/photos/{photo}/comments/create</code> | create       | photos.comments.create
POST      | <code>/photos/{photo}/comments</code>        | store        | photos.comments.store
GET       | <code>/comments/{comment}</code>             | show         | comments.show
GET       | <code>/comments/{comment}/edit</code>        | edit         | comments.edit
PUT/PATCH | <code>/comments/{comment}</code>             | update       | comments.update
DELETE    | <code>/comments/{comment}</code>             | destroy      | comments.destroy</p>

<p><a name="restful-naming-resource-routes"></a></p>

<h3>Naming Resource Routes</h3>

<p>By default, all resource controller actions have a route name; however, you can override these names by passing a <code>names</code> array with your options:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">names</span><span class="p">([</span>
    <span class="s1">&#39;create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;photos.build&#39;</span>
<span class="p">]);</span>
</pre></div>

<p><a name="restful-naming-resource-route-parameters"></a></p>

<h3>Naming Resource Route Parameters</h3>

<p>By default, <code>Route::resource</code> will create the route parameters for your resource routes based on the &quot;singularized&quot; version of the resource name. You can easily override this on a per resource basis by using the <code>parameters</code> method. The array passed into the <code>parameters</code> method should be an associative array of resource names and parameter names:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">AdminUserController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">parameters</span><span class="p">([</span>
    <span class="s1">&#39;users&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;admin_user&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>The example above generates the following URIs for the resource&#39;s <code>show</code> route:</p>
<div class="highlight"><pre><span></span><span class="sr">/users/</span><span class="p">{</span><span class="nx">admin_user</span><span class="p">}</span>
</pre></div>

<p><a name="restful-scoping-resource-routes"></a></p>

<h3>Scoping Resource Routes</h3>

<p>Sometimes, when implicitly binding multiple Eloquent models in resource route definitions, you may wish to scope the second Eloquent model such that it must be a child of the first Eloquent model. For example, consider this situation that retrieves a blog post by slug for a specific user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">PostsController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;users.posts&#39;</span><span class="p">,</span> <span class="nx">PostsController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">scoped</span><span class="p">();</span>
</pre></div>

<p>You may override the default model route keys by passing an array to the <code>scoped</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">PostsController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;users.posts&#39;</span><span class="p">,</span> <span class="nx">PostsController</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">scoped</span><span class="p">([</span>
    <span class="s1">&#39;post&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>When using a custom keyed implicit binding as a nested route parameter, Laravel will automatically scope the query to retrieve the nested model by its parent using conventions to guess the relationship name on the parent. In this case, it will be assumed that the <code>User</code> model has a relationship named <code>posts</code> (the plural of the route parameter name) which can be used to retrieve the <code>Post</code> model.</p>

<p><a name="restful-localizing-resource-uris"></a></p>

<h3>Localizing Resource URIs</h3>

<p>By default, <code>Route::resource</code> will create resource URIs using English verbs. If you need to localize the <code>create</code> and <code>edit</code> action verbs, you may use the <code>Route::resourceVerbs</code> method. This may be done in the <code>boot</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Route</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">resourceVerbs</span><span class="p">([</span>
        <span class="s1">&#39;create&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;crear&#39;</span><span class="p">,</span>
        <span class="s1">&#39;edit&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;editar&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Once the verbs have been customized, a resource route registration such as <code>Route::resource(&#39;fotos&#39;, &#39;PhotoController&#39;)</code> will produce the following URIs:</p>
<div class="highlight"><pre><span></span><span class="err">/fotos/crear</span>

<span class="sr">/fotos/</span><span class="p">{</span><span class="nx">foto</span><span class="p">}</span><span class="o">/</span><span class="nx">editar</span>
</pre></div>

<p><a name="restful-supplementing-resource-controllers"></a></p>

<h3>Supplementing Resource Controllers</h3>

<p>If you need to add additional routes to a resource controller beyond the default set of resource routes, you should define those routes before your call to <code>Route::resource</code>; otherwise, the routes defined by the <code>resource</code> method may unintentionally take precedence over your supplemental routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;photos/popular&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;popular&#39;</span><span class="p">]);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nx">PhotoController</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} Remember to keep your controllers focused. If you find yourself routinely needing methods outside of the typical set of resource actions, consider splitting your controller into two, smaller controllers.</p>
</blockquote>

<p><a name="dependency-injection-and-controllers"></a></p>

<h2>Dependency Injection &amp; Controllers</h2>

<h4>Constructor Injection</h4>

<p>The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> is used to resolve all Laravel controllers. As a result, you are able to type-hint any dependencies your controller may need in its constructor. The declared dependencies will automatically be resolved and injected into the controller instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Repositories\UserRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository instance.</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new controller instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may also type-hint any <a href="/docs/%7B%7Bversion%7D%7D/contracts">Laravel contract</a>. If the container can resolve it, you can type-hint it. Depending on your application, injecting your dependencies into your controller may provide better testability.</p>

<h4>Method Injection</h4>

<p>In addition to constructor injection, you may also type-hint dependencies on your controller&#39;s methods. A common use-case for method injection is injecting the <code>Illuminate\Http\Request</code> instance into your controller methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If your controller method is also expecting input from a route parameter, list your route arguments after your other dependencies. For example, if your route is defined like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">]);</span>
</pre></div>

<p>You may still type-hint the <code>Illuminate\Http\Request</code> and access your <code>id</code> parameter by defining your controller method as follows:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  string  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="route-caching"></a></p>

<h2>Route Caching</h2>

<p>If your application is exclusively using controller based routes, you should take advantage of Laravel&#39;s route cache. Using the route cache will drastically decrease the amount of time it takes to register all of your application&#39;s routes. In some cases, your route registration may even be up to 100x faster. To generate a route cache, just execute the <code>route:cache</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>After running this command, your cached routes file will be loaded on every request. Remember, if you add any new routes you will need to generate a fresh route cache. Because of this, you should only run the <code>route:cache</code> command during your project&#39;s deployment.</p>

<p>You may use the <code>route:clear</code> command to clear the route cache:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">clear</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>CSRF Protection</h1>

<ul>
<li><a href="#csrf-introduction">Introduction</a></li>
<li><a href="#csrf-excluding-uris">Excluding URIs</a></li>
<li><a href="#csrf-x-csrf-token">X-CSRF-Token</a></li>
<li><a href="#csrf-x-xsrf-token">X-XSRF-Token</a></li>
</ul>

<p><a name="csrf-introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel makes it easy to protect your application from <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> (CSRF) attacks. Cross-site request forgeries are a type of malicious exploit whereby unauthorized commands are performed on behalf of an authenticated user.</p>

<p>Laravel automatically generates a CSRF &quot;token&quot; for each active user session managed by the application. This token is used to verify that the authenticated user is the one actually making the requests to the application.</p>

<p>Anytime you define an HTML form in your application, you should include a hidden CSRF token field in the form so that the CSRF protection middleware can validate the request. You may use the <code>@csrf</code> Blade directive to generate the token field:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">csrf</span>
    <span class="p">...</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>The <code>VerifyCsrfToken</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a>, which is included in the <code>web</code> middleware group, will automatically verify that the token in the request input matches the token stored in the session.</p>

<h4>CSRF Tokens &amp; JavaScript</h4>

<p>When building JavaScript driven applications, it is convenient to have your JavaScript HTTP library automatically attach the CSRF token to every outgoing request. By default, the Axios HTTP library provided in the <code>resources/js/bootstrap.js</code> file automatically sends an <code>X-XSRF-TOKEN</code> header using the value of the encrypted <code>XSRF-TOKEN</code> cookie. If you are not using this library, you will need to manually configure this behavior for your application.</p>

<p><a name="csrf-excluding-uris"></a></p>

<h2>Excluding URIs From CSRF Protection</h2>

<p>Sometimes you may wish to exclude a set of URIs from CSRF protection. For example, if you are using <a href="https://stripe.com">Stripe</a> to process payments and are utilizing their webhook system, you will need to exclude your Stripe webhook handler route from CSRF protection since Stripe will not know what CSRF token to send to your routes.</p>

<p>Typically, you should place these kinds of routes outside of the <code>web</code> middleware group that the <code>RouteServiceProvider</code> applies to all routes in the <code>routes/web.php</code> file. However, you may also exclude the routes by adding their URIs to the <code>$except</code> property of the <code>VerifyCsrfToken</code> middleware:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\Middleware\VerifyCsrfToken</span> <span class="k">as</span> <span class="nx">Middleware</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VerifyCsrfToken</span> <span class="k">extends</span> <span class="nx">Middleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The URIs that should be excluded from CSRF verification.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$except</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;stripe/*&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://example.com/foo/bar&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://example.com/foo/*&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} The CSRF middleware is automatically disabled when <a href="/docs/%7B%7Bversion%7D%7D/testing">running tests</a>.</p>
</blockquote>

<p><a name="csrf-x-csrf-token"></a></p>

<h2>X-CSRF-TOKEN</h2>

<p>In addition to checking for the CSRF token as a POST parameter, the <code>VerifyCsrfToken</code> middleware will also check for the <code>X-CSRF-TOKEN</code> request header. You could, for example, store the token in an HTML <code>meta</code> tag:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;csrf-token&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p>Then, once you have created the <code>meta</code> tag, you can instruct a library like jQuery to automatically add the token to all request headers. This provides simple, convenient CSRF protection for your AJAX based applications:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;X-CSRF-TOKEN&#39;</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="csrf-x-xsrf-token"></a></p>

<h2>X-XSRF-TOKEN</h2>

<p>Laravel stores the current CSRF token in an encrypted <code>XSRF-TOKEN</code> cookie that is included with each response generated by the framework. You can use the cookie value to set the <code>X-XSRF-TOKEN</code> request header.</p>

<p>This cookie is primarily sent as a convenience since some JavaScript frameworks and libraries, like Angular and Axios, automatically place its value in the <code>X-XSRF-TOKEN</code> header on same-origin requests.</p>

<blockquote>
<p>{tip} By default, the <code>resources/js/bootstrap.js</code> file includes the Axios HTTP library which will automatically send this for you.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Database Testing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#resetting-the-database-after-each-test">Resetting The Database After Each Test</a></li>
<li><a href="#creating-factories">Creating Factories</a></li>
<li><a href="#writing-factories">Writing Factories</a>

<ul>
<li><a href="#factory-states">Factory States</a></li>
<li><a href="#factory-callbacks">Factory Callbacks</a></li>
</ul></li>
<li><a href="#using-factories">Using Factories</a>

<ul>
<li><a href="#creating-models">Creating Models</a></li>
<li><a href="#persisting-models">Persisting Models</a></li>
<li><a href="#sequences">Sequences</a></li>
</ul></li>
<li><a href="#factory-relationships">Factory Relationships</a>

<ul>
<li><a href="#relationships-within-definition">Relationships Within Definitions</a></li>
<li><a href="#has-many-relationships">Has Many Relationships</a></li>
<li><a href="#belongs-to-relationships">Belongs To Relationships</a></li>
<li><a href="#many-to-many-relationships">Many To Many Relationships</a></li>
<li><a href="#polymorphic-relationships">Polymorphic Relationships</a></li>
</ul></li>
<li><a href="#using-seeds">Using Seeds</a></li>
<li><a href="#available-assertions">Available Assertions</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a variety of helpful tools to make it easier to test your database driven applications. First, you may use the <code>assertDatabaseHas</code> helper to assert that data exists in the database matching a given set of criteria. For example, if you would like to verify that there is a record in the <code>users</code> table with the <code>email</code> value of <code>sally@example.com</code>, you can do the following:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Make call to application...</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertDatabaseHas</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sally@example.com&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>You can also use the <code>assertDatabaseMissing</code> helper to assert that data does not exist in the database.</p>

<p>The <code>assertDatabaseHas</code> method and other helpers like it are for convenience. You are free to use any of PHPUnit&#39;s built-in assertion methods to supplement your feature tests.</p>

<p><a name="resetting-the-database-after-each-test"></a></p>

<h2>Resetting The Database After Each Test</h2>

<p>It is often useful to reset your database after each test so that data from a previous test does not interfere with subsequent tests. The <code>RefreshDatabase</code> trait takes the most optimal approach to migrating your test database depending on if you are using an in-memory database or a traditional database. Use the trait on your test class and everything will be handled for you:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="creating-factories"></a></p>

<h2>Creating Factories</h2>

<p>When testing, you may need to insert a few records into your database before executing your test. Instead of manually specifying the value of each column when you create this test data, Laravel allows you to define a default set of attributes for each of your <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent models</a> using model factories.</p>

<p>To create a factory, use the <code>make:factory</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">factory</span> <span class="nx">PostFactory</span>
</pre></div>

<p>The new factory will be placed in your <code>database/factories</code> directory.</p>

<p>The <code>--model</code> option may be used to indicate the name of the model created by the factory. This option will pre-fill the generated factory file with the given model:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">factory</span> <span class="nx">PostFactory</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="nx">Post</span>
</pre></div>

<p><a name="writing-factories"></a></p>

<h2>Writing Factories</h2>

<p>To get started, take a look at the <code>database/factories/UserFactory.php</code> file in your application. Out of the box, this file contains the following factory definition:</p>
<div class="highlight"><pre><span></span><span class="nx">namespace</span> <span class="nx">Database</span><span class="err">\</span><span class="nx">Factories</span><span class="p">;</span>

<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Factories</span><span class="err">\</span><span class="nx">Factory</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">UserFactory</span> <span class="kr">extends</span> <span class="nx">Factory</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * The name of the factory&#39;s corresponding model.</span>
<span class="cm">     *</span>
<span class="cm">     * @var string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Define the model&#39;s default state.</span>
<span class="cm">     *</span>
<span class="cm">     * @return array</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">definition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">safeEmail</span><span class="p">,</span>
            <span class="s1">&#39;email_verified_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
            <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi&#39;</span><span class="p">,</span> <span class="c1">// password</span>
            <span class="s1">&#39;remember_token&#39;</span> <span class="p">=&gt;</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, in their most basic form, factories are classes that extend Laravel&#39;s base factory class and define a <code>model</code> property and <code>definition</code> method. The <code>definition</code> method returns the default set of attribute values that should be applied when creating a model using the factory.</p>

<p>Via the <code>faker</code> property, factories have access to the <a href="https://github.com/fzaninotto/Faker">Faker</a> PHP library, which allows you to conveniently generate various kinds of random data for testing.</p>

<blockquote>
<p>{tip} You can set the Faker locale by adding a <code>faker_locale</code> option to your <code>config/app.php</code> configuration file.</p>
</blockquote>

<p><a name="factory-states"></a></p>

<h3>Factory States</h3>

<p>State manipulation methods allow you to define discrete modifications that can be applied to your model factories in any combination. For example, your <code>User</code> model might have a <code>suspended</code> state that modifies one of its default attribute values. You may define your state transformations using the base factory&#39;s <code>state</code> method. You may name your state method anything you like. After all, it&#39;s just a typical PHP method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Indicate that the user is suspended.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\Database\Eloquent\Factories\Factory</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">suspended</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">([</span>
        <span class="s1">&#39;account_status&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;suspended&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>If your state transformation requires access to the other attributes defined by the factory, you may pass a callback to the <code>state</code> method. The callback will receive the array of raw attributes defined for the factory:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Indicate that the user is suspended.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\Database\Eloquent\Factories\Factory</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">suspended</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;account_status&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;suspended&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="factory-callbacks"></a></p>

<h3>Factory Callbacks</h3>

<p>Factory callbacks are registered using the <code>afterMaking</code> and <code>afterCreating</code> methods and allow you to perform additional tasks after making or creating a model. You should register these callbacks by defining a <code>configure</code> method on the factory class. This method will automatically be called by Laravel when the factory is instantiated:</p>
<div class="highlight"><pre><span></span><span class="nx">namespace</span> <span class="nx">Database</span><span class="err">\</span><span class="nx">Factories</span><span class="p">;</span>

<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Factories</span><span class="err">\</span><span class="nx">Factory</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">UserFactory</span> <span class="kr">extends</span> <span class="nx">Factory</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * The name of the factory&#39;s corresponding model.</span>
<span class="cm">     *</span>
<span class="cm">     * @var string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="nx">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Configure the model factory.</span>
<span class="cm">     *</span>
<span class="cm">     * @return $this</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">configure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">afterMaking</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">})</span><span class="o">-&gt;</span><span class="nx">afterCreating</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p><a name="using-factories"></a></p>

<h2>Using Factories</h2>

<p><a name="creating-models"></a></p>

<h3>Creating Models</h3>

<p>Once you have defined your factories, you may use the static <code>factory</code> method provided by the <code>HasFactory</code> trait on your Eloquent models in order to instantiate a factory instance for that model. Let&#39;s take a look at a few examples of creating models. First, we&#39;ll use the <code>make</code> method to create models without persisting them to the database:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>

    <span class="c1">// Use model in tests...</span>
<span class="p">}</span>
</pre></div>

<p>You may create a collection of many models using the <code>count</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Create three App\Models\User instances...</span>
<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<p>The <code>HasFactory</code> trait&#39;s <code>factory</code> method will use conventions to determine the proper factory for the model. Specifically, the method will look for a factory in the <code>Database\Factories</code> namespace that has a class name matching the model name and is suffixed with <code>Factory</code>. If these conventions do not apply to your particular application or factory, you may use the factory directly to create model instances. To create a new factory instance using the factory class, you should call the static <code>new</code> method on the factory:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Database</span><span class="err">\</span><span class="nx">Factories</span><span class="err">\</span><span class="nx">UserFactory</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">UserFactory</span><span class="o">::</span><span class="k">new</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<h4>Applying States</h4>

<p>You may also apply any of your <a href="#factory-states">states</a> to the models. If you would like to apply multiple state transformations to the models, you may simply call state methods directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">suspended</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<h4>Overriding Attributes</h4>

<p>If you would like to override some of the default values of your models, you may pass an array of values to the <code>make</code> method. Only the specified values will be replaced while the rest of the values remain set to their default values as specified by the factory:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail Otwell&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Alternatively, the <code>state</code> method may be called directly on the factory instance to perform an inline state transformation:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail Otwell&#39;</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} <a href="/docs/%7B%7Bversion%7D%7D/eloquent#mass-assignment">Mass assignment protection</a> is automatically disabled when creating models using factories.</p>
</blockquote>

<p><a name="persisting-models"></a></p>

<h3>Persisting Models</h3>

<p>The <code>create</code> method creates model instances and persists them to the database using Eloquent&#39;s <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Create a single App\Models\User instance...</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

    <span class="c1">// Create three App\Models\User instances...</span>
    <span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

    <span class="c1">// Use model in tests...</span>
<span class="p">}</span>
</pre></div>

<p>You may override attributes on the model by passing an array of attributes to the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="sequences"></a></p>

<h3>Sequences</h3>

<p>Sometimes you may wish to alternate the value of a given model attribute for each created model. You may accomplish this by defining a state transformation as a <code>Sequence</code> instance. For example, we may wish to alternate the value of an <code>admin</code> column on a <code>User</code> model between <code>Y</code> and <code>N</code> for each created user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Factories</span><span class="err">\</span><span class="nx">Sequence</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">state</span><span class="p">(</span><span class="k">new</span> <span class="nx">Sequence</span><span class="p">(</span>
                    <span class="p">[</span><span class="s1">&#39;admin&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Y&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;admin&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;N&#39;</span><span class="p">],</span>
                <span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>In this example, five users will be created with an <code>admin</code> value of <code>Y</code> and five users will be created with an <code>admin</code> value of <code>N</code>.</p>

<p><a name="factory-relationships"></a></p>

<h2>Factory Relationships</h2>

<p><a name="relationships-within-definition"></a></p>

<h3>Relationships Within Definitions</h3>

<p>You may attach relationships to models in your factory definitions. For example, if you would like to create a new <code>User</code> instance when creating a <code>Post</code>, you may do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Define the model&#39;s default state.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">definition</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;user_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">(),</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">,</span>
        <span class="s1">&#39;content&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">paragraph</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>If the relationship&#39;s columns depend on the factory that defines it you may provide a callback which accepts the evaluated attribute array:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define the model&#39;s default state.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">definition</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;user_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">(),</span>
        <span class="s1">&#39;user_type&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$attributes</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">type</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">,</span>
        <span class="s1">&#39;content&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">faker</span><span class="o">-&gt;</span><span class="nx">paragraph</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="has-many-relationships"></a></p>

<h3>Has Many Relationships</h3>

<p>Next, let&#39;s explore building Eloquent model relationships using Laravel&#39;s fluent factory methods. First, let&#39;s assume our application has a <code>User</code> model and a <code>Post</code> model. Also, let&#39;s assume that the <code>User</code> model defines a <code>hasMany</code> relationship with <code>Post</code>. We can create a user that has three posts using the <code>has</code> method provided by the factory. The <code>has</code> method accepts a factory instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>By convention, when passing a <code>Post</code> model to the <code>has</code> method, Laravel will assume that the <code>User</code> model must have a <code>posts</code> method that defines the relationship. If necessary, you may explicitly specify the name of the relationship that you would like to manipulate:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;posts&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>Of course, you may perform state manipulations on the related models. In addition, you may pass a Closure based state transformation if your state change requires access to the parent model:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span>
                <span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
                        <span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="nx">state</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;user_type&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">type</span><span class="p">];</span>
                        <span class="p">})</span>
            <span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Using Magic Methods</h4>

<p>For convenience, you may use the factory&#39;s magic relationship methods to define relationships. For example, the following example will use convention to determine that the related models should be created via a <code>posts</code> relationship method on the <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasPosts</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>When using magic methods to create factory relationships, you may pass an array of attributes to override on the related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasPosts</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;published&#39;</span> <span class="p">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>You may provide a Closure based state transformation if your state change requires access to the parent model:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasPosts</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;user_type&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">type</span><span class="p">];</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p><a name="belongs-to-relationships"></a></p>

<h3>Belongs To Relationships</h3>

<p>Now that we have explored how to build &quot;has many&quot; relationships using factories, let&#39;s explore the inverse of the relationship. The <code>for</code> method may be used to define the model that factory created models belong to. For example, we can create three <code>Post</code> model instances that belong to a single user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="k">for</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">([</span>
                <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jessica Archer&#39;</span><span class="p">,</span>
            <span class="p">]))</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Using Magic Methods</h4>

<p>For convenience, you may use the factory&#39;s magic relationship methods to define &quot;belongs to&quot; relationships. For example, the following example will use convention to determine that the three posts should belong to the <code>user</code> relationship on the <code>Post</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">forUser</span><span class="p">([</span>
                <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Jessica Archer&#39;</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p><a name="many-to-many-relationships"></a></p>

<h3>Many To Many Relationships</h3>

<p>Like <a href="#has-many-relationships">has many relationships</a>, &quot;many to many&quot; relationships may be created using the <code>has</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Role</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="nx">Role</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Pivot Table Attributes</h4>

<p>If you need to define attributes that should be set on the pivot / intermediate table linking the models, you may use the <code>hasAttached</code> method. This method accepts an array of pivot table attribute names and values as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Role</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasAttached</span><span class="p">(</span>
                <span class="nx">Role</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                <span class="p">[</span><span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>You may provide a Closure based state transformation if your state change requires access to the related model:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasAttached</span><span class="p">(</span>
                <span class="nx">Role</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">state</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">array</span> <span class="nx">$attributes</span><span class="p">,</span> <span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">.</span><span class="s1">&#39; Role&#39;</span><span class="p">];</span>
                    <span class="p">}),</span>
                <span class="p">[</span><span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Using Magic Methods</h4>

<p>For convenience, you may use the factory&#39;s magic relationship methods to define many to many relationships. For example, the following example will use convention to determine that the related models should be created via a <code>roles</code> relationship method on the <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasRoles</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Editor&#39;</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p><a name="polymorphic-relationships"></a></p>

<h3>Polymorphic Relationships</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships#polymorphic-relationships">Polymorphic relationships</a> may also be created using factories. Polymorphic &quot;morph many&quot; relationships are created in the same way as typical &quot;has many&quot; relationships. For example, if a <code>Post</code> model has a <code>morphMany</code> relationship with a <code>Comment</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">hasComments</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Morph To Relationships</h4>

<p>Magic methods may not be used to create <code>morphTo</code> relationships. Instead, the <code>for</code> method must be used directly and the name of the relationship must be explicitly provided. For example, imagine that the <code>Comment</code> model has a <code>commentable</code> method that defines a <code>morphTo</code> relationship. In this situation, we may create three comments that belong to a single post using the <code>for</code> method directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">for</span><span class="p">(</span>
    <span class="nx">Post</span><span class="o">::</span><span class="nx">factory</span><span class="p">(),</span> <span class="s1">&#39;commentable&#39;</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<h4>Polymorphic Many To Many Relationships</h4>

<p>Polymorphic &quot;many to many&quot; relationships may be created just like non-polymorphic &quot;many to many&quot; relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Tag</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Video</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">Video</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasAttached</span><span class="p">(</span>
                <span class="nx">Tag</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                <span class="p">[</span><span class="s1">&#39;public&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p>Of course, the magic <code>has</code> method may also be used to create polymorphic &quot;many to many&quot; relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">Video</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">hasTags</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
</pre></div>

<p><a name="using-seeds"></a></p>

<h2>Using Seeds</h2>

<p>If you would like to use <a href="/docs/%7B%7Bversion%7D%7D/seeding">database seeders</a> to populate your database during a feature test, you may use the <code>seed</code> method. By default, the <code>seed</code> method will return the <code>DatabaseSeeder</code>, which should execute all of your other seeders. Alternatively, you pass a specific seeder class name to the <code>seed</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">OrderStatusSeeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Test creating a new order.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreatingANewOrder</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Run the DatabaseSeeder...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seed</span><span class="p">();</span>

        <span class="c1">// Run a single seeder...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seed</span><span class="p">(</span><span class="nx">OrderStatusSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="available-assertions"></a></p>

<h2>Available Assertions</h2>

<p>Laravel provides several database assertions for your <a href="https://phpunit.de/">PHPUnit</a> feature tests:</p>

<p>Method  | Description
------------- | -------------
<code>$this-&gt;assertDatabaseCount($table, int $count);</code>  |  Assert that a table in the database contains the given amount of entries.
<code>$this-&gt;assertDatabaseHas($table, array $data);</code>  |  Assert that a table in the database contains the given data.
<code>$this-&gt;assertDatabaseMissing($table, array $data);</code>  |  Assert that a table in the database does not contain the given data.
<code>$this-&gt;assertDeleted($table, array $data);</code>  |  Assert that the given record has been deleted.
<code>$this-&gt;assertSoftDeleted($table, array $data);</code>  |  Assert that the given record has been soft deleted.</p>

<p>For convenience, you may pass a model to the <code>assertDeleted</code> and <code>assertSoftDeleted</code> helpers to assert the record was deleted or soft deleted, respectively, from the database based on the model&#39;s primary key.</p>

<p>For example, if you are using a model factory in your test, you may pass this model to one of these helpers to test your application properly deleted the record from the database:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testDatabase</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

    <span class="c1">// Make call to application...</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertDeleted</span><span class="p">(</span><span class="nx">$user</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Getting Started</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#read-and-write-connections">Read &amp; Write Connections</a></li>
<li><a href="#using-multiple-database-connections">Using Multiple Database Connections</a></li>
</ul></li>
<li><a href="#running-queries">Running Raw SQL Queries</a></li>
<li><a href="#listening-for-query-events">Listening For Query Events</a></li>
<li><a href="#database-transactions">Database Transactions</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel makes interacting with databases extremely simple across a variety of database backends using either raw SQL, the <a href="/docs/%7B%7Bversion%7D%7D/queries">fluent query builder</a>, and the <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>. Currently, Laravel supports four databases:</p>

<div class="content-list" markdown="1">
- MySQL 5.6+ ([Version Policy](https://en.wikipedia.org/wiki/MySQL#Release_history))
- PostgreSQL 9.4+ ([Version Policy](https://www.postgresql.org/support/versioning/))
- SQLite 3.8.8+
- SQL Server 2017+ ([Version Policy](https://support.microsoft.com/en-us/lifecycle/search))
</div>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>The database configuration for your application is located at <code>config/database.php</code>. In this file you may define all of your database connections, as well as specify which connection should be used by default. Examples for most of the supported database systems are provided in this file.</p>

<p>By default, Laravel&#39;s sample <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">environment configuration</a> is ready to use with <a href="/docs/%7B%7Bversion%7D%7D/homestead">Laravel Homestead</a>, which is a convenient virtual machine for doing Laravel development on your local machine. You are free to modify this configuration as needed for your local database.</p>

<h4>SQLite Configuration</h4>

<p>After creating a new SQLite database using a command such as <code>touch database/database.sqlite</code>, you can easily configure your environment variables to point to this newly created database by using the database&#39;s absolute path:</p>
<div class="highlight"><pre><span></span><span class="nx">DB_CONNECTION</span><span class="o">=</span><span class="nx">sqlite</span>
<span class="nx">DB_DATABASE</span><span class="o">=</span><span class="err">/absolute/path/to/database.sqlite</span>
</pre></div>

<p>To enable foreign key constraints for SQLite connections, you should set the <code>DB_FOREIGN_KEYS</code> environment variable to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">DB_FOREIGN_KEYS</span><span class="o">=</span><span class="kc">true</span>
</pre></div>

<h4>Configuration Using URLs</h4>

<p>Typically, database connections are configured using multiple configuration values such as <code>host</code>, <code>database</code>, <code>username</code>, <code>password</code>, etc. Each of these configuration values has its own corresponding environment variable. This means that when configuring your database connection information on a production server, you need to manage several environment variables.</p>

<p>Some managed database providers such as Heroku provide a single database &quot;URL&quot; that contains all of the connection information for the database in a single string. An example database URL may look something like the following:</p>
<div class="highlight"><pre><span></span><span class="nx">mysql</span><span class="o">:</span><span class="c1">//root:password@127.0.0.1/forge?charset=UTF-8</span>
</pre></div>

<p>These URLs typically follow a standard schema convention:</p>
<div class="highlight"><pre><span></span><span class="nx">driver</span><span class="o">:</span><span class="c1">//username:password@host:port/database?options</span>
</pre></div>

<p>For convenience, Laravel supports these URLs as an alternative to configuring your database with multiple configuration options. If the <code>url</code> (or corresponding <code>DATABASE_URL</code> environment variable) configuration option is present, it will be used to extract the database connection and credential information.</p>

<p><a name="read-and-write-connections"></a></p>

<h3>Read &amp; Write Connections</h3>

<p>Sometimes you may wish to use one database connection for SELECT statements, and another for INSERT, UPDATE, and DELETE statements. Laravel makes this a breeze, and the proper connections will always be used whether you are using raw queries, the query builder, or the Eloquent ORM.</p>

<p>To see how read / write connections should be configured, let&#39;s look at this example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mysql&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;read&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;196.168.1.2&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;write&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;196.168.1.3&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;sticky&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;charset&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;utf8mb4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;collation&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;utf8mb4_unicode_ci&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Note that three keys have been added to the configuration array: <code>read</code>, <code>write</code> and <code>sticky</code>. The <code>read</code> and <code>write</code> keys have array values containing a single key: <code>host</code>. The rest of the database options for the <code>read</code> and <code>write</code> connections will be merged from the main <code>mysql</code> array.</p>

<p>You only need to place items in the <code>read</code> and <code>write</code> arrays if you wish to override the values from the main array. So, in this case, <code>192.168.1.1</code> will be used as the host for the &quot;read&quot; connection, while <code>192.168.1.3</code> will be used for the &quot;write&quot; connection. The database credentials, prefix, character set, and all other options in the main <code>mysql</code> array will be shared across both connections.</p>

<h4>The <code>sticky</code> Option</h4>

<p>The <code>sticky</code> option is an <em>optional</em> value that can be used to allow the immediate reading of records that have been written to the database during the current request cycle. If the <code>sticky</code> option is enabled and a &quot;write&quot; operation has been performed against the database during the current request cycle, any further &quot;read&quot; operations will use the &quot;write&quot; connection. This ensures that any data written during the request cycle can be immediately read back from the database during that same request. It is up to you to decide if this is the desired behavior for your application.</p>

<p><a name="using-multiple-database-connections"></a></p>

<h3>Using Multiple Database Connections</h3>

<p>When using multiple connections, you may access each connection via the <code>connection</code> method on the <code>DB</code> facade. The <code>name</code> passed to the <code>connection</code> method should correspond to one of the connections listed in your <code>config/database.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(...);</span>
</pre></div>

<p>You may also access the raw, underlying PDO instance using the <code>getPdo</code> method on a connection instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$pdo</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">getPdo</span><span class="p">();</span>
</pre></div>

<p><a name="running-queries"></a></p>

<h2>Running Raw SQL Queries</h2>

<p>Once you have configured your database connection, you may run queries using the <code>DB</code> facade. The <code>DB</code> facade provides methods for each type of query: <code>select</code>, <code>update</code>, <code>insert</code>, <code>delete</code>, and <code>statement</code>.</p>

<h4>Running A Select Query</h4>

<p>To run a basic query, you may use the <code>select</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all of the application&#39;s users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;select * from users where active = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>select</code> method is the raw SQL query, while the second argument is any parameter bindings that need to be bound to the query. Typically, these are the values of the <code>where</code> clause constraints. Parameter binding provides protection against SQL injection.</p>

<p>The <code>select</code> method will always return an <code>array</code> of results. Each result within the array will be a PHP <code>stdClass</code> object, allowing you to access the values of the results:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Using Named Bindings</h4>

<p>Instead of using <code>?</code> to represent your parameter bindings, you may execute a query using named bindings:</p>
<div class="highlight"><pre><span></span><span class="nx">$results</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;select * from users where id = :id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Running An Insert Statement</h4>

<p>To execute an <code>insert</code> statement, you may use the <code>insert</code> method on the <code>DB</code> facade. Like <code>select</code>, this method takes the raw SQL query as its first argument and bindings as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">insert</span><span class="p">(</span><span class="s1">&#39;insert into users (id, name) values (?, ?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Dayle&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running An Update Statement</h4>

<p>The <code>update</code> method should be used to update existing records in the database. The number of rows affected by the statement will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$affected</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;update users set votes = 100 where name = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Running A Delete Statement</h4>

<p>The <code>delete</code> method should be used to delete records from the database. Like <code>update</code>, the number of rows affected will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$deleted</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;delete from users&#39;</span><span class="p">);</span>
</pre></div>

<h4>Running A General Statement</h4>

<p>Some database statements do not return any value. For these types of operations, you may use the <code>statement</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">statement</span><span class="p">(</span><span class="s1">&#39;drop table users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="listening-for-query-events"></a></p>

<h2>Listening For Query Events</h2>

<p>If you would like to receive each SQL query executed by your application, you may use the <code>listen</code> method. This method is useful for logging queries or debugging. You may register your query listener in a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// $query-&gt;sql</span>
            <span class="c1">// $query-&gt;bindings</span>
            <span class="c1">// $query-&gt;time</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="database-transactions"></a></p>

<h2>Database Transactions</h2>

<p>You may use the <code>transaction</code> method on the <code>DB</code> facade to run a set of operations within a database transaction. If an exception is thrown within the transaction <code>Closure</code>, the transaction will automatically be rolled back. If the <code>Closure</code> executes successfully, the transaction will automatically be committed. You don&#39;t need to worry about manually rolling back or committing while using the <code>transaction</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Handling Deadlocks</h4>

<p>The <code>transaction</code> method accepts an optional second argument which defines the number of times a transaction should be reattempted when a deadlock occurs. Once these attempts have been exhausted, an exception will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

    <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<h4>Manually Using Transactions</h4>

<p>If you would like to begin a transaction manually and have complete control over rollbacks and commits, you may use the <code>beginTransaction</code> method on the <code>DB</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">beginTransaction</span><span class="p">();</span>
</pre></div>

<p>You can rollback the transaction via the <code>rollBack</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">rollBack</span><span class="p">();</span>
</pre></div>

<p>Lastly, you can commit a transaction via the <code>commit</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} The <code>DB</code> facade&#39;s transaction methods control the transactions for both the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> and <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a>.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Deployment</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#server-configuration">Server Configuration</a>

<ul>
<li><a href="#nginx">Nginx</a></li>
</ul></li>
<li><a href="#optimization">Optimization</a>

<ul>
<li><a href="#autoloader-optimization">Autoloader Optimization</a></li>
<li><a href="#optimizing-configuration-loading">Optimizing Configuration Loading</a></li>
<li><a href="#optimizing-route-loading">Optimizing Route Loading</a></li>
<li><a href="#optimizing-view-loading">Optimizing View Loading</a></li>
</ul></li>
<li><a href="#deploying-with-forge-or-vapor">Deploying With Forge / Vapor</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When you&#39;re ready to deploy your Laravel application to production, there are some important things you can do to make sure your application is running as efficiently as possible. In this document, we&#39;ll cover some great starting points for making sure your Laravel application is deployed properly.</p>

<p><a name="server-configuration"></a></p>

<h2>Server Configuration</h2>

<p><a name="nginx"></a></p>

<h3>Nginx</h3>

<p>If you are deploying your application to a server that is running Nginx, you may use the following configuration file as a starting point for configuring your web server. Most likely, this file will need to be customized depending on your server&#39;s configuration. If you would like assistance in managing your server, consider using a service such as <a href="https://forge.laravel.com">Laravel Forge</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">server</span> <span class="p">{</span>
    <span class="nx">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="nx">server_name</span> <span class="nx">example</span><span class="p">.</span><span class="nx">com</span><span class="p">;</span>
    <span class="nx">root</span> <span class="o">/</span><span class="nx">srv</span><span class="o">/</span><span class="nx">example</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="kr">public</span><span class="p">;</span>

    <span class="nx">add_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Frame</span><span class="o">-</span><span class="nx">Options</span> <span class="s2">&quot;SAMEORIGIN&quot;</span><span class="p">;</span>
    <span class="nx">add_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">XSS</span><span class="o">-</span><span class="nx">Protection</span> <span class="s2">&quot;1; mode=block&quot;</span><span class="p">;</span>
    <span class="nx">add_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">-</span><span class="nx">Options</span> <span class="s2">&quot;nosniff&quot;</span><span class="p">;</span>

    <span class="nx">index</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span><span class="p">;</span>

    <span class="nx">charset</span> <span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span>

    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
    <span class="p">}</span>

    <span class="nx">location</span> <span class="o">=</span> <span class="err">/favicon.ico { access_log off; log_not_found off; }</span>
    <span class="nx">location</span> <span class="o">=</span> <span class="err">/robots.txt  { access_log off; log_not_found off; }</span>

    <span class="nx">error_page</span> <span class="mi">404</span> <span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">php</span><span class="p">;</span>

    <span class="nx">location</span> <span class="o">~</span> <span class="err">\</span><span class="p">.</span><span class="nx">php$</span> <span class="p">{</span>
        <span class="nx">fastcgi_pass</span> <span class="nx">unix</span><span class="o">:</span><span class="err">/var/run/php/php7.4-fpm.sock;</span>
        <span class="nx">fastcgi_param</span> <span class="nx">SCRIPT_FILENAME</span> <span class="nx">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
        <span class="nx">include</span> <span class="nx">fastcgi_params</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">location</span> <span class="o">~</span> <span class="err">/\.(?!well-known).* {</span>
        <span class="nx">deny</span> <span class="nx">all</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="optimization"></a></p>

<h2>Optimization</h2>

<p><a name="autoloader-optimization"></a></p>

<h3>Autoloader Optimization</h3>

<p>When deploying to production, make sure that you are optimizing Composer&#39;s class autoloader map so Composer can quickly find the proper file to load for a given class:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">optimize</span><span class="o">-</span><span class="nx">autoloader</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>

<blockquote>
<p>{tip} In addition to optimizing the autoloader, you should always be sure to include a <code>composer.lock</code> file in your project&#39;s source control repository. Your project&#39;s dependencies can be installed much faster when a <code>composer.lock</code> file is present.</p>
</blockquote>

<p><a name="optimizing-configuration-loading"></a></p>

<h3>Optimizing Configuration Loading</h3>

<p>When deploying your application to production, you should make sure that you run the <code>config:cache</code> Artisan command during your deployment process:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">config</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>This command will combine all of Laravel&#39;s configuration files into a single, cached file, which greatly reduces the number of trips the framework must make to the filesystem when loading your configuration values.</p>

<blockquote>
<p>{note} If you execute the <code>config:cache</code> command during your deployment process, you should be sure that you are only calling the <code>env</code> function from within your configuration files. Once the configuration has been cached, the <code>.env</code> file will not be loaded and all calls to the <code>env</code> function will return <code>null</code>.</p>
</blockquote>

<p><a name="optimizing-route-loading"></a></p>

<h3>Optimizing Route Loading</h3>

<p>If you are building a large application with many routes, you should make sure that you are running the <code>route:cache</code> Artisan command during your deployment process:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">route</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>This command reduces all of your route registrations into a single method call within a cached file, improving the performance of route registration when registering hundreds of routes.</p>

<p><a name="optimizing-view-loading"></a></p>

<h3>Optimizing View Loading</h3>

<p>When deploying your application to production, you should make sure that you run the <code>view:cache</code> Artisan command during your deployment process:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">view</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>This command precompiles all your Blade views so they are not compiled on demand, improving the performance of each request that returns a view.</p>

<p><a name="deploying-with-forge-or-vapor"></a></p>

<h2>Deploying With Forge / Vapor</h2>

<p>If you aren&#39;t quite ready to manage your own server configuration or aren&#39;t comfortable configuring all of the various services needed to run a robust Laravel application, <a href="https://forge.laravel.com">Laravel Forge</a> is a wonderful alternative.</p>

<p>Laravel Forge can create servers on various infrastructure providers such as DigitalOcean, Linode, AWS, and more. In addition, Forge installs and manages all of the tools needed to build robust Laravel applications, such as Nginx, MySQL, Redis, Memcached, Beanstalk, and more.</p>

<h4>Laravel Vapor</h4>

<p>If you would like a totally serverless, auto-scaling deployment platform tuned for Laravel, check out <a href="https://vapor.laravel.com">Laravel Vapor</a>. Laravel Vapor is a serverless deployment platform for Laravel, powered by AWS. Launch your Laravel infrastructure on Vapor and fall in love with the scalable simplicity of serverless. Laravel Vapor is fine-tuned by Laravel&#39;s creators to work seamlessly with the framework so you can keep writing your Laravel applications exactly like you&#39;re used to.</p>
<div style="page-break-after: always;" ></div><ul>
<li>## Prologue

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/releases">Release Notes</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/upgrade">Upgrade Guide</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contributions">Contribution Guide</a></li>
<li><a href="/api/7.x">API Documentation</a></li>
</ul></li>
<li>## Getting Started

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/installation">Installation</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/configuration">Configuration</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/structure">Directory Structure</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/valet">Valet</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/deployment">Deployment</a></li>
</ul></li>
<li>## Architecture Concepts

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/lifecycle">Request Lifecycle</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/container">Service Container</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/providers">Service Providers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/facades">Facades</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/contracts">Contracts</a></li>
</ul></li>
<li>## The Basics

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/routing">Routing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/middleware">Middleware</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/csrf">CSRF Protection</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/controllers">Controllers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/requests">Requests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/responses">Responses</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/views">Views</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/urls">URL Generation</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/session">Session</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/validation">Validation</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/errors">Error Handling</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/logging">Logging</a></li>
</ul></li>
<li>## Frontend

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/blade">Blade Templates</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/localization">Localization</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/frontend">Frontend Scaffolding</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/mix">Compiling Assets</a></li>
</ul></li>
<li>## Security

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/authentication">Authentication</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/authorization">Authorization</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/verification">Email Verification</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/encryption">Encryption</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/hashing">Hashing</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/passwords">Password Reset</a></li>
</ul></li>
<li>## Digging Deeper

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan Console</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/broadcasting">Broadcasting</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/cache">Cache</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/collections">Collections</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/events">Events</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/filesystem">File Storage</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/helpers">Helpers</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/http-client">HTTP Client</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/mail">Mail</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/notifications">Notifications</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/packages">Package Development</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queues">Queues</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/scheduling">Task Scheduling</a></li>
</ul></li>
<li>## Database

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/database">Getting Started</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/queries">Query Builder</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/pagination">Pagination</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/migrations">Migrations</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/seeding">Seeding</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/redis">Redis</a></li>
</ul></li>
<li>## Eloquent ORM

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent">Getting Started</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">Relationships</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">Collections</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators">Mutators</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-resources">API Resources</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/eloquent-serialization">Serialization</a></li>
</ul></li>
<li>## Testing

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/testing">Getting Started</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/http-tests">HTTP Tests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/console-tests">Console Tests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/dusk">Browser Tests</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/database-testing">Database</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/mocking">Mocking</a></li>
</ul></li>
<li>## Official Packages

<ul>
<li><a href="/docs/%7B%7Bversion%7D%7D/billing">Cashier (Stripe)</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/cashier-paddle">Cashier (Paddle)</a></li>
<li><a href="https://github.com/laravel/cashier-mollie">Cashier (Mollie)</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/dusk">Dusk</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/envoy">Envoy</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/horizon">Horizon</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/passport">Passport</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/sanctum">Sanctum</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/scout">Scout</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/socialite">Socialite</a></li>
<li><a href="/docs/%7B%7Bversion%7D%7D/telescope">Telescope</a></li>
</ul></li>
</ul>
<div style="page-break-after: always;" ></div><h1>Eloquent: Collections</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#available-methods">Available Methods</a></li>
<li><a href="#custom-collections">Custom Collections</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>All multi-result sets returned by Eloquent are instances of the <code>Illuminate\Database\Eloquent\Collection</code> object, including results retrieved via the <code>get</code> method or accessed via a relationship. The Eloquent collection object extends the Laravel <a href="/docs/%7B%7Bversion%7D%7D/collections">base collection</a>, so it naturally inherits dozens of methods used to fluently work with the underlying array of Eloquent models.</p>

<p>All collections also serve as iterators, allowing you to loop over them as if they were simple PHP arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>However, collections are much more powerful than arrays and expose a variety of map / reduce operations that may be chained using an intuitive interface. For example, let&#39;s remove all inactive models and gather the first name for each remaining user:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$names</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">active</span> <span class="o">===</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} While most Eloquent collection methods return a new instance of an Eloquent collection, the <code>pluck</code>, <code>keys</code>, <code>zip</code>, <code>collapse</code>, <code>flatten</code> and <code>flip</code> methods return a <a href="/docs/%7B%7Bversion%7D%7D/collections">base collection</a> instance. Likewise, if a <code>map</code> operation returns a collection that does not contain any Eloquent models, it will be automatically cast to a base collection.</p>
</blockquote>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<p>All Eloquent collections extend the base <a href="/docs/%7B%7Bversion%7D%7D/collections#available-methods">Laravel collection</a> object; therefore, they inherit all of the powerful methods provided by the base collection class.</p>

<p>In addition, the <code>Illuminate\Database\Eloquent\Collection</code> class provides a superset of methods to aid with managing your model collections. Most methods return <code>Illuminate\Database\Eloquent\Collection</code> instances; however, some methods return a base <code>Illuminate\Support\Collection</code> instance.</p>

<style>
    #collection-method-list > p {
        column-count: 1; -moz-column-count: 1; -webkit-column-count: 1;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    #collection-method-list a {
        display: block;
    }
</style>

<div id="collection-method-list" markdown="1">

[contains](#method-contains)
[diff](#method-diff)
[except](#method-except)
[find](#method-find)
[fresh](#method-fresh)
[intersect](#method-intersect)
[load](#method-load)
[loadMissing](#method-loadMissing)
[modelKeys](#method-modelKeys)
[makeVisible](#method-makeVisible)
[makeHidden](#method-makeHidden)
[only](#method-only)
[toQuery](#method-toquery)
[unique](#method-unique)

</div>

<p><a name="method-contains"></a></p>

<h4><code>contains($key, $operator = null, $value = null)</code></h4>

<p>The <code>contains</code> method may be used to determine if a given model instance is contained by the collection. This method accepts a primary key or a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</pre></div>

<p><a name="method-diff"></a></p>

<h4><code>diff($items)</code></h4>

<p>The <code>diff</code> method returns all of the models that are not present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">diff</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">());</span>
</pre></div>

<p><a name="method-except"></a></p>

<h4><code>except($keys)</code></h4>

<p>The <code>except</code> method returns all of the models that do not have the given primary keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p><a name="method-find"></a></p>

<h4><code>find($key)</code> {#collection-method .first-collection-method}</h4>

<p>The <code>find</code> method finds a model that has a given primary key. If <code>$key</code> is a model instance, <code>find</code> will attempt to return a model matching the primary key. If <code>$key</code> is an array of keys, <code>find</code> will return all models which match the <code>$keys</code> using <code>whereIn()</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">$user</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p><a name="method-fresh"></a></p>

<h4><code>fresh($with = [])</code></h4>

<p>The <code>fresh</code> method retrieves a fresh instance of each model in the collection from the database. In addition, any specified relationships will be eager loaded:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">fresh</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">fresh</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-intersect"></a></p>

<h4><code>intersect($items)</code></h4>

<p>The <code>intersect</code> method returns all of the models that are also present in the given collection:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">());</span>
</pre></div>

<p><a name="method-load"></a></p>

<h4><code>load($relations)</code></h4>

<p>The <code>load</code> method eager loads the given relationships for all models in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">);</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;comments.author&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-loadMissing"></a></p>

<h4><code>loadMissing($relations)</code></h4>

<p>The <code>loadMissing</code> method eager loads the given relationships for all models in the collection if the relationships are not already loaded:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">loadMissing</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">);</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">loadMissing</span><span class="p">(</span><span class="s1">&#39;comments.author&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-modelKeys"></a></p>

<h4><code>modelKeys()</code></h4>

<p>The <code>modelKeys</code> method returns the primary keys for all models in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">modelKeys</span><span class="p">();</span>

<span class="c1">// [1, 2, 3, 4, 5]</span>
</pre></div>

<p><a name="method-makeVisible"></a></p>

<h4><code>makeVisible($attributes)</code></h4>

<p>The <code>makeVisible</code> method makes attributes visible that are typically &quot;hidden&quot; on each model in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">makeVisible</span><span class="p">([</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;phone_number&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="method-makeHidden"></a></p>

<h4><code>makeHidden($attributes)</code></h4>

<p>The <code>makeHidden</code> method hides attributes that are typically &quot;visible&quot; on each model in the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">makeHidden</span><span class="p">([</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;phone_number&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="method-only"></a></p>

<h4><code>only($keys)</code></h4>

<p>The <code>only</code> method returns all of the models that have the given primary keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p><a name="method-toquery"></a></p>

<h4><code>toQuery()</code></h4>

<p>The <code>toQuery</code> method returns an Eloquent query builder instance containing a <code>whereIn</code> constraint on the collection model&#39;s primary keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;VIP&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">toQuery</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span>
    <span class="s1">&#39;status&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="method-unique"></a></p>

<h4><code>unique($key = null, $strict = false)</code></h4>

<p>The <code>unique</code> method returns all of the unique models in the collection. Any models of the same type with the same primary key as another model in the collection are removed.</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
</pre></div>

<p><a name="custom-collections"></a></p>

<h2>Custom Collections</h2>

<p>If you need to use a custom <code>Collection</code> object with your own extension methods, you may override the <code>newCollection</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Support\CustomCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new Eloquent Collection instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $models</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Collection</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">newCollection</span><span class="p">(</span><span class="k">array</span> <span class="nv">$models</span> <span class="o">=</span> <span class="p">[])</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CustomCollection</span><span class="p">(</span><span class="nv">$models</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have defined a <code>newCollection</code> method, you will receive an instance of your custom collection anytime Eloquent returns a <code>Collection</code> instance of that model. If you would like to use a custom collection for every model in your application, you should override the <code>newCollection</code> method on a base model class that is extended by all of your models.</p>
<div style="page-break-after: always;" ></div><h1>Eloquent: Mutators</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#accessors-and-mutators">Accessors &amp; Mutators</a>

<ul>
<li><a href="#defining-an-accessor">Defining An Accessor</a></li>
<li><a href="#defining-a-mutator">Defining A Mutator</a></li>
</ul></li>
<li><a href="#date-mutators">Date Mutators</a></li>
<li><a href="#attribute-casting">Attribute Casting</a>

<ul>
<li><a href="#custom-casts">Custom Casts</a></li>
<li><a href="#array-and-json-casting">Array &amp; JSON Casting</a></li>
<li><a href="#date-casting">Date Casting</a></li>
<li><a href="#query-time-casting">Query Time Casting</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Accessors and mutators allow you to format Eloquent attribute values when you retrieve or set them on model instances. For example, you may want to use the <a href="/docs/%7B%7Bversion%7D%7D/encryption">Laravel encrypter</a> to encrypt a value while it is stored in the database, and then automatically decrypt the attribute when you access it on an Eloquent model.</p>

<p>In addition to custom accessors and mutators, Eloquent can also automatically cast date fields to <a href="https://github.com/briannesbitt/Carbon">Carbon</a> instances or even <a href="#attribute-casting">cast text fields to JSON</a>.</p>

<p><a name="accessors-and-mutators"></a></p>

<h2>Accessors &amp; Mutators</h2>

<p><a name="defining-an-accessor"></a></p>

<h3>Defining An Accessor</h3>

<p>To define an accessor, create a <code>getFooAttribute</code> method on your model where <code>Foo</code> is the &quot;studly&quot; cased name of the column you wish to access. In this example, we&#39;ll define an accessor for the <code>first_name</code> attribute. The accessor will automatically be called by Eloquent when attempting to retrieve the value of the <code>first_name</code> attribute:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the user&#39;s first name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $value</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFirstNameAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, the original value of the column is passed to the accessor, allowing you to manipulate and return the value. To access the value of the accessor, you may access the <code>first_name</code> attribute on a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$firstName</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">first_name</span><span class="p">;</span>
</pre></div>

<p>You may also use accessors to return new, computed values from existing attributes:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the user&#39;s full name.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getFullNameAttribute</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;{$this-&gt;first_name} {$this-&gt;last_name}&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} If you would like these computed values to be added to the array / JSON representations of your model, <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/eloquent-serialization#appending-values-to-json">you will need to append them</a>.</p>
</blockquote>

<p><a name="defining-a-mutator"></a></p>

<h3>Defining A Mutator</h3>

<p>To define a mutator, define a <code>setFooAttribute</code> method on your model where <code>Foo</code> is the &quot;studly&quot; cased name of the column you wish to access. So, again, let&#39;s define a mutator for the <code>first_name</code> attribute. This mutator will be automatically called when we attempt to set the value of the <code>first_name</code> attribute on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Set the user&#39;s first name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $value</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setFirstNameAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The mutator will receive the value that is being set on the attribute, allowing you to manipulate the value and set the manipulated value on the Eloquent model&#39;s internal <code>$attributes</code> property. So, for example, if we attempt to set the <code>first_name</code> attribute to <code>Sally</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">first_name</span> <span class="o">=</span> <span class="s1">&#39;Sally&#39;</span><span class="p">;</span>
</pre></div>

<p>In this example, the <code>setFirstNameAttribute</code> function will be called with the value <code>Sally</code>. The mutator will then apply the <code>strtolower</code> function to the name and set its resulting value in the internal <code>$attributes</code> array.</p>

<p><a name="date-mutators"></a></p>

<h2>Date Mutators</h2>

<p>By default, Eloquent will convert the <code>created_at</code> and <code>updated_at</code> columns to instances of <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, which extends the PHP <code>DateTime</code> class and provides an assortment of helpful methods. You may add additional date attributes by setting the <code>$dates</code> property of your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be mutated to dates.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;seen_at&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may disable the default <code>created_at</code> and <code>updated_at</code> timestamps by setting the public <code>$timestamps</code> property of your model to <code>false</code>.</p>
</blockquote>

<p>When a column is considered a date, you may set its value to a UNIX timestamp, date string (<code>Y-m-d</code>), date-time string, or a <code>DateTime</code> / <code>Carbon</code> instance. The date&#39;s value will be correctly converted and stored in your database:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">deleted_at</span> <span class="o">=</span> <span class="nx">now</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>As noted above, when retrieving attributes that are listed in your <code>$dates</code> property, they will automatically be cast to <a href="https://github.com/briannesbitt/Carbon">Carbon</a> instances, allowing you to use any of Carbon&#39;s methods on your attributes:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">deleted_at</span><span class="o">-&gt;</span><span class="nx">getTimestamp</span><span class="p">();</span>
</pre></div>

<h4>Date Formats</h4>

<p>By default, timestamps are formatted as <code>&#39;Y-m-d H:i:s&#39;</code>. If you need to customize the timestamp format, set the <code>$dateFormat</code> property on your model. This property determines how date attributes are stored in the database:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The storage format of the model&#39;s date columns.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="attribute-casting"></a></p>

<h2>Attribute Casting</h2>

<p>The <code>$casts</code> property on your model provides a convenient method of converting attributes to common data types. The <code>$casts</code> property should be an array where the key is the name of the attribute being cast and the value is the type you wish to cast the column to. The supported cast types are: <code>integer</code>, <code>real</code>, <code>float</code>, <code>double</code>, <code>decimal:&lt;digits&gt;</code>, <code>string</code>, <code>boolean</code>, <code>object</code>, <code>array</code>, <code>collection</code>, <code>date</code>, <code>datetime</code>, and <code>timestamp</code>. When casting to <code>decimal</code>, you must define the number of digits (<code>decimal:2</code>).</p>

<p>To demonstrate attribute casting, let&#39;s cast the <code>is_admin</code> attribute, which is stored in our database as an integer (<code>0</code> or <code>1</code>) to a boolean value:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be cast.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;is_admin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Now the <code>is_admin</code> attribute will always be cast to a boolean when you access it, even if the underlying value is stored in the database as an integer:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">is_admin</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Attributes that are <code>null</code> will not be cast. In addition, you should never define a cast (or an attribute) that has the same name as a relationship.</p>
</blockquote>

<p><a name="custom-casts"></a></p>

<h3>Custom Casts</h3>

<p>Laravel has a variety of built-in, helpful cast types; however, you may occasionally need to define your own cast types. You may accomplish this by defining a class that implements the <code>CastsAttributes</code> interface.</p>

<p>Classes that implement this interface must define a <code>get</code> and <code>set</code> method. The <code>get</code> method is responsible for transforming a raw value from the database into a cast value, while the <code>set</code> method should transform a cast value into a raw value that can be stored in the database. As an example, we will re-implement the built-in <code>json</code> cast type as a custom cast type:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Casts</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Database\Eloquent\CastsAttributes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Json</span> <span class="k">implements</span> <span class="nx">CastsAttributes</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Cast the given value.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @param  string  $key</span>
<span class="sd">     * @param  mixed  $value</span>
<span class="sd">     * @param  array  $attributes</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Prepare the given value for storage.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @param  string  $key</span>
<span class="sd">     * @param  array  $value</span>
<span class="sd">     * @param  array  $attributes</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have defined a custom cast type, you may attach it to a model attribute using its class name:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Casts\Json</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be cast.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="nx">Json</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<h4>Value Object Casting</h4>

<p>You are not limited to casting values to primitive types. You may also cast values to objects. Defining custom casts that cast values to objects is very similar to casting to primitive types; however, the <code>set</code> method should return an array of key / value pairs that will be used to set raw, storable values on the model.</p>

<p>As an example, we will define a custom cast class that casts multiple model values into a single <code>Address</code> value object. We will assume the <code>Address</code> value has two public properties: <code>lineOne</code> and <code>lineTwo</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Casts</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Address</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Database\Eloquent\CastsAttributes</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Address</span> <span class="k">implements</span> <span class="nx">CastsAttributes</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Cast the given value.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @param  string  $key</span>
<span class="sd">     * @param  mixed  $value</span>
<span class="sd">     * @param  array  $attributes</span>
<span class="sd">     * @return \App\Models\Address</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Address</span><span class="p">(</span>
            <span class="nv">$attributes</span><span class="p">[</span><span class="s1">&#39;address_line_one&#39;</span><span class="p">],</span>
            <span class="nv">$attributes</span><span class="p">[</span><span class="s1">&#39;address_line_two&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Prepare the given value for storage.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @param  string  $key</span>
<span class="sd">     * @param  \App\Models\Address  $value</span>
<span class="sd">     * @param  array  $attributes</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$value</span> <span class="nx">instanceof</span> <span class="nx">Address</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;The given value is not an Address instance.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;address_line_one&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">lineOne</span><span class="p">,</span>
            <span class="s1">&#39;address_line_two&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">lineTwo</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When casting to value objects, any changes made to the value object will automatically be synced back to the model before the model is saved:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">address</span><span class="o">-&gt;</span><span class="nx">lineOne</span> <span class="o">=</span> <span class="s1">&#39;Updated Address Value&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} If you plan to serialize your Eloquent models containing value objects to JSON or arrays, you should implement the <code>Illuminate\Contracts\Support\Arrayable</code> and <code>JsonSerializable</code> interfaces on the value object.</p>
</blockquote>

<h4>Inbound Casting</h4>

<p>Occasionally, you may need to write a custom cast that only transforms values that are being set on the model and does not perform any operations when attributes are being retrieved from the model. A classic example of an inbound only cast is a &quot;hashing&quot; cast. Inbound only custom casts should implement the <code>CastsInboundAttributes</code> interface, which only requires a <code>set</code> method to be defined.</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Casts</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Database\Eloquent\CastsInboundAttributes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Hash</span> <span class="k">implements</span> <span class="nx">CastsInboundAttributes</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The hashing algorithm.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$algorithm</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new cast class instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string|null  $algorithm</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$algorithm</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">algorithm</span> <span class="o">=</span> <span class="nv">$algorithm</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Prepare the given value for storage.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @param  string  $key</span>
<span class="sd">     * @param  array  $value</span>
<span class="sd">     * @param  array  $attributes</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">algorithm</span><span class="p">)</span>
                    <span class="o">?</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
                    <span class="o">:</span> <span class="nb">hash</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">algorithm</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Cast Parameters</h4>

<p>When attaching a custom cast to a model, cast parameters may be specified by separating them from the class name using a <code>:</code> character and comma-delimiting multiple parameters. The parameters will be passed to the constructor of the cast class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The attributes that should be cast.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="kr">class</span><span class="p">.</span><span class="s1">&#39;:sha256&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<h4>Castables</h4>

<p>Instead of attaching the custom cast to your model, you may alternatively attach a class that implements the <code>Illuminate\Contracts\Database\Eloquent\Castable</code> interface:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Address</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Objects that implement the <code>Castable</code> interface must define a <code>castUsing</code> method that returns the class name of the custom caster class that is responsible for casting to and from the <code>Castable</code> class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Database\Eloquent\Castable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Casts\Address</span> <span class="k">as</span> <span class="nx">AddressCast</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Address</span> <span class="k">implements</span> <span class="nx">Castable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the name of the caster class to use when casting from / to this cast target.</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">castUsing</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">AddressCast</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When using <code>Castable</code> classes, you may still provide arguments in the <code>$casts</code> definition. The arguments will be passed directly to the caster class:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Address</span><span class="o">::</span><span class="kr">class</span><span class="p">.</span><span class="s1">&#39;:argument&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="array-and-json-casting"></a></p>

<h3>Array &amp; JSON Casting</h3>

<p>The <code>array</code> cast type is particularly useful when working with columns that are stored as serialized JSON. For example, if your database has a <code>JSON</code> or <code>TEXT</code> field type that contains serialized JSON, adding the <code>array</code> cast to that attribute will automatically deserialize the attribute to a PHP array when you access it on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be cast.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once the cast is defined, you may access the <code>options</code> attribute and it will automatically be deserialized from JSON into a PHP array. When you set the value of the <code>options</code> attribute, the given array will automatically be serialized back into JSON for storage:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$options</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span><span class="p">;</span>

<span class="nx">$options</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$options</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="date-casting"></a></p>

<h3>Date Casting</h3>

<p>When using the <code>date</code> or <code>datetime</code> cast type, you may specify the date&#39;s format. This format will be used when the <a href="/docs/%7B%7Bversion%7D%7D/eloquent-serialization">model is serialized to an array or JSON</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The attributes that should be cast.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;created_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;datetime:Y-m-d&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="query-time-casting"></a></p>

<h3>Query Time Casting</h3>

<p>Sometimes you may need to apply casts while executing a query, such as when selecting a raw value from a table. For example, consider the following query:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">select</span><span class="p">([</span>
    <span class="s1">&#39;users.*&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_posted_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">selectRaw</span><span class="p">(</span><span class="s1">&#39;MAX(created_at)&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">)</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>last_posted_at</code> attribute on the results of this query will be a raw string. It would be convenient if we could apply a <code>date</code> cast to this attribute when executing the query. To accomplish this, we may use the <code>withCasts</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">select</span><span class="p">([</span>
    <span class="s1">&#39;users.*&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_posted_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">Post</span><span class="o">::</span><span class="nx">selectRaw</span><span class="p">(</span><span class="s1">&#39;MAX(created_at)&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">)</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">withCasts</span><span class="p">([</span>
    <span class="s1">&#39;last_posted_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;datetime&#39;</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Relationships</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-relationships">Defining Relationships</a>

<ul>
<li><a href="#one-to-one">One To One</a></li>
<li><a href="#one-to-many">One To Many</a></li>
<li><a href="#one-to-many-inverse">One To Many (Inverse)</a></li>
<li><a href="#many-to-many">Many To Many</a></li>
<li><a href="#defining-custom-intermediate-table-models">Defining Custom Intermediate Table Models</a></li>
<li><a href="#has-one-through">Has One Through</a></li>
<li><a href="#has-many-through">Has Many Through</a></li>
</ul></li>
<li><a href="#polymorphic-relationships">Polymorphic Relationships</a>

<ul>
<li><a href="#one-to-one-polymorphic-relations">One To One</a></li>
<li><a href="#one-to-many-polymorphic-relations">One To Many</a></li>
<li><a href="#many-to-many-polymorphic-relations">Many To Many</a></li>
<li><a href="#custom-polymorphic-types">Custom Polymorphic Types</a></li>
</ul></li>
<li><a href="#dynamic-relationships">Dynamic Relationships</a></li>
<li><a href="#querying-relations">Querying Relations</a>

<ul>
<li><a href="#relationship-methods-vs-dynamic-properties">Relationship Methods Vs. Dynamic Properties</a></li>
<li><a href="#querying-relationship-existence">Querying Relationship Existence</a></li>
<li><a href="#querying-relationship-absence">Querying Relationship Absence</a></li>
<li><a href="#querying-polymorphic-relationships">Querying Polymorphic Relationships</a></li>
<li><a href="#counting-related-models">Counting Related Models</a></li>
<li><a href="#counting-related-models-on-polymorphic-relationships">Counting Related Models On Polymorphic Relationships</a></li>
</ul></li>
<li><a href="#eager-loading">Eager Loading</a>

<ul>
<li><a href="#constraining-eager-loads">Constraining Eager Loads</a></li>
<li><a href="#lazy-eager-loading">Lazy Eager Loading</a></li>
</ul></li>
<li><a href="#inserting-and-updating-related-models">Inserting &amp; Updating Related Models</a>

<ul>
<li><a href="#the-save-method">The <code>save</code> Method</a></li>
<li><a href="#the-create-method">The <code>create</code> Method</a></li>
<li><a href="#updating-belongs-to-relationships">Belongs To Relationships</a></li>
<li><a href="#updating-many-to-many-relationships">Many To Many Relationships</a></li>
</ul></li>
<li><a href="#touching-parent-timestamps">Touching Parent Timestamps</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Database tables are often related to one another. For example, a blog post may have many comments, or an order could be related to the user who placed it. Eloquent makes managing and working with these relationships easy, and supports several different types of relationships:</p>

<div class="content-list" markdown="1">
- [One To One](#one-to-one)
- [One To Many](#one-to-many)
- [Many To Many](#many-to-many)
- [Has One Through](#has-one-through)
- [Has Many Through](#has-many-through)
- [One To One (Polymorphic)](#one-to-one-polymorphic-relations)
- [One To Many (Polymorphic)](#one-to-many-polymorphic-relations)
- [Many To Many (Polymorphic)](#many-to-many-polymorphic-relations)
</div>

<p><a name="defining-relationships"></a></p>

<h2>Defining Relationships</h2>

<p>Eloquent relationships are defined as methods on your Eloquent model classes. Since, like Eloquent models themselves, relationships also serve as powerful <a href="/docs/%7B%7Bversion%7D%7D/queries">query builders</a>, defining relationships as methods provides powerful method chaining and querying capabilities. For example, we may chain additional constraints on this <code>posts</code> relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>But, before diving too deep into using relationships, let&#39;s learn how to define each type.</p>

<blockquote>
<p>{note} Relationship names cannot collide with attribute names as that could lead to your model not being able to know which one to resolve.</p>
</blockquote>

<p><a name="one-to-one"></a></p>

<h3>One To One</h3>

<p>A one-to-one relationship is a very basic relation. For example, a <code>User</code> model might be associated with one <code>Phone</code>. To define this relationship, we place a <code>phone</code> method on the <code>User</code> model. The <code>phone</code> method should call the <code>hasOne</code> method and return its result:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the phone record associated with the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">phone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Models\Phone&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasOne</code> method is the name of the related model. Once the relationship is defined, we may retrieve the related record using Eloquent&#39;s dynamic properties. Dynamic properties allow you to access relationship methods as if they were properties defined on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$phone</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">phone</span><span class="p">;</span>
</pre></div>

<p>Eloquent determines the foreign key of the relationship based on the model name. In this case, the <code>Phone</code> model is automatically assumed to have a <code>user_id</code> foreign key. If you wish to override this convention, you may pass a second argument to the <code>hasOne</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Models\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
</pre></div>

<p>Additionally, Eloquent assumes that the foreign key should have a value matching the <code>id</code> (or the custom <code>$primaryKey</code>) column of the parent. In other words, Eloquent will look for the value of the user&#39;s <code>id</code> column in the <code>user_id</code> column of the <code>Phone</code> record. If you would like the relationship to use a value other than <code>id</code>, you may pass a third argument to the <code>hasOne</code> method specifying your custom key:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOne</span><span class="p">(</span><span class="s1">&#39;App\Models\Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of The Relationship</h4>

<p>So, we can access the <code>Phone</code> model from our <code>User</code>. Now, let&#39;s define a relationship on the <code>Phone</code> model that will let us access the <code>User</code> that owns the phone. We can define the inverse of a <code>hasOne</code> relationship using the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Phone</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the user that owns the phone.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In the example above, Eloquent will try to match the <code>user_id</code> from the <code>Phone</code> model to an <code>id</code> on the <code>User</code> model. Eloquent determines the default foreign key name by examining the name of the relationship method and suffixing the method name with <code>_id</code>. However, if the foreign key on the <code>Phone</code> model is not <code>user_id</code>, you may pass a custom key name as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the user that owns the phone.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If your parent model does not use <code>id</code> as its primary key, or you wish to join the child model to a different column, you may pass a third argument to the <code>belongsTo</code> method specifying your parent table&#39;s custom key:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the user that owns the phone.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;other_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="one-to-many"></a></p>

<h3>One To Many</h3>

<p>A one-to-many relationship is used to define relationships where a single model owns any amount of other models. For example, a blog post may have an infinite number of comments. Like all other Eloquent relationships, one-to-many relationships are defined by placing a function on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the comments for the blog post.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Comment&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Remember, Eloquent will automatically determine the proper foreign key column on the <code>Comment</code> model. By convention, Eloquent will take the &quot;snake case&quot; name of the owning model and suffix it with <code>_id</code>. So, for this example, Eloquent will assume the foreign key on the <code>Comment</code> model is <code>post_id</code>.</p>

<p>Once the relationship has been defined, we can access the collection of comments by accessing the <code>comments</code> property. Remember, since Eloquent provides &quot;dynamic properties&quot;, we can access relationship methods as if they were defined as properties on the model:</p>
<div class="highlight"><pre><span></span><span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">;</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$comments</span> <span class="nx">as</span> <span class="nx">$comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Since all relationships also serve as query builders, you can add further constraints to which comments are retrieved by calling the <code>comments</code> method and continuing to chain conditions onto the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<p>Like the <code>hasOne</code> method, you may also override the foreign and local keys by passing additional arguments to the <code>hasMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;local_key&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="one-to-many-inverse"></a></p>

<h3>One To Many (Inverse)</h3>

<p>Now that we can access all of a post&#39;s comments, let&#39;s define a relationship to allow a comment to access its parent post. To define the inverse of a <code>hasMany</code> relationship, define a relationship function on the child model which calls the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the post that owns the comment.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the relationship has been defined, we can retrieve the <code>Post</code> model for a <code>Comment</code> by accessing the <code>post</code> &quot;dynamic property&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">post</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">;</span>
</pre></div>

<p>In the example above, Eloquent will try to match the <code>post_id</code> from the <code>Comment</code> model to an <code>id</code> on the <code>Post</code> model. Eloquent determines the default foreign key name by examining the name of the relationship method and suffixing the method name with a <code>_</code> followed by the name of the primary key column. However, if the foreign key on the <code>Comment</code> model is not <code>post_id</code>, you may pass a custom key name as the second argument to the <code>belongsTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the post that owns the comment.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If your parent model does not use <code>id</code> as its primary key, or you wish to join the child model to a different column, you may pass a third argument to the <code>belongsTo</code> method specifying your parent table&#39;s custom key:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the post that owns the comment.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">post</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;foreign_key&#39;</span><span class="p">,</span> <span class="s1">&#39;other_key&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="many-to-many"></a></p>

<h3>Many To Many</h3>

<p>Many-to-many relations are slightly more complicated than <code>hasOne</code> and <code>hasMany</code> relationships. An example of such a relationship is a user with many roles, where the roles are also shared by other users. For example, many users may have the role of &quot;Admin&quot;.</p>

<h4>Table Structure</h4>

<p>To define this relationship, three database tables are needed: <code>users</code>, <code>roles</code>, and <code>role_user</code>. The <code>role_user</code> table is derived from the alphabetical order of the related model names, and contains the <code>user_id</code> and <code>role_id</code> columns:</p>
<div class="highlight"><pre><span></span><span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">roles</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">role_user</span>
    <span class="nx">user_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">role_id</span> <span class="o">-</span> <span class="nx">integer</span>
</pre></div>

<h4>Model Structure</h4>

<p>Many-to-many relationships are defined by writing a method that returns the result of the <code>belongsToMany</code> method. For example, let&#39;s define the <code>roles</code> method on our <code>User</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The roles that belong to the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">roles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the relationship is defined, you may access the user&#39;s roles using the <code>roles</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Like all other relationship types, you may call the <code>roles</code> method to continue chaining query constraints onto the relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>As mentioned previously, to determine the table name of the relationship&#39;s joining table, Eloquent will join the two related model names in alphabetical order. However, you are free to override this convention. You may do so by passing a second argument to the <code>belongsToMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;role_user&#39;</span><span class="p">);</span>
</pre></div>

<p>In addition to customizing the name of the joining table, you may also customize the column names of the keys on the table by passing additional arguments to the <code>belongsToMany</code> method. The third argument is the foreign key name of the model on which you are defining the relationship, while the fourth argument is the foreign key name of the model that you are joining to:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;role_user&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Inverse Of The Relationship</h4>

<p>To define the inverse of a many-to-many relationship, you place another call to <code>belongsToMany</code> on your related model. To continue our user roles example, let&#39;s define the <code>users</code> method on the <code>Role</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Role</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The users that belong to the role.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, the relationship is defined exactly the same as its <code>User</code> counterpart, with the exception of referencing the <code>App\Models\User</code> model. Since we&#39;re reusing the <code>belongsToMany</code> method, all of the usual table and key customization options are available when defining the inverse of many-to-many relationships.</p>

<h4>Retrieving Intermediate Table Columns</h4>

<p>As you have already learned, working with many-to-many relations requires the presence of an intermediate table. Eloquent provides some very helpful ways of interacting with this table. For example, let&#39;s assume our <code>User</code> object has many <code>Role</code> objects that it is related to. After accessing this relationship, we may access the intermediate table using the <code>pivot</code> attribute on the models:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span> <span class="nx">as</span> <span class="nx">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$role</span><span class="o">-&gt;</span><span class="nx">pivot</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Notice that each <code>Role</code> model we retrieve is automatically assigned a <code>pivot</code> attribute. This attribute contains a model representing the intermediate table, and may be used like any other Eloquent model.</p>

<p>By default, only the model keys will be present on the <code>pivot</code> object. If your pivot table contains extra attributes, you must specify them when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withPivot</span><span class="p">(</span><span class="s1">&#39;column1&#39;</span><span class="p">,</span> <span class="s1">&#39;column2&#39;</span><span class="p">);</span>
</pre></div>

<p>If you want your pivot table to have automatically maintained <code>created_at</code> and <code>updated_at</code> timestamps, use the <code>withTimestamps</code> method on the relationship definition:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withTimestamps</span><span class="p">();</span>
</pre></div>

<h4>Customizing The <code>pivot</code> Attribute Name</h4>

<p>As noted earlier, attributes from the intermediate table may be accessed on models using the <code>pivot</code> attribute. However, you are free to customize the name of this attribute to better reflect its purpose within your application.</p>

<p>For example, if your application contains users that may subscribe to podcasts, you probably have a many-to-many relationship between users and podcasts. If this is the case, you may wish to rename your intermediate table accessor to <code>subscription</code> instead of <code>pivot</code>. This can be done using the <code>as</code> method when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Podcast&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">as</span><span class="p">(</span><span class="s1">&#39;subscription&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">withTimestamps</span><span class="p">();</span>
</pre></div>

<p>Once this is done, you may access the intermediate table data using the customized name:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;podcasts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">flatMap</span><span class="o">-&gt;</span><span class="nx">podcasts</span> <span class="nx">as</span> <span class="nx">$podcast</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$podcast</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Filtering Relationships Via Intermediate Table Columns</h4>

<p>You can also filter the results returned by <code>belongsToMany</code> using the <code>wherePivot</code>, <code>wherePivotIn</code>, and <code>wherePivotNotIn</code> methods when defining the relationship:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">wherePivot</span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">wherePivotIn</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>

<span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">wherePivotNotIn</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</pre></div>

<p><a name="defining-custom-intermediate-table-models"></a></p>

<h3>Defining Custom Intermediate Table Models</h3>

<p>If you would like to define a custom model to represent the intermediate table of your relationship, you may call the <code>using</code> method when defining the relationship. Custom many-to-many pivot models should extend the <code>Illuminate\Database\Eloquent\Relations\Pivot</code> class while custom polymorphic many-to-many pivot models should extend the <code>Illuminate\Database\Eloquent\Relations\MorphPivot</code> class. For example, we may define a <code>Role</code> which uses a custom <code>RoleUser</code> pivot model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Role</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The users that belong to the role.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">using</span><span class="p">(</span><span class="s1">&#39;App\Models\RoleUser&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When defining the <code>RoleUser</code> model, we will extend the <code>Pivot</code> class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\Pivot</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RoleUser</span> <span class="k">extends</span> <span class="nx">Pivot</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You can combine <code>using</code> and <code>withPivot</code> in order to retrieve columns from the intermediate table. For example, you may retrieve the <code>created_by</code> and <code>updated_by</code> columns from the <code>RoleUser</code> pivot table by passing the column names to the <code>withPivot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Role</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The users that belong to the role.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">users</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">using</span><span class="p">(</span><span class="s1">&#39;App\Models\RoleUser&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withPivot</span><span class="p">([</span>
                            <span class="s1">&#39;created_by&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;updated_by&#39;</span><span class="p">,</span>
                        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>Note:</strong> Pivot models may not use the <code>SoftDeletes</code> trait. If you need to soft delete pivot records consider converting your pivot model to an actual Eloquent model.</p>
</blockquote>

<h4>Custom Pivot Models And Incrementing IDs</h4>

<p>If you have defined a many-to-many relationship that uses a custom pivot model, and that pivot model has an auto-incrementing primary key, you should ensure your custom pivot model class defines an <code>incrementing</code> property that is set to <code>true</code>.</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Indicates if the IDs are auto-incrementing.</span>
<span class="cm"> *</span>
<span class="cm"> * @var bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="nx">$incrementing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>

<p><a name="has-one-through"></a></p>

<h3>Has One Through</h3>

<p>The &quot;has-one-through&quot; relationship links models through a single intermediate relation.</p>

<p>For example, in a vehicle repair shop application, each <code>Mechanic</code> may have one <code>Car</code>, and each <code>Car</code> may have one <code>Owner</code>. While the <code>Mechanic</code> and the <code>Owner</code> have no direct connection, the <code>Mechanic</code> can access the <code>Owner</code> <em>through</em> the <code>Car</code> itself. Let&#39;s look at the tables necessary to define this relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">mechanics</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">cars</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">model</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">mechanic_id</span> <span class="o">-</span> <span class="nx">integer</span>

<span class="nx">owners</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">car_id</span> <span class="o">-</span> <span class="nx">integer</span>
</pre></div>

<p>Now that we have examined the table structure for the relationship, let&#39;s define the relationship on the <code>Mechanic</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Mechanic</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the car&#39;s owner.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">carOwner</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasOneThrough</span><span class="p">(</span><span class="s1">&#39;App\Models\Owner&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Models\Car&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasOneThrough</code> method is the name of the final model we wish to access, while the second argument is the name of the intermediate model.</p>

<p>Typical Eloquent foreign key conventions will be used when performing the relationship&#39;s queries. If you would like to customize the keys of the relationship, you may pass them as the third and fourth arguments to the <code>hasOneThrough</code> method. The third argument is the name of the foreign key on the intermediate model. The fourth argument is the name of the foreign key on the final model. The fifth argument is the local key, while the sixth argument is the local key of the intermediate model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Mechanic</span> <span class="kr">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Get the car&#39;s owner.</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">carOwner</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasOneThrough</span><span class="p">(</span>
            <span class="s1">&#39;App\Models\Owner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;App\Models\Car&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mechanic_id&#39;</span><span class="p">,</span> <span class="c1">// Foreign key on cars table...</span>
            <span class="s1">&#39;car_id&#39;</span><span class="p">,</span> <span class="c1">// Foreign key on owners table...</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="c1">// Local key on mechanics table...</span>
            <span class="s1">&#39;id&#39;</span> <span class="c1">// Local key on cars table...</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="has-many-through"></a></p>

<h3>Has Many Through</h3>

<p>The &quot;has-many-through&quot; relationship provides a convenient shortcut for accessing distant relations via an intermediate relation. For example, a <code>Country</code> model might have many <code>Post</code> models through an intermediate <code>User</code> model. In this example, you could easily gather all blog posts for a given country. Let&#39;s look at the tables required to define this relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">countries</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">country_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">user_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Though <code>posts</code> does not contain a <code>country_id</code> column, the <code>hasManyThrough</code> relation provides access to a country&#39;s posts via <code>$country-&gt;posts</code>. To perform this query, Eloquent inspects the <code>country_id</code> on the intermediate <code>users</code> table. After finding the matching user IDs, they are used to query the <code>posts</code> table.</p>

<p>Now that we have examined the table structure for the relationship, let&#39;s define it on the <code>Country</code> model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Country</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts for the country.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasManyThrough</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Models\User&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>hasManyThrough</code> method is the name of the final model we wish to access, while the second argument is the name of the intermediate model.</p>

<p>Typical Eloquent foreign key conventions will be used when performing the relationship&#39;s queries. If you would like to customize the keys of the relationship, you may pass them as the third and fourth arguments to the <code>hasManyThrough</code> method. The third argument is the name of the foreign key on the intermediate model. The fourth argument is the name of the foreign key on the final model. The fifth argument is the local key, while the sixth argument is the local key of the intermediate model:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Country</span> <span class="kr">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hasManyThrough</span><span class="p">(</span>
            <span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span>
            <span class="s1">&#39;App\Models\User&#39;</span><span class="p">,</span>
            <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="c1">// Foreign key on users table...</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="c1">// Foreign key on posts table...</span>
            <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="c1">// Local key on countries table...</span>
            <span class="s1">&#39;id&#39;</span> <span class="c1">// Local key on users table...</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="polymorphic-relationships"></a></p>

<h2>Polymorphic Relationships</h2>

<p>A polymorphic relationship allows the target model to belong to more than one type of model using a single association.</p>

<p><a name="one-to-one-polymorphic-relations"></a></p>

<h3>One To One (Polymorphic)</h3>

<h4>Table Structure</h4>

<p>A one-to-one polymorphic relation is similar to a simple one-to-one relation; however, the target model can belong to more than one type of model on a single association. For example, a blog <code>Post</code> and a <code>User</code> may share a polymorphic relation to an <code>Image</code> model. Using a one-to-one polymorphic relation allows you to have a single list of unique images that are used for both blog posts and user accounts. First, let&#39;s examine the table structure:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">users</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">images</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">url</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">imageable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">imageable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<p>Take note of the <code>imageable_id</code> and <code>imageable_type</code> columns on the <code>images</code> table. The <code>imageable_id</code> column will contain the ID value of the post or user, while the <code>imageable_type</code> column will contain the class name of the parent model. The <code>imageable_type</code> column is used by Eloquent to determine which &quot;type&quot; of parent model to return when accessing the <code>imageable</code> relation.</p>

<h4>Model Structure</h4>

<p>Next, let&#39;s examine the model definitions needed to build this relationship:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Image</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the owning imageable model.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">imageable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the post&#39;s image.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">image</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphOne</span><span class="p">(</span><span class="s1">&#39;App\Models\Image&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the user&#39;s image.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">image</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphOne</span><span class="p">(</span><span class="s1">&#39;App\Models\Image&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Relationship</h4>

<p>Once your database table and models are defined, you may access the relationships via your models. For example, to retrieve the image for a post, we can use the <code>image</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$image</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">image</span><span class="p">;</span>
</pre></div>

<p>You may also retrieve the parent from the polymorphic model by accessing the name of the method that performs the call to <code>morphTo</code>. In our case, that is the <code>imageable</code> method on the <code>Image</code> model. So, we will access that method as a dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$image</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Image</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$imageable</span> <span class="o">=</span> <span class="nx">$image</span><span class="o">-&gt;</span><span class="nx">imageable</span><span class="p">;</span>
</pre></div>

<p>The <code>imageable</code> relation on the <code>Image</code> model will return either a <code>Post</code> or <code>User</code> instance, depending on which type of model owns the image. If you need to specify custom <code>type</code> and <code>id</code> columns for the <code>morphTo</code> relation, always ensure you pass the relationship name (which should exactly match the method name) as the first parameter:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the model that the image belongs to.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">imageable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">morphTo</span><span class="p">(</span><span class="nx">__FUNCTION__</span><span class="p">,</span> <span class="s1">&#39;imageable_type&#39;</span><span class="p">,</span> <span class="s1">&#39;imageable_id&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="one-to-many-polymorphic-relations"></a></p>

<h3>One To Many (Polymorphic)</h3>

<h4>Table Structure</h4>

<p>A one-to-many polymorphic relation is similar to a simple one-to-many relation; however, the target model can belong to more than one type of model on a single association. For example, imagine users of your application can &quot;comment&quot; on both posts and videos. Using polymorphic relationships, you may use a single <code>comments</code> table for both of these scenarios. First, let&#39;s examine the table structure required to build this relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">body</span> <span class="o">-</span> <span class="nx">text</span>

<span class="nx">videos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">title</span> <span class="o">-</span> <span class="nx">string</span>
    <span class="nx">url</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">comments</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">body</span> <span class="o">-</span> <span class="nx">text</span>
    <span class="nx">commentable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">commentable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<h4>Model Structure</h4>

<p>Next, let&#39;s examine the model definitions needed to build this relationship:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the owning commentable model.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">commentable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the post&#39;s comments.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;commentable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Video</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the video&#39;s comments.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">comments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Comment&#39;</span><span class="p">,</span> <span class="s1">&#39;commentable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Relationship</h4>

<p>Once your database table and models are defined, you may access the relationships via your models. For example, to access all of the comments for a post, we can use the <code>comments</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span> <span class="nx">as</span> <span class="nx">$comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also retrieve the owner of a polymorphic relation from the polymorphic model by accessing the name of the method that performs the call to <code>morphTo</code>. In our case, that is the <code>commentable</code> method on the <code>Comment</code> model. So, we will access that method as a dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$commentable</span> <span class="o">=</span> <span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">commentable</span><span class="p">;</span>
</pre></div>

<p>The <code>commentable</code> relation on the <code>Comment</code> model will return either a <code>Post</code> or <code>Video</code> instance, depending on which type of model owns the comment.</p>

<p><a name="many-to-many-polymorphic-relations"></a></p>

<h3>Many To Many (Polymorphic)</h3>

<h4>Table Structure</h4>

<p>Many-to-many polymorphic relations are slightly more complicated than <code>morphOne</code> and <code>morphMany</code> relationships. For example, a blog <code>Post</code> and <code>Video</code> model could share a polymorphic relation to a <code>Tag</code> model. Using a many-to-many polymorphic relation allows you to have a single list of unique tags that are shared across blog posts and videos. First, let&#39;s examine the table structure:</p>
<div class="highlight"><pre><span></span><span class="nx">posts</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">videos</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">tags</span>
    <span class="nx">id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">name</span> <span class="o">-</span> <span class="nx">string</span>

<span class="nx">taggables</span>
    <span class="nx">tag_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_id</span> <span class="o">-</span> <span class="nx">integer</span>
    <span class="nx">taggable_type</span> <span class="o">-</span> <span class="nx">string</span>
</pre></div>

<h4>Model Structure</h4>

<p>Next, we&#39;re ready to define the relationships on the model. The <code>Post</code> and <code>Video</code> models will both have a <code>tags</code> method that calls the <code>morphToMany</code> method on the base Eloquent class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the tags for the post.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tags</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphToMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Tag&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Defining The Inverse Of The Relationship</h4>

<p>Next, on the <code>Tag</code> model, you should define a method for each of its related models. So, for this example, we will define a <code>posts</code> method and a <code>videos</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Tag</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts that are assigned this tag.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get all of the videos that are assigned this tag.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">videos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphedByMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Video&#39;</span><span class="p">,</span> <span class="s1">&#39;taggable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Relationship</h4>

<p>Once your database table and models are defined, you may access the relationships via your models. For example, to access all of the tags for a post, you can use the <code>tags</code> dynamic property:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">tags</span> <span class="nx">as</span> <span class="nx">$tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>You may also retrieve the owner of a polymorphic relation from the polymorphic model by accessing the name of the method that performs the call to <code>morphedByMany</code>. In our case, that is the <code>posts</code> or <code>videos</code> methods on the <code>Tag</code> model. So, you will access those methods as dynamic properties:</p>
<div class="highlight"><pre><span></span><span class="nx">$tag</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Tag</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$tag</span><span class="o">-&gt;</span><span class="nx">videos</span> <span class="nx">as</span> <span class="nx">$video</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="custom-polymorphic-types"></a></p>

<h3>Custom Polymorphic Types</h3>

<p>By default, Laravel will use the fully qualified class name to store the type of the related model. For instance, given the one-to-many example above where a <code>Comment</code> may belong to a <code>Post</code> or a <code>Video</code>, the default <code>commentable_type</code> would be either <code>App\Models\Post</code> or <code>App\Models\Video</code>, respectively. However, you may wish to decouple your database from your application&#39;s internal structure. In that case, you may define a &quot;morph map&quot; to instruct Eloquent to use a custom name for each model instead of the class name:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Relations</span><span class="err">\</span><span class="nx">Relation</span><span class="p">;</span>

<span class="nx">Relation</span><span class="o">::</span><span class="nx">morphMap</span><span class="p">([</span>
    <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span>
    <span class="s1">&#39;videos&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App\Models\Video&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>You may register the <code>morphMap</code> in the <code>boot</code> function of your <code>AppServiceProvider</code> or create a separate service provider if you wish.</p>

<blockquote>
<p>{note} When adding a &quot;morph map&quot; to your existing application, every morphable <code>*_type</code> column value in your database that still contains a fully-qualified class will need to be converted to its &quot;map&quot; name.</p>
</blockquote>

<p>You may determine the morph alias of a given model at runtime using the <code>getMorphClass</code> method. Conversely, you may determine the fully-qualified class name associated with a morph alias using the <code>Relation::getMorphedModel</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Relations</span><span class="err">\</span><span class="nx">Relation</span><span class="p">;</span>

<span class="nx">$alias</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">getMorphClass</span><span class="p">();</span>

<span class="nx">$class</span> <span class="o">=</span> <span class="nx">Relation</span><span class="o">::</span><span class="nx">getMorphedModel</span><span class="p">(</span><span class="nx">$alias</span><span class="p">);</span>
</pre></div>

<p><a name="dynamic-relationships"></a></p>

<h3>Dynamic Relationships</h3>

<p>You may use the <code>resolveRelationUsing</code> method to define relations between Eloquent models at runtime. While not typically recommended for normal application development, this may occasionally be useful when developing Laravel packages:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Customer</span><span class="p">;</span>

<span class="nx">Order</span><span class="o">::</span><span class="nx">resolveRelationUsing</span><span class="p">(</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$orderModel</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$orderModel</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">Customer</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;customer_id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} When defining dynamic relationships, always provide explicit key name arguments to the Eloquent relationship methods.</p>
</blockquote>

<p><a name="querying-relations"></a></p>

<h2>Querying Relations</h2>

<p>Since all types of Eloquent relationships are defined via methods, you may call those methods to obtain an instance of the relationship without actually executing the relationship queries. In addition, all types of Eloquent relationships also serve as <a href="/docs/%7B%7Bversion%7D%7D/queries">query builders</a>, allowing you to continue to chain constraints onto the relationship query before finally executing the SQL against your database.</p>

<p>For example, imagine a blog system in which a <code>User</code> model has many associated <code>Post</code> models:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get all of the posts for the user.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">posts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may query the <code>posts</code> relationship and add additional constraints to the relationship like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You are able to use any of the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> methods on the relationship, so be sure to explore the query builder documentation to learn about all of the methods that are available to you.</p>

<h4>Chaining <code>orWhere</code> Clauses After Relationships</h4>

<p>As demonstrated in the example above, you are free to add additional constraints to relationships when querying them. However, use caution when chaining <code>orWhere</code> clauses onto a relationship, as the <code>orWhere</code> clauses will be logically grouped at the same level as the relationship constraint:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// select * from posts</span>
<span class="c1">// where user_id = ? and active = 1 or votes &gt;= 100</span>
</pre></div>

<p>In most situations, you likely intend to use <a href="/docs/%7B%7Bversion%7D%7D/queries#parameter-grouping">constraint groups</a> to logically group the conditional checks between parentheses:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// select * from posts</span>
<span class="c1">// where user_id = ? and (active = 1 or votes &gt;= 100)</span>
</pre></div>

<p><a name="relationship-methods-vs-dynamic-properties"></a></p>

<h3>Relationship Methods Vs. Dynamic Properties</h3>

<p>If you do not need to add additional constraints to an Eloquent relationship query, you may access the relationship as if it were a property. For example, continuing to use our <code>User</code> and <code>Post</code> example models, we may access all of a user&#39;s posts like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">posts</span> <span class="nx">as</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>Dynamic properties are &quot;lazy loading&quot;, meaning they will only load their relationship data when you actually access them. Because of this, developers often use <a href="#eager-loading">eager loading</a> to pre-load relationships they know will be accessed after loading the model. Eager loading provides a significant reduction in SQL queries that must be executed to load a model&#39;s relations.</p>

<p><a name="querying-relationship-existence"></a></p>

<h3>Querying Relationship Existence</h3>

<p>When accessing the records for a model, you may wish to limit your results based on the existence of a relationship. For example, imagine you want to retrieve all blog posts that have at least one comment. To do so, you may pass the name of the relationship to the <code>has</code> and <code>orHas</code> methods:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts that have at least one comment...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also specify an operator and count to further customize the query:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve all posts that have three or more comments...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Nested <code>has</code> statements may also be constructed using &quot;dot&quot; notation. For example, you may retrieve all posts that have at least one comment and vote:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve posts that have at least one comment with votes...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;comments.votes&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need even more power, you may use the <code>whereHas</code> and <code>orWhereHas</code> methods to put &quot;where&quot; conditions on your <code>has</code> queries. These methods allow you to add customized constraints to a relationship constraint, such as checking the content of a comment:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="c1">// Retrieve posts with at least one comment containing words like foo%...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Retrieve posts with at least ten comments containing words like foo%...</span>
<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">},</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="querying-relationship-absence"></a></p>

<h3>Querying Relationship Absence</h3>

<p>When accessing the records for a model, you may wish to limit your results based on the absence of a relationship. For example, imagine you want to retrieve all blog posts that <strong>don&#39;t</strong> have any comments. To do so, you may pass the name of the relationship to the <code>doesntHave</code> and <code>orDoesntHave</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">doesntHave</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need even more power, you may use the <code>whereDoesntHave</code> and <code>orWhereDoesntHave</code> methods to put &quot;where&quot; conditions on your <code>doesntHave</code> queries. These methods allows you to add customized constraints to a relationship constraint, such as checking the content of a comment:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">whereDoesntHave</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may use &quot;dot&quot; notation to execute a query against a nested relationship. For example, the following query will retrieve all posts that do not have comments and posts that have comments from authors that are not banned:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">whereDoesntHave</span><span class="p">(</span><span class="s1">&#39;comments.author&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;banned&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="querying-polymorphic-relationships"></a></p>

<h3>Querying Polymorphic Relationships</h3>

<p>To query the existence of <code>MorphTo</code> relationships, you may use the <code>whereHasMorph</code> method and its corresponding methods:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="c1">// Retrieve comments associated to posts or videos with a title like foo%...</span>
<span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">whereHasMorph</span><span class="p">(</span>
    <span class="s1">&#39;commentable&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Models\Video&#39;</span><span class="p">],</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Retrieve comments associated to posts with a title not like foo%...</span>
<span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">whereDoesntHaveMorph</span><span class="p">(</span>
    <span class="s1">&#39;commentable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may use the <code>$type</code> parameter to add different constraints depending on the related model:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">whereHasMorph</span><span class="p">(</span>
    <span class="s1">&#39;commentable&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Models\Video&#39;</span><span class="p">],</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$type</span> <span class="o">===</span> <span class="s1">&#39;App\Models\Post&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Instead of passing an array of possible polymorphic models, you may provide <code>*</code> as a wildcard and let Laravel retrieve all the possible polymorphic types from the database. Laravel will execute an additional query in order to perform this operation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$comments</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">whereHasMorph</span><span class="p">(</span><span class="s1">&#39;commentable&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="counting-related-models"></a></p>

<h3>Counting Related Models</h3>

<p>If you want to count the number of results from a relationship without actually loading them you may use the <code>withCount</code> method, which will place a <code>{relation}_count</code> column on your resulting models. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">withCount</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$posts</span> <span class="nx">as</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments_count</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You may add the &quot;counts&quot; for multiple relations as well as add constraints to the queries:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">withCount</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">votes_count</span><span class="p">;</span>
<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">comments_count</span><span class="p">;</span>
</pre></div>

<p>You may also alias the relationship count result, allowing multiple counts on the same relationship:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">withCount</span><span class="p">([</span>
    <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
    <span class="s1">&#39;comments as pending_comments_count&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">comments_count</span><span class="p">;</span>

<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">pending_comments_count</span><span class="p">;</span>
</pre></div>

<p>If you&#39;re combining <code>withCount</code> with a <code>select</code> statement, ensure that you call <code>withCount</code> after the <code>select</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$posts</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">select</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">withCount</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">;</span>
<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">body</span><span class="p">;</span>
<span class="nx">echo</span> <span class="nx">$posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">comments_count</span><span class="p">;</span>
</pre></div>

<p>In addition, using the <code>loadCount</code> method, you may load a relationship count after the parent model has already been retrieved:</p>
<div class="highlight"><pre><span></span><span class="nx">$book</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">loadCount</span><span class="p">(</span><span class="s1">&#39;genres&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to set additional query constraints on the eager loading query, you may pass an array keyed by the relationships you wish to load. The array values should be <code>Closure</code> instances which receive the query builder instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">loadCount</span><span class="p">([</span><span class="s1">&#39;reviews&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}])</span>
</pre></div>

<p><a name="counting-related-models-on-polymorphic-relationships"></a></p>

<h3>Counting Related Models On Polymorphic Relationships</h3>

<p>If you would like to eager load a <code>morphTo</code> relationship, as well as nested relationship counts on the various entities that may be returned by that relationship, you may use the <code>with</code> method in combination with the <code>morphTo</code> relationship&#39;s <code>morphWithCount</code> method.</p>

<p>In this example, let&#39;s assume <code>Photo</code> and <code>Post</code> models may create <code>ActivityFeed</code> models. Additionally, let&#39;s assume that <code>Photo</code> models are associated with <code>Tag</code> models, and <code>Post</code> models are associated with <code>Comment</code> models.</p>

<p>Using these model definitions and relationships, we may retrieve <code>ActivityFeed</code> model instances and eager load all <code>parentable</code> models and their respective nested relationship counts:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Relations</span><span class="err">\</span><span class="nx">MorphTo</span><span class="p">;</span>

<span class="nx">$activities</span> <span class="o">=</span> <span class="nx">ActivityFeed</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;parentable&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">MorphTo</span> <span class="nx">$morphTo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$morphTo</span><span class="o">-&gt;</span><span class="nx">morphWithCount</span><span class="p">([</span>
            <span class="nx">Photo</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
            <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In addition, you may use the <code>loadMorphCount</code> method to eager load all nested relationship counts on the various entities of the polymorphic relation if the <code>ActivityFeed</code> models have already been retrieved:</p>
<div class="highlight"><pre><span></span><span class="nx">$activities</span> <span class="o">=</span> <span class="nx">ActivityFeed</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;parentable&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nx">loadMorphCount</span><span class="p">(</span><span class="s1">&#39;parentable&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">Photo</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
        <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">],</span>
    <span class="p">]);</span>
</pre></div>

<p><a name="eager-loading"></a></p>

<h2>Eager Loading</h2>

<p>When accessing Eloquent relationships as properties, the relationship data is &quot;lazy loaded&quot;. This means the relationship data is not actually loaded until you first access the property. However, Eloquent can &quot;eager load&quot; relationships at the time you query the parent model. Eager loading alleviates the N + 1 query problem. To illustrate the N + 1 query problem, consider a <code>Book</code> model that is related to <code>Author</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the author that wrote the book.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">author</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Author&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, let&#39;s retrieve all books and their authors:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$books</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This loop will execute 1 query to retrieve all of the books on the table, then another query for each book to retrieve the author. So, if we have 25 books, the code above would run 26 queries: 1 for the original book, and 25 additional queries to retrieve the author of each book.</p>

<p>Thankfully, we can use eager loading to reduce this operation to just 2 queries. When querying, you may specify which relationships should be eager loaded using the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$books</span> <span class="nx">as</span> <span class="nx">$book</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>For this operation, only two queries will be executed:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">books</span>

<span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">authors</span> <span class="nx">where</span> <span class="nx">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>

<h4>Eager Loading Multiple Relationships</h4>

<p>Sometimes you may need to eager load several different relationships in a single operation. To do so, just pass additional arguments to the <code>with</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Nested Eager Loading</h4>

<p>To eager load nested relationships, you may use &quot;dot&quot; syntax. For example, let&#39;s eager load all of the book&#39;s authors and all of the author&#39;s personal contacts in one Eloquent statement:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author.contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Nested Eager Loading <code>morphTo</code> Relationships</h4>

<p>If you would like to eager load a <code>morphTo</code> relationship, as well as nested relationships on the various entities that may be returned by that relationship, you may use the <code>with</code> method in combination with the <code>morphTo</code> relationship&#39;s <code>morphWith</code> method. To help illustrate this method, let&#39;s consider the following model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ActivityFeed</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the parent of the activity feed record.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">parentable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, let&#39;s assume <code>Event</code>, <code>Photo</code>, and <code>Post</code> models may create <code>ActivityFeed</code> models. Additionally, let&#39;s assume that <code>Event</code> models belong to a <code>Calendar</code> model, <code>Photo</code> models are associated with <code>Tag</code> models, and <code>Post</code> models belong to an <code>Author</code> model.</p>

<p>Using these model definitions and relationships, we may retrieve <code>ActivityFeed</code> model instances and eager load all <code>parentable</code> models and their respective nested relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">Relations</span><span class="err">\</span><span class="nx">MorphTo</span><span class="p">;</span>

<span class="nx">$activities</span> <span class="o">=</span> <span class="nx">ActivityFeed</span><span class="o">::</span><span class="nx">query</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;parentable&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">MorphTo</span> <span class="nx">$morphTo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$morphTo</span><span class="o">-&gt;</span><span class="nx">morphWith</span><span class="p">([</span>
            <span class="nx">Event</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;calendar&#39;</span><span class="p">],</span>
            <span class="nx">Photo</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
            <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Eager Loading Specific Columns</h4>

<p>You may not always need every column from the relationships you are retrieving. For this reason, Eloquent allows you to specify which columns of the relationship you would like to retrieve:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;author:id,name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} When using this feature, you should always include the <code>id</code> column and any relevant foreign key columns in the list of columns you wish to retrieve.</p>
</blockquote>

<h4>Eager Loading By Default</h4>

<p>Sometimes you might want to always load some relationships when retrieving a model. To accomplish this, you may define a <code>$with</code> property on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The relationships that should always be loaded.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$with</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the author that wrote the book.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">author</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Author&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to remove an item from the <code>$with</code> property for a single query, you may use the <code>without</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">without</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="constraining-eager-loads"></a></p>

<h3>Constraining Eager Loads</h3>

<p>Sometimes you may wish to eager load a relationship, but also specify additional query conditions for the eager loading query. Here&#39;s an example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;%first%&#39;</span><span class="p">);</span>
<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>In this example, Eloquent will only eager load posts where the post&#39;s <code>title</code> column contains the word <code>first</code>. You may call other <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> methods to further customize the eager loading operation:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>
<span class="p">}])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} The <code>limit</code> and <code>take</code> query builder methods may not be used when constraining eager loads.</p>
</blockquote>

<p><a name="lazy-eager-loading"></a></p>

<h3>Lazy Eager Loading</h3>

<p>Sometimes you may need to eager load a relationship after the parent model has already been retrieved. For example, this may be useful if you need to dynamically decide whether to load related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$books</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Book</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$someCondition</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$books</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you need to set additional query constraints on the eager loading query, you may pass an array keyed by the relationships you wish to load. The array values should be <code>Closure</code> instances which receive the query instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$author</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">([</span><span class="s1">&#39;books&#39;</span> <span class="p">=&gt;</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">);</span>
<span class="p">}]);</span>
</pre></div>

<p>To load a relationship only when it has not already been loaded, use the <code>loadMissing</code> method:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">format</span><span class="p">(</span><span class="nx">Book</span> <span class="nx">$book</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">loadMissing</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span> <span class="p">=&gt;</span> <span class="nx">$book</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<h4>Nested Lazy Eager Loading &amp; <code>morphTo</code></h4>

<p>If you would like to eager load a <code>morphTo</code> relationship, as well as nested relationships on the various entities that may be returned by that relationship, you may use the <code>loadMorph</code> method.</p>

<p>This method accepts the name of the <code>morphTo</code> relationship as its first argument, and an array of model / relationship pairs as its second argument. To help illustrate this method, let&#39;s consider the following model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ActivityFeed</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the parent of the activity feed record.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">parentable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, let&#39;s assume <code>Event</code>, <code>Photo</code>, and <code>Post</code> models may create <code>ActivityFeed</code> models. Additionally, let&#39;s assume that <code>Event</code> models belong to a <code>Calendar</code> model, <code>Photo</code> models are associated with <code>Tag</code> models, and <code>Post</code> models belong to an <code>Author</code> model.</p>

<p>Using these model definitions and relationships, we may retrieve <code>ActivityFeed</code> model instances and eager load all <code>parentable</code> models and their respective nested relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$activities</span> <span class="o">=</span> <span class="nx">ActivityFeed</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;parentable&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nx">loadMorph</span><span class="p">(</span><span class="s1">&#39;parentable&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">Event</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;calendar&#39;</span><span class="p">],</span>
        <span class="nx">Photo</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">],</span>
        <span class="nx">Post</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">],</span>
    <span class="p">]);</span>
</pre></div>

<p><a name="inserting-and-updating-related-models"></a></p>

<h2>Inserting &amp; Updating Related Models</h2>

<p><a name="the-save-method"></a></p>

<h3>The Save Method</h3>

<p>Eloquent provides convenient methods for adding new models to relationships. For example, perhaps you need to insert a new <code>Comment</code> for a <code>Post</code> model. Instead of manually setting the <code>post_id</code> attribute on the <code>Comment</code>, you may insert the <code>Comment</code> directly from the relationship&#39;s <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]);</span>

<span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>
</pre></div>

<p>Notice that we did not access the <code>comments</code> relationship as a dynamic property. Instead, we called the <code>comments</code> method to obtain an instance of the relationship. The <code>save</code> method will automatically add the appropriate <code>post_id</code> value to the new <code>Comment</code> model.</p>

<p>If you need to save multiple related models, you may use the <code>saveMany</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">saveMany</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">]),</span>
    <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Another comment.&#39;</span><span class="p">]),</span>
<span class="p">]);</span>
</pre></div>

<p>The <code>save</code> and <code>saveMany</code> methods will not add the new models to any in-memory relationships that are already loaded onto the parent model. If you plan on accessing the relationship after using the <code>save</code> or <code>saveMany</code> methods, you may wish to use the <code>refresh</code> method to reload the model and its relationships:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">refresh</span><span class="p">();</span>

<span class="c1">// All comments, including the newly saved comment...</span>
<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">;</span>
</pre></div>

<p><a name="the-push-method"></a></p>

<h4>Recursively Saving Models &amp; Relationships</h4>

<p>If you would like to <code>save</code> your model and all of its associated relationships, you may use the <code>push</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;Message&#39;</span><span class="p">;</span>
<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nx">author</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Author Name&#39;</span><span class="p">;</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">();</span>
</pre></div>

<p><a name="the-create-method"></a></p>

<h3>The Create Method</h3>

<p>In addition to the <code>save</code> and <code>saveMany</code> methods, you may also use the <code>create</code> method, which accepts an array of attributes, creates a model, and inserts it into the database. Again, the difference between <code>save</code> and <code>create</code> is that <code>save</code> accepts a full Eloquent model instance while <code>create</code> accepts a plain PHP <code>array</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span> <span class="o">=</span> <span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<blockquote>
<p>{tip} Before using the <code>create</code> method, be sure to review the documentation on attribute <a href="/docs/%7B%7Bversion%7D%7D/eloquent#mass-assignment">mass assignment</a>.</p>
</blockquote>

<p>You may use the <code>createMany</code> method to create multiple related models:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">comments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">createMany</span><span class="p">([</span>
    <span class="p">[</span>
        <span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A new comment.&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;message&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Another new comment.&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p>You may also use the <code>findOrNew</code>, <code>firstOrNew</code>, <code>firstOrCreate</code> and <code>updateOrCreate</code> methods to <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/eloquent#other-creation-methods">create and update models on relationships</a>.</p>

<p><a name="updating-belongs-to-relationships"></a></p>

<h3>Belongs To Relationships</h3>

<p>When updating a <code>belongsTo</code> relationship, you may use the <code>associate</code> method. This method will set the foreign key on the child model:</p>
<div class="highlight"><pre><span></span><span class="nx">$account</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Account</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">associate</span><span class="p">(</span><span class="nx">$account</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>When removing a <code>belongsTo</code> relationship, you may use the <code>dissociate</code> method. This method will set the relationship&#39;s foreign key to <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">account</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">dissociate</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="default-models"></a></p>

<h4>Default Models</h4>

<p>The <code>belongsTo</code>, <code>hasOne</code>, <code>hasOneThrough</code>, and <code>morphOne</code> relationships allow you to define a default model that will be returned if the given relationship is <code>null</code>. This pattern is often referred to as the <a href="https://en.wikipedia.org/wiki/Null_Object_pattern">Null Object pattern</a> and can help remove conditional checks in your code. In the following example, the <code>user</code> relation will return an empty <code>App\Models\User</code> model if no <code>user</code> is attached to the post:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the author of the post.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withDefault</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>To populate the default model with attributes, you may pass an array or Closure to the <code>withDefault</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the author of the post.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withDefault</span><span class="p">([</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Guest Author&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Get the author of the post.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">user</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\User&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withDefault</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Guest Author&#39;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="updating-many-to-many-relationships"></a></p>

<h3>Many To Many Relationships</h3>

<h4>Attaching / Detaching</h4>

<p>Eloquent also provides a few additional helper methods to make working with related models more convenient. For example, let&#39;s imagine a user can have many roles and a role can have many users. To attach a role to a user by inserting a record in the intermediate table that joins the models, use the <code>attach</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">);</span>
</pre></div>

<p>When attaching a relationship to a model, you may also pass an array of additional data to be inserted into the intermediate table:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<p>Sometimes it may be necessary to remove a role from a user. To remove a many-to-many relationship record, use the <code>detach</code> method. The <code>detach</code> method will delete the appropriate record out of the intermediate table; however, both models will remain in the database:</p>
<div class="highlight"><pre><span></span><span class="c1">// Detach a single role from the user...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">);</span>

<span class="c1">// Detach all roles from the user...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">();</span>
</pre></div>

<p>For convenience, <code>attach</code> and <code>detach</code> also accept arrays of IDs as input:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">detach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">attach</span><span class="p">([</span>
    <span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">],</span>
    <span class="mi">2</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<h4>Syncing Associations</h4>

<p>You may also use the <code>sync</code> method to construct many-to-many associations. The <code>sync</code> method accepts an array of IDs to place on the intermediate table. Any IDs that are not in the given array will be removed from the intermediate table. So, after this operation is complete, only the IDs in the given array will exist in the intermediate table:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>You may also pass additional intermediate table values with the IDs:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">sync</span><span class="p">([</span><span class="mi">1</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>If you do not want to detach existing IDs, you may use the <code>syncWithoutDetaching</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">syncWithoutDetaching</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Toggling Associations</h4>

<p>The many-to-many relationship also provides a <code>toggle</code> method which &quot;toggles&quot; the attachment status of the given IDs. If the given ID is currently attached, it will be detached. Likewise, if it is currently detached, it will be attached:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">toggle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Saving Additional Data On A Pivot Table</h4>

<p>When working with a many-to-many relationship, the <code>save</code> method accepts an array of additional intermediate table attributes as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">(</span><span class="nx">$role</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span> <span class="p">=&gt;</span> <span class="nx">$expires</span><span class="p">]);</span>
</pre></div>

<h4>Updating A Record On A Pivot Table</h4>

<p>If you need to update an existing row in your pivot table, you may use <code>updateExistingPivot</code> method. This method accepts the pivot record foreign key and an array of attributes to update:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">updateExistingPivot</span><span class="p">(</span><span class="nx">$roleId</span><span class="p">,</span> <span class="nx">$attributes</span><span class="p">);</span>
</pre></div>

<p><a name="touching-parent-timestamps"></a></p>

<h2>Touching Parent Timestamps</h2>

<p>When a model <code>belongsTo</code> or <code>belongsToMany</code> another model, such as a <code>Comment</code> which belongs to a <code>Post</code>, it is sometimes helpful to update the parent&#39;s timestamp when the child model is updated. For example, when a <code>Comment</code> model is updated, you may want to automatically &quot;touch&quot; the <code>updated_at</code> timestamp of the owning <code>Post</code>. Eloquent makes it easy. Just add a <code>touches</code> property containing the names of the relationships to the child model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Comment</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * All of the relationships to be touched.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$touches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the post that the comment belongs to.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Models\Post&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, when you update a <code>Comment</code>, the owning <code>Post</code> will have its <code>updated_at</code> column updated as well, making it more convenient to know when to invalidate a cache of the <code>Post</code> model:</p>
<div class="highlight"><pre><span></span><span class="nx">$comment</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;Edit to this comment!&#39;</span><span class="p">;</span>

<span class="nx">$comment</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: API Resources</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#generating-resources">Generating Resources</a></li>
<li><a href="#concept-overview">Concept Overview</a>

<ul>
<li><a href="#resource-collections">Resource Collections</a></li>
</ul></li>
<li><a href="#writing-resources">Writing Resources</a>

<ul>
<li><a href="#data-wrapping">Data Wrapping</a></li>
<li><a href="#pagination">Pagination</a></li>
<li><a href="#conditional-attributes">Conditional Attributes</a></li>
<li><a href="#conditional-relationships">Conditional Relationships</a></li>
<li><a href="#adding-meta-data">Adding Meta Data</a></li>
</ul></li>
<li><a href="#resource-responses">Resource Responses</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When building an API, you may need a transformation layer that sits between your Eloquent models and the JSON responses that are actually returned to your application&#39;s users. Laravel&#39;s resource classes allow you to expressively and easily transform your models and model collections into JSON.</p>

<p><a name="generating-resources"></a></p>

<h2>Generating Resources</h2>

<p>To generate a resource class, you may use the <code>make:resource</code> Artisan command. By default, resources will be placed in the <code>app/Http/Resources</code> directory of your application. Resources extend the <code>Illuminate\Http\Resources\Json\JsonResource</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">resource</span> <span class="nx">User</span>
</pre></div>

<h4>Resource Collections</h4>

<p>In addition to generating resources that transform individual models, you may generate resources that are responsible for transforming collections of models. This allows your response to include links and other meta information that is relevant to an entire collection of a given resource.</p>

<p>To create a resource collection, you should use the <code>--collection</code> flag when creating the resource. Or, including the word <code>Collection</code> in the resource name will indicate to Laravel that it should create a collection resource. Collection resources extend the <code>Illuminate\Http\Resources\Json\ResourceCollection</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">resource</span> <span class="nx">Users</span> <span class="o">--</span><span class="nx">collection</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">resource</span> <span class="nx">UserCollection</span>
</pre></div>

<p><a name="concept-overview"></a></p>

<h2>Concept Overview</h2>

<blockquote>
<p>{tip} This is a high-level overview of resources and resource collections. You are highly encouraged to read the other sections of this documentation to gain a deeper understanding of the customization and power offered to you by resources.</p>
</blockquote>

<p>Before diving into all of the options available to you when writing resources, let&#39;s first take a high-level look at how resources are used within Laravel. A resource class represents a single model that needs to be transformed into a JSON structure. For example, here is a simple <code>User</code> resource class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
            <span class="s1">&#39;created_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created_at</span><span class="p">,</span>
            <span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updated_at</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Every resource class defines a <code>toArray</code> method which returns the array of attributes that should be converted to JSON when sending the response. Notice that we can access model properties directly from the <code>$this</code> variable. This is because a resource class will automatically proxy property and method access down to the underlying model for convenient access. Once the resource is defined, it may be returned from a route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserResource</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p><a name="resource-collections"></a></p>

<h3>Resource Collections</h3>

<p>If you are returning a collection of resources or a paginated response, you may use the <code>collection</code> method when creating the resource instance in your route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">UserResource</span><span class="o">::</span><span class="nx">collection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>Note that this does not allow any addition of meta data that may need to be returned with the collection. If you would like to customize the resource collection response, you may create a dedicated resource to represent the collection:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">resource</span> <span class="nx">UserCollection</span>
</pre></div>

<p>Once the resource collection class has been generated, you may easily define any meta data that should be included with the response:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\ResourceCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserCollection</span> <span class="k">extends</span> <span class="nx">ResourceCollection</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource collection into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">,</span>
            <span class="s1">&#39;links&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;self&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;link-value&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After defining your resource collection, it may be returned from a route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">UserCollection</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserCollection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<h4>Preserving Collection Keys</h4>

<p>When returning a resource collection from a route, Laravel resets the collection&#39;s keys so that they are in simple numerical order. However, you may add a <code>preserveKeys</code> property to your resource class indicating if collection keys should be preserved:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Indicates if the resource&#39;s collection keys should be preserved.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$preserveKeys</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>When the <code>preserveKeys</code> property is set to <code>true</code>, collection keys will be preserved:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">UserResource</span><span class="o">::</span><span class="nx">collection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">keyBy</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Customizing The Underlying Resource Class</h4>

<p>Typically, the <code>$this-&gt;collection</code> property of a resource collection is automatically populated with the result of mapping each item of the collection to its singular resource class. The singular resource class is assumed to be the collection&#39;s class name without the trailing <code>Collection</code> string.</p>

<p>For example, <code>UserCollection</code> will attempt to map the given user instances into the <code>User</code> resource. To customize this behavior, you may override the <code>$collects</code> property of your resource collection:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\ResourceCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserCollection</span> <span class="k">extends</span> <span class="nx">ResourceCollection</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The resource that this resource collects.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$collects</span> <span class="o">=</span> <span class="s1">&#39;App\Http\Resources\Member&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="writing-resources"></a></p>

<h2>Writing Resources</h2>

<blockquote>
<p>{tip} If you have not read the <a href="#concept-overview">concept overview</a>, you are highly encouraged to do so before proceeding with this documentation.</p>
</blockquote>

<p>In essence, resources are simple. They only need to transform a given model into an array. So, each resource contains a <code>toArray</code> method which translates your model&#39;s attributes into an API friendly array that can be returned to your users:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
            <span class="s1">&#39;created_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created_at</span><span class="p">,</span>
            <span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updated_at</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once a resource has been defined, it may be returned directly from a route or controller:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserResource</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<h4>Relationships</h4>

<p>If you would like to include related resources in your response, you may add them to the array returned by your <code>toArray</code> method. In this example, we will use the <code>Post</code> resource&#39;s <code>collection</code> method to add the user&#39;s blog posts to the resource response:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="nx">PostResource</span><span class="o">::</span><span class="nx">collection</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">posts</span><span class="p">),</span>
        <span class="s1">&#39;created_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">,</span>
        <span class="s1">&#39;updated_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">updated_at</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} If you would like to include relationships only when they have already been loaded, check out the documentation on <a href="#conditional-relationships">conditional relationships</a>.</p>
</blockquote>

<h4>Resource Collections</h4>

<p>While resources translate a single model into an array, resource collections translate a collection of models into an array. It is not absolutely necessary to define a resource collection class for each one of your model types since all resources provide a <code>collection</code> method to generate an &quot;ad-hoc&quot; resource collection on the fly:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">UserResource</span><span class="o">::</span><span class="nx">collection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>However, if you need to customize the meta data returned with the collection, it will be necessary to define a resource collection:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\ResourceCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserCollection</span> <span class="k">extends</span> <span class="nx">ResourceCollection</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource collection into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">,</span>
            <span class="s1">&#39;links&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;self&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;link-value&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Like singular resources, resource collections may be returned directly from routes or controllers:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">UserCollection</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserCollection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p><a name="data-wrapping"></a></p>

<h3>Data Wrapping</h3>

<p>By default, your outermost resource is wrapped in a <code>data</code> key when the resource response is converted to JSON. So, for example, a typical resource collection response looks like the following:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Eladio Schroeder Sr.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;therese28@example.com&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Liliana Mayert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;evandervort@example.com&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to use a custom key instead of <code>data</code>, you may define a <code>$wrap</code> attribute on the resource class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The &quot;data&quot; wrapper that should be applied.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$wrap</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to disable the wrapping of the outermost resource, you may use the <code>withoutWrapping</code> method on the base resource class. Typically, you should call this method from your <code>AppServiceProvider</code> or another <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> that is loaded on every request to your application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">JsonResource</span><span class="o">::</span><span class="na">withoutWrapping</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} The <code>withoutWrapping</code> method only affects the outermost response and will not remove <code>data</code> keys that you manually add to your own resource collections.</p>
</blockquote>

<h3>Wrapping Nested Resources</h3>

<p>You have total freedom to determine how your resource&#39;s relationships are wrapped. If you would like all resource collections to be wrapped in a <code>data</code> key, regardless of their nesting, you should define a resource collection class for each resource and return the collection within a <code>data</code> key.</p>

<p>You may be wondering if this will cause your outermost resource to be wrapped in two <code>data</code> keys. Don&#39;t worry, Laravel will never let your resources be accidentally double-wrapped, so you don&#39;t have to be concerned about the nesting level of the resource collection you are transforming:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\ResourceCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CommentsCollection</span> <span class="k">extends</span> <span class="nx">ResourceCollection</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource collection into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>Data Wrapping And Pagination</h3>

<p>When returning paginated collections in a resource response, Laravel will wrap your resource data in a <code>data</code> key even if the <code>withoutWrapping</code> method has been called. This is because paginated responses always contain <code>meta</code> and <code>links</code> keys with information about the paginator&#39;s state:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Eladio Schroeder Sr.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;therese28@example.com&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Liliana Mayert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;evandervort@example.com&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;links&quot;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&quot;first&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination?page=1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;last&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination?page=1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prev&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="s2">&quot;next&quot;</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="s2">&quot;meta&quot;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&quot;current_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;from&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;last_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination&quot;</span><span class="p">,</span>
        <span class="s2">&quot;per_page&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;to&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;total&quot;</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="pagination"></a></p>

<h3>Pagination</h3>

<p>You may always pass a paginator instance to the <code>collection</code> method of a resource or to a custom resource collection:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">UserCollection</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserCollection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<p>Paginated responses always contain <code>meta</code> and <code>links</code> keys with information about the paginator&#39;s state:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Eladio Schroeder Sr.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;therese28@example.com&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Liliana Mayert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;evandervort@example.com&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;links&quot;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&quot;first&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination?page=1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;last&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination?page=1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prev&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="s2">&quot;next&quot;</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="s2">&quot;meta&quot;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&quot;current_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;from&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;last_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;http://example.com/pagination&quot;</span><span class="p">,</span>
        <span class="s2">&quot;per_page&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;to&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;total&quot;</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="conditional-attributes"></a></p>

<h3>Conditional Attributes</h3>

<p>Sometimes you may wish to only include an attribute in a resource response if a given condition is met. For example, you may wish to only include a value if the current user is an &quot;administrator&quot;. Laravel provides a variety of helper methods to assist you in this situation. The <code>when</code> method may be used to conditionally add an attribute to a resource response:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="s1">&#39;secret-value&#39;</span><span class="p">),</span>
        <span class="s1">&#39;created_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">,</span>
        <span class="s1">&#39;updated_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">updated_at</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>In this example, the <code>secret</code> key will only be returned in the final resource response if the authenticated user&#39;s <code>isAdmin</code> method returns <code>true</code>. If the method returns <code>false</code>, the <code>secret</code> key will be removed from the resource response entirely before it is sent back to the client. The <code>when</code> method allows you to expressively define your resources without resorting to conditional statements when building the array.</p>

<p>The <code>when</code> method also accepts a Closure as its second argument, allowing you to calculate the resulting value only if the given condition is <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;secret-value&#39;</span><span class="p">;</span>
<span class="p">}),</span>
</pre></div>

<h4>Merging Conditional Attributes</h4>

<p>Sometimes you may have several attributes that should only be included in the resource response based on the same condition. In this case, you may use the <code>mergeWhen</code> method to include the attributes in the response only when the given condition is <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mergeWhen</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s1">&#39;first-secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;second-secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
        <span class="p">]),</span>
        <span class="s1">&#39;created_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">,</span>
        <span class="s1">&#39;updated_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">updated_at</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Again, if the given condition is <code>false</code>, these attributes will be removed from the resource response entirely before it is sent to the client.</p>

<blockquote>
<p>{note} The <code>mergeWhen</code> method should not be used within arrays that mix string and numeric keys. Furthermore, it should not be used within arrays with numeric keys that are not ordered sequentially.</p>
</blockquote>

<p><a name="conditional-relationships"></a></p>

<h3>Conditional Relationships</h3>

<p>In addition to conditionally loading attributes, you may conditionally include relationships on your resource responses based on if the relationship has already been loaded on the model. This allows your controller to decide which relationships should be loaded on the model and your resource can easily include them only when they have actually been loaded.</p>

<p>Ultimately, this makes it easier to avoid &quot;N+1&quot; query problems within your resources. The <code>whenLoaded</code> method may be used to conditionally load a relationship. In order to avoid unnecessarily loading relationships, this method accepts the name of the relationship instead of the relationship itself:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span>
        <span class="s1">&#39;posts&#39;</span> <span class="p">=&gt;</span> <span class="nx">PostResource</span><span class="o">::</span><span class="nx">collection</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">whenLoaded</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)),</span>
        <span class="s1">&#39;created_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">created_at</span><span class="p">,</span>
        <span class="s1">&#39;updated_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">updated_at</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>In this example, if the relationship has not been loaded, the <code>posts</code> key will be removed from the resource response entirely before it is sent to the client.</p>

<h4>Conditional Pivot Information</h4>

<p>In addition to conditionally including relationship information in your resource responses, you may conditionally include data from the intermediate tables of many-to-many relationships using the <code>whenPivotLoaded</code> method. The <code>whenPivotLoaded</code> method accepts the name of the pivot table as its first argument. The second argument should be a Closure that defines the value to be returned if the pivot information is available on the model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;expires_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">whenPivotLoaded</span><span class="p">(</span><span class="s1">&#39;role_user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">pivot</span><span class="o">-&gt;</span><span class="nx">expires_at</span><span class="p">;</span>
        <span class="p">}),</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>If your intermediate table is using an accessor other than <code>pivot</code>, you may use the <code>whenPivotLoadedAs</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">,</span>
        <span class="s1">&#39;expires_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">whenPivotLoadedAs</span><span class="p">(</span><span class="s1">&#39;subscription&#39;</span><span class="p">,</span> <span class="s1">&#39;role_user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">subscription</span><span class="o">-&gt;</span><span class="nx">expires_at</span><span class="p">;</span>
        <span class="p">}),</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="adding-meta-data"></a></p>

<h3>Adding Meta Data</h3>

<p>Some JSON API standards require the addition of meta data to your resource and resource collections responses. This often includes things like <code>links</code> to the resource or related resources, or meta data about the resource itself. If you need to return additional meta data about a resource, include it in your <code>toArray</code> method. For example, you might include <code>link</code> information when transforming a resource collection:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Transform the resource into an array.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;data&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">collection</span><span class="p">,</span>
        <span class="s1">&#39;links&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;self&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;link-value&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>When returning additional meta data from your resources, you never have to worry about accidentally overriding the <code>links</code> or <code>meta</code> keys that are automatically added by Laravel when returning paginated responses. Any additional <code>links</code> you define will be merged with the links provided by the paginator.</p>

<h4>Top Level Meta Data</h4>

<p>Sometimes you may wish to only include certain meta data with a resource response if the resource is the outermost resource being returned. Typically, this includes meta information about the response as a whole. To define this meta data, add a <code>with</code> method to your resource class. This method should return an array of meta data to be included with the resource response only when the resource is the outermost resource being rendered:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\ResourceCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserCollection</span> <span class="k">extends</span> <span class="nx">ResourceCollection</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource collection into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get additional data that should be returned with the resource array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">with</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;meta&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Adding Meta Data When Constructing Resources</h4>

<p>You may also add top-level data when constructing resource instances in your route or controller. The <code>additional</code> method, which is available on all resources, accepts an array of data that should be added to the resource response:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">UserCollection</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)))</span>
                <span class="o">-&gt;</span><span class="nx">additional</span><span class="p">([</span><span class="s1">&#39;meta&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
                <span class="p">]]);</span>
</pre></div>

<p><a name="resource-responses"></a></p>

<h2>Resource Responses</h2>

<p>As you have already read, resources may be returned directly from routes and controllers:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserResource</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>However, sometimes you may need to customize the outgoing HTTP response before it is sent to the client. There are two ways to accomplish this. First, you may chain the <code>response</code> method onto the resource. This method will return an <code>Illuminate\Http\JsonResponse</code> instance, allowing you full control of the response&#39;s headers:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Resources</span><span class="err">\</span><span class="nx">User</span> <span class="nx">as</span> <span class="nx">UserResource</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">UserResource</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
                <span class="o">-&gt;</span><span class="nx">response</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;X-Value&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Alternatively, you may define a <code>withResponse</code> method within the resource itself. This method will be called when the resource is returned as the outermost resource in a response:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Resources</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Resources\Json\JsonResource</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">JsonResource</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Transform the resource into an array.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Customize the outgoing response for the resource.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Illuminate\Http\Response  $response</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">withResponse</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Value&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Serialization</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#serializing-models-and-collections">Serializing Models &amp; Collections</a>

<ul>
<li><a href="#serializing-to-arrays">Serializing To Arrays</a></li>
<li><a href="#serializing-to-json">Serializing To JSON</a></li>
</ul></li>
<li><a href="#hiding-attributes-from-json">Hiding Attributes From JSON</a></li>
<li><a href="#appending-values-to-json">Appending Values To JSON</a></li>
<li><a href="#date-serialization">Date Serialization</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When building JSON APIs, you will often need to convert your models and relationships to arrays or JSON. Eloquent includes convenient methods for making these conversions, as well as controlling which attributes are included in your serializations.</p>

<p><a name="serializing-models-and-collections"></a></p>

<h2>Serializing Models &amp; Collections</h2>

<p><a name="serializing-to-arrays"></a></p>

<h3>Serializing To Arrays</h3>

<p>To convert a model and its loaded <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationships</a> to an array, you should use the <code>toArray</code> method. This method is recursive, so all attributes and all relations (including the relations of relations) will be converted to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p>To convert only a model&#39;s attributes to an array, use the <code>attributesToArray</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">first</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">attributesToArray</span><span class="p">();</span>
</pre></div>

<p>You may also convert entire <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">collections</a> of models to arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p><a name="serializing-to-json"></a></p>

<h3>Serializing To JSON</h3>

<p>To convert a model to JSON, you should use the <code>toJson</code> method. Like <code>toArray</code>, the <code>toJson</code> method is recursive, so all attributes and relations will be converted to JSON. You may also specify JSON encoding options <a href="https://secure.php.net/manual/en/function.json-encode.php">supported by PHP</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">toJson</span><span class="p">(</span><span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may cast a model or collection to a string, which will automatically call the <code>toJson</code> method on the model or collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$user</span><span class="p">;</span>
</pre></div>

<p>Since models and collections are converted to JSON when cast to a string, you can return Eloquent objects directly from your application&#39;s routes or controllers:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">all</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h4>Relationships</h4>

<p>When an Eloquent model is converted to JSON, its loaded relationships will automatically be included as attributes on the JSON object. Also, though Eloquent relationship methods are defined using &quot;camel case&quot;, a relationship&#39;s JSON attribute will be &quot;snake case&quot;.</p>

<p><a name="hiding-attributes-from-json"></a></p>

<h2>Hiding Attributes From JSON</h2>

<p>Sometimes you may wish to limit the attributes, such as passwords, that are included in your model&#39;s array or JSON representation. To do so, add a <code>$hidden</code> property to your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be hidden for arrays.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} When hiding relationships, use the relationship&#39;s method name.</p>
</blockquote>

<p>Alternatively, you may use the <code>visible</code> property to define a white-list of attributes that should be included in your model&#39;s array and JSON representation. All other attributes will be hidden when the model is converted to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be visible in arrays.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<h4>Temporarily Modifying Attribute Visibility</h4>

<p>If you would like to make some typically hidden attributes visible on a given model instance, you may use the <code>makeVisible</code> method. The <code>makeVisible</code> method returns the model instance for convenient method chaining:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">makeVisible</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p>Likewise, if you would like to make some typically visible attributes hidden on a given model instance, you may use the <code>makeHidden</code> method.</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">makeHidden</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p><a name="appending-values-to-json"></a></p>

<h2>Appending Values To JSON</h2>

<p>Occasionally, when casting models to an array or JSON, you may wish to add attributes that do not have a corresponding column in your database. To do so, first define an <a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators">accessor</a> for the value:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Get the administrator flag for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getIsAdminAttribute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After creating the accessor, add the attribute name to the <code>appends</code> property on the model. Note that attribute names are typically referenced in &quot;snake case&quot;, even though the accessor is defined using &quot;camel case&quot;:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The accessors to append to the model&#39;s array form.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_admin&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once the attribute has been added to the <code>appends</code> list, it will be included in both the model&#39;s array and JSON representations. Attributes in the <code>appends</code> array will also respect the <code>visible</code> and <code>hidden</code> settings configured on the model.</p>

<h4>Appending At Run Time</h4>

<p>You may instruct a single model instance to append attributes using the <code>append</code> method. Or, you may use the <code>setAppends</code> method to override the entire array of appended properties for a given model instance:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">setAppends</span><span class="p">([</span><span class="s1">&#39;is_admin&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">toArray</span><span class="p">();</span>
</pre></div>

<p><a name="date-serialization"></a></p>

<h2>Date Serialization</h2>

<h4>Customizing The Default Date Format</h4>

<p>You may customize the default serialization format by overriding the <code>serializeDate</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Prepare a date for array / JSON serialization.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \DateTimeInterface  $date</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">serializeDate</span><span class="p">(</span><span class="nx">DateTimeInterface</span> <span class="nx">$date</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$date</span><span class="o">-&gt;</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Customizing The Date Format Per Attribute</h4>

<p>You may customize the serialization format of individual Eloquent date attributes by specifying the date format in the <a href="/docs/%7B%7Bversion%7D%7D/eloquent-mutators#attribute-casting">cast declaration</a>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$casts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;birthday&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;date:Y-m-d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;joined_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;datetime:Y-m-d H:00&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Eloquent: Getting Started</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-models">Defining Models</a>

<ul>
<li><a href="#eloquent-model-conventions">Eloquent Model Conventions</a></li>
<li><a href="#default-attribute-values">Default Attribute Values</a></li>
</ul></li>
<li><a href="#retrieving-models">Retrieving Models</a>

<ul>
<li><a href="#collections">Collections</a></li>
<li><a href="#chunking-results">Chunking Results</a></li>
<li><a href="#advanced-subqueries">Advanced Subqueries</a></li>
</ul></li>
<li><a href="#retrieving-single-models">Retrieving Single Models / Aggregates</a>

<ul>
<li><a href="#retrieving-aggregates">Retrieving Aggregates</a></li>
</ul></li>
<li><a href="#inserting-and-updating-models">Inserting &amp; Updating Models</a>

<ul>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a></li>
<li><a href="#mass-assignment">Mass Assignment</a></li>
<li><a href="#other-creation-methods">Other Creation Methods</a></li>
</ul></li>
<li><a href="#deleting-models">Deleting Models</a>

<ul>
<li><a href="#soft-deleting">Soft Deleting</a></li>
<li><a href="#querying-soft-deleted-models">Querying Soft Deleted Models</a></li>
</ul></li>
<li><a href="#replicating-models">Replicating Models</a></li>
<li><a href="#query-scopes">Query Scopes</a>

<ul>
<li><a href="#global-scopes">Global Scopes</a></li>
<li><a href="#local-scopes">Local Scopes</a></li>
</ul></li>
<li><a href="#comparing-models">Comparing Models</a></li>
<li><a href="#events">Events</a>

<ul>
<li><a href="#events-using-closures">Using Closures</a></li>
<li><a href="#observers">Observers</a></li>
<li><a href="#muting-events">Muting Events</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &quot;Model&quot; which is used to interact with that table. Models allow you to query for data in your tables, as well as insert new records into the table.</p>

<p>Before getting started, be sure to configure a database connection in <code>config/database.php</code>. For more information on configuring your database, check out <a href="/docs/%7B%7Bversion%7D%7D/database#configuration">the documentation</a>.</p>

<p><a name="defining-models"></a></p>

<h2>Defining Models</h2>

<p>To get started, let&#39;s create an Eloquent model. Models typically live in the <code>app\Models</code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code>composer.json</code> file. All Eloquent models extend <code>Illuminate\Database\Eloquent\Model</code> class.</p>

<p>The easiest way to create a model instance is using the <code>make:model</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">Flight</span>
</pre></div>

<p>If you would like to generate a <a href="/docs/%7B%7Bversion%7D%7D/migrations">database migration</a> when you generate the model, you may use the <code>--migration</code> or <code>-m</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">Flight</span> <span class="o">--</span><span class="nx">migration</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">Flight</span> <span class="o">-</span><span class="nx">m</span>
</pre></div>

<p><a name="eloquent-model-conventions"></a></p>

<h3>Eloquent Model Conventions</h3>

<p>Now, let&#39;s look at an example <code>Flight</code> model, which we will use to retrieve and store information from our <code>flights</code> database table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Table Names</h4>

<p>Note that we did not tell Eloquent which table to use for our <code>Flight</code> model. By convention, the &quot;snake case&quot;, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Eloquent will assume the <code>Flight</code> model stores records in the <code>flights</code> table. You may specify a custom table by defining a <code>table</code> property on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The table associated with the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;my_flights&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Primary Keys</h4>

<p>Eloquent will also assume that each table has a primary key column named <code>id</code>. You may define a protected <code>$primaryKey</code> property to override this convention:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The primary key associated with the table.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$primaryKey</span> <span class="o">=</span> <span class="s1">&#39;flight_id&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>In addition, Eloquent assumes that the primary key is an incrementing integer value, which means that by default the primary key will automatically be cast to an <code>int</code>. If you wish to use a non-incrementing or a non-numeric primary key you must set the public <code>$incrementing</code> property on your model to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Indicates if the IDs are auto-incrementing.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$incrementing</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If your primary key is not an integer, you should set the protected <code>$keyType</code> property on your model to <code>string</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The &quot;type&quot; of the auto-incrementing ID.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$keyType</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Timestamps</h4>

<p>By default, Eloquent expects <code>created_at</code> and <code>updated_at</code> columns to exist on your tables.  If you do not wish to have these columns automatically managed by Eloquent, set the <code>$timestamps</code> property on your model to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Indicates if the model should be timestamped.</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you need to customize the format of your timestamps, set the <code>$dateFormat</code> property on your model. This property determines how date attributes are stored in the database, as well as their format when the model is serialized to an array or JSON:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The storage format of the model&#39;s date columns.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you need to customize the names of the columns used to store the timestamps, you may set the <code>CREATED_AT</code> and <code>UPDATED_AT</code> constants in your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">CREATED_AT</span> <span class="o">=</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">UPDATED_AT</span> <span class="o">=</span> <span class="s1">&#39;last_update&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Database Connection</h4>

<p>By default, all Eloquent models will use the default database connection configured for your application. If you would like to specify a different connection for the model, use the <code>$connection</code> property:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The connection name for the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;connection-name&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="default-attribute-values"></a></p>

<h3>Default Attribute Values</h3>

<p>If you would like to define the default values for some of your model&#39;s attributes, you may define an <code>$attributes</code> property on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The model&#39;s default values for attributes.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;delayed&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="retrieving-models"></a></p>

<h2>Retrieving Models</h2>

<p>Once you have created a model and <a href="/docs/%7B%7Bversion%7D%7D/migrations#writing-migrations">its associated database table</a>, you are ready to start retrieving data from your database. Think of each Eloquent model as a powerful <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> allowing you to fluently query the database table associated with the model. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$flights</span> <span class="o">=</span> <span class="nx">App\Models\Flight</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$flights</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Adding Additional Constraints</h4>

<p>The Eloquent <code>all</code> method will return all of the results in the model&#39;s table. Since each Eloquent model serves as a <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>, you may also add constraints to queries, and then use the <code>get</code> method to retrieve the results:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} Since Eloquent models are query builders, you should review all of the methods available on the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>. You may use any of these methods in your Eloquent queries.</p>
</blockquote>

<h4>Refreshing Models</h4>

<p>You can refresh models using the <code>fresh</code> and <code>refresh</code> methods. The <code>fresh</code> method will re-retrieve the model from the database. The existing model instance will not be affected:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;FR 900&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$freshFlight</span> <span class="o">=</span> <span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">fresh</span><span class="p">();</span>
</pre></div>

<p>The <code>refresh</code> method will re-hydrate the existing model using fresh data from the database. In addition, all of its loaded relationships will be refreshed as well:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;FR 900&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">number</span> <span class="o">=</span> <span class="s1">&#39;FR 456&#39;</span><span class="p">;</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">refresh</span><span class="p">();</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">number</span><span class="p">;</span> <span class="c1">// &quot;FR 900&quot;</span>
</pre></div>

<p><a name="collections"></a></p>

<h3>Collections</h3>

<p>For Eloquent methods like <code>all</code> and <code>get</code> which retrieve multiple results, an instance of <code>Illuminate\Database\Eloquent\Collection</code> will be returned. The <code>Collection</code> class provides <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections#available-methods">a variety of helpful methods</a> for working with your Eloquent results:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">$flights</span><span class="o">-&gt;</span><span class="nx">reject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>You may also loop over the collection like an array:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$flights</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="chunking-results"></a></p>

<h3>Chunking Results</h3>

<p>If you need to process thousands of Eloquent records, use the <code>chunk</code> command. The <code>chunk</code> method will retrieve a &quot;chunk&quot; of Eloquent models, feeding them to a given <code>Closure</code> for processing. Using the <code>chunk</code> method will conserve memory when working with large result sets:</p>
<div class="highlight"><pre><span></span><span class="nx">Flight</span><span class="o">::</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$flights</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$flights</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the method is the number of records you wish to receive per &quot;chunk&quot;. The Closure passed as the second argument will be called for each chunk that is retrieved from the database. A database query will be executed to retrieve each chunk of records passed to the Closure.</p>

<h4>Using Cursors</h4>

<p>The <code>cursor</code> method allows you to iterate through your database records using a cursor, which will only execute a single query. When processing large amounts of data, the <code>cursor</code> method may be used to greatly reduce your memory usage:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cursor</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$flight</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>cursor</code> returns an <code>Illuminate\Support\LazyCollection</code> instance. <a href="/docs/%7B%7Bversion%7D%7D/collections#lazy-collections">Lazy collections</a> allow you to use many of collection methods available on typical Laravel collections while only loading a single model into memory at a time:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">cursor</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="advanced-subqueries"></a></p>

<h3>Advanced Subqueries</h3>

<h4>Subquery Selects</h4>

<p>Eloquent also offers advanced subquery support, which allows you to pull information from related tables in a single query. For example, let&#39;s imagine that we have a table of flight <code>destinations</code> and a table of <code>flights</code> to destinations. The <code>flights</code> table contains an <code>arrived_at</code> column which indicates when the flight arrived at the destination.</p>

<p>Using the subquery functionality available to the <code>select</code> and <code>addSelect</code> methods, we can select all of the <code>destinations</code> and the name of the flight that most recently arrived at that destination using a single query:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Destination</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">Destination</span><span class="o">::</span><span class="nx">addSelect</span><span class="p">([</span><span class="s1">&#39;last_flight&#39;</span> <span class="p">=&gt;</span> <span class="nx">Flight</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;destination_id&#39;</span><span class="p">,</span> <span class="s1">&#39;destinations.id&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Subquery Ordering</h4>

<p>In addition, the query builder&#39;s <code>orderBy</code> function supports subqueries. We may use this functionality to sort all destinations based on when the last flight arrived at that destination. Again, this may be done while executing a single query against the database:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Destination</span><span class="o">::</span><span class="nx">orderByDesc</span><span class="p">(</span>
    <span class="nx">Flight</span><span class="o">::</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;destination_id&#39;</span><span class="p">,</span> <span class="s1">&#39;destinations.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="retrieving-single-models"></a></p>

<h2>Retrieving Single Models / Aggregates</h2>

<p>In addition to retrieving all of the records for a given table, you may also retrieve single records using <code>find</code>, <code>first</code>, or <code>firstWhere</code>. Instead of returning a collection of models, these methods return a single model instance:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve a model by its primary key...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Retrieve the first model matching the query constraints...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="c1">// Shorthand for retrieving the first model matching the query constraints...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstWhere</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>

<p>You may also call the <code>find</code> method with an array of primary keys, which will return a collection of the matching records:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>Sometimes you may wish to retrieve the first result of a query or perform some other action if no results are found. The <code>firstOr</code> method will return the first result that is found or, if no results are found, execute the given callback. The result of the callback will be considered the result of the <code>firstOr</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOr</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>

<p>The <code>firstOr</code> method also accepts an array of columns to retrieve:</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">firstOr</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;legs&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="c1">// ...</span>
            <span class="p">});</span>
</pre></div>

<h4>Not Found Exceptions</h4>

<p>Sometimes you may wish to throw an exception if a model is not found. This is particularly useful in routes or controllers. The <code>findOrFail</code> and <code>firstOrFail</code> methods will retrieve the first result of the query; however, if no result is found, a <code>Illuminate\Database\Eloquent\ModelNotFoundException</code> will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$model</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
</pre></div>

<p>If the exception is not caught, a <code>404</code> HTTP response is automatically sent back to the user. It is not necessary to write explicit checks to return <code>404</code> responses when using these methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/flights/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="nx">$id</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="retrieving-aggregates"></a></p>

<h3>Retrieving Aggregates</h3>

<p>You may also use the <code>count</code>, <code>sum</code>, <code>max</code>, and other <a href="/docs/%7B%7Bversion%7D%7D/queries#aggregates">aggregate methods</a> provided by the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a>. These methods return the appropriate scalar value instead of a full model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$count</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$max</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="inserting-and-updating-models"></a></p>

<h2>Inserting &amp; Updating Models</h2>

<p><a name="inserts"></a></p>

<h3>Inserts</h3>

<p>To create a new record in the database, create a new model instance, set attributes on the model, then call the <code>save</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FlightController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a new flight instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validate the request...</span>

        <span class="nv">$flight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Flight</span><span class="p">;</span>

        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>

        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, we assign the <code>name</code> parameter from the incoming HTTP request to the <code>name</code> attribute of the <code>App\Models\Flight</code> model instance. When we call the <code>save</code> method, a record will be inserted into the database. The <code>created_at</code> and <code>updated_at</code> timestamps will automatically be set when the <code>save</code> method is called, so there is no need to set them manually.</p>

<p><a name="updates"></a></p>

<h3>Updates</h3>

<p>The <code>save</code> method may also be used to update models that already exist in the database. To update a model, you should retrieve it, set any attributes you wish to update, and then call the <code>save</code> method. Again, the <code>updated_at</code> timestamp will automatically be updated, so there is no need to manually set its value:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;New Flight Name&#39;</span><span class="p">;</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h4>Mass Updates</h4>

<p>Updates can also be performed against any number of models that match a given query. In this example, all flights that are <code>active</code> and have a <code>destination</code> of <code>San Diego</code> will be marked as delayed:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;destination&#39;</span><span class="p">,</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;delayed&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>The <code>update</code> method expects an array of column and value pairs representing the columns that should be updated.</p>

<blockquote>
<p>{note} When issuing a mass update via Eloquent, the <code>saving</code>, <code>saved</code>, <code>updating</code>, and <code>updated</code> model events will not be fired for the updated models. This is because the models are never actually retrieved when issuing a mass update.</p>
</blockquote>

<h4>Examining Attribute Changes</h4>

<p>Eloquent provides the <code>isDirty</code>, <code>isClean</code>, and <code>wasChanged</code> methods to examine the internal state of your model and determine how its attributes have changed from when they were originally loaded.</p>

<p>The <code>isDirty</code> method determines if any attributes have been changed since the model was loaded. You may pass a specific attribute name to determine if a particular attribute is dirty. The <code>isClean</code> method is the opposite of <code>isDirty</code> and also accepts an optional attribute argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;first_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Otwell&#39;</span><span class="p">,</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Painter&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isDirty</span><span class="p">();</span> <span class="c1">// true</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isDirty</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isDirty</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// false</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isClean</span><span class="p">();</span> <span class="c1">// false</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isClean</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// false</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isClean</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// true</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isDirty</span><span class="p">();</span> <span class="c1">// false</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">isClean</span><span class="p">();</span> <span class="c1">// true</span>
</pre></div>

<p>The <code>wasChanged</code> method determines if any attributes were changed when the model was last saved within the current request cycle. You may also pass an attribute name to see if a particular attribute was changed:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;first_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Otwell&#39;</span><span class="p">,</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Painter&#39;</span><span class="p">;</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">wasChanged</span><span class="p">();</span> <span class="c1">// true</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">wasChanged</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">wasChanged</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// false</span>
</pre></div>

<p>The <code>getOriginal</code> method returns an array containing the original attributes of the model regardless of any changes since the model was loaded. You may pass a specific attribute name to get the original value of a particular attribute:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span> <span class="c1">// John</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span> <span class="c1">// john@example.com</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Jack&quot;</span><span class="p">;</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span> <span class="c1">// Jack</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getOriginal</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// John</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getOriginal</span><span class="p">();</span> <span class="c1">// Array of original attributes...</span>
</pre></div>

<p><a name="mass-assignment"></a></p>

<h3>Mass Assignment</h3>

<p>You may also use the <code>create</code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code>fillable</code> or <code>guarded</code> attribute on the model, as all Eloquent models protect against mass-assignment by default.</p>

<p>A mass-assignment vulnerability occurs when a user passes an unexpected HTTP parameter through a request, and that parameter changes a column in your database you did not expect. For example, a malicious user might send an <code>is_admin</code> parameter through an HTTP request, which is then passed into your model&#39;s <code>create</code> method, allowing the user to escalate themselves to an administrator.</p>

<p>So, to get started, you should define which model attributes you want to make mass assignable. You may do this using the <code>$fillable</code> property on the model. For example, let&#39;s make the <code>name</code> attribute of our <code>Flight</code> model mass assignable:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The attributes that are mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Once we have made the attributes mass assignable, we can use the <code>create</code> method to insert a new record in the database. The <code>create</code> method returns the saved model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>
</pre></div>

<p>If you already have a model instance, you may use the <code>fill</code> method to populate it with an array of attributes:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">fill</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 22&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Allowing Mass Assignment</h4>

<p>If you would like to make all attributes mass assignable, you may define the <code>$guarded</code> property as an empty array:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The attributes that aren&#39;t mass assignable.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$guarded</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>

<p><a name="other-creation-methods"></a></p>

<h3>Other Creation Methods</h3>

<h4><code>firstOrCreate</code>/ <code>firstOrNew</code></h4>

<p>There are two other methods you may use to create models by mass assigning attributes: <code>firstOrCreate</code> and <code>firstOrNew</code>. The <code>firstOrCreate</code> method will attempt to locate a database record using the given column / value pairs. If the model can not be found in the database, a record will be inserted with the attributes from the first parameter, along with those in the optional second parameter.</p>

<p>The <code>firstOrNew</code> method, like <code>firstOrCreate</code> will attempt to locate a record in the database matching the given attributes. However, if a model is not found, a new model instance will be returned. Note that the model returned by <code>firstOrNew</code> has not yet been persisted to the database. You will need to call <code>save</code> manually to persist it:</p>
<div class="highlight"><pre><span></span><span class="c1">// Retrieve flight by name, or create it if it doesn&#39;t exist...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrCreate</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>

<span class="c1">// Retrieve flight by name, or create it with the name, delayed, and arrival_time attributes...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrCreate</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;delayed&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;arrival_time&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;11:30&#39;</span><span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Retrieve by name, or instantiate...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrNew</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">]);</span>

<span class="c1">// Retrieve by name, or instantiate with the name, delayed, and arrival_time attributes...</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">firstOrNew</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Flight 10&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;delayed&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;arrival_time&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;11:30&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<h4><code>updateOrCreate</code></h4>

<p>You may also come across situations where you want to update an existing model or create a new model if none exists. Laravel provides an <code>updateOrCreate</code> method to do this in one step. Like the <code>firstOrCreate</code> method, <code>updateOrCreate</code> persists the model, so there&#39;s no need to call <code>save()</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">// If there&#39;s a flight from Oakland to San Diego, set the price to $99.</span>
<span class="c1">// If no matching model exists, create one.</span>
<span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">updateOrCreate</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Oakland&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">&#39;discounted&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p><a name="deleting-models"></a></p>

<h2>Deleting Models</h2>

<p>To delete a model, call the <code>delete</code> method on a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$flight</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<h4>Deleting An Existing Model By Key</h4>

<p>In the example above, we are retrieving the model from the database before calling the <code>delete</code> method. However, if you know the primary key of the model, you may delete the model without explicitly retrieving it by calling the <code>destroy</code> method.  In addition to a single primary key as its argument, the <code>destroy</code> method will accept multiple primary keys, an array of primary keys, or a <a href="/docs/%7B%7Bversion%7D%7D/collections">collection</a> of primary keys:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]));</span>
</pre></div>

<blockquote>
<p>{note} The <code>destroy</code> method loads each model individually and calls the <code>delete</code> method on them so that the <code>deleting</code> and <code>deleted</code> events are fired.</p>
</blockquote>

<h4>Deleting Models By Query</h4>

<p>You can also run a delete statement on a set of models. In this example, we will delete all flights that are marked as inactive. Like mass updates, mass deletes will not fire any model events for the models that are deleted:</p>
<div class="highlight"><pre><span></span><span class="nx">$deletedRows</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} When executing a mass delete statement via Eloquent, the <code>deleting</code> and <code>deleted</code> model events will not be fired for the deleted models. This is because the models are never actually retrieved when executing the delete statement.</p>
</blockquote>

<p><a name="soft-deleting"></a></p>

<h3>Soft Deleting</h3>

<p>In addition to actually removing records from your database, Eloquent can also &quot;soft delete&quot; models. When models are soft deleted, they are not actually removed from your database. Instead, a <code>deleted_at</code> attribute is set on the model and inserted into the database. If a model has a non-null <code>deleted_at</code> value, the model has been soft deleted. To enable soft deletes for a model, use the <code>Illuminate\Database\Eloquent\SoftDeletes</code> trait on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\SoftDeletes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SoftDeletes</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} The <code>SoftDeletes</code> trait will automatically cast the <code>deleted_at</code> attribute to a <code>DateTime</code> / <code>Carbon</code> instance for you.</p>
</blockquote>

<p>You should also add the <code>deleted_at</code> column to your database table. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/migrations">schema builder</a> contains a helper method to create this column:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">up</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">softDeletes</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">down</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropSoftDeletes</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Now, when you call the <code>delete</code> method on the model, the <code>deleted_at</code> column will be set to the current date and time. And, when querying a model that uses soft deletes, the soft deleted models will automatically be excluded from all query results.</p>

<p>To determine if a given model instance has been soft deleted, use the <code>trashed</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">trashed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="querying-soft-deleted-models"></a></p>

<h3>Querying Soft Deleted Models</h3>

<h4>Including Soft Deleted Models</h4>

<p>As noted above, soft deleted models will automatically be excluded from query results. However, you may force soft deleted models to appear in a result set using the <code>withTrashed</code> method on the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>withTrashed</code> method may also be used on a <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationship</a> query:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Retrieving Only Soft Deleted Models</h4>

<p>The <code>onlyTrashed</code> method will retrieve <strong>only</strong> soft deleted models:</p>
<div class="highlight"><pre><span></span><span class="nx">$flights</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">onlyTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Restoring Soft Deleted Models</h4>

<p>Sometimes you may wish to &quot;un-delete&quot; a soft deleted model. To restore a soft deleted model into an active state, use the <code>restore</code> method on a model instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>restore</code> method in a query to quickly restore multiple models. Again, like other &quot;mass&quot; operations, this will not fire any model events for the models that are restored:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Flight</span><span class="o">::</span><span class="nx">withTrashed</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<p>Like the <code>withTrashed</code> method, the <code>restore</code> method may also be used on <a href="/docs/%7B%7Bversion%7D%7D/eloquent-relationships">relationships</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">restore</span><span class="p">();</span>
</pre></div>

<h4>Permanently Deleting Models</h4>

<p>Sometimes you may need to truly remove a model from your database. To permanently remove a soft deleted model from the database, use the <code>forceDelete</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Force deleting a single model instance...</span>
<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>

<span class="c1">// Force deleting all related models...</span>
<span class="nx">$flight</span><span class="o">-&gt;</span><span class="nx">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forceDelete</span><span class="p">();</span>
</pre></div>

<p><a name="replicating-models"></a></p>

<h2>Replicating Models</h2>

<p>You may create an unsaved copy of a model instance using the <code>replicate</code> method. This is particularly useful when you have model instances that share many of the same attributes:</p>
<div class="highlight"><pre><span></span><span class="nx">$shipping</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Address</span><span class="o">::</span><span class="nx">create</span><span class="p">([</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;shipping&#39;</span><span class="p">,</span>
    <span class="s1">&#39;line_1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;123 Example Street&#39;</span><span class="p">,</span>
    <span class="s1">&#39;city&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Victorville&#39;</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;postcode&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;90001&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">$billing</span> <span class="o">=</span> <span class="nx">$shipping</span><span class="o">-&gt;</span><span class="nx">replicate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">fill</span><span class="p">([</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;billing&#39;</span>
<span class="p">]);</span>

<span class="nx">$billing</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p><a name="query-scopes"></a></p>

<h2>Query Scopes</h2>

<p><a name="global-scopes"></a></p>

<h3>Global Scopes</h3>

<p>Global scopes allow you to add constraints to all queries for a given model. Laravel&#39;s own <a href="#soft-deleting">soft delete</a> functionality utilizes global scopes to only pull &quot;non-deleted&quot; models from the database. Writing your own global scopes can provide a convenient, easy way to make sure every query for a given model receives certain constraints.</p>

<h4>Writing Global Scopes</h4>

<p>Writing a global scope is simple. Define a class that implements the <code>Illuminate\Database\Eloquent\Scope</code> interface. This interface requires you to implement one method: <code>apply</code>. The <code>apply</code> method may add <code>where</code> constraints to the query as needed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Scopes</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Scope</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AgeScope</span> <span class="k">implements</span> <span class="nx">Scope</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Apply the scope to a given Eloquent query builder.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Builder  $builder</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Model  $model</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">apply</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">,</span> <span class="nx">Model</span> <span class="nv">$model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} If your global scope is adding columns to the select clause of the query, you should use the <code>addSelect</code> method instead of <code>select</code>. This will prevent the unintentional replacement of the query&#39;s existing select clause.</p>
</blockquote>

<h4>Applying Global Scopes</h4>

<p>To assign a global scope to a model, you should override a given model&#39;s <code>booted</code> method and use the <code>addGlobalScope</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Scopes\AgeScope</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The &quot;booted&quot; method of the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">addGlobalScope</span><span class="p">(</span><span class="k">new</span> <span class="nx">AgeScope</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After adding the scope, a query to <code>User::all()</code> will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="sb">`users`</span> <span class="nx">where</span> <span class="sb">`age`</span> <span class="o">&gt;</span> <span class="mi">200</span>
</pre></div>

<h4>Anonymous Global Scopes</h4>

<p>Eloquent also allows you to define global scopes using Closures, which is particularly useful for simple scopes that do not warrant a separate class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The &quot;booted&quot; method of the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">addGlobalScope</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Removing Global Scopes</h4>

<p>If you would like to remove a global scope for a given query, you may use the <code>withoutGlobalScope</code> method. The method accepts the class name of the global scope as its only argument:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">withoutGlobalScope</span><span class="p">(</span><span class="nx">AgeScope</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Or, if you defined the global scope using a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">User</span><span class="o">::</span><span class="nx">withoutGlobalScope</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you would like to remove several or even all of the global scopes, you may use the <code>withoutGlobalScopes</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Remove all of the global scopes...</span>
<span class="nx">User</span><span class="o">::</span><span class="nx">withoutGlobalScopes</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Remove some of the global scopes...</span>
<span class="nx">User</span><span class="o">::</span><span class="nx">withoutGlobalScopes</span><span class="p">([</span>
    <span class="nx">FirstScope</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="nx">SecondScope</span><span class="o">::</span><span class="kr">class</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="local-scopes"></a></p>

<h3>Local Scopes</h3>

<p>Local scopes allow you to define common sets of constraints that you may easily re-use throughout your application. For example, you may need to frequently retrieve all users that are considered &quot;popular&quot;. To define a scope, prefix an Eloquent model method with <code>scope</code>.</p>

<p>Scopes should always return a query builder instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include popular users.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Builder  $query</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopePopular</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include active users.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Builder  $query</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeActive</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Utilizing A Local Scope</h4>

<p>Once the scope has been defined, you may call the scope methods when querying the model. However, you should not include the <code>scope</code> prefix when calling the method. You can even chain calls to various scopes, for example:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Combining multiple Eloquent model scopes via an <code>or</code> query operator may require the use of Closure callbacks:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>However, since this can be cumbersome, Laravel provides a &quot;higher order&quot; <code>orWhere</code> method that allows you to fluently chain these scopes together without the use of Closures:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">orWhere</span><span class="o">-&gt;</span><span class="nx">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Dynamic Scopes</h4>

<p>Sometimes you may wish to define a scope that accepts parameters. To get started, just add your additional parameters to your scope. Scope parameters should be defined after the <code>$query</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Scope a query to only include users of a given type.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Database\Eloquent\Builder  $query</span>
<span class="sd">     * @param  mixed  $type</span>
<span class="sd">     * @return \Illuminate\Database\Eloquent\Builder</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeOfType</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="nv">$type</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now, you may pass the parameters when calling the scope:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">ofType</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="comparing-models"></a></p>

<h2>Comparing Models</h2>

<p>Sometimes you may need to determine if two models are the &quot;same&quot;. The <code>is</code> method may be used to quickly verify two models have same primary key, table, and database connection:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$post</span><span class="o">-&gt;</span><span class="nx">is</span><span class="p">(</span><span class="nx">$anotherPost</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Eloquent models fire several events, allowing you to hook into the following points in a model&#39;s lifecycle: <code>retrieved</code>, <code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>, <code>restoring</code>, <code>restored</code>. Events allow you to easily execute code each time a specific model class is saved or updated in the database. Each event receives the instance of the model through its constructor.</p>

<p>The <code>retrieved</code> event will fire when an existing model is retrieved from the database. When a new model is saved for the first time, the <code>creating</code> and <code>created</code> events will fire. The <code>updating</code> / <code>updated</code> events will fire when an existing model is modified and the <code>save</code> method is called. The <code>saving</code> / <code>saved</code> events will fire when a model is created or updated.</p>

<blockquote>
<p>{note} When issuing a mass update or delete via Eloquent, the <code>saved</code>, <code>updated</code>, <code>deleting</code>, and <code>deleted</code> model events will not be fired for the affected models. This is because the models are never actually retrieved when issuing a mass update or delete.</p>
</blockquote>

<p>To get started, define a <code>$dispatchesEvents</code> property on your Eloquent model that maps various points of the Eloquent model&#39;s lifecycle to your own <a href="/docs/%7B%7Bversion%7D%7D/events">event classes</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserDeleted</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UserSaved</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The event map for the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dispatchesEvents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;saved&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserSaved</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;deleted&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserDeleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>After defining and mapping your Eloquent events, you may use <a href="https://laravel.com/docs/%7B%7Bversion%7D%7D/events#defining-listeners">event listeners</a> to handle the events.</p>

<p><a name="events-using-closures"></a></p>

<h3>Using Closures</h3>

<p>Instead of using custom event classes, you may register Closures that execute when various model events are fired. Typically, you should register these Closures in the <code>booted</code> method of your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The &quot;booted&quot; method of the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">created</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If needed, you may utilize <a href="/docs/%7B%7Bversion%7D%7D/events#queuable-anonymous-event-listeners">queueable anonymous event listeners</a> when registering model events. This will instruct Laravel to execute the model event listener using the <a href="/docs/%7B%7Bversion%7D%7D/queues">queue</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="kd">function</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">queueable</span><span class="p">;</span>

<span class="kr">static</span><span class="o">::</span><span class="nx">created</span><span class="p">(</span><span class="nx">queueable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}));</span>
</pre></div>

<p><a name="observers"></a></p>

<h3>Observers</h3>

<h4>Defining Observers</h4>

<p>If you are listening for many events on a given model, you may use observers to group all of your listeners into a single class. Observers classes have method names which reflect the Eloquent events you wish to listen for. Each of these methods receives the model as their only argument. The <code>make:observer</code> Artisan command is the easiest way to create a new observer class:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">observer</span> <span class="nx">UserObserver</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="nx">User</span>
</pre></div>

<p>This command will place the new observer in your <code>App/Observers</code> directory. If this directory does not exist, Artisan will create it for you. Your fresh observer will look like the following:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Observers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserObserver</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle the User &quot;created&quot; event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the User &quot;updated&quot; event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updated</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the User &quot;deleted&quot; event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deleted</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the User &quot;forceDeleted&quot; event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\User  $user</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forceDeleted</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>To register an observer, use the <code>observe</code> method on the model you wish to observe. You may register observers in the <code>boot</code> method of one of your service providers. In this example, we&#39;ll register the observer in the <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Observers\UserObserver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">User</span><span class="o">::</span><span class="na">observe</span><span class="p">(</span><span class="nx">UserObserver</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="muting-events"></a></p>

<h3>Muting Events</h3>

<p>You may occasionally wish to temporarily &quot;mute&quot; all events fired by a model. You may achieve this using the <code>withoutEvents</code> method. The <code>withoutEvents</code> method accepts a Closure as its only argument. Any code executed within this Closure will not fire model events. For example, the following will fetch and delete an <code>App\Models\User</code> instance without firing any model events. Any value returned by the given Closure will be returned by the <code>withoutEvents</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">withoutEvents</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="nx">use</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">User</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Saving A Single Model Without Events</h4>

<p>Sometimes you may wish to &quot;save&quot; a given model without raising any events. You may accomplish this using the <code>saveQuietly</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Victoria Faith&#39;</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">saveQuietly</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Encryption</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#using-the-encrypter">Using The Encrypter</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s encrypter uses OpenSSL to provide AES-256 and AES-128 encryption. You are strongly encouraged to use Laravel&#39;s built-in encryption facilities and not attempt to roll your own &quot;home grown&quot; encryption algorithms. All of Laravel&#39;s encrypted values are signed using a message authentication code (MAC) so that their underlying value can not be modified once encrypted.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Before using Laravel&#39;s encrypter, you must set a <code>key</code> option in your <code>config/app.php</code> configuration file. You should use the <code>php artisan key:generate</code> command to generate this key since this Artisan command will use PHP&#39;s secure random bytes generator to build your key. If this value is not properly set, all values encrypted by Laravel will be insecure.</p>

<p><a name="using-the-encrypter"></a></p>

<h2>Using The Encrypter</h2>

<h4>Encrypting A Value</h4>

<p>You may encrypt a value using the <code>encryptString</code> method of the <code>Crypt</code> facade. All encrypted values are encrypted using OpenSSL and the <code>AES-256-CBC</code> cipher. Furthermore, all encrypted values are signed with a message authentication code (MAC) to detect any modifications to the encrypted string:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Crypt</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a secret message for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">storeSecret</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
            <span class="s1">&#39;secret&#39;</span> <span class="o">=&gt;</span> <span class="nx">Crypt</span><span class="o">::</span><span class="na">encryptString</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">),</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Decrypting A Value</h4>

<p>You may decrypt values using the <code>decryptString</code> method of the <code>Crypt</code> facade. If the value can not be properly decrypted, such as when the MAC is invalid, an <code>Illuminate\Contracts\Encryption\DecryptException</code> will be thrown:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Encryption</span><span class="err">\</span><span class="nx">DecryptException</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Crypt</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">$decrypted</span> <span class="o">=</span> <span class="nx">Crypt</span><span class="o">::</span><span class="nx">decryptString</span><span class="p">(</span><span class="nx">$encryptedValue</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">DecryptException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Envoy</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#installation">Installation</a></li>
</ul></li>
<li><a href="#writing-tasks">Writing Tasks</a>

<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#stories">Stories</a></li>
<li><a href="#multiple-servers">Multiple Servers</a></li>
</ul></li>
<li><a href="#running-tasks">Running Tasks</a>

<ul>
<li><a href="#confirming-task-execution">Confirming Task Execution</a></li>
</ul></li>
<li><a href="#notifications">Notifications</a>

<ul>
<li><a href="#slack">Slack</a></li>
<li><a href="#discord">Discord</a></li>
<li><a href="#telegram">Telegram</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="https://github.com/laravel/envoy">Laravel Envoy</a> provides a clean, minimal syntax for defining common tasks you run on your remote servers. Using Blade style syntax, you can easily setup tasks for deployment, Artisan commands, and more. Currently, Envoy only supports the Mac and Linux operating systems.</p>

<p><a name="installation"></a></p>

<h3>Installation</h3>

<p>First, install Envoy using the Composer <code>global require</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">envoy</span>
</pre></div>

<p>Since global Composer libraries can sometimes cause package version conflicts, you may wish to consider using <code>cgr</code>, which is a drop-in replacement for the <code>composer global require</code> command. The <code>cgr</code> library&#39;s installation instructions can be <a href="https://github.com/consolidation-org/cgr">found on GitHub</a>.</p>

<blockquote>
<p>{note} Make sure to place the <code>$HOME/.config/composer/vendor/bin</code> or <code>$HOME/.composer/vendor/bin</code> directory in your PATH so the <code>envoy</code> executable is found when running the <code>envoy</code> command in your terminal.</p>
</blockquote>

<h4>Updating Envoy</h4>

<p>You may also use Composer to keep your Envoy installation up to date. Issuing the <code>composer global update</code> command will update all of your globally installed Composer packages:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">update</span>
</pre></div>

<p><a name="writing-tasks"></a></p>

<h2>Writing Tasks</h2>

<p>All of your Envoy tasks should be defined in an <code>Envoy.blade.php</code> file in the root of your project. Here&#39;s an example to get you started:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user@192.168.1.1&#39;</span><span class="p">]])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">ls</span> <span class="o">-</span><span class="nx">la</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>As you can see, an array of <code>@servers</code> is defined at the top of the file, allowing you to reference these servers in the <code>on</code> option of your task declarations. The <code>@servers</code> declaration should always be placed on a single line. Within your <code>@task</code> declarations, you should place the Bash code that should run on your server when the task is executed.</p>

<p>You can force a script to run locally by specifying the server&#39;s IP address as <code>127.0.0.1</code>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;localhost&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">])</span>
</pre></div>

<p><a name="setup"></a></p>

<h3>Setup</h3>

<p>Sometimes, you may need to execute some PHP code before executing your Envoy tasks. You may use the <code>@setup</code> directive to declare variables and do other general PHP work before any of your other tasks are executed:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">setup</span>
    <span class="nx">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>

    <span class="nx">$environment</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nx">$env</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$env</span> <span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">endsetup</span>
</pre></div>

<p>If you need to require other PHP files before your task is executed, you may use the <code>@include</code> directive at the top of your <code>Envoy.blade.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="err">#</span> <span class="p">...</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>You may also import other Envoy files so their stories and tasks are added to yours. After they have been imported, you may execute the tasks in those files as if they were defined in your own. You should use the <code>@import</code> directive at the top of your <code>Envoy.blade.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;package/Envoy.blade.php&#39;</span><span class="p">)</span>
</pre></div>

<p><a name="variables"></a></p>

<h3>Variables</h3>

<p>If needed, you may pass option values into Envoy tasks using the command line:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span> <span class="o">--</span><span class="nx">branch</span><span class="o">=</span><span class="nx">master</span>
</pre></div>

<p>You may access the options in your tasks via Blade&#39;s &quot;echo&quot; syntax. You may also use <code>if</code> statements and loops within your tasks. For example, let&#39;s verify the presence of the <code>$branch</code> variable before executing the <code>git pull</code> command:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>

    <span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$branch</span><span class="p">)</span>
        <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="err">@</span><span class="nx">endif</span>

    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="stories"></a></p>

<h3>Stories</h3>

<p>Stories group a set of tasks under a single, convenient name, allowing you to group small, focused tasks into large tasks. For instance, a <code>deploy</code> story may run the <code>git</code> and <code>composer</code> tasks by listing the task names within its definition:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">story</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
    <span class="nx">git</span>
    <span class="nx">composer</span>
<span class="err">@</span><span class="nx">endstory</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;git&#39;</span><span class="p">)</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="nx">master</span>
<span class="err">@</span><span class="nx">endtask</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;composer&#39;</span><span class="p">)</span>
    <span class="nx">composer</span> <span class="nx">install</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p>Once the story has been written, you may run it just like a typical task:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span>
</pre></div>

<p><a name="multiple-servers"></a></p>

<h3>Multiple Servers</h3>

<p>Envoy allows you to easily run a task across multiple servers. First, add additional servers to your <code>@servers</code> declaration. Each server should be assigned a unique name. Once you have defined your additional servers, list each of the servers in the task&#39;s <code>on</code> array:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">]])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<h4>Parallel Execution</h4>

<p>By default, tasks will be executed on each server serially. In other words, a task will finish running on the first server before proceeding to execute on the second server. If you would like to run a task across multiple servers in parallel, add the <code>parallel</code> option to your task declaration:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">servers</span><span class="p">([</span><span class="s1">&#39;web-1&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">])</span>

<span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web-1&#39;</span><span class="p">,</span> <span class="s1">&#39;web-2&#39;</span><span class="p">],</span> <span class="s1">&#39;parallel&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="running-tasks"></a></p>

<h2>Running Tasks</h2>

<p>To run a task or story that is defined in your <code>Envoy.blade.php</code> file, execute Envoy&#39;s <code>run</code> command, passing the name of the task or story you would like to execute. Envoy will run the task and display the output from the servers as the task is running:</p>
<div class="highlight"><pre><span></span><span class="nx">envoy</span> <span class="nx">run</span> <span class="nx">deploy</span>
</pre></div>

<p><a name="confirming-task-execution"></a></p>

<h3>Confirming Task Execution</h3>

<p>If you would like to be prompted for confirmation before running a given task on your servers, you should add the <code>confirm</code> directive to your task declaration. This option is particularly useful for destructive operations:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;confirm&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">])</span>
    <span class="nx">cd</span> <span class="nx">site</span>
    <span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="p">{{</span> <span class="nx">$branch</span> <span class="p">}}</span>
    <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
<span class="err">@</span><span class="nx">endtask</span>
</pre></div>

<p><a name="notifications"></a></p>

<h2>Notifications</h2>

<p><a name="slack"></a></p>

<h3>Slack</h3>

<p>Envoy also supports sending notifications to <a href="https://slack.com">Slack</a> after each task is executed. The <code>@slack</code> directive accepts a Slack hook URL and a channel name. You may retrieve your webhook URL by creating an &quot;Incoming WebHooks&quot; integration in your Slack control panel. You should pass the entire webhook URL into the <code>@slack</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">finished</span>
    <span class="err">@</span><span class="nx">slack</span><span class="p">(</span><span class="s1">&#39;webhook-url&#39;</span><span class="p">,</span> <span class="s1">&#39;#bots&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endfinished</span>
</pre></div>

<p>You may provide one of the following as the channel argument:</p>

<div class="content-list" markdown="1">
- To send the notification to a channel: `#channel`
- To send the notification to a user: `@user`
</div>

<p><a name="discord"></a></p>

<h3>Discord</h3>

<p>Envoy also supports sending notifications to <a href="https://discord.com">Discord</a> after each task is executed. The <code>@discord</code> directive accepts a Discord hook URL and a message. You may retrieve your webhook URL by creating a &quot;Webhook&quot; in your Server Settings and choosing which channel the webhook should post to. You should pass the entire Webhook URL into the <code>@discord</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">finished</span>
    <span class="err">@</span><span class="nx">discord</span><span class="p">(</span><span class="s1">&#39;discord-webhook-url&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endfinished</span>
</pre></div>

<p><a name="telegram"></a></p>

<h3>Telegram</h3>

<p>Envoy also supports sending notifications to <a href="https://telegram.org">Telegram</a> after each task is executed. The <code>@telegram</code> directive accepts a Telegram Bot ID and a Chat ID. You may retrieve your Bot ID by creating a new bot using <a href="https://t.me/botfather">BotFather</a>. You can retrieve a valid Chat ID using <a href="https://t.me/username_to_id_bot">@username<em>to</em>id_bot</a>. You should pass the entire Bot ID and Chat ID into the <code>@telegram</code> directive:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">finished</span>
    <span class="err">@</span><span class="nx">telegram</span><span class="p">(</span><span class="s1">&#39;&lt;bot-id&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;chat-id&gt;&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="nx">endfinished</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Error Handling</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#the-exception-handler">The Exception Handler</a>

<ul>
<li><a href="#reporting-exceptions">Reporting Exceptions</a></li>
<li><a href="#rendering-exceptions">Rendering Exceptions</a></li>
<li><a href="#renderable-exceptions">Reportable &amp; Renderable Exceptions</a></li>
</ul></li>
<li><a href="#http-exceptions">HTTP Exceptions</a>

<ul>
<li><a href="#custom-http-error-pages">Custom HTTP Error Pages</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When you start a new Laravel project, error and exception handling is already configured for you. The <code>App\Exceptions\Handler</code> class is where all exceptions triggered by your application are logged and then rendered back to the user. We&#39;ll dive deeper into this class throughout this documentation.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The <code>debug</code> option in your <code>config/app.php</code> configuration file determines how much information about an error is actually displayed to the user. By default, this option is set to respect the value of the <code>APP_DEBUG</code> environment variable, which is stored in your <code>.env</code> file.</p>

<p>For local development, you should set the <code>APP_DEBUG</code> environment variable to <code>true</code>. In your production environment, this value should always be <code>false</code>. If the value is set to <code>true</code> in production, you risk exposing sensitive configuration values to your application&#39;s end users.</p>

<p><a name="the-exception-handler"></a></p>

<h2>The Exception Handler</h2>

<p><a name="reporting-exceptions"></a></p>

<h3>Reporting Exceptions</h3>

<p>All exceptions are handled by the <code>App\Exceptions\Handler</code> class. This class contains a <code>register</code> method where you may register custom exception reporter and renderer callbacks. We&#39;ll examine each of these concepts in detail. Exception reporting is used to log exceptions or send them to an external service like <a href="https://flareapp.io">Flare</a>, <a href="https://bugsnag.com">Bugsnag</a> or <a href="https://github.com/getsentry/sentry-laravel">Sentry</a>. By default, exceptions will be logged based on your <a href="/docs/%7B%7Bversion%7D%7D/logging">logging</a> configuration. However, you are free to log exceptions however you wish.</p>

<p>For example, if you need to report different types of exceptions in different ways, you may use the the <code>reportable</code> method to register a Closure that should be executed when an exception of a given type needs to be reported. Laravel will deduce what type of exception the Closure reports by examining the type-hint of the Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Exceptions</span><span class="err">\</span><span class="nx">CustomException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register the exception handling callbacks for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">reportable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">CustomException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>When you register a custom exception reporting callback using the <code>reportable</code> method, Laravel will still log the exception using the default logging configuration for the application. If you wish to stop the propagation of the exception to the default logging stack, you may use the <code>stop</code> method when defining your reporting callback:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">reportable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">CustomException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">stop</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} To customize the exception reporting for a given exception, you may also consider using <a href="/docs/%7B%7Bversion%7D%7D/errors#renderable-exceptions">reportable exceptions</a></p>
</blockquote>

<h4>Global Log Context</h4>

<p>If available, Laravel automatically adds the current user&#39;s ID to every exception&#39;s log message as contextual data. You may define your own global contextual data by overriding the <code>context</code> method of your application&#39;s <code>App\Exceptions\Handler</code> class. This information will be included in every exception&#39;s log message written by your application:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the default context variables for logging.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">context</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nx">parent</span><span class="o">::</span><span class="nx">context</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>report</code> Helper</h4>

<p>Sometimes you may need to report an exception but continue handling the current request. The <code>report</code> helper function allows you to quickly report an exception using your exception handler without rendering an error page:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">isValid</span><span class="p">(</span><span class="nx">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Validate the value...</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">report</span><span class="p">(</span><span class="nx">$e</span><span class="p">);</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Ignoring Exceptions By Type</h4>

<p>The <code>$dontReport</code> property of the exception handler contains an array of exception types that will not be logged. For example, exceptions resulting from 404 errors, as well as several other types of errors, are not written to your log files. You may add other exception types to this array as needed:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * A list of the exception types that should not be reported.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$dontReport</span> <span class="o">=</span> <span class="p">[</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">AuthenticationException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Access</span><span class="err">\</span><span class="nx">AuthorizationException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Symfony</span><span class="err">\</span><span class="nx">Component</span><span class="err">\</span><span class="nx">HttpKernel</span><span class="err">\</span><span class="nx">Exception</span><span class="err">\</span><span class="nx">HttpException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Database</span><span class="err">\</span><span class="nx">Eloquent</span><span class="err">\</span><span class="nx">ModelNotFoundException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">ValidationException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="rendering-exceptions"></a></p>

<h3>Rendering Exceptions</h3>

<p>By default, the Laravel exception handler will convert exceptions into an HTTP response for you. However, you are free to register a custom rendering Closure for exceptions of a given type. You may accomplish this via the <code>renderable</code> method of your exception handler. Laravel will deduce what type of exception the Closure renders by examining the type-hint of the Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Exceptions</span><span class="err">\</span><span class="nx">CustomException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register the exception handling callbacks for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">renderable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">CustomException</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;errors.custom&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">500</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="renderable-exceptions"></a></p>

<h3>Reportable &amp; Renderable Exceptions</h3>

<p>Instead of type-checking exceptions in the exception handler&#39;s <code>report</code> and <code>render</code> methods, you may define <code>report</code> and <code>render</code> methods directly on your custom exception. When these methods exist, they will be called automatically by the framework:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RenderException</span> <span class="k">extends</span> <span class="nx">Exception</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Report the exception.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">report</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Render the exception into an HTTP response.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @return \Illuminate\Http\Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If your exception contains custom reporting logic that only occurs when certain conditions are met, you may need to instruct Laravel to report the exception using the default exception handling configuration. To accomplish this, you may return <code>false</code> from the exception&#39;s <code>report</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Report the exception.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool|void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">report</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Determine if the exception needs custom reporting...</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may type-hint any required dependencies of the <code>report</code> method and they will automatically be injected into the method by Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>
</blockquote>

<p><a name="http-exceptions"></a></p>

<h2>HTTP Exceptions</h2>

<p>Some exceptions describe HTTP error codes from the server. For example, this may be a &quot;page not found&quot; error (404), an &quot;unauthorized error&quot; (401) or even a developer generated 500 error. In order to generate such a response from anywhere in your application, you may use the <code>abort</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</pre></div>

<p>The <code>abort</code> helper will immediately raise an exception which will be rendered by the exception handler. Optionally, you may provide the response text:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="custom-http-error-pages"></a></p>

<h3>Custom HTTP Error Pages</h3>

<p>Laravel makes it easy to display custom error pages for various HTTP status codes. For example, if you wish to customize the error page for 404 HTTP status codes, create a <code>resources/views/errors/404.blade.php</code>. This file will be served on all 404 errors generated by your application. The views within this directory should be named to match the HTTP status code they correspond to. The <code>HttpException</code> instance raised by the <code>abort</code> function will be passed to the view as an <code>$exception</code> variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$exception</span><span class="o">-&gt;</span><span class="nx">getMessage</span><span class="p">()</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
</pre></div>

<p>You may publish Laravel&#39;s error page templates using the <code>vendor:publish</code> Artisan command. Once the templates have been published, you may customize them to your liking:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">errors</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Events</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#registering-events-and-listeners">Registering Events &amp; Listeners</a>

<ul>
<li><a href="#generating-events-and-listeners">Generating Events &amp; Listeners</a></li>
<li><a href="#manually-registering-events">Manually Registering Events</a></li>
<li><a href="#event-discovery">Event Discovery</a></li>
</ul></li>
<li><a href="#defining-events">Defining Events</a></li>
<li><a href="#defining-listeners">Defining Listeners</a></li>
<li><a href="#queued-event-listeners">Queued Event Listeners</a>

<ul>
<li><a href="#manually-accessing-the-queue">Manually Accessing The Queue</a></li>
<li><a href="#handling-failed-jobs">Handling Failed Jobs</a></li>
</ul></li>
<li><a href="#dispatching-events">Dispatching Events</a></li>
<li><a href="#event-subscribers">Event Subscribers</a>

<ul>
<li><a href="#writing-event-subscribers">Writing Event Subscribers</a></li>
<li><a href="#registering-event-subscribers">Registering Event Subscribers</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s events provide a simple observer implementation, allowing you to subscribe and listen for various events that occur in your application. Event classes are typically stored in the <code>app/Events</code> directory, while their listeners are stored in <code>app/Listeners</code>. Don&#39;t worry if you don&#39;t see these directories in your application, since they will be created for you as you generate events and listeners using Artisan console commands.</p>

<p>Events serve as a great way to decouple various aspects of your application, since a single event can have multiple listeners that do not depend on each other. For example, you may wish to send a Slack notification to your user each time an order has shipped. Instead of coupling your order processing code to your Slack notification code, you can raise an <code>OrderShipped</code> event, which a listener can receive and transform into a Slack notification.</p>

<p><a name="registering-events-and-listeners"></a></p>

<h2>Registering Events &amp; Listeners</h2>

<p>The <code>EventServiceProvider</code> included with your Laravel application provides a convenient place to register all of your application&#39;s event listeners. The <code>listen</code> property contains an array of all events (keys) and their listeners (values). You may add as many events to this array as your application requires. For example, let&#39;s add a <code>OrderShipped</code> event:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;App\Events\OrderShipped&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\SendShipmentNotification&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p><a name="generating-events-and-listeners"></a></p>

<h3>Generating Events &amp; Listeners</h3>

<p>Of course, manually creating the files for each event and listener is cumbersome. Instead, add listeners and events to your <code>EventServiceProvider</code> and use the <code>event:generate</code> command. This command will generate any events or listeners that are listed in your <code>EventServiceProvider</code>. Events and listeners that already exist will be left untouched:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">event</span><span class="o">:</span><span class="nx">generate</span>
</pre></div>

<p><a name="manually-registering-events"></a></p>

<h3>Manually Registering Events</h3>

<p>Typically, events should be registered via the <code>EventServiceProvider</code> <code>$listen</code> array; however, you may also register Closure based events manually in the <code>boot</code> method of your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">PodcastProcessed</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="queuable-anonymous-event-listeners"></a></p>

<h4>Queueable Anonymous Event Listeners</h4>

<p>When registering evnet listeners manually, you may wrap the listener Closure within the <code>Illuminate\Events\queueable</code> function to instruct Laravel to execute the listener using the <a href="/docs/%7B%7Bversion%7D%7D/queues">queue</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">PodcastProcessed</span><span class="p">;</span>
<span class="nx">use</span> <span class="kd">function</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">queueable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Event</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any other events for your application.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="nx">queueable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}));</span>
<span class="p">}</span>
</pre></div>

<p>Like queued jobs, you may use the <code>onConnection</code>, <code>onQueue</code>, and <code>delay</code> methods to customize the execution of the queued listener:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="nx">queueable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">onConnection</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;podcasts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">delay</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addSeconds</span><span class="p">(</span><span class="mi">10</span><span class="p">)));</span>
</pre></div>

<p>If you would like to handle anonymous queued listener failures, you may provide a Closure to the <code>catch</code> method while defining the <code>queueable</code> listener:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">PodcastProcessed</span><span class="p">;</span>
<span class="nx">use</span> <span class="kd">function</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">queueable</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Event</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="nx">queueable</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">,</span> <span class="nx">Throwable</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The queued listener failed...</span>
<span class="p">}));</span>
</pre></div>

<h4>Wildcard Event Listeners</h4>

<p>You may even register listeners using the <code>*</code> as a wildcard parameter, allowing you to catch multiple events on the same listener. Wildcard listeners receive the event name as their first argument, and the entire event data array as their second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">Event</span><span class="o">::</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;event.*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$eventName</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="event-discovery"></a></p>

<h3>Event Discovery</h3>

<p>Instead of registering events and listeners manually in the <code>$listen</code> array of the <code>EventServiceProvider</code>, you can enable automatic event discovery. When event discovery is enabled, Laravel will automatically find and register your events and listeners by scanning your application&#39;s <code>Listeners</code> directory. In addition, any explicitly defined events listed in the <code>EventServiceProvider</code> will still be registered.</p>

<p>Laravel finds event listeners by scanning the listener classes using reflection. When Laravel finds any listener class method that begins with <code>handle</code>, Laravel will register those methods as event listeners for the event that is type-hinted in the method&#39;s signature:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">PodcastProcessed</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">SendPodcastProcessedNotification</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Handle the given event.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  \App\Events\PodcastProcessed</span>
<span class="cm">     * @return void</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">PodcastProcessed</span> <span class="nx">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Event discovery is disabled by default, but you can enable it by overriding the <code>shouldDiscoverEvents</code> method of your application&#39;s <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if events and listeners should be automatically discovered.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">shouldDiscoverEvents</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>By default, all listeners within your application&#39;s Listeners directory will be scanned. If you would like to define additional directories to scan, you may override the <code>discoverEventsWithin</code> method in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the listener directories that should be used to discover events.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">discoverEventsWithin</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">path</span><span class="p">(</span><span class="s1">&#39;Listeners&#39;</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>In production, you likely do not want the framework to scan all of your listeners on every request. Therefore, during your deployment process, you should run the <code>event:cache</code> Artisan command to cache a manifest of all of your application&#39;s events and listeners. This manifest will be used by the framework to speed up the event registration process. The <code>event:clear</code> command may be used to destroy the cache.</p>

<blockquote>
<p>{tip} The <code>event:list</code> command may be used to display a list of all events and listeners registered by your application.</p>
</blockquote>

<p><a name="defining-events"></a></p>

<h2>Defining Events</h2>

<p>An event class is a data container which holds the information related to the event. For example, let&#39;s assume our generated <code>OrderShipped</code> event receives an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a> object:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Events\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderShipped</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithSockets</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\Order  $order</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, this event class contains no logic. It is a container for the <code>Order</code> instance that was purchased. The <code>SerializesModels</code> trait used by the event will gracefully serialize any Eloquent models if the event object is serialized using PHP&#39;s <code>serialize</code> function.</p>

<p><a name="defining-listeners"></a></p>

<h2>Defining Listeners</h2>

<p>Next, let&#39;s take a look at the listener for our example event. Event listeners receive the event instance in their <code>handle</code> method. The <code>event:generate</code> command will automatically import the proper event class and type-hint the event on the <code>handle</code> method. Within the <code>handle</code> method, you may perform any actions necessary to respond to the event:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendShipmentNotification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create the event listener.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderShipped  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Access the order using $event-&gt;order...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Your event listeners may also type-hint any dependencies they need on their constructors. All event listeners are resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so dependencies will be injected automatically.</p>
</blockquote>

<h4>Stopping The Propagation Of An Event</h4>

<p>Sometimes, you may wish to stop the propagation of an event to other listeners. You may do so by returning <code>false</code> from your listener&#39;s <code>handle</code> method.</p>

<p><a name="queued-event-listeners"></a></p>

<h2>Queued Event Listeners</h2>

<p>Queueing listeners can be beneficial if your listener is going to perform a slow task such as sending an e-mail or making an HTTP request. Before getting started with queued listeners, make sure to <a href="/docs/%7B%7Bversion%7D%7D/queues">configure your queue</a> and start a queue listener on your server or local development environment.</p>

<p>To specify that a listener should be queued, add the <code>ShouldQueue</code> interface to the listener class. Listeners generated by the <code>event:generate</code> Artisan command already have this interface imported into the current namespace, so you can use it immediately:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendShipmentNotification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>That&#39;s it! Now, when this listener is called for an event, it will be automatically queued by the event dispatcher using Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/queues">queue system</a>. If no exceptions are thrown when the listener is executed by the queue, the queued job will automatically be deleted after it has finished processing.</p>

<h4>Customizing The Queue Connection &amp; Queue Name</h4>

<p>If you would like to customize the queue connection, queue name, or queue delay time of an event listener, you may define the <code>$connection</code>, <code>$queue</code>, or <code>$delay</code> properties on your listener class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendShipmentNotification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name of the connection the job should be sent to.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string|null</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;sqs&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The name of the queue the job should be sent to.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string|null</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$queue</span> <span class="o">=</span> <span class="s1">&#39;listeners&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The time (seconds) before the job should be processed.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$delay</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to define the listener&#39;s queue at runtime, you may define a <code>viaQueue</code> method on the listener:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the name of the listener&#39;s queue.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">viaQueue</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;listeners&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Conditionally Queueing Listeners</h4>

<p>Sometimes, you may need to determine whether a listener should be queued based on some data that&#39;s only available at runtime. To accomplish this, a <code>shouldQueue</code> method may be added to a listener to determine whether the listener should be queued. If the <code>shouldQueue</code> method returns <code>false</code>, the listener will not be executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderPlaced</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RewardGiftCard</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Reward a gift card to the customer.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderPlaced  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderPlaced</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Determine whether the listener should be queued.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderPlaced  $event</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">shouldQueue</span><span class="p">(</span><span class="nx">OrderPlaced</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">subtotal</span> <span class="o">&gt;=</span> <span class="mi">5000</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="manually-accessing-the-queue"></a></p>

<h3>Manually Accessing The Queue</h3>

<p>If you need to manually access the listener&#39;s underlying queue job&#39;s <code>delete</code> and <code>release</code> methods, you may do so using the <code>Illuminate\Queue\InteractsWithQueue</code> trait. This trait is imported by default on generated listeners and provides access to these methods:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendShipmentNotification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderShipped  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">release</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="handling-failed-jobs"></a></p>

<h3>Handling Failed Jobs</h3>

<p>Sometimes your queued event listeners may fail. If queued listener exceeds the maximum number of attempts as defined by your queue worker, the <code>failed</code> method will be called on your listener. The <code>failed</code> method receives the event instance and the exception that caused the failure:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendShipmentNotification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderShipped  $event</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle a job failure.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Events\OrderShipped  $event</span>
<span class="sd">     * @param  \Throwable  $exception</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="dispatching-events"></a></p>

<h2>Dispatching Events</h2>

<p>To dispatch an event, you may pass an instance of the event to the <code>event</code> helper. The helper will dispatch the event to all of its registered listeners. Since the <code>event</code> helper is globally available, you may call it from anywhere in your application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Ship the given order.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $orderId</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">ship</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>

        <span class="c1">// Order shipment logic...</span>

        <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nv">$order</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, if your event uses the <code>Illuminate\Foundation\Events\Dispatchable</code> trait, you may call the static <code>dispatch</code> method on the event. Any arguments passed to the <code>dispatch</code> method will be passed to the event&#39;s constructor:</p>
<div class="highlight"><pre><span></span><span class="nx">OrderShipped</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">$order</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} When testing, it can be helpful to assert that certain events were dispatched without actually triggering their listeners. Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/mocking#event-fake">built-in testing helpers</a> makes it a cinch.</p>
</blockquote>

<p><a name="event-subscribers"></a></p>

<h2>Event Subscribers</h2>

<p><a name="writing-event-subscribers"></a></p>

<h3>Writing Event Subscribers</h3>

<p>Event subscribers are classes that may subscribe to multiple events from within the class itself, allowing you to define several event handlers within a single class. Subscribers should define a <code>subscribe</code> method, which will be passed an event dispatcher instance. You may call the <code>listen</code> method on the given dispatcher to register event listeners:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserEventSubscriber</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle user login events.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleUserLogin</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle user logout events.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleUserLogout</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{}</span>

    <span class="sd">/**</span>
<span class="sd">     * Register the listeners for the subscriber.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Events\Dispatcher  $events</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">subscribe</span><span class="p">(</span><span class="nv">$events</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="s1">&#39;Illuminate\Auth\Events\Login&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;handleUserLogin&#39;</span><span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="s1">&#39;Illuminate\Auth\Events\Logout&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;handleUserLogout&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, your subscriber&#39;s <code>subscribe</code> method may return an array of event to handler mappings. In this case, the event listener mappings will be registered for you automatically:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">Login</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Events</span><span class="err">\</span><span class="nx">Logout</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register the listeners for the subscriber.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">subscribe</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nx">Login</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;handleUserLogin&#39;</span><span class="p">],</span>
        <span class="nx">Logout</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;handleUserLogout&#39;</span><span class="p">],</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-event-subscribers"></a></p>

<h3>Registering Event Subscribers</h3>

<p>After writing the subscriber, you are ready to register it with the event dispatcher. You may register subscribers using the <code>$subscribe</code> property on the <code>EventServiceProvider</code>. For example, let&#39;s add the <code>UserEventSubscriber</code> to the list:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\EventServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The event listener mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">//</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * The subscriber classes to register.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$subscribe</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\UserEventSubscriber&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Facades</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#when-to-use-facades">When To Use Facades</a>

<ul>
<li><a href="#facades-vs-dependency-injection">Facades Vs. Dependency Injection</a></li>
<li><a href="#facades-vs-helper-functions">Facades Vs. Helper Functions</a></li>
</ul></li>
<li><a href="#how-facades-work">How Facades Work</a></li>
<li><a href="#real-time-facades">Real-Time Facades</a></li>
<li><a href="#facade-class-reference">Facade Class Reference</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Facades provide a &quot;static&quot; interface to classes that are available in the application&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. Laravel ships with many facades which provide access to almost all of Laravel&#39;s features. Laravel facades serve as &quot;static proxies&quot; to underlying classes in the service container, providing the benefit of a terse, expressive syntax while maintaining more testability and flexibility than traditional static methods.</p>

<p>All of Laravel&#39;s facades are defined in the <code>Illuminate\Support\Facades</code> namespace. So, we can easily access a facade like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cache</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/cache&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Throughout the Laravel documentation, many of the examples will use facades to demonstrate various features of the framework.</p>

<p><a name="when-to-use-facades"></a></p>

<h2>When To Use Facades</h2>

<p>Facades have many benefits. They provide a terse, memorable syntax that allows you to use Laravel&#39;s features without remembering long class names that must be injected or configured manually. Furthermore, because of their unique usage of PHP&#39;s dynamic methods, they are easy to test.</p>

<p>However, some care must be taken when using facades. The primary danger of facades is class scope creep. Since facades are so easy to use and do not require injection, it can be easy to let your classes continue to grow and use many facades in a single class. Using dependency injection, this potential is mitigated by the visual feedback a large constructor gives you that your class is growing too large. So, when using facades, pay special attention to the size of your class so that its scope of responsibility stays narrow.</p>

<blockquote>
<p>{tip} When building a third-party package that interacts with Laravel, it&#39;s better to inject <a href="/docs/%7B%7Bversion%7D%7D/contracts">Laravel contracts</a> instead of using facades. Since packages are built outside of Laravel itself, you will not have access to Laravel&#39;s facade testing helpers.</p>
</blockquote>

<p><a name="facades-vs-dependency-injection"></a></p>

<h3>Facades Vs. Dependency Injection</h3>

<p>One of the primary benefits of dependency injection is the ability to swap implementations of the injected class. This is useful during testing since you can inject a mock or stub and assert that various methods were called on the stub.</p>

<p>Typically, it would not be possible to mock or stub a truly static class method. However, since facades use dynamic methods to proxy method calls to objects resolved from the service container, we actually can test facades just as we would test an injected class instance. For example, given the following route:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cache</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/cache&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Cache</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>We can write the following test to verify that the <code>Cache::get</code> method was called with the argument we expected:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cache</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * A basic functional test example.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testBasicExample</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Cache</span><span class="o">::</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">andReturn</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/cache&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">see</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="facades-vs-helper-functions"></a></p>

<h3>Facades Vs. Helper Functions</h3>

<p>In addition to facades, Laravel includes a variety of &quot;helper&quot; functions which can perform common tasks like generating views, firing events, dispatching jobs, or sending HTTP responses. Many of these helper functions perform the same function as a corresponding facade. For example, this facade call and helper call are equivalent:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>There is absolutely no practical difference between facades and helper functions. When using helper functions, you may still test them exactly as you would the corresponding facade. For example, given the following route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/cache&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Under the hood, the <code>cache</code> helper is going to call the <code>get</code> method on the class underlying the <code>Cache</code> facade. So, even though we are using the helper function, we can write the following test to verify that the method was called with the argument we expected:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cache</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * A basic functional test example.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testBasicExample</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Cache</span><span class="o">::</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">andReturn</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/cache&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">see</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="how-facades-work"></a></p>

<h2>How Facades Work</h2>

<p>In a Laravel application, a facade is a class that provides access to an object from the container. The machinery that makes this work is in the <code>Facade</code> class. Laravel&#39;s facades, and any custom facades you create, will extend the base <code>Illuminate\Support\Facades\Facade</code> class.</p>

<p>The <code>Facade</code> base class makes use of the <code>__callStatic()</code> magic-method to defer calls from your facade to an object resolved from the container. In the example below, a call is made to the Laravel cache system. By glancing at this code, one might assume that the static method <code>get</code> is being called on the <code>Cache</code> class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Notice that near the top of the file we are &quot;importing&quot; the <code>Cache</code> facade. This facade serves as a proxy to accessing the underlying implementation of the <code>Illuminate\Contracts\Cache\Factory</code> interface. Any calls we make using the facade will be passed to the underlying instance of Laravel&#39;s cache service.</p>

<p>If we look at that <code>Illuminate\Support\Facades\Cache</code> class, you&#39;ll see that there is no static method <code>get</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Cache</span> <span class="kr">extends</span> <span class="nx">Facade</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Get the registered name of the component.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">protected</span> <span class="kr">static</span> <span class="kd">function</span> <span class="nx">getFacadeAccessor</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;cache&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Instead, the <code>Cache</code> facade extends the base <code>Facade</code> class and defines the method <code>getFacadeAccessor()</code>. This method&#39;s job is to return the name of a service container binding. When a user references any static method on the <code>Cache</code> facade, Laravel resolves the <code>cache</code> binding from the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and runs the requested method (in this case, <code>get</code>) against that object.</p>

<p><a name="real-time-facades"></a></p>

<h2>Real-Time Facades</h2>

<p>Using real-time facades, you may treat any class in your application as if it were a facade. To illustrate how this can be used, let&#39;s examine an alternative. For example, let&#39;s assume our <code>Podcast</code> model has a <code>publish</code> method. However, in order to publish the podcast, we need to inject a <code>Publisher</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Contracts\Publisher</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Podcast</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Publish the podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Publisher  $publisher</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">publish</span><span class="p">(</span><span class="nx">Publisher</span> <span class="nv">$publisher</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;publishing&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">()]);</span>

        <span class="nv">$publisher</span><span class="o">-&gt;</span><span class="na">publish</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Injecting a publisher implementation into the method allows us to easily test the method in isolation since we can mock the injected publisher. However, it requires us to always pass a publisher instance each time we call the <code>publish</code> method. Using real-time facades, we can maintain the same testability while not being required to explicitly pass a <code>Publisher</code> instance. To generate a real-time facade, prefix the namespace of the imported class with <code>Facades</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Facades\App\Contracts\Publisher</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Podcast</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Publish the podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">publish</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;publishing&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">()]);</span>

        <span class="nx">Publisher</span><span class="o">::</span><span class="na">publish</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When the real-time facade is used, the publisher implementation will be resolved out of the service container using the portion of the interface or class name that appears after the <code>Facades</code> prefix. When testing, we can use Laravel&#39;s built-in facade testing helpers to mock this method call:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Facades\App\Contracts\Publisher</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * A test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_podcast_can_be_published</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$podcast</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="nx">Publisher</span><span class="o">::</span><span class="na">shouldReceive</span><span class="p">(</span><span class="s1">&#39;publish&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">);</span>

        <span class="nv">$podcast</span><span class="o">-&gt;</span><span class="na">publish</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="facade-class-reference"></a></p>

<h2>Facade Class Reference</h2>

<p>Below you will find every facade and its underlying class. This is a useful tool for quickly digging into the API documentation for a given facade root. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container binding</a> key is also included where applicable.</p>

<p>Facade  |  Class  |  Service Container Binding
------------- | ------------- | -------------
App  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a>  |  <code>app</code>
Artisan  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Console/Kernel.html">Illuminate\Contracts\Console\Kernel</a>  |  <code>artisan</code>
Auth  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a>  |  <code>auth</code>
Auth (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Auth/Guard.html">Illuminate\Contracts\Auth\Guard</a>  |  <code>auth.driver</code>
Blade  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a>  |  <code>blade.compiler</code>
Broadcast  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Broadcasting/Factory.html">Illuminate\Contracts\Broadcasting\Factory</a>  |  &nbsp;
Broadcast (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Broadcasting/Broadcaster.html">Illuminate\Contracts\Broadcasting\Broadcaster</a>  |  &nbsp;
Bus  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a>  |  &nbsp;
Cache  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cache/CacheManager.html">Illuminate\Cache\CacheManager</a>  |  <code>cache</code>
Cache (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a>  |  <code>cache.store</code>
Config  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a>  |  <code>config</code>
Cookie  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a>  |  <code>cookie</code>
Crypt  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a>  |  <code>encrypter</code>
DB  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a>  |  <code>db</code>
DB (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a>  |  <code>db.connection</code>
Event  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a>  |  <code>events</code>
File  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a>  |  <code>files</code>
Gate  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Auth/Access/Gate.html">Illuminate\Contracts\Auth\Access\Gate</a>  |  &nbsp;
Hash  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a>  |  <code>hash</code>
Http  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Client/Factory.html">Illuminate\Http\Client\Factory</a>  |  &nbsp;
Lang  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a>  |  <code>translator</code>
Log  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Log/LogManager.html">Illuminate\Log\LogManager</a>  |  <code>log</code>
Mail  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a>  |  <code>mailer</code>
Notification  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Notifications/ChannelManager.html">Illuminate\Notifications\ChannelManager</a>  |  &nbsp;
Password  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Passwords/PasswordBrokerManager.html">Illuminate\Auth\Passwords\PasswordBrokerManager</a>  |  <code>auth.password</code>
Password (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a>  |  <code>auth.password.broker</code>
Queue  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a>  |  <code>queue</code>
Queue (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Queue/Queue.html">Illuminate\Contracts\Queue\Queue</a>  |  <code>queue.connection</code>
Queue (Base Class)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a>  |  &nbsp;
Redirect  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a>  |  <code>redirect</code>
Redis  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Redis/RedisManager.html">Illuminate\Redis\RedisManager</a>  |  <code>redis</code>
Redis (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Redis/Connections/Connection.html">Illuminate\Redis\Connections\Connection</a>  |  <code>redis.connection</code>
Request  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Request.html">Illuminate\Http\Request</a>  |  <code>request</code>
Response  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a>  |  &nbsp;
Response (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Http/Response.html">Illuminate\Http\Response</a>  |  &nbsp;
Route  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a>  |  <code>router</code>
Schema  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Database/Schema/Builder.html">Illuminate\Database\Schema\Builder</a>  |  &nbsp;
Session  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a>  |  <code>session</code>
Session (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Session/Store.html">Illuminate\Session\Store</a>  |  <code>session.store</code>
Storage  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Filesystem/FilesystemManager.html">Illuminate\Filesystem\FilesystemManager</a>  |  <code>filesystem</code>
Storage (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Contracts/Filesystem/Filesystem.html">Illuminate\Contracts\Filesystem\Filesystem</a>  |  <code>filesystem.disk</code>
URL  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a>  |  <code>url</code>
Validator  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a>  |  <code>validator</code>
Validator (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a>  |  &nbsp;
View  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/Factory.html">Illuminate\View\Factory</a>  |  <code>view</code>
View (Instance)  |  <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/View/View.html">Illuminate\View\View</a>  |  &nbsp;</p>
<div style="page-break-after: always;" ></div><h1>File Storage</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#the-public-disk">The Public Disk</a></li>
<li><a href="#the-local-driver">The Local Driver</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
<li><a href="#caching">Caching</a></li>
</ul></li>
<li><a href="#obtaining-disk-instances">Obtaining Disk Instances</a></li>
<li><a href="#retrieving-files">Retrieving Files</a>

<ul>
<li><a href="#downloading-files">Downloading Files</a></li>
<li><a href="#file-urls">File URLs</a></li>
<li><a href="#file-metadata">File Metadata</a></li>
</ul></li>
<li><a href="#storing-files">Storing Files</a>

<ul>
<li><a href="#file-uploads">File Uploads</a></li>
<li><a href="#file-visibility">File Visibility</a></li>
</ul></li>
<li><a href="#deleting-files">Deleting Files</a></li>
<li><a href="#directories">Directories</a></li>
<li><a href="#custom-filesystems">Custom Filesystems</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a powerful filesystem abstraction thanks to the wonderful <a href="https://github.com/thephpleague/flysystem">Flysystem</a> PHP package by Frank de Jonge. The Laravel Flysystem integration provides simple to use drivers for working with local filesystems and Amazon S3. Even better, it&#39;s amazingly simple to switch between these storage options as the API remains the same for each system.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The filesystem configuration file is located at <code>config/filesystems.php</code>. Within this file you may configure all of your &quot;disks&quot;. Each disk represents a particular storage driver and storage location. Example configurations for each supported driver are included in the configuration file. So, modify the configuration to reflect your storage preferences and credentials.</p>

<p>You may configure as many disks as you like, and may even have multiple disks that use the same driver.</p>

<p><a name="the-public-disk"></a></p>

<h3>The Public Disk</h3>

<p>The <code>public</code> disk is intended for files that are going to be publicly accessible. By default, the <code>public</code> disk uses the <code>local</code> driver and stores these files in <code>storage/app/public</code>. To make them accessible from the web, you should create a symbolic link from <code>public/storage</code> to <code>storage/app/public</code>. This convention will keep your publicly accessible files in one directory that can be easily shared across deployments when using zero down-time deployment systems like <a href="https://envoyer.io">Envoyer</a>.</p>

<p>To create the symbolic link, you may use the <code>storage:link</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">storage</span><span class="o">:</span><span class="nx">link</span>
</pre></div>

<p>Once a file has been stored and the symbolic link has been created, you can create a URL to the files using the <code>asset</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;storage/file.txt&#39;</span><span class="p">);</span>
</pre></div>

<p>You may configure additional symbolic links in your <code>filesystems</code> configuration file. Each of the configured links will be created when you run the <code>storage:link</code> command:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;links&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/public&#39;</span><span class="p">),</span>
    <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/images&#39;</span><span class="p">),</span>
<span class="p">],</span>
</pre></div>

<p><a name="the-local-driver"></a></p>

<h3>The Local Driver</h3>

<p>When using the <code>local</code> driver, all file operations are relative to the <code>root</code> directory defined in your <code>filesystems</code> configuration file. By default, this value is set to the <code>storage/app</code> directory. Therefore, the following method would store a file in <code>storage/app/file.txt</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;Contents&#39;</span><span class="p">);</span>
</pre></div>

<h4>Permissions</h4>

<p>The <code>public</code> <a href="#file-visibility">visibility</a> translates to <code>0755</code> for directories and <code>0644</code> for files. You can modify the permissions mappings in your <code>filesystems</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;local&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="s1">&#39;root&#39;</span> <span class="p">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">),</span>
    <span class="s1">&#39;permissions&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;file&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;public&#39;</span> <span class="p">=&gt;</span> <span class="mi">0664</span><span class="p">,</span>
            <span class="s1">&#39;private&#39;</span> <span class="p">=&gt;</span> <span class="mi">0600</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;dir&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;public&#39;</span> <span class="p">=&gt;</span> <span class="mi">0775</span><span class="p">,</span>
            <span class="s1">&#39;private&#39;</span> <span class="p">=&gt;</span> <span class="mi">0700</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Composer Packages</h4>

<p>Before using the SFTP or S3 drivers, you will need to install the appropriate package via Composer:</p>

<ul>
<li>SFTP: <code>league/flysystem-sftp ~1.0</code></li>
<li>Amazon S3: <code>league/flysystem-aws-s3-v3 ~1.0</code></li>
</ul>

<p>An absolute must for performance is to use a cached adapter. You will need an additional package for this:</p>

<ul>
<li>CachedAdapter: <code>league/flysystem-cached-adapter ~1.0</code></li>
</ul>

<h4>S3 Driver Configuration</h4>

<p>The S3 driver configuration information is located in your <code>config/filesystems.php</code> configuration file. This file contains an example configuration array for an S3 driver. You are free to modify this array with your own S3 configuration and credentials. For convenience, these environment variables match the naming convention used by the AWS CLI.</p>

<h4>FTP Driver Configuration</h4>

<p>Laravel&#39;s Flysystem integrations works great with FTP; however, a sample configuration is not included with the framework&#39;s default <code>filesystems.php</code> configuration file. If you need to configure a FTP filesystem, you may use the example configuration below:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;ftp&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ftp.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-username&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-password&#39;</span><span class="p">,</span>

    <span class="c1">// Optional FTP Settings...</span>
    <span class="c1">// &#39;port&#39; =&gt; 21,</span>
    <span class="c1">// &#39;root&#39; =&gt; &#39;&#39;,</span>
    <span class="c1">// &#39;passive&#39; =&gt; true,</span>
    <span class="c1">// &#39;ssl&#39; =&gt; true,</span>
    <span class="c1">// &#39;timeout&#39; =&gt; 30,</span>
<span class="p">],</span>
</pre></div>

<h4>SFTP Driver Configuration</h4>

<p>Laravel&#39;s Flysystem integrations works great with SFTP; however, a sample configuration is not included with the framework&#39;s default <code>filesystems.php</code> configuration file. If you need to configure a SFTP filesystem, you may use the example configuration below:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;sftp&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sftp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-username&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-password&#39;</span><span class="p">,</span>

    <span class="c1">// Settings for SSH key based authentication...</span>
    <span class="c1">// &#39;privateKey&#39; =&gt; &#39;/path/to/privateKey&#39;,</span>
    <span class="c1">// &#39;password&#39; =&gt; &#39;encryption-password&#39;,</span>

    <span class="c1">// Optional SFTP Settings...</span>
    <span class="c1">// &#39;port&#39; =&gt; 22,</span>
    <span class="c1">// &#39;root&#39; =&gt; &#39;&#39;,</span>
    <span class="c1">// &#39;timeout&#39; =&gt; 30,</span>
<span class="p">],</span>
</pre></div>

<p><a name="caching"></a></p>

<h3>Caching</h3>

<p>To enable caching for a given disk, you may add a <code>cache</code> directive to the disk&#39;s configuration options. The <code>cache</code> option should be an array of caching options containing the <code>disk</code> name, the <code>expire</code> time in seconds, and the cache <code>prefix</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;s3&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>

    <span class="c1">// Other Disk Options...</span>

    <span class="s1">&#39;cache&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;store&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;memcached&#39;</span><span class="p">,</span>
        <span class="s1">&#39;expire&#39;</span> <span class="p">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
        <span class="s1">&#39;prefix&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;cache-prefix&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="obtaining-disk-instances"></a></p>

<h2>Obtaining Disk Instances</h2>

<p>The <code>Storage</code> facade may be used to interact with any of your configured disks. For example, you may use the <code>put</code> method on the facade to store an avatar on the default disk. If you call methods on the <code>Storage</code> facade without first calling the <code>disk</code> method, the method call will automatically be passed to the default disk:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;avatars/1&#39;</span><span class="p">,</span> <span class="nx">$fileContents</span><span class="p">);</span>
</pre></div>

<p>If your application interacts with multiple disks, you may use the <code>disk</code> method on the <code>Storage</code> facade to work with files on a particular disk:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;avatars/1&#39;</span><span class="p">,</span> <span class="nx">$fileContents</span><span class="p">);</span>
</pre></div>

<p><a name="retrieving-files"></a></p>

<h2>Retrieving Files</h2>

<p>The <code>get</code> method may be used to retrieve the contents of a file. The raw string contents of the file will be returned by the method. Remember, all file paths should be specified relative to the &quot;root&quot; location configured for the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">$contents</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>exists</code> method may be used to determine if a file exists on the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">$exists</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>missing</code> method may be used to determine if a file is missing from the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">$missing</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">missing</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="downloading-files"></a></p>

<h3>Downloading Files</h3>

<p>The <code>download</code> method may be used to generate a response that forces the user&#39;s browser to download the file at the given path. The <code>download</code> method accepts a file name as the second argument to the method, which will determine the file name that is seen by the user downloading the file. Finally, you may pass an array of HTTP headers as the third argument to the method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">download</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">download</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<p><a name="file-urls"></a></p>

<h3>File URLs</h3>

<p>You may use the <code>url</code> method to get the URL for the given file. If you are using the <code>local</code> driver, this will typically just prepend <code>/storage</code> to the given path and return a relative URL to the file. If you are using the <code>s3</code> driver, the fully qualified remote URL will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">url</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} Remember, if you are using the <code>local</code> driver, all files that should be publicly accessible should be placed in the <code>storage/app/public</code> directory. Furthermore, you should <a href="#the-public-disk">create a symbolic link</a> at <code>public/storage</code> which points to the <code>storage/app/public</code> directory.</p>
</blockquote>

<h4>Temporary URLs</h4>

<p>For files stored using the <code>s3</code> you may create a temporary URL to a given file using the <code>temporaryUrl</code> method. This method accepts a path and a <code>DateTime</code> instance specifying when the URL should expire:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">temporaryUrl</span><span class="p">(</span>
    <span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<p>If you need to specify additional <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectGET.html#RESTObjectGET-requests">S3 request parameters</a>, you may pass the array of request parameters as the third argument to the <code>temporaryUrl</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">temporaryUrl</span><span class="p">(</span>
    <span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span>
    <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="s1">&#39;ResponseContentType&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<h4>URL Host Customization</h4>

<p>If you would like to pre-define the host for file URLs generated using the <code>Storage</code> facade, you may add a <code>url</code> option to the disk&#39;s configuration array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;public&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
    <span class="s1">&#39;root&#39;</span> <span class="p">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/public&#39;</span><span class="p">),</span>
    <span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_URL&#39;</span><span class="p">).</span><span class="s1">&#39;/storage&#39;</span><span class="p">,</span>
    <span class="s1">&#39;visibility&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="file-metadata"></a></p>

<h3>File Metadata</h3>

<p>In addition to reading and writing files, Laravel can also provide information about the files themselves. For example, the <code>size</code> method may be used to get the size of the file in bytes:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">$size</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">size</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>lastModified</code> method returns the UNIX timestamp of the last time the file was modified:</p>
<div class="highlight"><pre><span></span><span class="nx">$time</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">lastModified</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="storing-files"></a></p>

<h2>Storing Files</h2>

<p>The <code>put</code> method may be used to store raw file contents on a disk. You may also pass a PHP <code>resource</code> to the <code>put</code> method, which will use Flysystem&#39;s underlying stream support. Remember, all file paths should be specified relative to the &quot;root&quot; location configured for the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$contents</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$resource</span><span class="p">);</span>
</pre></div>

<h4>Automatic Streaming</h4>

<p>If you would like Laravel to automatically manage streaming a given file to your storage location, you may use the <code>putFile</code> or <code>putFileAs</code> method. This method accepts either a <code>Illuminate\Http\File</code> or <code>Illuminate\Http\UploadedFile</code> instance and will automatically stream the file to your desired location:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">File</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="c1">// Automatically generate a unique ID for file name...</span>
<span class="nx">Storage</span><span class="o">::</span><span class="nx">putFile</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="s1">&#39;/path/to/photo&#39;</span><span class="p">));</span>

<span class="c1">// Manually specify a file name...</span>
<span class="nx">Storage</span><span class="o">::</span><span class="nx">putFileAs</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="s1">&#39;/path/to/photo&#39;</span><span class="p">),</span> <span class="s1">&#39;photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>There are a few important things to note about the <code>putFile</code> method. Note that we only specified a directory name, not a file name. By default, the <code>putFile</code> method will generate a unique ID to serve as the file name. The file&#39;s extension will be determined by examining the file&#39;s MIME type. The path to the file will be returned by the <code>putFile</code> method so you can store the path, including the generated file name, in your database.</p>

<p>The <code>putFile</code> and <code>putFileAs</code> methods also accept an argument to specify the &quot;visibility&quot; of the stored file. This is particularly useful if you are storing the file on a cloud disk such as S3 and would like the file to be publicly accessible:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">putFile</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="s1">&#39;/path/to/photo&#39;</span><span class="p">),</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</pre></div>

<h4>Prepending &amp; Appending To Files</h4>

<p>The <code>prepend</code> and <code>append</code> methods allow you to write to the beginning or end of a file:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Prepended Text&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file.log&#39;</span><span class="p">,</span> <span class="s1">&#39;Appended Text&#39;</span><span class="p">);</span>
</pre></div>

<h4>Copying &amp; Moving Files</h4>

<p>The <code>copy</code> method may be used to copy an existing file to a new location on the disk, while the <code>move</code> method may be used to rename or move an existing file to a new location:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;old/file.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file.jpg&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">move</span><span class="p">(</span><span class="s1">&#39;old/file.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;new/file.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="file-uploads"></a></p>

<h3>File Uploads</h3>

<p>In web applications, one of the most common use-cases for storing files is storing user uploaded files such as profile pictures, photos, and documents. Laravel makes it very easy to store uploaded files using the <code>store</code> method on an uploaded file instance. Call the <code>store</code> method with the path at which you wish to store the uploaded file:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserAvatarController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the avatar for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$path</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>There are a few important things to note about this example. Note that we only specified a directory name, not a file name. By default, the <code>store</code> method will generate a unique ID to serve as the file name. The file&#39;s extension will be determined by examining the file&#39;s MIME type. The path to the file will be returned by the <code>store</code> method so you can store the path, including the generated file name, in your database.</p>

<p>You may also call the <code>putFile</code> method on the <code>Storage</code> facade to perform the same file manipulation as the example above:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">putFile</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">));</span>
</pre></div>

<h4>Specifying A File Name</h4>

<p>If you would not like a file name to be automatically assigned to your stored file, you may use the <code>storeAs</code> method, which receives the path, the file name, and the (optional) disk as its arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">storeAs</span><span class="p">(</span>
    <span class="s1">&#39;avatars&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span>
<span class="p">);</span>
</pre></div>

<p>You may also use the <code>putFileAs</code> method on the <code>Storage</code> facade, which will perform the same file manipulation as the example above:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">putFileAs</span><span class="p">(</span>
    <span class="s1">&#39;avatars&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">),</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} Unprintable and invalid unicode characters will automatically be removed from file paths. Therefore, you may wish to sanitize your file paths before passing them to Laravel&#39;s file storage methods. File paths are normalized using the <code>League\Flysystem\Util::normalizePath</code> method.</p>
</blockquote>

<h4>Specifying A Disk</h4>

<p>By default, this method will use your default disk. If you would like to specify another disk, pass the disk name as the second argument to the <code>store</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">store</span><span class="p">(</span>
    <span class="s1">&#39;avatars/&#39;</span><span class="p">.</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span>
<span class="p">);</span>
</pre></div>

<p>If you are using the <code>storeAs</code> method, you may pass the disk name as the third argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">storeAs</span><span class="p">(</span>
    <span class="s1">&#39;avatars&#39;</span><span class="p">,</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
    <span class="s1">&#39;s3&#39;</span>
<span class="p">);</span>
</pre></div>

<h4>Other File Information</h4>

<p>If you would like to get original name of the uploaded file, you may do so using the <code>getClientOriginalName</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">getClientOriginalName</span><span class="p">();</span>
</pre></div>

<p>The <code>extension</code> method may be used to get the file extension of the uploaded file:</p>
<div class="highlight"><pre><span></span><span class="nx">$extension</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">extension</span><span class="p">();</span>
</pre></div>

<p><a name="file-visibility"></a></p>

<h3>File Visibility</h3>

<p>In Laravel&#39;s Flysystem integration, &quot;visibility&quot; is an abstraction of file permissions across multiple platforms. Files may either be declared <code>public</code> or <code>private</code>. When a file is declared <code>public</code>, you are indicating that the file should generally be accessible to others. For example, when using the S3 driver, you may retrieve URLs for <code>public</code> files.</p>

<p>You can set the visibility when setting the file via the <code>put</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="nx">$contents</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</pre></div>

<p>If the file has already been stored, its visibility can be retrieved and set via the <code>getVisibility</code> and <code>setVisibility</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$visibility</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">getVisibility</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">setVisibility</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</pre></div>

<p>When interacting with uploaded files, you may use the <code>storePublicly</code> and <code>storePubliclyAs</code> methods to store the uploaded file with <code>public</code> visibility:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">storePublicly</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">);</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">storePubliclyAs</span><span class="p">(</span>
    <span class="s1">&#39;avatars&#39;</span><span class="p">,</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
    <span class="s1">&#39;s3&#39;</span>
<span class="p">);</span>
</pre></div>

<p><a name="deleting-files"></a></p>

<h2>Deleting Files</h2>

<p>The <code>delete</code> method accepts a single filename or an array of files to remove from the disk:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">);</span>

<span class="nx">Storage</span><span class="o">::</span><span class="k">delete</span><span class="p">([</span><span class="s1">&#39;file.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;file2.jpg&#39;</span><span class="p">]);</span>
</pre></div>

<p>If necessary, you may specify the disk that the file should be deleted from:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">Storage</span><span class="o">::</span><span class="nx">disk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;folder_path/file_name.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="directories"></a></p>

<h2>Directories</h2>

<h4>Get All Files Within A Directory</h4>

<p>The <code>files</code> method returns an array of all of the files in a given directory. If you would like to retrieve a list of all files within a given directory including all subdirectories, you may use the <code>allFiles</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Storage</span><span class="p">;</span>

<span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">files</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="nx">$files</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allFiles</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Get All Directories Within A Directory</h4>

<p>The <code>directories</code> method returns an array of all the directories within a given directory. Additionally, you may use the <code>allDirectories</code> method to get a list of all directories within a given directory and all of its subdirectories:</p>
<div class="highlight"><pre><span></span><span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">directories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>

<span class="c1">// Recursive...</span>
<span class="nx">$directories</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="nx">allDirectories</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Create A Directory</h4>

<p>The <code>makeDirectory</code> method will create the given directory, including any needed subdirectories:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">makeDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<h4>Delete A Directory</h4>

<p>Finally, the <code>deleteDirectory</code> method may be used to remove a directory and all of its files:</p>
<div class="highlight"><pre><span></span><span class="nx">Storage</span><span class="o">::</span><span class="nx">deleteDirectory</span><span class="p">(</span><span class="nx">$directory</span><span class="p">);</span>
</pre></div>

<p><a name="custom-filesystems"></a></p>

<h2>Custom Filesystems</h2>

<p>Laravel&#39;s Flysystem integration provides drivers for several &quot;drivers&quot; out of the box; however, Flysystem is not limited to these and has adapters for many other storage systems. You can create a custom driver if you want to use one of these additional adapters in your Laravel application.</p>

<p>In order to set up the custom filesystem you will need a Flysystem adapter. Let&#39;s add a community maintained Dropbox adapter to our project:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">spatie</span><span class="o">/</span><span class="nx">flysystem</span><span class="o">-</span><span class="nx">dropbox</span>
</pre></div>

<p>Next, you should create a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> such as <code>DropboxServiceProvider</code>. In the provider&#39;s <code>boot</code> method, you may use the <code>Storage</code> facade&#39;s <code>extend</code> method to define the custom driver:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">League\Flysystem\Filesystem</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\Dropbox\Client</span> <span class="k">as</span> <span class="nx">DropboxClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\FlysystemDropbox\DropboxAdapter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DropboxServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;dropbox&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DropboxClient</span><span class="p">(</span>
                <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;authorization_token&#39;</span><span class="p">]</span>
            <span class="p">);</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">Filesystem</span><span class="p">(</span><span class="k">new</span> <span class="nx">DropboxAdapter</span><span class="p">(</span><span class="nv">$client</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument of the <code>extend</code> method is the name of the driver and the second is a Closure that receives the <code>$app</code> and <code>$config</code> variables. The resolver Closure must return an instance of <code>League\Flysystem\Filesystem</code>. The <code>$config</code> variable contains the values defined in <code>config/filesystems.php</code> for the specified disk.</p>

<p>Next, register the service provider in your <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="nx">App</span><span class="err">\</span><span class="nx">Providers</span><span class="err">\</span><span class="nx">DropboxServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Once you have created and registered the extension&#39;s service provider, you may use the <code>dropbox</code> driver in your <code>config/filesystems.php</code> configuration file.</p>
<div style="page-break-after: always;" ></div><h1>JavaScript &amp; CSS Scaffolding</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-css">Writing CSS</a></li>
<li><a href="#writing-javascript">Writing JavaScript</a>

<ul>
<li><a href="#writing-vue-components">Writing Vue Components</a></li>
<li><a href="#using-react">Using React</a></li>
</ul></li>
<li><a href="#adding-presets">Adding Presets</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>While Laravel does not dictate which JavaScript or CSS pre-processors you use, it does provide a basic starting point using <a href="https://getbootstrap.com/">Bootstrap</a>, <a href="https://reactjs.org/">React</a>, and / or <a href="https://vuejs.org/">Vue</a> that will be helpful for many applications. By default, Laravel uses <a href="https://www.npmjs.org">NPM</a> to install both of these frontend packages.</p>

<p>The Bootstrap and Vue scaffolding provided by Laravel is located in the <code>laravel/ui</code> Composer package, which may be installed using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>
</pre></div>

<p>Once the <code>laravel/ui</code> package has been installed, you may install the frontend scaffolding using the <code>ui</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="c1">// Generate basic scaffolding...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">bootstrap</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">react</span>

<span class="c1">// Generate login / registration scaffolding...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">bootstrap</span> <span class="o">--</span><span class="nx">auth</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span> <span class="o">--</span><span class="nx">auth</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">react</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<h4>CSS</h4>

<p><a href="/docs/%7B%7Bversion%7D%7D/mix">Laravel Mix</a> provides a clean, expressive API over compiling SASS or Less, which are extensions of plain CSS that add variables, mixins, and other powerful features that make working with CSS much more enjoyable. In this document, we will briefly discuss CSS compilation in general; however, you should consult the full <a href="/docs/%7B%7Bversion%7D%7D/mix">Laravel Mix documentation</a> for more information on compiling SASS or Less.</p>

<h4>JavaScript</h4>

<p>Laravel does not require you to use a specific JavaScript framework or library to build your applications. In fact, you don&#39;t have to use JavaScript at all. However, Laravel does include some basic scaffolding to make it easier to get started writing modern JavaScript using the <a href="https://vuejs.org">Vue</a> library. Vue provides an expressive API for building robust JavaScript applications using components. As with CSS, we may use Laravel Mix to easily compile JavaScript components into a single, browser-ready JavaScript file.</p>

<p><a name="writing-css"></a></p>

<h2>Writing CSS</h2>

<p>After installing the <code>laravel/ui</code> Composer package and <a href="#introduction">generating the frontend scaffolding</a>, Laravel&#39;s <code>package.json</code> file will include the <code>bootstrap</code> package to help you get started prototyping your application&#39;s frontend using Bootstrap. However, feel free to add or remove packages from the <code>package.json</code> file as needed for your own application. You are not required to use the Bootstrap framework to build your Laravel application - it is provided as a good starting point for those who choose to use it.</p>

<p>Before compiling your CSS, install your project&#39;s frontend dependencies using the <a href="https://www.npmjs.org">Node package manager (NPM)</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

<p>Once the dependencies have been installed using <code>npm install</code>, you can compile your SASS files to plain CSS using <a href="/docs/%7B%7Bversion%7D%7D/mix#working-with-stylesheets">Laravel Mix</a>. The <code>npm run dev</code> command will process the instructions in your <code>webpack.mix.js</code> file. Typically, your compiled CSS will be placed in the <code>public/css</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">dev</span>
</pre></div>

<p>The <code>webpack.mix.js</code> file included with Laravel&#39;s frontend scaffolding will compile the <code>resources/sass/app.scss</code> SASS file. This <code>app.scss</code> file imports a file of SASS variables and loads Bootstrap, which provides a good starting point for most applications. Feel free to customize the <code>app.scss</code> file however you wish or even use an entirely different pre-processor by <a href="/docs/%7B%7Bversion%7D%7D/mix">configuring Laravel Mix</a>.</p>

<p><a name="writing-javascript"></a></p>

<h2>Writing JavaScript</h2>

<p>All of the JavaScript dependencies required by your application can be found in the <code>package.json</code> file in the project&#39;s root directory. This file is similar to a <code>composer.json</code> file except it specifies JavaScript dependencies instead of PHP dependencies. You can install these dependencies using the <a href="https://www.npmjs.org">Node package manager (NPM)</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

<blockquote>
<p>{tip} By default, the Laravel <code>package.json</code> file includes a few packages such as <code>lodash</code> and <code>axios</code> to help you get started building your JavaScript application. Feel free to add or remove from the <code>package.json</code> file as needed for your own application.</p>
</blockquote>

<p>Once the packages are installed, you can use the <code>npm run dev</code> command to <a href="/docs/%7B%7Bversion%7D%7D/mix">compile your assets</a>. Webpack is a module bundler for modern JavaScript applications. When you run the <code>npm run dev</code> command, Webpack will execute the instructions in your <code>webpack.mix.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">dev</span>
</pre></div>

<p>By default, the Laravel <code>webpack.mix.js</code> file compiles your SASS and the <code>resources/js/app.js</code> file. Within the <code>app.js</code> file you may register your Vue components or, if you prefer a different framework, configure your own JavaScript application. Your compiled JavaScript will typically be placed in the <code>public/js</code> directory.</p>

<blockquote>
<p>{tip} The <code>app.js</code> file will load the <code>resources/js/bootstrap.js</code> file which bootstraps and configures Vue, Axios, jQuery, and all other JavaScript dependencies. If you have additional JavaScript dependencies to configure, you may do so in this file.</p>
</blockquote>

<p><a name="writing-vue-components"></a></p>

<h3>Writing Vue Components</h3>

<p>When using the <code>laravel/ui</code> package to scaffold your frontend, an <code>ExampleComponent.vue</code> Vue component will be placed in the <code>resources/js/components</code> directory. The <code>ExampleComponent.vue</code> file is an example of a <a href="https://vuejs.org/guide/single-file-components">single file Vue component</a> which defines its JavaScript and HTML template in the same file. Single file components provide a very convenient approach to building JavaScript driven applications. The example component is registered in your <code>app.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span>
    <span class="s1">&#39;example-component&#39;</span><span class="p">,</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./components/ExampleComponent.vue&#39;</span><span class="p">).</span><span class="k">default</span>
<span class="p">);</span>
</pre></div>

<p>To use the component in your application, you may drop it into one of your HTML templates. For example, after running the <code>php artisan ui vue --auth</code> Artisan command to scaffold your application&#39;s authentication and registration screens, you could drop the component into the <code>home.blade.php</code> Blade template:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="kr">extends</span><span class="p">(</span><span class="s1">&#39;layouts.app&#39;</span><span class="p">)</span>

<span class="err">@</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">example</span><span class="o">-</span><span class="nx">component</span><span class="o">&gt;&lt;</span><span class="err">/example-component&gt;</span>
<span class="err">@</span><span class="nx">endsection</span>
</pre></div>

<blockquote>
<p>{tip} Remember, you should run the <code>npm run dev</code> command each time you change a Vue component. Or, you may run the <code>npm run watch</code> command to monitor and automatically recompile your components each time they are modified.</p>
</blockquote>

<p>If you are interested in learning more about writing Vue components, you should read the <a href="https://vuejs.org/guide/">Vue documentation</a>, which provides a thorough, easy-to-read overview of the entire Vue framework.</p>

<p><a name="using-react"></a></p>

<h3>Using React</h3>

<p>If you prefer to use React to build your JavaScript application, Laravel makes it a cinch to swap the Vue scaffolding with React scaffolding:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="c1">// Generate basic scaffolding...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">react</span>

<span class="c1">// Generate login / registration scaffolding...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">react</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p><a name="adding-presets"></a></p>

<h2>Adding Presets</h2>

<p>Presets are &quot;macroable&quot;, which allows you to add additional methods to the <code>UiCommand</code> class at runtime. For example, the following code adds a <code>nextjs</code> method to the <code>UiCommand</code> class. Typically, you should declare preset macros in a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Ui</span><span class="err">\</span><span class="nx">UiCommand</span><span class="p">;</span>

<span class="nx">UiCommand</span><span class="o">::</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;nextjs&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">UiCommand</span> <span class="nx">$command</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Scaffold your frontend...</span>
<span class="p">});</span>
</pre></div>

<p>Then, you may call the new preset via the <code>ui</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">nextjs</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Hashing</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The Laravel <code>Hash</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> provides secure Bcrypt and Argon2 hashing for storing user passwords. If you are using the built-in <code>LoginController</code> and <code>RegisterController</code> classes that are included with your Laravel application, they will use Bcrypt for registration and authentication by default.</p>

<blockquote>
<p>{tip} Bcrypt is a great choice for hashing passwords because its &quot;work factor&quot; is adjustable, which means that the time it takes to generate a hash can be increased as hardware power increases.</p>
</blockquote>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>The default hashing driver for your application is configured in the <code>config/hashing.php</code> configuration file. There are currently three supported drivers: <a href="https://en.wikipedia.org/wiki/Bcrypt">Bcrypt</a> and <a href="https://en.wikipedia.org/wiki/Argon2">Argon2</a> (Argon2i and Argon2id variants).</p>

<blockquote>
<p>{note} The Argon2i driver requires PHP 7.2.0 or greater and the Argon2id driver requires PHP 7.3.0 or greater.</p>
</blockquote>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p>You may hash a password by calling the <code>make</code> method on the <code>Hash</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UpdatePasswordController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the password for the user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validate the new password length...</span>

        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">newPassword</span><span class="p">)</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Adjusting The Bcrypt Work Factor</h4>

<p>If you are using the Bcrypt algorithm, the <code>make</code> method allows you to manage the work factor of the algorithm using the <code>rounds</code> option; however, the default is acceptable for most applications:</p>
<div class="highlight"><pre><span></span><span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;rounds&#39;</span> <span class="p">=&gt;</span> <span class="mi">12</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>Adjusting The Argon2 Work Factor</h4>

<p>If you are using the Argon2 algorithm, the <code>make</code> method allows you to manage the work factor of the algorithm using the <code>memory</code>, <code>time</code>, and <code>threads</code> options; however, the defaults are acceptable for most applications:</p>
<div class="highlight"><pre><span></span><span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;memory&#39;</span> <span class="p">=&gt;</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="s1">&#39;time&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;threads&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<blockquote>
<p>{tip} For more information on these options, check out the <a href="https://secure.php.net/manual/en/function.password-hash.php">official PHP documentation</a>.</p>
</blockquote>

<h4>Verifying A Password Against A Hash</h4>

<p>The <code>check</code> method allows you to verify that a given plain-text string corresponds to a given hash. However, if you are using the <code>LoginController</code> <a href="/docs/%7B%7Bversion%7D%7D/authentication">included with Laravel</a>, you will probably not need to use this directly, as this controller automatically calls this method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="s1">&#39;plain-text&#39;</span><span class="p">,</span> <span class="nx">$hashedPassword</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// The passwords match...</span>
<span class="p">}</span>
</pre></div>

<h4>Checking If A Password Needs To Be Rehashed</h4>

<p>The <code>needsRehash</code> function allows you to determine if the work factor used by the hasher has changed since the password was hashed:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Hash</span><span class="o">::</span><span class="nx">needsRehash</span><span class="p">(</span><span class="nx">$hashed</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">$hashed</span> <span class="o">=</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;plain-text&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Helpers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#available-methods">Available Methods</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel includes a variety of global &quot;helper&quot; PHP functions. Many of these functions are used by the framework itself; however, you are free to use them in your own applications if you find them convenient.</p>

<p><a name="available-methods"></a></p>

<h2>Available Methods</h2>

<style>
    .collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    .collection-method-list a {
        display: block;
    }
</style>

<h3>Arrays &amp; Objects</h3>

<div class="collection-method-list" markdown="1">

[Arr::accessible](#method-array-accessible)
[Arr::add](#method-array-add)
[Arr::collapse](#method-array-collapse)
[Arr::crossJoin](#method-array-crossjoin)
[Arr::divide](#method-array-divide)
[Arr::dot](#method-array-dot)
[Arr::except](#method-array-except)
[Arr::exists](#method-array-exists)
[Arr::first](#method-array-first)
[Arr::flatten](#method-array-flatten)
[Arr::forget](#method-array-forget)
[Arr::get](#method-array-get)
[Arr::has](#method-array-has)
[Arr::hasAny](#method-array-hasany)
[Arr::isAssoc](#method-array-isassoc)
[Arr::last](#method-array-last)
[Arr::only](#method-array-only)
[Arr::pluck](#method-array-pluck)
[Arr::prepend](#method-array-prepend)
[Arr::pull](#method-array-pull)
[Arr::query](#method-array-query)
[Arr::random](#method-array-random)
[Arr::set](#method-array-set)
[Arr::shuffle](#method-array-shuffle)
[Arr::sort](#method-array-sort)
[Arr::sortRecursive](#method-array-sort-recursive)
[Arr::where](#method-array-where)
[Arr::wrap](#method-array-wrap)
[data_fill](#method-data-fill)
[data_get](#method-data-get)
[data_set](#method-data-set)
[head](#method-head)
[last](#method-last)
</div>

<h3>Paths</h3>

<div class="collection-method-list" markdown="1">

[app_path](#method-app-path)
[base_path](#method-base-path)
[config_path](#method-config-path)
[database_path](#method-database-path)
[mix](#method-mix)
[public_path](#method-public-path)
[resource_path](#method-resource-path)
[storage_path](#method-storage-path)

</div>

<h3>Strings</h3>

<div class="collection-method-list" markdown="1">

[\__](#method-__)
[class_basename](#method-class-basename)
[e](#method-e)
[preg_replace_array](#method-preg-replace-array)
[Str::after](#method-str-after)
[Str::afterLast](#method-str-after-last)
[Str::ascii](#method-str-ascii)
[Str::before](#method-str-before)
[Str::beforeLast](#method-str-before-last)
[Str::between](#method-str-between)
[Str::camel](#method-camel-case)
[Str::contains](#method-str-contains)
[Str::containsAll](#method-str-contains-all)
[Str::endsWith](#method-ends-with)
[Str::finish](#method-str-finish)
[Str::is](#method-str-is)
[Str::isAscii](#method-str-is-ascii)
[Str::isUuid](#method-str-is-uuid)
[Str::kebab](#method-kebab-case)
[Str::length](#method-str-length)
[Str::limit](#method-str-limit)
[Str::lower](#method-str-lower)
[Str::orderedUuid](#method-str-ordered-uuid)
[Str::padBoth](#method-str-padboth)
[Str::padLeft](#method-str-padleft)
[Str::padRight](#method-str-padright)
[Str::plural](#method-str-plural)
[Str::random](#method-str-random)
[Str::replaceArray](#method-str-replace-array)
[Str::replaceFirst](#method-str-replace-first)
[Str::replaceLast](#method-str-replace-last)
[Str::singular](#method-str-singular)
[Str::slug](#method-str-slug)
[Str::snake](#method-snake-case)
[Str::start](#method-str-start)
[Str::startsWith](#method-starts-with)
[Str::studly](#method-studly-case)
[Str::substr](#method-str-substr)
[Str::title](#method-title-case)
[Str::ucfirst](#method-str-ucfirst)
[Str::upper](#method-str-upper)
[Str::uuid](#method-str-uuid)
[Str::words](#method-str-words)
[trans](#method-trans)
[trans_choice](#method-trans-choice)

</div>

<p><a name="fluent-strings"></a></p>

<h3>Fluent Strings</h3>

<div class="collection-method-list" markdown="1">

[after](#method-fluent-str-after)
[afterLast](#method-fluent-str-after-last)
[append](#method-fluent-str-append)
[ascii](#method-fluent-str-ascii)
[basename](#method-fluent-str-basename)
[before](#method-fluent-str-before)
[beforeLast](#method-fluent-str-before-last)
[camel](#method-fluent-str-camel)
[contains](#method-fluent-str-contains)
[containsAll](#method-fluent-str-contains-all)
[dirname](#method-fluent-str-dirname)
[endsWith](#method-fluent-str-ends-with)
[exactly](#method-fluent-str-exactly)
[explode](#method-fluent-str-explode)
[finish](#method-fluent-str-finish)
[is](#method-fluent-str-is)
[isAscii](#method-fluent-str-is-ascii)
[isEmpty](#method-fluent-str-is-empty)
[isNotEmpty](#method-fluent-str-is-not-empty)
[kebab](#method-fluent-str-kebab)
[length](#method-fluent-str-length)
[limit](#method-fluent-str-limit)
[lower](#method-fluent-str-lower)
[ltrim](#method-fluent-str-ltrim)
[match](#method-fluent-str-match)
[matchAll](#method-fluent-str-match-all)
[padBoth](#method-fluent-str-padboth)
[padLeft](#method-fluent-str-padleft)
[padRight](#method-fluent-str-padright)
[plural](#method-fluent-str-plural)
[prepend](#method-fluent-str-prepend)
[replace](#method-fluent-str-replace)
[replaceArray](#method-fluent-str-replace-array)
[replaceFirst](#method-fluent-str-replace-first)
[replaceLast](#method-fluent-str-replace-last)
[replaceMatches](#method-fluent-str-replace-matches)
[rtrim](#method-fluent-str-rtrim)
[singular](#method-fluent-str-singular)
[slug](#method-fluent-str-slug)
[snake](#method-fluent-str-snake)
[split](#method-fluent-str-split)
[start](#method-fluent-str-start)
[startsWith](#method-fluent-str-starts-with)
[studly](#method-fluent-str-studly)
[substr](#method-fluent-str-substr)
[title](#method-fluent-str-title)
[trim](#method-fluent-str-trim)
[ucfirst](#method-fluent-str-ucfirst)
[upper](#method-fluent-str-upper)
[when](#method-fluent-str-when)
[whenEmpty](#method-fluent-str-when-empty)
[words](#method-fluent-str-words)

</div>

<h3>URLs</h3>

<div class="collection-method-list" markdown="1">

[action](#method-action)
[asset](#method-asset)
[route](#method-route)
[secure_asset](#method-secure-asset)
[secure_url](#method-secure-url)
[url](#method-url)

</div>

<h3>Miscellaneous</h3>

<div class="collection-method-list" markdown="1">

[abort](#method-abort)
[abort_if](#method-abort-if)
[abort_unless](#method-abort-unless)
[app](#method-app)
[auth](#method-auth)
[back](#method-back)
[bcrypt](#method-bcrypt)
[blank](#method-blank)
[broadcast](#method-broadcast)
[cache](#method-cache)
[class_uses_recursive](#method-class-uses-recursive)
[collect](#method-collect)
[config](#method-config)
[cookie](#method-cookie)
[csrf_field](#method-csrf-field)
[csrf_token](#method-csrf-token)
[dd](#method-dd)
[dispatch](#method-dispatch)
[dispatch_now](#method-dispatch-now)
[dump](#method-dump)
[env](#method-env)
[event](#method-event)
[factory](#method-factory)
[filled](#method-filled)
[info](#method-info)
[logger](#method-logger)
[method_field](#method-method-field)
[now](#method-now)
[old](#method-old)
[optional](#method-optional)
[policy](#method-policy)
[redirect](#method-redirect)
[report](#method-report)
[request](#method-request)
[rescue](#method-rescue)
[resolve](#method-resolve)
[response](#method-response)
[retry](#method-retry)
[session](#method-session)
[tap](#method-tap)
[throw_if](#method-throw-if)
[throw_unless](#method-throw-unless)
[today](#method-today)
[trait_uses_recursive](#method-trait-uses-recursive)
[transform](#method-transform)
[validator](#method-validator)
[value](#method-value)
[view](#method-view)
[with](#method-with)

</div>

<p><a name="method-listing"></a></p>

<h2>Method Listing</h2>

<style>
    #collection-method code {
        font-size: 14px;
    }

    #collection-method:not(.first-collection-method) {
        margin-top: 50px;
    }
</style>

<p><a name="arrays"></a></p>

<h2>Arrays &amp; Objects</h2>

<p><a name="method-array-accessible"></a></p>

<h4><code>Arr::accessible()</code> {#collection-method .first-collection-method}</h4>

<p>The <code>Arr::accessible</code> method checks that the given value is array accessible:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Collection</span><span class="p">;</span>

<span class="nx">$isAccessible</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">accessible</span><span class="p">([</span><span class="s1">&#39;a&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>

<span class="c1">// true</span>

<span class="nx">$isAccessible</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">accessible</span><span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$isAccessible</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">accessible</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span>

<span class="c1">// false</span>

<span class="nx">$isAccessible</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">accessible</span><span class="p">(</span><span class="k">new</span> <span class="nx">stdClass</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-array-add"></a></p>

<h4><code>Arr::add()</code> {#collection-method}</h4>

<p>The <code>Arr::add</code> method adds a given key / value pair to an array if the given key doesn&#39;t already exist in the array or is set to <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">add</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">add</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">],</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-collapse"></a></p>

<h4><code>Arr::collapse()</code> {#collection-method}</h4>

<p>The <code>Arr::collapse</code> method collapses an array of arrays into a single array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">collapse</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]);</span>

<span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</pre></div>

<p><a name="method-array-crossjoin"></a></p>

<h4><code>Arr::crossJoin()</code> {#collection-method}</h4>

<p>The <code>Arr::crossJoin</code> method cross joins the given arrays, returning a Cartesian product with all possible permutations:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$matrix</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">crossJoin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [1, &#39;a&#39;],</span>
<span class="cm">        [1, &#39;b&#39;],</span>
<span class="cm">        [2, &#39;a&#39;],</span>
<span class="cm">        [2, &#39;b&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>

<span class="nx">$matrix</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">crossJoin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;II&#39;</span><span class="p">]);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [1, &#39;a&#39;, &#39;I&#39;],</span>
<span class="cm">        [1, &#39;a&#39;, &#39;II&#39;],</span>
<span class="cm">        [1, &#39;b&#39;, &#39;I&#39;],</span>
<span class="cm">        [1, &#39;b&#39;, &#39;II&#39;],</span>
<span class="cm">        [2, &#39;a&#39;, &#39;I&#39;],</span>
<span class="cm">        [2, &#39;a&#39;, &#39;II&#39;],</span>
<span class="cm">        [2, &#39;b&#39;, &#39;I&#39;],</span>
<span class="cm">        [2, &#39;b&#39;, &#39;II&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-array-divide"></a></p>

<h4><code>Arr::divide()</code> {#collection-method}</h4>

<p>The <code>Arr::divide</code> method returns two arrays, one containing the keys, and the other containing the values of the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="p">[</span><span class="nx">$keys</span><span class="p">,</span> <span class="nx">$values</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">divide</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">]);</span>

<span class="c1">// $keys: [&#39;name&#39;]</span>

<span class="c1">// $values: [&#39;Desk&#39;]</span>
</pre></div>

<p><a name="method-array-dot"></a></p>

<h4><code>Arr::dot()</code> {#collection-method}</h4>

<p>The <code>Arr::dot</code> method flattens a multi-dimensional array into a single level array that uses &quot;dot&quot; notation to indicate depth:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">dot</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;products.desk.price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-except"></a></p>

<h4><code>Arr::except()</code> {#collection-method}</h4>

<p>The <code>Arr::except</code> method removes the given key / value pairs from an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">except</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;]</span>
</pre></div>

<p><a name="method-array-exists"></a></p>

<h4><code>Arr::exists()</code> {#collection-method}</h4>

<p>The <code>Arr::exists</code> method checks that the given key exists in the provided array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="p">=&gt;</span> <span class="mi">17</span><span class="p">];</span>

<span class="nx">$exists</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$exists</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;salary&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-array-first"></a></p>

<h4><code>Arr::first()</code> {#collection-method}</h4>

<p>The <code>Arr::first</code> method returns the first element of an array passing a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$first</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 200</span>
</pre></div>

<p>A default value may also be passed as the third parameter to the method. This value will be returned if no value passes the truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$first</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">first</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p><a name="method-array-flatten"></a></p>

<h4><code>Arr::flatten()</code> {#collection-method}</h4>

<p>The <code>Arr::flatten</code> method flattens a multi-dimensional array into a single level array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">]];</span>

<span class="nx">$flattened</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;Joe&#39;, &#39;PHP&#39;, &#39;Ruby&#39;]</span>
</pre></div>

<p><a name="method-array-forget"></a></p>

<h4><code>Arr::forget()</code> {#collection-method}</h4>

<p>The <code>Arr::forget</code> method removes a given key / value pair from a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">Arr</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; []]</span>
</pre></div>

<p><a name="method-array-get"></a></p>

<h4><code>Arr::get()</code> {#collection-method}</h4>

<p>The <code>Arr::get</code> method retrieves a value from a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">);</span>

<span class="c1">// 100</span>
</pre></div>

<p>The <code>Arr::get</code> method also accepts a default value, which will be returned if the specific key is not found:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$discount</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk.discount&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// 0</span>
</pre></div>

<p><a name="method-array-has"></a></p>

<h4><code>Arr::has()</code> {#collection-method}</h4>

<p>The <code>Arr::has</code> method checks whether a given item or items exists in an array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]];</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;product.name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">has</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;product.price&#39;</span><span class="p">,</span> <span class="s1">&#39;product.discount&#39;</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-array-hasany"></a></p>

<h4><code>Arr::hasAny()</code> {#collection-method}</h4>

<p>The <code>Arr::hasAny</code> method checks whether any item in a given set exists in an array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]];</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">hasAny</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;product.name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">hasAny</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;product.name&#39;</span><span class="p">,</span> <span class="s1">&#39;product.discount&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">hasAny</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;product.discount&#39;</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-array-isassoc"></a></p>

<h4><code>Arr::isAssoc()</code> {#collection-method}</h4>

<p>The <code>Arr::isAssoc</code> returns <code>true</code> if the given array is an associative array. An array is considered &quot;associative&quot; if it doesn&#39;t have sequential numerical keys beginning with zero:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$isAssoc</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">isAssoc</span><span class="p">([</span><span class="s1">&#39;product&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]);</span>

<span class="c1">// true</span>

<span class="nx">$isAssoc</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">isAssoc</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-array-last"></a></p>

<h4><code>Arr::last()</code> {#collection-method}</h4>

<p>The <code>Arr::last</code> method returns the last element of an array passing a given truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">110</span><span class="p">];</span>

<span class="nx">$last</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">&gt;=</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 300</span>
</pre></div>

<p>A default value may be passed as the third argument to the method. This value will be returned if no value passes the truth test:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$last</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">last</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p><a name="method-array-only"></a></p>

<h4><code>Arr::only()</code> {#collection-method}</h4>

<p>The <code>Arr::only</code> method returns only the specified key / value pairs from the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;orders&#39;</span> <span class="p">=&gt;</span> <span class="mi">10</span><span class="p">];</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">only</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-pluck"></a></p>

<h4><code>Arr::pluck()</code> {#collection-method}</h4>

<p>The <code>Arr::pluck</code> method retrieves all of the values for a given key from an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;developer&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">]],</span>
<span class="p">];</span>

<span class="nx">$names</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;Taylor&#39;, &#39;Abigail&#39;]</span>
</pre></div>

<p>You may also specify how you wish the resulting list to be keyed:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$names</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;developer.name&#39;</span><span class="p">,</span> <span class="s1">&#39;developer.id&#39;</span><span class="p">);</span>

<span class="c1">// [1 =&gt; &#39;Taylor&#39;, 2 =&gt; &#39;Abigail&#39;]</span>
</pre></div>

<p><a name="method-array-prepend"></a></p>

<h4><code>Arr::prepend()</code> {#collection-method}</h4>

<p>The <code>Arr::prepend</code> method will push an item onto the beginning of an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;zero&#39;, &#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;]</span>
</pre></div>

<p>If needed, you may specify the key that should be used for the value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;name&#39; =&gt; &#39;Desk&#39;, &#39;price&#39; =&gt; 100]</span>
</pre></div>

<p><a name="method-array-pull"></a></p>

<h4><code>Arr::pull()</code> {#collection-method}</h4>

<p>The <code>Arr::pull</code> method returns and removes a key / value pair from an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">];</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// $name: Desk</span>

<span class="c1">// $array: [&#39;price&#39; =&gt; 100]</span>
</pre></div>

<p>A default value may be passed as the third argument to the method. This value will be returned if the key doesn&#39;t exist:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">pull</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="nx">$key</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p><a name="method-array-query"></a></p>

<h4><code>Arr::query()</code> {#collection-method}</h4>

<p>The <code>Arr::query</code> method converts the array into a query string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;column&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;desc&#39;</span><span class="p">]];</span>

<span class="nx">Arr</span><span class="o">::</span><span class="nx">query</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// name=Taylor&amp;order[column]=created_at&amp;order[direction]=desc</span>
</pre></div>

<p><a name="method-array-random"></a></p>

<h4><code>Arr::random()</code> {#collection-method}</h4>

<p>The <code>Arr::random</code> method returns a random value from an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="nx">$random</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// 4 - (retrieved randomly)</span>
</pre></div>

<p>You may also specify the number of items to return as an optional second argument. Note that providing this argument will return an array, even if only one item is desired:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$items</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// [2, 5] - (retrieved randomly)</span>
</pre></div>

<p><a name="method-array-set"></a></p>

<h4><code>Arr::set()</code> {#collection-method}</h4>

<p>The <code>Arr::set</code> method sets a value within a deeply nested array using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">Arr</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 200]]]</span>
</pre></div>

<p><a name="method-array-shuffle"></a></p>

<h4><code>Arr::shuffle()</code> {#collection-method}</h4>

<p>The <code>Arr::shuffle</code> method randomly shuffles the items in the array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">shuffle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="c1">// [3, 2, 5, 1, 4] - (generated randomly)</span>
</pre></div>

<p><a name="method-array-sort"></a></p>

<h4><code>Arr::sort()</code> {#collection-method}</h4>

<p>The <code>Arr::sort</code> method sorts an array by its values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Desk&#39;</span><span class="p">,</span> <span class="s1">&#39;Table&#39;</span><span class="p">,</span> <span class="s1">&#39;Chair&#39;</span><span class="p">];</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">sort</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// [&#39;Chair&#39;, &#39;Desk&#39;, &#39;Table&#39;]</span>
</pre></div>

<p>You may also sort the array by the results of the given Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Table&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Chair&#39;</span><span class="p">],</span>
<span class="p">];</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nx">Arr</span><span class="o">::</span><span class="nx">sort</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="p">}));</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Chair&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Desk&#39;],</span>
<span class="cm">        [&#39;name&#39; =&gt; &#39;Table&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-array-sort-recursive"></a></p>

<h4><code>Arr::sortRecursive()</code> {#collection-method}</h4>

<p>The <code>Arr::sortRecursive</code> method recursively sorts an array using the <code>sort</code> function for numeric sub=arrays and <code>ksort</code> for associative subarrays:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;Li&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;JavaScript&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;one&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">];</span>

<span class="nx">$sorted</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">sortRecursive</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        [&#39;JavaScript&#39;, &#39;PHP&#39;, &#39;Ruby&#39;],</span>
<span class="cm">        [&#39;one&#39; =&gt; 1, &#39;three&#39; =&gt; 3, &#39;two&#39; =&gt; 2],</span>
<span class="cm">        [&#39;Li&#39;, &#39;Roman&#39;, &#39;Taylor&#39;],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-array-where"></a></p>

<h4><code>Arr::where()</code> {#collection-method}</h4>

<p>The <code>Arr::where</code> method filters an array using the given Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">];</span>

<span class="nx">$filtered</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="nx">$array</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">is_string</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// [1 =&gt; &#39;200&#39;, 3 =&gt; &#39;400&#39;]</span>
</pre></div>

<p><a name="method-array-wrap"></a></p>

<h4><code>Arr::wrap()</code> {#collection-method}</h4>

<p>The <code>Arr::wrap</code> method wraps the given value in an array. If the given value is already an array it will not be changed:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">$string</span><span class="p">);</span>

<span class="c1">// [&#39;Laravel&#39;]</span>
</pre></div>

<p>If the given value is null, an empty array will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Arr</span><span class="p">;</span>

<span class="nx">$nothing</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nx">$array</span> <span class="o">=</span> <span class="nx">Arr</span><span class="o">::</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">$nothing</span><span class="p">);</span>

<span class="c1">// []</span>
</pre></div>

<p><a name="method-data-fill"></a></p>

<h4><code>data_fill()</code> {#collection-method}</h4>

<p>The <code>data_fill</code> function sets a missing value within a nested array or object using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">data_fill</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 100]]]</span>

<span class="nx">data_fill</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.discount&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 100, &#39;discount&#39; =&gt; 10]]]</span>
</pre></div>

<p>This function also accepts asterisks as wildcards and will fill the target accordingly:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 1&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 2&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>

<span class="nx">data_fill</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.*.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;products&#39; =&gt; [</span>
<span class="cm">            [&#39;name&#39; =&gt; &#39;Desk 1&#39;, &#39;price&#39; =&gt; 100],</span>
<span class="cm">            [&#39;name&#39; =&gt; &#39;Desk 2&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p><a name="method-data-get"></a></p>

<h4><code>data_get()</code> {#collection-method}</h4>

<p>The <code>data_get</code> function retrieves a value from a nested array or object using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">data_get</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">);</span>

<span class="c1">// 100</span>
</pre></div>

<p>The <code>data_get</code> function also accepts a default value, which will be returned if the specified key is not found:</p>
<div class="highlight"><pre><span></span><span class="nx">$discount</span> <span class="o">=</span> <span class="nx">data_get</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.discount&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// 0</span>
</pre></div>

<p>The function also accepts wildcards using asterisks, which may target any key of the array or object:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;product-one&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 1&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;product-two&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 2&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
<span class="p">];</span>

<span class="nx">data_get</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;*.name&#39;</span><span class="p">);</span>

<span class="c1">// [&#39;Desk 1&#39;, &#39;Desk 2&#39;];</span>
</pre></div>

<p><a name="method-data-set"></a></p>

<h4><code>data_set()</code> {#collection-method}</h4>

<p>The <code>data_set</code> function sets a value within a nested array or object using &quot;dot&quot; notation:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">data_set</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 200]]]</span>
</pre></div>

<p>This function also accepts wildcards and will set values on the target accordingly:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 1&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Desk 2&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>

<span class="nx">data_set</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.*.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    [</span>
<span class="cm">        &#39;products&#39; =&gt; [</span>
<span class="cm">            [&#39;name&#39; =&gt; &#39;Desk 1&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">            [&#39;name&#39; =&gt; &#39;Desk 2&#39;, &#39;price&#39; =&gt; 200],</span>
<span class="cm">        ],</span>
<span class="cm">    ]</span>
<span class="cm">*/</span>
</pre></div>

<p>By default, any existing values are overwritten. If you wish to only set a value if it doesn&#39;t exist, you may pass <code>false</code> as the fourth argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;products&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;desk&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">]]];</span>

<span class="nx">data_set</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="s1">&#39;products.desk.price&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// [&#39;products&#39; =&gt; [&#39;desk&#39; =&gt; [&#39;price&#39; =&gt; 100]]]</span>
</pre></div>

<p><a name="method-head"></a></p>

<h4><code>head()</code> {#collection-method}</h4>

<p>The <code>head</code> function returns the first element in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$first</span> <span class="o">=</span> <span class="nx">head</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// 100</span>
</pre></div>

<p><a name="method-last"></a></p>

<h4><code>last()</code> {#collection-method}</h4>

<p>The <code>last</code> function returns the last element in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nx">$last</span> <span class="o">=</span> <span class="nx">last</span><span class="p">(</span><span class="nx">$array</span><span class="p">);</span>

<span class="c1">// 300</span>
</pre></div>

<p><a name="paths"></a></p>

<h2>Paths</h2>

<p><a name="method-app-path"></a></p>

<h4><code>app_path()</code> {#collection-method}</h4>

<p>The <code>app_path</code> function returns the fully qualified path to the <code>app</code> directory. You may also use the <code>app_path</code> function to generate a fully qualified path to a file relative to the application directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">app_path</span><span class="p">(</span><span class="s1">&#39;Http/Controllers/Controller.php&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-base-path"></a></p>

<h4><code>base_path()</code> {#collection-method}</h4>

<p>The <code>base_path</code> function returns the fully qualified path to the project root. You may also use the <code>base_path</code> function to generate a fully qualified path to a given file relative to the project root directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">base_path</span><span class="p">(</span><span class="s1">&#39;vendor/bin&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-config-path"></a></p>

<h4><code>config_path()</code> {#collection-method}</h4>

<p>The <code>config_path</code> function returns the fully qualified path to the <code>config</code> directory. You may also use the <code>config_path</code> function to generate a fully qualified path to a given file within the application&#39;s configuration directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">config_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;app.php&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-database-path"></a></p>

<h4><code>database_path()</code> {#collection-method}</h4>

<p>The <code>database_path</code> function returns the fully qualified path to the <code>database</code> directory. You may also use the <code>database_path</code> function to generate a fully qualified path to a given file within the database directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">database_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">database_path</span><span class="p">(</span><span class="s1">&#39;factories/UserFactory.php&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-mix"></a></p>

<h4><code>mix()</code> {#collection-method}</h4>

<p>The <code>mix</code> function returns the path to a <a href="/docs/%7B%7Bversion%7D%7D/mix">versioned Mix file</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">mix</span><span class="p">(</span><span class="s1">&#39;css/app.css&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-public-path"></a></p>

<h4><code>public_path()</code> {#collection-method}</h4>

<p>The <code>public_path</code> function returns the fully qualified path to the <code>public</code> directory. You may also use the <code>public_path</code> function to generate a fully qualified path to a given file within the public directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;css/app.css&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-resource-path"></a></p>

<h4><code>resource_path()</code> {#collection-method}</h4>

<p>The <code>resource_path</code> function returns the fully qualified path to the <code>resources</code> directory. You may also use the <code>resource_path</code> function to generate a fully qualified path to a given file within the resources directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">resource_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">resource_path</span><span class="p">(</span><span class="s1">&#39;sass/app.scss&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-storage-path"></a></p>

<h4><code>storage_path()</code> {#collection-method}</h4>

<p>The <code>storage_path</code> function returns the fully qualified path to the <code>storage</code> directory. You may also use the <code>storage_path</code> function to generate a fully qualified path to a given file within the storage directory:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">();</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;app/file.txt&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="strings"></a></p>

<h2>Strings</h2>

<p><a name="method-__"></a></p>

<h4><code>__()</code> {#collection-method}</h4>

<p>The <code>__</code> function translates the given translation string or translation key using your <a href="/docs/%7B%7Bversion%7D%7D/localization">localization files</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Welcome to our application&#39;</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<p>If the specified translation string or key does not exist, the <code>__</code> function will return the given value. So, using the example above, the <code>__</code> function would return <code>messages.welcome</code> if that translation key does not exist.</p>

<p><a name="method-class-basename"></a></p>

<h4><code>class_basename()</code> {#collection-method}</h4>

<p>The <code>class_basename</code> function returns the class name of the given class with the class&#39;s namespace removed:</p>
<div class="highlight"><pre><span></span><span class="nx">$class</span> <span class="o">=</span> <span class="nx">class_basename</span><span class="p">(</span><span class="s1">&#39;Foo\Bar\Baz&#39;</span><span class="p">);</span>

<span class="c1">// Baz</span>
</pre></div>

<p><a name="method-e"></a></p>

<h4><code>e()</code> {#collection-method}</h4>

<p>The <code>e</code> function runs PHP&#39;s <code>htmlspecialchars</code> function with the <code>double_encode</code> option set to <code>true</code> by default:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">e</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;foo&lt;/html&gt;&#39;</span><span class="p">);</span>

<span class="c1">// &amp;lt;html&amp;gt;foo&amp;lt;/html&amp;gt;</span>
</pre></div>

<p><a name="method-preg-replace-array"></a></p>

<h4><code>preg_replace_array()</code> {#collection-method}</h4>

<p>The <code>preg_replace_array</code> function replaces a given pattern in the string sequentially using an array:</p>
<div class="highlight"><pre><span></span><span class="nx">$string</span> <span class="o">=</span> <span class="s1">&#39;The event will take place between :start and :end&#39;</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">preg_replace_array</span><span class="p">(</span><span class="s1">&#39;/:[a-z_]+/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;8:30&#39;</span><span class="p">,</span> <span class="s1">&#39;9:00&#39;</span><span class="p">],</span> <span class="nx">$string</span><span class="p">);</span>

<span class="c1">// The event will take place between 8:30 and 9:00</span>
</pre></div>

<p><a name="method-str-after"></a></p>

<h4><code>Str::after()</code> {#collection-method}</h4>

<p>The <code>Str::after</code> method returns everything after the given value in a string. The entire string will be returned if the value does not exist within the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This is&#39;</span><span class="p">);</span>

<span class="c1">// &#39; my name&#39;</span>
</pre></div>

<p><a name="method-str-after-last"></a></p>

<h4><code>Str::afterLast()</code> {#collection-method}</h4>

<p>The <code>Str::afterLast</code> method returns everything after the last occurrence of the given value in a string. The entire string will be returned if the value does not exist within the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">afterLast</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\Controller&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Controller&#39;</span>
</pre></div>

<p><a name="method-str-ascii"></a></p>

<h4><code>Str::ascii()</code> {#collection-method}</h4>

<p>The <code>Str::ascii</code> method will attempt to transliterate the string into an ASCII value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">ascii</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="c1">// &#39;u&#39;</span>
</pre></div>

<p><a name="method-str-before"></a></p>

<h4><code>Str::before()</code> {#collection-method}</h4>

<p>The <code>Str::before</code> method returns everything before the given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;my name&#39;</span><span class="p">);</span>

<span class="c1">// &#39;This is &#39;</span>
</pre></div>

<p><a name="method-str-before-last"></a></p>

<h4><code>Str::beforeLast()</code> {#collection-method}</h4>

<p>The <code>Str::beforeLast</code> method returns everything before the last occurrence of the given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">beforeLast</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">);</span>

<span class="c1">// &#39;This &#39;</span>
</pre></div>

<p><a name="method-str-between"></a></p>

<h4><code>Str::between()</code> {#collection-method}</h4>

<p>The <code>Str::between</code> method returns the portion of a string between two values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">between</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// &#39; is my &#39;</span>
</pre></div>

<p><a name="method-camel-case"></a></p>

<h4><code>Str::camel()</code> {#collection-method}</h4>

<p>The <code>Str::camel</code> method converts the given string to <code>camelCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">camel</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// fooBar</span>
</pre></div>

<p><a name="method-str-contains"></a></p>

<h4><code>Str::contains()</code> {#collection-method}</h4>

<p>The <code>Str::contains</code> method determines if the given string contains the given value (case sensitive):</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p>You may also pass an array of values to determine if the given string contains any of the values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-str-contains-all"></a></p>

<h4><code>Str::containsAll()</code> {#collection-method}</h4>

<p>The <code>Str::containsAll</code> method determines if the given string contains all array values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$containsAll</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">containsAll</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-ends-with"></a></p>

<h4><code>Str::endsWith()</code> {#collection-method}</h4>

<p>The <code>Str::endsWith</code> method determines if the given string ends with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p>You may also pass an array of values to determine if the given string ends with any of the given values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-str-finish"></a></p>

<h4><code>Str::finish()</code> {#collection-method}</h4>

<p>The <code>Str::finish</code> method adds a single instance of the given value to a string if it does not already end with the value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">finish</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">finish</span><span class="p">(</span><span class="s1">&#39;this/string/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>
</pre></div>

<p><a name="method-str-is"></a></p>

<h4><code>Str::is()</code> {#collection-method}</h4>

<p>The <code>Str::is</code> method determines if a given string matches a given pattern. Asterisks may be used to indicate wildcards:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$matches</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;foo*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$matches</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;baz*&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-str-is-ascii"></a></p>

<h4><code>Str::isAscii()</code> {#collection-method}</h4>

<p>The <code>Str::isAscii</code> method determines if a given string is 7 bit ASCII:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$isAscii</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">isAscii</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$isAscii</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">isAscii</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-str-is-uuid"></a></p>

<h4><code>Str::isUuid()</code> {#collection-method}</h4>

<p>The <code>Str::isUuid</code> method determines if the given string is a valid UUID:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$isUuid</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">isUuid</span><span class="p">(</span><span class="s1">&#39;a0a2a2d2-0b87-4a18-83f2-2529882be2de&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$isUuid</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">isUuid</span><span class="p">(</span><span class="s1">&#39;laravel&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-kebab-case"></a></p>

<h4><code>Str::kebab()</code> {#collection-method}</h4>

<p>The <code>Str::kebab</code> method converts the given string to <code>kebab-case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">kebab</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">);</span>

<span class="c1">// foo-bar</span>
</pre></div>

<p><a name="method-str-length"></a></p>

<h4><code>Str::length()</code> {#collection-method}</h4>

<p>The <code>Str::length</code> method returns the length of the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$length</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">length</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

<span class="c1">// 7</span>
</pre></div>

<p><a name="method-str-limit"></a></p>

<h4><code>Str::limit()</code> {#collection-method}</h4>

<p>The <code>Str::limit</code> method truncates the given string at the specified length:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$truncated</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">limit</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="c1">// The quick brown fox...</span>
</pre></div>

<p>You may also pass a third argument to change the string that will be appended to the end:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$truncated</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">limit</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39; (...)&#39;</span><span class="p">);</span>

<span class="c1">// The quick brown fox (...)</span>
</pre></div>

<p><a name="method-str-lower"></a></p>

<h4><code>Str::lower()</code> {#collection-method}</h4>

<p>The <code>Str::lower</code> method converts the given string to lowercase:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">lower</span><span class="p">(</span><span class="s1">&#39;LARAVEL&#39;</span><span class="p">);</span>

<span class="c1">// laravel</span>
</pre></div>

<p><a name="method-str-ordered-uuid"></a></p>

<h4><code>Str::orderedUuid()</code> {#collection-method}</h4>

<p>The <code>Str::orderedUuid</code> method generates a &quot;timestamp first&quot; UUID that may be efficiently stored in an indexed database column:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">orderedUuid</span><span class="p">();</span>
</pre></div>

<p><a name="method-str-padboth"></a></p>

<h4><code>Str::padBoth()</code> {#collection-method}</h4>

<p>The <code>Str::padBoth</code> method wraps PHP&#39;s <code>str_pad</code> function, padding both sides of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padBoth</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">);</span>

<span class="c1">// &#39;__James___&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padBoth</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;  James   &#39;</span>
</pre></div>

<p><a name="method-str-padleft"></a></p>

<h4><code>Str::padLeft()</code> {#collection-method}</h4>

<p>The <code>Str::padLeft</code> method wraps PHP&#39;s <code>str_pad</code> function, padding the left side of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padLeft</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;-=&#39;</span><span class="p">);</span>

<span class="c1">// &#39;-=-=-James&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padLeft</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;     James&#39;</span>
</pre></div>

<p><a name="method-str-padright"></a></p>

<h4><code>Str::padRight()</code> {#collection-method}</h4>

<p>The <code>Str::padRight</code> method wraps PHP&#39;s <code>str_pad</code> function, padding the right side of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padRight</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// &#39;James-----&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">padRight</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;James     &#39;</span>
</pre></div>

<p><a name="method-str-plural"></a></p>

<h4><code>Str::plural()</code> {#collection-method}</h4>

<p>The <code>Str::plural</code> method converts a single word string to its plural form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">plural</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">);</span>

<span class="c1">// cars</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">);</span>

<span class="c1">// children</span>
</pre></div>

<p>You may provide an integer as a second argument to the function to retrieve the singular or plural form of the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// children</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">plural</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// child</span>
</pre></div>

<p><a name="method-str-random"></a></p>

<h4><code>Str::random()</code> {#collection-method}</h4>

<p>The <code>Str::random</code> method generates a random string of the specified length. This function uses PHP&#39;s <code>random_bytes</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$random</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
</pre></div>

<p><a name="method-str-replace-array"></a></p>

<h4><code>Str::replaceArray()</code> {#collection-method}</h4>

<p>The <code>Str::replaceArray</code> method replaces a given value in the string sequentially using an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="s1">&#39;The event will take place between ? and ?&#39;</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">replaceArray</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;8:30&#39;</span><span class="p">,</span> <span class="s1">&#39;9:00&#39;</span><span class="p">],</span> <span class="nx">$string</span><span class="p">);</span>

<span class="c1">// The event will take place between 8:30 and 9:00</span>
</pre></div>

<p><a name="method-str-replace-first"></a></p>

<h4><code>Str::replaceFirst()</code> {#collection-method}</h4>

<p>The <code>Str::replaceFirst</code> method replaces the first occurrence of a given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">replaceFirst</span><span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;the quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>

<span class="c1">// a quick brown fox jumps over the lazy dog</span>
</pre></div>

<p><a name="method-str-replace-last"></a></p>

<h4><code>Str::replaceLast()</code> {#collection-method}</h4>

<p>The <code>Str::replaceLast</code> method replaces the last occurrence of a given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">replaceLast</span><span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;the quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>

<span class="c1">// the quick brown fox jumps over a lazy dog</span>
</pre></div>

<p><a name="method-str-singular"></a></p>

<h4><code>Str::singular()</code> {#collection-method}</h4>

<p>The <code>Str::singular</code> method converts a string to its singular form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$singular</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">singular</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">);</span>

<span class="c1">// car</span>

<span class="nx">$singular</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">singular</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">);</span>

<span class="c1">// child</span>
</pre></div>

<p><a name="method-str-slug"></a></p>

<h4><code>Str::slug()</code> {#collection-method}</h4>

<p>The <code>Str::slug</code> method generates a URL friendly &quot;slug&quot; from the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slug</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">slug</span><span class="p">(</span><span class="s1">&#39;Laravel 5 Framework&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// laravel-5-framework</span>
</pre></div>

<p><a name="method-snake-case"></a></p>

<h4><code>Str::snake()</code> {#collection-method}</h4>

<p>The <code>Str::snake</code> method converts the given string to <code>snake_case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">snake</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">);</span>

<span class="c1">// foo_bar</span>
</pre></div>

<p><a name="method-str-start"></a></p>

<h4><code>Str::start()</code> {#collection-method}</h4>

<p>The <code>Str::start</code> method adds a single instance of the given value to a string if it does not already start with the value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// /this/string</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;/this/string&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// /this/string</span>
</pre></div>

<p><a name="method-starts-with"></a></p>

<h4><code>Str::startsWith()</code> {#collection-method}</h4>

<p>The <code>Str::startsWith</code> method determines if the given string begins with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">,</span> <span class="s1">&#39;This&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-studly-case"></a></p>

<h4><code>Str::studly()</code> {#collection-method}</h4>

<p>The <code>Str::studly</code> method converts the given string to <code>StudlyCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">studly</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">);</span>

<span class="c1">// FooBar</span>
</pre></div>

<p><a name="method-str-substr"></a></p>

<h4><code>Str::substr()</code> {#collection-method}</h4>

<p>The <code>Str::substr</code> method returns the portion of string specified by the start and length parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">substr</span><span class="p">(</span><span class="s1">&#39;The Laravel Framework&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="c1">// Laravel</span>
</pre></div>

<p><a name="method-title-case"></a></p>

<h4><code>Str::title()</code> {#collection-method}</h4>

<p>The <code>Str::title</code> method converts the given string to <code>Title Case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">title</span><span class="p">(</span><span class="s1">&#39;a nice title uses the correct case&#39;</span><span class="p">);</span>

<span class="c1">// A Nice Title Uses The Correct Case</span>
</pre></div>

<p><a name="method-str-ucfirst"></a></p>

<h4><code>Str::ucfirst()</code> {#collection-method}</h4>

<p>The <code>Str::ucfirst</code> method returns the given string with the first character capitalized:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">ucfirst</span><span class="p">(</span><span class="s1">&#39;foo bar&#39;</span><span class="p">);</span>

<span class="c1">// Foo bar</span>
</pre></div>

<p><a name="method-str-upper"></a></p>

<h4><code>Str::upper()</code> {#collection-method}</h4>

<p>The <code>Str::upper</code> method converts the given string to uppercase:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">upper</span><span class="p">(</span><span class="s1">&#39;laravel&#39;</span><span class="p">);</span>

<span class="c1">// LARAVEL</span>
</pre></div>

<p><a name="method-str-uuid"></a></p>

<h4><code>Str::uuid()</code> {#collection-method}</h4>

<p>The <code>Str::uuid</code> method generates a UUID (version 4):</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">uuid</span><span class="p">();</span>
</pre></div>

<p><a name="method-str-words"></a></p>

<h4><code>Str::words()</code> {#collection-method}</h4>

<p>The <code>Str::words</code> method limits the number of words in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">words</span><span class="p">(</span><span class="s1">&#39;Perfectly balanced, as all things should be.&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; &gt;&gt;&gt;&#39;</span><span class="p">);</span>

<span class="c1">// Perfectly balanced, as &gt;&gt;&gt;</span>
</pre></div>

<p><a name="method-trans"></a></p>

<h4><code>trans()</code> {#collection-method}</h4>

<p>The <code>trans</code> function translates the given translation key using your <a href="/docs/%7B%7Bversion%7D%7D/localization">localization files</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<p>If the specified translation key does not exist, the <code>trans</code> function will return the given key. So, using the example above, the <code>trans</code> function would return <code>messages.welcome</code> if the translation key does not exist.</p>

<p><a name="method-trans-choice"></a></p>

<h4><code>trans_choice()</code> {#collection-method}</h4>

<p>The <code>trans_choice</code> function translates the given translation key with inflection:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;messages.notifications&#39;</span><span class="p">,</span> <span class="nx">$unreadCount</span><span class="p">);</span>
</pre></div>

<p>If the specified translation key does not exist, the <code>trans_choice</code> function will return the given key. So, using the example above, the <code>trans_choice</code> function would return <code>messages.notifications</code> if the translation key does not exist.</p>

<p><a name="fluent-strings"></a></p>

<h2>Fluent Strings</h2>

<p>Fluent strings provide a more fluent, object-oriented interface for working with string values, allowing you to chain multiple string operations together using a more readable syntax compared to traditional string operations.</p>

<p><a name="method-fluent-str-after"></a></p>

<h4><code>after</code> {#collection-method}</h4>

<p>The <code>after</code> method returns everything after the given value in a string. The entire string will be returned if the value does not exist within the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="s1">&#39;This is&#39;</span><span class="p">);</span>

<span class="c1">// &#39; my name&#39;</span>
</pre></div>

<p><a name="method-fluent-str-after-last"></a></p>

<h4><code>afterLast</code> {#collection-method}</h4>

<p>The <code>afterLast</code> method returns everything after the last occurrence of the given value in a string. The entire string will be returned if the value does not exist within the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;App\Http\Controllers\Controller&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">afterLast</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Controller&#39;</span>
</pre></div>

<p><a name="method-fluent-str-append"></a></p>

<h4><code>append</code> {#collection-method}</h4>

<p>The <code>append</code> method appends the given values to the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39; Otwell&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Taylor Otwell&#39;</span>
</pre></div>

<p><a name="method-fluent-str-ascii"></a></p>

<h4><code>ascii</code> {#collection-method}</h4>

<p>The <code>ascii</code> method will attempt to transliterate the string into an ASCII value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ascii</span><span class="p">();</span>

<span class="c1">// &#39;u&#39;</span>
</pre></div>

<p><a name="method-fluent-str-basename"></a></p>

<h4><code>basename</code> {#collection-method}</h4>

<p>The <code>basename</code> method will return the trailing name component of the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/foo/bar/baz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">basename</span><span class="p">();</span>

<span class="c1">// &#39;baz&#39;</span>
</pre></div>

<p>If needed, you may provide an &quot;extension&quot; that will be removed from the trailing component:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/foo/bar/baz.jpg&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">basename</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">);</span>

<span class="c1">// &#39;baz&#39;</span>
</pre></div>

<p><a name="method-fluent-str-before"></a></p>

<h4><code>before</code> {#collection-method}</h4>

<p>The <code>before</code> method returns everything before the given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">before</span><span class="p">(</span><span class="s1">&#39;my name&#39;</span><span class="p">);</span>

<span class="c1">// &#39;This is &#39;</span>
</pre></div>

<p><a name="method-fluent-str-before-last"></a></p>

<h4><code>beforeLast</code> {#collection-method}</h4>

<p>The <code>beforeLast</code> method returns everything before the last occurrence of the given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slice</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">beforeLast</span><span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">);</span>

<span class="c1">// &#39;This &#39;</span>
</pre></div>

<p><a name="method-fluent-str-camel"></a></p>

<h4><code>camel</code> {#collection-method}</h4>

<p>The <code>camel</code> method converts the given string to <code>camelCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">camel</span><span class="p">();</span>

<span class="c1">// fooBar</span>
</pre></div>

<p><a name="method-fluent-str-contains"></a></p>

<h4><code>contains</code> {#collection-method}</h4>

<p>The <code>contains</code> method determines if the given string contains the given value (case sensitive):</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;my&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p>You may also pass an array of values to determine if the given string contains any of the values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$contains</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">([</span><span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-fluent-str-contains-all"></a></p>

<h4><code>containsAll</code> {#collection-method}</h4>

<p>The <code>containsAll</code> method determines if the given string contains all array values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$containsAll</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">containsAll</span><span class="p">([</span><span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-fluent-str-dirname"></a></p>

<h4><code>dirname</code> {#collection-method}</h4>

<p>The <code>dirname</code> method returns the parent directory portion of the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/foo/bar/baz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dirname</span><span class="p">();</span>

<span class="c1">// &#39;/foo/bar&#39;</span>
</pre></div>

<p>Optionally, You may specify how many directory levels you wish to trim from the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/foo/bar/baz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dirname</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// &#39;/foo&#39;</span>
</pre></div>

<p><a name="method-fluent-str-ends-with"></a></p>

<h4><code>endsWith</code> {#collection-method}</h4>

<p>The <code>endsWith</code> method determines if the given string ends with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p>You may also pass an array of values to determine if the given string ends with any of the given values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">endsWith</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// true</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">endsWith</span><span class="p">([</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-fluent-str-exactly"></a></p>

<h4><code>exactly</code> {#collection-method}</h4>

<p>The <code>exactly</code> method determines if the given string is an exact match with another string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">exactly</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-fluent-str-explode"></a></p>

<h4><code>explode</code> {#collection-method}</h4>

<p>The <code>explode</code> method splits the string by the given delimiter and returns a collection containing each section of the split string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$collection</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo bar baz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">explode</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>

<span class="c1">// collect([&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;])</span>
</pre></div>

<p><a name="method-fluent-str-finish"></a></p>

<h4><code>finish</code> {#collection-method}</h4>

<p>The <code>finish</code> method adds a single instance of the given value to a string if it does not already end with the value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">finish</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;this/string/&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">finish</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// this/string/</span>
</pre></div>

<p><a name="method-fluent-str-is"></a></p>

<h4><code>is</code> {#collection-method}</h4>

<p>The <code>is</code> method determines if a given string matches a given pattern. Asterisks may be used to indicate wildcards:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$matches</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;foo*&#39;</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$matches</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;baz*&#39;</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-fluent-str-is-ascii"></a></p>

<h4><code>isAscii</code> {#collection-method}</h4>

<p>The <code>isAscii</code> method determines if a given string is an ASCII string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isAscii</span><span class="p">();</span>

<span class="c1">// true</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isAscii</span><span class="p">();</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-fluent-str-is-empty"></a></p>

<h4><code>isEmpty</code> {#collection-method}</h4>

<p>The <code>isEmpty</code> method determines if the given string is empty:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isEmpty</span><span class="p">();</span>

<span class="c1">// true</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isEmpty</span><span class="p">();</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-fluent-str-is-not-empty"></a></p>

<h4><code>isNotEmpty</code> {#collection-method}</h4>

<p>The <code>isNotEmpty</code> method determines if the given string is not empty:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isNotEmpty</span><span class="p">();</span>

<span class="c1">// false</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isNotEmpty</span><span class="p">();</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-fluent-str-kebab"></a></p>

<h4><code>kebab</code> {#collection-method}</h4>

<p>The <code>kebab</code> method converts the given string to <code>kebab-case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">kebab</span><span class="p">();</span>

<span class="c1">// foo-bar</span>
</pre></div>

<p><a name="method-fluent-str-length"></a></p>

<h4><code>length</code> {#collection-method}</h4>

<p>The <code>length</code> method returns the length of the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$length</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">length</span><span class="p">();</span>

<span class="c1">// 7</span>
</pre></div>

<p><a name="method-fluent-str-limit"></a></p>

<h4><code>limit</code> {#collection-method}</h4>

<p>The <code>limit</code> method truncates the given string at the specified length:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$truncated</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="c1">// The quick brown fox...</span>
</pre></div>

<p>You may also pass a second argument to change the string that will be appended to the end:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$truncated</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39; (...)&#39;</span><span class="p">);</span>

<span class="c1">// The quick brown fox (...)</span>
</pre></div>

<p><a name="method-fluent-str-lower"></a></p>

<h4><code>lower</code> {#collection-method}</h4>

<p>The <code>lower</code> method converts the given string to lowercase:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;LARAVEL&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lower</span><span class="p">();</span>

<span class="c1">// &#39;laravel&#39;</span>
</pre></div>

<p><a name="method-fluent-str-ltrim"></a></p>

<h4><code>ltrim</code> {#collection-method}</h4>

<p>The <code>ltrim</code> method left trims the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  Laravel  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ltrim</span><span class="p">();</span>

<span class="c1">// &#39;Laravel  &#39;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/Laravel/&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ltrim</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Laravel/&#39;</span>
</pre></div>

<p><a name="method-fluent-str-match"></a></p>

<h4><code>match</code> {#collection-method}</h4>

<p>The <code>match</code> method will return the portion of a string that matches a given regular expression pattern:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">match</span><span class="p">(</span><span class="s1">&#39;/bar/&#39;</span><span class="p">);</span>

<span class="c1">// &#39;bar&#39;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">match</span><span class="p">(</span><span class="s1">&#39;/foo (.*)/&#39;</span><span class="p">);</span>

<span class="c1">// &#39;bar&#39;</span>
</pre></div>

<p><a name="method-fluent-str-match-all"></a></p>

<h4><code>matchAll</code> {#collection-method}</h4>

<p>The <code>matchAll</code> method will return a collection containing the portions of a string that match a given regular expression pattern:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;bar foo bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">matchAll</span><span class="p">(</span><span class="s1">&#39;/bar/&#39;</span><span class="p">);</span>

<span class="c1">// collect([&#39;bar&#39;, &#39;bar&#39;])</span>
</pre></div>

<p>If you specify a matching group within the expression, Laravel will return a collection of that group&#39;s matches:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;bar fun bar fly&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">matchAll</span><span class="p">(</span><span class="s1">&#39;/f(\w*)/&#39;</span><span class="p">);</span>

<span class="c1">// collect([&#39;un&#39;, &#39;ly&#39;]);</span>
</pre></div>

<p>If no matches are found, an empty collection will be returned.</p>

<p><a name="method-fluent-str-padboth"></a></p>

<h4><code>padBoth</code> {#collection-method}</h4>

<p>The <code>padBoth</code> method wraps PHP&#39;s <code>str_pad</code> function, padding both sides of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padBoth</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">);</span>

<span class="c1">// &#39;__James___&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padBoth</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;  James   &#39;</span>
</pre></div>

<p><a name="method-fluent-str-padleft"></a></p>

<h4><code>padLeft</code> {#collection-method}</h4>

<p>The <code>padLeft</code> method wraps PHP&#39;s <code>str_pad</code> function, padding the left side of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padLeft</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;-=&#39;</span><span class="p">);</span>

<span class="c1">// &#39;-=-=-James&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padLeft</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;     James&#39;</span>
</pre></div>

<p><a name="method-fluent-str-padright"></a></p>

<h4><code>padRight</code> {#collection-method}</h4>

<p>The <code>padRight</code> method wraps PHP&#39;s <code>str_pad</code> function, padding the right side of a string with another:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padRight</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// &#39;James-----&#39;</span>

<span class="nx">$padded</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;James&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">padRight</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// &#39;James     &#39;</span>
</pre></div>

<p><a name="method-fluent-str-plural"></a></p>

<h4><code>plural</code> {#collection-method}</h4>

<p>The <code>plural</code> method converts a single word string to its plural form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;car&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">plural</span><span class="p">();</span>

<span class="c1">// cars</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">plural</span><span class="p">();</span>

<span class="c1">// children</span>
</pre></div>

<p>You may provide an integer as a second argument to the function to retrieve the singular or plural form of the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">plural</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// children</span>

<span class="nx">$plural</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">plural</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// child</span>
</pre></div>

<p><a name="method-fluent-str-prepend"></a></p>

<h4><code>prepend</code> {#collection-method}</h4>

<p>The <code>prepend</code> method prepends the given values onto the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Framework&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;Laravel &#39;</span><span class="p">);</span>

<span class="c1">// Laravel Framework</span>
</pre></div>

<p><a name="method-fluent-str-replace"></a></p>

<h4><code>replace</code> {#collection-method}</h4>

<p>The <code>replace</code> method replaces a given string within the string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel 6.x&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;6.x&#39;</span><span class="p">,</span> <span class="s1">&#39;7.x&#39;</span><span class="p">);</span>

<span class="c1">// Laravel 7.x</span>
</pre></div>

<p><a name="method-fluent-str-replace-array"></a></p>

<h4><code>replaceArray</code> {#collection-method}</h4>

<p>The <code>replaceArray</code> method replaces a given value in the string sequentially using an array:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="s1">&#39;The event will take place between ? and ?&#39;</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="nx">$string</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replaceArray</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;8:30&#39;</span><span class="p">,</span> <span class="s1">&#39;9:00&#39;</span><span class="p">]);</span>

<span class="c1">// The event will take place between 8:30 and 9:00</span>
</pre></div>

<p><a name="method-fluent-str-replace-first"></a></p>

<h4><code>replaceFirst</code> {#collection-method}</h4>

<p>The <code>replaceFirst</code> method replaces the first occurrence of a given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;the quick brown fox jumps over the lazy dog&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replaceFirst</span><span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>

<span class="c1">// a quick brown fox jumps over the lazy dog</span>
</pre></div>

<p><a name="method-fluent-str-replace-last"></a></p>

<h4><code>replaceLast</code> {#collection-method}</h4>

<p>The <code>replaceLast</code> method replaces the last occurrence of a given value in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;the quick brown fox jumps over the lazy dog&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replaceLast</span><span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>

<span class="c1">// the quick brown fox jumps over a lazy dog</span>
</pre></div>

<p><a name="method-fluent-str-replace-matches"></a></p>

<h4><code>replaceMatches</code> {#collection-method}</h4>

<p>The <code>replaceMatches</code> method replaces all portions of a string matching a given pattern with the given replacement string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;(+1) 501-555-1000&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replaceMatches</span><span class="p">(</span><span class="s1">&#39;/[^A-Za-z0-9]++/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1">// &#39;15015551000&#39;</span>
</pre></div>

<p>The <code>replaceMatches</code> method also accepts a Closure that will be invoked with each portion of the string matching the given party, allowing you to perform the replacement logic within the Closure and return the replaced value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$replaced</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">replaceMatches</span><span class="p">(</span><span class="s1">&#39;/\d/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$match</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;[&#39;</span><span class="p">.</span><span class="nx">$match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="s1">&#39;]&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// &#39;[1][2][3]&#39;</span>
</pre></div>

<p><a name="method-fluent-str-rtrim"></a></p>

<h4><code>rtrim</code> {#collection-method}</h4>

<p>The <code>rtrim</code> method right trims the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  Laravel  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">rtrim</span><span class="p">();</span>

<span class="c1">// &#39;  Laravel&#39;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/Laravel/&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">rtrim</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// &#39;/Laravel&#39;</span>
</pre></div>

<p><a name="method-fluent-str-singular"></a></p>

<h4><code>singular</code> {#collection-method}</h4>

<p>The <code>singular</code> method converts a string to its singular form. This function currently only supports the English language:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$singular</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">singular</span><span class="p">();</span>

<span class="c1">// car</span>

<span class="nx">$singular</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">singular</span><span class="p">();</span>

<span class="c1">// child</span>
</pre></div>

<p><a name="method-fluent-str-slug"></a></p>

<h4><code>slug</code> {#collection-method}</h4>

<p>The <code>slug</code> method generates a URL friendly &quot;slug&quot; from the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$slug</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel Framework&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">slug</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// laravel-framework</span>
</pre></div>

<p><a name="method-fluent-str-snake"></a></p>

<h4><code>snake</code> {#collection-method}</h4>

<p>The <code>snake</code> method converts the given string to <code>snake_case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;fooBar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">snake</span><span class="p">();</span>

<span class="c1">// foo_bar</span>
</pre></div>

<p><a name="method-fluent-str-split"></a></p>

<h4><code>split</code> {#collection-method}</h4>

<p>The <code>split</code> method splits a string into a collection using a regular expression:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$segments</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;one, two, three&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/[\s,]+/&#39;</span><span class="p">);</span>

<span class="c1">// collect([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;])</span>
</pre></div>

<p><a name="method-fluent-str-start"></a></p>

<h4><code>start</code> {#collection-method}</h4>

<p>The <code>start</code> method adds a single instance of the given value to a string if it does not already start with the value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;this/string&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// /this/string</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/this/string&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// /this/string</span>
</pre></div>

<p><a name="method-fluent-str-starts-with"></a></p>

<h4><code>startsWith</code> {#collection-method}</h4>

<p>The <code>startsWith</code> method determines if the given string begins with the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;This is my name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;This&#39;</span><span class="p">);</span>

<span class="c1">// true</span>
</pre></div>

<p><a name="method-fluent-str-studly"></a></p>

<h4><code>studly</code> {#collection-method}</h4>

<p>The <code>studly</code> method converts the given string to <code>StudlyCase</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo_bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">studly</span><span class="p">();</span>

<span class="c1">// FooBar</span>
</pre></div>

<p><a name="method-fluent-str-substr"></a></p>

<h4><code>substr</code> {#collection-method}</h4>

<p>The <code>substr</code> method returns the portion of the string specified by the given start and length parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel Framework&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">// Framework</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Laravel Framework&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">substr</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="c1">// Frame</span>
</pre></div>

<p><a name="method-fluent-str-title"></a></p>

<h4><code>title</code> {#collection-method}</h4>

<p>The <code>title</code> method converts the given string to <code>Title Case</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$converted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;a nice title uses the correct case&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">();</span>

<span class="c1">// A Nice Title Uses The Correct Case</span>
</pre></div>

<p><a name="method-fluent-str-trim"></a></p>

<h4><code>trim</code> {#collection-method}</h4>

<p>The <code>trim</code> method trims the given string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  Laravel  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">();</span>

<span class="c1">// &#39;Laravel&#39;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;/Laravel/&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="c1">// &#39;Laravel&#39;</span>
</pre></div>

<p><a name="method-fluent-str-ucfirst"></a></p>

<h4><code>ucfirst</code> {#collection-method}</h4>

<p>The <code>ucfirst</code> method returns the given string with the first character capitalized:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;foo bar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ucfirst</span><span class="p">();</span>

<span class="c1">// Foo bar</span>
</pre></div>

<p><a name="method-fluent-str-upper"></a></p>

<h4><code>upper</code> {#collection-method}</h4>

<p>The <code>upper</code> method converts the given string to uppercase:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$adjusted</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;laravel&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">upper</span><span class="p">();</span>

<span class="c1">// LARAVEL</span>
</pre></div>

<p><a name="method-fluent-str-when"></a></p>

<h4><code>when</code> {#collection-method}</h4>

<p>The <code>when</code> method invokes the given Closure if a given condition is true. The Closure will receive the fluent string instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$string</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">$string</span><span class="o">-&gt;</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39; Otwell&#39;</span><span class="p">);</span>
                <span class="p">});</span>

<span class="c1">// &#39;Taylor Otwell&#39;</span>
</pre></div>

<p>If necessary, you may pass another Closure as the third parameter to the <code>when</code> method. This Closure will execute if the condition parameter evaluates to <code>false</code>.</p>

<p><a name="method-fluent-str-when-empty"></a></p>

<h4><code>whenEmpty</code> {#collection-method}</h4>

<p>The <code>whenEmpty</code> method invokes the given Closure if the string is empty. If the Closure returns a value, that value will also be returned by the <code>whenEmpty</code> method. If the Closure does not return a value, the fluent string instance will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$string</span><span class="o">-&gt;</span><span class="nx">trim</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">prepend</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// &#39;Laravel&#39;</span>
</pre></div>

<p><a name="method-fluent-str-words"></a></p>

<h4><code>words</code> {#collection-method}</h4>

<p>The <code>words</code> method limits the number of words in a string:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="nx">$string</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="k">of</span><span class="p">(</span><span class="s1">&#39;Perfectly balanced, as all things should be.&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">words</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; &gt;&gt;&gt;&#39;</span><span class="p">);</span>

<span class="c1">// Perfectly balanced, as &gt;&gt;&gt;</span>
</pre></div>

<p><a name="urls"></a></p>

<h2>URLs</h2>

<p><a name="method-action"></a></p>

<h4><code>action()</code> {#collection-method}</h4>

<p>The <code>action</code> function generates a URL for the given controller action. You do not need to pass the full namespace of the controller. Instead, pass the controller class name relative to the <code>App\Http\Controllers</code> namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">([</span><span class="nx">HomeController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
</pre></div>

<p>If the method accepts route parameters, you may pass them as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="method-asset"></a></p>

<h4><code>asset()</code> {#collection-method}</h4>

<p>The <code>asset</code> function generates a URL for an asset using the current scheme of the request (HTTP or HTTPS):</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p>You can configure the asset URL host by setting the <code>ASSET_URL</code> variable in your <code>.env</code> file. This can be useful if you host your assets on an external service like Amazon S3:</p>
<div class="highlight"><pre><span></span><span class="c1">// ASSET_URL=http://example.com/assets</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span> <span class="c1">// http://example.com/assets/img/photo.jpg</span>
</pre></div>

<p><a name="method-route"></a></p>

<h4><code>route()</code> {#collection-method}</h4>

<p>The <code>route</code> function generates a URL for the given named route:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">);</span>
</pre></div>

<p>If the route accepts parameters, you may pass them as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>By default, the <code>route</code> function generates an absolute URL. If you wish to generate a relative URL, you may pass <code>false</code> as the third argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;routeName&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>

<p><a name="method-secure-asset"></a></p>

<h4><code>secure_asset()</code> {#collection-method}</h4>

<p>The <code>secure_asset</code> function generates a URL for an asset using HTTPS:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">secure_asset</span><span class="p">(</span><span class="s1">&#39;img/photo.jpg&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-secure-url"></a></p>

<h4><code>secure_url()</code> {#collection-method}</h4>

<p>The <code>secure_url</code> function generates a fully qualified HTTPS URL to the given path:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">secure_url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">secure_url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="method-url"></a></p>

<h4><code>url()</code> {#collection-method}</h4>

<p>The <code>url</code> function generates a fully qualified URL to the given path:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>If no path is provided, a <code>Illuminate\Routing\UrlGenerator</code> instance is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$current</span> <span class="o">=</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">current</span><span class="p">();</span>

<span class="nx">$full</span> <span class="o">=</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">full</span><span class="p">();</span>

<span class="nx">$previous</span> <span class="o">=</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">previous</span><span class="p">();</span>
</pre></div>

<p><a name="miscellaneous"></a></p>

<h2>Miscellaneous</h2>

<p><a name="method-abort"></a></p>

<h4><code>abort()</code> {#collection-method}</h4>

<p>The <code>abort</code> function throws <a href="/docs/%7B%7Bversion%7D%7D/errors#http-exceptions">an HTTP exception</a> which will be rendered by the <a href="/docs/%7B%7Bversion%7D%7D/errors#the-exception-handler">exception handler</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
</pre></div>

<p>You may also provide the exception&#39;s response text and custom response headers:</p>
<div class="highlight"><pre><span></span><span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized.&#39;</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<p><a name="method-abort-if"></a></p>

<h4><code>abort_if()</code> {#collection-method}</h4>

<p>The <code>abort_if</code> function throws an HTTP exception if a given boolean expression evaluates to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">abort_if</span><span class="p">(</span><span class="o">!</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="mi">403</span><span class="p">);</span>
</pre></div>

<p>Like the <code>abort</code> method, you may also provide the exception&#39;s response text as the third argument and an array of custom response headers as the fourth argument.</p>

<p><a name="method-abort-unless"></a></p>

<h4><code>abort_unless()</code> {#collection-method}</h4>

<p>The <code>abort_unless</code> function throws an HTTP exception if a given boolean expression evaluates to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">abort_unless</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="mi">403</span><span class="p">);</span>
</pre></div>

<p>Like the <code>abort</code> method, you may also provide the exception&#39;s response text as the third argument and an array of custom response headers as the fourth argument.</p>

<p><a name="method-app"></a></p>

<h4><code>app()</code> {#collection-method}</h4>

<p>The <code>app</code> function returns the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$container</span> <span class="o">=</span> <span class="nx">app</span><span class="p">();</span>
</pre></div>

<p>You may pass a class or interface name to resolve it from the container:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-auth"></a></p>

<h4><code>auth()</code> {#collection-method}</h4>

<p>The <code>auth</code> function returns an <a href="/docs/%7B%7Bversion%7D%7D/authentication">authenticator</a> instance. You may use it instead of the <code>Auth</code> facade for convenience:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
</pre></div>

<p>If needed, you may specify which guard instance you would like to access:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
</pre></div>

<p><a name="method-back"></a></p>

<h4><code>back()</code> {#collection-method}</h4>

<p>The <code>back</code> function generates a <a href="/docs/%7B%7Bversion%7D%7D/responses#redirects">redirect HTTP response</a> to the user&#39;s previous location:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">back</span><span class="p">(</span><span class="nx">$status</span> <span class="o">=</span> <span class="mi">302</span><span class="p">,</span> <span class="nx">$headers</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">$fallback</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">back</span><span class="p">();</span>
</pre></div>

<p><a name="method-bcrypt"></a></p>

<h4><code>bcrypt()</code> {#collection-method}</h4>

<p>The <code>bcrypt</code> function <a href="/docs/%7B%7Bversion%7D%7D/hashing">hashes</a> the given value using Bcrypt. You may use it as an alternative to the <code>Hash</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">$password</span> <span class="o">=</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">&#39;my-secret-password&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-blank"></a></p>

<h4><code>blank()</code> {#collection-method}</h4>

<p>The <code>blank</code> function returns whether the given value is &quot;blank&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">blank</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="nx">blank</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">);</span>
<span class="nx">blank</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">blank</span><span class="p">(</span><span class="nx">collect</span><span class="p">());</span>

<span class="c1">// true</span>

<span class="nx">blank</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">blank</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">blank</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="c1">// false</span>
</pre></div>

<p>For the inverse of <code>blank</code>, see the <a href="#method-filled"><code>filled</code></a> method.</p>

<p><a name="method-broadcast"></a></p>

<h4><code>broadcast()</code> {#collection-method}</h4>

<p>The <code>broadcast</code> function <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">broadcasts</a> the given <a href="/docs/%7B%7Bversion%7D%7D/events">event</a> to its listeners:</p>
<div class="highlight"><pre><span></span><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserRegistered</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
</pre></div>

<p><a name="method-cache"></a></p>

<h4><code>cache()</code> {#collection-method}</h4>

<p>The <code>cache</code> function may be used to get values from the <a href="/docs/%7B%7Bversion%7D%7D/cache">cache</a>. If the given key does not exist in the cache, an optional default value will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p>You may add items to the cache by passing an array of key / value pairs to the function. You should also pass the number of seconds or duration the cached value should be considered valid:</p>
<div class="highlight"><pre><span></span><span class="nx">cache</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="mi">300</span><span class="p">);</span>

<span class="nx">cache</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addSeconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</pre></div>

<p><a name="method-class-uses-recursive"></a></p>

<h4><code>class_uses_recursive()</code> {#collection-method}</h4>

<p>The <code>class_uses_recursive</code> function returns all traits used by a class, including traits used by all of its parent classes:</p>
<div class="highlight"><pre><span></span><span class="nx">$traits</span> <span class="o">=</span> <span class="nx">class_uses_recursive</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p><a name="method-collect"></a></p>

<h4><code>collect()</code> {#collection-method}</h4>

<p>The <code>collect</code> function creates a <a href="/docs/%7B%7Bversion%7D%7D/collections">collection</a> instance from the given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$collection</span> <span class="o">=</span> <span class="nx">collect</span><span class="p">([</span><span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;abigail&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="method-config"></a></p>

<h4><code>config()</code> {#collection-method}</h4>

<p>The <code>config</code> function gets the value of a <a href="/docs/%7B%7Bversion%7D%7D/configuration">configuration</a> variable. The configuration values may be accessed using &quot;dot&quot; syntax, which includes the name of the file and the option you wish to access. A default value may be specified and is returned if the configuration option does not exist:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p>You may set configuration variables at runtime by passing an array of key / value pairs:</p>
<div class="highlight"><pre><span></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.debug&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
</pre></div>

<p><a name="method-cookie"></a></p>

<h4><code>cookie()</code> {#collection-method}</h4>

<p>The <code>cookie</code> function creates a new <a href="/docs/%7B%7Bversion%7D%7D/requests#cookies">cookie</a> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p><a name="method-csrf-field"></a></p>

<h4><code>csrf_field()</code> {#collection-method}</h4>

<p>The <code>csrf_field</code> function generates an HTML <code>hidden</code> input field containing the value of the CSRF token. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">csrf_field</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p><a name="method-csrf-token"></a></p>

<h4><code>csrf_token()</code> {#collection-method}</h4>

<p>The <code>csrf_token</code> function retrieves the value of the current CSRF token:</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">csrf_token</span><span class="p">();</span>
</pre></div>

<p><a name="method-dd"></a></p>

<h4><code>dd()</code> {#collection-method}</h4>

<p>The <code>dd</code> function dumps the given variables and ends execution of the script:</p>
<div class="highlight"><pre><span></span><span class="nx">dd</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>

<span class="nx">dd</span><span class="p">(</span><span class="nx">$value1</span><span class="p">,</span> <span class="nx">$value2</span><span class="p">,</span> <span class="nx">$value3</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>

<p>If you do not want to halt the execution of your script, use the <a href="#method-dump"><code>dump</code></a> function instead.</p>

<p><a name="method-dispatch"></a></p>

<h4><code>dispatch()</code> {#collection-method}</h4>

<p>The <code>dispatch</code> function pushes the given <a href="/docs/%7B%7Bversion%7D%7D/queues#creating-jobs">job</a> onto the Laravel <a href="/docs/%7B%7Bversion%7D%7D/queues">job queue</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">SendEmails</span><span class="p">);</span>
</pre></div>

<p><a name="method-dispatch-now"></a></p>

<h4><code>dispatch_now()</code> {#collection-method}</h4>

<p>The <code>dispatch_now</code> function runs the given <a href="/docs/%7B%7Bversion%7D%7D/queues#creating-jobs">job</a> immediately and returns the value from its <code>handle</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$result</span> <span class="o">=</span> <span class="nx">dispatch_now</span><span class="p">(</span><span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">SendEmails</span><span class="p">);</span>
</pre></div>

<p><a name="method-dump"></a></p>

<h4><code>dump()</code> {#collection-method}</h4>

<p>The <code>dump</code> function dumps the given variables:</p>
<div class="highlight"><pre><span></span><span class="nx">dump</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>

<span class="nx">dump</span><span class="p">(</span><span class="nx">$value1</span><span class="p">,</span> <span class="nx">$value2</span><span class="p">,</span> <span class="nx">$value3</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>

<p>If you want to stop executing the script after dumping the variables, use the <a href="#method-dd"><code>dd</code></a> function instead.</p>

<p><a name="method-env"></a></p>

<h4><code>env()</code> {#collection-method}</h4>

<p>The <code>env</code> function retrieves the value of an <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">environment variable</a> or returns a default value:</p>
<div class="highlight"><pre><span></span><span class="nx">$env</span> <span class="o">=</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">);</span>

<span class="c1">// Returns &#39;production&#39; if APP_ENV is not set...</span>
<span class="nx">$env</span> <span class="o">=</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} If you execute the <code>config:cache</code> command during your deployment process, you should be sure that you are only calling the <code>env</code> function from within your configuration files. Once the configuration has been cached, the <code>.env</code> file will not be loaded and all calls to the <code>env</code> function will return <code>null</code>.</p>
</blockquote>

<p><a name="method-event"></a></p>

<h4><code>event()</code> {#collection-method}</h4>

<p>The <code>event</code> function dispatches the given <a href="/docs/%7B%7Bversion%7D%7D/events">event</a> to its listeners:</p>
<div class="highlight"><pre><span></span><span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserRegistered</span><span class="p">(</span><span class="nx">$user</span><span class="p">));</span>
</pre></div>

<p><a name="method-filled"></a></p>

<h4><code>filled()</code> {#collection-method}</h4>

<p>The <code>filled</code> function returns whether the given value is not &quot;blank&quot;:</p>
<div class="highlight"><pre><span></span><span class="nx">filled</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">filled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">filled</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">filled</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="nx">filled</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">);</span>
<span class="nx">filled</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">filled</span><span class="p">(</span><span class="nx">collect</span><span class="p">());</span>

<span class="c1">// false</span>
</pre></div>

<p>For the inverse of <code>filled</code>, see the <a href="#method-blank"><code>blank</code></a> method.</p>

<p><a name="method-info"></a></p>

<h4><code>info()</code> {#collection-method}</h4>

<p>The <code>info</code> function will write information to the <a href="/docs/%7B%7Bversion%7D%7D/logging">log</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Some helpful information!&#39;</span><span class="p">);</span>
</pre></div>

<p>An array of contextual data may also be passed to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;User login attempt failed.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">]);</span>
</pre></div>

<p><a name="method-logger"></a></p>

<h4><code>logger()</code> {#collection-method}</h4>

<p>The <code>logger</code> function can be used to write a <code>debug</code> level message to the <a href="/docs/%7B%7Bversion%7D%7D/logging">log</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;Debug message&#39;</span><span class="p">);</span>
</pre></div>

<p>An array of contextual data may also be passed to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;User has logged in.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">]);</span>
</pre></div>

<p>A <a href="/docs/%7B%7Bversion%7D%7D/errors#logging">logger</a> instance will be returned if no value is passed to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">logger</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;You are not allowed here.&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-method-field"></a></p>

<h4><code>method_field()</code> {#collection-method}</h4>

<p>The <code>method_field</code> function generates an HTML <code>hidden</code> input field containing the spoofed value of the form&#39;s HTTP verb. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nx">method_field</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">)</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="method-now"></a></p>

<h4><code>now()</code> {#collection-method}</h4>

<p>The <code>now</code> function creates a new <code>Illuminate\Support\Carbon</code> instance for the current time:</p>
<div class="highlight"><pre><span></span><span class="nx">$now</span> <span class="o">=</span> <span class="nx">now</span><span class="p">();</span>
</pre></div>

<p><a name="method-old"></a></p>

<h4><code>old()</code> {#collection-method}</h4>

<p>The <code>old</code> function <a href="/docs/%7B%7Bversion%7D%7D/requests#retrieving-input">retrieves</a> an <a href="/docs/%7B%7Bversion%7D%7D/requests#old-input">old input</a> value flashed into the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-optional"></a></p>

<h4><code>optional()</code> {#collection-method}</h4>

<p>The <code>optional</code> function accepts any argument and allows you to access properties or call methods on that object. If the given object is <code>null</code>, properties and methods will return <code>null</code> instead of causing an error:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">optional</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">address</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">street</span><span class="p">;</span>

<span class="p">{</span><span class="o">!!</span> <span class="nx">old</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">optional</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">)</span> <span class="o">!!</span><span class="p">}</span>
</pre></div>

<p>The <code>optional</code> function also accepts a Closure as its second argument. The Closure will be invoked if the value provided as the first argument is not null:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">optional</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">DummyUser</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-policy"></a></p>

<h4><code>policy()</code> {#collection-method}</h4>

<p>The <code>policy</code> method retrieves a <a href="/docs/%7B%7Bversion%7D%7D/authorization#creating-policies">policy</a> instance for a given class:</p>
<div class="highlight"><pre><span></span><span class="nx">$policy</span> <span class="o">=</span> <span class="nx">policy</span><span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p><a name="method-redirect"></a></p>

<h4><code>redirect()</code> {#collection-method}</h4>

<p>The <code>redirect</code> function returns a <a href="/docs/%7B%7Bversion%7D%7D/responses#redirects">redirect HTTP response</a>, or returns the redirector instance if called with no arguments:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="nx">$to</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$status</span> <span class="o">=</span> <span class="mi">302</span><span class="p">,</span> <span class="nx">$headers</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;route.name&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-report"></a></p>

<h4><code>report()</code> {#collection-method}</h4>

<p>The <code>report</code> function will report an exception using your <a href="/docs/%7B%7Bversion%7D%7D/errors#the-exception-handler">exception handler</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">report</span><span class="p">(</span><span class="nx">$e</span><span class="p">);</span>
</pre></div>

<p><a name="method-request"></a></p>

<h4><code>request()</code> {#collection-method}</h4>

<p>The <code>request</code> function returns the current <a href="/docs/%7B%7Bversion%7D%7D/requests">request</a> instance or obtains an input item:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">();</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$default</span><span class="p">);</span>
</pre></div>

<p><a name="method-rescue"></a></p>

<h4><code>rescue()</code> {#collection-method}</h4>

<p>The <code>rescue</code> function executes the given Closure and catches any exceptions that occur during its execution. All exceptions that are caught will be sent to your <a href="/docs/%7B%7Bversion%7D%7D/errors#the-exception-handler">exception handler</a>; however, the request will continue processing:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">rescue</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">method</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>You may also pass a second argument to the <code>rescue</code> function. This argument will be the &quot;default&quot; value that should be returned if an exception occurs while executing the Closure:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">rescue</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">method</span><span class="p">();</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">rescue</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">method</span><span class="p">();</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">failure</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-resolve"></a></p>

<h4><code>resolve()</code> {#collection-method}</h4>

<p>The <code>resolve</code> function resolves a given class or interface name to its instance using the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$api</span> <span class="o">=</span> <span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;HelpSpot\API&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-response"></a></p>

<h4><code>response()</code> {#collection-method}</h4>

<p>The <code>response</code> function creates a <a href="/docs/%7B%7Bversion%7D%7D/responses">response</a> instance or obtains an instance of the response factory:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<p><a name="method-retry"></a></p>

<h4><code>retry()</code> {#collection-method}</h4>

<p>The <code>retry</code> function attempts to execute the given callback until the given maximum attempt threshold is met. If the callback does not throw an exception, its return value will be returned. If the callback throws an exception, it will automatically be retried. If the maximum attempt count is exceeded, the exception will be thrown:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">retry</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Attempt 5 times while resting 100ms in between attempts...</span>
<span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>

<p><a name="method-session"></a></p>

<h4><code>session()</code> {#collection-method}</h4>

<p>The <code>session</code> function may be used to get or set <a href="/docs/%7B%7Bversion%7D%7D/session">session</a> values:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</pre></div>

<p>You may set values by passing an array of key / value pairs to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">([</span><span class="s1">&#39;chairs&#39;</span> <span class="p">=&gt;</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;instruments&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<p>The session store will be returned if no value is passed to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p><a name="method-tap"></a></p>

<h4><code>tap()</code> {#collection-method}</h4>

<p>The <code>tap</code> function accepts two arguments: an arbitrary <code>$value</code> and a Closure. The <code>$value</code> will be passed to the Closure and then be returned by the <code>tap</code> function. The return value of the Closure is irrelevant:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">tap</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="nx">first</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;taylor&#39;</span><span class="p">;</span>

    <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If no Closure is passed to the <code>tap</code> function, you may call any method on the given <code>$value</code>. The return value of the method you call will always be <code>$value</code>, regardless of what the method actually returns in its definition. For example, the Eloquent <code>update</code> method typically returns an integer. However, we can force the method to return the model itself by chaining the <code>update</code> method call through the <code>tap</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">tap</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="nx">$name</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">$email</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>To add a <code>tap</code> method to a class, you may add the <code>Illuminate\Support\Traits\Tappable</code> trait to the class. The <code>tap</code> method of this trait accepts a Closure as its only argument. The object instance itself will be passed to the Closure and then be returned by the <code>tap</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tap</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="method-throw-if"></a></p>

<h4><code>throw_if()</code> {#collection-method}</h4>

<p>The <code>throw_if</code> function throws the given exception if a given boolean expression evaluates to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">throw_if</span><span class="p">(</span><span class="o">!</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="nx">AuthorizationException</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

<span class="nx">throw_if</span><span class="p">(</span>
    <span class="o">!</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span>
    <span class="nx">AuthorizationException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;You are not allowed to access this page&#39;</span>
<span class="p">);</span>
</pre></div>

<p><a name="method-throw-unless"></a></p>

<h4><code>throw_unless()</code> {#collection-method}</h4>

<p>The <code>throw_unless</code> function throws the given exception if a given boolean expression evaluates to <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">throw_unless</span><span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span> <span class="nx">AuthorizationException</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

<span class="nx">throw_unless</span><span class="p">(</span>
    <span class="nx">Auth</span><span class="o">::</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">isAdmin</span><span class="p">(),</span>
    <span class="nx">AuthorizationException</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;You are not allowed to access this page&#39;</span>
<span class="p">);</span>
</pre></div>

<p><a name="method-today"></a></p>

<h4><code>today()</code> {#collection-method}</h4>

<p>The <code>today</code> function creates a new <code>Illuminate\Support\Carbon</code> instance for the current date:</p>
<div class="highlight"><pre><span></span><span class="nx">$today</span> <span class="o">=</span> <span class="nx">today</span><span class="p">();</span>
</pre></div>

<p><a name="method-trait-uses-recursive"></a></p>

<h4><code>trait_uses_recursive()</code> {#collection-method}</h4>

<p>The <code>trait_uses_recursive</code> function returns all traits used by a trait:</p>
<div class="highlight"><pre><span></span><span class="nx">$traits</span> <span class="o">=</span> <span class="nx">trait_uses_recursive</span><span class="p">(</span><span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">Notifiable</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p><a name="method-transform"></a></p>

<h4><code>transform()</code> {#collection-method}</h4>

<p>The <code>transform</code> function executes a <code>Closure</code> on a given value if the value is not <a href="#method-blank">blank</a> and returns the result of the <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>

<span class="c1">// 10</span>
</pre></div>

<p>A default value or <code>Closure</code> may also be passed as the third parameter to the method. This value will be returned if the given value is blank:</p>
<div class="highlight"><pre><span></span><span class="nx">$result</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">,</span> <span class="s1">&#39;The value is blank&#39;</span><span class="p">);</span>

<span class="c1">// The value is blank</span>
</pre></div>

<p><a name="method-validator"></a></p>

<h4><code>validator()</code> {#collection-method}</h4>

<p>The <code>validator</code> function creates a new <a href="/docs/%7B%7Bversion%7D%7D/validation">validator</a> instance with the given arguments. You may use it instead of the <code>Validator</code> facade for convenience:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
</pre></div>

<p><a name="method-value"></a></p>

<h4><code>value()</code> {#collection-method}</h4>

<p>The <code>value</code> function returns the value it is given. However, if you pass a <code>Closure</code> to the function, the <code>Closure</code> will be executed then its result will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$result</span> <span class="o">=</span> <span class="nx">value</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="c1">// true</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="nx">value</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// false</span>
</pre></div>

<p><a name="method-view"></a></p>

<h4><code>view()</code> {#collection-method}</h4>

<p>The <code>view</code> function retrieves a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a> instance:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="method-with"></a></p>

<h4><code>with()</code> {#collection-method}</h4>

<p>The <code>with</code> function returns the value it is given. If a <code>Closure</code> is passed as the second argument to the function, the <code>Closure</code> will be executed and its result will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nx">$value</span><span class="p">))</span> <span class="o">?</span> <span class="nx">$value</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>

<span class="c1">// 10</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>

<span class="c1">// 0</span>

<span class="nx">$result</span> <span class="o">=</span> <span class="kd">with</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

<span class="c1">// 5</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Homestead</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation-and-setup">Installation &amp; Setup</a>

<ul>
<li><a href="#first-steps">First Steps</a></li>
<li><a href="#configuring-homestead">Configuring Homestead</a></li>
<li><a href="#launching-the-vagrant-box">Launching The Vagrant Box</a></li>
<li><a href="#per-project-installation">Per Project Installation</a></li>
<li><a href="#installing-optional-features">Installing Optional Features</a></li>
<li><a href="#aliases">Aliases</a></li>
</ul></li>
<li><a href="#daily-usage">Daily Usage</a>

<ul>
<li><a href="#accessing-homestead-globally">Accessing Homestead Globally</a></li>
<li><a href="#connecting-via-ssh">Connecting Via SSH</a></li>
<li><a href="#connecting-to-databases">Connecting To Databases</a></li>
<li><a href="#database-backups">Database Backups</a></li>
<li><a href="#database-snapshots">Database Snapshots</a></li>
<li><a href="#adding-additional-sites">Adding Additional Sites</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#wildcard-ssl">Wildcard SSL</a></li>
<li><a href="#configuring-cron-schedules">Configuring Cron Schedules</a></li>
<li><a href="#configuring-mailhog">Configuring Mailhog</a></li>
<li><a href="#configuring-minio">Configuring Minio</a></li>
<li><a href="#ports">Ports</a></li>
<li><a href="#sharing-your-environment">Sharing Your Environment</a></li>
<li><a href="#multiple-php-versions">Multiple PHP Versions</a></li>
<li><a href="#web-servers">Web Servers</a></li>
<li><a href="#mail">Mail</a></li>
</ul></li>
<li><a href="#debugging-and-profiling">Debugging &amp; Profiling</a>

<ul>
<li><a href="#debugging-web-requests">Debugging Web Requests With Xdebug</a></li>
<li><a href="#debugging-cli-applications">Debugging CLI Applications</a></li>
<li><a href="#profiling-applications-with-blackfire">Profiling Applications with Blackfire</a></li>
</ul></li>
<li><a href="#network-interfaces">Network Interfaces</a></li>
<li><a href="#extending-homestead">Extending Homestead</a></li>
<li><a href="#updating-homestead">Updating Homestead</a></li>
<li><a href="#provider-specific-settings">Provider Specific Settings</a>

<ul>
<li><a href="#provider-specific-virtualbox">VirtualBox</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel strives to make the entire PHP development experience delightful, including your local development environment. <a href="https://www.vagrantup.com">Vagrant</a> provides a simple, elegant way to manage and provision Virtual Machines.</p>

<p>Laravel Homestead is an official, pre-packaged Vagrant box that provides you a wonderful development environment without requiring you to install PHP, a web server, and any other server software on your local machine. No more worrying about messing up your operating system! Vagrant boxes are completely disposable. If something goes wrong, you can destroy and re-create the box in minutes!</p>

<p>Homestead runs on any Windows, Mac, or Linux system, and includes Nginx, PHP, MySQL, PostgreSQL, Redis, Memcached, Node, and all of the other goodies you need to develop amazing Laravel applications.</p>

<blockquote>
<p>{note} If you are using Windows, you may need to enable hardware virtualization (VT-x). It can usually be enabled via your BIOS. If you are using Hyper-V on a UEFI system you may additionally need to disable Hyper-V in order to access VT-x.</p>
</blockquote>

<p><a name="included-software"></a></p>

<h3>Included Software</h3>

<style>
    #software-list > ul {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 5em; -moz-column-gap: 5em; -webkit-column-gap: 5em;
        line-height: 1.9;
    }
</style>

<div id="software-list" markdown="1">
- Ubuntu 18.04
- Git
- PHP 7.4
- PHP 7.3
- PHP 7.2
- PHP 7.1
- PHP 7.0
- PHP 5.6
- Nginx
- MySQL
- lmm for MySQL or MariaDB database snapshots
- Sqlite3
- PostgreSQL (9.6, 10, 11, 12)
- Composer
- Node (With Yarn, Bower, Grunt, and Gulp)
- Redis
- Memcached
- Beanstalkd
- Mailhog
- avahi
- ngrok
- Xdebug
- XHProf / Tideways / XHGui
- wp-cli
</div>

<p><a name="optional-software"></a></p>

<h3>Optional Software</h3>

<style>
    #software-list > ul {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 5em; -moz-column-gap: 5em; -webkit-column-gap: 5em;
        line-height: 1.9;
    }
</style>

<div id="software-list" markdown="1">
- Apache
- Blackfire
- Cassandra
- Chronograf
- CouchDB
- Crystal & Lucky Framework
- Docker
- Elasticsearch
- Gearman
- Go
- Grafana
- InfluxDB
- MariaDB
- MinIO
- MongoDB
- MySQL 8
- Neo4j
- Oh My Zsh
- Open Resty
- PM2
- Python
- RabbitMQ
- Solr
- Webdriver & Laravel Dusk Utilities
</div>

<p><a name="installation-and-setup"></a></p>

<h2>Installation &amp; Setup</h2>

<p><a name="first-steps"></a></p>

<h3>First Steps</h3>

<p>Before launching your Homestead environment, you must install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox 6.x</a>, <a href="https://www.vmware.com">VMWare</a>, <a href="https://www.parallels.com/products/desktop/">Parallels</a> or <a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v">Hyper-V</a> as well as <a href="https://www.vagrantup.com/downloads.html">Vagrant</a>. All of these software packages provide easy-to-use visual installers for all popular operating systems.</p>

<p>To use the VMware provider, you will need to purchase both VMware Fusion / Workstation and the <a href="https://www.vagrantup.com/vmware">VMware Vagrant plug-in</a>. Though it is not free, VMware can provide faster shared folder performance out of the box.</p>

<p>To use the Parallels provider, you will need to install <a href="https://github.com/Parallels/vagrant-parallels">Parallels Vagrant plug-in</a>. It is free of charge.</p>

<p>Because of <a href="https://www.vagrantup.com/docs/hyperv/limitations.html">Vagrant limitations</a>, the Hyper-V provider ignores all networking settings.</p>

<h4>Installing The Homestead Vagrant Box</h4>

<p>Once VirtualBox / VMware and Vagrant have been installed, you should add the <code>laravel/homestead</code> box to your Vagrant installation using the following command in your terminal. It will take a few minutes to download the box, depending on your Internet connection speed:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span>
</pre></div>

<p>If this command fails, make sure your Vagrant installation is up to date.</p>

<blockquote>
<p>{note} Homestead periodically issues &quot;alpha&quot; / &quot;beta&quot; boxes for testing, which may interfere with the <code>vagrant box add</code> command. If you are having issues running <code>vagrant box add</code>, you may run the <code>vagrant up</code> command and the correct box will be downloaded when Vagrant attempts to start the virtual machine.</p>
</blockquote>

<h4>Installing Homestead</h4>

<p>You may install Homestead by cloning the repository onto your host machine. Consider cloning the repository into a <code>Homestead</code> folder within your &quot;home&quot; directory, as the Homestead box will serve as the host to all of your Laravel projects:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/laravel/homestead.git ~/Homestead</span>
</pre></div>

<p>You should check out a tagged version of Homestead since the <code>master</code> branch may not always be stable. You can find the latest stable version on the <a href="https://github.com/laravel/homestead/releases">GitHub Release Page</a>. Alternatively, you may checkout the <code>release</code> branch which always contains the latest stable release:</p>
<div class="highlight"><pre><span></span><span class="nx">cd</span> <span class="o">~</span><span class="err">/Homestead</span>

<span class="nx">git</span> <span class="nx">checkout</span> <span class="nx">release</span>
</pre></div>

<p>Once you have cloned the Homestead repository, run the <code>bash init.sh</code> command from the Homestead directory to create the <code>Homestead.yaml</code> configuration file. The <code>Homestead.yaml</code> file will be placed in the Homestead directory:</p>
<div class="highlight"><pre><span></span><span class="c1">// Mac / Linux...</span>
<span class="nx">bash</span> <span class="nx">init</span><span class="p">.</span><span class="nx">sh</span>

<span class="c1">// Windows...</span>
<span class="nx">init</span><span class="p">.</span><span class="nx">bat</span>
</pre></div>

<p><a name="configuring-homestead"></a></p>

<h3>Configuring Homestead</h3>

<h4>Setting Your Provider</h4>

<p>The <code>provider</code> key in your <code>Homestead.yaml</code> file indicates which Vagrant provider should be used: <code>virtualbox</code>, <code>vmware_fusion</code>, <code>vmware_workstation</code>, <code>parallels</code> or <code>hyperv</code>. You may set this to the provider you prefer:</p>
<div class="highlight"><pre><span></span><span class="nx">provider</span><span class="o">:</span> <span class="nx">virtualbox</span>
</pre></div>

<h4>Configuring Shared Folders</h4>

<p>The <code>folders</code> property of the <code>Homestead.yaml</code> file lists all of the folders you wish to share with your Homestead environment. As files within these folders are changed, they will be kept in sync between your local machine and the Homestead environment. You may configure as many shared folders as necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/code/project1</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1</span>
</pre></div>

<blockquote>
<p>{note} Windows users should not use the <code>~/</code> path syntax and instead should use the full path to their project, such as <code>C:\Users\user\Code\project1</code>.</p>
</blockquote>

<p>You should always map individual projects to their own folder mapping instead of mapping your entire <code>~/code</code> folder. When you map a folder the virtual machine must keep track of all disk IO for <em>every</em> file in the folder. This leads to performance issues if you have a large number of files in a folder.</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/code/project1</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1</span>

    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/code/project2</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project2</span>
</pre></div>

<blockquote>
<p>{note} You should never mount <code>.</code> (the current directory) when using Homestead. This causes Vagrant to not map the current folder to <code>/vagrant</code> and will break optional features and cause unexpected results while provisioning.</p>
</blockquote>

<p>To enable <a href="https://www.vagrantup.com/docs/synced-folders/nfs.html">NFS</a>, you only need to add a simple flag to your synced folder configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/code/project1</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;nfs&quot;</span>
</pre></div>

<blockquote>
<p>{note} When using NFS on Windows, you should consider installing the <a href="https://github.com/winnfsd/vagrant-winnfsd">vagrant-winnfsd</a> plug-in. This plug-in will maintain the correct user / group permissions for files and directories within the Homestead box.</p>
</blockquote>

<p>You may also pass any options supported by Vagrant&#39;s <a href="https://www.vagrantup.com/docs/synced-folders/basic_usage.html">Synced Folders</a> by listing them under the <code>options</code> key:</p>
<div class="highlight"><pre><span></span><span class="nx">folders</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="o">~</span><span class="err">/code/project1</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;rsync&quot;</span>
      <span class="nx">options</span><span class="o">:</span>
          <span class="nx">rsync__args</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;--archive&quot;</span><span class="p">,</span> <span class="s2">&quot;--delete&quot;</span><span class="p">,</span> <span class="s2">&quot;-zz&quot;</span><span class="p">]</span>
          <span class="nx">rsync__exclude</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;node_modules&quot;</span><span class="p">]</span>
</pre></div>

<h4>Configuring Nginx Sites</h4>

<p>Not familiar with Nginx? No problem. The <code>sites</code> property allows you to easily map a &quot;domain&quot; to a folder on your Homestead environment. A sample site configuration is included in the <code>Homestead.yaml</code> file. Again, you may add as many sites to your Homestead environment as necessary. Homestead can serve as a convenient, virtualized environment for every Laravel project you are working on:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1/public</span>
</pre></div>

<p>If you change the <code>sites</code> property after provisioning the Homestead box, you should re-run <code>vagrant reload --provision</code>  to update the Nginx configuration on the virtual machine.</p>

<blockquote>
<p>{note} Homestead scripts are built to be as idempotent as possible. However, if you are experiencing issues while provisioning you should destroy and rebuild the machine via <code>vagrant destroy &amp;&amp; vagrant up</code>.</p>
</blockquote>

<h4>Enable / Disable Services</h4>

<p>Homestead starts several services by default; however, you may customize which services are enabled or disabled during provisioning. For example, you may enable PostgreSQL and disable MySQL:</p>
<div class="highlight"><pre><span></span><span class="nx">services</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">enabled</span><span class="o">:</span>
        <span class="o">-</span> <span class="s2">&quot;postgresql@12-main&quot;</span>
    <span class="o">-</span> <span class="nx">disabled</span><span class="o">:</span>
        <span class="o">-</span> <span class="s2">&quot;mysql&quot;</span>
</pre></div>

<p>The specified services will be started or stopped based on their order in the <code>enabled</code> and <code>disabled</code> directives.</p>

<p><a name="hostname-resolution"></a></p>

<h4>Hostname Resolution</h4>

<p>Homestead publishes hostnames over <code>mDNS</code> for automatic host resolution. If you set <code>hostname: homestead</code> in your <code>Homestead.yaml</code> file, the host will be available at <code>homestead.local</code>. MacOS, iOS, and Linux desktop distributions include <code>mDNS</code> support by default. Windows requires installing <a href="https://support.apple.com/kb/DL999?viewlocale=en_US&amp;locale=en_US">Bonjour Print Services for Windows</a>.</p>

<p>Using automatic hostnames works best for &quot;per project&quot; installations of Homestead. If you host multiple sites on a single Homestead instance, you may add the &quot;domains&quot; for your web sites to the <code>hosts</code> file on your machine. The <code>hosts</code> file will redirect requests for your Homestead sites into your Homestead machine. On Mac and Linux, this file is located at <code>/etc/hosts</code>. On Windows, it is located at <code>C:\Windows\System32\drivers\etc\hosts</code>. The lines you add to this file will look like the following:</p>
<div class="highlight"><pre><span></span><span class="mf">192.168.10.10</span>  <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
</pre></div>

<p>Make sure the IP address listed is the one set in your <code>Homestead.yaml</code> file. Once you have added the domain to your <code>hosts</code> file and launched the Vagrant box you will be able to access the site via your web browser:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//homestead.test</span>
</pre></div>

<p><a name="launching-the-vagrant-box"></a></p>

<h3>Launching The Vagrant Box</h3>

<p>Once you have edited the <code>Homestead.yaml</code> to your liking, run the <code>vagrant up</code> command from your Homestead directory. Vagrant will boot the virtual machine and automatically configure your shared folders and Nginx sites.</p>

<p>To destroy the machine, you may use the <code>vagrant destroy --force</code> command.</p>

<p><a name="per-project-installation"></a></p>

<h3>Per Project Installation</h3>

<p>Instead of installing Homestead globally and sharing the same Homestead box across all of your projects, you may instead configure a Homestead instance for each project you manage. Installing Homestead per project may be beneficial if you wish to ship a <code>Vagrantfile</code> with your project, allowing others working on the project to <code>vagrant up</code>.</p>

<p>To install Homestead directly into your project, require it using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">homestead</span> <span class="o">--</span><span class="nx">dev</span>
</pre></div>

<p>Once Homestead has been installed, use the <code>make</code> command to generate the <code>Vagrantfile</code> and <code>Homestead.yaml</code> file in your project root. The <code>make</code> command will automatically configure the <code>sites</code> and <code>folders</code> directives in the <code>Homestead.yaml</code> file.</p>

<p>Mac / Linux:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">vendor</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">homestead</span> <span class="nx">make</span>
</pre></div>

<p>Windows:</p>
<div class="highlight"><pre><span></span><span class="nx">vendor</span><span class="err">\\</span><span class="nx">bin</span><span class="err">\\</span><span class="nx">homestead</span> <span class="nx">make</span>
</pre></div>

<p>Next, run the <code>vagrant up</code> command in your terminal and access your project at <code>http://homestead.test</code> in your browser. Remember, you will still need to add an <code>/etc/hosts</code> file entry for <code>homestead.test</code> or the domain of your choice if you are not using automatic <a href="#hostname-resolution">hostname resolution</a>.</p>

<p><a name="installing-optional-features"></a></p>

<h3>Installing Optional Features</h3>

<p>Optional software is installed using the &quot;features&quot; setting in your Homestead configuration file. Most features can be enabled or disabled with a boolean value, while some features allow multiple configuration options:</p>
<div class="highlight"><pre><span></span><span class="nx">features</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">blackfire</span><span class="o">:</span>
        <span class="nx">server_id</span><span class="o">:</span> <span class="s2">&quot;server_id&quot;</span>
        <span class="nx">server_token</span><span class="o">:</span> <span class="s2">&quot;server_value&quot;</span>
        <span class="nx">client_id</span><span class="o">:</span> <span class="s2">&quot;client_id&quot;</span>
        <span class="nx">client_token</span><span class="o">:</span> <span class="s2">&quot;client_value&quot;</span>
    <span class="o">-</span> <span class="nx">cassandra</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">chronograf</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">couchdb</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">crystal</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">docker</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">elasticsearch</span><span class="o">:</span>
        <span class="nx">version</span><span class="o">:</span> <span class="mf">7.9.0</span>
    <span class="o">-</span> <span class="nx">gearman</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">golang</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">grafana</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">influxdb</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">mariadb</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">minio</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">mongodb</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">mysql8</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">neo4j</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">ohmyzsh</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">openresty</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">pm2</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">python</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">rabbitmq</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">solr</span><span class="o">:</span> <span class="kc">true</span>
    <span class="o">-</span> <span class="nx">webdriver</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<h4>MariaDB</h4>

<p>Enabling MariaDB will remove MySQL and install MariaDB. MariaDB serves as a drop-in replacement for MySQL, so you should still use the <code>mysql</code> database driver in your application&#39;s database configuration.</p>

<h4>MongoDB</h4>

<p>The default MongoDB installation will set the database username to <code>homestead</code> and the corresponding password to <code>secret</code>.</p>

<h4>Elasticsearch</h4>

<p>You may specify a supported version of Elasticsearch, which may be a major version or an exact version number (major.minor.patch). The default installation will create a cluster named &#39;homestead&#39;. You should never give Elasticsearch more than half of the operating system&#39;s memory, so make sure your Homestead machine has at least twice the Elasticsearch allocation.</p>

<blockquote>
<p>{tip} Check out the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current">Elasticsearch documentation</a> to learn how to customize your configuration.</p>
</blockquote>

<h4>Neo4j</h4>

<p>The default Neo4j installation will set the database username to <code>homestead</code> and corresponding password to <code>secret</code>. To access the Neo4j browser, visit <code>http://homestead.test:7474</code> via your web browser. The ports <code>7687</code> (Bolt), <code>7474</code> (HTTP), and <code>7473</code> (HTTPS) are ready to serve requests from the Neo4j client.</p>

<p><a name="aliases"></a></p>

<h3>Aliases</h3>

<p>You may add Bash aliases to your Homestead machine by modifying the <code>aliases</code> file within your Homestead directory:</p>
<div class="highlight"><pre><span></span><span class="nx">alias</span> <span class="nx">c</span><span class="o">=</span><span class="s1">&#39;clear&#39;</span>
<span class="nx">alias</span> <span class="p">..</span><span class="o">=</span><span class="s1">&#39;cd ..&#39;</span>
</pre></div>

<p>After you have updated the <code>aliases</code> file, you should re-provision the Homestead machine using the <code>vagrant reload --provision</code> command. This will ensure that your new aliases are available on the machine.</p>

<p><a name="daily-usage"></a></p>

<h2>Daily Usage</h2>

<p><a name="accessing-homestead-globally"></a></p>

<h3>Accessing Homestead Globally</h3>

<p>Sometimes you may want to <code>vagrant up</code> your Homestead machine from anywhere on your filesystem. You can do this on Mac / Linux systems by adding a Bash function to your Bash profile. On Windows, you may accomplish this by adding a &quot;batch&quot; file to your <code>PATH</code>. These scripts will allow you to run any Vagrant command from anywhere on your system and will automatically point that command to your Homestead installation:</p>

<h4>Mac / Linux</h4>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">homestead</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">(</span> <span class="nx">cd</span> <span class="o">~</span><span class="err">/Homestead &amp;&amp; vagrant $* )</span>
<span class="p">}</span>
</pre></div>

<p>Make sure to tweak the <code>~/Homestead</code> path in the function to the location of your actual Homestead installation. Once the function is installed, you may run commands like <code>homestead up</code> or <code>homestead ssh</code> from anywhere on your system.</p>

<h4>Windows</h4>

<p>Create a <code>homestead.bat</code> batch file anywhere on your machine with the following contents:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">echo</span> <span class="nx">off</span>

<span class="nx">set</span> <span class="nx">cwd</span><span class="o">=%</span><span class="nx">cd</span><span class="o">%</span>
<span class="nx">set</span> <span class="nx">homesteadVagrant</span><span class="o">=</span><span class="nx">C</span><span class="o">:</span><span class="err">\</span><span class="nx">Homestead</span>

<span class="nx">cd</span> <span class="o">/</span><span class="nx">d</span> <span class="o">%</span><span class="nx">homesteadVagrant</span><span class="o">%</span> <span class="o">&amp;&amp;</span> <span class="nx">vagrant</span> <span class="o">%*</span>
<span class="nx">cd</span> <span class="o">/</span><span class="nx">d</span> <span class="o">%</span><span class="nx">cwd</span><span class="o">%</span>

<span class="nx">set</span> <span class="nx">cwd</span><span class="o">=</span>
<span class="nx">set</span> <span class="nx">homesteadVagrant</span><span class="o">=</span>
</pre></div>

<p>Make sure to tweak the example <code>C:\Homestead</code> path in the script to the actual location of your Homestead installation. After creating the file, add the file location to your <code>PATH</code>. You may then run commands like <code>homestead up</code> or <code>homestead ssh</code> from anywhere on your system.</p>

<p><a name="connecting-via-ssh"></a></p>

<h3>Connecting Via SSH</h3>

<p>You can SSH into your virtual machine by issuing the <code>vagrant ssh</code> terminal command from your Homestead directory.</p>

<p>But, since you will probably need to SSH into your Homestead machine frequently, consider adding the &quot;function&quot; described above to your host machine to quickly SSH into the Homestead box.</p>

<p><a name="connecting-to-databases"></a></p>

<h3>Connecting To Databases</h3>

<p>A <code>homestead</code> database is configured for both MySQL and PostgreSQL out of the box. To connect to your MySQL or PostgreSQL database from your host machine&#39;s database client, you should connect to <code>127.0.0.1</code> and port <code>33060</code> (MySQL) or <code>54320</code> (PostgreSQL). The username and password for both databases is <code>homestead</code> / <code>secret</code>.</p>

<blockquote>
<p>{note} You should only use these non-standard ports when connecting to the databases from your host machine. You will use the default 3306 and 5432 ports in your Laravel database configuration file since Laravel is running <em>within</em> the virtual machine.</p>
</blockquote>

<p><a name="database-backups"></a></p>

<h3>Database Backups</h3>

<p>Homestead can automatically backup your database when your Vagrant box is destroyed. To utilize this feature, you must be using Vagrant 2.1.0 or greater. Or, if you are using an older version of Vagrant, you must install the <code>vagrant-triggers</code> plug-in. To enable automatic database backups, add the following line to your <code>Homestead.yaml</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">backup</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>Once configured, Homestead will export your databases to <code>mysql_backup</code> and <code>postgres_backup</code> directories when the <code>vagrant destroy</code> command is executed. These directories can be found in the folder where you cloned Homestead or in the root of your project if you are using the <a href="#per-project-installation">per project installation</a> method.</p>

<p><a name="database-snapshots"></a></p>

<h3>Database Snapshots</h3>

<p>Homestead supports freezing the state of MySQL and MariaDB databases and branching between them using <a href="https://github.com/Lullabot/lmm">Logical MySQL Manager</a>. For example, imagine working on a site with a multi-gigabyte database. You can import the database and take a snapshot. After doing some work and creating some test content locally, you may quickly restore back to the original state.</p>

<p>Under the hood, LMM uses LVM&#39;s thin snapshot functionality with copy-on-write support. In practice, this means that changing a single row in a table will only cause the changes you made to be written to disk, saving significant time and disk space during restores.</p>

<p>Since <code>lmm</code> interacts with LVM, it must be run as <code>root</code>. To see all available commands, run <code>sudo lmm</code> inside your Vagrant box. A common workflow looks like the following:</p>

<ol>
<li>Import a database into the default <code>master</code> lmm branch.</li>
<li>Save a snapshot of the unchanged database using <code>sudo lmm branch prod-YYYY-MM-DD</code>.</li>
<li>Modify the database.</li>
<li>Run <code>sudo lmm merge prod-YYYY-MM-DD</code> to undo all changes.</li>
<li>Run <code>sudo lmm delete &lt;branch&gt;</code> to delete unneeded branches.</li>
</ol>

<p><a name="adding-additional-sites"></a></p>

<h3>Adding Additional Sites</h3>

<p>Once your Homestead environment is provisioned and running, you may want to add additional Nginx sites for your Laravel applications. You can run as many Laravel installations as you wish on a single Homestead environment. To add an additional site, add the site to your <code>Homestead.yaml</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1/public</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">another</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project2/public</span>
</pre></div>

<p>If Vagrant is not automatically managing your &quot;hosts&quot; file, you may need to add the new site to that file as well:</p>
<div class="highlight"><pre><span></span><span class="mf">192.168.10.10</span>  <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
<span class="mf">192.168.10.10</span>  <span class="nx">another</span><span class="p">.</span><span class="nx">test</span>
</pre></div>

<p>Once the site has been added, run the <code>vagrant reload --provision</code> command from your Homestead directory.</p>

<p><a name="site-types"></a></p>

<h4>Site Types</h4>

<p>Homestead supports several types of sites which allow you to easily run projects that are not based on Laravel. For example, we may easily add a Symfony application to Homestead using the <code>symfony2</code> site type:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">symfony2</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/my-symfony-project/web</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;symfony2&quot;</span>
</pre></div>

<p>The available site types are: <code>apache</code>, <code>apigility</code>, <code>expressive</code>, <code>laravel</code> (the default), <code>proxy</code>, <code>silverstripe</code>, <code>statamic</code>, <code>symfony2</code>, <code>symfony4</code>, and <code>zf</code>.</p>

<p><a name="site-parameters"></a></p>

<h4>Site Parameters</h4>

<p>You may add additional Nginx <code>fastcgi_param</code> values to your site via the <code>params</code> site directive. For example, we&#39;ll add a <code>FOO</code> parameter with a value of <code>BAR</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1/public</span>
      <span class="nx">params</span><span class="o">:</span>
          <span class="o">-</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">FOO</span>
            <span class="nx">value</span><span class="o">:</span> <span class="nx">BAR</span>
</pre></div>

<p><a name="environment-variables"></a></p>

<h3>Environment Variables</h3>

<p>You can set global environment variables by adding them to your <code>Homestead.yaml</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">variables</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">APP_ENV</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">local</span>
    <span class="o">-</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">FOO</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">bar</span>
</pre></div>

<p>After updating the <code>Homestead.yaml</code>, be sure to re-provision the machine by running <code>vagrant reload --provision</code>. This will update the PHP-FPM configuration for all of the installed PHP versions and also update the environment for the <code>vagrant</code> user.</p>

<p><a name="wildcard-ssl"></a></p>

<h3>Wildcard SSL</h3>

<p>Homestead configures a self-signed SSL certificate for each site defined in the <code>sites:</code> section of your <code>Homestead.yaml</code> file. If you would like to generate a wildcard SSL certificate for a site you may add a <code>wildcard</code> option to that site&#39;s configuration. By default, the site will use the wildcard certificate <em>instead</em> of the specific domain certificate:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">domain</span><span class="p">.</span><span class="nx">test</span>
  <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/domain</span>
  <span class="nx">wildcard</span><span class="o">:</span> <span class="s2">&quot;yes&quot;</span>
</pre></div>

<p>If the <code>use_wildcard</code> option is set to <code>no</code>, the wildcard certificate will be generated but will not be used:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">domain</span><span class="p">.</span><span class="nx">test</span>
  <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/domain</span>
  <span class="nx">wildcard</span><span class="o">:</span> <span class="s2">&quot;yes&quot;</span>
  <span class="nx">use_wildcard</span><span class="o">:</span> <span class="s2">&quot;no&quot;</span>
</pre></div>

<p><a name="configuring-cron-schedules"></a></p>

<h3>Configuring Cron Schedules</h3>

<p>Laravel provides a convenient way to <a href="/docs/%7B%7Bversion%7D%7D/scheduling">schedule Cron jobs</a> by scheduling a single <code>schedule:run</code> Artisan command to be run every minute. The <code>schedule:run</code> command will examine the job schedule defined in your <code>App\Console\Kernel</code> class to determine which jobs should be run.</p>

<p>If you would like the <code>schedule:run</code> command to be run for a Homestead site, you may set the <code>schedule</code> option to <code>true</code> when defining the site:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1/public</span>
      <span class="nx">schedule</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>The Cron job for the site will be defined in the <code>/etc/cron.d</code> folder of the virtual machine.</p>

<p><a name="configuring-mailhog"></a></p>

<h3>Configuring Mailhog</h3>

<p>Mailhog allows you to easily catch your outgoing email and examine it without actually sending the mail to its recipients. To get started, update your <code>.env</code> file to use the following mail settings:</p>
<div class="highlight"><pre><span></span><span class="nx">MAIL_MAILER</span><span class="o">=</span><span class="nx">smtp</span>
<span class="nx">MAIL_HOST</span><span class="o">=</span><span class="nx">localhost</span>
<span class="nx">MAIL_PORT</span><span class="o">=</span><span class="mi">1025</span>
<span class="nx">MAIL_USERNAME</span><span class="o">=</span><span class="kc">null</span>
<span class="nx">MAIL_PASSWORD</span><span class="o">=</span><span class="kc">null</span>
<span class="nx">MAIL_ENCRYPTION</span><span class="o">=</span><span class="kc">null</span>
</pre></div>

<p>Once Mailhog has been configured, you may access the Mailhog dashboard at <code>http://localhost:8025</code>.</p>

<p><a name="configuring-minio"></a></p>

<h3>Configuring Minio</h3>

<p>Minio is an open source object storage server with an Amazon S3 compatible API. To install Minio, update your <code>Homestead.yaml</code> file with the following configuration option in the <a href="#installing-optional-features">features</a> section:</p>
<div class="highlight"><pre><span></span><span class="nx">minio</span><span class="o">:</span> <span class="kc">true</span>
</pre></div>

<p>By default, Minio is available on port 9600. You may access the Minio control panel by visiting <code>http://localhost:9600/</code>. The default access key is <code>homestead</code>, while the default secret key is <code>secretkey</code>. When accessing Minio, you should always use region <code>us-east-1</code>.</p>

<p>In order to use Minio you will need to adjust the S3 disk configuration in your <code>config/filesystems.php</code> configuration file. You will need to add the <code>use_path_style_endpoint</code> option to the disk configuration, as well as change the <code>url</code> key to <code>endpoint</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;s3&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span><span class="p">),</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class="p">),</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_DEFAULT_REGION&#39;</span><span class="p">),</span>
    <span class="s1">&#39;bucket&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_BUCKET&#39;</span><span class="p">),</span>
    <span class="s1">&#39;endpoint&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;AWS_URL&#39;</span><span class="p">),</span>
    <span class="s1">&#39;use_path_style_endpoint&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

<p>Finally, ensure your <code>.env</code> file has the following options:</p>
<div class="highlight"><pre><span></span><span class="nx">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="nx">homestead</span>
<span class="nx">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="nx">secretkey</span>
<span class="nx">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="nx">us</span><span class="o">-</span><span class="nx">east</span><span class="o">-</span><span class="mi">1</span>
<span class="nx">AWS_URL</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:9600</span>
</pre></div>

<p>To provision buckets, add a <code>buckets</code> directive to your Homestead configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">buckets</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">bucket</span>
      <span class="nx">policy</span><span class="o">:</span> <span class="kr">public</span>
    <span class="o">-</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="kr">private</span><span class="o">-</span><span class="nx">bucket</span>
      <span class="nx">policy</span><span class="o">:</span> <span class="nx">none</span>
</pre></div>

<p>Supported <code>policy</code> values include: <code>none</code>, <code>download</code>, <code>upload</code>, and <code>public</code>.</p>

<p><a name="ports"></a></p>

<h3>Ports</h3>

<p>By default, the following ports are forwarded to your Homestead environment:</p>

<div class="content-list" markdown="1">
- **SSH:** 2222 &rarr; Forwards To 22
- **ngrok UI:** 4040 &rarr; Forwards To 4040
- **HTTP:** 8000 &rarr; Forwards To 80
- **HTTPS:** 44300 &rarr; Forwards To 443
- **MySQL:** 33060 &rarr; Forwards To 3306
- **PostgreSQL:** 54320 &rarr; Forwards To 5432
- **MongoDB:** 27017 &rarr; Forwards To 27017
- **Mailhog:** 8025 &rarr; Forwards To 8025
- **Minio:** 9600 &rarr; Forwards To 9600
</div>

<h4>Forwarding Additional Ports</h4>

<p>If you wish, you may forward additional ports to the Vagrant box, as well as specify their protocol:</p>
<div class="highlight"><pre><span></span><span class="nx">ports</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">50000</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">5000</span>
    <span class="o">-</span> <span class="nx">send</span><span class="o">:</span> <span class="mi">7777</span>
      <span class="nx">to</span><span class="o">:</span> <span class="mi">777</span>
      <span class="nx">protocol</span><span class="o">:</span> <span class="nx">udp</span>
</pre></div>

<p><a name="sharing-your-environment"></a></p>

<h3>Sharing Your Environment</h3>

<p>Sometimes you may wish to share what you&#39;re currently working on with coworkers or a client. Vagrant has a built-in way to support this via <code>vagrant share</code>; however, this will not work if you have multiple sites configured in your <code>Homestead.yaml</code> file.</p>

<p>To solve this problem, Homestead includes its own <code>share</code> command. To get started, SSH into your Homestead machine via <code>vagrant ssh</code> and run <code>share homestead.test</code>. This will share the <code>homestead.test</code> site from your <code>Homestead.yaml</code> configuration file. You may substitute any of your other configured sites for <code>homestead.test</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">share</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
</pre></div>

<p>After running the command, you will see an Ngrok screen appear which contains the activity log and the publicly accessible URLs for the shared site. If you would like to specify a custom region, subdomain, or other Ngrok runtime option, you may add them to your <code>share</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">share</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span> <span class="o">-</span><span class="nx">region</span><span class="o">=</span><span class="nx">eu</span> <span class="o">-</span><span class="nx">subdomain</span><span class="o">=</span><span class="nx">laravel</span>
</pre></div>

<blockquote>
<p>{note} Remember, Vagrant is inherently insecure and you are exposing your virtual machine to the Internet when running the <code>share</code> command.</p>
</blockquote>

<p><a name="multiple-php-versions"></a></p>

<h3>Multiple PHP Versions</h3>

<p>Homestead 6 introduced support for multiple versions of PHP on the same virtual machine. You may specify which version of PHP to use for a given site within your <code>Homestead.yaml</code> file. The available PHP versions are: &quot;5.6&quot;, &quot;7.0&quot;, &quot;7.1&quot;, &quot;7.2&quot;, &quot;7.3&quot;, and &quot;7.4&quot; (the default):</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">map</span><span class="o">:</span> <span class="nx">homestead</span><span class="p">.</span><span class="nx">test</span>
      <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/project1/public</span>
      <span class="nx">php</span><span class="o">:</span> <span class="s2">&quot;7.1&quot;</span>
</pre></div>

<p>In addition, you may use any of the supported PHP versions via the CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php5</span><span class="mf">.6</span> <span class="nx">artisan</span> <span class="nx">list</span>
<span class="nx">php7</span><span class="mf">.0</span> <span class="nx">artisan</span> <span class="nx">list</span>
<span class="nx">php7</span><span class="mf">.1</span> <span class="nx">artisan</span> <span class="nx">list</span>
<span class="nx">php7</span><span class="mf">.2</span> <span class="nx">artisan</span> <span class="nx">list</span>
<span class="nx">php7</span><span class="mf">.3</span> <span class="nx">artisan</span> <span class="nx">list</span>
<span class="nx">php7</span><span class="mf">.4</span> <span class="nx">artisan</span> <span class="nx">list</span>
</pre></div>

<p>You may also update the default CLI version by issuing the following commands from within your Homestead virtual machine:</p>
<div class="highlight"><pre><span></span><span class="nx">php56</span>
<span class="nx">php70</span>
<span class="nx">php71</span>
<span class="nx">php72</span>
<span class="nx">php73</span>
<span class="nx">php74</span>
</pre></div>

<p><a name="web-servers"></a></p>

<h3>Web Servers</h3>

<p>Homestead uses the Nginx web server by default. However, it can install Apache if <code>apache</code> is specified as a site type. While both web servers can be installed at the same time, they cannot both be <em>running</em> at the same time. The <code>flip</code> shell command is available to ease the process of switching between web servers. The <code>flip</code> command automatically determines which web server is running, shuts it off, and then starts the other server. To use this command, SSH into your Homestead machine and run the command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">flip</span>
</pre></div>

<p><a name="mail"></a></p>

<h3>Mail</h3>

<p>Homestead includes the Postfix mail transfer agent, which is listening on port <code>1025</code> by default. So, you may instruct your application to use the <code>smtp</code> mail driver on <code>localhost</code> port <code>1025</code>. Then, all sent mail will be handled by Postfix and caught by Mailhog. To view your sent emails, open <a href="http://localhost:8025">http://localhost:8025</a> in your web browser.</p>

<p><a name="debugging-and-profiling"></a></p>

<h2>Debugging &amp; Profiling</h2>

<p><a name="debugging-web-requests"></a></p>

<h3>Debugging Web Requests With Xdebug</h3>

<p>Homestead includes support for step debugging using <a href="https://xdebug.org">Xdebug</a>. For example, you can load a web page from a browser, and PHP will connect to your IDE to allow inspection and modification of the running code.</p>

<p>By default Xdebug is already running and ready to accept connections. If you need to enable Xdebug on the CLI run the <code>sudo phpenmod xdebug</code> command within your Vagrant box. Next, follow your IDE&#39;s instructions to enable debugging. Finally, configure your browser to trigger Xdebug with an extension or <a href="https://www.jetbrains.com/phpstorm/marklets/">bookmarklet</a>.</p>

<blockquote>
<p>{note} Xdebug causes PHP to run significantly slower. To disable Xdebug, run <code>sudo phpdismod xdebug</code> within your Vagrant box and restart the FPM service.</p>
</blockquote>

<p><a name="debugging-cli-applications"></a></p>

<h3>Debugging CLI Applications</h3>

<p>To debug a PHP CLI application, use the <code>xphp</code> shell alias inside your Vagrant box:</p>
<div class="highlight"><pre><span></span><span class="nx">xphp</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">script</span>
</pre></div>

<h4>Autostarting Xdebug</h4>

<p>When debugging functional tests that make requests to the web server, it is easier to autostart debugging rather than modifying tests to pass through a custom header or cookie to trigger debugging. To force Xdebug to start automatically, modify <code>/etc/php/7.x/fpm/conf.d/20-xdebug.ini</code> inside your Vagrant box and add the following configuration:</p>
<div class="highlight"><pre><span></span><span class="p">;</span> <span class="nx">If</span> <span class="nx">Homestead</span><span class="p">.</span><span class="nx">yaml</span> <span class="nx">contains</span> <span class="nx">a</span> <span class="nx">different</span> <span class="nx">subnet</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">IP</span> <span class="nx">address</span><span class="p">,</span> <span class="k">this</span> <span class="nx">address</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">different</span><span class="p">...</span>
<span class="nx">xdebug</span><span class="p">.</span><span class="nx">remote_host</span> <span class="o">=</span> <span class="mf">192.168.10.1</span>
<span class="nx">xdebug</span><span class="p">.</span><span class="nx">remote_autostart</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p><a name="profiling-applications-with-blackfire"></a></p>

<h3>Profiling Applications with Blackfire</h3>

<p><a href="https://blackfire.io/docs/introduction">Blackfire</a> is a SaaS service for profiling web requests and CLI applications and writing performance assertions. It offers an interactive user interface which displays profile data in call-graphs and timelines. It is built for use in development, staging, and production, with no overhead for end users. It provides performance, quality, and security checks on code and <code>php.ini</code> configuration settings.</p>

<p>The <a href="https://blackfire.io/docs/player/index">Blackfire Player</a> is an open-source Web Crawling, Web Testing and Web Scraping application which can work jointly with Blackfire in order to script profiling scenarios.</p>

<p>To enable Blackfire, use the &quot;features&quot; setting in your Homestead configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">features</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">blackfire</span><span class="o">:</span>
        <span class="nx">server_id</span><span class="o">:</span> <span class="s2">&quot;server_id&quot;</span>
        <span class="nx">server_token</span><span class="o">:</span> <span class="s2">&quot;server_value&quot;</span>
        <span class="nx">client_id</span><span class="o">:</span> <span class="s2">&quot;client_id&quot;</span>
        <span class="nx">client_token</span><span class="o">:</span> <span class="s2">&quot;client_value&quot;</span>
</pre></div>

<p>Blackfire server credentials and client credentials <a href="https://blackfire.io/signup">require a user account</a>. Blackfire offers various options to profile an application, including a CLI tool and browser extension. Please <a href="https://blackfire.io/docs/cookbooks/index">review the Blackfire documentation for more details</a>.</p>

<h3>Profiling PHP Performance Using XHGui</h3>

<p><a href="https://www.github.com/perftools/xhgui">XHGui</a> is a user interface for exploring the performance of your PHP applications. To enable XHGui, add <code>xhgui: &#39;true&#39;</code> to your site configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">sites</span><span class="o">:</span>
    <span class="o">-</span>
        <span class="nx">map</span><span class="o">:</span> <span class="nx">your</span><span class="o">-</span><span class="nx">site</span><span class="p">.</span><span class="nx">test</span>
        <span class="nx">to</span><span class="o">:</span> <span class="err">/home/vagrant/your-site/public</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;apache&quot;</span>
        <span class="nx">xhgui</span><span class="o">:</span> <span class="s1">&#39;true&#39;</span>
</pre></div>

<p>If the site already exists, make sure to run <code>vagrant provision</code> after updating your configuration.</p>

<p>To profile a web request, add <code>xhgui=on</code> as a query parameter to a request. XHGui will automatically attach a cookie to the response so that subsequent requests do not need the query string value. You may view your application profile results by browsing to <code>http://your-site.test/xhgui</code>.</p>

<p>To profile a CLI request using XHGui, prefix the command with <code>XHGUI=on</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">XHGUI</span><span class="o">=</span><span class="nx">on</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">script</span>
</pre></div>

<p>CLI profile results may be viewed in the same way as web profile results.</p>

<p>Note that the act of profiling slows down script execution, and absolute times may be as much as twice as real-world requests. Therefore, always compare percentage improvements and not absolute numbers. Also, be aware the execution time includes any time spent paused in a debugger.</p>

<p>Since performance profiles take up significant disk space, they are deleted automatically after a few days.</p>

<p><a name="network-interfaces"></a></p>

<h2>Network Interfaces</h2>

<p>The <code>networks</code> property of the <code>Homestead.yaml</code> configures network interfaces for your Homestead environment. You may configure as many interfaces as necessary:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;private_network&quot;</span>
      <span class="nx">ip</span><span class="o">:</span> <span class="s2">&quot;192.168.10.20&quot;</span>
</pre></div>

<p>To enable a <a href="https://www.vagrantup.com/docs/networking/public_network.html">bridged</a> interface, configure a <code>bridge</code> setting and change the network type to <code>public_network</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;public_network&quot;</span>
      <span class="nx">ip</span><span class="o">:</span> <span class="s2">&quot;192.168.10.20&quot;</span>
      <span class="nx">bridge</span><span class="o">:</span> <span class="s2">&quot;en1: Wi-Fi (AirPort)&quot;</span>
</pre></div>

<p>To enable <a href="https://www.vagrantup.com/docs/networking/public_network.html">DHCP</a>, just remove the <code>ip</code> option from your configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">networks</span><span class="o">:</span>
    <span class="o">-</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;public_network&quot;</span>
      <span class="nx">bridge</span><span class="o">:</span> <span class="s2">&quot;en1: Wi-Fi (AirPort)&quot;</span>
</pre></div>

<p><a name="extending-homestead"></a></p>

<h2>Extending Homestead</h2>

<p>You may extend Homestead using the <code>after.sh</code> script in the root of your Homestead directory. Within this file, you may add any shell commands that are necessary to properly configure and customize your virtual machine.</p>

<p>When customizing Homestead, Ubuntu may ask you if you would like to keep a package&#39;s original configuration or overwrite it with a new configuration file. To avoid this, you should use the following command when installing packages to avoid overwriting any configuration previously written by Homestead:</p>
<div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="o">-</span><span class="nx">y</span> <span class="o">\</span>
    <span class="o">-</span><span class="nx">o</span> <span class="nx">Dpkg</span><span class="o">::</span><span class="nx">Options</span><span class="o">::=</span><span class="s2">&quot;--force-confdef&quot;</span> <span class="o">\</span>
    <span class="o">-</span><span class="nx">o</span> <span class="nx">Dpkg</span><span class="o">::</span><span class="nx">Options</span><span class="o">::=</span><span class="s2">&quot;--force-confold&quot;</span> <span class="o">\</span>
    <span class="nx">install</span> <span class="nx">your</span><span class="o">-</span><span class="kr">package</span>
</pre></div>

<h3>User Customizations</h3>

<p>When using Homestead in a team setting, you may want to tweak Homestead to better fit your personal development style. You may create a <code>user-customizations.sh</code> file in the root of your Homestead directory (The same directory containing your <code>Homestead.yaml</code>). Within this file, you may make any customization you would like; however, the <code>user-customizations.sh</code> should not be version controlled.</p>

<p><a name="updating-homestead"></a></p>

<h2>Updating Homestead</h2>

<p>Before you begin updating Homestead ensure you have removed your current virtual machine by running the following command in your Homestead directory:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">destroy</span>
</pre></div>

<p>Next, you need to update the Homestead source code. If you cloned the repository you can run the following commands at the location you originally cloned the repository:</p>
<div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">fetch</span>

<span class="nx">git</span> <span class="nx">pull</span> <span class="nx">origin</span> <span class="nx">release</span>
</pre></div>

<p>These commands pull the latest Homestead code from the GitHub repository, fetches the latest tags, and then checks out the latest tagged release. You can find the latest stable release version on the <a href="https://github.com/laravel/homestead/releases">GitHub releases page</a>.</p>

<p>If you have installed Homestead via your project&#39;s <code>composer.json</code> file, you should ensure your <code>composer.json</code> file contains <code>&quot;laravel/homestead&quot;: &quot;^11&quot;</code> and update your dependencies:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">update</span>
</pre></div>

<p>Then, you should update the Vagrant box using the <code>vagrant box update</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">update</span>
</pre></div>

<p>Next, you should run the <code>bash init.sh</code> command from the Homestead directory in order to update some additional configuration files. You will be asked whether you wish to overwrite your existing <code>Homestead.yaml</code>, <code>after.sh</code>, and <code>aliases</code> files:</p>
<div class="highlight"><pre><span></span><span class="c1">// Mac / Linux...</span>
<span class="nx">bash</span> <span class="nx">init</span><span class="p">.</span><span class="nx">sh</span>

<span class="c1">// Windows...</span>
<span class="nx">init</span><span class="p">.</span><span class="nx">bat</span>
</pre></div>

<p>Finally, you will need to regenerate your Homestead box to utilize the latest Vagrant installation:</p>
<div class="highlight"><pre><span></span><span class="nx">vagrant</span> <span class="nx">up</span>
</pre></div>

<p><a name="provider-specific-settings"></a></p>

<h2>Provider Specific Settings</h2>

<p><a name="provider-specific-virtualbox"></a></p>

<h3>VirtualBox</h3>

<h4><code>natdnshostresolver</code></h4>

<p>By default, Homestead configures the <code>natdnshostresolver</code> setting to <code>on</code>. This allows Homestead to use your host operating system&#39;s DNS settings. If you would like to override this behavior, add the following lines to your <code>Homestead.yaml</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">provider</span><span class="o">:</span> <span class="nx">virtualbox</span>
<span class="nx">natdnshostresolver</span><span class="o">:</span> <span class="s1">&#39;off&#39;</span>
</pre></div>

<h4>Symbolic Links On Windows</h4>

<p>If symbolic links are not working properly on your Windows machine, you may need to add the following block to your <code>Vagrantfile</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">config</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="nx">v</span><span class="o">|</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">customize</span> <span class="p">[</span><span class="s2">&quot;setextradata&quot;</span><span class="p">,</span> <span class="o">:</span><span class="nx">id</span><span class="p">,</span> <span class="s2">&quot;VBoxInternal2/SharedFoldersEnableSymlinksCreate/v-root&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]</span>
<span class="nx">end</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Client</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#making-requests">Making Requests</a>

<ul>
<li><a href="#request-data">Request Data</a></li>
<li><a href="#headers">Headers</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#timeout">Timeout</a></li>
<li><a href="#retries">Retries</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#guzzle-options">Guzzle Options</a></li>
</ul></li>
<li><a href="#testing">Testing</a>

<ul>
<li><a href="#faking-responses">Faking Responses</a></li>
<li><a href="#inspecting-requests">Inspecting Requests</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides an expressive, minimal API around the <a href="http://docs.guzzlephp.org/en/stable/">Guzzle HTTP client</a>, allowing you to quickly make outgoing HTTP requests to communicate with other web applications. Laravel&#39;s wrapper around Guzzle is focused on its most common use cases and a wonderful developer experience.</p>

<p>Before getting started, you should ensure that you have installed the Guzzle package as a dependency of your application. By default, Laravel automatically includes this dependency:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">guzzlehttp</span><span class="o">/</span><span class="nx">guzzle</span>
</pre></div>

<p><a name="making-requests"></a></p>

<h2>Making Requests</h2>

<p>To make requests, you may use the <code>get</code>, <code>post</code>, <code>put</code>, <code>patch</code>, and <code>delete</code> methods. First, let&#39;s examine how to make a basic <code>GET</code> request:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Http</span><span class="p">;</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://test.com&#39;</span><span class="p">);</span>
</pre></div>

<p>The <code>get</code> method returns an instance of <code>Illuminate\Http\Client\Response</code>, which provides a variety of methods that may be used to inspect the response:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">body</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">()</span> <span class="o">:</span> <span class="nx">array</span><span class="o">|</span><span class="nx">mixed</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">status</span><span class="p">()</span> <span class="o">:</span> <span class="kr">int</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">ok</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">successful</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">failed</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">serverError</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">clientError</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="nx">$header</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">headers</span><span class="p">()</span> <span class="o">:</span> <span class="nx">array</span><span class="p">;</span>
</pre></div>

<p>The <code>Illuminate\Http\Client\Response</code> object also implements the PHP <code>ArrayAccess</code> interface, allowing you to access JSON response data directly on the response:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://test.com/users/1&#39;</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</pre></div>

<p><a name="request-data"></a></p>

<h3>Request Data</h3>

<p>Of course, it is common when using <code>POST</code>, <code>PUT</code>, and <code>PATCH</code> to send additional data with your request. So, these methods accept an array of data as their second argument. By default, data will be sent using the <code>application/json</code> content type:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span>
    <span class="s1">&#39;role&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Network Administrator&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>GET Request Query Parameters</h4>

<p>When making <code>GET</code> requests, you may either append a query string to the URL directly or pass an array of key / value pairs as the second argument to the <code>get</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>Sending Form URL Encoded Requests</h4>

<p>If you would like to send data using the <code>application/x-www-form-urlencoded</code> content type, you should call the <code>asForm</code> method before making your request:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Sara&#39;</span><span class="p">,</span>
    <span class="s1">&#39;role&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Privacy Consultant&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>Sending A Raw Request Body</h4>

<p>You may use the <code>withBody</code> method if you would like to provide a raw request body when making a request:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withBody</span><span class="p">(</span>
    <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">$photo</span><span class="p">),</span> <span class="s1">&#39;image/jpeg&#39;</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/photo&#39;</span><span class="p">);</span>
</pre></div>

<h4>Multi-Part Requests</h4>

<p>If you would like to send files as multi-part requests, you should call the <code>attach</code> method before making your request. This method accepts the name of the file and its contents. Optionally, you may provide a third argument which will be considered the file&#39;s filename:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">attach</span><span class="p">(</span>
    <span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">),</span> <span class="s1">&#39;photo.jpg&#39;</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/attachments&#39;</span><span class="p">);</span>
</pre></div>

<p>Instead of passing the raw contents of a file, you may also pass a stream resource:</p>
<div class="highlight"><pre><span></span><span class="nx">$photo</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">attach</span><span class="p">(</span>
    <span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="nx">$photo</span><span class="p">,</span> <span class="s1">&#39;photo.jpg&#39;</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/attachments&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="headers"></a></p>

<h3>Headers</h3>

<p>Headers may be added to requests using the <code>withHeaders</code> method. This <code>withHeaders</code> method accepts an array of key / value pairs:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withHeaders</span><span class="p">([</span>
    <span class="s1">&#39;X-First&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X-Second&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="authentication"></a></p>

<h3>Authentication</h3>

<p>You may specify basic and digest authentication credentials using the <code>withBasicAuth</code> and <code>withDigestAuth</code> methods, respectively:</p>
<div class="highlight"><pre><span></span><span class="c1">// Basic authentication...</span>
<span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withBasicAuth</span><span class="p">(</span><span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(...);</span>

<span class="c1">// Digest authentication...</span>
<span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withDigestAuth</span><span class="p">(</span><span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(...);</span>
</pre></div>

<h4>Bearer Tokens</h4>

<p>If you would like to quickly add an <code>Authorization</code> bearer token header to the request, you may use the <code>withToken</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withToken</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(...);</span>
</pre></div>

<p><a name="timeout"></a></p>

<h3>Timeout</h3>

<p>The <code>timeout</code> method may be used to specify the maximum number of seconds to wait for a response:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(...);</span>
</pre></div>

<p>If the given timeout is exceeded, an instance of <code>Illuminate\Http\Client\ConnectionException</code> will  be thrown.</p>

<p><a name="retries"></a></p>

<h3>Retries</h3>

<p>If you would like HTTP client to automatically retry the request if a client or server error occurs, you may use the <code>retry</code> method. The <code>retry</code> method accepts two arguments: the number of times the request should be attempted and the number of milliseconds that Laravel should wait in between attempts:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(...);</span>
</pre></div>

<p>If all of the requests fail, an instance of <code>Illuminate\Http\Client\RequestException</code> will be thrown.</p>

<p><a name="error-handling"></a></p>

<h3>Error Handling</h3>

<p>Unlike Guzzle&#39;s default behavior, Laravel&#39;s HTTP client wrapper does not throw exceptions on client or server errors (<code>400</code> and <code>500</code> level responses from servers). You may determine if one of these errors was returned using the <code>successful</code>, <code>clientError</code>, or <code>serverError</code> methods:</p>
<div class="highlight"><pre><span></span><span class="c1">// Determine if the status code was &gt;= 200 and &lt; 300...</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">successful</span><span class="p">();</span>

<span class="c1">// Determine if the status code was &gt;= 400...</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">failed</span><span class="p">();</span>

<span class="c1">// Determine if the response has a 400 level status code...</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">clientError</span><span class="p">();</span>

<span class="c1">// Determine if the response has a 500 level status code...</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">serverError</span><span class="p">();</span>
</pre></div>

<h4>Throwing Exceptions</h4>

<p>If you have a response instance and would like to throw an instance of <code>Illuminate\Http\Client\RequestException</code> if the response is a client or server error, you may use the <code>throw</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">post</span><span class="p">(...);</span>

<span class="c1">// Throw an exception if a client or server error occurred...</span>
<span class="nx">$response</span><span class="o">-&gt;</span><span class="k">throw</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$response</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</pre></div>

<p>The <code>Illuminate\Http\Client\RequestException</code> instance has a public <code>$response</code> property which will allow you to inspect the returned response.</p>

<p>The <code>throw</code> method returns the response instance if no error occurred, allowing you to chain other operations onto the <code>throw</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">post</span><span class="p">(...)</span><span class="o">-&gt;</span><span class="k">throw</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">();</span>
</pre></div>

<p><a name="guzzle-options"></a></p>

<h3>Guzzle Options</h3>

<p>You may specify additional <a href="http://docs.guzzlephp.org/en/stable/request-options.html">Guzzle request options</a> using the <code>withOptions</code> method. The <code>withOptions</code> method accepts an array of key / value pairs:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">withOptions</span><span class="p">([</span>
    <span class="s1">&#39;debug&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="testing"></a></p>

<h2>Testing</h2>

<p>Many Laravel services provide functionality to help you easily and expressively write tests, and Laravel&#39;s HTTP wrapper is no exception. The <code>Http</code> facade&#39;s <code>fake</code> method allows you to instruct the HTTP client to return stubbed / dummy responses when requests are made.</p>

<p><a name="faking-responses"></a></p>

<h3>Faking Responses</h3>

<p>For example, to instruct the HTTP client to return empty, <code>200</code> status code responses for every request, you may call the <code>fake</code> method with no arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Http</span><span class="p">;</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">();</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">post</span><span class="p">(...);</span>
</pre></div>

<h4>Faking Specific URLs</h4>

<p>Alternatively, you may pass an array to the <code>fake</code> method. The array&#39;s keys should represent URL patterns that you wish to fake and their associated responses. The <code>*</code> character may be used as a wildcard character. Any requests made to URLs that have not been faked will actually be executed. You may use the <code>response</code> method to construct stub / fake responses for these endpoints:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">([</span>
    <span class="c1">// Stub a JSON response for GitHub endpoints...</span>
    <span class="s1">&#39;github.com/*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Headers&#39;</span><span class="p">]),</span>

    <span class="c1">// Stub a string response for Google endpoints...</span>
    <span class="s1">&#39;google.com/*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Headers&#39;</span><span class="p">]),</span>
<span class="p">]);</span>
</pre></div>

<p>If you would like to specify a fallback URL pattern that will stub all unmatched URLs, you may use a single <code>*</code> character:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">([</span>
    <span class="c1">// Stub a JSON response for GitHub endpoints...</span>
    <span class="s1">&#39;github.com/*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Headers&#39;</span><span class="p">]),</span>

    <span class="c1">// Stub a string response for all other endpoints...</span>
    <span class="s1">&#39;*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Headers&#39;</span><span class="p">]),</span>
<span class="p">]);</span>
</pre></div>

<h4>Faking Response Sequences</h4>

<p>Sometimes you may need to specify that a single URL should return a series of fake responses in a specific order. You may accomplish this using the <code>Http::sequence</code> method to build the responses:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">([</span>
    <span class="c1">// Stub a series of responses for GitHub endpoints...</span>
    <span class="s1">&#39;github.com/*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">sequence</span><span class="p">()</span>
                            <span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="nx">pushStatus</span><span class="p">(</span><span class="mi">404</span><span class="p">),</span>
<span class="p">]);</span>
</pre></div>

<p>When all of the responses in a response sequence have been consumed, any further requests will cause the response sequence to throw an exception. If you would like to specify a default response that should be returned when a sequence is empty, you may use the <code>whenEmpty</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">([</span>
    <span class="c1">// Stub a series of responses for GitHub endpoints...</span>
    <span class="s1">&#39;github.com/*&#39;</span> <span class="p">=&gt;</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">sequence</span><span class="p">()</span>
                            <span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">()),</span>
<span class="p">]);</span>
</pre></div>

<p>If you would like to fake a sequence of responses but do not need to specify a specific URL pattern that should be faked, you may use the <code>Http::fakeSequence</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fakeSequence</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">whenEmpty</span><span class="p">(</span><span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">());</span>
</pre></div>

<h4>Fake Callback</h4>

<p>If you require more complicated logic to determine what responses to return for certain endpoints, you may pass a callback to the <code>fake</code> method. This callback will receive an instance of <code>Illuminate\Http\Client\Request</code> and should return a response instance:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Http</span><span class="o">::</span><span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="inspecting-requests"></a></p>

<h3>Inspecting Requests</h3>

<p>When faking responses, you may occasionally wish to inspect the requests the client receives in order to make sure your application is sending the correct data or headers. You may accomplish this by calling the <code>Http::assertSent</code> method after calling <code>Http::fake</code>.</p>

<p>The <code>assertSent</code> method accepts a callback which will be given an <code>Illuminate\Http\Client\Request</code> instance and should return a boolean value indicating if the request matches your expectations. In order for the test to pass, at least one request must have been issued matching the given expectations:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">();</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">withHeaders</span><span class="p">([</span>
    <span class="s1">&#39;X-First&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;role&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">assertSent</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">hasHeader</span><span class="p">(</span><span class="s1">&#39;X-First&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
           <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">url</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;http://test.com/users&#39;</span> <span class="o">&amp;&amp;</span>
           <span class="nx">$request</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Taylor&#39;</span> <span class="o">&amp;&amp;</span>
           <span class="nx">$request</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Developer&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>If needed, you may assert that a specific request was not sent using the <code>assertNotSent</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">();</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://test.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;role&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">assertNotSent</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">url</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;http://test.com/posts&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Or, if you would like to assert that no requests were sent, you may use the <code>assertNothingSent</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Http</span><span class="o">::</span><span class="nx">fake</span><span class="p">();</span>

<span class="nx">Http</span><span class="o">::</span><span class="nx">assertNothingSent</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Tests</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#customizing-request-headers">Customizing Request Headers</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#debugging-responses">Debugging Responses</a></li>
</ul></li>
<li><a href="#session-and-authentication">Session / Authentication</a></li>
<li><a href="#testing-json-apis">Testing JSON APIs</a></li>
<li><a href="#testing-file-uploads">Testing File Uploads</a></li>
<li><a href="#testing-views">Testing Views</a></li>
<li><a href="#available-assertions">Available Assertions</a>

<ul>
<li><a href="#response-assertions">Response Assertions</a></li>
<li><a href="#authentication-assertions">Authentication Assertions</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a very fluent API for making HTTP requests to your application and examining the output. For example, take a look at the feature test defined below:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicTest</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>get</code> method makes a <code>GET</code> request into the application, while the <code>assertStatus</code> method asserts that the returned response should have the given HTTP status code. In addition to this simple assertion, Laravel also contains a variety of assertions for inspecting the response headers, content, JSON structure, and more.</p>

<p><a name="customizing-request-headers"></a></p>

<h3>Customizing Request Headers</h3>

<p>You may use the <code>withHeaders</code> method to customize the request&#39;s headers before it is sent to the application. This allows you to add any custom headers you would like to the request:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withHeaders</span><span class="p">([</span>
            <span class="s1">&#39;X-Header&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertJson</span><span class="p">([</span>
                <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} The CSRF middleware is automatically disabled when running tests.</p>
</blockquote>

<p><a name="cookies"></a></p>

<h3>Cookies</h3>

<p>You may use the <code>withCookie</code> or <code>withCookies</code> methods to set cookie values before making a request. The <code>withCookie</code> method accepts a cookie name and value as its two arguments, while the <code>withCookies</code> method accepts an array of name / value pairs:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCookies</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withCookie</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withCookies</span><span class="p">([</span>
            <span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
        <span class="p">])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="debugging-responses"></a></p>

<h3>Debugging Responses</h3>

<p>After making a test request to your application, the <code>dump</code>, <code>dumpHeaders</code>, and <code>dumpSession</code> methods may be used to examine and debug the response contents:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicTest</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">dumpHeaders</span><span class="p">();</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">dumpSession</span><span class="p">();</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">dump</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="session-and-authentication"></a></p>

<h2>Session / Authentication</h2>

<p>Laravel provides several helpers for working with the session during HTTP testing. First, you may set the session data to a given array using the <code>withSession</code> method. This is useful for loading the session with data before issuing a request to your application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withSession</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
                         <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>One common use of the session is for maintaining state for the authenticated user. The <code>actingAs</code> helper method provides a simple way to authenticate a given user as the current user. For example, we may use a <a href="/docs/%7B%7Bversion%7D%7D/database-testing#writing-factories">model factory</a> to generate and authenticate a user:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testApplication</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">withSession</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
                         <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify which guard should be used to authenticate the given user by passing the guard name as the second argument to the <code>actingAs</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">actingAs</span><span class="p">(</span><span class="nx">$user</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">)</span>
</pre></div>

<p><a name="testing-json-apis"></a></p>

<h2>Testing JSON APIs</h2>

<p>Laravel also provides several helpers for testing JSON APIs and their responses. For example, the <code>json</code>, <code>getJson</code>, <code>postJson</code>, <code>putJson</code>, <code>patchJson</code>, <code>deleteJson</code>, and <code>optionsJson</code> methods may be used to issue JSON requests with various HTTP verbs. You may also easily pass data and headers to these methods. To get started, let&#39;s write a test to make a <code>POST</code> request to <code>/user</code> and assert that the expected data was returned:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">postJson</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertJson</span><span class="p">([</span>
                <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} The <code>assertJson</code> method converts the response to an array and utilizes <code>PHPUnit::assertArraySubset</code> to verify that the given array exists within the JSON response returned by the application. So, if there are other properties in the JSON response, this test will still pass as long as the given fragment is present.</p>
</blockquote>

<p>In addition, JSON response data may be accessed as array variables on the response:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertTrue</span><span class="p">(</span><span class="nx">$response</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="verifying-exact-match"></a></p>

<h3>Verifying An Exact JSON Match</h3>

<p>If you would like to verify that the given array is an <strong>exact</strong> match for the JSON returned by the application, you should use the <code>assertExactJson</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertExactJson</span><span class="p">([</span>
                <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="verifying-json-paths"></a></p>

<h3>Verifying JSON Paths</h3>

<p>If you would like to verify that the JSON response contains some given data at a specified path, you should use the <code>assertJsonPath</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic functional test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sally&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertJsonPath</span><span class="p">(</span><span class="s1">&#39;team.owner.name&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="testing-file-uploads"></a></p>

<h2>Testing File Uploads</h2>

<p>The <code>Illuminate\Http\UploadedFile</code> class provides a <code>fake</code> method which may be used to generate dummy files or images for testing. This, combined with the <code>Storage</code> facade&#39;s <code>fake</code> method greatly simplifies the testing of file uploads. For example, you may combine these two features to easily test an avatar upload form:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAvatarUpload</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">fake</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">);</span>

        <span class="nv">$file</span> <span class="o">=</span> <span class="nx">UploadedFile</span><span class="o">::</span><span class="na">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">image</span><span class="p">(</span><span class="s1">&#39;avatar.jpg&#39;</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/avatar&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// Assert the file was stored...</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertExists</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">hashName</span><span class="p">());</span>

        <span class="c1">// Assert a file does not exist...</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertMissing</span><span class="p">(</span><span class="s1">&#39;missing.jpg&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Fake File Customization</h4>

<p>When creating files using the <code>fake</code> method, you may specify the width, height, and size of the image in order to better test your validation rules:</p>
<div class="highlight"><pre><span></span><span class="nx">UploadedFile</span><span class="o">::</span><span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">image</span><span class="p">(</span><span class="s1">&#39;avatar.jpg&#39;</span><span class="p">,</span> <span class="nx">$width</span><span class="p">,</span> <span class="nx">$height</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">size</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>

<p>In addition to creating images, you may create files of any other type using the <code>create</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">UploadedFile</span><span class="o">::</span><span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;document.pdf&#39;</span><span class="p">,</span> <span class="nx">$sizeInKilobytes</span><span class="p">);</span>
</pre></div>

<p>If needed, you may pass a <code>$mimeType</code> argument to the method to explicitly define the MIME type that should be returned by the file:</p>
<div class="highlight"><pre><span></span><span class="nx">UploadedFile</span><span class="o">::</span><span class="nx">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;document.pdf&#39;</span><span class="p">,</span> <span class="nx">$sizeInKilobytes</span><span class="p">,</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="testing-views"></a></p>

<h2>Testing Views</h2>

<p>Laravel allows you to render a view in isolation without making a simulated HTTP request to the application. To accomplish this, you may use the <code>view</code> method within your test. The <code>view</code> method accepts the view name and an optional array of data. The method returns an instance of <code>Illuminate\Testing\TestView</code>, which offers several methods to conveniently make assertions about the view&#39;s contents:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testWelcomeView</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$view</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]);</span>

    <span class="nx">$view</span><span class="o">-&gt;</span><span class="nx">assertSee</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>TestView</code> object provides the following assertion methods: <code>assertSee</code>, <code>assertSeeInOrder</code>, <code>assertSeeText</code>, <code>assertSeeTextInOrder</code>, <code>assertDontSee</code>, and <code>assertDontSeeText</code>.</p>

<p>If needed, you may get the raw, rendered view contents by casting the <code>TestView</code> instance to a string:</p>
<div class="highlight"><pre><span></span><span class="nx">$contents</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">);</span>
</pre></div>

<h4>Sharing Errors</h4>

<p>Some views may depend on errors shared in the global error bag provided by Laravel. To hydrate the error bag with error messages, you may use the <code>withViewErrors</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">withViewErrors</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Please provide a valid name.&#39;</span><span class="p">]</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">);</span>

<span class="nx">$view</span><span class="o">-&gt;</span><span class="nx">assertSee</span><span class="p">(</span><span class="s1">&#39;Please provide a valid name.&#39;</span><span class="p">);</span>
</pre></div>

<h4>Rendering Raw Blade</h4>

<p>If necessary, you may use the <code>blade</code> method to evaluate and render a raw Blade string. Like the <code>view</code> method, the <code>blade</code> method returns an instance of <code>Illuminate\Testing\TestView</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$view</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">blade</span><span class="p">(</span>
    <span class="s1">&#39;&lt;x-component :name=&quot;$name&quot; /&gt;&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]</span>
<span class="p">);</span>

<span class="nx">$view</span><span class="o">-&gt;</span><span class="nx">assertSee</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="available-assertions"></a></p>

<h2>Available Assertions</h2>

<p><a name="response-assertions"></a></p>

<h3>Response Assertions</h3>

<p>Laravel provides a variety of custom assertion methods for your <a href="https://phpunit.de/">PHPUnit</a> feature tests. These assertions may be accessed on the response that is returned from the <code>json</code>, <code>get</code>, <code>post</code>, <code>put</code>, and <code>delete</code> test methods:</p>

<style>
    .collection-method-list > p {
        column-count: 2; -moz-column-count: 2; -webkit-column-count: 2;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    .collection-method-list a {
        display: block;
    }
</style>

<div class="collection-method-list" markdown="1">

[assertCookie](#assert-cookie)
[assertCookieExpired](#assert-cookie-expired)
[assertCookieNotExpired](#assert-cookie-not-expired)
[assertCookieMissing](#assert-cookie-missing)
[assertCreated](#assert-created)
[assertDontSee](#assert-dont-see)
[assertDontSeeText](#assert-dont-see-text)
[assertExactJson](#assert-exact-json)
[assertForbidden](#assert-forbidden)
[assertHeader](#assert-header)
[assertHeaderMissing](#assert-header-missing)
[assertJson](#assert-json)
[assertJsonCount](#assert-json-count)
[assertJsonFragment](#assert-json-fragment)
[assertJsonMissing](#assert-json-missing)
[assertJsonMissingExact](#assert-json-missing-exact)
[assertJsonMissingValidationErrors](#assert-json-missing-validation-errors)
[assertJsonPath](#assert-json-path)
[assertJsonStructure](#assert-json-structure)
[assertJsonValidationErrors](#assert-json-validation-errors)
[assertLocation](#assert-location)
[assertNoContent](#assert-no-content)
[assertNotFound](#assert-not-found)
[assertOk](#assert-ok)
[assertPlainCookie](#assert-plain-cookie)
[assertRedirect](#assert-redirect)
[assertSee](#assert-see)
[assertSeeInOrder](#assert-see-in-order)
[assertSeeText](#assert-see-text)
[assertSeeTextInOrder](#assert-see-text-in-order)
[assertSessionHas](#assert-session-has)
[assertSessionHasInput](#assert-session-has-input)
[assertSessionHasAll](#assert-session-has-all)
[assertSessionHasErrors](#assert-session-has-errors)
[assertSessionHasErrorsIn](#assert-session-has-errors-in)
[assertSessionHasNoErrors](#assert-session-has-no-errors)
[assertSessionDoesntHaveErrors](#assert-session-doesnt-have-errors)
[assertSessionMissing](#assert-session-missing)
[assertStatus](#assert-status)
[assertSuccessful](#assert-successful)
[assertUnauthorized](#assert-unauthorized)
[assertViewHas](#assert-view-has)
[assertViewHasAll](#assert-view-has-all)
[assertViewIs](#assert-view-is)
[assertViewMissing](#assert-view-missing)

</div>

<p><a name="assert-cookie"></a></p>

<h4>assertCookie</h4>

<p>Assert that the response contains the given cookie:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertCookie</span><span class="p">(</span><span class="nx">$cookieName</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-cookie-expired"></a></p>

<h4>assertCookieExpired</h4>

<p>Assert that the response contains the given cookie and it is expired:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertCookieExpired</span><span class="p">(</span><span class="nx">$cookieName</span><span class="p">);</span>
</pre></div>

<p><a name="assert-cookie-not-expired"></a></p>

<h4>assertCookieNotExpired</h4>

<p>Assert that the response contains the given cookie and it is not expired:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertCookieNotExpired</span><span class="p">(</span><span class="nx">$cookieName</span><span class="p">);</span>
</pre></div>

<p><a name="assert-cookie-missing"></a></p>

<h4>assertCookieMissing</h4>

<p>Assert that the response does not contains the given cookie:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertCookieMissing</span><span class="p">(</span><span class="nx">$cookieName</span><span class="p">);</span>
</pre></div>

<p><a name="assert-created"></a></p>

<h4>assertCreated</h4>

<p>Assert that the response has a 201 status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertCreated</span><span class="p">();</span>
</pre></div>

<p><a name="assert-dont-see"></a></p>

<h4>assertDontSee</h4>

<p>Assert that the given string is not contained within the response. This assertion will automatically escape the given string unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertDontSee</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-dont-see-text"></a></p>

<h4>assertDontSeeText</h4>

<p>Assert that the given string is not contained within the response text. This assertion will automatically escape the given string unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertDontSeeText</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-exact-json"></a></p>

<h4>assertExactJson</h4>

<p>Assert that the response contains an exact match of the given JSON data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertExactJson</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-forbidden"></a></p>

<h4>assertForbidden</h4>

<p>Assert that the response has a forbidden (403) status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertForbidden</span><span class="p">();</span>
</pre></div>

<p><a name="assert-header"></a></p>

<h4>assertHeader</h4>

<p>Assert that the given header is present on the response:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertHeader</span><span class="p">(</span><span class="nx">$headerName</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-header-missing"></a></p>

<h4>assertHeaderMissing</h4>

<p>Assert that the given header is not present on the response:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertHeaderMissing</span><span class="p">(</span><span class="nx">$headerName</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json"></a></p>

<h4>assertJson</h4>

<p>Assert that the response contains the given JSON data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJson</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$strict</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-count"></a></p>

<h4>assertJsonCount</h4>

<p>Assert that the response JSON has an array with the expected number of items at the given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonCount</span><span class="p">(</span><span class="nx">$count</span><span class="p">,</span> <span class="nx">$key</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-fragment"></a></p>

<h4>assertJsonFragment</h4>

<p>Assert that the response contains the given JSON fragment:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonFragment</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-missing"></a></p>

<h4>assertJsonMissing</h4>

<p>Assert that the response does not contain the given JSON fragment:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonMissing</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-missing-exact"></a></p>

<h4>assertJsonMissingExact</h4>

<p>Assert that the response does not contain the exact JSON fragment:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonMissingExact</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-missing-validation-errors"></a></p>

<h4>assertJsonMissingValidationErrors</h4>

<p>Assert that the response has no JSON validation errors for the given keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonMissingValidationErrors</span><span class="p">(</span><span class="nx">$keys</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-path"></a></p>

<h4>assertJsonPath</h4>

<p>Assert that the response contains the given data at the specified path:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonPath</span><span class="p">(</span><span class="nx">$path</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$data</span><span class="p">,</span> <span class="nx">$strict</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-structure"></a></p>

<h4>assertJsonStructure</h4>

<p>Assert that the response has a given JSON structure:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonStructure</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$structure</span><span class="p">);</span>
</pre></div>

<p><a name="assert-json-validation-errors"></a></p>

<h4>assertJsonValidationErrors</h4>

<p>Assert that the response has the given JSON validation errors:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertJsonValidationErrors</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-location"></a></p>

<h4>assertLocation</h4>

<p>Assert that the response has the given URI value in the <code>Location</code> header:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertLocation</span><span class="p">(</span><span class="nx">$uri</span><span class="p">);</span>
</pre></div>

<p><a name="assert-no-content"></a></p>

<h4>assertNoContent</h4>

<p>Assert that the response has the given status code and no content.</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertNoContent</span><span class="p">(</span><span class="nx">$status</span> <span class="o">=</span> <span class="mi">204</span><span class="p">);</span>
</pre></div>

<p><a name="assert-not-found"></a></p>

<h4>assertNotFound</h4>

<p>Assert that the response has a not found status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertNotFound</span><span class="p">();</span>
</pre></div>

<p><a name="assert-ok"></a></p>

<h4>assertOk</h4>

<p>Assert that the response has a 200 status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertOk</span><span class="p">();</span>
</pre></div>

<p><a name="assert-plain-cookie"></a></p>

<h4>assertPlainCookie</h4>

<p>Assert that the response contains the given cookie (unencrypted):</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertPlainCookie</span><span class="p">(</span><span class="nx">$cookieName</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-redirect"></a></p>

<h4>assertRedirect</h4>

<p>Assert that the response is a redirect to a given URI:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertRedirect</span><span class="p">(</span><span class="nx">$uri</span><span class="p">);</span>
</pre></div>

<p><a name="assert-see"></a></p>

<h4>assertSee</h4>

<p>Assert that the given string is contained within the response. This assertion will automatically escape the given string unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSee</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-see-in-order"></a></p>

<h4>assertSeeInOrder</h4>

<p>Assert that the given strings are contained in order within the response. This assertion will automatically escape the given strings unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSeeInOrder</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$values</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-see-text"></a></p>

<h4>assertSeeText</h4>

<p>Assert that the given string is contained within the response text. This assertion will automatically escape the given string unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSeeText</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-see-text-in-order"></a></p>

<h4>assertSeeTextInOrder</h4>

<p>Assert that the given strings are contained in order within the response text. This assertion will automatically escape the given strings unless you pass a second argument of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSeeTextInOrder</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$values</span><span class="p">,</span> <span class="nx">$escaped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has"></a></p>

<h4>assertSessionHas</h4>

<p>Assert that the session contains the given piece of data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHas</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has-input"></a></p>

<h4>assertSessionHasInput</h4>

<p>Assert that the session has a given value in the flashed input array:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHasInput</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has-all"></a></p>

<h4>assertSessionHasAll</h4>

<p>Assert that the session has a given list of values:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHasAll</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has-errors"></a></p>

<h4>assertSessionHasErrors</h4>

<p>Assert that the session contains an error for the given <code>$keys</code>. If <code>$keys</code> is an associative array, assert that the session contains a specific error message (value) for each field (key):</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrors</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$keys</span><span class="p">,</span> <span class="nx">$format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$errorBag</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has-errors-in"></a></p>

<h4>assertSessionHasErrorsIn</h4>

<p>Assert that the session contains an error for the given <code>$keys</code>, within a specific error bag. If <code>$keys</code> is an associative array, assert that the session contains a specific error message (value) for each field (key), within the error bag:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHasErrorsIn</span><span class="p">(</span><span class="nx">$errorBag</span><span class="p">,</span> <span class="nx">$keys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">$format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-has-no-errors"></a></p>

<h4>assertSessionHasNoErrors</h4>

<p>Assert that the session has no errors:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionHasNoErrors</span><span class="p">();</span>
</pre></div>

<p><a name="assert-session-doesnt-have-errors"></a></p>

<h4>assertSessionDoesntHaveErrors</h4>

<p>Assert that the session has no errors for the given keys:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionDoesntHaveErrors</span><span class="p">(</span><span class="nx">$keys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">$format</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">$errorBag</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="assert-session-missing"></a></p>

<h4>assertSessionMissing</h4>

<p>Assert that the session does not contain the given key:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSessionMissing</span><span class="p">(</span><span class="nx">$key</span><span class="p">);</span>
</pre></div>

<p><a name="assert-status"></a></p>

<h4>assertStatus</h4>

<p>Assert that the response has a given code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertStatus</span><span class="p">(</span><span class="nx">$code</span><span class="p">);</span>
</pre></div>

<p><a name="assert-successful"></a></p>

<h4>assertSuccessful</h4>

<p>Assert that the response has a successful (&gt;= 200 and &lt; 300) status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertSuccessful</span><span class="p">();</span>
</pre></div>

<p><a name="assert-unauthorized"></a></p>

<h4>assertUnauthorized</h4>

<p>Assert that the response has an unauthorized (401) status code:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertUnauthorized</span><span class="p">();</span>
</pre></div>

<p><a name="assert-view-has"></a></p>

<h4>assertViewHas</h4>

<p>Assert that the response view was given a piece of data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertViewHas</span><span class="p">(</span><span class="nx">$key</span><span class="p">,</span> <span class="nx">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>

<p>In addition, view data may be accessed as array variables on the response:</p>
<div class="highlight"><pre><span></span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">assertEquals</span><span class="p">(</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="nx">$response</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="assert-view-has-all"></a></p>

<h4>assertViewHasAll</h4>

<p>Assert that the response view has a given list of data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertViewHasAll</span><span class="p">(</span><span class="nx">array</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="assert-view-is"></a></p>

<h4>assertViewIs</h4>

<p>Assert that the given view was returned by the route:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertViewIs</span><span class="p">(</span><span class="nx">$value</span><span class="p">);</span>
</pre></div>

<p><a name="assert-view-missing"></a></p>

<h4>assertViewMissing</h4>

<p>Assert that the response view is missing a piece of bound data:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertViewMissing</span><span class="p">(</span><span class="nx">$key</span><span class="p">);</span>
</pre></div>

<p><a name="authentication-assertions"></a></p>

<h3>Authentication Assertions</h3>

<p>Laravel also provides a variety of authentication related assertions for your <a href="https://phpunit.de/">PHPUnit</a> feature tests:</p>

<p>Method  | Description
------------- | -------------
<code>$this-&gt;assertAuthenticated($guard = null);</code>  |  Assert that the user is authenticated.
<code>$this-&gt;assertGuest($guard = null);</code>  |  Assert that the user is not authenticated.
<code>$this-&gt;assertAuthenticatedAs($user, $guard = null);</code>  |  Assert that the given user is authenticated.
<code>$this-&gt;assertCredentials(array $credentials, $guard = null);</code>  |  Assert that the given credentials are valid.
<code>$this-&gt;assertInvalidCredentials(array $credentials, $guard = null);</code>  |  Assert that the given credentials are invalid.</p>
<div style="page-break-after: always;" ></div><h1>Installation</h1>

<ul>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#server-requirements">Server Requirements</a></li>
<li><a href="#installing-laravel">Installing Laravel</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul></li>
<li><a href="#web-server-configuration">Web Server Configuration</a>

<ul>
<li><a href="#directory-configuration">Directory Configuration</a></li>
<li><a href="#pretty-urls">Pretty URLs</a></li>
</ul></li>
</ul>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p><a name="server-requirements"></a></p>

<h3>Server Requirements</h3>

<p>The Laravel framework has a few system requirements. All of these requirements are satisfied by the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Laravel Homestead</a> virtual machine, so it&#39;s highly recommended that you use Homestead as your local Laravel development environment.</p>

<p>However, if you are not using Homestead, you will need to make sure your server meets the following requirements:</p>

<div class="content-list" markdown="1">
- PHP >= 7.3
- BCMath PHP Extension
- Ctype PHP Extension
- Fileinfo PHP extension
- JSON PHP Extension
- Mbstring PHP Extension
- OpenSSL PHP Extension
- PDO PHP Extension
- Tokenizer PHP Extension
- XML PHP Extension
</div>

<p><a name="installing-laravel"></a></p>

<h3>Installing Laravel</h3>

<p>Laravel utilizes <a href="https://getcomposer.org">Composer</a> to manage its dependencies. So, before using Laravel, make sure you have Composer installed on your machine.</p>

<h4>Via Laravel Installer</h4>

<p>First, download the Laravel installer using Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">global</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">installer</span>
</pre></div>

<p>Make sure to place Composer&#39;s system-wide vendor bin directory in your <code>$PATH</code> so the laravel executable can be located by your system. This directory exists in different locations based on your operating system; however, some common locations include:</p>

<div class="content-list" markdown="1">
- macOS: `$HOME/.composer/vendor/bin`
- Windows: `%USERPROFILE%\AppData\Roaming\Composer\vendor\bin`
- GNU / Linux Distributions: `$HOME/.config/composer/vendor/bin` or `$HOME/.composer/vendor/bin`
</div>

<p>You could also find the composer&#39;s global installation path by running <code>composer global about</code> and looking up from the first line.</p>

<p>Once installed, the <code>laravel new</code> command will create a fresh Laravel installation in the directory you specify. For instance, <code>laravel new blog</code> will create a directory named <code>blog</code> containing a fresh Laravel installation with all of Laravel&#39;s dependencies already installed:</p>
<div class="highlight"><pre><span></span><span class="nx">laravel</span> <span class="k">new</span> <span class="nx">blog</span>
</pre></div>

<h4>Via Composer Create-Project</h4>

<p>Alternatively, you may also install Laravel by issuing the Composer <code>create-project</code> command in your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">create</span><span class="o">-</span><span class="nx">project</span> <span class="o">--</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">dist</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">laravel</span> <span class="nx">blog</span>
</pre></div>

<h4>Local Development Server</h4>

<p>If you have PHP installed locally and you would like to use PHP&#39;s built-in development server to serve your application, you may use the <code>serve</code> Artisan command. This command will start a development server at <code>http://localhost:8000</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">serve</span>
</pre></div>

<p>More robust local development options are available via <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> and <a href="/docs/%7B%7Bversion%7D%7D/valet">Valet</a>.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<h4>Public Directory</h4>

<p>After installing Laravel, you should configure your web server&#39;s document / web root to be the <code>public</code> directory. The <code>index.php</code> in this directory serves as the front controller for all HTTP requests entering your application.</p>

<h4>Configuration Files</h4>

<p>All of the configuration files for the Laravel framework are stored in the <code>config</code> directory. Each option is documented, so feel free to look through the files and get familiar with the options available to you.</p>

<h4>Directory Permissions</h4>

<p>After installing Laravel, you may need to configure some permissions. Directories within the <code>storage</code> and the <code>bootstrap/cache</code> directories should be writable by your web server or Laravel will not run. If you are using the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> virtual machine, these permissions should already be set.</p>

<h4>Application Key</h4>

<p>The next thing you should do after installing Laravel is set your application key to a random string. If you installed Laravel via Composer or the Laravel installer, this key has already been set for you by the <code>php artisan key:generate</code> command.</p>

<p>Typically, this string should be 32 characters long. The key can be set in the <code>.env</code> environment file. If you have not copied the <code>.env.example</code> file to a new file named <code>.env</code>, you should do that now. <strong>If the application key is not set, your user sessions and other encrypted data will not be secure!</strong></p>

<h4>Additional Configuration</h4>

<p>Laravel needs almost no other configuration out of the box. You are free to get started developing! However, you may wish to review the <code>config/app.php</code> file and its documentation. It contains several options such as <code>timezone</code> and <code>locale</code> that you may wish to change according to your application.</p>

<p>You may also want to configure a few additional components of Laravel, such as:</p>

<div class="content-list" markdown="1">
- [Cache](/docs/{{version}}/cache#configuration)
- [Database](/docs/{{version}}/database#configuration)
- [Session](/docs/{{version}}/session#configuration)
</div>

<p><a name="web-server-configuration"></a></p>

<h2>Web Server Configuration</h2>

<p><a name="directory-configuration"></a></p>

<h3>Directory Configuration</h3>

<p>Laravel should always be served out of the root of the &quot;web directory&quot; configured for your web server. You should not attempt to serve a Laravel application out of a subdirectory of the &quot;web directory&quot;. Attempting to do so could expose sensitive files present within your application.</p>

<p><a name="pretty-urls"></a></p>

<h3>Pretty URLs</h3>

<h4>Apache</h4>

<p>Laravel includes a <code>public/.htaccess</code> file that is used to provide URLs without the <code>index.php</code> front controller in the path. Before serving Laravel with Apache, be sure to enable the <code>mod_rewrite</code> module so the <code>.htaccess</code> file will be honored by the server.</p>

<p>If the <code>.htaccess</code> file that ships with Laravel does not work with your Apache installation, try this alternative:</p>
<div class="highlight"><pre><span></span><span class="nx">Options</span> <span class="o">+</span><span class="nx">FollowSymLinks</span> <span class="o">-</span><span class="nx">Indexes</span>
<span class="nx">RewriteEngine</span> <span class="nx">On</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}</span> <span class="p">.</span>
<span class="nx">RewriteRule</span> <span class="p">.</span><span class="o">*</span> <span class="o">-</span> <span class="p">[</span><span class="nx">E</span><span class="o">=</span><span class="nx">HTTP_AUTHORIZATION</span><span class="o">:%</span><span class="p">{</span><span class="nx">HTTP</span><span class="o">:</span><span class="nx">Authorization</span><span class="p">}]</span>

<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">d</span>
<span class="nx">RewriteCond</span> <span class="o">%</span><span class="p">{</span><span class="nx">REQUEST_FILENAME</span><span class="p">}</span> <span class="o">!-</span><span class="nx">f</span>
<span class="nx">RewriteRule</span> <span class="o">^</span> <span class="nx">index</span><span class="p">.</span><span class="nx">php</span> <span class="p">[</span><span class="nx">L</span><span class="p">]</span>
</pre></div>

<h4>Nginx</h4>

<p>If you are using Nginx, the following directive in your site configuration will direct all requests to the <code>index.php</code> front controller:</p>
<div class="highlight"><pre><span></span><span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="nx">try_files</span> <span class="nx">$uri</span> <span class="nx">$uri</span><span class="o">/</span> <span class="err">/index.php?$query_string;</span>
<span class="p">}</span>
</pre></div>

<p>When using <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a> or <a href="/docs/%7B%7Bversion%7D%7D/valet">Valet</a>, pretty URLs will be automatically configured.</p>
<div style="page-break-after: always;" ></div><h1>Request Lifecycle</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#lifecycle-overview">Lifecycle Overview</a></li>
<li><a href="#focus-on-service-providers">Focus On Service Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When using any tool in the &quot;real world&quot;, you feel more confident if you understand how that tool works. Application development is no different. When you understand how your development tools function, you feel more comfortable and confident using them.</p>

<p>The goal of this document is to give you a good, high-level overview of how the Laravel framework works. By getting to know the overall framework better, everything feels less &quot;magical&quot; and you will be more confident building your applications. If you don&#39;t understand all of the terms right away, don&#39;t lose heart! Just try to get a basic grasp of what is going on, and your knowledge will grow as you explore other sections of the documentation.</p>

<p><a name="lifecycle-overview"></a></p>

<h2>Lifecycle Overview</h2>

<h3>First Things</h3>

<p>The entry point for all requests to a Laravel application is the <code>public/index.php</code> file. All requests are directed to this file by your web server (Apache / Nginx) configuration. The <code>index.php</code> file doesn&#39;t contain much code. Rather, it is a starting point for loading the rest of the framework.</p>

<p>The <code>index.php</code> file loads the Composer generated autoloader definition, and then retrieves an instance of the Laravel application from <code>bootstrap/app.php</code> script. The first action taken by Laravel itself is to create an instance of the application / <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>

<h3>HTTP / Console Kernels</h3>

<p>Next, the incoming request is sent to either the HTTP kernel or the console kernel, depending on the type of request that is entering the application. These two kernels serve as the central location that all requests flow through. For now, let&#39;s just focus on the HTTP kernel, which is located in <code>app/Http/Kernel.php</code>.</p>

<p>The HTTP kernel extends the <code>Illuminate\Foundation\Http\Kernel</code> class, which defines an array of <code>bootstrappers</code> that will be run before the request is executed. These bootstrappers configure error handling, configure logging, <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">detect the application environment</a>, and perform other tasks that need to be done before the request is actually handled.</p>

<p>The HTTP kernel also defines a list of HTTP <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a> that all requests must pass through before being handled by the application. These middleware handle reading and writing the <a href="/docs/%7B%7Bversion%7D%7D/session">HTTP session</a>, determining if the application is in maintenance mode, <a href="/docs/%7B%7Bversion%7D%7D/csrf">verifying the CSRF token</a>, and more.</p>

<p>The method signature for the HTTP kernel&#39;s <code>handle</code> method is quite simple: receive a <code>Request</code> and return a <code>Response</code>. Think of the Kernel as being a big black box that represents your entire application. Feed it HTTP requests and it will return HTTP responses.</p>

<h4>Service Providers</h4>

<p>One of the most important Kernel bootstrapping actions is loading the <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a> for your application. All of the service providers for the application are configured in the <code>config/app.php</code> configuration file&#39;s <code>providers</code> array. First, the <code>register</code> method will be called on all providers, then, once all providers have been registered, the <code>boot</code> method will be called.</p>

<p>Service providers are responsible for bootstrapping all of the framework&#39;s various components, such as the database, queue, validation, and routing components. Since they bootstrap and configure every feature offered by the framework, service providers are the most important aspect of the entire Laravel bootstrap process.</p>

<h4>Dispatch Request</h4>

<p>Once the application has been bootstrapped and all service providers have been registered, the <code>Request</code> will be handed off to the router for dispatching. The router will dispatch the request to a route or controller, as well as run any route specific middleware.</p>

<p><a name="focus-on-service-providers"></a></p>

<h2>Focus On Service Providers</h2>

<p>Service providers are truly the key to bootstrapping a Laravel application. The application instance is created, the service providers are registered, and the request is handed to the bootstrapped application. It&#39;s really that simple!</p>

<p>Having a firm grasp of how a Laravel application is built and bootstrapped via service providers is very valuable. Your application&#39;s default service providers are stored in the <code>app/Providers</code> directory.</p>

<p>By default, the <code>AppServiceProvider</code> is fairly empty. This provider is a great place to add your application&#39;s own bootstrapping and service container bindings. For large applications, you may wish to create several service providers, each with a more granular type of bootstrapping.</p>
<div style="page-break-after: always;" ></div><h1>Localization</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuring-the-locale">Configuring The Locale</a></li>
</ul></li>
<li><a href="#defining-translation-strings">Defining Translation Strings</a>

<ul>
<li><a href="#using-short-keys">Using Short Keys</a></li>
<li><a href="#using-translation-strings-as-keys">Using Translation Strings As Keys</a></li>
</ul></li>
<li><a href="#retrieving-translation-strings">Retrieving Translation Strings</a>

<ul>
<li><a href="#replacing-parameters-in-translation-strings">Replacing Parameters In Translation Strings</a></li>
<li><a href="#pluralization">Pluralization</a></li>
</ul></li>
<li><a href="#overriding-package-language-files">Overriding Package Language Files</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s localization features provide a convenient way to retrieve strings in various languages, allowing you to easily support multiple languages within your application. Language strings are stored in files within the <code>resources/lang</code> directory. Within this directory there should be a subdirectory for each language supported by the application:</p>
<div class="highlight"><pre><span></span><span class="err">/resources</span>
    <span class="err">/lang</span>
        <span class="err">/en</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
        <span class="o">/</span><span class="nx">es</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
</pre></div>

<p>All language files return an array of keyed strings. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;welcome&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to our application&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<blockquote>
<p>{note} For languages that differ by territory, you should name the language directories according to the ISO 15897. For example, &quot;en_GB&quot; should be used for British English rather than &quot;en-gb&quot;.</p>
</blockquote>

<p><a name="configuring-the-locale"></a></p>

<h3>Configuring The Locale</h3>

<p>The default language for your application is stored in the <code>config/app.php</code> configuration file. You may modify this value to suit the needs of your application. You may also change the active language at runtime using the <code>setLocale</code> method on the <code>App</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;welcome/{locale}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$locale</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">in_array</span><span class="p">(</span><span class="nx">$locale</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="s1">&#39;fr&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">App</span><span class="o">::</span><span class="nx">setLocale</span><span class="p">(</span><span class="nx">$locale</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>You may configure a &quot;fallback language&quot;, which will be used when the active language does not contain a given translation string. Like the default language, the fallback language is also configured in the <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;fallback_locale&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
</pre></div>

<h4>Determining The Current Locale</h4>

<p>You may use the <code>getLocale</code> and <code>isLocale</code> methods on the <code>App</code> facade to determine the current locale or check if the locale is a given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$locale</span> <span class="o">=</span> <span class="nx">App</span><span class="o">::</span><span class="nx">getLocale</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">App</span><span class="o">::</span><span class="nx">isLocale</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="defining-translation-strings"></a></p>

<h2>Defining Translation Strings</h2>

<p><a name="using-short-keys"></a></p>

<h3>Using Short Keys</h3>

<p>Typically, translation strings are stored in files within the <code>resources/lang</code> directory. Within this directory there should be a subdirectory for each language supported by the application:</p>
<div class="highlight"><pre><span></span><span class="err">/resources</span>
    <span class="err">/lang</span>
        <span class="err">/en</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
        <span class="o">/</span><span class="nx">es</span>
            <span class="nx">messages</span><span class="p">.</span><span class="nx">php</span>
</pre></div>

<p>All language files return an array of keyed strings. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// resources/lang/en/messages.php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;welcome&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to our application&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="using-translation-strings-as-keys"></a></p>

<h3>Using Translation Strings As Keys</h3>

<p>For applications with heavy translation requirements, defining every string with a &quot;short key&quot; can become quickly confusing when referencing them in your views. For this reason, Laravel also provides support for defining translation strings using the &quot;default&quot; translation of the string as the key.</p>

<p>Translation files that use translation strings as keys are stored as JSON files in the <code>resources/lang</code> directory. For example, if your application has a Spanish translation, you should create a <code>resources/lang/es.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;I love programming.&quot;</span><span class="o">:</span> <span class="s2">&quot;Me encanta programar.&quot;</span>
<span class="p">}</span>
</pre></div>

<p><a name="retrieving-translation-strings"></a></p>

<h2>Retrieving Translation Strings</h2>

<p>You may retrieve lines from language files using the <code>__</code> helper function. The <code>__</code> method accepts the file and key of the translation string as its first argument. For example, let&#39;s retrieve the <code>welcome</code> translation string from the <code>resources/lang/messages.php</code> language file:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;I love programming.&#39;</span><span class="p">);</span>
</pre></div>

<p>If you are using the <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade templating engine</a>, you may use the <code>{{ }}</code> syntax to echo the translation string or use the <code>@lang</code> directive:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">)</span> <span class="p">}}</span>

<span class="err">@</span><span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">)</span>
</pre></div>

<p>If the specified translation string does not exist, the <code>__</code> function will return the translation string key. So, using the example above, the <code>__</code> function would return <code>messages.welcome</code> if the translation string does not exist.</p>

<blockquote>
<p>{note} The <code>@lang</code> directive does not escape any output. You are <strong>fully responsible</strong> for escaping your own output when using this directive.</p>
</blockquote>

<p><a name="replacing-parameters-in-translation-strings"></a></p>

<h3>Replacing Parameters In Translation Strings</h3>

<p>If you wish, you may define placeholders in your translation strings. All placeholders are prefixed with a <code>:</code>. For example, you may define a welcome message with a placeholder name:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;welcome&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Welcome, :name&#39;</span><span class="p">,</span>
</pre></div>

<p>To replace the placeholders when retrieving a translation string, pass an array of replacements as the second argument to the <code>__</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle&#39;</span><span class="p">]);</span>
</pre></div>

<p>If your placeholder contains all capital letters, or only has its first letter capitalized, the translated value will be capitalized accordingly:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;welcome&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Welcome, :NAME&#39;</span><span class="p">,</span> <span class="c1">// Welcome, DAYLE</span>
<span class="s1">&#39;goodbye&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Goodbye, :Name&#39;</span><span class="p">,</span> <span class="c1">// Goodbye, Dayle</span>
</pre></div>

<p><a name="pluralization"></a></p>

<h3>Pluralization</h3>

<p>Pluralization is a complex problem, as different languages have a variety of complex rules for pluralization. By using a &quot;pipe&quot; character, you may distinguish singular and plural forms of a string:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;There is one apple|There are many apples&#39;</span><span class="p">,</span>
</pre></div>

<p>You may even create more complex pluralization rules which specify translation strings for multiple number ranges:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{0} There are none|[1,19] There are some|[20,*] There are many&#39;</span><span class="p">,</span>
</pre></div>

<p>After defining a translation string that has pluralization options, you may use the <code>trans_choice</code> function to retrieve the line for a given &quot;count&quot;. In this example, since the count is greater than one, the plural form of the translation string is returned:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;messages.apples&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>You may also define placeholder attributes in pluralization strings. These placeholders may be replaced by passing an array as the third argument to the <code>trans_choice</code> function:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;minutes_ago&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{1} :value minute ago|[2,*] :value minutes ago&#39;</span><span class="p">,</span>

<span class="nx">echo</span> <span class="nx">trans_choice</span><span class="p">(</span><span class="s1">&#39;time.minutes_ago&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span> <span class="p">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>
</pre></div>

<p>If you would like to display the integer value that was passed to the <code>trans_choice</code> function, you may use the <code>:count</code> placeholder:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;apples&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{0} There are none|{1} There is one|[2,*] There are :count&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="overriding-package-language-files"></a></p>

<h2>Overriding Package Language Files</h2>

<p>Some packages may ship with their own language files. Instead of changing the package&#39;s core files to tweak these lines, you may override them by placing files in the <code>resources/lang/vendor/{package}/{locale}</code> directory.</p>

<p>So, for example, if you need to override the English translation strings in <code>messages.php</code> for a package named <code>skyrim/hearthfire</code>, you should place a language file at: <code>resources/lang/vendor/hearthfire/en/messages.php</code>. Within this file, you should only define the translation strings you wish to override. Any translation strings you don&#39;t override will still be loaded from the package&#39;s original language files.</p>
<div style="page-break-after: always;" ></div><h1>Logging</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#building-log-stacks">Building Log Stacks</a></li>
</ul></li>
<li><a href="#writing-log-messages">Writing Log Messages</a>

<ul>
<li><a href="#writing-to-specific-channels">Writing To Specific Channels</a></li>
</ul></li>
<li><a href="#advanced-monolog-channel-customization">Advanced Monolog Channel Customization</a>

<ul>
<li><a href="#customizing-monolog-for-channels">Customizing Monolog For Channels</a></li>
<li><a href="#creating-monolog-handler-channels">Creating Monolog Handler Channels</a></li>
<li><a href="#creating-channels-via-factories">Creating Channels Via Factories</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>To help you learn more about what&#39;s happening within your application, Laravel provides robust logging services that allow you to log messages to files, the system error log, and even to Slack to notify your entire team.</p>

<p>Under the hood, Laravel utilizes the <a href="https://github.com/Seldaek/monolog">Monolog</a> library, which provides support for a variety of powerful log handlers. Laravel makes it a cinch to configure these handlers, allowing you to mix and match them to customize your application&#39;s log handling.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>All of the configuration for your application&#39;s logging system is housed in the <code>config/logging.php</code> configuration file. This file allows you to configure your application&#39;s log channels, so be sure to review each of the available channels and their options. We&#39;ll review a few common options below.</p>

<p>By default, Laravel will use the <code>stack</code> channel when logging messages. The <code>stack</code> channel is used to aggregate multiple log channels into a single channel. For more information on building stacks, check out the <a href="#building-log-stacks">documentation below</a>.</p>

<h4>Configuring The Channel Name</h4>

<p>By default, Monolog is instantiated with a &quot;channel name&quot; that matches the current environment, such as <code>production</code> or <code>local</code>. To change this value, add a <code>name</code> option to your channel&#39;s configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;stack&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;stack&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;channel-name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;channels&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;slack&#39;</span><span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>Available Channel Drivers</h4>

<p>Name | Description
------------- | -------------
<code>stack</code> | A wrapper to facilitate creating &quot;multi-channel&quot; channels
<code>single</code> | A single file or path based logger channel (<code>StreamHandler</code>)
<code>daily</code> | A <code>RotatingFileHandler</code> based Monolog driver which rotates daily
<code>slack</code> | A <code>SlackWebhookHandler</code> based Monolog driver
<code>papertrail</code> | A <code>SyslogUdpHandler</code> based Monolog driver
<code>syslog</code> | A <code>SyslogHandler</code> based Monolog driver
<code>errorlog</code> | A <code>ErrorLogHandler</code> based Monolog driver
<code>monolog</code> | A Monolog factory driver that may use any supported Monolog handler
<code>custom</code> | A driver that calls a specified factory to create a channel</p>

<blockquote>
<p>{tip} Check out the documentation on <a href="#advanced-monolog-channel-customization">advanced channel customization</a> to learn more about the <code>monolog</code> and <code>custom</code> drivers.</p>
</blockquote>

<h4>Configuring The Single and Daily Channels</h4>

<p>The <code>single</code> and <code>daily</code> channels have three optional configuration options: <code>bubble</code>, <code>permission</code>, and <code>locking</code>.</p>

<p>Name | Description | Default
------------- | ------------- | -------------
<code>bubble</code> | Indicates if messages should bubble up to other channels after being handled | <code>true</code>
<code>permission</code> | The log file&#39;s permissions | <code>0644</code>
<code>locking</code> | Attempt to lock the log file before writing to it | <code>false</code></p>

<h4>Configuring The Papertrail Channel</h4>

<p>The <code>papertrail</code> channel requires the <code>url</code> and <code>port</code> configuration options. You can obtain these values from <a href="https://help.papertrailapp.com/kb/configuration/configuring-centralized-logging-from-php-apps/#send-events-from-php-app">Papertrail</a>.</p>

<h4>Configuring The Slack Channel</h4>

<p>The <code>slack</code> channel requires a <code>url</code> configuration option. This URL should match a URL for an <a href="https://slack.com/apps/A0F7XDUAZ-incoming-webhooks">incoming webhook</a> that you have configured for your Slack team. By default, Slack will only receive logs at the <code>critical</code> level and above; however, you can adjust this in your <code>logging</code> configuration file.</p>

<p><a name="building-log-stacks"></a></p>

<h3>Building Log Stacks</h3>

<p>As previously mentioned, the <code>stack</code> driver allows you to combine multiple channels into a single log channel. To illustrate how to use log stacks, let&#39;s take a look at an example configuration that you might see in a production application:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;channels&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;stack&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;stack&#39;</span><span class="p">,</span>
        <span class="s1">&#39;channels&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;syslog&#39;</span><span class="p">,</span> <span class="s1">&#39;slack&#39;</span><span class="p">],</span>
    <span class="p">],</span>

    <span class="s1">&#39;syslog&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;syslog&#39;</span><span class="p">,</span>
        <span class="s1">&#39;level&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;slack&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;slack&#39;</span><span class="p">,</span>
        <span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;LOG_SLACK_WEBHOOK_URL&#39;</span><span class="p">),</span>
        <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Laravel Log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;emoji&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;:boom:&#39;</span><span class="p">,</span>
        <span class="s1">&#39;level&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>Let&#39;s dissect this configuration. First, notice our <code>stack</code> channel aggregates two other channels via its <code>channels</code> option: <code>syslog</code> and <code>slack</code>. So, when logging messages, both of these channels will have the opportunity to log the message.</p>

<h4>Log Levels</h4>

<p>Take note of the <code>level</code> configuration option present on the <code>syslog</code> and <code>slack</code> channel configurations in the example above. This option determines the minimum &quot;level&quot; a message must be in order to be logged by the channel. Monolog, which powers Laravel&#39;s logging services, offers all of the log levels defined in the <a href="https://tools.ietf.org/html/rfc5424">RFC 5424 specification</a>: <strong>emergency</strong>, <strong>alert</strong>, <strong>critical</strong>, <strong>error</strong>, <strong>warning</strong>, <strong>notice</strong>, <strong>info</strong>, and <strong>debug</strong>.</p>

<p>So, imagine we log a message using the <code>debug</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;An informational message.&#39;</span><span class="p">);</span>
</pre></div>

<p>Given our configuration, the <code>syslog</code> channel will write the message to the system log; however, since the error message is not <code>critical</code> or above, it will not be sent to Slack. However, if we log an <code>emergency</code> message, it will be sent to both the system log and Slack since the <code>emergency</code> level is above our minimum level threshold for both channels:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">emergency</span><span class="p">(</span><span class="s1">&#39;The system is down!&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="writing-log-messages"></a></p>

<h2>Writing Log Messages</h2>

<p>You may write information to the logs using the <code>Log</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. As previously mentioned, the logger provides the eight logging levels defined in the <a href="https://tools.ietf.org/html/rfc5424">RFC 5424 specification</a>: <strong>emergency</strong>, <strong>alert</strong>, <strong>critical</strong>, <strong>error</strong>, <strong>warning</strong>, <strong>notice</strong>, <strong>info</strong> and <strong>debug</strong>:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">emergency</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">alert</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">critical</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">error</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">warning</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">notice</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="nx">debug</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
</pre></div>

<p>So, you may call any of these methods to log a message for the corresponding level. By default, the message will be written to the default log channel as configured by your <code>config/logging.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Showing user profile for user: &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Contextual Information</h4>

<p>An array of contextual data may also be passed to the log methods. This contextual data will be formatted and displayed with the log message:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;User failed to login.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">]);</span>
</pre></div>

<p><a name="writing-to-specific-channels"></a></p>

<h3>Writing To Specific Channels</h3>

<p>Sometimes you may wish to log a message to a channel other than your application&#39;s default channel. You may use the <code>channel</code> method on the <code>Log</code> facade to retrieve and log to any channel defined in your configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;slack&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
</pre></div>

<p>If you would like to create an on-demand logging stack consisting of multiple channels, you may use the <code>stack</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Log</span><span class="o">::</span><span class="nx">stack</span><span class="p">([</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;slack&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="advanced-monolog-channel-customization"></a></p>

<h2>Advanced Monolog Channel Customization</h2>

<p><a name="customizing-monolog-for-channels"></a></p>

<h3>Customizing Monolog For Channels</h3>

<p>Sometimes you may need complete control over how Monolog is configured for an existing channel. For example, you may want to configure a custom Monolog <code>FormatterInterface</code> implementation for a given channel&#39;s handlers.</p>

<p>To get started, define a <code>tap</code> array on the channel&#39;s configuration. The <code>tap</code> array should contain a list of classes that should have an opportunity to customize (or &quot;tap&quot; into) the Monolog instance after it is created:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;single&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tap&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">App</span><span class="err">\</span><span class="nx">Logging</span><span class="err">\</span><span class="nx">CustomizeFormatter</span><span class="o">::</span><span class="kr">class</span><span class="p">],</span>
    <span class="s1">&#39;path&#39;</span> <span class="p">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;logs/laravel.log&#39;</span><span class="p">),</span>
    <span class="s1">&#39;level&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>Once you have configured the <code>tap</code> option on your channel, you&#39;re ready to define the class that will customize your Monolog instance. This class only needs a single method: <code>__invoke</code>, which receives an <code>Illuminate\Log\Logger</code> instance. The <code>Illuminate\Log\Logger</code> instance proxies all method calls to the underlying Monolog instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Logging</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Monolog\Formatter\LineFormatter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CustomizeFormatter</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Customize the given logger instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Log\Logger  $logger</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="nv">$logger</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">getHandlers</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">LineFormatter</span><span class="p">(</span>
                <span class="s1">&#39;[%datetime%] %channel%.%level_name%: %message% %context% %extra%&#39;</span>
            <span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} All of your &quot;tap&quot; classes are resolved by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so any constructor dependencies they require will automatically be injected.</p>
</blockquote>

<p><a name="creating-monolog-handler-channels"></a></p>

<h3>Creating Monolog Handler Channels</h3>

<p>Monolog has a variety of <a href="https://github.com/Seldaek/monolog/tree/master/src/Monolog/Handler">available handlers</a>. In some cases, the type of logger you wish to create is merely a Monolog driver with an instance of a specific handler.  These channels can be created using the <code>monolog</code> driver.</p>

<p>When using the <code>monolog</code> driver, the <code>handler</code> configuration option is used to specify which handler will be instantiated. Optionally, any constructor parameters the handler needs may be specified using the <code>with</code> configuration option:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;logentries&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span>  <span class="p">=&gt;</span> <span class="s1">&#39;monolog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="p">=&gt;</span> <span class="nx">Monolog</span><span class="err">\</span><span class="nx">Handler</span><span class="err">\</span><span class="nx">SyslogUdpHandler</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;with&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;my.logentries.internal.datahubhost.company.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;10000&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>Monolog Formatters</h4>

<p>When using the <code>monolog</code> driver, the Monolog <code>LineFormatter</code> will be used as the default formatter. However, you may customize the type of formatter passed to the handler using the <code>formatter</code> and <code>formatter_with</code> configuration options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;browser&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;monolog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="p">=&gt;</span> <span class="nx">Monolog</span><span class="err">\</span><span class="nx">Handler</span><span class="err">\</span><span class="nx">BrowserConsoleHandler</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;formatter&#39;</span> <span class="p">=&gt;</span> <span class="nx">Monolog</span><span class="err">\</span><span class="nx">Formatter</span><span class="err">\</span><span class="nx">HtmlFormatter</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;formatter_with&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;dateFormat&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>If you are using a Monolog handler that is capable of providing its own formatter, you may set the value of the <code>formatter</code> configuration option to <code>default</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;newrelic&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;monolog&#39;</span><span class="p">,</span>
    <span class="s1">&#39;handler&#39;</span> <span class="p">=&gt;</span> <span class="nx">Monolog</span><span class="err">\</span><span class="nx">Handler</span><span class="err">\</span><span class="nx">NewRelicHandler</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;formatter&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="creating-channels-via-factories"></a></p>

<h3>Creating Channels Via Factories</h3>

<p>If you would like to define an entirely custom channel in which you have full control over Monolog&#39;s instantiation and configuration, you may specify a <code>custom</code> driver type in your <code>config/logging.php</code> configuration file. Your configuration should include a <code>via</code> option to point to the factory class which will be invoked to create the Monolog instance:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;channels&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;custom&#39;</span><span class="p">,</span>
        <span class="s1">&#39;via&#39;</span> <span class="p">=&gt;</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Logging</span><span class="err">\</span><span class="nx">CreateCustomLogger</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>Once you have configured the <code>custom</code> channel, you&#39;re ready to define the class that will create your Monolog instance. This class only needs a single method: <code>__invoke</code>, which should return the Monolog instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Logging</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateCustomLogger</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Create a custom Monolog instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  array  $config</span>
<span class="sd">     * @return \Monolog\Logger</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="k">array</span> <span class="nv">$config</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Mail</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#generating-mailables">Generating Mailables</a></li>
<li><a href="#writing-mailables">Writing Mailables</a>

<ul>
<li><a href="#configuring-the-sender">Configuring The Sender</a></li>
<li><a href="#configuring-the-view">Configuring The View</a></li>
<li><a href="#view-data">View Data</a></li>
<li><a href="#attachments">Attachments</a></li>
<li><a href="#inline-attachments">Inline Attachments</a></li>
<li><a href="#customizing-the-swiftmailer-message">Customizing The SwiftMailer Message</a></li>
</ul></li>
<li><a href="#markdown-mailables">Markdown Mailables</a>

<ul>
<li><a href="#generating-markdown-mailables">Generating Markdown Mailables</a></li>
<li><a href="#writing-markdown-messages">Writing Markdown Messages</a></li>
<li><a href="#customizing-the-components">Customizing The Components</a></li>
</ul></li>
<li><a href="#sending-mail">Sending Mail</a>

<ul>
<li><a href="#queueing-mail">Queueing Mail</a></li>
</ul></li>
<li><a href="#rendering-mailables">Rendering Mailables</a>

<ul>
<li><a href="#previewing-mailables-in-the-browser">Previewing Mailables In The Browser</a></li>
</ul></li>
<li><a href="#localizing-mailables">Localizing Mailables</a></li>
<li><a href="#mail-and-local-development">Mail &amp; Local Development</a></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides a clean, simple API over the popular <a href="https://swiftmailer.symfony.com/">SwiftMailer</a> library with drivers for SMTP, Mailgun, Postmark, Amazon SES, and <code>sendmail</code>, allowing you to quickly get started sending mail through a local or cloud based service of your choice.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>Laravel&#39;s email services may be configured via the <code>mail</code> configuration file. Each mailer configured within this file may have its own options and even its own unique &quot;transport&quot;, allowing your application to use different email services to send certain email messages. For example, your application might use Postmark to send transactional mail while using Amazon SES to send bulk mail.</p>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<p>The API based drivers such as Mailgun and Postmark are often simpler and faster than SMTP servers. If possible, you should use one of these drivers. All of the API drivers require the Guzzle HTTP library, which may be installed via the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">guzzlehttp</span><span class="o">/</span><span class="nx">guzzle</span>
</pre></div>

<h4>Mailgun Driver</h4>

<p>To use the Mailgun driver, first install Guzzle, then set the <code>default</code> option in your <code>config/mail.php</code> configuration file to <code>mailgun</code>. Next, verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mailgun&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-key&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>If you are not using the &quot;US&quot; <a href="https://documentation.mailgun.com/en/latest/api-intro.html#mailgun-regions">Mailgun region</a>, you may define your region&#39;s endpoint in the <code>services</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mailgun&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-mailgun-key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;endpoint&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;api.eu.mailgun.net&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>Postmark Driver</h4>

<p>To use the Postmark driver, install Postmark&#39;s SwiftMailer transport via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">wildbit</span><span class="o">/</span><span class="nx">swiftmailer</span><span class="o">-</span><span class="nx">postmark</span>
</pre></div>

<p>Next, install Guzzle and set the <code>default</code> option in your <code>config/mail.php</code> configuration file to <code>postmark</code>. Finally, verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;postmark&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;token&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-postmark-token&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>SES Driver</h4>

<p>To use the Amazon SES driver you must first install the Amazon AWS SDK for PHP. You may install this library by adding the following line to your <code>composer.json</code> file&#39;s <code>require</code> section and running the <code>composer update</code> command:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;aws/aws-sdk-php&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.0&quot;</span>
</pre></div>

<p>Next, set the <code>default</code> option in your <code>config/mail.php</code> configuration file to <code>ses</code> and verify that your <code>config/services.php</code> configuration file contains the following options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;ses&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ses-region&#39;</span><span class="p">,</span>  <span class="c1">// e.g. us-east-1</span>
<span class="p">],</span>
</pre></div>

<p>If you need to include <a href="https://docs.aws.amazon.com/aws-sdk-php/v3/api/api-email-2010-12-01.html#sendrawemail">additional options</a> when executing the SES <code>SendRawEmail</code> request, you may define an <code>options</code> array within your <code>ses</code> configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;ses&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-ses-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ses-region&#39;</span><span class="p">,</span>  <span class="c1">// e.g. us-east-1</span>
    <span class="s1">&#39;options&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;ConfigurationSetName&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;MyConfigurationSet&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Tags&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">&#39;Name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Value&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="generating-mailables"></a></p>

<h2>Generating Mailables</h2>

<p>In Laravel, each type of email sent by your application is represented as a &quot;mailable&quot; class. These classes are stored in the <code>app/Mail</code> directory. Don&#39;t worry if you don&#39;t see this directory in your application, since it will be generated for you when you create your first mailable class using the <code>make:mail</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">mail</span> <span class="nx">OrderShipped</span>
</pre></div>

<p><a name="writing-mailables"></a></p>

<h2>Writing Mailables</h2>

<p>All of a mailable class&#39; configuration is done in the <code>build</code> method. Within this method, you may call various methods such as <code>from</code>, <code>subject</code>, <code>view</code>, and <code>attach</code> to configure the email&#39;s presentation and delivery.</p>

<p><a name="configuring-the-sender"></a></p>

<h3>Configuring The Sender</h3>

<h4>Using The <code>from</code> Method</h4>

<p>First, let&#39;s explore configuring the sender of the email. Or, in other words, who the email is going to be &quot;from&quot;. There are two ways to configure the sender. First, you may use the <code>from</code> method within your mailable class&#39; <code>build</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Using A Global <code>from</code> Address</h4>

<p>However, if your application uses the same &quot;from&quot; address for all of its emails, it can become cumbersome to call the <code>from</code> method in each mailable class you generate. Instead, you may specify a global &quot;from&quot; address in your <code>config/mail.php</code> configuration file. This address will be used if no other &quot;from&quot; address is specified within the mailable class:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;from&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App Name&#39;</span><span class="p">],</span>
</pre></div>

<p>In addition, you may define a global &quot;reply_to&quot; address within your <code>config/mail.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;reply_to&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;App Name&#39;</span><span class="p">],</span>
</pre></div>

<p><a name="configuring-the-view"></a></p>

<h3>Configuring The View</h3>

<p>Within a mailable class&#39; <code>build</code> method, you may use the <code>view</code> method to specify which template should be used when rendering the email&#39;s contents. Since each email typically uses a <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade template</a> to render its contents, you have the full power and convenience of the Blade templating engine when building your email&#39;s HTML:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may wish to create a <code>resources/views/emails</code> directory to house all of your email templates; however, you are free to place them wherever you wish within your <code>resources/views</code> directory.</p>
</blockquote>

<h4>Plain Text Emails</h4>

<p>If you would like to define a plain-text version of your email, you may use the <code>text</code> method. Like the <code>view</code> method, the <code>text</code> method accepts a template name which will be used to render the contents of the email. You are free to define both an HTML and plain-text version of your message:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped_plain&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="view-data"></a></p>

<h3>View Data</h3>

<h4>Via Public Properties</h4>

<p>Typically, you will want to pass some data to your view that you can utilize when rendering the email&#39;s HTML. There are two ways you may make data available to your view. First, any public property defined on your mailable class will automatically be made available to the view. So, for example, you may pass data into your mailable class&#39; constructor and set that data to public properties defined on the class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Mail\Mailable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderShipped</span> <span class="k">extends</span> <span class="nx">Mailable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The order instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @var Order</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new message instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\Order  $order</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Build the message.</span>
<span class="sd">     *</span>
<span class="sd">     * @return $this</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">build</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the data has been set to a public property, it will automatically be available in your view, so you may access it like you would access any other data in your Blade templates:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="nx">Price</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">price</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<h4>Via The <code>with</code> Method:</h4>

<p>If you would like to customize the format of your email&#39;s data before it is sent to the template, you may manually pass your data to the view via the <code>with</code> method. Typically, you will still pass data via the mailable class&#39; constructor; however, you should set this data to <code>protected</code> or <code>private</code> properties so the data is not automatically made available to the template. Then, when calling the <code>with</code> method, pass an array of data that you wish to make available to the template:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Mail</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Mail\Mailable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderShipped</span> <span class="k">extends</span> <span class="nx">Mailable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The order instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @var \App\Models\Order</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new message instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\Order $order</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Build the message.</span>
<span class="sd">     *</span>
<span class="sd">     * @return $this</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">build</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">with</span><span class="p">([</span>
                        <span class="s1">&#39;orderName&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
                        <span class="s1">&#39;orderPrice&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">,</span>
                    <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the data has been passed to the <code>with</code> method, it will automatically be available in your view, so you may access it like you would access any other data in your Blade templates:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="nx">Price</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">$orderPrice</span> <span class="p">}}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>

<p><a name="attachments"></a></p>

<h3>Attachments</h3>

<p>To add attachments to an email, use the <code>attach</code> method within the mailable class&#39; <code>build</code> method. The <code>attach</code> method accepts the full path to the file as its first argument:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>When attaching files to a message, you may also specify the display name and / or MIME type by passing an <code>array</code> as the second argument to the <code>attach</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attach</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">,</span> <span class="p">[</span>
                    <span class="s1">&#39;as&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;name.pdf&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
                <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<h4>Attaching Files from Disk</h4>

<p>If you have stored a file on one of your <a href="/docs/%7B%7Bversion%7D%7D/filesystem">filesystem disks</a>, you may attach it to the email using the <code>attachFromStorage</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">attachFromStorage</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If necessary, you may specify the file&#39;s attachment name and additional options using the second and third arguments to the <code>attachFromStorage</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">attachFromStorage</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">,</span> <span class="s1">&#39;name.pdf&#39;</span><span class="p">,</span> <span class="p">[</span>
                   <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;application/pdf&#39;</span>
               <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>attachFromStorageDisk</code> method may be used if you need to specify a storage disk other than your default disk:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
               <span class="o">-&gt;</span><span class="nx">attachFromStorageDisk</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Raw Data Attachments</h4>

<p>The <code>attachData</code> method may be used to attach a raw string of bytes as an attachment. For example, you might use this method if you have generated a PDF in memory and want to attach it to the email without writing it to disk. The <code>attachData</code> method accepts the raw data bytes as its first argument, the name of the file as its second argument, and an array of options as its third argument:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attachData</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">pdf</span><span class="p">,</span> <span class="s1">&#39;name.pdf&#39;</span><span class="p">,</span> <span class="p">[</span>
                    <span class="s1">&#39;mime&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
                <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="inline-attachments"></a></p>

<h3>Inline Attachments</h3>

<p>Embedding inline images into your emails is typically cumbersome; however, Laravel provides a convenient way to attach images to your emails and retrieving the appropriate CID. To embed an inline image, use the <code>embed</code> method on the <code>$message</code> variable within your email template. Laravel automatically makes the <code>$message</code> variable available to all of your email templates, so you don&#39;t need to worry about passing it in manually:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;{{ $message-&gt;embed($pathToImage) }}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<blockquote>
<p>{note} <code>$message</code> variable is not available in plain-text messages since plain-text messages do not utilize inline attachments.</p>
</blockquote>

<h4>Embedding Raw Data Attachments</h4>

<p>If you already have a raw data string you wish to embed into an email template, you may use the <code>embedData</code> method on the <code>$message</code> variable:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">from</span> <span class="nx">raw</span> <span class="nx">data</span><span class="o">:</span>

    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;{{ $message-&gt;embedData($data, $name) }}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
</pre></div>

<p><a name="customizing-the-swiftmailer-message"></a></p>

<h3>Customizing The SwiftMailer Message</h3>

<p>The <code>withSwiftMessage</code> method of the <code>Mailable</code> base class allows you to register a callback which will be invoked with the raw SwiftMailer message instance before sending the message. This gives you an opportunity to customize the message before it is delivered:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">withSwiftMessage</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$message</span><span class="o">-&gt;</span><span class="nx">getHeaders</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">addTextHeader</span><span class="p">(</span><span class="s1">&#39;Custom-Header&#39;</span><span class="p">,</span> <span class="s1">&#39;HeaderValue&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="markdown-mailables"></a></p>

<h2>Markdown Mailables</h2>

<p>Markdown mailable messages allow you to take advantage of the pre-built templates and components of mail notifications in your mailables. Since the messages are written in Markdown, Laravel is able to render beautiful, responsive HTML templates for the messages while also automatically generating a plain-text counterpart.</p>

<p><a name="generating-markdown-mailables"></a></p>

<h3>Generating Markdown Mailables</h3>

<p>To generate a mailable with a corresponding Markdown template, you may use the <code>--markdown</code> option of the <code>make:mail</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">mail</span> <span class="nx">OrderShipped</span> <span class="o">--</span><span class="nx">markdown</span><span class="o">=</span><span class="nx">emails</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">shipped</span>
</pre></div>

<p>Then, when configuring the mailable within its <code>build</code> method, call the <code>markdown</code> method instead of the <code>view</code> method. The <code>markdown</code> method accepts the name of the Markdown template and an optional array of data to make available to the template:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Build the message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return $this</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">build</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">markdown</span><span class="p">(</span><span class="s1">&#39;emails.orders.shipped&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="writing-markdown-messages"></a></p>

<h3>Writing Markdown Messages</h3>

<p>Markdown mailables use a combination of Blade components and Markdown syntax which allow you to easily construct mail messages while leveraging Laravel&#39;s pre-crafted components:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::message&#39;</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">Order</span> <span class="nx">Shipped</span>

<span class="nx">Your</span> <span class="nx">order</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">shipped</span><span class="o">!</span>

<span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::button&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">])</span>
<span class="nx">View</span> <span class="nx">Order</span>
<span class="err">@</span><span class="nx">endcomponent</span>

<span class="nx">Thanks</span><span class="p">,</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="p">{{</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.name&#39;</span><span class="p">)</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<blockquote>
<p>{tip} Do not use excess indentation when writing Markdown emails. Markdown parsers will render indented content as code blocks.</p>
</blockquote>

<h4>Button Component</h4>

<p>The button component renders a centered button link. The component accepts two arguments, a <code>url</code> and an optional <code>color</code>. Supported colors are <code>primary</code>, <code>success</code>, and <code>error</code>. You may add as many button components to a message as you wish:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::button&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;success&#39;</span><span class="p">])</span>
<span class="nx">View</span> <span class="nx">Order</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<h4>Panel Component</h4>

<p>The panel component renders the given block of text in a panel that has a slightly different background color than the rest of the message. This allows you to draw attention to a given block of text:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::panel&#39;</span><span class="p">)</span>
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">panel</span> <span class="nx">content</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<h4>Table Component</h4>

<p>The table component allows you to transform a Markdown table into an HTML table. The component accepts the Markdown table as its content. Table column alignment is supported using the default Markdown table alignment syntax:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::table&#39;</span><span class="p">)</span>
<span class="o">|</span> <span class="nx">Laravel</span>       <span class="o">|</span> <span class="nx">Table</span>         <span class="o">|</span> <span class="nx">Example</span>  <span class="o">|</span>
<span class="o">|</span> <span class="o">-------------</span> <span class="o">|:-------------:|</span> <span class="o">--------:|</span>
<span class="o">|</span> <span class="nx">Col</span> <span class="mi">2</span> <span class="nx">is</span>      <span class="o">|</span> <span class="nx">Centered</span>      <span class="o">|</span> <span class="nx">$10</span>      <span class="o">|</span>
<span class="o">|</span> <span class="nx">Col</span> <span class="mi">3</span> <span class="nx">is</span>      <span class="o">|</span> <span class="nx">Right</span><span class="o">-</span><span class="nx">Aligned</span> <span class="o">|</span> <span class="nx">$20</span>      <span class="o">|</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<p><a name="customizing-the-components"></a></p>

<h3>Customizing The Components</h3>

<p>You may export all of the Markdown mail components to your own application for customization. To export the components, use the <code>vendor:publish</code> Artisan command to publish the <code>laravel-mail</code> asset tag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">mail</span>
</pre></div>

<p>This command will publish the Markdown mail components to the <code>resources/views/vendor/mail</code> directory. The <code>mail</code> directory will contain an <code>html</code> and a <code>text</code> directory, each containing their respective representations of every available component. You are free to customize these components however you like.</p>

<h4>Customizing The CSS</h4>

<p>After exporting the components, the <code>resources/views/vendor/mail/html/themes</code> directory will contain a <code>default.css</code> file. You may customize the CSS in this file and your styles will automatically be in-lined within the HTML representations of your Markdown mail messages.</p>

<p>If you would like to build an entirely new theme for Laravel&#39;s Markdown components, you may place a CSS file within the <code>html/themes</code> directory. After naming and saving your CSS file, update the <code>theme</code> option of the <code>mail</code> configuration file to match the name of your new theme.</p>

<p>To customize the theme for an individual mailable, you may set the <code>$theme</code> property of the mailable class to the name of the theme that should be used when sending that mailable.</p>

<p><a name="sending-mail"></a></p>

<h2>Sending Mail</h2>

<p>To send a message, use the <code>to</code> method on the <code>Mail</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>to</code> method accepts an email address, a user instance, or a collection of users. If you pass an object or collection of objects, the mailer will automatically use their <code>email</code> and <code>name</code> properties when setting the email recipients, so make sure these attributes are available on your objects. Once you have specified your recipients, you may pass an instance of your mailable class to the <code>send</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Mail\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Ship the given order.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $orderId</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">ship</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$orderId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>

        <span class="c1">// Ship order...</span>

        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nv">$order</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You are not limited to just specifying the &quot;to&quot; recipients when sending a message. You are free to set &quot;to&quot;, &quot;cc&quot;, and &quot;bcc&quot; recipients all within a single, chained method call:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Mail</span><span class="p">;</span>

<span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="nx">$moreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">bcc</span><span class="p">(</span><span class="nx">$evenMoreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
</pre></div>

<h4>Looping Over Recipients</h4>

<p>Occasionally, you may need to send a mailable to a list of recipients by iterating over an array of recipients / email addresses. Since the <code>to</code> method appends email addresses to the mailable&#39;s list of recipients, you should always re-create the mailable instance for each recipient:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">([</span><span class="s1">&#39;taylor@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;dries@example.com&#39;</span><span class="p">]</span> <span class="nx">as</span> <span class="nx">$recipient</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$recipient</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<h4>Sending Mail Via A Specific Mailer</h4>

<p>By default, Laravel will use the mailer configured as the <code>default</code> mailer in your <code>mail</code> configuration file. However, you may use the <code>mailer</code> method to send a message using a specific mailer configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">mailer</span><span class="p">(</span><span class="s1">&#39;postmark&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span>
        <span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
</pre></div>

<p><a name="queueing-mail"></a></p>

<h3>Queueing Mail</h3>

<h4>Queueing A Mail Message</h4>

<p>Since sending email messages can drastically lengthen the response time of your application, many developers choose to queue email messages for background sending. Laravel makes this easy using its built-in <a href="/docs/%7B%7Bversion%7D%7D/queues">unified queue API</a>. To queue a mail message, use the <code>queue</code> method on the <code>Mail</code> facade after specifying the message&#39;s recipients:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="nx">$moreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">bcc</span><span class="p">(</span><span class="nx">$evenMoreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">queue</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
</pre></div>

<p>This method will automatically take care of pushing a job onto the queue so the message is sent in the background. You will need to <a href="/docs/%7B%7Bversion%7D%7D/queues">configure your queues</a> before using this feature.</p>

<h4>Delayed Message Queueing</h4>

<p>If you wish to delay the delivery of a queued email message, you may use the <code>later</code> method. As its first argument, the <code>later</code> method accepts a <code>DateTime</code> instance indicating when the message should be sent:</p>
<div class="highlight"><pre><span></span><span class="nx">$when</span> <span class="o">=</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="nx">$moreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">bcc</span><span class="p">(</span><span class="nx">$evenMoreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">later</span><span class="p">(</span><span class="nx">$when</span><span class="p">,</span> <span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
</pre></div>

<h4>Pushing To Specific Queues</h4>

<p>Since all mailable classes generated using the <code>make:mail</code> command make use of the <code>Illuminate\Bus\Queueable</code> trait, you may call the <code>onQueue</code> and <code>onConnection</code> methods on any mailable class instance, allowing you to specify the connection and queue name for the message:</p>
<div class="highlight"><pre><span></span><span class="nx">$message</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">onConnection</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">);</span>

<span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="nx">cc</span><span class="p">(</span><span class="nx">$moreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">bcc</span><span class="p">(</span><span class="nx">$evenMoreUsers</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">queue</span><span class="p">(</span><span class="nx">$message</span><span class="p">);</span>
</pre></div>

<h4>Queueing By Default</h4>

<p>If you have mailable classes that you want to always be queued, you may implement the <code>ShouldQueue</code> contract on the class. Now, even if you call the <code>send</code> method when mailing, the mailable will still be queued since it implements the contract:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Queue</span><span class="err">\</span><span class="nx">ShouldQueue</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">OrderShipped</span> <span class="kr">extends</span> <span class="nx">Mailable</span> <span class="kr">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="rendering-mailables"></a></p>

<h2>Rendering Mailables</h2>

<p>Sometimes you may wish to capture the HTML content of a mailable without sending it. To accomplish this, you may call the <code>render</code> method of the mailable. This method will return the evaluated contents of the mailable as a string:</p>
<div class="highlight"><pre><span></span><span class="nx">$invoice</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Invoice</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Mail</span><span class="err">\</span><span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">render</span><span class="p">();</span>
</pre></div>

<p><a name="previewing-mailables-in-the-browser"></a></p>

<h3>Previewing Mailables In The Browser</h3>

<p>When designing a mailable&#39;s template, it is convenient to quickly preview the rendered mailable in your browser like a typical Blade template. For this reason, Laravel allows you to return any mailable directly from a route Closure or controller. When a mailable is returned, it will be rendered and displayed in the browser, allowing you to quickly preview its design without needing to send it to an actual email address:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mailable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$invoice</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Invoice</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Mail</span><span class="err">\</span><span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="localizing-mailables"></a></p>

<h2>Localizing Mailables</h2>

<p>Laravel allows you to send mailables in a locale other than the current language, and will even remember this locale if the mail is queued.</p>

<p>To accomplish this, the <code>Mail</code> facade offers a <code>locale</code> method to set the desired language. The application will change into this locale when the mailable is being formatted and then revert back to the previous locale when formatting is complete:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span><span class="o">-&gt;</span><span class="nx">locale</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<h3>User Preferred Locales</h3>

<p>Sometimes, applications store each user&#39;s preferred locale. By implementing the <code>HasLocalePreference</code> contract on one or more of your models, you may instruct Laravel to use this stored locale when sending mail:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Translation</span><span class="err">\</span><span class="nx">HasLocalePreference</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="kr">implements</span> <span class="nx">HasLocalePreference</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Get the user&#39;s preferred locale.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">preferredLocale</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">locale</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have implemented the interface, Laravel will automatically use the preferred locale when sending mailables and notifications to the model. Therefore, there is no need to call the <code>locale</code> method when using this interface:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">())</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipped</span><span class="p">(</span><span class="nx">$order</span><span class="p">));</span>
</pre></div>

<p><a name="mail-and-local-development"></a></p>

<h2>Mail &amp; Local Development</h2>

<p>When developing an application that sends email, you probably don&#39;t want to actually send emails to live email addresses. Laravel provides several ways to &quot;disable&quot; the actual sending of emails during local development.</p>

<h4>Log Driver</h4>

<p>Instead of sending your emails, the <code>log</code> mail driver will write all email messages to your log files for inspection. For more information on configuring your application per environment, check out the <a href="/docs/%7B%7Bversion%7D%7D/configuration#environment-configuration">configuration documentation</a>.</p>

<h4>Universal To</h4>

<p>Another solution provided by Laravel is to set a universal recipient of all emails sent by the framework. This way, all the emails generated by your application will be sent to a specific address, instead of the address actually specified when sending the message. This can be done via the <code>to</code> option in your <code>config/mail.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;to&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;address&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Example&#39;</span>
<span class="p">],</span>
</pre></div>

<h4>Mailtrap</h4>

<p>Finally, you may use a service like <a href="https://mailtrap.io">Mailtrap</a> and the <code>smtp</code> driver to send your email messages to a &quot;dummy&quot; mailbox where you may view them in a true email client. This approach has the benefit of allowing you to actually inspect the final emails in Mailtrap&#39;s message viewer.</p>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Laravel fires two events during the process of sending mail messages. The <code>MessageSending</code> event is fired prior to a message being sent, while the <code>MessageSent</code> event is fired after a message has been sent. Remember, these events are fired when the mail is being <em>sent</em>, not when it is queued. You may register an event listener for this event in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Illuminate\Mail\Events\MessageSending&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogSendingMessage&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s1">&#39;Illuminate\Mail\Events\MessageSent&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogSentMessage&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Middleware</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-middleware">Defining Middleware</a></li>
<li><a href="#registering-middleware">Registering Middleware</a>

<ul>
<li><a href="#global-middleware">Global Middleware</a></li>
<li><a href="#assigning-middleware-to-routes">Assigning Middleware To Routes</a></li>
<li><a href="#middleware-groups">Middleware Groups</a></li>
<li><a href="#sorting-middleware">Sorting Middleware</a></li>
</ul></li>
<li><a href="#middleware-parameters">Middleware Parameters</a></li>
<li><a href="#terminable-middleware">Terminable Middleware</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Middleware provide a convenient mechanism for filtering HTTP requests entering your application. For example, Laravel includes a middleware that verifies the user of your application is authenticated. If the user is not authenticated, the middleware will redirect the user to the login screen. However, if the user is authenticated, the middleware will allow the request to proceed further into the application.</p>

<p>Additional middleware can be written to perform a variety of tasks besides authentication. A CORS middleware might be responsible for adding the proper headers to all responses leaving your application. A logging middleware might log all incoming requests to your application.</p>

<p>There are several middleware included in the Laravel framework, including middleware for authentication and CSRF protection. All of these middleware are located in the <code>app/Http/Middleware</code> directory.</p>

<p><a name="defining-middleware"></a></p>

<h2>Defining Middleware</h2>

<p>To create a new middleware, use the <code>make:middleware</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">middleware</span> <span class="nx">CheckAge</span>
</pre></div>

<p>This command will place a new <code>CheckAge</code> class within your <code>app/Http/Middleware</code> directory. In this middleware, we will only allow access to the route if the supplied <code>age</code> is greater than 200. Otherwise, we will redirect the users back to the <code>home</code> URI:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckAge</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, if the given <code>age</code> is less than or equal to <code>200</code>, the middleware will return an HTTP redirect to the client; otherwise, the request will be passed further into the application. To pass the request deeper into the application (allowing the middleware to &quot;pass&quot;), call the <code>$next</code> callback with the <code>$request</code>.</p>

<p>It&#39;s best to envision middleware as a series of &quot;layers&quot; HTTP requests must pass through before they hit your application. Each layer can examine the request and even reject it entirely.</p>

<blockquote>
<p>{tip} All middleware are resolved via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so you may type-hint any dependencies you need within a middleware&#39;s constructor.</p>
</blockquote>

<h4>Before &amp; After Middleware</h4>

<p>Whether a middleware runs before or after a request depends on the middleware itself. For example, the following middleware would perform some task <strong>before</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BeforeMiddleware</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>However, this middleware would perform its task <strong>after</strong> the request is handled by the application:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AfterMiddleware</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Perform action</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-middleware"></a></p>

<h2>Registering Middleware</h2>

<p><a name="global-middleware"></a></p>

<h3>Global Middleware</h3>

<p>If you want a middleware to run during every HTTP request to your application, list the middleware class in the <code>$middleware</code> property of your <code>app/Http/Kernel.php</code> class.</p>

<p><a name="assigning-middleware-to-routes"></a></p>

<h3>Assigning Middleware To Routes</h3>

<p>If you would like to assign middleware to specific routes, you should first assign the middleware a key in your <code>app/Http/Kernel.php</code> file. By default, the <code>$routeMiddleware</code> property of this class contains entries for the middleware included with Laravel. To add your own, append it to this list and assign it a key of your choosing:</p>
<div class="highlight"><pre><span></span><span class="c1">// Within App\Http\Kernel Class...</span>

<span class="kr">protected</span> <span class="nx">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;auth&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">Authenticate</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;auth.basic&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AuthenticateWithBasicAuth</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;bindings&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SubstituteBindings</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;cache.headers&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SetCacheHeaders</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;can&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">Authorize</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;guest&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">RedirectIfAuthenticated</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;signed&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ValidateSignature</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;throttle&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ThrottleRequests</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;verified&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">EnsureEmailIsVerified</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Once the middleware has been defined in the HTTP kernel, you may use the <code>middleware</code> method to assign middleware to a route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also assign multiple middleware to the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">);</span>
</pre></div>

<p>When assigning middleware, you may also pass the fully qualified class name:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CheckAge</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="nx">CheckAge</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
</pre></div>

<p>When assigning middleware to a group of routes, you may occasionally need to prevent the middleware from being applied to an individual route within the group. You may accomplish this using the <code>withoutMiddleware</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CheckAge</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">([</span><span class="nx">CheckAge</span><span class="o">::</span><span class="kr">class</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">})</span><span class="o">-&gt;</span><span class="nx">withoutMiddleware</span><span class="p">([</span><span class="nx">CheckAge</span><span class="o">::</span><span class="kr">class</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>The <code>withoutMiddleware</code> method can only remove route middleware and does not apply to <a href="#global-middleware">global middleware</a>.</p>

<p><a name="middleware-groups"></a></p>

<h3>Middleware Groups</h3>

<p>Sometimes you may want to group several middleware under a single key to make them easier to assign to routes. You may do this using the <code>$middlewareGroups</code> property of your HTTP kernel.</p>

<p>Out of the box, Laravel comes with <code>web</code> and <code>api</code> middleware groups that contain common middleware you may want to apply to your web UI and API routes:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The application&#39;s route middleware groups.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">EncryptCookies</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Cookie</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AddQueuedCookiesToResponse</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Session</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">StartSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">View</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ShareErrorsFromSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="err">\</span><span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">VerifyCsrfToken</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SubstituteBindings</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;throttle:60,1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;auth:api&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p>Middleware groups may be assigned to routes and controller actions using the same syntax as individual middleware. Again, middleware groups make it more convenient to assign many middleware to a route at once:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;web&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">group</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">]],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;subscribed&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} Out of the box, the <code>web</code> middleware group is automatically applied to your <code>routes/web.php</code> file by the <code>RouteServiceProvider</code>.</p>
</blockquote>

<p><a name="sorting-middleware"></a></p>

<h3>Sorting Middleware</h3>

<p>Rarely, you may need your middleware to execute in a specific order but not have control over their order when they are assigned to the route. In this case, you may specify your middleware priority using the <code>$middlewarePriority</code> property of your <code>app/Http/Kernel.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The priority-sorted list of middleware.</span>
<span class="cm"> *</span>
<span class="cm"> * This forces non-global middleware to always be in the given order.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$middlewarePriority</span> <span class="o">=</span> <span class="p">[</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Session</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">StartSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">View</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ShareErrorsFromSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AuthenticatesRequests</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ThrottleRequests</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Session</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">AuthenticateSession</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SubstituteBindings</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">Authorize</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="middleware-parameters"></a></p>

<h2>Middleware Parameters</h2>

<p>Middleware can also receive additional parameters. For example, if your application needs to verify that the authenticated user has a given &quot;role&quot; before performing a given action, you could create a <code>CheckRole</code> middleware that receives a role name as an additional argument.</p>

<p>Additional middleware parameters will be passed to the middleware after the <code>$next</code> argument:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckRole</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle the incoming request.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Http\Request  $request</span>
<span class="sd">     * @param  \Closure  $next</span>
<span class="sd">     * @param  string  $role</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasRole</span><span class="p">(</span><span class="nv">$role</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Redirect...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Middleware parameters may be specified when defining the route by separating the middleware name and parameters with a <code>:</code>. Multiple parameters should be delimited by commas:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;post/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;role:editor&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="terminable-middleware"></a></p>

<h2>Terminable Middleware</h2>

<p>Sometimes a middleware may need to do some work after the HTTP response has been sent to the browser. If you define a <code>terminate</code> method on your middleware and your web server is using FastCGI, the <code>terminate</code> method will automatically be called after the response is sent to the browser:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Illuminate\Session\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StartSession</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">terminate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Store the session data...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>terminate</code> method should receive both the request and the response. Once you have defined a terminable middleware, you should add it to the list of route or global middleware in the <code>app/Http/Kernel.php</code> file.</p>

<p>When calling the <code>terminate</code> method on your middleware, Laravel will resolve a fresh instance of the middleware from the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. If you would like to use the same middleware instance when the <code>handle</code> and <code>terminate</code> methods are called, register the middleware with the container using the container&#39;s <code>singleton</code> method. Typically this should be done in the <code>register</code> method of your <code>AppServiceProvider.php</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">TerminableMiddleware</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">singleton</span><span class="p">(</span><span class="nx">TerminableMiddleware</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Migrations</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#generating-migrations">Generating Migrations</a>

<ul>
<li><a href="#squashing-migrations">Squashing Migrations</a></li>
</ul></li>
<li><a href="#migration-structure">Migration Structure</a></li>
<li><a href="#running-migrations">Running Migrations</a>

<ul>
<li><a href="#rolling-back-migrations">Rolling Back Migrations</a></li>
</ul></li>
<li><a href="#tables">Tables</a>

<ul>
<li><a href="#creating-tables">Creating Tables</a></li>
<li><a href="#renaming-and-dropping-tables">Renaming / Dropping Tables</a></li>
</ul></li>
<li><a href="#columns">Columns</a>

<ul>
<li><a href="#creating-columns">Creating Columns</a></li>
<li><a href="#column-modifiers">Column Modifiers</a></li>
<li><a href="#modifying-columns">Modifying Columns</a></li>
<li><a href="#dropping-columns">Dropping Columns</a></li>
</ul></li>
<li><a href="#indexes">Indexes</a>

<ul>
<li><a href="#creating-indexes">Creating Indexes</a></li>
<li><a href="#renaming-indexes">Renaming Indexes</a></li>
<li><a href="#dropping-indexes">Dropping Indexes</a></li>
<li><a href="#foreign-key-constraints">Foreign Key Constraints</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Migrations are like version control for your database, allowing your team to modify and share the application&#39;s database schema. Migrations are typically paired with Laravel&#39;s schema builder to build your application&#39;s database schema. If you have ever had to tell a teammate to manually add a column to their local database schema, you&#39;ve faced the problem that database migrations solve.</p>

<p>The Laravel <code>Schema</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a> provides database agnostic support for creating and manipulating tables across all of Laravel&#39;s supported database systems.</p>

<p><a name="generating-migrations"></a></p>

<h2>Generating Migrations</h2>

<p>To create a migration, use the <code>make:migration</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span>
</pre></div>

<p>The new migration will be placed in your <code>database/migrations</code> directory. Each migration file name contains a timestamp, which allows Laravel to determine the order of the migrations.</p>

<blockquote>
<p>{tip} Migration stubs may be customized using <a href="/docs/%7B%7Bversion%7D%7D/artisan#stub-customization">stub publishing</a></p>
</blockquote>

<p>The <code>--table</code> and <code>--create</code> options may also be used to indicate the name of the table and whether or not the migration will be creating a new table. These options pre-fill the generated migration stub file with the specified table:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_users_table</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="nx">users</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">add_votes_to_users_table</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>
</pre></div>

<p>If you would like to specify a custom output path for the generated migration, you may use the <code>--path</code> option when executing the <code>make:migration</code> command. The given path should be relative to your application&#39;s base path.</p>

<p><a name="squashing-migrations"></a></p>

<h3>Squashing Migrations</h3>

<p>As you build your application, you may accumulate more and more migrations over time. This can lead to your migration directory becoming bloated with potentially hundreds of migrations. If you would like, you may &quot;squash&quot; your migrations into a single SQL file. To get started, execute the <code>schema:dump</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">schema</span><span class="o">:</span><span class="nx">dump</span>

<span class="c1">// Dump the current database schema and prune all existing migrations...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">schema</span><span class="o">:</span><span class="nx">dump</span> <span class="o">--</span><span class="nx">prune</span>
</pre></div>

<p>When you execute this command, Laravel will write a &quot;schema&quot; file to your <code>database/schema</code> directory. Now, when you attempt to migrate your database and no other migrations have been executed, Laravel will execute the schema file&#39;s SQL first. After executing the schema file&#39;s commands, Laravel will execute any remaining migrations that were not part of the schema dump.</p>

<p>You should commit your database schema file to source control so that other new developers on your team may quickly create your application&#39;s initial database structure.</p>

<blockquote>
<p>{note} Migration squashing is only available for the MySQL, PostgreSQL, and SQLite databases.</p>
</blockquote>

<p><a name="migration-structure"></a></p>

<h2>Migration Structure</h2>

<p>A migration class contains two methods: <code>up</code> and <code>down</code>. The <code>up</code> method is used to add new tables, columns, or indexes to your database, while the <code>down</code> method should reverse the operations performed by the <code>up</code> method.</p>

<p>Within both of these methods you may use the Laravel schema builder to expressively create and modify tables. To learn about all of the methods available on the <code>Schema</code> builder, <a href="#creating-tables">check out its documentation</a>. For example, the following migration creates a <code>flights</code> table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateFlightsTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;airline&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Reverse the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="running-migrations"></a></p>

<h2>Running Migrations</h2>

<p>To run all of your outstanding migrations, execute the <code>migrate</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<blockquote>
<p>{note} If you are using the <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead virtual machine</a>, you should run this command from within your virtual machine.</p>
</blockquote>

<h4>Forcing Migrations To Run In Production</h4>

<p>Some migration operations are destructive, which means they may cause you to lose data. In order to protect you from running these commands against your production database, you will be prompted for confirmation before the commands are executed. To force the commands to run without a prompt, use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p><a name="rolling-back-migrations"></a></p>

<h3>Rolling Back Migrations</h3>

<p>To roll back the latest migration operation, you may use the <code>rollback</code> command. This command rolls back the last &quot;batch&quot; of migrations, which may include multiple migration files:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">rollback</span>
</pre></div>

<p>You may roll back a limited number of migrations by providing the <code>step</code> option to the <code>rollback</code> command. For example, the following command will roll back the last five migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">rollback</span> <span class="o">--</span><span class="nx">step</span><span class="o">=</span><span class="mi">5</span>
</pre></div>

<p>The <code>migrate:reset</code> command will roll back all of your application&#39;s migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">reset</span>
</pre></div>

<h4>Roll Back &amp; Migrate Using A Single Command</h4>

<p>The <code>migrate:refresh</code> command will roll back all of your migrations and then execute the <code>migrate</code> command. This command effectively re-creates your entire database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span>

<span class="c1">// Refresh the database and run all database seeds...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p>You may roll back &amp; re-migrate a limited number of migrations by providing the <code>step</code> option to the <code>refresh</code> command. For example, the following command will roll back &amp; re-migrate the last five migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">refresh</span> <span class="o">--</span><span class="nx">step</span><span class="o">=</span><span class="mi">5</span>
</pre></div>

<h4>Drop All Tables &amp; Migrate</h4>

<p>The <code>migrate:fresh</code> command will drop all tables from the database and then execute the <code>migrate</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">fresh</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">fresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p><a name="tables"></a></p>

<h2>Tables</h2>

<p><a name="creating-tables"></a></p>

<h3>Creating Tables</h3>

<p>To create a new database table, use the <code>create</code> method on the <code>Schema</code> facade. The <code>create</code> method accepts two arguments: the first is the name of the table, while the second is a <code>Closure</code> which receives a <code>Blueprint</code> object that may be used to define the new table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>When creating the table, you may use any of the schema builder&#39;s <a href="#creating-columns">column methods</a> to define the table&#39;s columns.</p>

<h4>Checking For Table / Column Existence</h4>

<p>You may check for the existence of a table or column using the <code>hasTable</code> and <code>hasColumn</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasTable</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Schema</span><span class="o">::</span><span class="nx">hasColumn</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Database Connection &amp; Table Options</h4>

<p>If you want to perform a schema operation on a database connection that is not your default connection, use the <code>connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>You may use the following commands on the schema builder to define the table&#39;s options:</p>

<p>Command  |  Description
-------  |  -----------
<code>$table-&gt;engine = &#39;InnoDB&#39;;</code>  |  Specify the table storage engine (MySQL).
<code>$table-&gt;charset = &#39;utf8mb4&#39;;</code>  |  Specify a default character set for the table (MySQL).
<code>$table-&gt;collation = &#39;utf8mb4_unicode_ci&#39;;</code>  |  Specify a default collation for the table (MySQL).
<code>$table-&gt;temporary();</code>  |  Create a temporary table (except SQL Server).</p>

<p><a name="renaming-and-dropping-tables"></a></p>

<h3>Renaming / Dropping Tables</h3>

<p>To rename an existing database table, use the <code>rename</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">rename</span><span class="p">(</span><span class="nx">$from</span><span class="p">,</span> <span class="nx">$to</span><span class="p">);</span>
</pre></div>

<p>To drop an existing table, you may use the <code>drop</code> or <code>dropIfExists</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">drop</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>

<span class="nx">Schema</span><span class="o">::</span><span class="nx">dropIfExists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</pre></div>

<h4>Renaming Tables With Foreign Keys</h4>

<p>Before renaming a table, you should verify that any foreign key constraints on the table have an explicit name in your migration files instead of letting Laravel assign a convention based name. Otherwise, the foreign key constraint name will refer to the old table name.</p>

<p><a name="columns"></a></p>

<h2>Columns</h2>

<p><a name="creating-columns"></a></p>

<h3>Creating Columns</h3>

<p>The <code>table</code> method on the <code>Schema</code> facade may be used to update existing tables. Like the <code>create</code> method, the <code>table</code> method accepts two arguments: the name of the table and a <code>Closure</code> that receives a <code>Blueprint</code> instance you may use to add columns to the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Available Column Types</h4>

<p>The schema builder contains a variety of column types that you may specify when building your tables:</p>

<p>Command  |  Description
-------  |  -----------
<code>$table-&gt;id();</code>  |  Alias of <code>$table-&gt;bigIncrements(&#39;id&#39;)</code>.
<code>$table-&gt;foreignId(&#39;user_id&#39;);</code>  |  Alias of <code>$table-&gt;unsignedBigInteger(&#39;user_id&#39;)</code>.
<code>$table-&gt;bigIncrements(&#39;id&#39;);</code>  |  Auto-incrementing UNSIGNED BIGINT (primary key) equivalent column.
<code>$table-&gt;bigInteger(&#39;votes&#39;);</code>  |  BIGINT equivalent column.
<code>$table-&gt;binary(&#39;data&#39;);</code>  |  BLOB equivalent column.
<code>$table-&gt;boolean(&#39;confirmed&#39;);</code>  |  BOOLEAN equivalent column.
<code>$table-&gt;char(&#39;name&#39;, 100);</code>  |  CHAR equivalent column with a length.
<code>$table-&gt;date(&#39;created_at&#39;);</code>  |  DATE equivalent column.
<code>$table-&gt;dateTime(&#39;created_at&#39;, 0);</code>  |  DATETIME equivalent column with precision (total digits).
<code>$table-&gt;dateTimeTz(&#39;created_at&#39;, 0);</code>  |  DATETIME (with timezone) equivalent column with precision (total digits).
<code>$table-&gt;decimal(&#39;amount&#39;, 8, 2);</code>  |  DECIMAL equivalent column with precision (total digits) and scale (decimal digits).
<code>$table-&gt;double(&#39;amount&#39;, 8, 2);</code>  |  DOUBLE equivalent column with precision (total digits) and scale (decimal digits).
<code>$table-&gt;enum(&#39;level&#39;, [&#39;easy&#39;, &#39;hard&#39;]);</code>  |  ENUM equivalent column.
<code>$table-&gt;float(&#39;amount&#39;, 8, 2);</code>  |  FLOAT equivalent column with a precision (total digits) and scale (decimal digits).
<code>$table-&gt;geometry(&#39;positions&#39;);</code>  |  GEOMETRY equivalent column.
<code>$table-&gt;geometryCollection(&#39;positions&#39;);</code>  |  GEOMETRYCOLLECTION equivalent column.
<code>$table-&gt;increments(&#39;id&#39;);</code>  |  Auto-incrementing UNSIGNED INTEGER (primary key) equivalent column.
<code>$table-&gt;integer(&#39;votes&#39;);</code>  |  INTEGER equivalent column.
<code>$table-&gt;ipAddress(&#39;visitor&#39;);</code>  |  IP address equivalent column.
<code>$table-&gt;json(&#39;options&#39;);</code>  |  JSON equivalent column.
<code>$table-&gt;jsonb(&#39;options&#39;);</code>  |  JSONB equivalent column.
<code>$table-&gt;lineString(&#39;positions&#39;);</code>  |  LINESTRING equivalent column.
<code>$table-&gt;longText(&#39;description&#39;);</code>  |  LONGTEXT equivalent column.
<code>$table-&gt;macAddress(&#39;device&#39;);</code>  |  MAC address equivalent column.
<code>$table-&gt;mediumIncrements(&#39;id&#39;);</code>  |  Auto-incrementing UNSIGNED MEDIUMINT (primary key) equivalent column.
<code>$table-&gt;mediumInteger(&#39;votes&#39;);</code>  |  MEDIUMINT equivalent column.
<code>$table-&gt;mediumText(&#39;description&#39;);</code>  |  MEDIUMTEXT equivalent column.
<code>$table-&gt;morphs(&#39;taggable&#39;);</code>  |  Adds <code>taggable_id</code> UNSIGNED BIGINT and <code>taggable_type</code> VARCHAR equivalent columns.
<code>$table-&gt;uuidMorphs(&#39;taggable&#39;);</code>  |  Adds <code>taggable_id</code> CHAR(36) and <code>taggable_type</code> VARCHAR(255) UUID equivalent columns.
<code>$table-&gt;multiLineString(&#39;positions&#39;);</code>  |  MULTILINESTRING equivalent column.
<code>$table-&gt;multiPoint(&#39;positions&#39;);</code>  |  MULTIPOINT equivalent column.
<code>$table-&gt;multiPolygon(&#39;positions&#39;);</code>  |  MULTIPOLYGON equivalent column.
<code>$table-&gt;nullableMorphs(&#39;taggable&#39;);</code>  |  Adds nullable versions of <code>morphs()</code> columns.
<code>$table-&gt;nullableUuidMorphs(&#39;taggable&#39;);</code>  |  Adds nullable versions of <code>uuidMorphs()</code> columns.
<code>$table-&gt;nullableTimestamps(0);</code>  |  Alias of <code>timestamps()</code> method.
<code>$table-&gt;point(&#39;position&#39;);</code>  |  POINT equivalent column.
<code>$table-&gt;polygon(&#39;positions&#39;);</code>  |  POLYGON equivalent column.
<code>$table-&gt;rememberToken();</code>  |  Adds a nullable <code>remember_token</code> VARCHAR(100) equivalent column.
<code>$table-&gt;set(&#39;flavors&#39;, [&#39;strawberry&#39;, &#39;vanilla&#39;]);</code>  |  SET equivalent column.
<code>$table-&gt;smallIncrements(&#39;id&#39;);</code>  |  Auto-incrementing UNSIGNED SMALLINT (primary key) equivalent column.
<code>$table-&gt;smallInteger(&#39;votes&#39;);</code>  |  SMALLINT equivalent column.
<code>$table-&gt;softDeletes(&#39;deleted_at&#39;, 0);</code>  |  Adds a nullable <code>deleted_at</code> TIMESTAMP equivalent column for soft deletes with precision (total digits).
<code>$table-&gt;softDeletesTz(&#39;deleted_at&#39;, 0);</code>  |  Adds a nullable <code>deleted_at</code> TIMESTAMP (with timezone) equivalent column for soft deletes with precision (total digits).
<code>$table-&gt;string(&#39;name&#39;, 100);</code>  |  VARCHAR equivalent column with a length.
<code>$table-&gt;text(&#39;description&#39;);</code>  |  TEXT equivalent column.
<code>$table-&gt;time(&#39;sunrise&#39;, 0);</code>  |  TIME equivalent column with precision (total digits).
<code>$table-&gt;timeTz(&#39;sunrise&#39;, 0);</code>  |  TIME (with timezone) equivalent column with precision (total digits).
<code>$table-&gt;timestamp(&#39;added_on&#39;, 0);</code>  |  TIMESTAMP equivalent column with precision (total digits).
<code>$table-&gt;timestampTz(&#39;added_on&#39;, 0);</code>  |  TIMESTAMP (with timezone) equivalent column with precision (total digits).
<code>$table-&gt;timestamps(0);</code>  |  Adds nullable <code>created_at</code> and <code>updated_at</code> TIMESTAMP equivalent columns with precision (total digits).
<code>$table-&gt;timestampsTz(0);</code>  |  Adds nullable <code>created_at</code> and <code>updated_at</code> TIMESTAMP (with timezone) equivalent columns with precision (total digits).
<code>$table-&gt;tinyIncrements(&#39;id&#39;);</code>  |  Auto-incrementing UNSIGNED TINYINT (primary key) equivalent column.
<code>$table-&gt;tinyInteger(&#39;votes&#39;);</code>  |  TINYINT equivalent column.
<code>$table-&gt;unsignedBigInteger(&#39;votes&#39;);</code>  |  UNSIGNED BIGINT equivalent column.
<code>$table-&gt;unsignedDecimal(&#39;amount&#39;, 8, 2);</code>  |  UNSIGNED DECIMAL equivalent column with a precision (total digits) and scale (decimal digits).
<code>$table-&gt;unsignedInteger(&#39;votes&#39;);</code>  |  UNSIGNED INTEGER equivalent column.
<code>$table-&gt;unsignedMediumInteger(&#39;votes&#39;);</code>  |  UNSIGNED MEDIUMINT equivalent column.
<code>$table-&gt;unsignedSmallInteger(&#39;votes&#39;);</code>  |  UNSIGNED SMALLINT equivalent column.
<code>$table-&gt;unsignedTinyInteger(&#39;votes&#39;);</code>  |  UNSIGNED TINYINT equivalent column.
<code>$table-&gt;uuid(&#39;id&#39;);</code>  |  UUID equivalent column.
<code>$table-&gt;year(&#39;birth_year&#39;);</code>  |  YEAR equivalent column.</p>

<p><a name="column-modifiers"></a></p>

<h3>Column Modifiers</h3>

<p>In addition to the column types listed above, there are several column &quot;modifiers&quot; you may use while adding a column to a database table. For example, to make the column &quot;nullable&quot;, you may use the <code>nullable</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The following list contains all available column modifiers. This list does not include the <a href="#creating-indexes">index modifiers</a>:</p>

<p>Modifier  |  Description
--------  |  -----------
<code>-&gt;after(&#39;column&#39;)</code>  |  Place the column &quot;after&quot; another column (MySQL)
<code>-&gt;autoIncrement()</code>  |  Set INTEGER columns as auto-increment (primary key)
<code>-&gt;charset(&#39;utf8mb4&#39;)</code>  |  Specify a character set for the column (MySQL)
<code>-&gt;collation(&#39;utf8mb4_unicode_ci&#39;)</code>  |  Specify a collation for the column (MySQL/PostgreSQL/SQL Server)
<code>-&gt;comment(&#39;my comment&#39;)</code>  |  Add a comment to a column (MySQL/PostgreSQL)
<code>-&gt;default($value)</code>  |  Specify a &quot;default&quot; value for the column
<code>-&gt;first()</code>  |  Place the column &quot;first&quot; in the table (MySQL)
<code>-&gt;nullable($value = true)</code>  |  Allows (by default) NULL values to be inserted into the column
<code>-&gt;storedAs($expression)</code>  |  Create a stored generated column (MySQL)
<code>-&gt;unsigned()</code>  |  Set INTEGER columns as UNSIGNED (MySQL)
<code>-&gt;useCurrent()</code>  |  Set TIMESTAMP columns to use CURRENT_TIMESTAMP as default value
<code>-&gt;virtualAs($expression)</code>  |  Create a virtual generated column (MySQL)
<code>-&gt;generatedAs($expression)</code>  |  Create an identity column with specified sequence options (PostgreSQL)
<code>-&gt;always()</code>  |  Defines the precedence of sequence values over input for an identity column (PostgreSQL)</p>

<h4>Default Expressions</h4>

<p>The <code>default</code> modifier accepts a value or an <code>\Illuminate\Database\Query\Expression</code> instance. Using an <code>Expression</code> instance will prevent wrapping the value in quotes and allow you to use database specific functions. One situation where this is particularly useful is when you need to assign default values to JSON columns:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Query\Expression</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateFlightsTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">default</span><span class="p">(</span><span class="k">new</span> <span class="nx">Expression</span><span class="p">(</span><span class="s1">&#39;(JSON_ARRAY())&#39;</span><span class="p">));</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Support for default expressions depends on your database driver, database version, and the field type. Please refer to the appropriate documentation for compatibility. Also note that using database specific functions may tightly couple you to a specific driver.</p>
</blockquote>

<p><a name="modifying-columns"></a></p>

<h3>Modifying Columns</h3>

<h4>Prerequisites</h4>

<p>Before modifying a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file. The Doctrine DBAL library is used to determine the current state of the column and create the SQL queries needed to make the required adjustments:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">doctrine</span><span class="o">/</span><span class="nx">dbal</span>
</pre></div>

<h4>Updating Column Attributes</h4>

<p>The <code>change</code> method allows you to modify type and attributes of existing columns. For example, you may wish to increase the size of a <code>string</code> column. To see the <code>change</code> method in action, let&#39;s increase the size of the <code>name</code> column from 25 to 50:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>We could also modify a column to be nullable:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">change</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} Only the following column types can be &quot;changed&quot;: bigInteger, binary, boolean, date, dateTime, dateTimeTz, decimal, integer, json, longText, mediumText, smallInteger, string, text, time, unsignedBigInteger, unsignedInteger, unsignedSmallInteger and uuid.</p>
</blockquote>

<h4>Renaming Columns</h4>

<p>To rename a column, you may use the <code>renameColumn</code> method on the schema builder. Before renaming a column, be sure to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">renameColumn</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} Renaming any column in a table that also has a column of type <code>enum</code> is not currently supported.</p>
</blockquote>

<p><a name="dropping-columns"></a></p>

<h3>Dropping Columns</h3>

<p>To drop a column, use the <code>dropColumn</code> method on the schema builder. Before dropping columns from a SQLite database, you will need to add the <code>doctrine/dbal</code> dependency to your <code>composer.json</code> file and run the <code>composer update</code> command in your terminal to install the library:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may drop multiple columns from a table by passing an array of column names to the <code>dropColumn</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropColumn</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} Dropping or modifying multiple columns within a single migration while using a SQLite database is not supported.</p>
</blockquote>

<h4>Available Command Aliases</h4>

<p>Command  |  Description
-------  |  -----------
<code>$table-&gt;dropMorphs(&#39;morphable&#39;);</code>  |  Drop the <code>morphable_id</code> and <code>morphable_type</code> columns.
<code>$table-&gt;dropRememberToken();</code>  |  Drop the <code>remember_token</code> column.
<code>$table-&gt;dropSoftDeletes();</code>  |  Drop the <code>deleted_at</code> column.
<code>$table-&gt;dropSoftDeletesTz();</code>  |  Alias of <code>dropSoftDeletes()</code> method.
<code>$table-&gt;dropTimestamps();</code>  |  Drop the <code>created_at</code> and <code>updated_at</code> columns.
<code>$table-&gt;dropTimestampsTz();</code> |  Alias of <code>dropTimestamps()</code> method.</p>

<p><a name="indexes"></a></p>

<h2>Indexes</h2>

<p><a name="creating-indexes"></a></p>

<h3>Creating Indexes</h3>

<p>The Laravel schema builder supports several types of indexes. The following example creates a new <code>email</code> column and specifies that its values should be unique. To create the index, we can chain the <code>unique</code> method onto the column definition:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may create the index after defining the column. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<p>You may even pass an array of columns to an index method to create a compound (or composite) index:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">index</span><span class="p">([</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">]);</span>
</pre></div>

<p>Laravel will automatically generate an index name based on the table, column names, and the index type, but you may pass a second argument to the method to specify the index name yourself:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;unique_email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Available Index Types</h4>

<p>Each index method accepts an optional second argument to specify the name of the index. If omitted, the name will be derived from the names of the table and column(s) used for the index, as well as the index type.</p>

<p>Command  |  Description
-------  |  -----------
<code>$table-&gt;primary(&#39;id&#39;);</code>  |  Adds a primary key.
<code>$table-&gt;primary([&#39;id&#39;, &#39;parent_id&#39;]);</code>  |  Adds composite keys.
<code>$table-&gt;unique(&#39;email&#39;);</code>  |  Adds a unique index.
<code>$table-&gt;index(&#39;state&#39;);</code>  |  Adds a plain index.
<code>$table-&gt;spatialIndex(&#39;location&#39;);</code>  |  Adds a spatial index. (except SQLite)</p>

<h4>Index Lengths &amp; MySQL / MariaDB</h4>

<p>Laravel uses the <code>utf8mb4</code> character set by default, which includes support for storing &quot;emojis&quot; in the database. If you are running a version of MySQL older than the 5.7.7 release or MariaDB older than the 10.2.2 release, you may need to manually configure the default string length generated by migrations in order for MySQL to create indexes for them. You may configure this by calling the <code>Schema::defaultStringLength</code> method within your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Schema</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Schema</span><span class="o">::</span><span class="nx">defaultStringLength</span><span class="p">(</span><span class="mi">191</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, you may enable the <code>innodb_large_prefix</code> option for your database. Refer to your database&#39;s documentation for instructions on how to properly enable this option.</p>

<p><a name="renaming-indexes"></a></p>

<h3>Renaming Indexes</h3>

<p>To rename an index, you may use the <code>renameIndex</code> method. This method accepts the current index name as its first argument and the desired new name as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">renameIndex</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">)</span>
</pre></div>

<p><a name="dropping-indexes"></a></p>

<h3>Dropping Indexes</h3>

<p>To drop an index, you must specify the index&#39;s name. By default, Laravel automatically assigns an index name based on the table name, the name of the indexed column, and the index type. Here are some examples:</p>

<p>Command  |  Description
-------  |  -----------
<code>$table-&gt;dropPrimary(&#39;users_id_primary&#39;);</code>  |  Drop a primary key from the &quot;users&quot; table.
<code>$table-&gt;dropUnique(&#39;users_email_unique&#39;);</code>  |  Drop a unique index from the &quot;users&quot; table.
<code>$table-&gt;dropIndex(&#39;geo_state_index&#39;);</code>  |  Drop a basic index from the &quot;geo&quot; table.
<code>$table-&gt;dropSpatialIndex(&#39;geo_location_spatialindex&#39;);</code>  |  Drop a spatial index from the &quot;geo&quot; table  (except SQLite).</p>

<p>If you pass an array of columns into a method that drops indexes, the conventional index name will be generated based on the table name, columns and key type:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropIndex</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">]);</span> <span class="c1">// Drops index &#39;geo_state_index&#39;</span>
<span class="p">});</span>
</pre></div>

<p><a name="foreign-key-constraints"></a></p>

<h3>Foreign Key Constraints</h3>

<p>Laravel also provides support for creating foreign key constraints, which are used to force referential integrity at the database level. For example, let&#39;s define a <code>user_id</code> column on the <code>posts</code> table that references the <code>id</code> column on a <code>users</code> table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">unsignedBigInteger</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">);</span>

    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Since this syntax is rather verbose, Laravel provides additional, terser methods that use convention to provide a better developer experience. The example above could be written like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreignId</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">constrained</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The <code>foreignId</code> method is an alias for <code>unsignedBigInteger</code> while the <code>constrained</code> method will use convention to determine the table and column name being referenced. If your table name does not match the convention, you may specify the table name by passing it as an argument to the <code>constrained</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreignId</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">constrained</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may also specify the desired action for the &quot;on delete&quot; and &quot;on update&quot; properties of the constraint:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreignId</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">constrained</span><span class="p">()</span>
      <span class="o">-&gt;</span><span class="nx">onDelete</span><span class="p">(</span><span class="s1">&#39;cascade&#39;</span><span class="p">);</span>
</pre></div>

<p>Any additional <a href="#column-modifiers">column modifiers</a> must be called before <code>constrained</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreignId</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">()</span>
      <span class="o">-&gt;</span><span class="nx">constrained</span><span class="p">();</span>
</pre></div>

<p>To drop a foreign key, you may use the <code>dropForeign</code> method, passing the foreign key constraint to be deleted as an argument. Foreign key constraints use the same naming convention as indexes, based on the table name and the columns in the constraint, followed by a &quot;_foreign&quot; suffix:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">(</span><span class="s1">&#39;posts_user_id_foreign&#39;</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may pass an array containing the column name that holds the foreign key to the <code>dropForeign</code> method. The array will be automatically converted using the constraint name convention used by Laravel&#39;s schema builder:</p>
<div class="highlight"><pre><span></span><span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">dropForeign</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span><span class="p">]);</span>
</pre></div>

<p>You may enable or disable foreign key constraints within your migrations by using the following methods:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">enableForeignKeyConstraints</span><span class="p">();</span>

<span class="nx">Schema</span><span class="o">::</span><span class="nx">disableForeignKeyConstraints</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} SQLite disables foreign key constraints by default. When using SQLite, make sure to <a href="/docs/%7B%7Bversion%7D%7D/database#configuration">enable foreign key support</a> in your database configuration before attempting to create them in your migrations. In addition, SQLite only supports foreign keys upon creation of the table and <a href="https://www.sqlite.org/omitted.html">not when tables are altered</a>.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Compiling Assets (Mix)</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation &amp; Setup</a></li>
<li><a href="#running-mix">Running Mix</a></li>
<li><a href="#working-with-stylesheets">Working With Stylesheets</a>

<ul>
<li><a href="#less">Less</a></li>
<li><a href="#sass">Sass</a></li>
<li><a href="#stylus">Stylus</a></li>
<li><a href="#postcss">PostCSS</a></li>
<li><a href="#plain-css">Plain CSS</a></li>
<li><a href="#url-processing">URL Processing</a></li>
<li><a href="#css-source-maps">Source Maps</a></li>
</ul></li>
<li><a href="#working-with-scripts">Working With JavaScript</a>

<ul>
<li><a href="#vendor-extraction">Vendor Extraction</a></li>
<li><a href="#react">React</a></li>
<li><a href="#vanilla-js">Vanilla JS</a></li>
<li><a href="#custom-webpack-configuration">Custom Webpack Configuration</a></li>
</ul></li>
<li><a href="#copying-files-and-directories">Copying Files &amp; Directories</a></li>
<li><a href="#versioning-and-cache-busting">Versioning / Cache Busting</a></li>
<li><a href="#browsersync-reloading">Browsersync Reloading</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#notifications">Notifications</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="https://github.com/JeffreyWay/laravel-mix">Laravel Mix</a> provides a fluent API for defining Webpack build steps for your Laravel application using several common CSS and JavaScript pre-processors. Through simple method chaining, you can fluently define your asset pipeline. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.scss&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
</pre></div>

<p>If you&#39;ve ever been confused and overwhelmed about getting started with Webpack and asset compilation, you will love Laravel Mix. However, you are not required to use it while developing your application; you are free to use any asset pipeline tool you wish, or even none at all.</p>

<p><a name="installation"></a></p>

<h2>Installation &amp; Setup</h2>

<h4>Installing Node</h4>

<p>Before triggering Mix, you must first ensure that Node.js and NPM are installed on your machine.</p>
<div class="highlight"><pre><span></span><span class="nx">node</span> <span class="o">-</span><span class="nx">v</span>
<span class="nx">npm</span> <span class="o">-</span><span class="nx">v</span>
</pre></div>

<p>By default, Laravel Homestead includes everything you need; however, if you aren&#39;t using Vagrant, then you can easily install the latest version of Node and NPM using simple graphical installers from <a href="https://nodejs.org/en/download/">their download page</a>.</p>

<h4>Laravel Mix</h4>

<p>The only remaining step is to install Laravel Mix. Within a fresh installation of Laravel, you&#39;ll find a <code>package.json</code> file in the root of your directory structure. The default <code>package.json</code> file includes everything you need to get started. Think of this like your <code>composer.json</code> file, except it defines Node dependencies instead of PHP. You may install the dependencies it references by running:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

<p><a name="running-mix"></a></p>

<h2>Running Mix</h2>

<p>Mix is a configuration layer on top of <a href="https://webpack.js.org">Webpack</a>, so to run your Mix tasks you only need to execute one of the NPM scripts that is included with the default Laravel <code>package.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="c1">// Run all Mix tasks...</span>
<span class="nx">npm</span> <span class="nx">run</span> <span class="nx">dev</span>

<span class="c1">// Run all Mix tasks and minify output...</span>
<span class="nx">npm</span> <span class="nx">run</span> <span class="nx">production</span>
</pre></div>

<h4>Watching Assets For Changes</h4>

<p>The <code>npm run watch</code> command will continue running in your terminal and watch all relevant files for changes. Webpack will then automatically recompile your assets when it detects a change:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">watch</span>
</pre></div>

<p>You may find that in certain environments Webpack isn&#39;t updating when your files change. If this is the case on your system, consider using the <code>watch-poll</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">watch</span><span class="o">-</span><span class="nx">poll</span>
</pre></div>

<p><a name="working-with-stylesheets"></a></p>

<h2>Working With Stylesheets</h2>

<p>The <code>webpack.mix.js</code> file is your entry point for all asset compilation. Think of it as a light configuration wrapper around Webpack. Mix tasks can be chained together to define exactly how your assets should be compiled.</p>

<p><a name="less"></a></p>

<h3>Less</h3>

<p>The <code>less</code> method may be used to compile <a href="http://lesscss.org/">Less</a> into CSS. Let&#39;s compile our primary <code>app.less</code> file to <code>public/css/app.css</code>.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;resources/less/app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
</pre></div>

<p>Multiple calls to the <code>less</code> method may be used to compile multiple files:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;resources/less/app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;resources/less/admin.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
</pre></div>

<p>If you wish to customize the file name of the compiled CSS, you may pass a full file path as the second argument to the <code>less</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;resources/less/app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/stylesheets/styles.css&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to override the <a href="https://github.com/webpack-contrib/less-loader#options">underlying Less plug-in options</a>, you may pass an object as the third argument to <code>mix.less()</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">less</span><span class="p">(</span><span class="s1">&#39;resources/less/app.less&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">strictMath</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</pre></div>

<p><a name="sass"></a></p>

<h3>Sass</h3>

<p>The <code>sass</code> method allows you to compile <a href="https://sass-lang.com/">Sass</a> into CSS. You may use the method like so:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.scss&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
</pre></div>

<p>Again, like the <code>less</code> method, you may compile multiple Sass files into their own respective CSS files and even customize the output directory of the resulting CSS:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.sass&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/admin.sass&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css/admin&#39;</span><span class="p">);</span>
</pre></div>

<p>Additional <a href="https://github.com/sass/node-sass#options">Node-Sass plug-in options</a> may be provided as the third argument:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.sass&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">precision</span><span class="o">:</span> <span class="mi">5</span>
<span class="p">});</span>
</pre></div>

<p><a name="stylus"></a></p>

<h3>Stylus</h3>

<p>Similar to Less and Sass, the <code>stylus</code> method allows you to compile <a href="http://stylus-lang.com/">Stylus</a> into CSS:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">stylus</span><span class="p">(</span><span class="s1">&#39;resources/stylus/app.styl&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also install additional Stylus plug-ins, such as <a href="https://github.com/jescalan/rupture">Rupture</a>. First, install the plug-in in question through NPM (<code>npm install rupture</code>) and then require it in your call to <code>mix.stylus()</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">stylus</span><span class="p">(</span><span class="s1">&#39;resources/stylus/app.styl&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;rupture&#39;</span><span class="p">)()</span>
    <span class="p">]</span>
<span class="p">});</span>
</pre></div>

<p><a name="postcss"></a></p>

<h3>PostCSS</h3>

<p><a href="https://postcss.org/">PostCSS</a>, a powerful tool for transforming your CSS, is included with Laravel Mix out of the box. By default, Mix leverages the popular <a href="https://github.com/postcss/autoprefixer">Autoprefixer</a> plug-in to automatically apply all necessary CSS3 vendor prefixes. However, you&#39;re free to add any additional plug-ins that are appropriate for your application. First, install the desired plug-in through NPM and then reference it in your <code>webpack.mix.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.scss&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">options</span><span class="p">({</span>
        <span class="nx">postCss</span><span class="o">:</span> <span class="p">[</span>
            <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;postcss-css-variables&#39;</span><span class="p">)()</span>
        <span class="p">]</span>
    <span class="p">});</span>
</pre></div>

<p><a name="plain-css"></a></p>

<h3>Plain CSS</h3>

<p>If you would just like to concatenate some plain CSS stylesheets into a single file, you may use the <code>styles</code> method.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">styles</span><span class="p">([</span>
    <span class="s1">&#39;public/css/vendor/normalize.css&#39;</span><span class="p">,</span>
    <span class="s1">&#39;public/css/vendor/videojs.css&#39;</span>
<span class="p">],</span> <span class="s1">&#39;public/css/all.css&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="url-processing"></a></p>

<h3>URL Processing</h3>

<p>Because Laravel Mix is built on top of Webpack, it&#39;s important to understand a few Webpack concepts. For CSS compilation, Webpack will rewrite and optimize any <code>url()</code> calls within your stylesheets. While this might initially sound strange, it&#39;s an incredibly powerful piece of functionality. Imagine that we want to compile Sass that includes a relative URL to an image:</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">example</span> <span class="p">{</span>
    <span class="nx">background</span><span class="o">:</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;../images/example.png&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Absolute paths for any given <code>url()</code> will be excluded from URL-rewriting. For example, <code>url(&#39;/images/thing.png&#39;)</code> or <code>url(&#39;http://example.com/images/thing.png&#39;)</code> won&#39;t be modified.</p>
</blockquote>

<p>By default, Laravel Mix and Webpack will find <code>example.png</code>, copy it to your <code>public/images</code> folder, and then rewrite the <code>url()</code> within your generated stylesheet. As such, your compiled CSS will be:</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">example</span> <span class="p">{</span>
    <span class="nx">background</span><span class="o">:</span> <span class="nx">url</span><span class="p">(</span><span class="err">/images/example.png?d41d8cd98f00b204e9800998ecf8427e);</span>
<span class="p">}</span>
</pre></div>

<p>As useful as this feature may be, it&#39;s possible that your existing folder structure is already configured in a way you like. If this is the case, you may disable <code>url()</code> rewriting like so:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="s1">&#39;resources/sass/app.scss&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">options</span><span class="p">({</span>
        <span class="nx">processCssUrls</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
</pre></div>

<p>With this addition to your <code>webpack.mix.js</code> file, Mix will no longer match any <code>url()</code> or copy assets to your public directory. In other words, the compiled CSS will look just like how you originally typed it:</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">example</span> <span class="p">{</span>
    <span class="nx">background</span><span class="o">:</span> <span class="nx">url</span><span class="p">(</span><span class="s2">&quot;../images/thing.png&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="css-source-maps"></a></p>

<h3>Source Maps</h3>

<p>Though disabled by default, source maps may be activated by calling the <code>mix.sourceMaps()</code> method in your <code>webpack.mix.js</code> file. Though it comes with a compile/performance cost, this will provide extra debugging information to your browser&#39;s developer tools when using compiled assets.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sourceMaps</span><span class="p">();</span>
</pre></div>

<h4>Style Of Source Mapping</h4>

<p>Webpack offers a variety of <a href="https://webpack.js.org/configuration/devtool/#devtool">source mapping styles</a>. By default, Mix&#39;s source mapping style is set to <code>eval-source-map</code>, which provides a fast rebuild time. If you want to change the mapping style, you may do so using the <code>sourceMaps</code> method:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">productionSourceMaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sourceMaps</span><span class="p">(</span><span class="nx">productionSourceMaps</span><span class="p">,</span> <span class="s1">&#39;source-map&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="working-with-scripts"></a></p>

<h2>Working With JavaScript</h2>

<p>Mix provides several features to help you work with your JavaScript files, such as compiling ECMAScript 2015, module bundling, minification, and concatenating plain JavaScript files. Even better, this all works seamlessly, without requiring an ounce of custom configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">);</span>
</pre></div>

<p>With this single line of code, you may now take advantage of:</p>

<div class="content-list" markdown="1">
- ES2015 syntax.
- Modules
- Compilation of `.vue` files.
- Minification for production environments.
</div>

<p><a name="vendor-extraction"></a></p>

<h3>Vendor Extraction</h3>

<p>One potential downside to bundling all application-specific JavaScript with your vendor libraries is that it makes long-term caching more difficult. For example, a single update to your application code will force the browser to re-download all of your vendor libraries even if they haven&#39;t changed.</p>

<p>If you intend to make frequent updates to your application&#39;s JavaScript, you should consider extracting all of your vendor libraries into their own file. This way, a change to your application code will not affect the caching of your large <code>vendor.js</code> file. Mix&#39;s <code>extract</code> method makes this a breeze:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">extract</span><span class="p">([</span><span class="s1">&#39;vue&#39;</span><span class="p">])</span>
</pre></div>

<p>The <code>extract</code> method accepts an array of all libraries or modules that you wish to extract into a <code>vendor.js</code> file. Using the above snippet as an example, Mix will generate the following files:</p>

<div class="content-list" markdown="1">
- `public/js/manifest.js`: *The Webpack manifest runtime*
- `public/js/vendor.js`: *Your vendor libraries*
- `public/js/app.js`: *Your application code*
</div>

<p>To avoid JavaScript errors, be sure to load these files in the proper order:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/js/manifest.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/js/vendor.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/js/app.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p><a name="react"></a></p>

<h3>React</h3>

<p>Mix can automatically install the Babel plug-ins necessary for React support. To get started, replace your <code>mix.js()</code> call with <code>mix.react()</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">react</span><span class="p">(</span><span class="s1">&#39;resources/js/app.jsx&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">);</span>
</pre></div>

<p>Behind the scenes, Mix will download and include the appropriate <code>babel-preset-react</code> Babel plug-in.</p>

<p><a name="vanilla-js"></a></p>

<h3>Vanilla JS</h3>

<p>Similar to combining stylesheets with <code>mix.styles()</code>, you may also combine and minify any number of JavaScript files with the <code>scripts()</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">scripts</span><span class="p">([</span>
    <span class="s1">&#39;public/js/admin.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;public/js/dashboard.js&#39;</span>
<span class="p">],</span> <span class="s1">&#39;public/js/all.js&#39;</span><span class="p">);</span>
</pre></div>

<p>This option is particularly useful for legacy projects where you don&#39;t require Webpack compilation for your JavaScript.</p>

<blockquote>
<p>{tip} A slight variation of <code>mix.scripts()</code> is <code>mix.babel()</code>. Its method signature is identical to <code>scripts</code>; however, the concatenated file will receive Babel compilation, which translates any ES2015 code to vanilla JavaScript that all browsers will understand.</p>
</blockquote>

<p><a name="custom-webpack-configuration"></a></p>

<h3>Custom Webpack Configuration</h3>

<p>Behind the scenes, Laravel Mix references a pre-configured <code>webpack.config.js</code> file to get you up and running as quickly as possible. Occasionally, you may need to manually modify this file. You might have a special loader or plug-in that needs to be referenced, or maybe you prefer to use Stylus instead of Sass. In such instances, you have two choices:</p>

<h4>Merging Custom Configuration</h4>

<p>Mix provides a useful <code>webpackConfig</code> method that allows you to merge any short Webpack configuration overrides. This is a particularly appealing choice, as it doesn&#39;t require you to copy and maintain your own copy of the <code>webpack.config.js</code> file. The <code>webpackConfig</code> method accepts an object, which should contain any <a href="https://webpack.js.org/configuration/">Webpack-specific configuration</a> that you wish to apply.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">webpackConfig</span><span class="p">({</span>
    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;vendor/laravel/spark/resources/assets/js&#39;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h4>Custom Configuration Files</h4>

<p>If you would like to completely customize your Webpack configuration, copy the <code>node_modules/laravel-mix/setup/webpack.config.js</code> file to your project&#39;s root directory. Next, point all of the <code>--config</code> references in your <code>package.json</code> file to the newly copied configuration file. If you choose to take this approach to customization, any future upstream updates to Mix&#39;s <code>webpack.config.js</code> must be manually merged into your customized file.</p>

<p><a name="copying-files-and-directories"></a></p>

<h2>Copying Files &amp; Directories</h2>

<p>The <code>copy</code> method may be used to copy files and directories to new locations. This can be useful when a particular asset within your <code>node_modules</code> directory needs to be relocated to your <code>public</code> folder.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;node_modules/foo/bar.css&#39;</span><span class="p">,</span> <span class="s1">&#39;public/css/bar.css&#39;</span><span class="p">);</span>
</pre></div>

<p>When copying a directory, the <code>copy</code> method will flatten the directory&#39;s structure. To maintain the directory&#39;s original structure, you should use the <code>copyDirectory</code> method instead:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">copyDirectory</span><span class="p">(</span><span class="s1">&#39;resources/img&#39;</span><span class="p">,</span> <span class="s1">&#39;public/img&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="versioning-and-cache-busting"></a></p>

<h2>Versioning / Cache Busting</h2>

<p>Many developers suffix their compiled assets with a timestamp or unique token to force browsers to load the fresh assets instead of serving stale copies of the code. Mix can handle this for you using the <code>version</code> method.</p>

<p>The <code>version</code> method will automatically append a unique hash to the filenames of all compiled files, allowing for more convenient cache busting:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">version</span><span class="p">();</span>
</pre></div>

<p>After generating the versioned file, you won&#39;t know the exact file name. So, you should use Laravel&#39;s global <code>mix</code> function within your <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> to load the appropriately hashed asset. The <code>mix</code> function will automatically determine the current name of the hashed file:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;{{ mix(&#39;/js/app.js&#39;) }}&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div>

<p>Because versioned files are usually unnecessary in development, you may instruct the versioning process to only run during <code>npm run production</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="s1">&#39;resources/js/app.js&#39;</span><span class="p">,</span> <span class="s1">&#39;public/js&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">mix</span><span class="p">.</span><span class="nx">inProduction</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">mix</span><span class="p">.</span><span class="nx">version</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>Custom Mix Base URLs</h4>

<p>If your Mix compiled assets are deployed to a CDN separate from your application, you will need to change the base URL generated by the <code>mix</code> function. You may do so by adding a <code>mix_url</code> configuration option to your <code>config/app.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;mix_url&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;MIX_ASSET_URL&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
</pre></div>

<p>After configuring the Mix URL, The <code>mix</code> function will prefix the configured URL when generating URLs to assets:</p>
<div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//cdn.example.com/js/app.js?id=1964becbdd96414518cd</span>
</pre></div>

<p><a name="browsersync-reloading"></a></p>

<h2>Browsersync Reloading</h2>

<p><a href="https://browsersync.io/">BrowserSync</a> can automatically monitor your files for changes, and inject your changes into the browser without requiring a manual refresh. You may enable support by calling the <code>mix.browserSync()</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">browserSync</span><span class="p">(</span><span class="s1">&#39;my-domain.test&#39;</span><span class="p">);</span>

<span class="c1">// Or...</span>

<span class="c1">// https://browsersync.io/docs/options</span>
<span class="nx">mix</span><span class="p">.</span><span class="nx">browserSync</span><span class="p">({</span>
    <span class="nx">proxy</span><span class="o">:</span> <span class="s1">&#39;my-domain.test&#39;</span>
<span class="p">});</span>
</pre></div>

<p>You may pass either a string (proxy) or object (BrowserSync settings) to this method. Next, start Webpack&#39;s dev server using the <code>npm run watch</code> command. Now, when you modify a script or PHP file, watch as the browser instantly refreshes the page to reflect your changes.</p>

<p><a name="environment-variables"></a></p>

<h2>Environment Variables</h2>

<p>You may inject environment variables into Mix by prefixing a key in your <code>.env</code> file with <code>MIX_</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">MIX_SENTRY_DSN_PUBLIC</span><span class="o">=</span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com</span>
</pre></div>

<p>After the variable has been defined in your <code>.env</code> file, you may access it via the <code>process.env</code> object. If the value changes while you are running a <code>watch</code> task, you will need to restart the task:</p>
<div class="highlight"><pre><span></span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MIX_SENTRY_DSN_PUBLIC</span>
</pre></div>

<p><a name="notifications"></a></p>

<h2>Notifications</h2>

<p>When available, Mix will automatically display OS notifications for each bundle. This will give you instant feedback, as to whether the compilation was successful or not. However, there may be instances when you&#39;d prefer to disable these notifications. One such example might be triggering Mix on your production server. Notifications may be deactivated, via the <code>disableNotifications</code> method.</p>
<div class="highlight"><pre><span></span><span class="nx">mix</span><span class="p">.</span><span class="nx">disableNotifications</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Mocking</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#mocking-objects">Mocking Objects</a></li>
<li><a href="#bus-fake">Bus Fake</a></li>
<li><a href="#event-fake">Event Fake</a>

<ul>
<li><a href="#scoped-event-fakes">Scoped Event Fakes</a></li>
</ul></li>
<li><a href="#http-fake">HTTP Fake</a></li>
<li><a href="#mail-fake">Mail Fake</a></li>
<li><a href="#notification-fake">Notification Fake</a></li>
<li><a href="#queue-fake">Queue Fake</a></li>
<li><a href="#storage-fake">Storage Fake</a></li>
<li><a href="#interacting-with-time">Interacting With Time</a></li>
<li><a href="#mocking-facades">Facades</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>When testing Laravel applications, you may wish to &quot;mock&quot; certain aspects of your application so they are not actually executed during a given test. For example, when testing a controller that dispatches an event, you may wish to mock the event listeners so they are not actually executed during the test. This allows you to only test the controller&#39;s HTTP response without worrying about the execution of the event listeners, since the event listeners can be tested in their own test case.</p>

<p>Laravel provides helpers for mocking events, jobs, and facades out of the box. These helpers primarily provide a convenience layer over Mockery so you do not have to manually make complicated Mockery method calls. You can also use <a href="http://docs.mockery.io/en/latest/">Mockery</a> or PHPUnit to create your own mocks or spies.</p>

<p><a name="mocking-objects"></a></p>

<h2>Mocking Objects</h2>

<p>When mocking an object that is going to be injected into your application via Laravel&#39;s service container, you will need to bind your mocked instance into the container as an <code>instance</code> binding. This will instruct the container to use your mocked instance of the object instead of constructing the object itself:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Service</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Mockery</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">instance</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="nx">Mockery</span><span class="o">::</span><span class="nx">mock</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$mock</span><span class="o">-&gt;</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;process&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">once</span><span class="p">();</span>
<span class="p">}));</span>
</pre></div>

<p>In order to make this more convenient, you may use the <code>mock</code> method, which is provided by Laravel&#39;s base test case class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Service</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mock</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$mock</span><span class="o">-&gt;</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;process&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">once</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>You may use the <code>partialMock</code> method when you only need to mock a few methods of an object. The methods that are not mocked will be executed normally when called:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Service</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">partialMock</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$mock</span><span class="o">-&gt;</span><span class="nx">shouldReceive</span><span class="p">(</span><span class="s1">&#39;process&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">once</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Similarly, if you want to spy on an object, Laravel&#39;s base test case class offers a <code>spy</code> method as a convenient wrapper around the <code>Mockery::spy</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Service</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">spy</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$mock</span><span class="o">-&gt;</span><span class="nx">shouldHaveReceived</span><span class="p">(</span><span class="s1">&#39;process&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="bus-fake"></a></p>

<h2>Bus Fake</h2>

<p>As an alternative to mocking, you may use the <code>Bus</code> facade&#39;s <code>fake</code> method to prevent jobs from being dispatched. When using fakes, assertions are made after the code under test is executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Jobs\ShipOrder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Bus</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderShipping</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Bus</span><span class="o">::</span><span class="na">fake</span><span class="p">();</span>

        <span class="c1">// Perform order shipping...</span>

        <span class="c1">// Assert a specific type of job was dispatched meeting the given truth test...</span>
        <span class="nx">Bus</span><span class="o">::</span><span class="na">assertDispatched</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">ShipOrder</span> <span class="nv">$job</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">// Assert a job was not dispatched...</span>
        <span class="nx">Bus</span><span class="o">::</span><span class="na">assertNotDispatched</span><span class="p">(</span><span class="nx">AnotherJob</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="event-fake"></a></p>

<h2>Event Fake</h2>

<p>As an alternative to mocking, you may use the <code>Event</code> facade&#39;s <code>fake</code> method to prevent all event listeners from executing. You may then assert that events were dispatched and even inspect the data they received. When using fakes, assertions are made after the code under test is executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderFailedToShip</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Test order shipping.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderShipping</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">fake</span><span class="p">();</span>

        <span class="c1">// Perform order shipping...</span>

        <span class="c1">// Assert a specific type of event was dispatched meeting the given truth test...</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">assertDispatched</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$event</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">// Assert an event was dispatched twice...</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">assertDispatched</span><span class="p">(</span><span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

        <span class="c1">// Assert an event was not dispatched...</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">assertNotDispatched</span><span class="p">(</span><span class="nx">OrderFailedToShip</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} After calling <code>Event::fake()</code>, no event listeners will be executed. So, if your tests use model factories that rely on events, such as creating a UUID during a model&#39;s <code>creating</code> event, you should call <code>Event::fake()</code> <strong>after</strong> using your factories.</p>
</blockquote>

<h4>Faking A Subset Of Events</h4>

<p>If you only want to fake event listeners for a specific set of events, you may pass them to the <code>fake</code> or <code>fakeFor</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Test order process.</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testOrderProcess</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Event</span><span class="o">::</span><span class="nx">fake</span><span class="p">([</span>
        <span class="nx">OrderCreated</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="nx">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>

    <span class="nx">Event</span><span class="o">::</span><span class="nx">assertDispatched</span><span class="p">(</span><span class="nx">OrderCreated</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

    <span class="c1">// Other events are dispatched as normal...</span>
    <span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([...]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="scoped-event-fakes"></a></p>

<h3>Scoped Event Fakes</h3>

<p>If you only want to fake event listeners for a portion of your test, you may use the <code>fakeFor</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderCreated</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Test order process.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderProcess</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Event</span><span class="o">::</span><span class="na">fakeFor</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

            <span class="nx">Event</span><span class="o">::</span><span class="na">assertDispatched</span><span class="p">(</span><span class="nx">OrderCreated</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$order</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">// Events are dispatched as normal and observers will run ...</span>
        <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="o">...</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="http-fake"></a></p>

<h2>HTTP Fake</h2>

<p>The <code>Http</code> facade&#39;s <code>fake</code> method allows you to instruct the HTTP client to return stubbed / dummy responses when requests are made. For more information on faking outgoing HTTP requests, please consult the <a href="/docs/%7B%7Bversion%7D%7D/http-client#testing">HTTP Client testing documentation</a>.</p>

<p><a name="mail-fake"></a></p>

<h2>Mail Fake</h2>

<p>You may use the <code>Mail</code> facade&#39;s <code>fake</code> method to prevent mail from being sent. You may then assert that <a href="/docs/%7B%7Bversion%7D%7D/mail">mailables</a> were sent to users and even inspect the data they received. When using fakes, assertions are made after the code under test is executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Mail\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Mail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderShipping</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">fake</span><span class="p">();</span>

        <span class="c1">// Assert that no mailables were sent...</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">assertNothingSent</span><span class="p">();</span>

        <span class="c1">// Perform order shipping...</span>

        <span class="c1">// Assert a specific type of mailable was dispatched meeting the given truth test...</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">assertSent</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$mail</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$mail</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">// Assert a message was sent to the given users...</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">assertSent</span><span class="p">(</span><span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$mail</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$mail</span><span class="o">-&gt;</span><span class="na">hasTo</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                   <span class="nv">$mail</span><span class="o">-&gt;</span><span class="na">hasCc</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                   <span class="nv">$mail</span><span class="o">-&gt;</span><span class="na">hasBcc</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="c1">// Assert a mailable was sent twice...</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">assertSent</span><span class="p">(</span><span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

        <span class="c1">// Assert a mailable was not sent...</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">assertNotSent</span><span class="p">(</span><span class="nx">AnotherMailable</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you are queueing mailables for delivery in the background, you should use the <code>assertQueued</code> method instead of <code>assertSent</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Mail</span><span class="o">::</span><span class="nx">assertQueued</span><span class="p">(...);</span>
<span class="nx">Mail</span><span class="o">::</span><span class="nx">assertNotQueued</span><span class="p">(...);</span>
</pre></div>

<p><a name="notification-fake"></a></p>

<h2>Notification Fake</h2>

<p>You may use the <code>Notification</code> facade&#39;s <code>fake</code> method to prevent notifications from being sent. You may then assert that <a href="/docs/%7B%7Bversion%7D%7D/notifications">notifications</a> were sent to users and even inspect the data they received. When using fakes, assertions are made after the code under test is executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Notifications\OrderShipped</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\AnonymousNotifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Notification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderShipping</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">fake</span><span class="p">();</span>

        <span class="c1">// Assert that no notifications were sent...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertNothingSent</span><span class="p">();</span>

        <span class="c1">// Perform order shipping...</span>

        <span class="c1">// Assert a specific type of notification was sent meeting the given truth test...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertSentTo</span><span class="p">(</span>
            <span class="nv">$user</span><span class="p">,</span>
            <span class="k">function</span> <span class="p">(</span><span class="nx">OrderShipped</span> <span class="nv">$notification</span><span class="p">,</span> <span class="nv">$channels</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$notification</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">);</span>

        <span class="c1">// Assert a notification was sent to the given users...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertSentTo</span><span class="p">(</span>
            <span class="p">[</span><span class="nv">$user</span><span class="p">],</span> <span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span>
        <span class="p">);</span>

        <span class="c1">// Assert a notification was not sent...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertNotSentTo</span><span class="p">(</span>
            <span class="p">[</span><span class="nv">$user</span><span class="p">],</span> <span class="nx">AnotherNotification</span><span class="o">::</span><span class="na">class</span>
        <span class="p">);</span>

        <span class="c1">// Assert a notification was sent via Notification::route() method...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertSentTo</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">AnonymousNotifiable</span><span class="p">,</span> <span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span>
        <span class="p">);</span>

        <span class="c1">// Assert Notification::route() method sent notification to the correct user...</span>
        <span class="nx">Notification</span><span class="o">::</span><span class="na">assertSentTo</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">AnonymousNotifiable</span><span class="p">,</span>
            <span class="nx">OrderShipped</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="k">function</span> <span class="p">(</span><span class="nv">$notification</span><span class="p">,</span> <span class="nv">$channels</span><span class="p">,</span> <span class="nv">$notifiable</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="na">routes</span><span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="queue-fake"></a></p>

<h2>Queue Fake</h2>

<p>As an alternative to mocking, you may use the <code>Queue</code> facade&#39;s <code>fake</code> method to prevent jobs from being queued. You may then assert that jobs were pushed to the queue and even inspect the data they received. When using fakes, assertions are made after the code under test is executed:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Jobs\AnotherJob</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\FinalJob</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ShipOrder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOrderShipping</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">fake</span><span class="p">();</span>

        <span class="c1">// Assert that no jobs were pushed...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertNothingPushed</span><span class="p">();</span>

        <span class="c1">// Perform order shipping...</span>

        <span class="c1">// Assert a specific type of job was pushed meeting the given truth test...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushed</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">ShipOrder</span> <span class="nv">$job</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="c1">// Assert a job was pushed to a given queue...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushedOn</span><span class="p">(</span><span class="s1">&#39;queue-name&#39;</span><span class="p">,</span> <span class="nx">ShipOrder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Assert a job was pushed twice...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushed</span><span class="p">(</span><span class="nx">ShipOrder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

        <span class="c1">// Assert a job was not pushed...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertNotPushed</span><span class="p">(</span><span class="nx">AnotherJob</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Assert a job was pushed with a given chain of jobs, matching by class...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushedWithChain</span><span class="p">(</span><span class="nx">ShipOrder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
            <span class="nx">AnotherJob</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">FinalJob</span><span class="o">::</span><span class="na">class</span>
        <span class="p">]);</span>

        <span class="c1">// Assert a job was pushed with a given chain of jobs, matching by both class and properties...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushedWithChain</span><span class="p">(</span><span class="nx">ShipOrder</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">AnotherJob</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span>
            <span class="k">new</span> <span class="nx">FinalJob</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">),</span>
        <span class="p">]);</span>

        <span class="c1">// Assert a job was pushed without a chain of jobs...</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">assertPushedWithoutChain</span><span class="p">(</span><span class="nx">ShipOrder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="storage-fake"></a></p>

<h2>Storage Fake</h2>

<p>The <code>Storage</code> facade&#39;s <code>fake</code> method allows you to easily generate a fake disk that, combined with the file generation utilities of the <code>UploadedFile</code> class, greatly simplifies the testing of file uploads. For example:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAlbumUpload</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">fake</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/photos&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="nx">UploadedFile</span><span class="o">::</span><span class="na">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">image</span><span class="p">(</span><span class="s1">&#39;photo1.jpg&#39;</span><span class="p">),</span>
            <span class="nx">UploadedFile</span><span class="o">::</span><span class="na">fake</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">image</span><span class="p">(</span><span class="s1">&#39;photo2.jpg&#39;</span><span class="p">)</span>
        <span class="p">]);</span>

        <span class="c1">// Assert one or more files were stored...</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertExists</span><span class="p">(</span><span class="s1">&#39;photo1.jpg&#39;</span><span class="p">);</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertExists</span><span class="p">([</span><span class="s1">&#39;photo1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;photo2.jpg&#39;</span><span class="p">]);</span>

        <span class="c1">// Assert one or more files were not stored...</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertMissing</span><span class="p">(</span><span class="s1">&#39;missing.jpg&#39;</span><span class="p">);</span>
        <span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">assertMissing</span><span class="p">([</span><span class="s1">&#39;missing.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;non-existing.jpg&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} By default, the <code>fake</code> method will delete all files in its temporary directory. If you would like to keep these files, you may use the &quot;persistentFake&quot; method instead.</p>
</blockquote>

<p><a name="interacting-with-time"></a></p>

<h2>Interacting With Time</h2>

<p>When testing, you may occasionally need to modify the time returned by helpers such as <code>now</code> or <code>Illuminate\Support\Carbon::now()</code>. Thankfully, Laravel&#39;s base feature test class includes helpers that allow you to manipulate the current time:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">testTimeCanBeManipulated</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Travel into the future...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">milliseconds</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">seconds</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">minutes</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">hours</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">days</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">weeks</span><span class="p">();</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">years</span><span class="p">();</span>

    <span class="c1">// Travel into the past...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travel</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">hours</span><span class="p">();</span>

    <span class="c1">// Travel to an explicit time...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travelTo</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">subHours</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>

    <span class="c1">// Return back to the present time...</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">travelBack</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="mocking-facades"></a></p>

<h2>Facades</h2>

<p>Unlike traditional static method calls, <a href="/docs/%7B%7Bversion%7D%7D/facades">facades</a> may be mocked. This provides a great advantage over traditional static methods and grants you the same testability you would have if you were using dependency injection. When testing, you may often want to mock a call to a Laravel facade in one of your controllers. For example, consider the following controller action:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all users of the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>We can mock the call to the <code>Cache</code> facade by using the <code>shouldReceive</code> method, which will return an instance of a <a href="https://github.com/padraic/mockery">Mockery</a> mock. Since facades are actually resolved and managed by the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, they have much more testability than a typical static class. For example, let&#39;s mock our call to the <code>Cache</code> facade&#39;s <code>get</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\WithoutMiddleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserControllerTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Cache</span><span class="o">::</span><span class="na">shouldReceive</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">once</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="na">andReturn</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">);</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} You should not mock the <code>Request</code> facade. Instead, pass the input you desire into the HTTP helper methods such as <code>get</code> and <code>post</code> when running your test. Likewise, instead of mocking the <code>Config</code> facade, call the <code>Config::set</code> method in your tests.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Notifications</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#creating-notifications">Creating Notifications</a></li>
<li><a href="#sending-notifications">Sending Notifications</a>

<ul>
<li><a href="#using-the-notifiable-trait">Using The Notifiable Trait</a></li>
<li><a href="#using-the-notification-facade">Using The Notification Facade</a></li>
<li><a href="#specifying-delivery-channels">Specifying Delivery Channels</a></li>
<li><a href="#queueing-notifications">Queueing Notifications</a></li>
<li><a href="#on-demand-notifications">On-Demand Notifications</a></li>
</ul></li>
<li><a href="#mail-notifications">Mail Notifications</a>

<ul>
<li><a href="#formatting-mail-messages">Formatting Mail Messages</a></li>
<li><a href="#customizing-the-sender">Customizing The Sender</a></li>
<li><a href="#customizing-the-recipient">Customizing The Recipient</a></li>
<li><a href="#customizing-the-subject">Customizing The Subject</a></li>
<li><a href="#customizing-the-mailer">Customizing The Mailer</a></li>
<li><a href="#customizing-the-templates">Customizing The Templates</a></li>
<li><a href="#previewing-mail-notifications">Previewing Mail Notifications</a></li>
</ul></li>
<li><a href="#markdown-mail-notifications">Markdown Mail Notifications</a>

<ul>
<li><a href="#generating-the-message">Generating The Message</a></li>
<li><a href="#writing-the-message">Writing The Message</a></li>
<li><a href="#customizing-the-components">Customizing The Components</a></li>
</ul></li>
<li><a href="#database-notifications">Database Notifications</a>

<ul>
<li><a href="#database-prerequisites">Prerequisites</a></li>
<li><a href="#formatting-database-notifications">Formatting Database Notifications</a></li>
<li><a href="#accessing-the-notifications">Accessing The Notifications</a></li>
<li><a href="#marking-notifications-as-read">Marking Notifications As Read</a></li>
</ul></li>
<li><a href="#broadcast-notifications">Broadcast Notifications</a>

<ul>
<li><a href="#broadcast-prerequisites">Prerequisites</a></li>
<li><a href="#formatting-broadcast-notifications">Formatting Broadcast Notifications</a></li>
<li><a href="#listening-for-notifications">Listening For Notifications</a></li>
</ul></li>
<li><a href="#sms-notifications">SMS Notifications</a>

<ul>
<li><a href="#sms-prerequisites">Prerequisites</a></li>
<li><a href="#formatting-sms-notifications">Formatting SMS Notifications</a></li>
<li><a href="#formatting-shortcode-notifications">Formatting Shortcode Notifications</a></li>
<li><a href="#customizing-the-from-number">Customizing The &quot;From&quot; Number</a></li>
<li><a href="#routing-sms-notifications">Routing SMS Notifications</a></li>
</ul></li>
<li><a href="#slack-notifications">Slack Notifications</a>

<ul>
<li><a href="#slack-prerequisites">Prerequisites</a></li>
<li><a href="#formatting-slack-notifications">Formatting Slack Notifications</a></li>
<li><a href="#slack-attachments">Slack Attachments</a></li>
<li><a href="#routing-slack-notifications">Routing Slack Notifications</a></li>
</ul></li>
<li><a href="#localizing-notifications">Localizing Notifications</a></li>
<li><a href="#notification-events">Notification Events</a></li>
<li><a href="#custom-channels">Custom Channels</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to support for <a href="/docs/%7B%7Bversion%7D%7D/mail">sending email</a>, Laravel provides support for sending notifications across a variety of delivery channels, including mail, SMS (via <a href="https://www.vonage.com/communications-apis/">Vonage</a>, formerly known as Nexmo), and <a href="https://slack.com">Slack</a>. Notifications may also be stored in a database so they may be displayed in your web interface.</p>

<p>Typically, notifications should be short, informational messages that notify users of something that occurred in your application. For example, if you are writing a billing application, you might send an &quot;Invoice Paid&quot; notification to your users via the email and SMS channels.</p>

<p><a name="creating-notifications"></a></p>

<h2>Creating Notifications</h2>

<p>In Laravel, each notification is represented by a single class (typically stored in the <code>app/Notifications</code> directory). Don&#39;t worry if you don&#39;t see this directory in your application, it will be created for you when you run the <code>make:notification</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">notification</span> <span class="nx">InvoicePaid</span>
</pre></div>

<p>This command will place a fresh notification class in your <code>app/Notifications</code> directory. Each notification class contains a <code>via</code> method and a variable number of message building methods (such as <code>toMail</code> or <code>toDatabase</code>) that convert the notification to a message optimized for that particular channel.</p>

<p><a name="sending-notifications"></a></p>

<h2>Sending Notifications</h2>

<p><a name="using-the-notifiable-trait"></a></p>

<h3>Using The Notifiable Trait</h3>

<p>Notifications may be sent in two ways: using the <code>notify</code> method of the <code>Notifiable</code> trait or using the <code>Notification</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. First, let&#39;s explore using the trait:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This trait is utilized by the default <code>App\Models\User</code> model and contains one method that may be used to send notifications: <code>notify</code>. The <code>notify</code> method expects to receive a notification instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">InvoicePaid</span><span class="p">;</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<blockquote>
<p>{tip} Remember, you may use the <code>Illuminate\Notifications\Notifiable</code> trait on any of your models. You are not limited to only including it on your <code>User</code> model.</p>
</blockquote>

<p><a name="using-the-notification-facade"></a></p>

<h3>Using The Notification Facade</h3>

<p>Alternatively, you may send notifications via the <code>Notification</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. This is useful primarily when you need to send a notification to multiple notifiable entities such as a collection of users. To send notifications using the facade, pass all of the notifiable entities and the notification instance to the <code>send</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Notification</span><span class="o">::</span><span class="nx">send</span><span class="p">(</span><span class="nx">$users</span><span class="p">,</span> <span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<p><a name="specifying-delivery-channels"></a></p>

<h3>Specifying Delivery Channels</h3>

<p>Every notification class has a <code>via</code> method that determines on which channels the notification will be delivered. Notifications may be sent on the <code>mail</code>, <code>database</code>, <code>broadcast</code>, <code>nexmo</code>, and <code>slack</code> channels.</p>

<blockquote>
<p>{tip} If you would like to use other delivery channels such as Telegram or Pusher, check out the community driven <a href="http://laravel-notification-channels.com">Laravel Notification Channels website</a>.</p>
</blockquote>

<p>The <code>via</code> method receives a <code>$notifiable</code> instance, which will be an instance of the class to which the notification is being sent. You may use <code>$notifiable</code> to determine which channels the notification should be delivered on:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the notification&#39;s delivery channels.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">via</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$notifiable</span><span class="o">-&gt;</span><span class="nx">prefers_sms</span> <span class="o">?</span> <span class="p">[</span><span class="s1">&#39;nexmo&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="queueing-notifications"></a></p>

<h3>Queueing Notifications</h3>

<blockquote>
<p>{note} Before queueing notifications you should configure your queue and <a href="/docs/%7B%7Bversion%7D%7D/queues">start a worker</a>.</p>
</blockquote>

<p>Sending notifications can take time, especially if the channel needs an external API call to deliver the notification. To speed up your application&#39;s response time, let your notification be queued by adding the <code>ShouldQueue</code> interface and <code>Queueable</code> trait to your class. The interface and trait are already imported for all notifications generated using <code>make:notification</code>, so you may immediately add them to your notification class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InvoicePaid</span> <span class="k">extends</span> <span class="nx">Notification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Queueable</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Once the <code>ShouldQueue</code> interface has been added to your notification, you may send the notification like normal. Laravel will detect the <code>ShouldQueue</code> interface on the class and automatically queue the delivery of the notification:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<p>If you would like to delay the delivery of the notification, you may chain the <code>delay</code> method onto your notification instantiation:</p>
<div class="highlight"><pre><span></span><span class="nx">$when</span> <span class="o">=</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">((</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">delay</span><span class="p">(</span><span class="nx">$when</span><span class="p">));</span>
</pre></div>

<h4>Customizing Notification Channel Queues</h4>

<p>If you would like to specify a specific queue that should be used for each notification channel supported by the notification, you may define a <code>viaQueues</code> method on your notification. This method should return an array of channel name / queue name pairs:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine which queues should be used for each notification channel.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">viaQueues</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;mail&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mail-queue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;slack&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;slack-queue&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="on-demand-notifications"></a></p>

<h3>On-Demand Notifications</h3>

<p>Sometimes you may need to send a notification to someone who is not stored as a &quot;user&quot; of your application. Using the <code>Notification::route</code> facade method, you may specify ad-hoc notification routing information before sending the notification:</p>
<div class="highlight"><pre><span></span><span class="nx">Notification</span><span class="o">::</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;nexmo&#39;</span><span class="p">,</span> <span class="s1">&#39;5555555555&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;slack&#39;</span><span class="p">,</span> <span class="s1">&#39;https://hooks.slack.com/services/...&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<p><a name="mail-notifications"></a></p>

<h2>Mail Notifications</h2>

<p><a name="formatting-mail-messages"></a></p>

<h3>Formatting Mail Messages</h3>

<p>If a notification supports being sent as an email, you should define a <code>toMail</code> method on the notification class. This method will receive a <code>$notifiable</code> entity and should return a <code>Illuminate\Notifications\Messages\MailMessage</code> instance. Mail messages may contain lines of text as well as a &quot;call to action&quot;. Let&#39;s take a look at an example <code>toMail</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/invoice/&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">greeting</span><span class="p">(</span><span class="s1">&#39;Hello!&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;One of your invoices has been paid!&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;View Invoice&#39;</span><span class="p">,</span> <span class="nx">$url</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;Thank you for using our application!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Note we are using <code>$this-&gt;invoice-&gt;id</code> in our <code>toMail</code> method. You may pass any data your notification needs to generate its message into the notification&#39;s constructor.</p>
</blockquote>

<p>In this example, we register a greeting, a line of text, a call to action, and then another line of text. These methods provided by the <code>MailMessage</code> object make it simple and fast to format small transactional emails. The mail channel will then translate the message components into a nice, responsive HTML email template with a plain-text counterpart. Here is an example of an email generated by the <code>mail</code> channel:</p>

<p><img src="https://laravel.com/img/docs/notification-example.png" width="551" height="596"></p>

<blockquote>
<p>{tip} When sending mail notifications, be sure to set the <code>name</code> value in your <code>config/app.php</code> configuration file. This value will be used in the header and footer of your mail notification messages.</p>
</blockquote>

<h4>Other Notification Formatting Options</h4>

<p>Instead of defining the &quot;lines&quot; of text in the notification class, you may use the <code>view</code> method to specify a custom template that should be used to render the notification email:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span>
        <span class="s1">&#39;emails.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>You may specify a plain-text view for the mail message by passing the view name as the second element of an array that is given to the <code>view</code> method of the <code>MailMessage</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;emails.name.html&#39;</span><span class="p">,</span> <span class="s1">&#39;emails.name.plain&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>In addition, you may return a full <a href="/docs/%7B%7Bversion%7D%7D/mail">mailable object</a> from the <code>toMail</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Mail</span><span class="err">\</span><span class="nx">InvoicePaid</span> <span class="nx">as</span> <span class="nx">Mailable</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return Mailable</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Mailable</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="nx">$notifiable</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="error-messages"></a></p>

<h4>Error Messages</h4>

<p>Some notifications inform users of errors, such as a failed invoice payment. You may indicate that a mail message is regarding an error by calling the <code>error</code> method when building your message. When using the <code>error</code> method on a mail message, the call to action button will be red instead of blue:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Message</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">error</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Notification Subject&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-sender"></a></p>

<h3>Customizing The Sender</h3>

<p>By default, the email&#39;s sender / from address is defined in the <code>config/mail.php</code> configuration file. However, you may specify the from address for a specific notification using the <code>from</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;test@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-recipient"></a></p>

<h3>Customizing The Recipient</h3>

<p>When sending notifications via the <code>mail</code> channel, the notification system will automatically look for an <code>email</code> property on your notifiable entity. You may customize which email address is used to deliver the notification by defining a <code>routeNotificationForMail</code> method on the entity:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Route notifications for the mail channel.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Notifications\Notification  $notification</span>
<span class="sd">     * @return array|string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">routeNotificationForMail</span><span class="p">(</span><span class="nv">$notification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Return email address only...</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email_address</span><span class="p">;</span>

        <span class="c1">// Return name and email address...</span>
        <span class="k">return</span> <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email_address</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-subject"></a></p>

<h3>Customizing The Subject</h3>

<p>By default, the email&#39;s subject is the class name of the notification formatted to &quot;title case&quot;. So, if your notification class is named <code>InvoicePaid</code>, the email&#39;s subject will be <code>Invoice Paid</code>. If you would like to specify an explicit subject for the message, you may call the <code>subject</code> method when building your message:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Notification Subject&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-mailer"></a></p>

<h3>Customizing The Mailer</h3>

<p>By default, the email notification will be sent using the default driver defined in the <code>config/mail.php</code> configuration file. However, you may specify a different mailer at runtime by calling the <code>mailer</code> method when building your message:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">mailer</span><span class="p">(</span><span class="s1">&#39;postmark&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">line</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-templates"></a></p>

<h3>Customizing The Templates</h3>

<p>You can modify the HTML and plain-text template used by mail notifications by publishing the notification package&#39;s resources. After running this command, the mail notification templates will be located in the <code>resources/views/vendor/notifications</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">notifications</span>
</pre></div>

<p><a name="previewing-mail-notifications"></a></p>

<h3>Previewing Mail Notifications</h3>

<p>When designing a mail notification template, it is convenient to quickly preview the rendered mail message in your browser like a typical Blade template. For this reason, Laravel allows you to return any mail message generated by a mail notification directly from a route Closure or controller. When a <code>MailMessage</code> is returned, it will be rendered and displayed in the browser, allowing you to quickly preview its design without needing to send it to an actual email address:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$invoice</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Invoice</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">toMail</span><span class="p">(</span><span class="nx">$invoice</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="markdown-mail-notifications"></a></p>

<h2>Markdown Mail Notifications</h2>

<p>Markdown mail notifications allow you to take advantage of the pre-built templates of mail notifications, while giving you more freedom to write longer, customized messages. Since the messages are written in Markdown, Laravel is able to render beautiful, responsive HTML templates for the messages while also automatically generating a plain-text counterpart.</p>

<p><a name="generating-the-message"></a></p>

<h3>Generating The Message</h3>

<p>To generate a notification with a corresponding Markdown template, you may use the <code>--markdown</code> option of the <code>make:notification</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">notification</span> <span class="nx">InvoicePaid</span> <span class="o">--</span><span class="nx">markdown</span><span class="o">=</span><span class="nx">mail</span><span class="p">.</span><span class="nx">invoice</span><span class="p">.</span><span class="nx">paid</span>
</pre></div>

<p>Like all other mail notifications, notifications that use Markdown templates should define a <code>toMail</code> method on their notification class. However, instead of using the <code>line</code> and <code>action</code> methods to construct the notification, use the <code>markdown</code> method to specify the name of the Markdown template that should be used:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/invoice/&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Invoice Paid&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">markdown</span><span class="p">(</span><span class="s1">&#39;mail.invoice.paid&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="writing-the-message"></a></p>

<h3>Writing The Message</h3>

<p>Markdown mail notifications use a combination of Blade components and Markdown syntax which allow you to easily construct notifications while leveraging Laravel&#39;s pre-crafted notification components:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::message&#39;</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">Invoice</span> <span class="nx">Paid</span>

<span class="nx">Your</span> <span class="nx">invoice</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">paid</span><span class="o">!</span>

<span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::button&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">])</span>
<span class="nx">View</span> <span class="nx">Invoice</span>
<span class="err">@</span><span class="nx">endcomponent</span>

<span class="nx">Thanks</span><span class="p">,</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="p">{{</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.name&#39;</span><span class="p">)</span> <span class="p">}}</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<h4>Button Component</h4>

<p>The button component renders a centered button link. The component accepts two arguments, a <code>url</code> and an optional <code>color</code>. Supported colors are <code>blue</code>, <code>green</code>, and <code>red</code>. You may add as many button components to a notification as you wish:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::button&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;green&#39;</span><span class="p">])</span>
<span class="nx">View</span> <span class="nx">Invoice</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<h4>Panel Component</h4>

<p>The panel component renders the given block of text in a panel that has a slightly different background color than the rest of the notification. This allows you to draw attention to a given block of text:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::panel&#39;</span><span class="p">)</span>
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">panel</span> <span class="nx">content</span><span class="p">.</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<h4>Table Component</h4>

<p>The table component allows you to transform a Markdown table into an HTML table. The component accepts the Markdown table as its content. Table column alignment is supported using the default Markdown table alignment syntax:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;mail::table&#39;</span><span class="p">)</span>
<span class="o">|</span> <span class="nx">Laravel</span>       <span class="o">|</span> <span class="nx">Table</span>         <span class="o">|</span> <span class="nx">Example</span>  <span class="o">|</span>
<span class="o">|</span> <span class="o">-------------</span> <span class="o">|:-------------:|</span> <span class="o">--------:|</span>
<span class="o">|</span> <span class="nx">Col</span> <span class="mi">2</span> <span class="nx">is</span>      <span class="o">|</span> <span class="nx">Centered</span>      <span class="o">|</span> <span class="nx">$10</span>      <span class="o">|</span>
<span class="o">|</span> <span class="nx">Col</span> <span class="mi">3</span> <span class="nx">is</span>      <span class="o">|</span> <span class="nx">Right</span><span class="o">-</span><span class="nx">Aligned</span> <span class="o">|</span> <span class="nx">$20</span>      <span class="o">|</span>
<span class="err">@</span><span class="nx">endcomponent</span>
</pre></div>

<p><a name="customizing-the-components"></a></p>

<h3>Customizing The Components</h3>

<p>You may export all of the Markdown notification components to your own application for customization. To export the components, use the <code>vendor:publish</code> Artisan command to publish the <code>laravel-mail</code> asset tag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">mail</span>
</pre></div>

<p>This command will publish the Markdown mail components to the <code>resources/views/vendor/mail</code> directory. The <code>mail</code> directory will contain an <code>html</code> and a <code>text</code> directory, each containing their respective representations of every available component. You are free to customize these components however you like.</p>

<h4>Customizing The CSS</h4>

<p>After exporting the components, the <code>resources/views/vendor/mail/html/themes</code> directory will contain a <code>default.css</code> file. You may customize the CSS in this file and your styles will automatically be in-lined within the HTML representations of your Markdown notifications.</p>

<p>If you would like to build an entirely new theme for Laravel&#39;s Markdown components, you may place a CSS file within the <code>html/themes</code> directory. After naming and saving your CSS file, update the <code>theme</code> option of the <code>mail</code> configuration file to match the name of your new theme.</p>

<p>To customize the theme for an individual notification, you may call the <code>theme</code> method while building the notification&#39;s mail message. The <code>theme</code> method accepts the name of the theme that should be used when sending the notification:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the mail representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return \Illuminate\Notifications\Messages\MailMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toMail</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">theme</span><span class="p">(</span><span class="s1">&#39;invoice&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">subject</span><span class="p">(</span><span class="s1">&#39;Invoice Paid&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">markdown</span><span class="p">(</span><span class="s1">&#39;mail.invoice.paid&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="nx">$url</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="database-notifications"></a></p>

<h2>Database Notifications</h2>

<p><a name="database-prerequisites"></a></p>

<h3>Prerequisites</h3>

<p>The <code>database</code> notification channel stores the notification information in a database table. This table will contain information such as the notification type as well as custom JSON data that describes the notification.</p>

<p>You can query the table to display the notifications in your application&#39;s user interface. But, before you can do that, you will need to create a database table to hold your notifications. You may use the <code>notifications:table</code> command to generate a migration with the proper table schema:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">notifications</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="formatting-database-notifications"></a></p>

<h3>Formatting Database Notifications</h3>

<p>If a notification supports being stored in a database table, you should define a <code>toDatabase</code> or <code>toArray</code> method on the notification class. This method will receive a <code>$notifiable</code> entity and should return a plain PHP array. The returned array will be encoded as JSON and stored in the <code>data</code> column of your <code>notifications</code> table. Let&#39;s take a look at an example <code>toArray</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the array representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;invoice_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">amount</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<h4><code>toDatabase</code> Vs. <code>toArray</code></h4>

<p>The <code>toArray</code> method is also used by the <code>broadcast</code> channel to determine which data to broadcast to your JavaScript client. If you would like to have two different array representations for the <code>database</code> and <code>broadcast</code> channels, you should define a <code>toDatabase</code> method instead of a <code>toArray</code> method.</p>

<p><a name="accessing-the-notifications"></a></p>

<h3>Accessing The Notifications</h3>

<p>Once notifications are stored in the database, you need a convenient way to access them from your notifiable entities. The <code>Illuminate\Notifications\Notifiable</code> trait, which is included on Laravel&#39;s default <code>App\Models\User</code> model, includes a <code>notifications</code> Eloquent relationship that returns the notifications for the entity. To fetch notifications, you may access this method like any other Eloquent relationship. By default, notifications will be sorted by the <code>created_at</code> timestamp:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notifications</span> <span class="nx">as</span> <span class="nx">$notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$notification</span><span class="o">-&gt;</span><span class="nx">type</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you want to retrieve only the &quot;unread&quot; notifications, you may use the <code>unreadNotifications</code> relationship. Again, these notifications will be sorted by the <code>created_at</code> timestamp:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">unreadNotifications</span> <span class="nx">as</span> <span class="nx">$notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$notification</span><span class="o">-&gt;</span><span class="nx">type</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} To access your notifications from your JavaScript client, you should define a notification controller for your application which returns the notifications for a notifiable entity, such as the current user. You may then make an HTTP request to that controller&#39;s URI from your JavaScript client.</p>
</blockquote>

<p><a name="marking-notifications-as-read"></a></p>

<h3>Marking Notifications As Read</h3>

<p>Typically, you will want to mark a notification as &quot;read&quot; when a user views it. The <code>Illuminate\Notifications\Notifiable</code> trait provides a <code>markAsRead</code> method, which updates the <code>read_at</code> column on the notification&#39;s database record:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">unreadNotifications</span> <span class="nx">as</span> <span class="nx">$notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$notification</span><span class="o">-&gt;</span><span class="nx">markAsRead</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>However, instead of looping through each notification, you may use the <code>markAsRead</code> method directly on a collection of notifications:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">unreadNotifications</span><span class="o">-&gt;</span><span class="nx">markAsRead</span><span class="p">();</span>
</pre></div>

<p>You may also use a mass-update query to mark all of the notifications as read without retrieving them from the database:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">unreadNotifications</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;read_at&#39;</span> <span class="p">=&gt;</span> <span class="nx">now</span><span class="p">()]);</span>
</pre></div>

<p>You may <code>delete</code> the notifications to remove them from the table entirely:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notifications</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p><a name="broadcast-notifications"></a></p>

<h2>Broadcast Notifications</h2>

<p><a name="broadcast-prerequisites"></a></p>

<h3>Prerequisites</h3>

<p>Before broadcasting notifications, you should configure and be familiar with Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">event broadcasting</a> services. Event broadcasting provides a way to react to server-side fired Laravel events from your JavaScript client.</p>

<p><a name="formatting-broadcast-notifications"></a></p>

<h3>Formatting Broadcast Notifications</h3>

<p>The <code>broadcast</code> channel broadcasts notifications using Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">event broadcasting</a> services, allowing your JavaScript client to catch notifications in realtime. If a notification supports broadcasting, you can define a <code>toBroadcast</code> method on the notification class. This method will receive a <code>$notifiable</code> entity and should return a <code>BroadcastMessage</code> instance. If the <code>toBroadcast</code> method does not exist, the <code>toArray</code> method will be used to gather the data that should be broadcast. The returned data will be encoded as JSON and broadcast to your JavaScript client. Let&#39;s take a look at an example <code>toBroadcast</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">Messages</span><span class="err">\</span><span class="nx">BroadcastMessage</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the broadcastable representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return BroadcastMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toBroadcast</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">BroadcastMessage</span><span class="p">([</span>
        <span class="s1">&#39;invoice_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span> <span class="p">=&gt;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">amount</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<h4>Broadcast Queue Configuration</h4>

<p>All broadcast notifications are queued for broadcasting. If you would like to configure the queue connection or queue name that is used to queue the broadcast operation, you may use the <code>onConnection</code> and <code>onQueue</code> methods of the <code>BroadcastMessage</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">BroadcastMessage</span><span class="p">(</span><span class="nx">$data</span><span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">onConnection</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;broadcasts&#39;</span><span class="p">);</span>
</pre></div>

<h4>Customizing The Notification Type</h4>

<p>In addition to the data you specify, all broadcast notifications also have a <code>type</code> field containing the full class name of the notification. If you would like to customize the notification <code>type</code> that is provided to your JavaScript client, you may define a <code>broadcastType</code> method on the notification class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Notifications</span><span class="err">\</span><span class="nx">Messages</span><span class="err">\</span><span class="nx">BroadcastMessage</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the type of the notification being broadcast.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broadcastType</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;broadcast.message&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="listening-for-notifications"></a></p>

<h3>Listening For Notifications</h3>

<p>Notifications will broadcast on a private channel formatted using a <code>{notifiable}.{id}</code> convention. So, if you are sending a notification to a <code>App\Models\User</code> instance with an ID of <code>1</code>, the notification will be broadcast on the <code>App.User.1</code> private channel. When using <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">Laravel Echo</a>, you may easily listen for notifications on a channel using the <code>notification</code> helper method:</p>
<div class="highlight"><pre><span></span><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="s1">&#39;App.User.&#39;</span> <span class="o">+</span> <span class="nx">userId</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">notification</span><span class="p">((</span><span class="nx">notification</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4>Customizing The Notification Channel</h4>

<p>If you would like to customize which channels a notifiable entity receives its broadcast notifications on, you may define a <code>receivesBroadcastNotificationsOn</code> method on the notifiable entity:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The channels the user receives notification broadcasts on.</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">receivesBroadcastNotificationsOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;users.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="sms-notifications"></a></p>

<h2>SMS Notifications</h2>

<p><a name="sms-prerequisites"></a></p>

<h3>Prerequisites</h3>

<p>Sending SMS notifications in Laravel is powered by <a href="https://www.nexmo.com/">Nexmo</a>. Before you can send notifications via Nexmo, you need to install the <code>laravel/nexmo-notification-channel</code> Composer package:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">nexmo</span><span class="o">-</span><span class="nx">notification</span><span class="o">-</span><span class="nx">channel</span>
</pre></div>

<p>This will also install the <a href="https://github.com/Nexmo/nexmo-laravel"><code>nexmo/laravel</code></a> package. This package includes <a href="https://github.com/Nexmo/nexmo-laravel/blob/master/config/nexmo.php">its own configuration file</a>. You can use the <code>NEXMO_KEY</code> and <code>NEXMO_SECRET</code> environment variables to set your Nexmo public and secret key.</p>

<p>Next, you will need to add a configuration option to your <code>config/services.php</code> configuration file. You may copy the example configuration below to get started:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;nexmo&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;sms_from&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;15556666666&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>The <code>sms_from</code> option is the phone number that your SMS messages will be sent from. You should generate a phone number for your application in the Nexmo control panel.</p>

<p><a name="formatting-sms-notifications"></a></p>

<h3>Formatting SMS Notifications</h3>

<p>If a notification supports being sent as an SMS, you should define a <code>toNexmo</code> method on the notification class. This method will receive a <code>$notifiable</code> entity and should return a <code>Illuminate\Notifications\Messages\NexmoMessage</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Nexmo / SMS representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return NexmoMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toNexmo</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">NexmoMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;Your SMS message content&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="formatting-shortcode-notifications"></a></p>

<h3>Formatting Shortcode Notifications</h3>

<p>Laravel also supports sending shortcode notifications, which are pre-defined message templates in your Nexmo account. You may specify the type of notification (<code>alert</code>, <code>2fa</code>, or <code>marketing</code>), as well as the custom values that will populate the template:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Nexmo / Shortcode representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toShortcode</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;alert&#39;</span><span class="p">,</span>
        <span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;code&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;ABC123&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Like <a href="#routing-sms-notifications">routing SMS Notifications</a>, you should implement the <code>routeNotificationForShortcode</code> method on your notifiable model.</p>
</blockquote>

<h4>Unicode Content</h4>

<p>If your SMS message will contain unicode characters, you should call the <code>unicode</code> method when constructing the <code>NexmoMessage</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Nexmo / SMS representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return NexmoMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toNexmo</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">NexmoMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;Your unicode message&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">unicode</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-from-number"></a></p>

<h3>Customizing The &quot;From&quot; Number</h3>

<p>If you would like to send some notifications from a phone number that is different from the phone number specified in your <code>config/services.php</code> file, you may use the <code>from</code> method on a <code>NexmoMessage</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Nexmo / SMS representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return NexmoMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toNexmo</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">NexmoMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;Your SMS message content&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;15554443333&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="routing-sms-notifications"></a></p>

<h3>Routing SMS Notifications</h3>

<p>To route Nexmo notifications to the proper phone number, define a <code>routeNotificationForNexmo</code> method on your notifiable entity:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Route notifications for the Nexmo channel.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Notifications\Notification  $notification</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">routeNotificationForNexmo</span><span class="p">(</span><span class="nv">$notification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">phone_number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="slack-notifications"></a></p>

<h2>Slack Notifications</h2>

<p><a name="slack-prerequisites"></a></p>

<h3>Prerequisites</h3>

<p>Before you can send notifications via Slack, you must install the notification channel via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">slack</span><span class="o">-</span><span class="nx">notification</span><span class="o">-</span><span class="nx">channel</span>
</pre></div>

<p>You will also need to configure an <a href="https://slack.com/apps/A0F7XDUAZ-incoming-webhooks">&quot;Incoming Webhook&quot;</a> integration for your Slack team. This integration will provide you with a URL you may use when <a href="#routing-slack-notifications">routing Slack notifications</a>.</p>

<p><a name="formatting-slack-notifications"></a></p>

<h3>Formatting Slack Notifications</h3>

<p>If a notification supports being sent as a Slack message, you should define a <code>toSlack</code> method on the notification class. This method will receive a <code>$notifiable</code> entity and should return a <code>Illuminate\Notifications\Messages\SlackMessage</code> instance. Slack messages may contain text content as well as an &quot;attachment&quot; that formats additional text or an array of fields. Let&#39;s take a look at a basic <code>toSlack</code> example:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;One of your invoices has been paid!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>In this example we are just sending a single line of text to Slack, which will create a message that looks like the following:</p>

<p><img src="https://laravel.com/img/docs/basic-slack-notification.png"></p>

<h4>Customizing The Sender &amp; Recipient</h4>

<p>You may use the <code>from</code> and <code>to</code> methods to customize the sender and recipient. The <code>from</code> method accepts a username and emoji identifier, while the <code>to</code> method accepts a channel or username:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;Ghost&#39;</span><span class="p">,</span> <span class="s1">&#39;:ghost:&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;#other&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;This will be sent to #other&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>You may also use an image as your logo instead of an emoji:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;Laravel&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">image</span><span class="p">(</span><span class="s1">&#39;https://laravel.com/img/favicon/favicon.ico&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;This will display the Laravel logo next to the message&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="slack-attachments"></a></p>

<h3>Slack Attachments</h3>

<p>You may also add &quot;attachments&quot; to Slack messages. Attachments provide richer formatting options than simple text messages. In this example, we will send an error notification about an exception that occurred in an application, including a link to view more details about the exception:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/exceptions/&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">exception</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">error</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;Whoops! Something went wrong.&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attachment</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$attachment</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$url</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$attachment</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">(</span><span class="s1">&#39;Exception: File Not Found&#39;</span><span class="p">,</span> <span class="nx">$url</span><span class="p">)</span>
                               <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;File [background.jpg] was not found.&#39;</span><span class="p">);</span>
                <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>The example above will generate a Slack message that looks like the following:</p>

<p><img src="https://laravel.com/img/docs/basic-slack-attachment.png"></p>

<p>Attachments also allow you to specify an array of data that should be presented to the user. The given data will be presented in a table-style format for easy reading:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/invoices/&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">invoice</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">success</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;One of your invoices has been paid!&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attachment</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$attachment</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$url</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$attachment</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">(</span><span class="s1">&#39;Invoice 1322&#39;</span><span class="p">,</span> <span class="nx">$url</span><span class="p">)</span>
                               <span class="o">-&gt;</span><span class="nx">fields</span><span class="p">([</span>
                                    <span class="s1">&#39;Title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Server Expenses&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Amount&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;$1,234&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Via&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;American Express&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Was Overdue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;:-1:&#39;</span><span class="p">,</span>
                                <span class="p">]);</span>
                <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>The example above will create a Slack message that looks like the following:</p>

<p><img src="https://laravel.com/img/docs/slack-fields-attachment.png"></p>

<h4>Markdown Attachment Content</h4>

<p>If some of your attachment fields contain Markdown, you may use the <code>markdown</code> method to instruct Slack to parse and display the given attachment fields as Markdown formatted text. The values accepted by this method are: <code>pretext</code>, <code>text</code>, and / or <code>fields</code>. For more information about Slack attachment formatting, check out the <a href="https://api.slack.com/docs/message-formatting#message_formatting">Slack API documentation</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the Slack representation of the notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $notifiable</span>
<span class="cm"> * @return SlackMessage</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">toSlack</span><span class="p">(</span><span class="nx">$notifiable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/exceptions/&#39;</span><span class="p">.</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">exception</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SlackMessage</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">error</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;Whoops! Something went wrong.&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">attachment</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$attachment</span><span class="p">)</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$url</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$attachment</span><span class="o">-&gt;</span><span class="nx">title</span><span class="p">(</span><span class="s1">&#39;Exception: File Not Found&#39;</span><span class="p">,</span> <span class="nx">$url</span><span class="p">)</span>
                               <span class="o">-&gt;</span><span class="nx">content</span><span class="p">(</span><span class="s1">&#39;File [background.jpg] was *not found*.&#39;</span><span class="p">)</span>
                               <span class="o">-&gt;</span><span class="nx">markdown</span><span class="p">([</span><span class="s1">&#39;text&#39;</span><span class="p">]);</span>
                <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="routing-slack-notifications"></a></p>

<h3>Routing Slack Notifications</h3>

<p>To route Slack notifications to the proper location, define a <code>routeNotificationForSlack</code> method on your notifiable entity. This should return the webhook URL to which the notification should be delivered. Webhook URLs may be generated by adding an &quot;Incoming Webhook&quot; service to your Slack team:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Route notifications for the Slack channel.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Notifications\Notification  $notification</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">routeNotificationForSlack</span><span class="p">(</span><span class="nv">$notification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;https://hooks.slack.com/services/...&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="localizing-notifications"></a></p>

<h2>Localizing Notifications</h2>

<p>Laravel allows you to send notifications in a locale other than the current language, and will even remember this locale if the notification is queued.</p>

<p>To accomplish this, the <code>Illuminate\Notifications\Notification</code> class offers a <code>locale</code> method to set the desired language. The application will change into this locale when the notification is being formatted and then revert back to the previous locale when formatting is complete:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">((</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">))</span><span class="o">-&gt;</span><span class="nx">locale</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">));</span>
</pre></div>

<p>Localization of multiple notifiable entries may also be achieved via the <code>Notification</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Notification</span><span class="o">::</span><span class="nx">locale</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="nx">$users</span><span class="p">,</span> <span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<h3>User Preferred Locales</h3>

<p>Sometimes, applications store each user&#39;s preferred locale. By implementing the <code>HasLocalePreference</code> contract on your notifiable model, you may instruct Laravel to use this stored locale when sending a notification:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Translation</span><span class="err">\</span><span class="nx">HasLocalePreference</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="kr">implements</span> <span class="nx">HasLocalePreference</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Get the user&#39;s preferred locale.</span>
<span class="cm">     *</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">preferredLocale</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">locale</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once you have implemented the interface, Laravel will automatically use the preferred locale when sending notifications and mailables to the model. Therefore, there is no need to call the <code>locale</code> method when using this interface:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">InvoicePaid</span><span class="p">(</span><span class="nx">$invoice</span><span class="p">));</span>
</pre></div>

<p><a name="notification-events"></a></p>

<h2>Notification Events</h2>

<p>When a notification is sent, the <code>Illuminate\Notifications\Events\NotificationSent</code> event is fired by the notification system. This contains the &quot;notifiable&quot; entity and the notification instance itself. You may register listeners for this event in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Illuminate\Notifications\Events\NotificationSent&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogNotification&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<blockquote>
<p>{tip} After registering listeners in your <code>EventServiceProvider</code>, use the <code>event:generate</code> Artisan command to quickly generate listener classes.</p>
</blockquote>

<p>Within an event listener, you may access the <code>notifiable</code>, <code>notification</code>, and <code>channel</code> properties on the event to learn more about the notification recipient or the notification itself:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Handle the event.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  NotificationSent  $event</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">NotificationSent</span> <span class="nx">$event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// $event-&gt;channel</span>
    <span class="c1">// $event-&gt;notifiable</span>
    <span class="c1">// $event-&gt;notification</span>
    <span class="c1">// $event-&gt;response</span>
<span class="p">}</span>
</pre></div>

<p><a name="custom-channels"></a></p>

<h2>Custom Channels</h2>

<p>Laravel ships with a handful of notification channels, but you may want to write your own drivers to deliver notifications via other channels. Laravel makes it simple. To get started, define a class that contains a <code>send</code> method. The method should receive two arguments: a <code>$notifiable</code> and a <code>$notification</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Channels</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VoiceChannel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Send the given notification.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  mixed  $notifiable</span>
<span class="sd">     * @param  \Illuminate\Notifications\Notification  $notification</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">,</span> <span class="nx">Notification</span> <span class="nv">$notification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$notification</span><span class="o">-&gt;</span><span class="na">toVoice</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">);</span>

        <span class="c1">// Send notification to the $notifiable instance...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once your notification channel class has been defined, you may return the class name from the <code>via</code> method of any of your notifications:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Channels\Messages\VoiceMessage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Channels\VoiceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InvoicePaid</span> <span class="k">extends</span> <span class="nx">Notification</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Queueable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the notification channels.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  mixed  $notifiable</span>
<span class="sd">     * @return array|string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nx">VoiceChannel</span><span class="o">::</span><span class="na">class</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the voice representation of the notification.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  mixed  $notifiable</span>
<span class="sd">     * @return VoiceMessage</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toVoice</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Package Development</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#a-note-on-facades">A Note On Facades</a></li>
</ul></li>
<li><a href="#package-discovery">Package Discovery</a></li>
<li><a href="#service-providers">Service Providers</a></li>
<li><a href="#resources">Resources</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#migrations">Migrations</a></li>
<li><a href="#routes">Routes</a></li>
<li><a href="#translations">Translations</a></li>
<li><a href="#views">Views</a></li>
<li><a href="#view-components">View Components</a></li>
</ul></li>
<li><a href="#commands">Commands</a></li>
<li><a href="#public-assets">Public Assets</a></li>
<li><a href="#publishing-file-groups">Publishing File Groups</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Packages are the primary way of adding functionality to Laravel. Packages might be anything from a great way to work with dates like <a href="https://github.com/briannesbitt/Carbon">Carbon</a>, or an entire BDD testing framework like <a href="https://github.com/Behat/Behat">Behat</a>.</p>

<p>There are different types of packages. Some packages are stand-alone, meaning they work with any PHP framework. Carbon and Behat are examples of stand-alone packages. Any of these packages may be used with Laravel by requesting them in your <code>composer.json</code> file.</p>

<p>On the other hand, other packages are specifically intended for use with Laravel. These packages may have routes, controllers, views, and configuration specifically intended to enhance a Laravel application. This guide primarily covers the development of those packages that are Laravel specific.</p>

<p><a name="a-note-on-facades"></a></p>

<h3>A Note On Facades</h3>

<p>When writing a Laravel application, it generally does not matter if you use contracts or facades since both provide essentially equal levels of testability. However, when writing packages, your package will not typically have access to all of Laravel&#39;s testing helpers. If you would like to be able to write your package tests as if they existed inside a typical Laravel application, you may use the <a href="https://github.com/orchestral/testbench">Orchestral Testbench</a> package.</p>

<p><a name="package-discovery"></a></p>

<h2>Package Discovery</h2>

<p>In a Laravel application&#39;s <code>config/app.php</code> configuration file, the <code>providers</code> option defines a list of service providers that should be loaded by Laravel. When someone installs your package, you will typically want your service provider to be included in this list. Instead of requiring users to manually add your service provider to the list, you may define the provider in the <code>extra</code> section of your package&#39;s <code>composer.json</code> file. In addition to service providers, you may also list any <a href="/docs/%7B%7Bversion%7D%7D/facades">facades</a> you would like to be registered:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;extra&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;laravel&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;providers&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;Barryvdh\\Debugbar\\ServiceProvider&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;aliases&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;Debugbar&quot;</span><span class="o">:</span> <span class="s2">&quot;Barryvdh\\Debugbar\\Facade&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>

<p>Once your package has been configured for discovery, Laravel will automatically register its service providers and facades when it is installed, creating a convenient installation experience for your package&#39;s users.</p>

<h3>Opting Out Of Package Discovery</h3>

<p>If you are the consumer of a package and would like to disable package discovery for a package, you may list the package name in the <code>extra</code> section of your application&#39;s <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;extra&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;laravel&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;dont-discover&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;barryvdh/laravel-debugbar&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>

<p>You may disable package discovery for all packages using the <code>*</code> character inside of your application&#39;s <code>dont-discover</code> directive:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;extra&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;laravel&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;dont-discover&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;*&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>

<p><a name="service-providers"></a></p>

<h2>Service Providers</h2>

<p><a href="/docs/%7B%7Bversion%7D%7D/providers">Service providers</a> are the connection points between your package and Laravel. A service provider is responsible for binding things into Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> and informing Laravel where to load package resources such as views, configuration, and localization files.</p>

<p>A service provider extends the <code>Illuminate\Support\ServiceProvider</code> class and contains two methods: <code>register</code> and <code>boot</code>. The base <code>ServiceProvider</code> class is located in the <code>illuminate/support</code> Composer package, which you should add to your own package&#39;s dependencies. To learn more about the structure and purpose of service providers, check out <a href="/docs/%7B%7Bversion%7D%7D/providers">their documentation</a>.</p>

<p><a name="resources"></a></p>

<h2>Resources</h2>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>Typically, you will need to publish your package&#39;s configuration file to the application&#39;s own <code>config</code> directory. This will allow users of your package to easily override your default configuration options. To allow your configuration files to be published, call the <code>publishes</code> method from the <code>boot</code> method of your service provider:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;courier.php&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> command, your file will be copied to the specified publish location. Once your configuration has been published, its values may be accessed like any other configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;courier.option&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} You should not define Closures in your configuration files. They can not be serialized correctly when users execute the <code>config:cache</code> Artisan command.</p>
</blockquote>

<h4>Default Package Configuration</h4>

<p>You may also merge your own package configuration file with the application&#39;s published copy. This will allow your users to define only the options they actually want to override in the published copy of the configuration. To merge the configurations, use the <code>mergeConfigFrom</code> method within your service provider&#39;s <code>register</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">mergeConfigFrom</span><span class="p">(</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/config/courier.php&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} This method only merges the first level of the configuration array. If your users partially define a multi-dimensional configuration array, the missing options will not be merged.</p>
</blockquote>

<p><a name="routes"></a></p>

<h3>Routes</h3>

<p>If your package contains routes, you may load them using the <code>loadRoutesFrom</code> method. This method will automatically determine if the application&#39;s routes are cached and will not load your routes file if the routes have already been cached:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadRoutesFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/routes.php&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="migrations"></a></p>

<h3>Migrations</h3>

<p>If your package contains <a href="/docs/%7B%7Bversion%7D%7D/migrations">database migrations</a>, you may use the <code>loadMigrationsFrom</code> method to inform Laravel how to load them. The <code>loadMigrationsFrom</code> method accepts the path to your package&#39;s migrations as its only argument:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadMigrationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/migrations&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Once your package&#39;s migrations have been registered, they will automatically be run when the <code>php artisan migrate</code> command is executed. You do not need to export them to the application&#39;s main <code>database/migrations</code> directory.</p>

<p><a name="translations"></a></p>

<h3>Translations</h3>

<p>If your package contains <a href="/docs/%7B%7Bversion%7D%7D/localization">translation files</a>, you may use the <code>loadTranslationsFrom</code> method to inform Laravel how to load them. For example, if your package is named <code>courier</code>, you should add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadTranslationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Package translations are referenced using the <code>package::file.line</code> syntax convention. So, you may load the <code>courier</code> package&#39;s <code>welcome</code> line from the <code>messages</code> file like so:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;courier::messages.welcome&#39;</span><span class="p">);</span>
</pre></div>

<h4>Publishing Translations</h4>

<p>If you would like to publish your package&#39;s translations to the application&#39;s <code>resources/lang/vendor</code> directory, you may use the service provider&#39;s <code>publishes</code> method. The <code>publishes</code> method accepts an array of package paths and their desired publish locations. For example, to publish the translation files for the <code>courier</code> package, you may do the following:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadTranslationsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/translations&#39;</span> <span class="p">=&gt;</span> <span class="nx">resource_path</span><span class="p">(</span><span class="s1">&#39;lang/vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> Artisan command, your package&#39;s translations will be published to the specified publish location.</p>

<p><a name="views"></a></p>

<h3>Views</h3>

<p>To register your package&#39;s <a href="/docs/%7B%7Bversion%7D%7D/views">views</a> with Laravel, you need to tell Laravel where the views are located. You may do this using the service provider&#39;s <code>loadViewsFrom</code> method. The <code>loadViewsFrom</code> method accepts two arguments: the path to your view templates and your package&#39;s name. For example, if your package&#39;s name is <code>courier</code>, you would add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Package views are referenced using the <code>package::view</code> syntax convention. So, once your view path is registered in a service provider, you may load the <code>admin</code> view from the <code>courier</code> package like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;courier::admin&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Overriding Package Views</h4>

<p>When you use the <code>loadViewsFrom</code> method, Laravel actually registers two locations for your views: the application&#39;s <code>resources/views/vendor</code> directory and the directory you specify. So, using the <code>courier</code> example, Laravel will first check if a custom version of the view has been provided by the developer in <code>resources/views/vendor/courier</code>. Then, if the view has not been customized, Laravel will search the package view directory you specified in your call to <code>loadViewsFrom</code>. This makes it easy for package users to customize / override your package&#39;s views.</p>

<h4>Publishing Views</h4>

<p>If you would like to make your views available for publishing to the application&#39;s <code>resources/views/vendor</code> directory, you may use the service provider&#39;s <code>publishes</code> method. The <code>publishes</code> method accepts an array of package view paths and their desired publish locations:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewsFrom</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span><span class="p">,</span> <span class="s1">&#39;courier&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/views&#39;</span> <span class="p">=&gt;</span> <span class="nx">resource_path</span><span class="p">(</span><span class="s1">&#39;views/vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when users of your package execute Laravel&#39;s <code>vendor:publish</code> Artisan command, your package&#39;s views will be copied to the specified publish location.</p>

<p><a name="view-components"></a></p>

<h3>View Components</h3>

<p>If your package contains <a href="/docs/%7B%7Bversion%7D%7D/blade#components">view components</a>, you may use the <code>loadViewComponentsAs</code> method to inform Laravel how to load them. The <code>loadViewComponentsAs</code> method accepts two arguments: the tag prefix for your view components and an array of your view components class. For example, if your package&#39;s prefix is <code>courier</code> and you have <code>Alert</code> and <code>Button</code> view components, you would add the following to your service provider&#39;s <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">loadViewComponentsAs</span><span class="p">(</span><span class="s1">&#39;courier&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">Alert</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="nx">Button</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p>Once your view components are registered in a service provider, you may reference them in your view like so:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">courier</span><span class="o">-</span><span class="nx">alert</span> <span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">courier</span><span class="o">-</span><span class="nx">button</span> <span class="o">/&gt;</span>
</pre></div>

<h4>Anonymous Components</h4>

<p>If your package contains anonymous components, they must be placed within a <code>components</code> directory of your package&#39;s &quot;views&quot; directory (as specified by <code>loadViewsFrom</code>). Then, you may render them by prefixing the component name with the package&#39;s view namespace:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">x</span><span class="o">-</span><span class="nx">courier</span><span class="o">::</span><span class="nx">alert</span> <span class="o">/&gt;</span>
</pre></div>

<p><a name="commands"></a></p>

<h2>Commands</h2>

<p>To register your package&#39;s Artisan commands with Laravel, you may use the <code>commands</code> method. This method expects an array of command class names. Once the commands have been registered, you may execute them using the <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan CLI</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap the application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">runningInConsole</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">commands</span><span class="p">([</span>
            <span class="nx">FooCommand</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
            <span class="nx">BarCommand</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="public-assets"></a></p>

<h2>Public Assets</h2>

<p>Your package may have assets such as JavaScript, CSS, and images. To publish these assets to the application&#39;s <code>public</code> directory, use the service provider&#39;s <code>publishes</code> method. In this example, we will also add a <code>public</code> asset group tag, which may be used to publish groups of related assets:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/path/to/assets&#39;</span> <span class="p">=&gt;</span> <span class="nx">public_path</span><span class="p">(</span><span class="s1">&#39;vendor/courier&#39;</span><span class="p">),</span>
    <span class="p">],</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Now, when your package&#39;s users execute the <code>vendor:publish</code> command, your assets will be copied to the specified publish location. Since you will typically need to overwrite the assets every time the package is updated, you may use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="kr">public</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>

<p><a name="publishing-file-groups"></a></p>

<h2>Publishing File Groups</h2>

<p>You may want to publish groups of package assets and resources separately. For instance, you might want to allow your users to publish your package&#39;s configuration files without being forced to publish your package&#39;s assets. You may do this by &quot;tagging&quot; them when calling the <code>publishes</code> method from a package&#39;s service provider. For example, let&#39;s use tags to define two publish groups in the <code>boot</code> method of a package service provider:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../config/package.php&#39;</span> <span class="p">=&gt;</span> <span class="nx">config_path</span><span class="p">(</span><span class="s1">&#39;package.php&#39;</span><span class="p">)</span>
    <span class="p">],</span> <span class="s1">&#39;config&#39;</span><span class="p">);</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">publishes</span><span class="p">([</span>
        <span class="nx">__DIR__</span><span class="p">.</span><span class="s1">&#39;/../database/migrations/&#39;</span> <span class="p">=&gt;</span> <span class="nx">database_path</span><span class="p">(</span><span class="s1">&#39;migrations&#39;</span><span class="p">)</span>
    <span class="p">],</span> <span class="s1">&#39;migrations&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Now your users may publish these groups separately by referencing their tag when executing the <code>vendor:publish</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">config</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Pagination</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#basic-usage">Basic Usage</a>

<ul>
<li><a href="#paginating-query-builder-results">Paginating Query Builder Results</a></li>
<li><a href="#paginating-eloquent-results">Paginating Eloquent Results</a></li>
<li><a href="#manually-creating-a-paginator">Manually Creating A Paginator</a></li>
</ul></li>
<li><a href="#displaying-pagination-results">Displaying Pagination Results</a>

<ul>
<li><a href="#converting-results-to-json">Converting Results To JSON</a></li>
</ul></li>
<li><a href="#customizing-the-pagination-view">Customizing The Pagination View</a>

<ul>
<li><a href="#using-bootstrap">Using Bootstrap</a></li>
</ul></li>
<li><a href="#paginator-instance-methods">Paginator Instance Methods</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In other frameworks, pagination can be very painful. Laravel&#39;s paginator is integrated with the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> and <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent ORM</a> and provides convenient, easy-to-use pagination of database results out of the box. By default, the HTML generated by the paginator is compatible with the <a href="https://tailwindcss.com/">Tailwind CSS framework</a>; however, Bootstrap views are also available.</p>

<p><a name="basic-usage"></a></p>

<h2>Basic Usage</h2>

<p><a name="paginating-query-builder-results"></a></p>

<h3>Paginating Query Builder Results</h3>

<p>There are several ways to paginate items. The simplest is by using the <code>paginate</code> method on the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> or an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent query</a>. The <code>paginate</code> method automatically takes care of setting the proper limit and offset based on the current page being viewed by the user. By default, the current page is detected by the value of the <code>page</code> query string argument on the HTTP request. This value is automatically detected by Laravel, and is also automatically inserted into links generated by the paginator.</p>

<p>In this example, the only argument passed to the <code>paginate</code> method is the number of items you would like displayed &quot;per page&quot;. In this case, let&#39;s specify that we would like to display <code>15</code> items per page:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show all of the users for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Currently, pagination operations that use a <code>groupBy</code> statement cannot be executed efficiently by Laravel. If you need to use a <code>groupBy</code> with a paginated result set, it is recommended that you query the database and create a paginator manually.</p>
</blockquote>

<h4>&quot;Simple Pagination&quot;</h4>

<p>If you only need to display simple &quot;Next&quot; and &quot;Previous&quot; links in your pagination view, you may use the <code>simplePaginate</code> method to perform a more efficient query. This is very useful for large datasets when you do not need to display a link for each page number when rendering your view:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p><a name="paginating-eloquent-results"></a></p>

<h3>Paginating Eloquent Results</h3>

<p>You may also paginate <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent</a> queries. In this example, we will paginate the <code>User</code> model with <code>15</code> items per page. As you can see, the syntax is nearly identical to paginating query builder results:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>You may call <code>paginate</code> after setting other constraints on the query, such as <code>where</code> clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>You may also use the <code>simplePaginate</code> method when paginating Eloquent models:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p><a name="manually-creating-a-paginator"></a></p>

<h3>Manually Creating A Paginator</h3>

<p>Sometimes you may wish to create a pagination instance manually, passing it an array of items. You may do so by creating either an <code>Illuminate\Pagination\Paginator</code> or <code>Illuminate\Pagination\LengthAwarePaginator</code> instance, depending on your needs.</p>

<p>The <code>Paginator</code> class does not need to know the total number of items in the result set; however, because of this, the class does not have methods for retrieving the index of the last page. The <code>LengthAwarePaginator</code> accepts almost the same arguments as the <code>Paginator</code>; however, it does require a count of the total number of items in the result set.</p>

<p>In other words, the <code>Paginator</code> corresponds to the <code>simplePaginate</code> method on the query builder and Eloquent, while the <code>LengthAwarePaginator</code> corresponds to the <code>paginate</code> method.</p>

<blockquote>
<p>{note} When manually creating a paginator instance, you should manually &quot;slice&quot; the array of results you pass to the paginator. If you&#39;re unsure how to do this, check out the <a href="https://secure.php.net/manual/en/function.array-slice.php">array_slice</a> PHP function.</p>
</blockquote>

<p><a name="displaying-pagination-results"></a></p>

<h2>Displaying Pagination Results</h2>

<p>When calling the <code>paginate</code> method, you will receive an instance of <code>Illuminate\Pagination\LengthAwarePaginator</code>. When calling the <code>simplePaginate</code> method, you will receive an instance of <code>Illuminate\Pagination\Paginator</code>. These objects provide several methods that describe the result set. In addition to these helpers methods, the paginator instances are iterators and may be looped as an array. So, once you have retrieved the results, you may display the results and render the page links using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span>
        <span class="p">{{</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span> <span class="p">}}</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="p">{{</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>The <code>links</code> method will render the links to the rest of the pages in the result set. Each of these links will already contain the proper <code>page</code> query string variable. Remember, the HTML generated by the <code>links</code> method is compatible with the <a href="https://tailwindcss.com">Tailwind CSS framework</a>.</p>

<h4>Customizing The Paginator URI</h4>

<p>The <code>withPath</code> method allows you to customize the URI used by the paginator when generating links. For example, if you want the paginator to generate links like <code>http://example.com/custom/url?page=N</code>, you should pass <code>custom/url</code> to the <code>withPath</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$users</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

    <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">withPath</span><span class="p">(</span><span class="s1">&#39;custom/url&#39;</span><span class="p">);</span>

    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>Appending To Pagination Links</h4>

<p>You may append to the query string of pagination links using the <code>appends</code> method. For example, to append <code>sort=votes</code> to each pagination link, you should make the following call to <code>appends</code>:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">appends</span><span class="p">([</span><span class="s1">&#39;sort&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;votes&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>If you wish to append all current query string values to the pagination links you may use the <code>withQueryString</code> method:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">withQueryString</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p>If you wish to append a &quot;hash fragment&quot; to the paginator&#39;s URLs, you may use the <code>fragment</code> method. For example, to append <code>#foo</code> to the end of each pagination link, make the following call to the <code>fragment</code> method:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">fragment</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<h4>Adjusting The Pagination Link Window</h4>

<p>You may control how many additional links are displayed on each side of the paginator&#39;s URL &quot;window&quot;. By default, three links are displayed on each side of the primary paginator links. However, you may control this number using the <code>onEachSide</code> method:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$users</span><span class="o">-&gt;</span><span class="nx">onEachSide</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p><a name="converting-results-to-json"></a></p>

<h3>Converting Results To JSON</h3>

<p>The Laravel paginator result classes implement the <code>Illuminate\Contracts\Support\Jsonable</code> Interface contract and expose the <code>toJson</code> method, so it&#39;s very easy to convert your pagination results to JSON. You may also convert a paginator instance to JSON by returning it from a route or controller action:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">paginate</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The JSON from the paginator will include meta information such as <code>total</code>, <code>current_page</code>, <code>last_page</code>, and more. The actual result objects will be available via the <code>data</code> key in the JSON array. Here is an example of the JSON created by returning a paginator instance from a route:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;total&quot;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
   <span class="s2">&quot;per_page&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
   <span class="s2">&quot;current_page&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;last_page&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
   <span class="s2">&quot;first_page_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://laravel.app?page=1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;last_page_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://laravel.app?page=4&quot;</span><span class="p">,</span>
   <span class="s2">&quot;next_page_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://laravel.app?page=2&quot;</span><span class="p">,</span>
   <span class="s2">&quot;prev_page_url&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
   <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;http://laravel.app&quot;</span><span class="p">,</span>
   <span class="s2">&quot;from&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;to&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
   <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="c1">// Result Object</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="c1">// Result Object</span>
        <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-pagination-view"></a></p>

<h2>Customizing The Pagination View</h2>

<p>By default, the views rendered to display the pagination links are compatible with the Tailwind CSS framework. However, if you are not using Tailwind, you are free to define your own views to render these links. When calling the <code>links</code> method on a paginator instance, pass the view name as the first argument to the method:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$paginator</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">)</span> <span class="p">}}</span>

<span class="c1">// Passing data to the view...</span>
<span class="p">{{</span> <span class="nx">$paginator</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">(</span><span class="s1">&#39;view.name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span> <span class="p">}}</span>
</pre></div>

<p>However, the easiest way to customize the pagination views is by exporting them to your <code>resources/views/vendor</code> directory using the <code>vendor:publish</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">pagination</span>
</pre></div>

<p>This command will place the views in the <code>resources/views/vendor/pagination</code> directory. The <code>tailwind.blade.php</code> file within this directory corresponds to the default pagination view. You may edit this file to modify the pagination HTML.</p>

<p>If you would like to designate a different file as the default pagination view, you may use the paginator&#39;s <code>defaultView</code> and <code>defaultSimpleView</code> methods within your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Pagination</span><span class="err">\</span><span class="nx">Paginator</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Paginator</span><span class="o">::</span><span class="nx">defaultView</span><span class="p">(</span><span class="s1">&#39;view-name&#39;</span><span class="p">);</span>

    <span class="nx">Paginator</span><span class="o">::</span><span class="nx">defaultSimpleView</span><span class="p">(</span><span class="s1">&#39;view-name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="using-bootstrap"></a></p>

<h3>Using Bootstrap</h3>

<p>Laravel includes pagination views built using <a href="https://getbootstrap.com/">Bootstrap CSS</a>. To use these views instead of the default Tailwind views, you may call the paginator&#39;s <code>useBootstrap</code> method within your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Pagination</span><span class="err">\</span><span class="nx">Paginator</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Paginator</span><span class="o">::</span><span class="nx">useBootstrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="paginator-instance-methods"></a></p>

<h2>Paginator Instance Methods</h2>

<p>Each paginator instance provides additional pagination information via the following methods:</p>

<p>Method  |  Description
-------  |  -----------
<code>$paginator-&gt;count()</code>  |  Get the number of items for the current page.
<code>$paginator-&gt;currentPage()</code>  |  Get the current page number.
<code>$paginator-&gt;firstItem()</code>  |  Get the result number of the first item in the results.
<code>$paginator-&gt;getOptions()</code>  |  Get the paginator options.
<code>$paginator-&gt;getUrlRange($start, $end)</code>  |  Create a range of pagination URLs.
<code>$paginator-&gt;hasPages()</code>  |  Determine if there are enough items to split into multiple pages.
<code>$paginator-&gt;hasMorePages()</code>  |  Determine if there is more items in the data store.
<code>$paginator-&gt;items()</code>  |  Get the items for the current page.
<code>$paginator-&gt;lastItem()</code>  |  Get the result number of the last item in the results.
<code>$paginator-&gt;lastPage()</code>  |  Get the page number of the last available page. (Not available when using <code>simplePaginate</code>).
<code>$paginator-&gt;nextPageUrl()</code>  |  Get the URL for the next page.
<code>$paginator-&gt;onFirstPage()</code>  |  Determine if the paginator is on the first page.
<code>$paginator-&gt;perPage()</code>  |  The number of items to be shown per page.
<code>$paginator-&gt;previousPageUrl()</code>  |  Get the URL for the previous page.
<code>$paginator-&gt;total()</code>  |  Determine the total number of matching items in the data store. (Not available when using <code>simplePaginate</code>).
<code>$paginator-&gt;url($page)</code>  |  Get the URL for a given page number.
<code>$paginator-&gt;getPageName()</code>  |  Get the query string variable used to store the page.
<code>$paginator-&gt;setPageName($name)</code>  |  Set the query string variable used to store the page.</p>
<div style="page-break-after: always;" ></div><h1>Laravel Passport</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#upgrading">Upgrading Passport</a></li>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#frontend-quickstart">Frontend Quickstart</a></li>
<li><a href="#deploying-passport">Deploying Passport</a></li>
<li><a href="#migration-customization">Migration Customization</a></li>
</ul></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#client-secret-hashing">Client Secret Hashing</a></li>
<li><a href="#token-lifetimes">Token Lifetimes</a></li>
<li><a href="#overriding-default-models">Overriding Default Models</a></li>
</ul></li>
<li><a href="#issuing-access-tokens">Issuing Access Tokens</a>

<ul>
<li><a href="#managing-clients">Managing Clients</a></li>
<li><a href="#requesting-tokens">Requesting Tokens</a></li>
<li><a href="#refreshing-tokens">Refreshing Tokens</a></li>
<li><a href="#revoking-tokens">Revoking Tokens</a></li>
<li><a href="#purging-tokens">Purging Tokens</a></li>
</ul></li>
<li><a href="#code-grant-pkce">Authorization Code Grant with PKCE</a>

<ul>
<li><a href="#creating-a-auth-pkce-grant-client">Creating The Client</a></li>
<li><a href="#requesting-auth-pkce-grant-tokens">Requesting Tokens</a></li>
</ul></li>
<li><a href="#password-grant-tokens">Password Grant Tokens</a>

<ul>
<li><a href="#creating-a-password-grant-client">Creating A Password Grant Client</a></li>
<li><a href="#requesting-password-grant-tokens">Requesting Tokens</a></li>
<li><a href="#requesting-all-scopes">Requesting All Scopes</a></li>
<li><a href="#customizing-the-user-provider">Customizing The User Provider</a></li>
<li><a href="#customizing-the-username-field">Customizing The Username Field</a></li>
<li><a href="#customizing-the-password-validation">Customizing The Password Validation</a></li>
</ul></li>
<li><a href="#implicit-grant-tokens">Implicit Grant Tokens</a></li>
<li><a href="#client-credentials-grant-tokens">Client Credentials Grant Tokens</a></li>
<li><a href="#personal-access-tokens">Personal Access Tokens</a>

<ul>
<li><a href="#creating-a-personal-access-client">Creating A Personal Access Client</a></li>
<li><a href="#managing-personal-access-tokens">Managing Personal Access Tokens</a></li>
</ul></li>
<li><a href="#protecting-routes">Protecting Routes</a>

<ul>
<li><a href="#via-middleware">Via Middleware</a></li>
<li><a href="#passing-the-access-token">Passing The Access Token</a></li>
</ul></li>
<li><a href="#token-scopes">Token Scopes</a>

<ul>
<li><a href="#defining-scopes">Defining Scopes</a></li>
<li><a href="#default-scope">Default Scope</a></li>
<li><a href="#assigning-scopes-to-tokens">Assigning Scopes To Tokens</a></li>
<li><a href="#checking-scopes">Checking Scopes</a></li>
</ul></li>
<li><a href="#consuming-your-api-with-javascript">Consuming Your API With JavaScript</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#testing">Testing</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel already makes it easy to perform authentication via traditional login forms, but what about APIs? APIs typically use tokens to authenticate users and do not maintain session state between requests. Laravel makes API authentication a breeze using Laravel Passport, which provides a full OAuth2 server implementation for your Laravel application in a matter of minutes. Passport is built on top of the <a href="https://github.com/thephpleague/oauth2-server">League OAuth2 server</a> that is maintained by Andy Millington and Simon Hamp.</p>

<blockquote>
<p>{note} This documentation assumes you are already familiar with OAuth2. If you do not know anything about OAuth2, consider familiarizing yourself with the general <a href="https://oauth2.thephpleague.com/terminology/">terminology</a> and features of OAuth2 before continuing.</p>
</blockquote>

<p><a name="upgrading"></a></p>

<h2>Upgrading Passport</h2>

<p>When upgrading to a new major version of Passport, it&#39;s important that you carefully review <a href="https://github.com/laravel/passport/blob/master/UPGRADE.md">the upgrade guide</a>.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>To get started, install Passport via the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">passport</span>
</pre></div>

<p>The Passport service provider registers its own database migration directory with the framework, so you should migrate your database after installing the package. The Passport migrations will create the tables your application needs to store clients and access tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>Next, you should run the <code>passport:install</code> command. This command will create the encryption keys needed to generate secure access tokens. In addition, the command will create &quot;personal access&quot; and &quot;password grant&quot; clients which will be used to generate access tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">install</span>
</pre></div>

<blockquote>
<p>{tip} If you would like to use UUIDs as the primary key value of the Passport <code>Client</code> model instead of auto-incrementing integers, please install Passport using <a href="#client-uuids">the <code>uuids</code> option</a>.</p>
</blockquote>

<p>After running the <code>passport:install</code> command, add the <code>Laravel\Passport\HasApiTokens</code> trait to your <code>App\Models\User</code> model. This trait will provide a few helper methods to your model which allow you to inspect the authenticated user&#39;s token and scopes:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Next, you should call the <code>Passport::routes</code> method within the <code>boot</code> method of your <code>AuthServiceProvider</code>. This method will register the routes necessary to issue access tokens and revoke access tokens, clients, and personal access tokens:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Gate</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The policy mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$policies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;App\Models\Model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;App\Policies\ModelPolicy&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Register any authentication / authorization services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>

        <span class="nx">Passport</span><span class="o">::</span><span class="na">routes</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Finally, in your <code>config/auth.php</code> configuration file, you should set the <code>driver</code> option of the <code>api</code> authentication guard to <code>passport</code>. This will instruct your application to use Passport&#39;s <code>TokenGuard</code> when authenticating incoming API requests:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;guards&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p><a name="client-uuids"></a></p>

<h4>Client UUIDs</h4>

<p>You may run the <code>passport:install</code> command with the <code>--uuids</code> option present. This flag will instruct Passport that you would like to use UUIDs instead of auto-incrementing integers as the Passport <code>Client</code> model&#39;s primary key values. After running the <code>passport:install</code> command with the <code>--uuids</code> option, you will be given additional instructions regarding disabling Passport&#39;s default migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">install</span> <span class="o">--</span><span class="nx">uuids</span>
</pre></div>

<p><a name="frontend-quickstart"></a></p>

<h3>Frontend Quickstart</h3>

<blockquote>
<p>{note} In order to use the Passport Vue components, you must be using the <a href="https://vuejs.org">Vue</a> JavaScript framework. These components also use the Bootstrap CSS framework. However, even if you are not using these tools, the components serve as a valuable reference for your own frontend implementation.</p>
</blockquote>

<p>Passport ships with a JSON API that you may use to allow your users to create clients and personal access tokens. However, it can be time consuming to code a frontend to interact with these APIs. So, Passport also includes pre-built <a href="https://vuejs.org">Vue</a> components you may use as an example implementation or starting point for your own implementation.</p>

<p>To publish the Passport Vue components, use the <code>vendor:publish</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">passport</span><span class="o">-</span><span class="nx">components</span>
</pre></div>

<p>The published components will be placed in your <code>resources/js/components</code> directory. Once the components have been published, you should register them in your <code>resources/js/app.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span>
    <span class="s1">&#39;passport-clients&#39;</span><span class="p">,</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./components/passport/Clients.vue&#39;</span><span class="p">).</span><span class="k">default</span>
<span class="p">);</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span>
    <span class="s1">&#39;passport-authorized-clients&#39;</span><span class="p">,</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./components/passport/AuthorizedClients.vue&#39;</span><span class="p">).</span><span class="k">default</span>
<span class="p">);</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span>
    <span class="s1">&#39;passport-personal-access-tokens&#39;</span><span class="p">,</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./components/passport/PersonalAccessTokens.vue&#39;</span><span class="p">).</span><span class="k">default</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} Prior to Laravel v5.7.19, appending <code>.default</code> when registering components results in a console error. An explanation for this change can be found in the <a href="https://github.com/JeffreyWay/laravel-mix/releases/tag/v4.0.0">Laravel Mix v4.0.0 release notes</a>.</p>
</blockquote>

<p>After registering the components, make sure to run <code>npm run dev</code> to recompile your assets. Once you have recompiled your assets, you may drop the components into one of your application&#39;s templates to get started creating clients and personal access tokens:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">passport</span><span class="o">-</span><span class="nx">clients</span><span class="o">&gt;&lt;</span><span class="err">/passport-clients&gt;</span>
<span class="o">&lt;</span><span class="nx">passport</span><span class="o">-</span><span class="nx">authorized</span><span class="o">-</span><span class="nx">clients</span><span class="o">&gt;&lt;</span><span class="err">/passport-authorized-clients&gt;</span>
<span class="o">&lt;</span><span class="nx">passport</span><span class="o">-</span><span class="nx">personal</span><span class="o">-</span><span class="nx">access</span><span class="o">-</span><span class="nx">tokens</span><span class="o">&gt;&lt;</span><span class="err">/passport-personal-access-tokens&gt;</span>
</pre></div>

<p><a name="deploying-passport"></a></p>

<h3>Deploying Passport</h3>

<p>When deploying Passport to your production servers for the first time, you will likely need to run the <code>passport:keys</code> command. This command generates the encryption keys Passport needs in order to generate access token. The generated keys are not typically kept in source control:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">keys</span>
</pre></div>

<p>If necessary, you may define the path where Passport&#39;s keys should be loaded from. You may use the <code>Passport::loadKeysFrom</code> method to accomplish this:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">loadKeysFrom</span><span class="p">(</span><span class="s1">&#39;/secret-keys/oauth&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Additionally, you may publish Passport&#39;s configuration file using <code>php artisan vendor:publish --tag=passport-config</code>, which will then provide the option to load the encryption keys from your environment variables:</p>
<div class="highlight"><pre><span></span><span class="nx">PASSPORT_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;-----BEGIN RSA PRIVATE KEY-----</span>
<span class="s2">&lt;private key here&gt;</span>
<span class="s2">-----END RSA PRIVATE KEY-----&quot;</span>

<span class="nx">PASSPORT_PUBLIC_KEY</span><span class="o">=</span><span class="s2">&quot;-----BEGIN PUBLIC KEY-----</span>
<span class="s2">&lt;public key here&gt;</span>
<span class="s2">-----END PUBLIC KEY-----&quot;</span>
</pre></div>

<p><a name="migration-customization"></a></p>

<h3>Migration Customization</h3>

<p>If you are not going to use Passport&#39;s default migrations, you should call the <code>Passport::ignoreMigrations</code> method in the <code>register</code> method of your <code>AppServiceProvider</code>. You may export the default migrations using <code>php artisan vendor:publish --tag=passport-migrations</code>.</p>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p><a name="client-secret-hashing"></a></p>

<h3>Client Secret Hashing</h3>

<p>If you would like your client&#39;s secrets to be hashed when stored in your database, you should call the <code>Passport::hashClientSecrets</code> method in the <code>boot</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Passport</span><span class="o">::</span><span class="nx">hashClientSecrets</span><span class="p">();</span>
</pre></div>

<p>Once enabled, all of your client secrets will only be shown one time when your client is created. Since the plain-text client secret value is never stored in the database, it is not possible to recover if lost.</p>

<p><a name="token-lifetimes"></a></p>

<h3>Token Lifetimes</h3>

<p>By default, Passport issues long-lived access tokens that expire after one year. If you would like to configure a longer / shorter token lifetime, you may use the <code>tokensExpireIn</code>, <code>refreshTokensExpireIn</code>, and <code>personalAccessTokensExpireIn</code> methods. These methods should be called from the <code>boot</code> method of your <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">tokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">refreshTokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addDays</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">personalAccessTokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMonths</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} The <code>expires_at</code> columns on the Passport database tables are read-only and for display purposes only. When issuing tokens, Passport stores the expiration information within the signed and encrypted tokens. If you need to invalidate a token you should revoke it.</p>
</blockquote>

<p><a name="overriding-default-models"></a></p>

<h3>Overriding Default Models</h3>

<p>You are free to extend the models used internally by Passport:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Client</span> <span class="nx">as</span> <span class="nx">PassportClient</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Client</span> <span class="kr">extends</span> <span class="nx">PassportClient</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Then, you may instruct Passport to use your custom models via the <code>Passport</code> class:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">AuthCode</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">PersonalAccessClient</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Token</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">useTokenModel</span><span class="p">(</span><span class="nx">Token</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="nx">useClientModel</span><span class="p">(</span><span class="nx">Client</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="nx">useAuthCodeModel</span><span class="p">(</span><span class="nx">AuthCode</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="nx">usePersonalAccessClientModel</span><span class="p">(</span><span class="nx">PersonalAccessClient</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="issuing-access-tokens"></a></p>

<h2>Issuing Access Tokens</h2>

<p>Using OAuth2 with authorization codes is how most developers are familiar with OAuth2. When using authorization codes, a client application will redirect a user to your server where they will either approve or deny the request to issue an access token to the client.</p>

<p><a name="managing-clients"></a></p>

<h3>Managing Clients</h3>

<p>First, developers building applications that need to interact with your application&#39;s API will need to register their application with yours by creating a &quot;client&quot;. Typically, this consists of providing the name of their application and a URL that your application can redirect to after users approve their request for authorization.</p>

<h4>The <code>passport:client</code> Command</h4>

<p>The simplest way to create a client is using the <code>passport:client</code> Artisan command. This command may be used to create your own clients for testing your OAuth2 functionality. When you run the <code>client</code> command, Passport will prompt you for more information about your client and will provide you with a client ID and secret:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">client</span>
</pre></div>

<p><strong>Redirect URLs</strong></p>

<p>If you would like to allow multiple redirect URLs for your client, you may specify them using a comma-delimited list when prompted for the URL by the <code>passport:client</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="o">:</span><span class="c1">//example.com/callback,http://examplefoo.com/callback</span>
</pre></div>

<blockquote>
<p>{note} Any URL which contains commas must be encoded.</p>
</blockquote>

<h4>JSON API</h4>

<p>Since your users will not be able to utilize the <code>client</code> command, Passport provides a JSON API that you may use to create clients. This saves you the trouble of having to manually code controllers for creating, updating, and deleting clients.</p>

<p>However, you will need to pair Passport&#39;s JSON API with your own frontend to provide a dashboard for your users to manage their clients. Below, we&#39;ll review all of the API endpoints for managing clients. For convenience, we&#39;ll use <a href="https://github.com/axios/axios">Axios</a> to demonstrate making HTTP requests to the endpoints.</p>

<p>The JSON API is guarded by the <code>web</code> and <code>auth</code> middleware; therefore, it may only be called from your own application. It is not able to be called from an external source.</p>

<blockquote>
<p>{tip} If you don&#39;t want to implement the entire client management frontend yourself, you can use the <a href="#frontend-quickstart">frontend quickstart</a> to have a fully functional frontend in a matter of minutes.</p>
</blockquote>

<h4><code>GET /oauth/clients</code></h4>

<p>This route returns all of the clients for the authenticated user. This is primarily useful for listing all of the user&#39;s clients so that they may edit or delete them:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/clients&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4><code>POST /oauth/clients</code></h4>

<p>This route is used to create new clients. It requires two pieces of data: the client&#39;s <code>name</code> and a <code>redirect</code> URL. The <code>redirect</code> URL is where the user will be redirected after approving or denying a request for authorization.</p>

<p>When a client is created, it will be issued a client ID and client secret. These values will be used when requesting access tokens from your application. The client creation route will return the new client instance:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Client Name&#39;</span><span class="p">,</span>
    <span class="nx">redirect</span><span class="o">:</span> <span class="s1">&#39;http://example.com/callback&#39;</span>
<span class="p">};</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/oauth/clients&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span> <span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// List errors on response...</span>
    <span class="p">});</span>
</pre></div>

<h4><code>PUT /oauth/clients/{client-id}</code></h4>

<p>This route is used to update clients. It requires two pieces of data: the client&#39;s <code>name</code> and a <code>redirect</code> URL. The <code>redirect</code> URL is where the user will be redirected after approving or denying a request for authorization. The route will return the updated client instance:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;New Client Name&#39;</span><span class="p">,</span>
    <span class="nx">redirect</span><span class="o">:</span> <span class="s1">&#39;http://example.com/callback&#39;</span>
<span class="p">};</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/oauth/clients/&#39;</span> <span class="o">+</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span> <span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// List errors on response...</span>
    <span class="p">});</span>
</pre></div>

<h4><code>DELETE /oauth/clients/{client-id}</code></h4>

<p>This route is used to delete clients:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/clients/&#39;</span> <span class="o">+</span> <span class="nx">clientId</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
</pre></div>

<p><a name="requesting-tokens"></a></p>

<h3>Requesting Tokens</h3>

<h4>Redirecting For Authorization</h4>

<p>Once a client has been created, developers may use their client ID and secret to request an authorization code and access token from your application. First, the consuming application should make a redirect request to your application&#39;s <code>/oauth/authorize</code> route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>

    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="nx">$state</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/authorize?&#39;</span><span class="p">.</span><span class="nx">$query</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} Remember, the <code>/oauth/authorize</code> route is already defined by the <code>Passport::routes</code> method. You do not need to manually define this route.</p>
</blockquote>

<h4>Approving The Request</h4>

<p>When receiving authorization requests, Passport will automatically display a template to the user allowing them to approve or deny the authorization request. If they approve the request, they will be redirected back to the <code>redirect_uri</code> that was specified by the consuming application. The <code>redirect_uri</code> must match the <code>redirect</code> URL that was specified when the client was created.</p>

<p>If you would like to customize the authorization approval screen, you may publish Passport&#39;s views using the <code>vendor:publish</code> Artisan command. The published views will be placed in <code>resources/views/vendor/passport</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">tag</span><span class="o">=</span><span class="nx">passport</span><span class="o">-</span><span class="nx">views</span>
</pre></div>

<p>Sometimes you may wish to skip the authorization prompt, such as when authorizing a first-party client. You may accomplish this by <a href="#overriding-default-models">extending the <code>Client</code> model</a> and defining a <code>skipsAuthorization</code> method. If <code>skipsAuthorization</code> returns <code>true</code> the client will be approved and the user will be redirected back to the <code>redirect_uri</code> immediately:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models\Passport</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Passport\Client</span> <span class="k">as</span> <span class="nx">BaseClient</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Client</span> <span class="k">extends</span> <span class="nx">BaseClient</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Determine if the client should skip the authorization prompt.</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">skipsAuthorization</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">firstParty</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Converting Authorization Codes To Access Tokens</h4>

<p>If the user approves the authorization request, they will be redirected back to the consuming application. The consumer should first verify the <code>state</code> parameter against the value that was stored prior to the redirect. If the state parameter matches the consumer should issue a <code>POST</code> request to your application to request an access token. The request should include the authorization code that was issued by your application when the user approved the authorization request. In this example, we&#39;ll use the Guzzle HTTP library to make the <code>POST</code> request:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$state</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>

    <span class="nx">throw_unless</span><span class="p">(</span>
        <span class="nx">strlen</span><span class="p">(</span><span class="nx">$state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$state</span> <span class="o">===</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="kr">class</span>
    <span class="p">);</span>

    <span class="nx">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GuzzleHttp</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>

    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$http</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span> <span class="p">=&gt;</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">code</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">json_decode</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getBody</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>This <code>/oauth/token</code> route will return a JSON response containing <code>access_token</code>, <code>refresh_token</code>, and <code>expires_in</code> attributes. The <code>expires_in</code> attribute contains the number of seconds until the access token expires.</p>

<blockquote>
<p>{tip} Like the <code>/oauth/authorize</code> route, the <code>/oauth/token</code> route is defined for you by the <code>Passport::routes</code> method. There is no need to manually define this route. By default, this route is throttled using the settings of the <code>ThrottleRequests</code> middleware.</p>
</blockquote>

<h4>JSON API</h4>

<p>Passport also includes a JSON API for managing authorized access tokens. You may pair this with your own frontend to offer your users a dashboard for managing access tokens. For convenience, we&#39;ll use <a href="https://github.com/mzabriskie/axios">Axios</a> to demonstrate making HTTP requests to the endpoints. The JSON API is guarded by the <code>web</code> and <code>auth</code> middleware; therefore, it may only be called from your own application.</p>

<h4><code>GET /oauth/tokens</code></h4>

<p>This route returns all of the authorized access tokens that the authenticated user has created. This is primarily useful for listing all of the user&#39;s tokens so that they can revoke them:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/tokens&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4><code>DELETE /oauth/tokens/{token-id}</code></h4>

<p>This route may be used to revoke authorized access tokens and their related refresh tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/tokens/&#39;</span> <span class="o">+</span> <span class="nx">tokenId</span><span class="p">);</span>
</pre></div>

<p><a name="refreshing-tokens"></a></p>

<h3>Refreshing Tokens</h3>

<p>If your application issues short-lived access tokens, users will need to refresh their access tokens via the refresh token that was provided to them when the access token was issued. In this example, we&#39;ll use the Guzzle HTTP library to refresh the token:</p>
<div class="highlight"><pre><span></span><span class="nx">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GuzzleHttp</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$http</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;refresh_token&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;the-refresh-token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>

<span class="k">return</span> <span class="nx">json_decode</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getBody</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<p>This <code>/oauth/token</code> route will return a JSON response containing <code>access_token</code>, <code>refresh_token</code>, and <code>expires_in</code> attributes. The <code>expires_in</code> attribute contains the number of seconds until the access token expires.</p>

<p><a name="revoking-tokens"></a></p>

<h3>Revoking Tokens</h3>

<p>You may revoke a token by using the <code>revokeAccessToken</code> method on the <code>TokenRepository</code>. You may revoke a token&#39;s refresh tokens using the <code>revokeRefreshTokensByAccessTokenId</code> method on the <code>RefreshTokenRepository</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$tokenRepository</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;Laravel\Passport\TokenRepository&#39;</span><span class="p">);</span>
<span class="nx">$refreshTokenRepository</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;Laravel\Passport\RefreshTokenRepository&#39;</span><span class="p">);</span>

<span class="c1">// Revoke an access token...</span>
<span class="nx">$tokenRepository</span><span class="o">-&gt;</span><span class="nx">revokeAccessToken</span><span class="p">(</span><span class="nx">$tokenId</span><span class="p">);</span>

<span class="c1">// Revoke all of the token&#39;s refresh tokens...</span>
<span class="nx">$refreshTokenRepository</span><span class="o">-&gt;</span><span class="nx">revokeRefreshTokensByAccessTokenId</span><span class="p">(</span><span class="nx">$tokenId</span><span class="p">);</span>
</pre></div>

<p><a name="purging-tokens"></a></p>

<h3>Purging Tokens</h3>

<p>When tokens have been revoked or expired, you might want to purge them from the database. Passport ships with a command that can do this for you:</p>
<div class="highlight"><pre><span></span><span class="err">#</span> <span class="nx">Purge</span> <span class="nx">revoked</span> <span class="nx">and</span> <span class="nx">expired</span> <span class="nx">tokens</span> <span class="nx">and</span> <span class="nx">auth</span> <span class="nx">codes</span><span class="p">...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">purge</span>

<span class="err">#</span> <span class="nx">Only</span> <span class="nx">purge</span> <span class="nx">revoked</span> <span class="nx">tokens</span> <span class="nx">and</span> <span class="nx">auth</span> <span class="nx">codes</span><span class="p">...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">purge</span> <span class="o">--</span><span class="nx">revoked</span>

<span class="err">#</span> <span class="nx">Only</span> <span class="nx">purge</span> <span class="nx">expired</span> <span class="nx">tokens</span> <span class="nx">and</span> <span class="nx">auth</span> <span class="nx">codes</span><span class="p">...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">purge</span> <span class="o">--</span><span class="nx">expired</span>
</pre></div>

<p>You may also configure a <a href="/docs/%7B%7Bversion%7D%7D/scheduling">scheduled job</a> in your console <code>Kernel</code> class to automatically prune your tokens on a schedule:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define the application&#39;s command schedule.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Console\Scheduling\Schedule  $schedule</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">schedule</span><span class="p">(</span><span class="nx">Schedule</span> <span class="nx">$schedule</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;passport:purge&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="code-grant-pkce"></a></p>

<h2>Authorization Code Grant with PKCE</h2>

<p>The Authorization Code grant with &quot;Proof Key for Code Exchange&quot; (PKCE) is a secure way to authenticate single page applications or native applications to access your API. This grant should be used when you can&#39;t guarantee that the client secret will be stored confidentially or in order to mitigate the threat of having the authorization code intercepted by an attacker. A combination of a &quot;code verifier&quot; and a &quot;code challenge&quot; replaces the client secret when exchanging the authorization code for an access token.</p>

<p><a name="creating-a-auth-pkce-grant-client"></a></p>

<h3>Creating The Client</h3>

<p>Before your application can issue tokens via the authorization code grant with PKCE, you will need to create a PKCE-enabled client. You may do this using the <code>passport:client</code> command with the <code>--public</code> option:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">client</span> <span class="o">--</span><span class="kr">public</span>
</pre></div>

<p><a name="requesting-auth-pkce-grant-tokens"></a></p>

<h3>Requesting Tokens</h3>

<h4>Code Verifier &amp; Code Challenge</h4>

<p>As this authorization grant does not provide a client secret, developers will need to generate a combination of a code verifier and a code challenge in order to request a token.</p>

<p>The code verifier should be a random string of between 43 and 128 characters containing letters, numbers and  <code>&quot;-&quot;</code>, <code>&quot;.&quot;</code>, <code>&quot;_&quot;</code>, <code>&quot;~&quot;</code>, as defined in the <a href="https://tools.ietf.org/html/rfc7636">RFC 7636 specification</a>.</p>

<p>The code challenge should be a Base64 encoded string with URL and filename-safe characters. The trailing <code>&#39;=&#39;</code> characters should be removed and no line breaks, whitespace, or other additional characters should be present.</p>
<div class="highlight"><pre><span></span><span class="nx">$encoded</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nx">$code_verifier</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>

<span class="nx">$codeChallenge</span> <span class="o">=</span> <span class="nx">strtr</span><span class="p">(</span><span class="nx">rtrim</span><span class="p">(</span><span class="nx">$encoded</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="s1">&#39;+/&#39;</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">);</span>
</pre></div>

<h4>Redirecting For Authorization</h4>

<p>Once a client has been created, you may use the client ID and the generated code verifier and code challenge to request an authorization code and access token from your application. First, the consuming application should make a redirect request to your application&#39;s <code>/oauth/authorize</code> route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>

    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">,</span> <span class="nx">$code_verifier</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">128</span><span class="p">));</span>

    <span class="nx">$codeChallenge</span> <span class="o">=</span> <span class="nx">strtr</span><span class="p">(</span><span class="nx">rtrim</span><span class="p">(</span>
        <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nx">$code_verifier</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span>
    <span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="s1">&#39;+/&#39;</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">);</span>

    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="nx">$state</span><span class="p">,</span>
        <span class="s1">&#39;code_challenge&#39;</span> <span class="p">=&gt;</span> <span class="nx">$codeChallenge</span><span class="p">,</span>
        <span class="s1">&#39;code_challenge_method&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;S256&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/authorize?&#39;</span><span class="p">.</span><span class="nx">$query</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Converting Authorization Codes To Access Tokens</h4>

<p>If the user approves the authorization request, they will be redirected back to the consuming application. The consumer should verify the <code>state</code> parameter against the value that was stored prior to the redirect, as in the standard Authorization Code Grant.</p>

<p>If the state parameter matches, the consumer should issue a <code>POST</code> request to your application to request an access token. The request should include the authorization code that was issued by your application when the user approved the authorization request along with the originally generated code verifier:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$state</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>

    <span class="nx">$codeVerifier</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">);</span>

    <span class="nx">throw_unless</span><span class="p">(</span>
        <span class="nx">strlen</span><span class="p">(</span><span class="nx">$state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$state</span> <span class="o">===</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">state</span><span class="p">,</span>
        <span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="kr">class</span>
    <span class="p">);</span>

    <span class="nx">$response</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">GuzzleHttp</span><span class="err">\</span><span class="nx">Client</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code_verifier&#39;</span> <span class="p">=&gt;</span> <span class="nx">$codeVerifier</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span> <span class="p">=&gt;</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">code</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">json_decode</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getBody</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="password-grant-tokens"></a></p>

<h2>Password Grant Tokens</h2>

<p>The OAuth2 password grant allows your other first-party clients, such as a mobile application, to obtain an access token using an e-mail address / username and password. This allows you to issue access tokens securely to your first-party clients without requiring your users to go through the entire OAuth2 authorization code redirect flow.</p>

<p><a name="creating-a-password-grant-client"></a></p>

<h3>Creating A Password Grant Client</h3>

<p>Before your application can issue tokens via the password grant, you will need to create a password grant client. You may do this using the <code>passport:client</code> command with the <code>--password</code> option. If you have already run the <code>passport:install</code> command, you do not need to run this command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">client</span> <span class="o">--</span><span class="nx">password</span>
</pre></div>

<p><a name="requesting-password-grant-tokens"></a></p>

<h3>Requesting Tokens</h3>

<p>Once you have created a password grant client, you may request an access token by issuing a <code>POST</code> request to the <code>/oauth/token</code> route with the user&#39;s email address and password. Remember, this route is already registered by the <code>Passport::routes</code> method so there is no need to define it manually. If the request is successful, you will receive an <code>access_token</code> and <code>refresh_token</code> in the JSON response from the server:</p>
<div class="highlight"><pre><span></span><span class="nx">$http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GuzzleHttp</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$http</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;my-password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>

<span class="k">return</span> <span class="nx">json_decode</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getBody</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} Remember, access tokens are long-lived by default. However, you are free to <a href="#configuration">configure your maximum access token lifetime</a> if needed.</p>
</blockquote>

<p><a name="requesting-all-scopes"></a></p>

<h3>Requesting All Scopes</h3>

<p>When using the password grant or client credentials grant, you may wish to authorize the token for all of the scopes supported by your application. You can do this by requesting the <code>*</code> scope. If you request the <code>*</code> scope, the <code>can</code> method on the token instance will always return <code>true</code>. This scope may only be assigned to a token that is issued using the <code>password</code> or <code>client_credentials</code> grant:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$http</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;my-password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="customizing-the-user-provider"></a></p>

<h3>Customizing The User Provider</h3>

<p>If your application uses more than one <a href="/docs/%7B%7Bversion%7D%7D/authentication#introduction">authentication user provider</a>, you may specify which user provider the password grant client uses by providing a <code>--provider</code> option when creating the client via the <code>artisan passport:client --password</code> command. The given provider name should match a valid provider defined in your <code>config/auth.php</code> configuration file. You can then <a href="#via-middleware">protect your route using middleware</a> to ensure that only users from the guard&#39;s specified provider are authorized.</p>

<p><a name="customizing-the-username-field"></a></p>

<h3>Customizing The Username Field</h3>

<p>When authenticating using the password grant, Passport will use the <code>email</code> attribute of your model as the &quot;username&quot;. However, you may customize this behavior by defining a <code>findForPassport</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Find the user instance for the given username.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $username</span>
<span class="sd">     * @return \App\Models\User</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findForPassport</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-password-validation"></a></p>

<h3>Customizing The Password Validation</h3>

<p>When authenticating using the password grant, Passport will use the <code>password</code> attribute of your model to validate the given password. If your model does not have a <code>password</code> attribute or you wish to customize the password validation logic, you can define a <code>validateForPassportPasswordGrant</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Validate the password of the user for the Passport password grant.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $password</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateForPassportPasswordGrant</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">check</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="implicit-grant-tokens"></a></p>

<h2>Implicit Grant Tokens</h2>

<p>The implicit grant is similar to the authorization code grant; however, the token is returned to the client without exchanging an authorization code. This grant is most commonly used for JavaScript or mobile applications where the client credentials can&#39;t be securely stored. To enable the grant, call the <code>enableImplicitGrant</code> method in your <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">enableImplicitGrant</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Once a grant has been enabled, developers may use their client ID to request an access token from your application. The consuming application should make a redirect request to your application&#39;s <code>/oauth/authorize</code> route like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>

    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="nx">$state</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/authorize?&#39;</span><span class="p">.</span><span class="nx">$query</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} Remember, the <code>/oauth/authorize</code> route is already defined by the <code>Passport::routes</code> method. You do not need to manually define this route.</p>
</blockquote>

<p><a name="client-credentials-grant-tokens"></a></p>

<h2>Client Credentials Grant Tokens</h2>

<p>The client credentials grant is suitable for machine-to-machine authentication. For example, you might use this grant in a scheduled job which is performing maintenance tasks over an API.</p>

<p>Before your application can issue tokens via the client credentials grant, you will need to create a client credentials grant client. You may do this using the <code>--client</code> option of the <code>passport:client</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">client</span> <span class="o">--</span><span class="nx">client</span>
</pre></div>

<p>Next, to use this grant type, you need to add the <code>CheckClientCredentials</code> middleware to the <code>$routeMiddleware</code> property of your <code>app/Http/Kernel.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CheckClientCredentials</span><span class="p">;</span>

<span class="kr">protected</span> <span class="nx">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">CheckClientCredentials</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Then, attach the middleware to a route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;client&#39;</span><span class="p">);</span>
</pre></div>

<p>To restrict access to the route to specific scopes you may provide a comma-delimited list of the required scopes when attaching the <code>client</code> middleware to the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;client:check-status,your-scope&#39;</span><span class="p">);</span>
</pre></div>

<h3>Retrieving Tokens</h3>

<p>To retrieve a token using this grant type, make a request to the <code>oauth/token</code> endpoint:</p>
<div class="highlight"><pre><span></span><span class="nx">$guzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GuzzleHttp</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>

<span class="nx">$response</span> <span class="o">=</span> <span class="nx">$guzzle</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;form_params&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;grant_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client_credentials&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;your-scope&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>

<span class="k">return</span> <span class="nx">json_decode</span><span class="p">((</span><span class="nx">string</span><span class="p">)</span> <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">getBody</span><span class="p">(),</span> <span class="kc">true</span><span class="p">)[</span><span class="s1">&#39;access_token&#39;</span><span class="p">];</span>
</pre></div>

<p><a name="personal-access-tokens"></a></p>

<h2>Personal Access Tokens</h2>

<p>Sometimes, your users may want to issue access tokens to themselves without going through the typical authorization code redirect flow. Allowing users to issue tokens to themselves via your application&#39;s UI can be useful for allowing users to experiment with your API or may serve as a simpler approach to issuing access tokens in general.</p>

<p><a name="creating-a-personal-access-client"></a></p>

<h3>Creating A Personal Access Client</h3>

<p>Before your application can issue personal access tokens, you will need to create a personal access client. You may do this using the <code>passport:client</code> command with the <code>--personal</code> option. If you have already run the <code>passport:install</code> command, you do not need to run this command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">passport</span><span class="o">:</span><span class="nx">client</span> <span class="o">--</span><span class="nx">personal</span>
</pre></div>

<p>After creating your personal access client, place the client&#39;s ID and plain-text secret value in your application&#39;s <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">PASSPORT_PERSONAL_ACCESS_CLIENT_ID</span><span class="o">=</span><span class="nx">client</span><span class="o">-</span><span class="nx">id</span><span class="o">-</span><span class="nx">value</span>
<span class="nx">PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET</span><span class="o">=</span><span class="nx">unhashed</span><span class="o">-</span><span class="nx">client</span><span class="o">-</span><span class="nx">secret</span><span class="o">-</span><span class="nx">value</span>
</pre></div>

<p>Next, you should register these values by placing the following calls to <code>Passport::personalAccessClientId</code> and <code>Passport::personalAccessClientSecret</code> within the <code>boot</code> method of your <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">personalAccessClientId</span><span class="p">(</span>
        <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;passport.personal_access_client.id&#39;</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">personalAccessClientSecret</span><span class="p">(</span>
        <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;passport.personal_access_client.secret&#39;</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="managing-personal-access-tokens"></a></p>

<h3>Managing Personal Access Tokens</h3>

<p>Once you have created a personal access client, you may issue tokens for a given user using the <code>createToken</code> method on the <code>User</code> model instance. The <code>createToken</code> method accepts the name of the token as its first argument and an optional array of <a href="#token-scopes">scopes</a> as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Creating a token without scopes...</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="s1">&#39;Token Name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">accessToken</span><span class="p">;</span>

<span class="c1">// Creating a token with scopes...</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="s1">&#39;My Token&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;place-orders&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">accessToken</span><span class="p">;</span>
</pre></div>

<h4>JSON API</h4>

<p>Passport also includes a JSON API for managing personal access tokens. You may pair this with your own frontend to offer your users a dashboard for managing personal access tokens. Below, we&#39;ll review all of the API endpoints for managing personal access tokens. For convenience, we&#39;ll use <a href="https://github.com/mzabriskie/axios">Axios</a> to demonstrate making HTTP requests to the endpoints.</p>

<p>The JSON API is guarded by the <code>web</code> and <code>auth</code> middleware; therefore, it may only be called from your own application. It is not able to be called from an external source.</p>

<blockquote>
<p>{tip} If you don&#39;t want to implement the personal access token frontend yourself, you can use the <a href="#frontend-quickstart">frontend quickstart</a> to have a fully functional frontend in a matter of minutes.</p>
</blockquote>

<h4><code>GET /oauth/scopes</code></h4>

<p>This route returns all of the <a href="#token-scopes">scopes</a> defined for your application. You may use this route to list the scopes a user may assign to a personal access token:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/scopes&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4><code>GET /oauth/personal-access-tokens</code></h4>

<p>This route returns all of the personal access tokens that the authenticated user has created. This is primarily useful for listing all of the user&#39;s tokens so that they may edit or revoke them:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4><code>POST /oauth/personal-access-tokens</code></h4>

<p>This route creates new personal access tokens. It requires two pieces of data: the token&#39;s <code>name</code> and the <code>scopes</code> that should be assigned to the token:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Token Name&#39;</span><span class="p">,</span>
    <span class="nx">scopes</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">};</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span> <span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// List errors on response...</span>
    <span class="p">});</span>
</pre></div>

<h4><code>DELETE /oauth/personal-access-tokens/{token-id}</code></h4>

<p>This route may be used to revoke personal access tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens/&#39;</span> <span class="o">+</span> <span class="nx">tokenId</span><span class="p">);</span>
</pre></div>

<p><a name="protecting-routes"></a></p>

<h2>Protecting Routes</h2>

<p><a name="via-middleware"></a></p>

<h3>Via Middleware</h3>

<p>Passport includes an <a href="/docs/%7B%7Bversion%7D%7D/authentication#adding-custom-guards">authentication guard</a> that will validate access tokens on incoming requests. Once you have configured the <code>api</code> guard to use the <code>passport</code> driver, you only need to specify the <code>auth:api</code> middleware on any routes that require a valid access token:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:api&#39;</span><span class="p">);</span>
</pre></div>

<h4>Multiple Authentication Guards</h4>

<p>If your application authenticates different types of users that perhaps use entirely different Eloquent models, you will likely need to define a guard configuration for each user provider type in your application. This allows you to protect requests intended for specific user providers. For example, given the following guard configuration the <code>config/auth.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
    <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
<span class="p">],</span>

<span class="s1">&#39;api-customers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
    <span class="s1">&#39;provider&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;customers&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>The following route will utilize the <code>api-customers</code> guard, which uses the <code>customers</code> user provider, to authenticate incoming requests:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/customer&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:api-customers&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} For more information on using multiple user providers with Passport, please consult the <a href="#customizing-the-user-provider">password grant documentation</a>.</p>
</blockquote>

<p><a name="passing-the-access-token"></a></p>

<h3>Passing The Access Token</h3>

<p>When calling routes that are protected by Passport, your application&#39;s API consumers should specify their access token as a <code>Bearer</code> token in the <code>Authorization</code> header of their request. For example, when using the Guzzle HTTP library:</p>
<div class="highlight"><pre><span></span><span class="nx">$response</span> <span class="o">=</span> <span class="nx">$client</span><span class="o">-&gt;</span><span class="nx">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/user&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;headers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;Accept&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Authorization&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Bearer &#39;</span><span class="p">.</span><span class="nx">$accessToken</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="token-scopes"></a></p>

<h2>Token Scopes</h2>

<p>Scopes allow your API clients to request a specific set of permissions when requesting authorization to access an account. For example, if you are building an e-commerce application, not all API consumers will need the ability to place orders. Instead, you may allow the consumers to only request authorization to access order shipment statuses. In other words, scopes allow your application&#39;s users to limit the actions a third-party application can perform on their behalf.</p>

<p><a name="defining-scopes"></a></p>

<h3>Defining Scopes</h3>

<p>You may define your API&#39;s scopes using the <code>Passport::tokensCan</code> method in the <code>boot</code> method of your <code>AuthServiceProvider</code>. The <code>tokensCan</code> method accepts an array of scope names and scope descriptions. The scope description may be anything you wish and will be displayed to users on the authorization approval screen:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="p">;</span>

<span class="nx">Passport</span><span class="o">::</span><span class="nx">tokensCan</span><span class="p">([</span>
    <span class="s1">&#39;place-orders&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Place orders&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check-status&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Check order status&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="default-scope"></a></p>

<h3>Default Scope</h3>

<p>If a client does not request any specific scopes, you may configure your Passport server to attach a default scope to the token using the <code>setDefaultScope</code> method. Typically, you should call this method from the <code>boot</code> method of your <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="p">;</span>

<span class="nx">Passport</span><span class="o">::</span><span class="nx">setDefaultScope</span><span class="p">([</span>
    <span class="s1">&#39;check-status&#39;</span><span class="p">,</span>
    <span class="s1">&#39;place-orders&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="assigning-scopes-to-tokens"></a></p>

<h3>Assigning Scopes To Tokens</h3>

<h4>When Requesting Authorization Codes</h4>

<p>When requesting an access token using the authorization code grant, consumers should specify their desired scopes as the <code>scope</code> query string parameter. The <code>scope</code> parameter should be a space-delimited list of scopes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$query</span> <span class="o">=</span> <span class="nx">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;place-orders check-status&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://your-app.com/oauth/authorize?&#39;</span><span class="p">.</span><span class="nx">$query</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>When Issuing Personal Access Tokens</h4>

<p>If you are issuing personal access tokens using the <code>User</code> model&#39;s <code>createToken</code> method, you may pass the array of desired scopes as the second argument to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="s1">&#39;My Token&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;place-orders&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">accessToken</span><span class="p">;</span>
</pre></div>

<p><a name="checking-scopes"></a></p>

<h3>Checking Scopes</h3>

<p>Passport includes two middleware that may be used to verify that an incoming request is authenticated with a token that has been granted a given scope. To get started, add the following middleware to the <code>$routeMiddleware</code> property of your <code>app/Http/Kernel.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;scopes&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CheckScopes</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="s1">&#39;scope&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CheckForAnyScope</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
</pre></div>

<h4>Check For All Scopes</h4>

<p>The <code>scopes</code> middleware may be assigned to a route to verify that the incoming request&#39;s access token has <em>all</em> of the listed scopes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Access token has both &quot;check-status&quot; and &quot;place-orders&quot; scopes...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;auth:api&#39;</span><span class="p">,</span> <span class="s1">&#39;scopes:check-status,place-orders&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Check For Any Scopes</h4>

<p>The <code>scope</code> middleware may be assigned to a route to verify that the incoming request&#39;s access token has <em>at least one</em> of the listed scopes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Access token has either &quot;check-status&quot; or &quot;place-orders&quot; scope...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;auth:api&#39;</span><span class="p">,</span> <span class="s1">&#39;scope:check-status,place-orders&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Checking Scopes On A Token Instance</h4>

<p>Once an access token authenticated request has entered your application, you may still check if the token has a given scope using the <code>tokenCan</code> method on the authenticated <code>User</code> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">tokenCan</span><span class="p">(</span><span class="s1">&#39;place-orders&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h4>Additional Scope Methods</h4>

<p>The <code>scopeIds</code> method will return an array of all defined IDs / names:</p>
<div class="highlight"><pre><span></span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="o">::</span><span class="nx">scopeIds</span><span class="p">();</span>
</pre></div>

<p>The <code>scopes</code> method will return an array of all defined scopes as instances of <code>Laravel\Passport\Scope</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="o">::</span><span class="nx">scopes</span><span class="p">();</span>
</pre></div>

<p>The <code>scopesFor</code> method will return an array of <code>Laravel\Passport\Scope</code> instances matching the given IDs / names:</p>
<div class="highlight"><pre><span></span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="o">::</span><span class="nx">scopesFor</span><span class="p">([</span><span class="s1">&#39;place-orders&#39;</span><span class="p">,</span> <span class="s1">&#39;check-status&#39;</span><span class="p">]);</span>
</pre></div>

<p>You may determine if a given scope has been defined using the <code>hasScope</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="o">::</span><span class="nx">hasScope</span><span class="p">(</span><span class="s1">&#39;place-orders&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="consuming-your-api-with-javascript"></a></p>

<h2>Consuming Your API With JavaScript</h2>

<p>When building an API, it can be extremely useful to be able to consume your own API from your JavaScript application. This approach to API development allows your own application to consume the same API that you are sharing with the world. The same API may be consumed by your web application, mobile applications, third-party applications, and any SDKs that you may publish on various package managers.</p>

<p>Typically, if you want to consume your API from your JavaScript application, you would need to manually send an access token to the application and pass it with each request to your application. However, Passport includes a middleware that can handle this for you. All you need to do is add the <code>CreateFreshApiToken</code> middleware to your <code>web</code> middleware group in your <code>app/Http/Kernel.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;web&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// Other middleware...</span>
    <span class="err">\</span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">CreateFreshApiToken</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<blockquote>
<p>{note} You should ensure that the <code>CreateFreshApiToken</code> middleware is the last middleware listed in your middleware stack.</p>
</blockquote>

<p>This Passport middleware will attach a <code>laravel_token</code> cookie to your outgoing responses. This cookie contains an encrypted JWT that Passport will use to authenticate API requests from your JavaScript application. The JWT has a lifetime equal to your <code>session.lifetime</code> configuration value. Now, you may make requests to your application&#39;s API without explicitly passing an access token:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/user&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

<h4>Customizing The Cookie Name</h4>

<p>If needed, you can customize the <code>laravel_token</code> cookie&#39;s name using the <code>Passport::cookie</code> method. Typically, this method should be called from the <code>boot</code> method of your <code>AuthServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any authentication / authorization services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">registerPolicies</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">routes</span><span class="p">();</span>

    <span class="nx">Passport</span><span class="o">::</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;custom_name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>CSRF Protection</h4>

<p>When using this method of authentication, you will need to ensure a valid CSRF token header is included in your requests. The default Laravel JavaScript scaffolding includes an Axios instance, which will automatically use the encrypted <code>XSRF-TOKEN</code> cookie value to send a <code>X-XSRF-TOKEN</code> header on same-origin requests.</p>

<blockquote>
<p>{tip} If you choose to send the <code>X-CSRF-TOKEN</code> header instead of <code>X-XSRF-TOKEN</code>, you will need to use the unencrypted token provided by <code>csrf_token()</code>.</p>
</blockquote>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Passport raises events when issuing access tokens and refresh tokens. You may use these events to prune or revoke other access tokens in your database. You may attach listeners to these events in your application&#39;s <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Laravel\Passport\Events\AccessTokenCreated&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\RevokeOldTokens&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;Laravel\Passport\Events\RefreshTokenCreated&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\PruneOldTokens&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p><a name="testing"></a></p>

<h2>Testing</h2>

<p>Passport&#39;s <code>actingAs</code> method may be used to specify the currently authenticated user as well as its scopes. The first argument given to the <code>actingAs</code> method is the user instance and the second is an array of scopes that should be granted to the user&#39;s token:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testServerCreation</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="nx">actingAs</span><span class="p">(</span>
        <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(),</span>
        <span class="p">[</span><span class="s1">&#39;create-servers&#39;</span><span class="p">]</span>
    <span class="p">);</span>

    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/create-server&#39;</span><span class="p">);</span>

    <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Passport&#39;s <code>actingAsClient</code> method may be used to specify the currently authenticated client as well as its scopes. The first argument given to the <code>actingAsClient</code> method is the client instance and the second is an array of scopes that should be granted to the client&#39;s token:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Client</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Passport</span><span class="err">\</span><span class="nx">Passport</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">testGetOrders</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="nx">actingAsClient</span><span class="p">(</span>
        <span class="nx">Client</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(),</span>
        <span class="p">[</span><span class="s1">&#39;check-status&#39;</span><span class="p">]</span>
    <span class="p">);</span>

    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/orders&#39;</span><span class="p">);</span>

    <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Resetting Passwords</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#resetting-database">Database Considerations</a></li>
<li><a href="#resetting-routing">Routing</a></li>
<li><a href="#resetting-views">Views</a></li>
<li><a href="#after-resetting-passwords">After Resetting Passwords</a></li>
<li><a href="#password-customization">Customization</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<blockquote>
<p>{tip} <strong>Want to get started fast?</strong> Install the <code>laravel/ui</code> Composer package and run <code>php artisan ui vue --auth</code> in a fresh Laravel application. After migrating your database, navigate your browser to <code>http://your-app.test/register</code> or any other URL that is assigned to your application. This single command will take care of scaffolding your entire authentication system, including resetting passwords!</p>
</blockquote>

<p>Most web applications provide a way for users to reset their forgotten passwords. Rather than forcing you to re-implement this on each application, Laravel provides convenient methods for sending password reminders and performing password resets.</p>

<blockquote>
<p>{note} Before using the password reset features of Laravel, your user must use the <code>Illuminate\Notifications\Notifiable</code> trait.</p>
</blockquote>

<p><a name="resetting-database"></a></p>

<h2>Database Considerations</h2>

<p>To get started, verify that your <code>App\Models\User</code> model implements the <code>Illuminate\Contracts\Auth\CanResetPassword</code> contract. The <code>App\Models\User</code> model included with the framework already implements this interface, and uses the <code>Illuminate\Auth\Passwords\CanResetPassword</code> trait to include the methods needed to implement the interface.</p>

<h4>Generating The Reset Token Table Migration</h4>

<p>Next, a table must be created to store the password reset tokens. The migration for this table is included in the <code>laravel/ui</code> Composer package. After installing the <code>laravel/ui</code> package, you may use the <code>migrate</code> command to create the password reset token database table:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="resetting-routing"></a></p>

<h2>Routing</h2>

<p>Laravel includes <code>Auth\ForgotPasswordController</code> and <code>Auth\ResetPasswordController</code> classes that contains the logic necessary to e-mail password reset links and reset user passwords. All of the routes needed to perform password resets may be generated using the <code>laravel/ui</code> Composer package:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p><a name="resetting-views"></a></p>

<h2>Views</h2>

<p>To generate all of the necessary view for resetting passwords, you may use the <code>laravel/ui</code> Composer package:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p>These views are placed in <code>resources/views/auth/passwords</code>. You are free to customize them as needed for your application.</p>

<p><a name="after-resetting-passwords"></a></p>

<h2>After Resetting Passwords</h2>

<p>Once you have defined the routes and views to reset your user&#39;s passwords, you may access the route in your browser at <code>/password/reset</code>. The <code>ForgotPasswordController</code> included with the framework already includes the logic to send the password reset link e-mails, while the <code>ResetPasswordController</code> includes the logic to reset user passwords.</p>

<p>After a password is reset, the user will automatically be logged into the application and redirected to <code>/home</code>. You can customize the post password reset redirect location by defining a <code>redirectTo</code> property on the <code>ResetPasswordController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">;</span>
</pre></div>

<blockquote>
<p>{note} By default, password reset tokens expire after one hour. You may change this via the password reset <code>expire</code> option in your <code>config/auth.php</code> file.</p>
</blockquote>

<p><a name="password-customization"></a></p>

<h2>Customization</h2>

<h4>Authentication Guard Customization</h4>

<p>In your <code>auth.php</code> configuration file, you may configure multiple &quot;guards&quot;, which may be used to define authentication behavior for multiple user tables. You can customize the included <code>ResetPasswordController</code> to use the guard of your choice by overriding the <code>guard</code> method on the controller. This method should return a guard instance:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Auth</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the guard to be used during password reset.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \Illuminate\Contracts\Auth\StatefulGuard</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">guard</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Auth</span><span class="o">::</span><span class="nx">guard</span><span class="p">(</span><span class="s1">&#39;guard-name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Password Broker Customization</h4>

<p>In your <code>auth.php</code> configuration file, you may configure multiple password &quot;brokers&quot;, which may be used to reset passwords on multiple user tables. You can customize the included <code>ForgotPasswordController</code> and <code>ResetPasswordController</code> to use the broker of your choice by overriding the <code>broker</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Password</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the broker to be used during password reset.</span>
<span class="cm"> *</span>
<span class="cm"> * @return PasswordBroker</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">broker</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">Password</span><span class="o">::</span><span class="nx">broker</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>Reset Email Customization</h4>

<p>You may easily modify the notification class used to send the password reset link to the user. To get started, override the <code>sendPasswordResetNotification</code> method on your <code>User</code> model. Within this method, you may send the notification using any notification class you choose. The password reset <code>$token</code> is the first argument received by the method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Send the password reset notification.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $token</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">sendPasswordResetNotification</span><span class="p">(</span><span class="nx">$token</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">ResetPasswordNotification</span><span class="p">(</span><span class="nx">$token</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Service Providers</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-service-providers">Writing Service Providers</a>

<ul>
<li><a href="#the-register-method">The Register Method</a></li>
<li><a href="#the-boot-method">The Boot Method</a></li>
</ul></li>
<li><a href="#registering-providers">Registering Providers</a></li>
<li><a href="#deferred-providers">Deferred Providers</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Service providers are the central place of all Laravel application bootstrapping. Your own application, as well as all of Laravel&#39;s core services are bootstrapped via service providers.</p>

<p>But, what do we mean by &quot;bootstrapped&quot;? In general, we mean <strong>registering</strong> things, including registering service container bindings, event listeners, middleware, and even routes. Service providers are the central place to configure your application.</p>

<p>If you open the <code>config/app.php</code> file included with Laravel, you will see a <code>providers</code> array. These are all of the service provider classes that will be loaded for your application. Note that many of these are &quot;deferred&quot; providers, meaning they will not be loaded on every request, but only when the services they provide are actually needed.</p>

<p>In this overview you will learn how to write your own service providers and register them with your Laravel application.</p>

<p><a name="writing-service-providers"></a></p>

<h2>Writing Service Providers</h2>

<p>All service providers extend the <code>Illuminate\Support\ServiceProvider</code> class. Most service providers contain a <code>register</code> and a <code>boot</code> method. Within the <code>register</code> method, you should <strong>only bind things into the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a></strong>. You should never attempt to register any event listeners, routes, or any other piece of functionality within the <code>register</code> method.</p>

<p>The Artisan CLI can generate a new provider via the <code>make:provider</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">provider</span> <span class="nx">RiakServiceProvider</span>
</pre></div>

<p><a name="the-register-method"></a></p>

<h3>The Register Method</h3>

<p>As mentioned previously, within the <code>register</code> method, you should only bind things into the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>. You should never attempt to register any event listeners, routes, or any other piece of functionality within the <code>register</code> method. Otherwise, you may accidentally use a service that is provided by a service provider which has not loaded yet.</p>

<p>Let&#39;s take a look at a basic service provider. Within any of your service provider methods, you always have access to the <code>$app</code> property which provides access to the service container:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="nx">Connection</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;riak&#39;</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This service provider only defines a <code>register</code> method, and uses that method to define an implementation of <code>Riak\Connection</code> in the service container. If you don&#39;t understand how the service container works, check out <a href="/docs/%7B%7Bversion%7D%7D/container">its documentation</a>.</p>

<h4>The <code>bindings</code> And <code>singletons</code> Properties</h4>

<p>If your service provider registers many simple bindings, you may wish to use the <code>bindings</code> and <code>singletons</code> properties instead of manually registering each container binding. When the service provider is loaded by the framework, it will automatically check for these properties and register their bindings:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Contracts\DowntimeNotifier</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Contracts\ServerProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\DigitalOceanServerProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\PingdomDowntimeNotifier</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\ServerToolsProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * All of the container bindings that should be registered.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$bindings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">ServerProvider</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="nx">DigitalOceanServerProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * All of the container singletons that should be registered.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$singletons</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">DowntimeNotifier</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="nx">PingdomDowntimeNotifier</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">ServerProvider</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="nx">ServerToolsProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="the-boot-method"></a></p>

<h3>The Boot Method</h3>

<p>So, what if we need to register a <a href="/docs/%7B%7Bversion%7D%7D/views#view-composers">view composer</a> within our service provider? This should be done within the <code>boot</code> method. <strong>This method is called after all other service providers have been registered</strong>, meaning you have access to all other services that have been registered by the framework:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ComposerServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Boot Method Dependency Injection</h4>

<p>You may type-hint dependencies for your service provider&#39;s <code>boot</code> method. The <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> will automatically inject any dependencies you need:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Contracts</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">ResponseFactory</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">(</span><span class="nx">ResponseFactory</span> <span class="nx">$response</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="registering-providers"></a></p>

<h2>Registering Providers</h2>

<p>All service providers are registered in the <code>config/app.php</code> configuration file. This file contains a <code>providers</code> array where you can list the class names of your service providers. By default, a set of Laravel core service providers are listed in this array. These providers bootstrap the core Laravel components, such as the mailer, queue, cache, and others.</p>

<p>To register your provider, add it to the array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;providers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="c1">// Other Service Providers</span>

    <span class="nx">App</span><span class="err">\</span><span class="nx">Providers</span><span class="err">\</span><span class="nx">ComposerServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="deferred-providers"></a></p>

<h2>Deferred Providers</h2>

<p>If your provider is <strong>only</strong> registering bindings in the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, you may choose to defer its registration until one of the registered bindings is actually needed. Deferring the loading of such a provider will improve the performance of your application, since it is not loaded from the filesystem on every request.</p>

<p>Laravel compiles and stores a list of all of the services supplied by deferred service providers, along with the name of its service provider class. Then, only when you attempt to resolve one of these services does Laravel load the service provider.</p>

<p>To defer the loading of a provider, implement the <code>\Illuminate\Contracts\Support\DeferrableProvider</code> interface and define a <code>provides</code> method. The <code>provides</code> method should return the service container bindings registered by the provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Support\DeferrableProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Riak\Connection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RiakServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span> <span class="k">implements</span> <span class="nx">DeferrableProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="nx">Connection</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">][</span><span class="s1">&#39;riak&#39;</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the services provided by the provider.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nx">Connection</span><span class="o">::</span><span class="na">class</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Query Builder</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#retrieving-results">Retrieving Results</a>

<ul>
<li><a href="#chunking-results">Chunking Results</a></li>
<li><a href="#aggregates">Aggregates</a></li>
</ul></li>
<li><a href="#selects">Selects</a></li>
<li><a href="#raw-expressions">Raw Expressions</a></li>
<li><a href="#joins">Joins</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#where-clauses">Where Clauses</a>

<ul>
<li><a href="#parameter-grouping">Parameter Grouping</a></li>
<li><a href="#where-exists-clauses">Where Exists Clauses</a></li>
<li><a href="#subquery-where-clauses">Subquery Where Clauses</a></li>
<li><a href="#json-where-clauses">JSON Where Clauses</a></li>
</ul></li>
<li><a href="#ordering-grouping-limit-and-offset">Ordering, Grouping, Limit &amp; Offset</a></li>
<li><a href="#conditional-clauses">Conditional Clauses</a></li>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a>

<ul>
<li><a href="#updating-json-columns">Updating JSON Columns</a></li>
<li><a href="#increment-and-decrement">Increment &amp; Decrement</a></li>
</ul></li>
<li><a href="#deletes">Deletes</a></li>
<li><a href="#pessimistic-locking">Pessimistic Locking</a></li>
<li><a href="#debugging">Debugging</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel&#39;s database query builder provides a convenient, fluent interface to creating and running database queries. It can be used to perform most database operations in your application and works on all supported database systems.</p>

<p>The Laravel query builder uses PDO parameter binding to protect your application against SQL injection attacks. There is no need to clean strings being passed as bindings.</p>

<blockquote>
<p>{note} PDO does not support binding column names. Therefore, you should never allow user input to dictate the column names referenced by your queries, including &quot;order by&quot; columns, etc. If you must allow the user to select certain columns to query against, always validate the column names against a white-list of allowed columns.</p>
</blockquote>

<p><a name="retrieving-results"></a></p>

<h2>Retrieving Results</h2>

<h4>Retrieving All Rows From A Table</h4>

<p>You may use the <code>table</code> method on the <code>DB</code> facade to begin a query. The <code>table</code> method returns a fluent query builder instance for the given table, allowing you to chain more constraints onto the query and then finally get the results using the <code>get</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show a list of all of the application&#39;s users.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>get</code> method returns an <code>Illuminate\Support\Collection</code> containing the results where each result is an instance of the PHP <code>stdClass</code> object. You may access each column&#39;s value by accessing the column as a property of the object:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving A Single Row / Column From A Table</h4>

<p>If you just need to retrieve a single row from the database table, you may use the <code>first</code> method. This method will return a single <code>stdClass</code> object:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
</pre></div>

<p>If you don&#39;t even need an entire row, you may extract a single value from a record using the <code>value</code> method. This method will return the value of the column directly:</p>
<div class="highlight"><pre><span></span><span class="nx">$email</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<p>To retrieve a single row by its <code>id</code> column value, use the <code>find</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">find</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A List Of Column Values</h4>

<p>If you would like to retrieve a Collection containing the values of a single column, you may use the <code>pluck</code> method. In this example, we&#39;ll retrieve a Collection of role titles:</p>
<div class="highlight"><pre><span></span><span class="nx">$titles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$titles</span> <span class="nx">as</span> <span class="nx">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You may also specify a custom key column for the returned Collection:</p>
<div class="highlight"><pre><span></span><span class="nx">$roles</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;roles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$roles</span> <span class="nx">as</span> <span class="nx">$name</span> <span class="p">=&gt;</span> <span class="nx">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="chunking-results"></a></p>

<h3>Chunking Results</h3>

<p>If you need to work with thousands of database records, consider using the <code>chunk</code> method. This method retrieves a small chunk of the results at a time and feeds each chunk into a <code>Closure</code> for processing. This method is very useful for writing <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan commands</a> that process thousands of records. For example, let&#39;s work with the entire <code>users</code> table in chunks of 100 records at a time:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$users</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>You may stop further chunks from being processed by returning <code>false</code> from the <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Process the records...</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>If you are updating database records while chunking results, your chunk results could change in unexpected ways. So, when updating records while chunking, it is always best to use the <code>chunkById</code> method instead. This method will automatically paginate the results based on the record&#39;s primary key:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">chunkById</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$users</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">foreach</span> <span class="p">(</span><span class="nx">$users</span> <span class="nx">as</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;active&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} When updating or deleting records inside the chunk callback, any changes to the primary key or foreign keys could affect the chunk query. This could potentially result in records not being included in the chunked results.</p>
</blockquote>

<p><a name="aggregates"></a></p>

<h3>Aggregates</h3>

<p>The query builder also provides a variety of aggregate methods such as <code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, and <code>sum</code>. You may call any of these methods after constructing your query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>

<span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<p>You may combine these methods with other clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">$price</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;finalized&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">avg</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</pre></div>

<h4>Determining If Records Exist</h4>

<p>Instead of using the <code>count</code> method to determine if any records exist that match your query&#39;s constraints, you may use the <code>exists</code> and <code>doesntExist</code> methods:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;finalized&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;finalized&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">doesntExist</span><span class="p">();</span>
</pre></div>

<p><a name="selects"></a></p>

<h2>Selects</h2>

<h4>Specifying A Select Clause</h4>

<p>You may not always want to select all columns from a database table. Using the <code>select</code> method, you can specify a custom <code>select</code> clause for the query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email as user_email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>distinct</code> method allows you to force the query to return distinct results:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">distinct</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you already have a query builder instance and you wish to add a column to its existing select clause, you may use the <code>addSelect</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">addSelect</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="raw-expressions"></a></p>

<h2>Raw Expressions</h2>

<p>Sometimes you may need to use a raw expression in a query. To create a raw expression, you may use the <code>DB::raw</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;count(*) as user_count, status&#39;</span><span class="p">))</span>
                     <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Raw statements will be injected into the query as strings, so you should be extremely careful to not create SQL injection vulnerabilities.</p>
</blockquote>

<p><a name="raw-methods"></a></p>

<h3>Raw Methods</h3>

<p>Instead of using <code>DB::raw</code>, you may also use the following methods to insert a raw expression into various parts of your query.</p>

<h4><code>selectRaw</code></h4>

<p>The <code>selectRaw</code> method can be used in place of <code>addSelect(DB::raw(...))</code>. This method accepts an optional array of bindings as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">selectRaw</span><span class="p">(</span><span class="s1">&#39;price * ? as price_with_tax&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0825</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4><code>whereRaw / orWhereRaw</code></h4>

<p>The <code>whereRaw</code> and <code>orWhereRaw</code> methods can be used to inject a raw <code>where</code> clause into your query. These methods accept an optional array of bindings as their second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;price &gt; IF(state = &quot;TX&quot;, ?, 100)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">200</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4><code>havingRaw / orHavingRaw</code></h4>

<p>The <code>havingRaw</code> and <code>orHavingRaw</code> methods may be used to set a raw string as the value of the <code>having</code> clause. These methods accept an optional array of bindings as their second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">,</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;SUM(price) as total_sales&#39;</span><span class="p">))</span>
                <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;department&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">havingRaw</span><span class="p">(</span><span class="s1">&#39;SUM(price) &gt; ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2500</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4><code>orderByRaw</code></h4>

<p>The <code>orderByRaw</code> method may be used to set a raw string as the value of the <code>order by</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">orderByRaw</span><span class="p">(</span><span class="s1">&#39;updated_at - created_at DESC&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h3><code>groupByRaw</code></h3>

<p>The <code>groupByRaw</code> method may be used to set a raw string as the value of the <code>group by</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">groupByRaw</span><span class="p">(</span><span class="s1">&#39;city, state&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="joins"></a></p>

<h2>Joins</h2>

<h4>Inner Join Clause</h4>

<p>The query builder may also be used to write join statements. To perform a basic &quot;inner join&quot;, you may use the <code>join</code> method on a query builder instance. The first argument passed to the <code>join</code> method is the name of the table you need to join to, while the remaining arguments specify the column constraints for the join. You can even join to multiple tables in a single query:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;users.*&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.phone&#39;</span><span class="p">,</span> <span class="s1">&#39;orders.price&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Left Join / Right Join Clause</h4>

<p>If you would like to perform a &quot;left join&quot; or &quot;right join&quot; instead of an &quot;inner join&quot;, use the <code>leftJoin</code> or <code>rightJoin</code> methods. These methods have the same signature as the <code>join</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">leftJoin</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;posts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">rightJoin</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;posts.user_id&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Cross Join Clause</h4>

<p>To perform a &quot;cross join&quot; use the <code>crossJoin</code> method with the name of the table you wish to cross join to. Cross joins generate a cartesian product between the first table and the joined table:</p>
<div class="highlight"><pre><span></span><span class="nx">$sizes</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;sizes&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">crossJoin</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Advanced Join Clauses</h4>

<p>You may also specify more advanced join clauses. To get started, pass a <code>Closure</code> as the second argument into the <code>join</code> method. The <code>Closure</code> will receive a <code>JoinClause</code> object which allows you to specify constraints on the <code>join</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$join</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orOn</span><span class="p">(...);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you would like to use a &quot;where&quot; style clause on your joins, you may use the <code>where</code> and <code>orWhere</code> methods on a join. Instead of comparing two columns, these methods will compare the column against a value:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$join</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts.user_id&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;contacts.user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Subquery Joins</h4>

<p>You may use the <code>joinSub</code>, <code>leftJoinSub</code>, and <code>rightJoinSub</code> methods to join a query to a subquery. Each of these methods receive three arguments: the subquery, its table alias, and a Closure that defines the related columns:</p>
<div class="highlight"><pre><span></span><span class="nx">$latestPosts</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span>
                   <span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="s1">&#39;MAX(created_at) as last_post_created_at&#39;</span><span class="p">))</span>
                   <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;is_published&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
                   <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">joinSub</span><span class="p">(</span><span class="nx">$latestPosts</span><span class="p">,</span> <span class="s1">&#39;latest_posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$join</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$join</span><span class="o">-&gt;</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;latest_posts.user_id&#39;</span><span class="p">);</span>
        <span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="unions"></a></p>

<h2>Unions</h2>

<p>The query builder also provides a quick way to &quot;union&quot; two queries together. For example, you may create an initial query and use the <code>union</code> method to union it with a second query:</p>
<div class="highlight"><pre><span></span><span class="nx">$first</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">union</span><span class="p">(</span><span class="nx">$first</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} The <code>unionAll</code> method is also available and has the same method signature as <code>union</code>.</p>
</blockquote>

<p><a name="where-clauses"></a></p>

<h2>Where Clauses</h2>

<h4>Simple Where Clauses</h4>

<p>You may use the <code>where</code> method on a query builder instance to add <code>where</code> clauses to the query. The most basic call to <code>where</code> requires three arguments. The first argument is the name of the column. The second argument is an operator, which can be any of the database&#39;s supported operators. Finally, the third argument is the value to evaluate against the column.</p>

<p>For example, here is a query that verifies the value of the &quot;votes&quot; column is equal to 100:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>For convenience, if you want to verify that a column is equal to a given value, you may pass the value directly as the second argument to the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may use a variety of other operators when writing a <code>where</code> clause:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;T%&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also pass an array of conditions to the <code>where</code> function:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;subscribed&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>Or Statements</h4>

<p>You may chain where constraints together as well as add <code>or</code> clauses to the query. The <code>orWhere</code> method accepts the same arguments as the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>If you need to group an &quot;or&quot; condition within parentheses, you may pass a Closure as the first argument to the <code>orWhere</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// SQL: select * from users where votes &gt; 100 or (name = &#39;Abigail&#39; and votes &gt; 50)</span>
</pre></div>

<h4>Additional Where Clauses</h4>

<p><strong>whereBetween / orWhereBetween</strong></p>

<p>The <code>whereBetween</code> method verifies that a column&#39;s value is between two values:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="nx">whereBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
           <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereNotBetween / orWhereNotBetween</strong></p>

<p>The <code>whereNotBetween</code> method verifies that a column&#39;s value lies outside of two values:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotBetween</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereIn / whereNotIn / orWhereIn / orWhereNotIn</strong></p>

<p>The <code>whereIn</code> method verifies that a given column&#39;s value is contained within the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereNotIn</code> method verifies that the given column&#39;s value is <strong>not</strong> contained in the given array:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} If you are adding a huge array of integer bindings to your query, the <code>whereIntegerInRaw</code> or <code>whereIntegerNotInRaw</code> methods may be used to greatly reduce your memory usage.</p>
</blockquote>

<p><strong>whereNull / whereNotNull / orWhereNull / orWhereNotNull</strong></p>

<p>The <code>whereNull</code> method verifies that the value of the given column is <code>NULL</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereNotNull</code> method verifies that the column&#39;s value is not <code>NULL</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">whereNotNull</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereDate / whereMonth / whereDay / whereYear / whereTime</strong></p>

<p>The <code>whereDate</code> method may be used to compare a column&#39;s value against a date:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereDate</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-12-31&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereMonth</code> method may be used to compare a column&#39;s value against a specific month of a year:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereMonth</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereDay</code> method may be used to compare a column&#39;s value against a specific day of a month:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereDay</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;31&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereYear</code> method may be used to compare a column&#39;s value against a specific year:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereYear</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;2016&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereTime</code> method may be used to compare a column&#39;s value against a specific time:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereTime</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;11:20:45&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><strong>whereColumn / orWhereColumn</strong></p>

<p>The <code>whereColumn</code> method may be used to verify that two columns are equal:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may also pass a comparison operator to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>whereColumn</code> method can also be passed an array of multiple conditions. These conditions will be joined using the <code>and</code> operator:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">([</span>
                    <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;updated_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">],</span>
                <span class="p">])</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="parameter-grouping"></a></p>

<h3>Parameter Grouping</h3>

<p>Sometimes you may need to create more advanced where clauses such as &quot;where exists&quot; clauses or nested parameter groupings. The Laravel query builder can handle these as well. To get started, let&#39;s look at an example of grouping constraints within parenthesis:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin&#39;</span><span class="p">);</span>
           <span class="p">})</span>
           <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>As you can see, passing a <code>Closure</code> into the <code>where</code> method instructs the query builder to begin a constraint group. The <code>Closure</code> will receive a query builder instance which you can use to set the constraints that should be contained within the parenthesis group. The example above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span> <span class="nx">where</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="nx">and</span> <span class="p">(</span><span class="nx">votes</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="nx">or</span> <span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
</pre></div>

<blockquote>
<p>{tip} You should always group <code>orWhere</code> calls in order to avoid unexpected behavior when global scopes are applied.</p>
</blockquote>

<p><a name="where-exists-clauses"></a></p>

<h3>Where Exists Clauses</h3>

<p>The <code>whereExists</code> method allows you to write <code>where exists</code> SQL clauses. The <code>whereExists</code> method accepts a <code>Closure</code> argument, which will receive a query builder instance allowing you to define the query that should be placed inside of the &quot;exists&quot; clause:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="nx">whereExists</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
               <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">raw</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                     <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="nx">whereRaw</span><span class="p">(</span><span class="s1">&#39;orders.user_id = users.id&#39;</span><span class="p">);</span>
           <span class="p">})</span>
           <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The query above will produce the following SQL:</p>
<div class="highlight"><pre><span></span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">users</span>
<span class="nx">where</span> <span class="nx">exists</span> <span class="p">(</span>
    <span class="nx">select</span> <span class="mi">1</span> <span class="nx">from</span> <span class="nx">orders</span> <span class="nx">where</span> <span class="nx">orders</span><span class="p">.</span><span class="nx">user_id</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
<span class="p">)</span>
</pre></div>

<p><a name="subquery-where-clauses"></a></p>

<h3>Subquery Where Clauses</h3>

<p>Sometimes you may need to construct a where clause that compares the results of a subquery to a given value. You may accomplish this by passing a Closure and a value to the <code>where</code> method. For example, the following query will retrieve all users who have a recent &quot;membership&quot; of a given type;</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;membership&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">whereColumn</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;users.id&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">orderByDesc</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">},</span> <span class="s1">&#39;Pro&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="json-where-clauses"></a></p>

<h3>JSON Where Clauses</h3>

<p>Laravel also supports querying JSON column types on databases that provide support for JSON column types. Currently, this includes MySQL 5.7, PostgreSQL, SQL Server 2016, and SQLite 3.9.0 (with the <a href="https://www.sqlite.org/json1.html">JSON1 extension</a>). To query a JSON column, use the <code>-&gt;</code> operator:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;options-&gt;language&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;preferences-&gt;dining-&gt;meal&#39;</span><span class="p">,</span> <span class="s1">&#39;salad&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may use <code>whereJsonContains</code> to query JSON arrays (not supported on SQLite):</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereJsonContains</span><span class="p">(</span><span class="s1">&#39;options-&gt;languages&#39;</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>MySQL and PostgreSQL support <code>whereJsonContains</code> with multiple values:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereJsonContains</span><span class="p">(</span><span class="s1">&#39;options-&gt;languages&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may use <code>whereJsonLength</code> to query JSON arrays by their length:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereJsonLength</span><span class="p">(</span><span class="s1">&#39;options-&gt;languages&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">whereJsonLength</span><span class="p">(</span><span class="s1">&#39;options-&gt;languages&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="ordering-grouping-limit-and-offset"></a></p>

<h2>Ordering, Grouping, Limit &amp; Offset</h2>

<h4>orderBy</h4>

<p>The <code>orderBy</code> method allows you to sort the result of the query by a given column. The first argument to the <code>orderBy</code> method should be the column you wish to sort by, while the second argument controls the direction of the sort and may be either <code>asc</code> or <code>desc</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>latest / oldest</h4>

<p>The <code>latest</code> and <code>oldest</code> methods allow you to easily order results by date. By default, result will be ordered by the <code>created_at</code> column. Or, you may pass the column name that you wish to sort by:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">latest</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<h4>inRandomOrder</h4>

<p>The <code>inRandomOrder</code> method may be used to sort the query results randomly. For example, you may use this method to fetch a random user:</p>
<div class="highlight"><pre><span></span><span class="nx">$randomUser</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">inRandomOrder</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>
</pre></div>

<h4>reorder</h4>

<p>The <code>reorder</code> method allows you to remove all the existing orders and optionally apply a new order. For example, you can remove all the existing orders:</p>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$unorderedUsers</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">reorder</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>To remove all existing orders and apply a new order, provide the column and direction as arguments to the method:</p>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="nx">$usersOrderedByEmail</span> <span class="o">=</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">reorder</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<h4>groupBy / having</h4>

<p>The <code>groupBy</code> and <code>having</code> methods may be used to group the query results. The <code>having</code> method&#39;s signature is similar to that of the <code>where</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">having</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>You may pass multiple arguments to the <code>groupBy</code> method to group by multiple columns:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">having</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>For more advanced <code>having</code> statements, see the <a href="#raw-methods"><code>havingRaw</code></a> method.</p>

<h4>skip / take</h4>

<p>To limit the number of results returned from the query, or to skip a given number of results in the query, you may use the <code>skip</code> and <code>take</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may use the <code>limit</code> and <code>offset</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">offset</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="conditional-clauses"></a></p>

<h2>Conditional Clauses</h2>

<p>Sometimes you may want clauses to apply to a query only when something else is true. For instance you may only want to apply a <code>where</code> statement if a given input value is present on the incoming request. You may accomplish this using the <code>when</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$role</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">);</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">$role</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">,</span> <span class="nx">$role</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="nx">$role</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>The <code>when</code> method only executes the given Closure when the first parameter is <code>true</code>. If the first parameter is <code>false</code>, the Closure will not be executed.</p>

<p>You may pass another Closure as the third parameter to the <code>when</code> method. This Closure will execute if the first parameter evaluates as <code>false</code>. To illustrate how this feature may be used, we will use it to configure the default sorting of a query:</p>
<div class="highlight"><pre><span></span><span class="nx">$sortBy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nx">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="nx">$sortBy</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">,</span> <span class="nx">$sortBy</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="nx">$sortBy</span><span class="p">);</span>
                <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="inserts"></a></p>

<h2>Inserts</h2>

<p>The query builder also provides an <code>insert</code> method for inserting records into the database table. The <code>insert</code> method accepts an array of column names and values:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p>You may even insert several records into the table with a single call to <code>insert</code> by passing an array of arrays. Each array represents a row to be inserted into the table:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insert</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p>The <code>insertOrIgnore</code> method will ignore duplicate record errors while inserting records into the database:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insertOrIgnore</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;taylor@example.com&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dayle@example.com&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<h4>Auto-Incrementing IDs</h4>

<p>If the table has an auto-incrementing id, use the <code>insertGetId</code> method to insert a record and then retrieve the ID:</p>
<div class="highlight"><pre><span></span><span class="nx">$id</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">insertGetId</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} When using PostgreSQL the <code>insertGetId</code> method expects the auto-incrementing column to be named <code>id</code>. If you would like to retrieve the ID from a different &quot;sequence&quot;, you may pass the column name as the second parameter to the <code>insertGetId</code> method.</p>
</blockquote>

<p><a name="updates"></a></p>

<h2>Updates</h2>

<p>In addition to inserting records into the database, the query builder can also update existing records using the <code>update</code> method. The <code>update</code> method, like the <code>insert</code> method, accepts an array of column and value pairs containing the columns to be updated. You may constrain the <code>update</code> query using <code>where</code> clauses:</p>
<div class="highlight"><pre><span></span><span class="nx">$affected</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Update Or Insert</h4>

<p>Sometimes you may want to update an existing record in the database or create it if no matching record exists. In this scenario, the <code>updateOrInsert</code> method may be used. The <code>updateOrInsert</code> method accepts two arguments: an array of conditions by which to find the record, and an array of column and value pairs containing the columns to be updated.</p>

<p>The <code>updateOrInsert</code> method will first attempt to locate a matching database record using the first argument&#39;s column and value pairs. If the record exists, it will be updated with the values in the second argument. If the record can not be found, a new record will be inserted with the merged attributes of both arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">updateOrInsert</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;votes&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
    <span class="p">);</span>
</pre></div>

<p><a name="updating-json-columns"></a></p>

<h3>Updating JSON Columns</h3>

<p>When updating a JSON column, you should use <code>-&gt;</code> syntax to access the appropriate key in the JSON object. This operation is supported on MySQL 5.7+ and PostgreSQL 9.5+:</p>
<div class="highlight"><pre><span></span><span class="nx">$affected</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">update</span><span class="p">([</span><span class="s1">&#39;options-&gt;enabled&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
</pre></div>

<p><a name="increment-and-decrement"></a></p>

<h3>Increment &amp; Decrement</h3>

<p>The query builder also provides convenient methods for incrementing or decrementing the value of a given column. This is a shortcut, providing a more expressive and terse interface compared to manually writing the <code>update</code> statement.</p>

<p>Both of these methods accept at least one argument: the column to modify. A second argument may optionally be passed to control the amount by which the column should be incremented or decremented:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">);</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">decrement</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>

<p>You may also specify additional columns to update during the operation:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">increment</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">]);</span>
</pre></div>

<blockquote>
<p>{note} Model events are not fired when using the <code>increment</code> and <code>decrement</code> methods.</p>
</blockquote>

<p><a name="deletes"></a></p>

<h2>Deletes</h2>

<p>The query builder may also be used to delete records from the table via the <code>delete</code> method. You may constrain <code>delete</code> statements by adding <code>where</code> clauses before calling the <code>delete</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p>If you wish to truncate the entire table, which will remove all rows and reset the auto-incrementing ID to zero, you may use the <code>truncate</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">truncate</span><span class="p">();</span>
</pre></div>

<p><a name="pessimistic-locking"></a></p>

<h2>Pessimistic Locking</h2>

<p>The query builder also includes a few functions to help you do &quot;pessimistic locking&quot; on your <code>select</code> statements. To run the statement with a &quot;shared lock&quot;, you may use the <code>sharedLock</code> method on a query. A shared lock prevents the selected rows from being modified until your transaction commits:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">sharedLock</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Alternatively, you may use the <code>lockForUpdate</code> method. A &quot;for update&quot; lock prevents the rows from being modified or from being selected with another shared lock:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">lockForUpdate</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="debugging"></a></p>

<h2>Debugging</h2>

<p>You may use the <code>dd</code> or <code>dump</code> methods while building a query to dump the query bindings and SQL. The <code>dd</code> method will display the debug information and then stop executing the request. The <code>dump</code> method will display the debug information but allow the request to keep executing:</p>
<div class="highlight"><pre><span></span><span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dd</span><span class="p">();</span>

<span class="nx">DB</span><span class="o">::</span><span class="nx">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dump</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Queues</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#connections-vs-queues">Connections Vs. Queues</a></li>
<li><a href="#driver-prerequisites">Driver Notes &amp; Prerequisites</a></li>
</ul></li>
<li><a href="#creating-jobs">Creating Jobs</a>

<ul>
<li><a href="#generating-job-classes">Generating Job Classes</a></li>
<li><a href="#class-structure">Class Structure</a></li>
<li><a href="#job-middleware">Job Middleware</a></li>
</ul></li>
<li><a href="#dispatching-jobs">Dispatching Jobs</a>

<ul>
<li><a href="#delayed-dispatching">Delayed Dispatching</a></li>
<li><a href="#synchronous-dispatching">Synchronous Dispatching</a></li>
<li><a href="#job-chaining">Job Chaining</a></li>
<li><a href="#customizing-the-queue-and-connection">Customizing The Queue &amp; Connection</a></li>
<li><a href="#max-job-attempts-and-timeout">Specifying Max Job Attempts / Timeout Values</a></li>
<li><a href="#rate-limiting">Rate Limiting</a></li>
<li><a href="#error-handling">Error Handling</a></li>
</ul></li>
<li><a href="#job-batching">Job Batching</a>

<ul>
<li><a href="#defining-batchable-jobs">Defining Batchable Jobs</a></li>
<li><a href="#dispatching-batches">Dispatching Batches</a></li>
<li><a href="#adding-jobs-to-batches">Adding Jobs To Batches</a></li>
<li><a href="#inspecting-batches">Inspecting Batches</a></li>
<li><a href="#cancelling-batches">Cancelling Batches</a></li>
<li><a href="#batch-failures">Batch Failures</a></li>
</ul></li>
<li><a href="#queueing-closures">Queueing Closures</a></li>
<li><a href="#running-the-queue-worker">Running The Queue Worker</a>

<ul>
<li><a href="#queue-priorities">Queue Priorities</a></li>
<li><a href="#queue-workers-and-deployment">Queue Workers &amp; Deployment</a></li>
<li><a href="#job-expirations-and-timeouts">Job Expirations &amp; Timeouts</a></li>
</ul></li>
<li><a href="#supervisor-configuration">Supervisor Configuration</a></li>
<li><a href="#dealing-with-failed-jobs">Dealing With Failed Jobs</a>

<ul>
<li><a href="#cleaning-up-after-failed-jobs">Cleaning Up After Failed Jobs</a></li>
<li><a href="#failed-job-events">Failed Job Events</a></li>
<li><a href="#retrying-failed-jobs">Retrying Failed Jobs</a></li>
<li><a href="#ignoring-missing-models">Ignoring Missing Models</a></li>
</ul></li>
<li><a href="#job-events">Job Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<blockquote>
<p>{tip} Laravel now offers Horizon, a beautiful dashboard and configuration system for your Redis powered queues. Check out the full <a href="/docs/%7B%7Bversion%7D%7D/horizon">Horizon documentation</a> for more information.</p>
</blockquote>

<p>Laravel queues provide a unified API across a variety of different queue backends, such as Beanstalk, Amazon SQS, Redis, or even a relational database. Queues allow you to defer the processing of a time consuming task, such as sending an email, until a later time. Deferring these time consuming tasks drastically speeds up web requests to your application.</p>

<p>The queue configuration file is stored in <code>config/queue.php</code>. In this file you will find connection configurations for each of the queue drivers that are included with the framework, which includes a database, <a href="https://beanstalkd.github.io/">Beanstalkd</a>, <a href="https://aws.amazon.com/sqs/">Amazon SQS</a>, <a href="https://redis.io">Redis</a>,  and a synchronous driver that will execute jobs immediately (for local use). A <code>null</code> queue driver is also included which discards queued jobs.</p>

<p><a name="connections-vs-queues"></a></p>

<h3>Connections Vs. Queues</h3>

<p>Before getting started with Laravel queues, it is important to understand the distinction between &quot;connections&quot; and &quot;queues&quot;. In your <code>config/queue.php</code> configuration file, there is a <code>connections</code> configuration option. This option defines a particular connection to a backend service such as Amazon SQS, Beanstalk, or Redis. However, any given queue connection may have multiple &quot;queues&quot; which may be thought of as different stacks or piles of queued jobs.</p>

<p>Note that each connection configuration example in the <code>queue</code> configuration file contains a <code>queue</code> attribute. This is the default queue that jobs will be dispatched to when they are sent to a given connection. In other words, if you dispatch a job without explicitly defining which queue it should be dispatched to, the job will be placed on the queue that is defined in the <code>queue</code> attribute of the connection configuration:</p>
<div class="highlight"><pre><span></span><span class="c1">// This job is sent to the default queue...</span>
<span class="nx">Job</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">();</span>

<span class="c1">// This job is sent to the &quot;emails&quot; queue...</span>
<span class="nx">Job</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">);</span>
</pre></div>

<p>Some applications may not need to ever push jobs onto multiple queues, instead preferring to have one simple queue. However, pushing jobs to multiple queues can be especially useful for applications that wish to prioritize or segment how jobs are processed, since the Laravel queue worker allows you to specify which queues it should process by priority. For example, if you push jobs to a <code>high</code> queue, you may run a worker that gives them higher processing priority:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">high</span><span class="p">,</span><span class="k">default</span>
</pre></div>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Notes &amp; Prerequisites</h3>

<h4>Database</h4>

<p>In order to use the <code>database</code> queue driver, you will need a database table to hold the jobs. To generate a migration that creates this table, run the <code>queue:table</code> Artisan command. Once the migration has been created, you may migrate your database using the <code>migrate</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h4>Redis</h4>

<p>In order to use the <code>redis</code> queue driver, you should configure a Redis database connection in your <code>config/database.php</code> configuration file.</p>

<p><strong>Redis Cluster</strong></p>

<p>If your Redis queue connection uses a Redis Cluster, your queue names must contain a <a href="https://redis.io/topics/cluster-spec#keys-hash-tags">key hash tag</a>. This is required in order to ensure all of the Redis keys for a given queue are placed into the same hash slot:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;redis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;connection&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;{default}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;retry_after&#39;</span> <span class="p">=&gt;</span> <span class="mi">90</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><strong>Blocking</strong></p>

<p>When using the Redis queue, you may use the <code>block_for</code> configuration option to specify how long the driver should wait for a job to become available before iterating through the worker loop and re-polling the Redis database.</p>

<p>Adjusting this value based on your queue load can be more efficient than continually polling the Redis database for new jobs. For instance, you may set the value to <code>5</code> to indicate that the driver should block for five seconds while waiting for a job to become available:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;redis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;connection&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;queue&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;retry_after&#39;</span> <span class="p">=&gt;</span> <span class="mi">90</span><span class="p">,</span>
    <span class="s1">&#39;block_for&#39;</span> <span class="p">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<blockquote>
<p>{note} Setting <code>block_for</code> to <code>0</code> will cause queue workers to block indefinitely until a job is available. This will also prevent signals such as <code>SIGTERM</code> from being handled until the next job has been processed.</p>
</blockquote>

<h4>Other Driver Prerequisites</h4>

<p>The following dependencies are needed for the listed queue drivers:</p>

<div class="content-list" markdown="1">
- Amazon SQS: `aws/aws-sdk-php ~3.0`
- Beanstalkd: `pda/pheanstalk ~4.0`
- Redis: `predis/predis ~1.0` or phpredis PHP extension
</div>

<p><a name="creating-jobs"></a></p>

<h2>Creating Jobs</h2>

<p><a name="generating-job-classes"></a></p>

<h3>Generating Job Classes</h3>

<p>By default, all of the queueable jobs for your application are stored in the <code>app/Jobs</code> directory. If the <code>app/Jobs</code> directory doesn&#39;t exist, it will be created when you run the <code>make:job</code> Artisan command. You may generate a new queued job using the Artisan CLI:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">job</span> <span class="nx">ProcessPodcast</span>
</pre></div>

<p>The generated class will implement the <code>Illuminate\Contracts\Queue\ShouldQueue</code> interface, indicating to Laravel that the job should be pushed onto the queue to run asynchronously.</p>

<blockquote>
<p>{tip} Job stubs may be customized using <a href="/docs/%7B%7Bversion%7D%7D/artisan#stub-customization">stub publishing</a></p>
</blockquote>

<p><a name="class-structure"></a></p>

<h3>Class Structure</h3>

<p>Job classes are very simple, normally containing only a <code>handle</code> method which is called when the job is processed by the queue. To get started, let&#39;s take a look at an example job class. In this example, we&#39;ll pretend we manage a podcast publishing service and need to process the uploaded podcast files before they are published:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\AudioProcessor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$podcast</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new job instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Podcast  $podcast</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nv">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span> <span class="o">=</span> <span class="nv">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  AudioProcessor  $processor</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">AudioProcessor</span> <span class="nv">$processor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Process uploaded podcast...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, note that we were able to pass an <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent model</a> directly into the queued job&#39;s constructor. Because of the <code>SerializesModels</code> trait that the job is using, Eloquent models and their loaded relationships will be gracefully serialized and unserialized when the job is processing. If your queued job accepts an Eloquent model in its constructor, only the identifier for the model will be serialized onto the queue. When the job is actually handled, the queue system will automatically re-retrieve the full model instance and its loaded relationships from the database. It&#39;s all totally transparent to your application and prevents issues that can arise from serializing full Eloquent model instances.</p>

<p>The <code>handle</code> method is called when the job is processed by the queue. Note that we are able to type-hint dependencies on the <code>handle</code> method of the job. The Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a> automatically injects these dependencies.</p>

<p>If you would like to take total control over how the container injects dependencies into the <code>handle</code> method, you may use the container&#39;s <code>bindMethod</code> method. The <code>bindMethod</code> method accepts a callback which receives the job and the container. Within the callback, you are free to invoke the <code>handle</code> method however you wish. Typically, you should call this method from a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">ProcessPodcast</span><span class="p">;</span>

<span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">bindMethod</span><span class="p">(</span><span class="nx">ProcessPodcast</span><span class="o">::</span><span class="kr">class</span><span class="p">.</span><span class="s1">&#39;@handle&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$job</span><span class="p">,</span> <span class="nx">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$job</span><span class="o">-&gt;</span><span class="nx">handle</span><span class="p">(</span><span class="nx">$app</span><span class="o">-&gt;</span><span class="nx">make</span><span class="p">(</span><span class="nx">AudioProcessor</span><span class="o">::</span><span class="kr">class</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} Binary data, such as raw image contents, should be passed through the <code>base64_encode</code> function before being passed to a queued job. Otherwise, the job may not properly serialize to JSON when being placed on the queue.</p>
</blockquote>

<h4>Handling Relationships</h4>

<p>Because loaded relationships also get serialized, the serialized job string can become quite large. To prevent relations from being serialized, you can call the <code>withoutRelations</code> method on the model when setting a property value. This method will return an instance of the model with no loaded relationships:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Create a new job instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \App\Models\Podcast  $podcast</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nx">$podcast</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">podcast</span> <span class="o">=</span> <span class="nx">$podcast</span><span class="o">-&gt;</span><span class="nx">withoutRelations</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="job-middleware"></a></p>

<h3>Job Middleware</h3>

<p>Job middleware allow you to wrap custom logic around the execution of queued jobs, reducing boilerplate in the jobs themselves. For example, consider the following <code>handle</code> method which leverages Laravel&#39;s Redis rate limiting features to allow only one job to process every five seconds:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the job.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Redis</span><span class="o">::</span><span class="nx">throttle</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">allow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Lock obtained...&#39;</span><span class="p">);</span>

        <span class="c1">// Handle job...</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Could not obtain lock...</span>

        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>While this code is valid, the structure of the <code>handle</code> method becomes noisy since it is cluttered with Redis rate limiting logic. In addition, this rate limiting logic must be duplicated for any other jobs that we want to rate limit.</p>

<p>Instead of rate limiting in the handle method, we could define a job middleware that handles rate limiting. Laravel does not have a default location for job middleware, so you are welcome to place job middleware anywhere in your application. In this example, we will place the middleware in a <code>app/Jobs/Middleware</code> directory:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Redis</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RateLimited</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Process the queued job.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  mixed  $job</span>
<span class="sd">     * @param  callable  $next</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$job</span><span class="p">,</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Redis</span><span class="o">::</span><span class="na">throttle</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">every</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">then</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$job</span><span class="p">,</span> <span class="nv">$next</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Lock obtained...</span>

                    <span class="nv">$next</span><span class="p">(</span><span class="nv">$job</span><span class="p">);</span>
                <span class="p">},</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$job</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Could not obtain lock...</span>

                    <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">release</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
                <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, like <a href="/docs/%7B%7Bversion%7D%7D/middleware">route middleware</a>, job middleware receive the job being processed and a callback that should be invoked to continue processing the job.</p>

<p>After creating job middleware, they may be attached to a job by returning them from the job&#39;s <code>middleware</code> method. This method does not exist on jobs scaffolded by the <code>make:job</code> Artisan command, so you will need to add it to your own job class definition:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">RateLimited</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Get the middleware the job should pass through.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">middleware</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="k">new</span> <span class="nx">RateLimited</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="dispatching-jobs"></a></p>

<h2>Dispatching Jobs</h2>

<p>Once you have written your job class, you may dispatch it using the <code>dispatch</code> method on the job itself. The arguments passed to the <code>dispatch</code> method will be given to the job&#39;s constructor:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPodcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create podcast...</span>

        <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to conditionally dispatch a job, you may use the <code>dispatchIf</code> and <code>dispatchUnless</code> methods:</p>
<div class="highlight"><pre><span></span><span class="nx">ProcessPodcast</span><span class="o">::</span><span class="nx">dispatchIf</span><span class="p">(</span><span class="nx">$accountActive</span> <span class="o">===</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">);</span>

<span class="nx">ProcessPodcast</span><span class="o">::</span><span class="nx">dispatchUnless</span><span class="p">(</span><span class="nx">$accountSuspended</span> <span class="o">===</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">$podcast</span><span class="p">);</span>
</pre></div>

<p><a name="delayed-dispatching"></a></p>

<h3>Delayed Dispatching</h3>

<p>If you would like to delay the execution of a queued job, you may use the <code>delay</code> method when dispatching a job. For example, let&#39;s specify that a job should not be available for processing until 10 minutes after it has been dispatched:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPodcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create podcast...</span>

        <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">delay</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} The Amazon SQS queue service has a maximum delay time of 15 minutes.</p>
</blockquote>

<h4>Dispatching After The Response Is Sent To Browser</h4>

<p>Alternatively, the <code>dispatchAfterResponse</code> method delays dispatching a job until after the response is sent to the user&#39;s browser. This will still allow the user to begin using the application even though a queued job is still executing. This should typically only be used for jobs that take about a second, such as sending an email:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">SendNotification</span><span class="p">;</span>

<span class="nx">SendNotification</span><span class="o">::</span><span class="nx">dispatchAfterResponse</span><span class="p">();</span>
</pre></div>

<p>You may <code>dispatch</code> a Closure and chain the <code>afterResponse</code> method onto the helper to execute a Closure after the response has been sent to the browser:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Mail</span><span class="err">\</span><span class="nx">WelcomeMessage</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Mail</span><span class="p">;</span>

<span class="nx">dispatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Mail</span><span class="o">::</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">WelcomeMessage</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">afterResponse</span><span class="p">();</span>
</pre></div>

<p><a name="synchronous-dispatching"></a></p>

<h3>Synchronous Dispatching</h3>

<p>If you would like to dispatch a job immediately (synchronously), you may use the <code>dispatchSync</code> method. When using this method, the job will not be queued and will be run immediately within the current process:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPodcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create podcast...</span>

        <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="na">dispatchSync</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="job-chaining"></a></p>

<h3>Job Chaining</h3>

<p>Job chaining allows you to specify a list of queued jobs that should be run in sequence after the primary job has executed successfully. If one job in the sequence fails, the rest of the jobs will not be run. To execute a queued job chain, you may use the <code>chain</code> method provided by the <code>Bus</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Bus</span><span class="p">;</span>

<span class="nx">Bus</span><span class="o">::</span><span class="nx">chain</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">OptimizePodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">ReleasePodcast</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<p>In addition to chaining job class instances, you may also chain Closures:</p>
<div class="highlight"><pre><span></span><span class="nx">Bus</span><span class="o">::</span><span class="nx">chain</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">OptimizePodcast</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">Podcast</span><span class="o">::</span><span class="nx">update</span><span class="p">(...);</span>
    <span class="p">},</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Deleting jobs using the <code>$this-&gt;delete()</code> method will not prevent chained jobs from being processed. The chain will only stop executing if a job in the chain fails.</p>
</blockquote>

<h4>Chain Connection &amp; Queue</h4>

<p>If you would like to specify the default connection and queue that should be used for the chained jobs, you may use the <code>allOnConnection</code> and <code>allOnQueue</code> methods. These methods specify the queue connection and queue name that should be used unless the queued job is explicitly assigned a different connection / queue:</p>
<div class="highlight"><pre><span></span><span class="nx">Bus</span><span class="o">::</span><span class="nx">chain</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">OptimizePodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">ReleasePodcast</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">allOnConnection</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">allOnQueue</span><span class="p">(</span><span class="s1">&#39;podcasts&#39;</span><span class="p">);</span>
</pre></div>

<h4>Chain Failures</h4>

<p>When chaining jobs, you may use the <code>chain</code> method to specify a Closure that should be invoked if a job within the chain fails. The given callback will receive the exception instance that caused the job failure:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Bus</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="nx">Bus</span><span class="o">::</span><span class="nx">chain</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">OptimizePodcast</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">ReleasePodcast</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// A job within the chain has failed...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<p><a name="customizing-the-queue-and-connection"></a></p>

<h3>Customizing The Queue &amp; Connection</h3>

<h4>Dispatching To A Particular Queue</h4>

<p>By pushing jobs to different queues, you may &quot;categorize&quot; your queued jobs and even prioritize how many workers you assign to various queues. Keep in mind, this does not push jobs to different queue &quot;connections&quot; as defined by your queue configuration file, but only to specific queues within a single connection. To specify the queue, use the <code>onQueue</code> method when dispatching the job:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPodcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create podcast...</span>

        <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onQueue</span><span class="p">(</span><span class="s1">&#39;processing&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Dispatching To A Particular Connection</h4>

<p>If you are working with multiple queue connections, you may specify which connection to push a job to. To specify the connection, use the <code>onConnection</code> method when dispatching the job:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPodcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PodcastController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new podcast.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create podcast...</span>

        <span class="nx">ProcessPodcast</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$podcast</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onConnection</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may chain the <code>onConnection</code> and <code>onQueue</code> methods to specify the connection and the queue for a job:</p>
<div class="highlight"><pre><span></span><span class="nx">ProcessPodcast</span><span class="o">::</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">$podcast</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">onConnection</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;processing&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="max-job-attempts-and-timeout"></a></p>

<h3>Specifying Max Job Attempts / Timeout Values</h3>

<h4>Max Attempts</h4>

<p>One approach to specifying the maximum number of times a job may be attempted is via the <code>--tries</code> switch on the Artisan command line:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>However, you may take a more granular approach by defining the maximum number of attempts on the job class itself. If the maximum number of attempts is specified on the job, it will take precedence over the value provided on the command line:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The number of times the job may be attempted.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="time-based-attempts"></a></p>

<h4>Time Based Attempts</h4>

<p>As an alternative to defining how many times a job may be attempted before it fails, you may define a time at which the job should timeout. This allows a job to be attempted any number of times within a given time frame. To define the time at which a job should timeout, add a <code>retryUntil</code> method to your job class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine the time at which the job should timeout.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \DateTime</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">retryUntil</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may also define a <code>retryUntil</code> method on your queued event listeners.</p>
</blockquote>

<h4>Max Exceptions</h4>

<p>Sometimes you may wish to specify that a job may be attempted many times, but should fail if the retries are triggered by a given number of exceptions. To accomplish this, you may define a <code>maxExceptions</code> property on your job class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The number of times the job may be attempted.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The maximum number of exceptions to allow before failing.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$maxExceptions</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Redis</span><span class="o">::</span><span class="na">throttle</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">every</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">then</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Lock obtained, process the podcast...</span>
        <span class="p">},</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Unable to obtain lock...</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">release</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this example, the job is released for ten seconds if the application is unable to obtain a Redis lock and will continue to be retried up to 25 times. However, the job will fail if three unhandled exceptions are thrown by the job.</p>

<h4>Timeout</h4>

<blockquote>
<p>{note} The <code>pcntl</code> PHP extension must be installed in order to specify job timeouts.</p>
</blockquote>

<p>Likewise, the maximum number of seconds that jobs can run may be specified using the <code>--timeout</code> switch on the Artisan command line:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">30</span>
</pre></div>

<p>However, you may also define the maximum number of seconds a job should be allowed to run on the job class itself. If the timeout is specified on the job, it will take precedence over any timeout specified on the command line:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The number of seconds the job can run before timing out.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="rate-limiting"></a></p>

<h3>Rate Limiting</h3>

<blockquote>
<p>{note} This feature requires that your application can interact with a <a href="/docs/%7B%7Bversion%7D%7D/redis">Redis server</a>.</p>
</blockquote>

<p>If your application interacts with Redis, you may throttle your queued jobs by time or concurrency. This feature can be of assistance when your queued jobs are interacting with APIs that are also rate limited.</p>

<p>For example, using the <code>throttle</code> method, you may throttle a given type of job to only run 10 times every 60 seconds. If a lock can not be obtained, you should typically release the job back onto the queue so it can be retried later:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">throttle</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">allow</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">every</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Job logic...</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Could not obtain lock...</span>

    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} In the example above, the <code>key</code> may be any string that uniquely identifies the type of job you would like to rate limit. For example, you may wish to construct the key based on the class name of the job and the IDs of the Eloquent models it operates on.</p>

<p>{note}  Releasing a throttled job back onto the queue will still increment the job&#39;s total number of <code>attempts</code>.</p>
</blockquote>

<p>Alternatively, you may specify the maximum number of workers that may simultaneously process a given job. This can be helpful when a queued job is modifying a resource that should only be modified by one job at a time. For example, using the <code>funnel</code> method, you may limit jobs of a given type to only be processed by one worker at a time:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">funnel</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Job logic...</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Could not obtain lock...</span>

    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">release</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} When using rate limiting, the number of attempts your job will need to run successfully can be hard to determine. Therefore, it is useful to combine rate limiting with <a href="#time-based-attempts">time based attempts</a>.</p>
</blockquote>

<p><a name="error-handling"></a></p>

<h3>Error Handling</h3>

<p>If an exception is thrown while the job is being processed, the job will automatically be released back onto the queue so it may be attempted again. The job will continue to be released until it has been attempted the maximum number of times allowed by your application. The maximum number of attempts is defined by the <code>--tries</code> switch used on the <code>queue:work</code> Artisan command. Alternatively, the maximum number of attempts may be defined on the job class itself. More information on running the queue worker <a href="#running-the-queue-worker">can be found below</a>.</p>

<p><a name="job-batching"></a></p>

<h2>Job Batching</h2>

<p>Laravel&#39;s job batching feature allows you to easily execute a batch of jobs and then perform some action when the batch of jobs has completed executing. Before getting started, you should create a database migration to build a table that will contain your job batch meta information. This migration may be generated using the <code>queue:batches-table</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">batches</span><span class="o">-</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="defining-batchable-jobs"></a></p>

<h3>Defining Batchable Jobs</h3>

<p>To build a batchable job, you should <a href="#creating-jobs">create a queueable job</a> as normal; however, you should add the <code>Illuminate\Bus\Batchable</code> trait to the job class. This trait provides access to a <code>batch</code> method which may be used to retrieve the current batch that the job is executing in:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\AudioProcessor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Batchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Batchable</span><span class="p">,</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">batch</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cancelled</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// Detected cancelled batch...</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Batched job executing...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="dispatching-batches"></a></p>

<h3>Dispatching Batches</h3>

<p>To dispatch a batch of jobs, you should use <code>batch</code> method of the <code>Bus</code> facade. Of course, batching is primarily useful when combined with completion callbacks. So, you may use the <code>then</code>, <code>catch</code>, and <code>finally</code> methods to define completion callbacks for the batch. Each of these callbacks will receive an <code>Illuminate\Bus\Batch</code> instance when they are invoked:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">ProcessPodcast</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Podcast</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Bus</span><span class="err">\</span><span class="nx">Batch</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Batch</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="nx">$batch</span> <span class="o">=</span> <span class="nx">Bus</span><span class="o">::</span><span class="nx">batch</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span>
    <span class="k">new</span> <span class="nx">ProcessPodcast</span><span class="p">(</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// All jobs completed successfully...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">,</span> <span class="nx">Throwable</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// First batch job failure detected...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="k">finally</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The batch has finished executing...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>
</pre></div>

<h4>Naming Batches</h4>

<p>Some tools such as Laravel Horizon and Laravel Telescope may provide more user-friendly debug information for batches if batches are named. To assign an arbitrary name to a batch, you may call the <code>name</code> method while defining the batch:</p>
<div class="highlight"><pre><span></span><span class="nx">$batch</span> <span class="o">=</span> <span class="nx">Bus</span><span class="o">::</span><span class="nx">batch</span><span class="p">([</span>
    <span class="c1">// ...</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// All jobs completed successfully...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;Process Podcasts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<p><a name="adding-jobs-to-batches"></a></p>

<h3>Adding Jobs To Batches</h3>

<p>Sometimes it may be useful to add additional jobs to a batch from within a batched job. This pattern can be useful when you need to batch thousands of jobs which may take too long to dispatch during a web request. So, instead, you may wish to dispatch an initial batch of &quot;loader&quot; jobs that hydrate the batch with more jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">$batch</span> <span class="o">=</span> <span class="nx">Bus</span><span class="o">::</span><span class="nx">batch</span><span class="p">([</span>
    <span class="k">new</span> <span class="nx">LoadImportBatch</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">LoadImportBatch</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">LoadImportBatch</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// All jobs completed successfully...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;Import Contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<p>In this example, we will use the <code>LoadImportBatch</code> job to hydrate the batch with additional jobs. To accomplish this, we may use the <code>add</code> method on the batch instance that can be accessed within the job:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Jobs</span><span class="err">\</span><span class="nx">ImportContacts</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Collection</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Execute the job.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">batch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">batch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">(</span><span class="nx">Collection</span><span class="o">::</span><span class="nx">times</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">ImportContacts</span><span class="p">;</span>
    <span class="p">}));</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} You may only add jobs to a batch from within a job that belongs to the same batch.</p>
</blockquote>

<p><a name="inspecting-batches"></a></p>

<h3>Inspecting Batches</h3>

<p>The <code>Illuminate\Bus\Batch</code> method that is provided to batch completion callbacks has a variety of properties and methods to assist you in interacting with and inspecting a given batch of jobs.</p>
<div class="highlight"><pre><span></span><span class="c1">// The UUID of the batch...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">;</span>

<span class="c1">// The name of the batch (if applicable)...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>

<span class="c1">// The number of jobs assigned to the batch...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">totalJobs</span><span class="p">;</span>

<span class="c1">// The number of jobs that have not been processed by the queue...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">pendingJobs</span><span class="p">;</span>

<span class="c1">// The number of jobs that have failed...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">failedJobs</span><span class="p">;</span>

<span class="c1">// The number of jobs that have been processed thus far...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">processedJobs</span><span class="p">();</span>

<span class="c1">// The completion percentage of the batch (0-100)...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">progress</span><span class="p">();</span>

<span class="c1">// Indicates if the batch has finished executing...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">finished</span><span class="p">();</span>

<span class="c1">// Cancel the execution of the batch...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>

<span class="c1">// Indicates if the batch has been cancelled...</span>
<span class="nx">$batch</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">();</span>
</pre></div>

<h4>Returning Batches From Routes</h4>

<p>All <code>Illuminate\Bus\Batch</code> instances are JSON serializable, meaning you can return them directly from one of your application&#39;s routes to retrieve a JSON payload containing information about the batch, including its completion progress. To retrieve a batch by its ID, you may use the <code>Bus</code> facade&#39;s <code>findBatch</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Bus</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Route</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/batch/{batchId}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">$batchId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Bus</span><span class="o">::</span><span class="nx">findBatch</span><span class="p">(</span><span class="nx">$batchId</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="cancelling-batches"></a></p>

<h3>Cancelling Batches</h3>

<p>Sometimes you may need to cancel a given batch&#39;s execution. This can be accomplished by calling the <code>cancel</code> method on the <code>Illuminate\Bus\Batch</code> instance:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Execute the job.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="o">-&gt;</span><span class="nx">exceedsImportLimit</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">batch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancel</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">batch</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">cancelled</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="batch-failures"></a></p>

<h3>Batch Failures</h3>

<p>When a batch job fails, the <code>catch</code> callback (if assigned) will be invoked. This callback is only invoked for the job that fails within the batch.</p>

<h4>Allowing Failures</h4>

<p>When a job within a batch fails, Laravel will automatically mark the batch as &quot;cancelled&quot;. If you wish, you may disable this behavior so that a job failure does not automatically mark the batch as cancelled. This may be accomplished by calling the <code>allowFailures</code> method while dispatching the batch:</p>
<div class="highlight"><pre><span></span><span class="nx">$batch</span> <span class="o">=</span> <span class="nx">Bus</span><span class="o">::</span><span class="nx">batch</span><span class="p">([</span>
    <span class="c1">// ...</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Batch</span> <span class="nx">$batch</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// All jobs completed successfully...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">allowFailures</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">dispatch</span><span class="p">();</span>
</pre></div>

<h4>Retrying Failed Batch Jobs</h4>

<p>For convenience, Laravel provides a <code>queue:retry-batch</code> Artisan command that allows you to easily retry all of the failed jobs for a given batch. The <code>queue:retry-batch</code> command accepts the UUID of the batch whose failed jobs should be retried:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span><span class="o">-</span><span class="nx">batch</span> <span class="mi">32</span><span class="nx">dbc76c</span><span class="o">-</span><span class="mi">4</span><span class="nx">f82</span><span class="o">-</span><span class="mi">4749</span><span class="o">-</span><span class="nx">b610</span><span class="o">-</span><span class="nx">a639fe0099b5</span>
</pre></div>

<p><a name="queueing-closures"></a></p>

<h2>Queueing Closures</h2>

<p>Instead of dispatching a job class to the queue, you may also dispatch a Closure. This is great for quick, simple tasks that need to be executed outside of the current request cycle. When dispatching Closures to the queue, the Closure&#39;s code contents is cryptographically signed so it can not be modified in transit:</p>
<div class="highlight"><pre><span></span><span class="nx">$podcast</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Podcast</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">dispatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$podcast</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$podcast</span><span class="o">-&gt;</span><span class="nx">publish</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Using the <code>catch</code> method, you may provide a Closure that should be executed if the queued Closure fails to complete successfully after exhausting all of your queue&#39;s configured retry attempts:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="nx">dispatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$podcast</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$podcast</span><span class="o">-&gt;</span><span class="nx">publish</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nx">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This job has failed...</span>
<span class="p">});</span>
</pre></div>

<p><a name="running-the-queue-worker"></a></p>

<h2>Running The Queue Worker</h2>

<p>Laravel includes a queue worker that will process new jobs as they are pushed onto the queue. You may run the worker using the <code>queue:work</code> Artisan command. Note that once the <code>queue:work</code> command has started, it will continue to run until it is manually stopped or you close your terminal:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span>
</pre></div>

<blockquote>
<p>{tip} To keep the <code>queue:work</code> process running permanently in the background, you should use a process monitor such as <a href="#supervisor-configuration">Supervisor</a> to ensure that the queue worker does not stop running.</p>
</blockquote>

<p>Remember, queue workers are long-lived processes and store the booted application state in memory. As a result, they will not notice changes in your code base after they have been started. So, during your deployment process, be sure to <a href="#queue-workers-and-deployment">restart your queue workers</a>. In addition, remember that any static state created or modified by your application will not be automatically reset between jobs.</p>

<p>Alternatively, you may run the <code>queue:listen</code> command. When using the <code>queue:listen</code> command, you don&#39;t have to manually restart the worker when you want to reload your updated code or reset the application state; however, this command is not as efficient as <code>queue:work</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">listen</span>
</pre></div>

<h4>Specifying The Connection &amp; Queue</h4>

<p>You may also specify which queue connection the worker should utilize. The connection name passed to the <code>work</code> command should correspond to one of the connections defined in your <code>config/queue.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">redis</span>
</pre></div>

<p>You may customize your queue worker even further by only processing particular queues for a given connection. For example, if all of your emails are processed in an <code>emails</code> queue on your <code>redis</code> queue connection, you may issue the following command to start a worker that only processes that queue:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">redis</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">emails</span>
</pre></div>

<h4>Processing A Specified Number Of Jobs</h4>

<p>The <code>--once</code> option may be used to instruct the worker to only process a single job from the queue:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">once</span>
</pre></div>

<p>The <code>--max-jobs</code> option may be used to instruct the worker to process the given number of jobs and then exit. This option may be useful when combined with <a href="supervisor-configuration">Supervisor</a> so that your workers are automatically restarted after processing a given number of jobs:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">max</span><span class="o">-</span><span class="nx">jobs</span><span class="o">=</span><span class="mi">1000</span>
</pre></div>

<h4>Processing All Queued Jobs &amp; Then Exiting</h4>

<p>The <code>--stop-when-empty</code> option may be used to instruct the worker to process all jobs and then exit gracefully. This option can be useful when working Laravel queues within a Docker container if you wish to shutdown the container after the queue is empty:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">stop</span><span class="o">-</span><span class="nx">when</span><span class="o">-</span><span class="nx">empty</span>
</pre></div>

<h4>Processing Jobs For A Given Number Of Seconds</h4>

<p>The <code>--max-time</code> option may be used to instruct the worker to process jobs for the given number of seconds and then exit. This option may be useful when combined with <a href="supervisor-configuration">Supervisor</a> so that your workers are automatically restarted after processing jobs for a given amount of time:</p>
<div class="highlight"><pre><span></span><span class="c1">// Process jobs for one hour and then exit...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">max</span><span class="o">-</span><span class="nx">time</span><span class="o">=</span><span class="mi">3600</span>
</pre></div>

<h4>Resource Considerations</h4>

<p>Daemon queue workers do not &quot;reboot&quot; the framework before processing each job. Therefore, you should free any heavy resources after each job completes. For example, if you are doing image manipulation with the GD library, you should free the memory with <code>imagedestroy</code> when you are done.</p>

<p><a name="queue-priorities"></a></p>

<h3>Queue Priorities</h3>

<p>Sometimes you may wish to prioritize how your queues are processed. For example, in your <code>config/queue.php</code> you may set the default <code>queue</code> for your <code>redis</code> connection to <code>low</code>. However, occasionally you may wish to push a job to a <code>high</code> priority queue like so:</p>
<div class="highlight"><pre><span></span><span class="nx">dispatch</span><span class="p">((</span><span class="k">new</span> <span class="nx">Job</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onQueue</span><span class="p">(</span><span class="s1">&#39;high&#39;</span><span class="p">));</span>
</pre></div>

<p>To start a worker that verifies that all of the <code>high</code> queue jobs are processed before continuing to any jobs on the <code>low</code> queue, pass a comma-delimited list of queue names to the <code>work</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">queue</span><span class="o">=</span><span class="nx">high</span><span class="p">,</span><span class="nx">low</span>
</pre></div>

<p><a name="queue-workers-and-deployment"></a></p>

<h3>Queue Workers &amp; Deployment</h3>

<p>Since queue workers are long-lived processes, they will not pick up changes to your code without being restarted. So, the simplest way to deploy an application using queue workers is to restart the workers during your deployment process. You may gracefully restart all of the workers by issuing the <code>queue:restart</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">restart</span>
</pre></div>

<p>This command will instruct all queue workers to gracefully &quot;die&quot; after they finish processing their current job so that no existing jobs are lost. Since the queue workers will die when the <code>queue:restart</code> command is executed, you should be running a process manager such as <a href="#supervisor-configuration">Supervisor</a> to automatically restart the queue workers.</p>

<blockquote>
<p>{tip} The queue uses the <a href="/docs/%7B%7Bversion%7D%7D/cache">cache</a> to store restart signals, so you should verify a cache driver is properly configured for your application before using this feature.</p>
</blockquote>

<p><a name="job-expirations-and-timeouts"></a></p>

<h3>Job Expirations &amp; Timeouts</h3>

<h4>Job Expiration</h4>

<p>In your <code>config/queue.php</code> configuration file, each queue connection defines a <code>retry_after</code> option. This option specifies how many seconds the queue connection should wait before retrying a job that is being processed. For example, if the value of <code>retry_after</code> is set to <code>90</code>, the job will be released back onto the queue if it has been processing for 90 seconds without being deleted. Typically, you should set the <code>retry_after</code> value to the maximum number of seconds your jobs should reasonably take to complete processing.</p>

<blockquote>
<p>{note} The only queue connection which does not contain a <code>retry_after</code> value is Amazon SQS. SQS will retry the job based on the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/AboutVT.html">Default Visibility Timeout</a> which is managed within the AWS console.</p>
</blockquote>

<h4>Worker Timeouts</h4>

<p>The <code>queue:work</code> Artisan command exposes a <code>--timeout</code> option. The <code>--timeout</code> option specifies how long the Laravel queue master process will wait before killing off a child queue worker that is processing a job. Sometimes a child queue process can become &quot;frozen&quot; for various reasons. The <code>--timeout</code> option removes frozen processes that have exceeded that specified time limit:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">timeout</span><span class="o">=</span><span class="mi">60</span>
</pre></div>

<p>The <code>retry_after</code> configuration option and the <code>--timeout</code> CLI option are different, but work together to ensure that jobs are not lost and that jobs are only successfully processed once.</p>

<blockquote>
<p>{note} The <code>--timeout</code> value should always be at least several seconds shorter than your <code>retry_after</code> configuration value. This will ensure that a worker processing a given job is always killed before the job is retried. If your <code>--timeout</code> option is longer than your <code>retry_after</code> configuration value, your jobs may be processed twice.</p>
</blockquote>

<h4>Worker Sleep Duration</h4>

<p>When jobs are available on the queue, the worker will keep processing jobs with no delay in between them. However, the <code>sleep</code> option determines how long (in seconds) the worker will &quot;sleep&quot; if there are no new jobs available. While sleeping, the worker will not process any new jobs - the jobs will be processed after the worker wakes up again.</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p><a name="supervisor-configuration"></a></p>

<h2>Supervisor Configuration</h2>

<h4>Installing Supervisor</h4>

<p>Supervisor is a process monitor for the Linux operating system, and will automatically restart your <code>queue:work</code> process if it fails. To install Supervisor on Ubuntu, you may use the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">supervisor</span>
</pre></div>

<blockquote>
<p>{tip} If configuring Supervisor yourself sounds overwhelming, consider using <a href="https://forge.laravel.com">Laravel Forge</a>, which will automatically install and configure Supervisor for your Laravel projects.</p>
</blockquote>

<h4>Configuring Supervisor</h4>

<p>Supervisor configuration files are typically stored in the <code>/etc/supervisor/conf.d</code> directory. Within this directory, you may create any number of configuration files that instruct supervisor how your processes should be monitored. For example, let&#39;s create a <code>laravel-worker.conf</code> file that starts and monitors a <code>queue:work</code> process:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">program</span><span class="o">:</span><span class="nx">laravel</span><span class="o">-</span><span class="nx">worker</span><span class="p">]</span>
<span class="nx">process_name</span><span class="o">=%</span><span class="p">(</span><span class="nx">program_name</span><span class="p">)</span><span class="nx">s_</span><span class="o">%</span><span class="p">(</span><span class="nx">process_num</span><span class="p">)</span><span class="mi">02</span><span class="nx">d</span>
<span class="nx">command</span><span class="o">=</span><span class="nx">php</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">forge</span><span class="o">/</span><span class="nx">app</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">sqs</span> <span class="o">--</span><span class="nx">sleep</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
<span class="nx">autostart</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">autorestart</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">user</span><span class="o">=</span><span class="nx">forge</span>
<span class="nx">numprocs</span><span class="o">=</span><span class="mi">8</span>
<span class="nx">redirect_stderr</span><span class="o">=</span><span class="kc">true</span>
<span class="nx">stdout_logfile</span><span class="o">=</span><span class="err">/home/forge/app.com/worker.log</span>
<span class="nx">stopwaitsecs</span><span class="o">=</span><span class="mi">3600</span>
</pre></div>

<p>In this example, the <code>numprocs</code> directive will instruct Supervisor to run 8 <code>queue:work</code> processes and monitor all of them, automatically restarting them if they fail. You should change the <code>queue:work sqs</code> portion of the <code>command</code> directive to reflect your desired queue connection.</p>

<blockquote>
<p>{note} You should ensure that the value of <code>stopwaitsecs</code> is greater than the number of seconds consumed by your longest running job. Otherwise, Supervisor may kill the job before it is finished processing.</p>
</blockquote>

<h4>Starting Supervisor</h4>

<p>Once the configuration file has been created, you may update the Supervisor configuration and start the processes using the following commands:</p>
<div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">reread</span>

<span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">update</span>

<span class="nx">sudo</span> <span class="nx">supervisorctl</span> <span class="nx">start</span> <span class="nx">laravel</span><span class="o">-</span><span class="nx">worker</span><span class="o">:*</span>
</pre></div>

<p>For more information on Supervisor, consult the <a href="http://supervisord.org/index.html">Supervisor documentation</a>.</p>

<p><a name="dealing-with-failed-jobs"></a></p>

<h2>Dealing With Failed Jobs</h2>

<p>Sometimes your queued jobs will fail. Don&#39;t worry, things don&#39;t always go as planned! Laravel includes a convenient way to specify the maximum number of times a job should be attempted. After a job has exceeded this amount of attempts, it will be inserted into the <code>failed_jobs</code> database table. To create a migration for the <code>failed_jobs</code> table, you may use the <code>queue:failed-table</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span><span class="o">-</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>Then, when running your <a href="#running-the-queue-worker">queue worker</a>, you can specify the maximum number of times a job should be attempted using the <code>--tries</code> switch on the <code>queue:work</code> command. If you do not specify a value for the <code>--tries</code> option, jobs will only be attempted once:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">redis</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>In addition, you may specify how many seconds Laravel should wait before retrying a job that has failed using the <code>--backoff</code> option. By default, a job is retried immediately:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">work</span> <span class="nx">redis</span> <span class="o">--</span><span class="nx">tries</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="nx">backoff</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<p>If you would like to configure the failed job retry delay on a per-job basis, you may do so by defining a <code>backoff</code> property on your queued job class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The number of seconds to wait before retrying the job.</span>
<span class="cm"> *</span>
<span class="cm"> * @var int</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="nx">$backoff</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>

<p>If you require more complex logic for determining the retry delay, you may define a <code>backoff</code> method on your queued job class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">* Calculate the number of seconds to wait before retrying the job.</span>
<span class="cm">*</span>
<span class="cm">* @return int</span>
<span class="cm">*/</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">backoff</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>You may easily configure &quot;exponential&quot; backoffs by returning an array of backoff values from the <code>backoff</code> method. In this example, the retry delay will be 1 seconds for the first retry, 5 seconds for the second retry, and 10 seconds for the third retry:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">* Calculate the number of seconds to wait before retrying the job.</span>
<span class="cm">*</span>
<span class="cm">* @return array</span>
<span class="cm">*/</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">backoff</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="cleaning-up-after-failed-jobs"></a></p>

<h3>Cleaning Up After Failed Jobs</h3>

<p>You may define a <code>failed</code> method directly on your job class, allowing you to perform job specific clean-up when a failure occurs. This is the perfect location to send an alert to your users or revert any actions performed by the job. The <code>Throwable</code> exception that caused the job to fail will be passed to the <code>failed</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Podcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Services\AudioProcessor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessPodcast</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$podcast</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new job instance.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Models\Podcast  $podcast</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Podcast</span> <span class="nv">$podcast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">podcast</span> <span class="o">=</span> <span class="nv">$podcast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \App\Services\AudioProcessor  $processor</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">AudioProcessor</span> <span class="nv">$processor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Process uploaded podcast...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle a job failure.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Throwable  $exception</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Send user notification of failure, etc...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="failed-job-events"></a></p>

<h3>Failed Job Events</h3>

<p>If you would like to register an event that will be called when a job fails, you may use the <code>Queue::failing</code> method. This event is a great opportunity to notify your team via email or <a href="https://www.slack.com">Slack</a>. For example, we may attach a callback to this event from the <code>AppServiceProvider</code> that is included with Laravel:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\Events\JobFailed</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">failing</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">JobFailed</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// $event-&gt;connectionName</span>
            <span class="c1">// $event-&gt;job</span>
            <span class="c1">// $event-&gt;exception</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="retrying-failed-jobs"></a></p>

<h3>Retrying Failed Jobs</h3>

<p>To view all of your failed jobs that have been inserted into your <code>failed_jobs</code> database table, you may use the <code>queue:failed</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">failed</span>
</pre></div>

<p>The <code>queue:failed</code> command will list the job ID, connection, queue, failure time, and other information about the job. The job ID may be used to retry the failed job. For instance, to retry a failed job that has an ID of <code>5</code>, issue the following command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="mi">5</span>
</pre></div>

<p>If necessary, you may pass multiple IDs or an ID range (when using numeric IDs) to the command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="o">--</span><span class="nx">range</span><span class="o">=</span><span class="mi">5</span><span class="o">-</span><span class="mi">10</span>
</pre></div>

<p>To retry all of your failed jobs, execute the <code>queue:retry</code> command and pass <code>all</code> as the ID:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">retry</span> <span class="nx">all</span>
</pre></div>

<p>If you would like to delete a failed job, you may use the <code>queue:forget</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">forget</span> <span class="mi">5</span>
</pre></div>

<p>To delete all of your failed jobs, you may use the <code>queue:flush</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">queue</span><span class="o">:</span><span class="nx">flush</span>
</pre></div>

<p><a name="ignoring-missing-models"></a></p>

<h3>Ignoring Missing Models</h3>

<p>When injecting an Eloquent model into a job, it is automatically serialized before being placed on the queue and restored when the job is processed. However, if the model has been deleted while the job was waiting to be processed by a worker, your job may fail with a <code>ModelNotFoundException</code>.</p>

<p>For convenience, you may choose to automatically delete jobs with missing models by setting your job&#39;s <code>deleteWhenMissingModels</code> property to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Delete the job if its models no longer exist.</span>
<span class="cm"> *</span>
<span class="cm"> * @var bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="nx">$deleteWhenMissingModels</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>

<p><a name="job-events"></a></p>

<h2>Job Events</h2>

<p>Using the <code>before</code> and <code>after</code> methods on the <code>Queue</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>, you may specify callbacks to be executed before or after a queued job is processed. These callbacks are a great opportunity to perform additional logging or increment statistics for a dashboard. Typically, you should call these methods from a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. For example, we may use the <code>AppServiceProvider</code> that is included with Laravel:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\Events\JobProcessed</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\Events\JobProcessing</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Queue</span><span class="o">::</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">JobProcessing</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// $event-&gt;connectionName</span>
            <span class="c1">// $event-&gt;job</span>
            <span class="c1">// $event-&gt;job-&gt;payload()</span>
        <span class="p">});</span>

        <span class="nx">Queue</span><span class="o">::</span><span class="na">after</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">JobProcessed</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// $event-&gt;connectionName</span>
            <span class="c1">// $event-&gt;job</span>
            <span class="c1">// $event-&gt;job-&gt;payload()</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Using the <code>looping</code> method on the <code>Queue</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>, you may specify callbacks that execute before the worker attempts to fetch a job from a queue. For example, you might register a Closure to rollback any transactions that were left open by a previously failed job:</p>
<div class="highlight"><pre><span></span><span class="nx">Queue</span><span class="o">::</span><span class="nx">looping</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">DB</span><span class="o">::</span><span class="nx">transactionLevel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="nx">rollBack</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Redirects</h1>

<ul>
<li><a href="#creating-redirects">Creating Redirects</a></li>
<li><a href="#redirecting-named-routes">Redirecting To Named Routes</a></li>
<li><a href="#redirecting-controller-actions">Redirecting To Controller Actions</a></li>
<li><a href="#redirecting-with-flashed-session-data">Redirecting With Flashed Session Data</a></li>
</ul>

<p><a name="creating-redirects"></a></p>

<h2>Creating Redirects</h2>

<p>Redirect responses are instances of the <code>Illuminate\Http\RedirectResponse</code> class, and contain the proper headers needed to redirect the user to another URL. There are several ways to generate a <code>RedirectResponse</code> instance. The simplest method is to use the global <code>redirect</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home/dashboard&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Sometimes you may wish to redirect the user to their previous location, such as when a submitted form is invalid. You may do so by using the global <code>back</code> helper function. Since this feature utilizes the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>, make sure the route calling the <code>back</code> function is using the <code>web</code> middleware group or has all of the session middleware applied:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Validate the request...</span>

    <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="redirecting-named-routes"></a></p>

<h2>Redirecting To Named Routes</h2>

<p>When you call the <code>redirect</code> helper with no parameters, an instance of <code>Illuminate\Routing\Redirector</code> is returned, allowing you to call any method on the <code>Redirector</code> instance. For example, to generate a <code>RedirectResponse</code> to a named route, you may use the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>If your route has parameters, you may pass them as the second argument to the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Populating Parameters Via Eloquent Models</h4>

<p>If you are redirecting to a route with an &quot;ID&quot; parameter that is being populated from an Eloquent model, you may pass the model itself. The ID will be extracted automatically:</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$user</span><span class="p">]);</span>
</pre></div>

<p>If you would like to customize the value that is placed in the route parameter, you should override the <code>getRouteKey</code> method on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the value of the model&#39;s route key.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRouteKey</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">slug</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="redirecting-controller-actions"></a></p>

<h2>Redirecting To Controller Actions</h2>

<p>You may also generate redirects to <a href="/docs/%7B%7Bversion%7D%7D/controllers">controller actions</a>. To do so, pass the controller and action name to the <code>action</code> method. Remember, you do not need to specify the full namespace to the controller since Laravel&#39;s <code>RouteServiceProvider</code> will automatically set the base controller namespace:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<p>If your controller route requires parameters, you may pass them as the second argument to the <code>action</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span>
    <span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p><a name="redirecting-with-flashed-session-data"></a></p>

<h2>Redirecting With Flashed Session Data</h2>

<p>Redirecting to a new URL and <a href="/docs/%7B%7Bversion%7D%7D/session#flash-data">flashing data to the session</a> are usually done at the same time. Typically, this is done after successfully performing an action when you flash a success message to the session. For convenience, you may create a <code>RedirectResponse</code> instance and flash data to the session in a single, fluent method chain:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Update the user&#39;s profile...</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile updated!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>After the user is redirected, you may display the flashed message from the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">))</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-success&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Redis</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#predis">Predis</a></li>
<li><a href="#phpredis">PhpRedis</a></li>
</ul></li>
<li><a href="#interacting-with-redis">Interacting With Redis</a>

<ul>
<li><a href="#pipelining-commands">Pipelining Commands</a></li>
</ul></li>
<li><a href="#pubsub">Pub / Sub</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p><a href="https://redis.io">Redis</a> is an open source, advanced key-value store. It is often referred to as a data structure server since keys can contain <a href="https://redis.io/topics/data-types#strings">strings</a>, <a href="https://redis.io/topics/data-types#hashes">hashes</a>, <a href="https://redis.io/topics/data-types#lists">lists</a>, <a href="https://redis.io/topics/data-types#sets">sets</a>, and <a href="https://redis.io/topics/data-types#sorted-sets">sorted sets</a>.</p>

<p>Before using Redis with Laravel, we encourage you to install and use the <a href="https://github.com/phpredis/phpredis">PhpRedis</a> PHP extension via PECL. The extension is more complex to install but may yield better performance for applications that make heavy use of Redis.</p>

<p>Alternatively, you can install the <code>predis/predis</code> package via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">predis</span><span class="o">/</span><span class="nx">predis</span>
</pre></div>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>The Redis configuration for your application is located in the <code>config/database.php</code> configuration file. Within this file, you will see a <code>redis</code> array containing the Redis servers utilized by your application:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">],</span>

    <span class="s1">&#39;cache&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CACHE_DB&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<p>The default server configuration should suffice for development. However, you are free to modify this array based on your environment. Each Redis server defined in your configuration file is required to have a name, host, and port unless you define a single URL to represent the Redis connection:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;tcp://127.0.0.1:6379?database=0&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;cache&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;tls://user:password@127.0.0.1:6380?database=1&#39;</span><span class="p">,</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<h4>Configuring The Connection Scheme</h4>

<p>By default, Redis clients will use the <code>tcp</code> scheme when connecting to your Reids servers; however, you may use TLS / SSL encryption by specifying a <code>scheme</code> configuration option in your Redis server configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;scheme&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;tls&#39;</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<h4>Configuring Clusters</h4>

<p>If your application is utilizing a cluster of Redis servers, you should define these clusters within a <code>clusters</code> key of your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;clusters&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span>
                <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
                <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
                <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<p>By default, clusters will perform client-side sharding across your nodes, allowing you to pool nodes and create a large amount of available RAM. However, note that client-side sharding does not handle failover; therefore, is primarily suited for cached data that is available from another primary data store. If you would like to use native Redis clustering, you should specify this in the <code>options</code> key of your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;options&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;cluster&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLUSTER&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">),</span>
    <span class="p">],</span>

    <span class="s1">&#39;clusters&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="c1">// ...</span>
    <span class="p">],</span>

<span class="p">],</span>
</pre></div>

<p><a name="predis"></a></p>

<h3>Predis</h3>

<p>To utilize the Predis extension, you should change the <code>REDIS_CLIENT</code> environment variable from <code>phpredis</code> to <code>predis</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;predis&#39;</span><span class="p">),</span>

    <span class="c1">// Rest of Redis configuration...</span>
<span class="p">],</span>
</pre></div>

<p>In addition to the default <code>host</code>, <code>port</code>, <code>database</code>, and <code>password</code> server configuration options, Predis supports additional <a href="https://github.com/nrk/predis/wiki/Connection-Parameters">connection parameters</a> that may be defined for each of your Redis servers. To utilize these additional configuration options, add them to your Redis server configuration in the <code>config/database.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
    <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;read_write_timeout&#39;</span> <span class="p">=&gt;</span> <span class="mi">60</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="phpredis"></a></p>

<h3>PhpRedis</h3>

<p>The PhpRedis extension is configured as default at <code>REDIS_CLIENT</code> env and in your <code>config/database.php</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;redis&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="c1">// Rest of Redis configuration...</span>
<span class="p">],</span>
</pre></div>

<p>If you plan to use PhpRedis extension along with the <code>Redis</code> Facade alias, you should rename it to something else, like <code>RedisManager</code>, to avoid a collision with the Redis class. You can do that in the aliases section of your <code>app.php</code> config file.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;RedisManager&#39;</span> <span class="p">=&gt;</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Redis</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
</pre></div>

<p>In addition to the default <code>host</code>, <code>port</code>, <code>database</code>, and <code>password</code> server configuration options, PhpRedis supports the following additional connection parameters: <code>persistent</code>, <code>prefix</code>, <code>read_timeout</code>, <code>timeout</code>, and <code>context</code>. You may add any of these options to your Redis server configuration in the <code>config/database.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;default&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;host&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span>
    <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span>
    <span class="s1">&#39;port&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">),</span>
    <span class="s1">&#39;database&#39;</span> <span class="p">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;read_timeout&#39;</span> <span class="p">=&gt;</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s1">&#39;context&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="c1">// &#39;auth&#39; =&gt; [&#39;username&#39;, &#39;secret&#39;],</span>
        <span class="c1">// &#39;stream&#39; =&gt; [&#39;verify_peer&#39; =&gt; false],</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>The Redis Facade</h4>

<p>To avoid class naming collisions with the Redis PHP extension itself, you will need to delete or rename the <code>Illuminate\Support\Facades\Redis</code> facade alias from your <code>app</code> configuration file&#39;s <code>aliases</code> array. Generally, you should remove this alias entirely and only reference the facade by its fully qualified class name while using the Redis PHP extension.</p>

<p><a name="interacting-with-redis"></a></p>

<h2>Interacting With Redis</h2>

<p>You may interact with Redis by calling various methods on the <code>Redis</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>Redis</code> facade supports dynamic methods, meaning you may call any <a href="https://redis.io/commands">Redis command</a> on the facade and the command will be passed directly to Redis. In this example, we will call the Redis <code>GET</code> command by calling the <code>get</code> method on the <code>Redis</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Redis</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showProfile</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user:profile:&#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As mentioned above, you may call any of the Redis commands on the <code>Redis</code> facade. Laravel uses magic methods to pass the commands to the Redis server, so pass the arguments the Redis command expects:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">);</span>

<span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">lrange</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may also pass commands to the server using the <code>command</code> method, which accepts the name of the command as its first argument, and an array of values as its second argument:</p>
<div class="highlight"><pre><span></span><span class="nx">$values</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;lrange&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]);</span>
</pre></div>

<h4>Using Multiple Redis Connections</h4>

<p>You may get a Redis instance by calling the <code>Redis::connection</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">();</span>
</pre></div>

<p>This will give you an instance of the default Redis server. You may also pass the connection or cluster name to the <code>connection</code> method to get a specific server or cluster as defined in your Redis configuration:</p>
<div class="highlight"><pre><span></span><span class="nx">$redis</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="nx">connection</span><span class="p">(</span><span class="s1">&#39;my-connection&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="pipelining-commands"></a></p>

<h3>Pipelining Commands</h3>

<p>Pipelining should be used when you need to send many commands to the server. The <code>pipeline</code> method accepts one argument: a <code>Closure</code> that receives a Redis instance. You may issue all of your commands to this Redis instance and they will all be streamed to the server thus providing better performance:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">pipeline</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$pipe</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">$i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$pipe</span><span class="o">-&gt;</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;key:$i&quot;</span><span class="p">,</span> <span class="nx">$i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p><a name="pubsub"></a></p>

<h2>Pub / Sub</h2>

<p>Laravel provides a convenient interface to the Redis <code>publish</code> and <code>subscribe</code> commands. These Redis commands allow you to listen for messages on a given &quot;channel&quot;. You may publish messages to the channel from another application, or even using another programming language, allowing easy communication between applications and processes.</p>

<p>First, let&#39;s setup a channel listener using the <code>subscribe</code> method. We&#39;ll place this method call within an <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> since calling the <code>subscribe</code> method begins a long-running process:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Redis</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RedisSubscribe</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The name and signature of the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;redis:subscribe&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The console command description.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;Subscribe to a Redis channel&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the console command.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Redis</span><span class="o">::</span><span class="na">subscribe</span><span class="p">([</span><span class="s1">&#39;test-channel&#39;</span><span class="p">],</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now we may publish messages to the channel using the <code>publish</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Route logic...</span>

    <span class="nx">Redis</span><span class="o">::</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;test-channel&#39;</span><span class="p">,</span> <span class="nx">json_encode</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]));</span>
<span class="p">});</span>
</pre></div>

<h4>Wildcard Subscriptions</h4>

<p>Using the <code>psubscribe</code> method, you may subscribe to a wildcard channel, which may be useful for catching all messages on all channels. The <code>$channel</code> name will be passed as the second argument to the provided callback <code>Closure</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Redis</span><span class="o">::</span><span class="nx">psubscribe</span><span class="p">([</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$message</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Redis</span><span class="o">::</span><span class="nx">psubscribe</span><span class="p">([</span><span class="s1">&#39;users.*&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">$message</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Release Notes</h1>

<ul>
<li><a href="#versioning-scheme">Versioning Scheme</a></li>
<li><a href="#support-policy">Support Policy</a></li>
<li><a href="#laravel-9">Laravel 9</a></li>
</ul>

<p><a name="versioning-scheme"></a></p>

<h2>Versioning Scheme</h2>

<p>Laravel and its other first-party packages follow <a href="https://semver.org">Semantic Versioning</a>. Major framework releases are released every six months (~February and ~August), while minor and patch releases may be released as often as every week. Minor and patch releases should <strong>never</strong> contain breaking changes.</p>

<p>When referencing the Laravel framework or its components from your application or package, you should always use a version constraint such as <code>^8.0</code>, since major releases of Laravel do include breaking changes. However, we strive to always ensure you may update to a new major release in one day or less.</p>

<p><a name="support-policy"></a></p>

<h2>Support Policy</h2>

<p>For LTS releases, such as Laravel 6, bug fixes are provided for 2 years and security fixes are provided for 3 years. These releases provide the longest window of support and maintenance. For general releases, bug fixes are provided for 6 months and security fixes are provided for 1 year. For all additional libraries, including Lumen, only the latest release receives bug fixes. In addition, please review the database versions <a href="/docs/%7B%7Bversion%7D%7D/database#introduction">supported by Laravel</a>.</p>

<p>| Version | Release | Bug Fixes Until | Security Fixes Until |
| --- | --- | --- | --- |
| 5.5 (LTS) | August 30th, 2017 | August 30th, 2019 | August 30th, 2020 |
| 5.6 | February 7th, 2018 | August 7th, 2018 | February 7th, 2019 |
| 5.7 | September 4th, 2018 | March 4th, 2019 | September 4th, 2019 |
| 5.8 | February 26th, 2019 | August 26th, 2019 | February 26th, 2020 |
| 6 (LTS) | September 3rd, 2019 | September 3rd, 2021 | September 3rd, 2022 |
| 7 | March 3rd, 2020 | September 10th, 2020 | March 3rd, 2021 |
| 8 | September 8th, 2020 | March 8th, 2021 | September 8th, 2021 |</p>

<p><a name="laravel-9"></a></p>

<h2>Laravel 9</h2>

<p>Coming soon...</p>
<div style="page-break-after: always;" ></div><h1>HTTP Requests</h1>

<ul>
<li><a href="#accessing-the-request">Accessing The Request</a>

<ul>
<li><a href="#request-path-and-method">Request Path &amp; Method</a></li>
<li><a href="#psr7-requests">PSR-7 Requests</a></li>
</ul></li>
<li><a href="#input-trimming-and-normalization">Input Trimming &amp; Normalization</a></li>
<li><a href="#retrieving-input">Retrieving Input</a>

<ul>
<li><a href="#old-input">Old Input</a></li>
<li><a href="#cookies">Cookies</a></li>
</ul></li>
<li><a href="#files">Files</a>

<ul>
<li><a href="#retrieving-uploaded-files">Retrieving Uploaded Files</a></li>
<li><a href="#storing-uploaded-files">Storing Uploaded Files</a></li>
</ul></li>
<li><a href="#configuring-trusted-proxies">Configuring Trusted Proxies</a></li>
</ul>

<p><a name="accessing-the-request"></a></p>

<h2>Accessing The Request</h2>

<p>To obtain an instance of the current HTTP request via dependency injection, you should type-hint the <code>Illuminate\Http\Request</code> class on your controller method. The incoming request instance will automatically be injected by the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Dependency Injection &amp; Route Parameters</h4>

<p>If your controller method is also expecting input from a route parameter you should list your route parameters after your other dependencies. For example, if your route is defined like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">UserController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">]);</span>
</pre></div>

<p>You may still type-hint the <code>Illuminate\Http\Request</code> and access your route parameter <code>id</code> by defining your controller method as follows:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Update the specified user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  string  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Accessing The Request Via Route Closures</h4>

<p>You may also type-hint the <code>Illuminate\Http\Request</code> class on a route Closure. The service container will automatically inject the incoming request into the Closure when it is executed:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p><a name="request-path-and-method"></a></p>

<h3>Request Path &amp; Method</h3>

<p>The <code>Illuminate\Http\Request</code> instance provides a variety of methods for examining the HTTP request for your application and extends the <code>Symfony\Component\HttpFoundation\Request</code> class. We will discuss a few of the most important methods below.</p>

<h4>Retrieving The Request Path</h4>

<p>The <code>path</code> method returns the request&#39;s path information. So, if the incoming request is targeted at <code>http://domain.com/foo/bar</code>, the <code>path</code> method will return <code>foo/bar</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$uri</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">path</span><span class="p">();</span>
</pre></div>

<p>The <code>is</code> method allows you to verify that the incoming request path matches a given pattern. You may use the <code>*</code> character as a wildcard when utilizing this method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;admin/*&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving The Request URL</h4>

<p>To retrieve the full URL for the incoming request you may use the <code>url</code> or <code>fullUrl</code> methods. The <code>url</code> method will return the URL without the query string, while the <code>fullUrl</code> method includes the query string:</p>
<div class="highlight"><pre><span></span><span class="c1">// Without Query String...</span>
<span class="nx">$url</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">url</span><span class="p">();</span>

<span class="c1">// With Query String...</span>
<span class="nx">$url</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">fullUrl</span><span class="p">();</span>
</pre></div>

<h4>Retrieving The Request Method</h4>

<p>The <code>method</code> method will return the HTTP verb for the request. You may use the <code>isMethod</code> method to verify that the HTTP verb matches a given string:</p>
<div class="highlight"><pre><span></span><span class="nx">$method</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">method</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">isMethod</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="psr7-requests"></a></p>

<h3>PSR-7 Requests</h3>

<p>The <a href="https://www.php-fig.org/psr/psr-7/">PSR-7 standard</a> specifies interfaces for HTTP messages, including requests and responses. If you would like to obtain an instance of a PSR-7 request instead of a Laravel request, you will first need to install a few libraries. Laravel uses the <em>Symfony HTTP Message Bridge</em> component to convert typical Laravel requests and responses into PSR-7 compatible implementations:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">symfony</span><span class="o">/</span><span class="nx">psr</span><span class="o">-</span><span class="nx">http</span><span class="o">-</span><span class="nx">message</span><span class="o">-</span><span class="nx">bridge</span>
<span class="nx">composer</span> <span class="nx">require</span> <span class="nx">nyholm</span><span class="o">/</span><span class="nx">psr7</span>
</pre></div>

<p>Once you have installed these libraries, you may obtain a PSR-7 request by type-hinting the request interface on your route Closure or controller method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Psr</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Message</span><span class="err">\</span><span class="nx">ServerRequestInterface</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ServerRequestInterface</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} If you return a PSR-7 response instance from a route or controller, it will automatically be converted back to a Laravel response instance and be displayed by the framework.</p>
</blockquote>

<p><a name="input-trimming-and-normalization"></a></p>

<h2>Input Trimming &amp; Normalization</h2>

<p>By default, Laravel includes the <code>TrimStrings</code> and <code>ConvertEmptyStringsToNull</code> middleware in your application&#39;s global middleware stack. These middleware are listed in the stack by the <code>App\Http\Kernel</code> class. These middleware will automatically trim all incoming string fields on the request, as well as convert any empty string fields to <code>null</code>. This allows you to not have to worry about these normalization concerns in your routes and controllers.</p>

<p>If you would like to disable this behavior, you may remove the two middleware from your application&#39;s middleware stack by removing them from the <code>$middleware</code> property of your <code>App\Http\Kernel</code> class.</p>

<p><a name="retrieving-input"></a></p>

<h2>Retrieving Input</h2>

<h4>Retrieving All Input Data</h4>

<p>You may also retrieve all of the input data as an <code>array</code> using the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Retrieving An Input Value</h4>

<p>Using a few simple methods, you may access all of the user input from your <code>Illuminate\Http\Request</code> instance without worrying about which HTTP verb was used for the request. Regardless of the HTTP verb, the <code>input</code> method may be used to retrieve user input:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>You may pass a default value as the second argument to the <code>input</code> method. This value will be returned if the requested input value is not present on the request:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">);</span>
</pre></div>

<p>When working with forms that contain array inputs, use &quot;dot&quot; notation to access the arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;products.0.name&#39;</span><span class="p">);</span>

<span class="nx">$names</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;products.*.name&#39;</span><span class="p">);</span>
</pre></div>

<p>You may call the <code>input</code> method without any arguments in order to retrieve all of the input values as an associative array:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">();</span>
</pre></div>

<h4>Retrieving Input From The Query String</h4>

<p>While the <code>input</code> method retrieves values from entire request payload (including the query string), the <code>query</code> method will only retrieve values from the query string:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>If the requested query string value data is not present, the second argument to this method will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Helen&#39;</span><span class="p">);</span>
</pre></div>

<p>You may call the <code>query</code> method without any arguments in order to retrieve all of the query string values as an associative array:</p>
<div class="highlight"><pre><span></span><span class="nx">$query</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">query</span><span class="p">();</span>
</pre></div>

<h4>Retrieving Input Via Dynamic Properties</h4>

<p>You may also access user input using dynamic properties on the <code>Illuminate\Http\Request</code> instance. For example, if one of your application&#39;s forms contains a <code>name</code> field, you may access the value of the field like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">;</span>
</pre></div>

<p>When using dynamic properties, Laravel will first look for the parameter&#39;s value in the request payload. If it is not present, Laravel will search for the field in the route parameters.</p>

<h4>Retrieving JSON Input Values</h4>

<p>When sending JSON requests to your application, you may access the JSON data via the <code>input</code> method as long as the <code>Content-Type</code> header of the request is properly set to <code>application/json</code>. You may even use &quot;dot&quot; syntax to dig into JSON arrays:</p>
<div class="highlight"><pre><span></span><span class="nx">$name</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;user.name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving Boolean Input Values</h4>

<p>When dealing with HTML elements like checkboxes, your application may receive &quot;truthy&quot; values that are actually strings. For example, &quot;true&quot; or &quot;on&quot;. For convenience, you may use the <code>boolean</code> method to retrieve these values as booleans. The <code>boolean</code> method returns <code>true</code> for 1, &quot;1&quot;, true, &quot;true&quot;, &quot;on&quot;, and &quot;yes&quot;. All other values will return <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$archived</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="kr">boolean</span><span class="p">(</span><span class="s1">&#39;archived&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving A Portion Of The Input Data</h4>

<p>If you need to retrieve a subset of the input data, you may use the <code>only</code> and <code>except</code> methods. Both of these methods accept a single <code>array</code> or a dynamic list of arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">]);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">only</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">([</span><span class="s1">&#39;credit_card&#39;</span><span class="p">]);</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;credit_card&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{tip} The <code>only</code> method returns all of the key / value pairs that you request; however, it will not return key / value pairs that are not present on the request.</p>
</blockquote>

<h4>Determining If An Input Value Is Present</h4>

<p>You should use the <code>has</code> method to determine if a value is present on the request. The <code>has</code> method returns <code>true</code> if the value is present on the request:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>When given an array, the <code>has</code> method will determine if all of the specified values are present:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>The <code>hasAny</code> method returns <code>true</code> if any of the specified values are present:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">hasAny</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to determine if a value is present on the request and is not empty, you may use the <code>filled</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">filled</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if a given key is absent from the request, you may use the <code>missing</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">missing</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="old-input"></a></p>

<h3>Old Input</h3>

<p>Laravel allows you to keep input from one request during the next request. This feature is particularly useful for re-populating forms after detecting validation errors. However, if you are using Laravel&#39;s included <a href="/docs/%7B%7Bversion%7D%7D/validation">validation features</a>, it is unlikely you will need to manually use these methods, as some of Laravel&#39;s built-in validation facilities will call them automatically.</p>

<h4>Flashing Input To The Session</h4>

<p>The <code>flash</code> method on the <code>Illuminate\Http\Request</code> class will flash the current input to the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a> so that it is available during the user&#39;s next request to the application:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flash</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>flashOnly</code> and <code>flashExcept</code> methods to flash a subset of the request data to the session. These methods are useful for keeping sensitive information such as passwords out of the session:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flashOnly</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]);</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">flashExcept</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
</pre></div>

<h4>Flashing Input Then Redirecting</h4>

<p>Since you often will want to flash input to the session and then redirect to the previous page, you may easily chain input flashing onto a redirect using the <code>withInput</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">(</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">except</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>

<h4>Retrieving Old Input</h4>

<p>To retrieve flashed input from the previous request, use the <code>old</code> method on the <code>Request</code> instance. The <code>old</code> method will pull the previously flashed input data from the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$username</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">old</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>

<p>Laravel also provides a global <code>old</code> helper. If you are displaying old input within a <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade template</a>, it is more convenient to use the <code>old</code> helper. If no old input exists for the given field, <code>null</code> will be returned:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ old(&#39;username&#39;) }}&quot;</span><span class="o">&gt;</span>
</pre></div>

<p><a name="cookies"></a></p>

<h3>Cookies</h3>

<h4>Retrieving Cookies From Requests</h4>

<p>All cookies created by the Laravel framework are encrypted and signed with an authentication code, meaning they will be considered invalid if they have been changed by the client. To retrieve a cookie value from the request, use the <code>cookie</code> method on a <code>Illuminate\Http\Request</code> instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may use the <code>Cookie</code> facade to access cookie values:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Cookie</span><span class="p">;</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</pre></div>

<h4>Attaching Cookies To Responses</h4>

<p>You may attach a cookie to an outgoing <code>Illuminate\Http\Response</code> instance using the <code>cookie</code> method. You should pass the name, value, and number of minutes the cookie should be considered valid to this method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span>
<span class="p">);</span>
</pre></div>

<p>The <code>cookie</code> method also accepts a few more arguments which are used less frequently. Generally, these arguments have the same purpose and meaning as the arguments that would be given to PHP&#39;s native <a href="https://secure.php.net/manual/en/function.setcookie.php">setcookie</a> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="nx">$path</span><span class="p">,</span> <span class="nx">$domain</span><span class="p">,</span> <span class="nx">$secure</span><span class="p">,</span> <span class="nx">$httpOnly</span>
<span class="p">);</span>
</pre></div>

<p>Alternatively, you can use the <code>Cookie</code> facade to &quot;queue&quot; cookies for attachment to the outgoing response from your application. The <code>queue</code> method accepts a <code>Cookie</code> instance or the arguments needed to create a <code>Cookie</code> instance. These cookies will be attached to the outgoing response before it is sent to the browser:</p>
<div class="highlight"><pre><span></span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">));</span>

<span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<h4>Generating Cookie Instances</h4>

<p>If you would like to generate a <code>Symfony\Component\HttpFoundation\Cookie</code> instance that can be given to a response instance at a later time, you may use the global <code>cookie</code> helper. This cookie will not be sent back to the client unless it is attached to a response instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span><span class="nx">$cookie</span><span class="p">);</span>
</pre></div>

<h4>Expiring Cookies Early</h4>

<p>You may remove a cookie by expiring it via the <code>forget</code> method of the <code>Cookie</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
</pre></div>

<p>Alternatively, you may attach the expired cookie to a response instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$cookie</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="o">::</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withCookie</span><span class="p">(</span><span class="nx">$cookie</span><span class="p">);</span>
</pre></div>

<p><a name="files"></a></p>

<h2>Files</h2>

<p><a name="retrieving-uploaded-files"></a></p>

<h3>Retrieving Uploaded Files</h3>

<p>You may access uploaded files from a <code>Illuminate\Http\Request</code> instance using the <code>file</code> method or using dynamic properties. The <code>file</code> method returns an instance of the <code>Illuminate\Http\UploadedFile</code> class, which extends the PHP <code>SplFileInfo</code> class and provides a variety of methods for interacting with the file:</p>
<div class="highlight"><pre><span></span><span class="nx">$file</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">);</span>

<span class="nx">$file</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="p">;</span>
</pre></div>

<p>You may determine if a file is present on the request using the <code>hasFile</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">hasFile</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Validating Successful Uploads</h4>

<p>In addition to checking if the file is present, you may verify that there were no problems uploading the file via the <code>isValid</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">isValid</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>File Paths &amp; Extensions</h4>

<p>The <code>UploadedFile</code> class also contains methods for accessing the file&#39;s fully-qualified path and its extension. The <code>extension</code> method will attempt to guess the file&#39;s extension based on its contents. This extension may be different from the extension that was supplied by the client:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">path</span><span class="p">();</span>

<span class="nx">$extension</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">extension</span><span class="p">();</span>
</pre></div>

<h4>Other File Methods</h4>

<p>There are a variety of other methods available on <code>UploadedFile</code> instances. Check out the <a href="https://api.symfony.com/master/Symfony/Component/HttpFoundation/File/UploadedFile.html">API documentation for the class</a> for more information regarding these methods.</p>

<p><a name="storing-uploaded-files"></a></p>

<h3>Storing Uploaded Files</h3>

<p>To store an uploaded file, you will typically use one of your configured <a href="/docs/%7B%7Bversion%7D%7D/filesystem">filesystems</a>. The <code>UploadedFile</code> class has a <code>store</code> method which will move an uploaded file to one of your disks, which may be a location on your local filesystem or even a cloud storage location like Amazon S3.</p>

<p>The <code>store</code> method accepts the path where the file should be stored relative to the filesystem&#39;s configured root directory. This path should not contain a file name, since a unique ID will automatically be generated to serve as the file name.</p>

<p>The <code>store</code> method also accepts an optional second argument for the name of the disk that should be used to store the file. The method will return the path of the file relative to the disk&#39;s root:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">);</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">);</span>
</pre></div>

<p>If you do not want a file name to be automatically generated, you may use the <code>storeAs</code> method, which accepts the path, file name, and disk name as its arguments:</p>
<div class="highlight"><pre><span></span><span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">storeAs</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;filename.jpg&#39;</span><span class="p">);</span>

<span class="nx">$path</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">photo</span><span class="o">-&gt;</span><span class="nx">storeAs</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;filename.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="configuring-trusted-proxies"></a></p>

<h2>Configuring Trusted Proxies</h2>

<p>When running your applications behind a load balancer that terminates TLS / SSL certificates, you may notice your application sometimes does not generate HTTPS links. Typically this is because your application is being forwarded traffic from your load balancer on port 80 and does not know it should generate secure links.</p>

<p>To solve this, you may use the <code>App\Http\Middleware\TrustProxies</code> middleware that is included in your Laravel application, which allows you to quickly customize the load balancers or proxies that should be trusted by your application. Your trusted proxies should be listed as an array on the <code>$proxies</code> property of this middleware. In addition to configuring the trusted proxies, you may configure the proxy <code>$headers</code> that should be trusted:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Fideloper\Proxy\TrustProxies</span> <span class="k">as</span> <span class="nx">Middleware</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TrustProxies</span> <span class="k">extends</span> <span class="nx">Middleware</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The trusted proxies for this application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var string|array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$proxies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;192.168.1.2&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * The headers that should be used to detect proxies.</span>
<span class="sd">     *</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$headers</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">HEADER_X_FORWARDED_ALL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} If you are using AWS Elastic Load Balancing, your <code>$headers</code> value should be <code>Request::HEADER_X_FORWARDED_AWS_ELB</code>. For more information on the constants that may be used in the <code>$headers</code> property, check out Symfony&#39;s documentation on <a href="https://symfony.com/doc/current/deployment/proxies.html">trusting proxies</a>.</p>
</blockquote>

<h4>Trusting All Proxies</h4>

<p>If you are using Amazon AWS or another &quot;cloud&quot; load balancer provider, you may not know the IP addresses of your actual balancers. In this case, you may use <code>*</code> to trust all proxies:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The trusted proxies for this application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var string|array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$proxies</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Responses</h1>

<ul>
<li><a href="#creating-responses">Creating Responses</a>

<ul>
<li><a href="#attaching-headers-to-responses">Attaching Headers To Responses</a></li>
<li><a href="#attaching-cookies-to-responses">Attaching Cookies To Responses</a></li>
<li><a href="#cookies-and-encryption">Cookies &amp; Encryption</a></li>
</ul></li>
<li><a href="#redirects">Redirects</a>

<ul>
<li><a href="#redirecting-named-routes">Redirecting To Named Routes</a></li>
<li><a href="#redirecting-controller-actions">Redirecting To Controller Actions</a></li>
<li><a href="#redirecting-external-domains">Redirecting To External Domains</a></li>
<li><a href="#redirecting-with-flashed-session-data">Redirecting With Flashed Session Data</a></li>
</ul></li>
<li><a href="#other-response-types">Other Response Types</a>

<ul>
<li><a href="#view-responses">View Responses</a></li>
<li><a href="#json-responses">JSON Responses</a></li>
<li><a href="#file-downloads">File Downloads</a></li>
<li><a href="#file-responses">File Responses</a></li>
</ul></li>
<li><a href="#response-macros">Response Macros</a></li>
</ul>

<p><a name="creating-responses"></a></p>

<h2>Creating Responses</h2>

<h4>Strings &amp; Arrays</h4>

<p>All routes and controllers should return a response to be sent back to the user&#39;s browser. Laravel provides several different ways to return responses. The most basic response is returning a string from a route or controller. The framework will automatically convert the string into a full HTTP response:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>In addition to returning strings from your routes and controllers, you may also return arrays. The framework will automatically convert the array into a JSON response:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} Did you know you can also return <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">Eloquent collections</a> from your routes or controllers? They will automatically be converted to JSON. Give it a shot!</p>
</blockquote>

<h4>Response Objects</h4>

<p>Typically, you won&#39;t just be returning simple strings or arrays from your route actions. Instead, you will be returning full <code>Illuminate\Http\Response</code> instances or <a href="/docs/%7B%7Bversion%7D%7D/views">views</a>.</p>

<p>Returning a full <code>Response</code> instance allows you to customize the response&#39;s HTTP status code and headers. A <code>Response</code> instance inherits from the <code>Symfony\Component\HttpFoundation\Response</code> class, which provides a variety of methods for building HTTP responses:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                  <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="attaching-headers-to-responses"></a></p>

<h4>Attaching Headers To Responses</h4>

<p>Keep in mind that most response methods are chainable, allowing for the fluent construction of response instances. For example, you may use the <code>header</code> method to add a series of headers to the response before sending it back to the user:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;X-Header-One&#39;</span><span class="p">,</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;X-Header-Two&#39;</span><span class="p">,</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">);</span>
</pre></div>

<p>Or, you may use the <code>withHeaders</code> method to specify an array of headers to be added to the response:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">withHeaders</span><span class="p">([</span>
                <span class="s1">&#39;Content-Type&#39;</span> <span class="p">=&gt;</span> <span class="nx">$type</span><span class="p">,</span>
                <span class="s1">&#39;X-Header-One&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;X-Header-Two&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Header Value&#39;</span><span class="p">,</span>
            <span class="p">]);</span>
</pre></div>

<h4>Cache Control Middleware</h4>

<p>Laravel includes a <code>cache.headers</code> middleware, which may be used to quickly set the <code>Cache-Control</code> header for a group of routes. If <code>etag</code> is specified in the list of directives, an MD5 hash of the response content will automatically be set as the ETag identifier:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;cache.headers:public;max_age=2628000;etag&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;privacy&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;terms&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="attaching-cookies-to-responses"></a></p>

<h4>Attaching Cookies To Responses</h4>

<p>The <code>cookie</code> method on response instances allows you to easily attach cookies to the response. For example, you may use the <code>cookie</code> method to generate a cookie and fluently attach it to the response instance like so:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">$content</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p>The <code>cookie</code> method also accepts a few more arguments which are used less frequently. Generally, these arguments have the same purpose and meaning as the arguments that would be given to PHP&#39;s native <a href="https://secure.php.net/manual/en/function.setcookie.php">setcookie</a> method:</p>
<div class="highlight"><pre><span></span><span class="o">-&gt;</span><span class="nx">cookie</span><span class="p">(</span><span class="nx">$name</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">,</span> <span class="nx">$path</span><span class="p">,</span> <span class="nx">$domain</span><span class="p">,</span> <span class="nx">$secure</span><span class="p">,</span> <span class="nx">$httpOnly</span><span class="p">)</span>
</pre></div>

<p>Alternatively, you can use the <code>Cookie</code> facade to &quot;queue&quot; cookies for attachment to the outgoing response from your application. The <code>queue</code> method accepts a <code>Cookie</code> instance or the arguments needed to create a <code>Cookie</code> instance. These cookies will be attached to the outgoing response before it is sent to the browser:</p>
<div class="highlight"><pre><span></span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="nx">Cookie</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">));</span>

<span class="nx">Cookie</span><span class="o">::</span><span class="nx">queue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$minutes</span><span class="p">);</span>
</pre></div>

<p><a name="cookies-and-encryption"></a></p>

<h4>Cookies &amp; Encryption</h4>

<p>By default, all cookies generated by Laravel are encrypted and signed so that they can&#39;t be modified or read by the client. If you would like to disable encryption for a subset of cookies generated by your application, you may use the <code>$except</code> property of the <code>App\Http\Middleware\EncryptCookies</code> middleware, which is located in the <code>app/Http/Middleware</code> directory:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The names of the cookies that should not be encrypted.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$except</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;cookie_name&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="redirects"></a></p>

<h2>Redirects</h2>

<p>Redirect responses are instances of the <code>Illuminate\Http\RedirectResponse</code> class, and contain the proper headers needed to redirect the user to another URL. There are several ways to generate a <code>RedirectResponse</code> instance. The simplest method is to use the global <code>redirect</code> helper:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home/dashboard&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Sometimes you may wish to redirect the user to their previous location, such as when a submitted form is invalid. You may do so by using the global <code>back</code> helper function. Since this feature utilizes the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>, make sure the route calling the <code>back</code> function is using the <code>web</code> middleware group or has all of the session middleware applied:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Validate the request...</span>

    <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">withInput</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="redirecting-named-routes"></a></p>

<h3>Redirecting To Named Routes</h3>

<p>When you call the <code>redirect</code> helper with no parameters, an instance of <code>Illuminate\Routing\Redirector</code> is returned, allowing you to call any method on the <code>Redirector</code> instance. For example, to generate a <code>RedirectResponse</code> to a named route, you may use the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>If your route has parameters, you may pass them as the second argument to the <code>route</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<h4>Populating Parameters Via Eloquent Models</h4>

<p>If you are redirecting to a route with an &quot;ID&quot; parameter that is being populated from an Eloquent model, you may pass the model itself. The ID will be extracted automatically:</p>
<div class="highlight"><pre><span></span><span class="c1">// For a route with the following URI: profile/{id}</span>

<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$user</span><span class="p">]);</span>
</pre></div>

<p>If you would like to customize the value that is placed in the route parameter, you can specify the column in the route parameter definition (<code>profile/{id:slug}</code>) or you can override the <code>getRouteKey</code> method on your Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the value of the model&#39;s route key.</span>
<span class="cm"> *</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRouteKey</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">slug</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="redirecting-controller-actions"></a></p>

<h3>Redirecting To Controller Actions</h3>

<p>You may also generate redirects to <a href="/docs/%7B%7Bversion%7D%7D/controllers">controller actions</a>. To do so, pass the controller and action name to the <code>action</code> method. Remember, you do not need to specify the full namespace to the controller since Laravel&#39;s <code>RouteServiceProvider</code> will automatically set the base controller namespace:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<p>If your controller route requires parameters, you may pass them as the second argument to the <code>action</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">action</span><span class="p">(</span>
    <span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<p><a name="redirecting-external-domains"></a></p>

<h3>Redirecting To External Domains</h3>

<p>Sometimes you may need to redirect to a domain outside of your application. You may do so by calling the <code>away</code> method, which creates a <code>RedirectResponse</code> without any additional URL encoding, validation, or verification:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">away</span><span class="p">(</span><span class="s1">&#39;https://www.google.com&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="redirecting-with-flashed-session-data"></a></p>

<h3>Redirecting With Flashed Session Data</h3>

<p>Redirecting to a new URL and <a href="/docs/%7B%7Bversion%7D%7D/session#flash-data">flashing data to the session</a> are usually done at the same time. Typically, this is done after successfully performing an action when you flash a success message to the session. For convenience, you may create a <code>RedirectResponse</code> instance and flash data to the session in a single, fluent method chain:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Update the user&#39;s profile...</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile updated!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>After the user is redirected, you may display the flashed message from the <a href="/docs/%7B%7Bversion%7D%7D/session">session</a>. For example, using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>:</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">))</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-success&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>
</pre></div>

<p><a name="other-response-types"></a></p>

<h2>Other Response Types</h2>

<p>The <code>response</code> helper may be used to generate other types of response instances. When the <code>response</code> helper is called without arguments, an implementation of the <code>Illuminate\Contracts\Routing\ResponseFactory</code> <a href="/docs/%7B%7Bversion%7D%7D/contracts">contract</a> is returned. This contract provides several helpful methods for generating responses.</p>

<p><a name="view-responses"></a></p>

<h3>View Responses</h3>

<p>If you need control over the response&#39;s status and headers but also need to return a <a href="/docs/%7B%7Bversion%7D%7D/views">view</a> as the response&#39;s content, you should use the <code>view</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="nx">$type</span><span class="p">);</span>
</pre></div>

<p>Of course, if you do not need to pass a custom HTTP status code or custom headers, you should use the global <code>view</code> helper function.</p>

<p><a name="json-responses"></a></p>

<h3>JSON Responses</h3>

<p>The <code>json</code> method will automatically set the <code>Content-Type</code> header to <code>application/json</code>, as well as convert the given array to JSON using the <code>json_encode</code> PHP function:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span>
    <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>If you would like to create a JSONP response, you may use the <code>json</code> method in combination with the <code>withCallback</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">json</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Abigail&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;CA&#39;</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">));</span>
</pre></div>

<p><a name="file-downloads"></a></p>

<h3>File Downloads</h3>

<p>The <code>download</code> method may be used to generate a response that forces the user&#39;s browser to download the file at the given path. The <code>download</code> method accepts a file name as the second argument to the method, which will determine the file name that is seen by the user downloading the file. Finally, you may pass an array of HTTP headers as the third argument to the method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$name</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">download</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">deleteFileAfterSend</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Symfony HttpFoundation, which manages file downloads, requires the file being downloaded to have an ASCII file name.</p>
</blockquote>

<h4>Streamed Downloads</h4>

<p>Sometimes you may wish to turn the string response of a given operation into a downloadable response without having to write the contents of the operation to disk. You may use the <code>streamDownload</code> method in this scenario. This method accepts a callback, file name, and an optional array of headers as its arguments:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">streamDownload</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">echo</span> <span class="nx">GitHub</span><span class="o">::</span><span class="nx">api</span><span class="p">(</span><span class="s1">&#39;repo&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">contents</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">readme</span><span class="p">(</span><span class="s1">&#39;laravel&#39;</span><span class="p">,</span> <span class="s1">&#39;laravel&#39;</span><span class="p">)[</span><span class="s1">&#39;contents&#39;</span><span class="p">];</span>
<span class="p">},</span> <span class="s1">&#39;laravel-readme.md&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="file-responses"></a></p>

<h3>File Responses</h3>

<p>The <code>file</code> method may be used to display a file, such as an image or PDF, directly in the user&#39;s browser instead of initiating a download. This method accepts the path to the file as its first argument and an array of headers as its second argument:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">file</span><span class="p">(</span><span class="nx">$pathToFile</span><span class="p">,</span> <span class="nx">$headers</span><span class="p">);</span>
</pre></div>

<p><a name="response-macros"></a></p>

<h2>Response Macros</h2>

<p>If you would like to define a custom response that you can re-use in a variety of your routes and controllers, you may use the <code>macro</code> method on the <code>Response</code> facade. For example, from a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider&#39;s</a> <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ResponseMacroServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register the application&#39;s response macros.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Response</span><span class="o">::</span><span class="na">macro</span><span class="p">(</span><span class="s1">&#39;caps&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>macro</code> function accepts a name as its first argument, and a Closure as its second. The macro&#39;s Closure will be executed when calling the macro name from a <code>ResponseFactory</code> implementation or the <code>response</code> helper:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">caps</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Routing</h1>

<ul>
<li><a href="#basic-routing">Basic Routing</a>

<ul>
<li><a href="#redirect-routes">Redirect Routes</a></li>
<li><a href="#view-routes">View Routes</a></li>
</ul></li>
<li><a href="#route-parameters">Route Parameters</a>

<ul>
<li><a href="#required-parameters">Required Parameters</a></li>
<li><a href="#parameters-optional-parameters">Optional Parameters</a></li>
<li><a href="#parameters-regular-expression-constraints">Regular Expression Constraints</a></li>
</ul></li>
<li><a href="#named-routes">Named Routes</a></li>
<li><a href="#route-groups">Route Groups</a>

<ul>
<li><a href="#route-group-middleware">Middleware</a></li>
<li><a href="#route-group-subdomain-routing">Subdomain Routing</a></li>
<li><a href="#route-group-prefixes">Route Prefixes</a></li>
<li><a href="#route-group-name-prefixes">Route Name Prefixes</a></li>
</ul></li>
<li><a href="#route-model-binding">Route Model Binding</a>

<ul>
<li><a href="#implicit-binding">Implicit Binding</a></li>
<li><a href="#explicit-binding">Explicit Binding</a></li>
</ul></li>
<li><a href="#fallback-routes">Fallback Routes</a></li>
<li><a href="#rate-limiting">Rate Limiting</a>

<ul>
<li><a href="#defining-rate-limiters">Defining Rate Limiters</a></li>
<li><a href="#attaching-rate-limiters-to-routes">Attaching Rate Limiters To Routes</a></li>
</ul></li>
<li><a href="#form-method-spoofing">Form Method Spoofing</a></li>
<li><a href="#accessing-the-current-route">Accessing The Current Route</a></li>
<li><a href="#cors">Cross-Origin Resource Sharing (CORS)</a></li>
</ul>

<p><a name="basic-routing"></a></p>

<h2>Basic Routing</h2>

<p>The most basic Laravel routes accept a URI and a <code>Closure</code>, providing a very simple and expressive method of defining routes:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>The Default Route Files</h4>

<p>All Laravel routes are defined in your route files, which are located in the <code>routes</code> directory. These files are automatically loaded by the framework. The <code>routes/web.php</code> file defines routes that are for your web interface. These routes are assigned the <code>web</code> middleware group, which provides features like session state and CSRF protection. The routes in <code>routes/api.php</code> are stateless and are assigned the <code>api</code> middleware group.</p>

<p>For most applications, you will begin by defining routes in your <code>routes/web.php</code> file. The routes defined in <code>routes/web.php</code> may be accessed by entering the defined route&#39;s URL in your browser. For example, you may access the following route by navigating to <code>http://your-app.test/user</code> in your browser:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">UserController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
</pre></div>

<p>Routes defined in the <code>routes/api.php</code> file are nested within a route group by the <code>RouteServiceProvider</code>. Within this group, the <code>/api</code> URI prefix is automatically applied so you do not need to manually apply it to every route in the file. You may modify the prefix and other route group options by modifying your <code>RouteServiceProvider</code> class.</p>

<h4>Available Router Methods</h4>

<p>The router allows you to register routes that respond to any HTTP verb:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">put</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">patch</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="k">delete</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">options</span><span class="p">(</span><span class="nx">$uri</span><span class="p">,</span> <span class="nx">$callback</span><span class="p">);</span>
</pre></div>

<p>Sometimes you may need to register a route that responds to multiple HTTP verbs. You may do so using the <code>match</code> method. Or, you may even register a route that responds to all HTTP verbs using the <code>any</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">match</span><span class="p">([</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">],</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">any</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>CSRF Protection</h4>

<p>Any HTML forms pointing to <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, or <code>DELETE</code> routes that are defined in the <code>web</code> routes file should include a CSRF token field. Otherwise, the request will be rejected. You can read more about CSRF protection in the <a href="/docs/%7B%7Bversion%7D%7D/csrf">CSRF documentation</a>:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/profile&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">csrf</span>
    <span class="p">...</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="redirect-routes"></a></p>

<h3>Redirect Routes</h3>

<p>If you are defining a route that redirects to another URI, you may use the <code>Route::redirect</code> method. This method provides a convenient shortcut so that you do not have to define a full route or controller for performing a simple redirect:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/here&#39;</span><span class="p">,</span> <span class="s1">&#39;/there&#39;</span><span class="p">);</span>
</pre></div>

<p>By default, <code>Route::redirect</code> returns a <code>302</code> status code. You may customize the status code using the optional third parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/here&#39;</span><span class="p">,</span> <span class="s1">&#39;/there&#39;</span><span class="p">,</span> <span class="mi">301</span><span class="p">);</span>
</pre></div>

<p>You may use the <code>Route::permanentRedirect</code> method to return a <code>301</code> status code:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">permanentRedirect</span><span class="p">(</span><span class="s1">&#39;/here&#39;</span><span class="p">,</span> <span class="s1">&#39;/there&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="view-routes"></a></p>

<h3>View Routes</h3>

<p>If your route only needs to return a view, you may use the <code>Route::view</code> method. Like the <code>redirect</code> method, this method provides a simple shortcut so that you do not have to define a full route or controller. The <code>view</code> method accepts a URI as its first argument and a view name as its second argument. In addition, you may provide an array of data to pass to the view as an optional third argument:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;/welcome&#39;</span><span class="p">,</span> <span class="s1">&#39;welcome&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">view</span><span class="p">(</span><span class="s1">&#39;/welcome&#39;</span><span class="p">,</span> <span class="s1">&#39;welcome&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="route-parameters"></a></p>

<h2>Route Parameters</h2>

<p><a name="required-parameters"></a></p>

<h3>Required Parameters</h3>

<p>Sometimes you will need to capture segments of the URI within your route. For example, you may need to capture a user&#39;s ID from the URL. You may do so by defining route parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;User &#39;</span><span class="p">.</span><span class="nx">$id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>You may define as many route parameters as required by your route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;posts/{post}/comments/{comment}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$postId</span><span class="p">,</span> <span class="nx">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Route parameters are always encased within <code>{}</code> braces and should consist of alphabetic characters, and may not contain a <code>-</code> character. Instead of using the <code>-</code> character, use an underscore (<code>_</code>). Route parameters are injected into route callbacks / controllers based on their order - the names of the callback / controller arguments do not matter.</p>

<p><a name="parameters-optional-parameters"></a></p>

<h3>Optional Parameters</h3>

<p>Occasionally you may need to specify a route parameter, but make the presence of that route parameter optional. You may do so by placing a <code>?</code> mark after the parameter name. Make sure to give the route&#39;s corresponding variable a default value:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name?}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="parameters-regular-expression-constraints"></a></p>

<h3>Regular Expression Constraints</h3>

<p>You may constrain the format of your route parameters using the <code>where</code> method on a route instance. The <code>where</code> method accepts the name of the parameter and a regular expression defining how the parameter should be constrained:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;[A-Za-z]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/{name}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;[a-z]+&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="parameters-global-constraints"></a></p>

<h4>Global Constraints</h4>

<p>If you would like a route parameter to always be constrained by a given regular expression, you may use the <code>pattern</code> method. You should define these patterns in the <code>boot</code> method of your <code>RouteServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define your route model bindings, pattern filters, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9]+&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Once the pattern has been defined, it is automatically applied to all routes using that parameter name:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only executed if {id} is numeric...</span>
<span class="p">});</span>
</pre></div>

<p><a name="parameters-encoded-forward-slashes"></a></p>

<h4>Encoded Forward Slashes</h4>

<p>The Laravel routing component allows all characters except <code>/</code>. You must explicitly allow <code>/</code> to be part of your placeholder using a <code>where</code> condition regular expression:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;search/{search}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$search</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$search</span><span class="p">;</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} Encoded forward slashes are only supported within the last route segment.</p>
</blockquote>

<p><a name="named-routes"></a></p>

<h2>Named Routes</h2>

<p>Named routes allow the convenient generation of URLs or redirects for specific routes. You may specify a name for a route by chaining the <code>name</code> method onto the route definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also specify route names for controller actions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserProfileController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} Route names should always be unique.</p>
</blockquote>

<h4>Generating URLs To Named Routes</h4>

<p>Once you have assigned a name to a given route, you may use the route&#39;s name when generating URLs or redirects via the global <code>route</code> function:</p>
<div class="highlight"><pre><span></span><span class="c1">// Generating URLs...</span>
<span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="c1">// Generating Redirects...</span>
<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
</pre></div>

<p>If the named route defines parameters, you may pass the parameters as the second argument to the <code>route</code> function. The given parameters will automatically be inserted into the URL in their correct positions:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>If you pass additional parameters in the array, those key / value pairs will automatically be added to the generated URL&#39;s query string:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;photos&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;yes&#39;</span><span class="p">]);</span>

<span class="c1">// /user/1/profile?photos=yes</span>
</pre></div>

<blockquote>
<p>{tip} Sometimes, you may wish to specify request-wide default values for URL parameters, such as the current locale. To accomplish this, you may use the <a href="/docs/%7B%7Bversion%7D%7D/urls#default-values"><code>URL::defaults</code> method</a>.</p>
</blockquote>

<h4>Inspecting The Current Route</h4>

<p>If you would like to determine if the current request was routed to a given named route, you may use the <code>named</code> method on a Route instance. For example, you may check the current route name from a route middleware:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Handle an incoming request.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Http\Request  $request</span>
<span class="cm"> * @param  \Closure  $next</span>
<span class="cm"> * @return mixed</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nx">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">named</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$next</span><span class="p">(</span><span class="nx">$request</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><a name="route-groups"></a></p>

<h2>Route Groups</h2>

<p>Route groups allow you to share route attributes, such as middleware or namespaces, across a large number of routes without needing to define those attributes on each individual route. Shared attributes are specified in an array format as the first parameter to the <code>Route::group</code> method.</p>

<p>Nested groups attempt to intelligently &quot;merge&quot; attributes with their parent group. Middleware and <code>where</code> conditions are merged while names, namespaces, and prefixes are appended. Namespace delimiters and slashes in URI prefixes are automatically added where appropriate.</p>

<p><a name="route-group-middleware"></a></p>

<h3>Middleware</h3>

<p>To assign middleware to all routes within a group, you may use the <code>middleware</code> method before defining the group. Middleware are executed in the order they are listed in the array:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Uses first &amp; second Middleware</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Uses first &amp; second Middleware</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-group-subdomain-routing"></a></p>

<h3>Subdomain Routing</h3>

<p>Route groups may also be used to handle subdomain routing. Subdomains may be assigned route parameters just like route URIs, allowing you to capture a portion of the subdomain for usage in your route or controller. The subdomain may be specified by calling the <code>domain</code> method before defining the group:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">domain</span><span class="p">(</span><span class="s1">&#39;{account}.myapp.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user/{id}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$account</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} In order to ensure your subdomain routes are reachable, you should register subdomain routes before registering root domain routes. This will prevent root domain routes from overwriting subdomain routes which have the same URI path.</p>
</blockquote>

<p><a name="route-group-prefixes"></a></p>

<h3>Route Prefixes</h3>

<p>The <code>prefix</code> method may be used to prefix each route in the group with a given URI. For example, you may want to prefix all route URIs within the group with <code>admin</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">prefix</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Matches The &quot;/admin/users&quot; URL</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-group-name-prefixes"></a></p>

<h3>Route Name Prefixes</h3>

<p>The <code>name</code> method may be used to prefix each route name in the group with a given string. For example, you may want to prefix all of the grouped route&#39;s names with <code>admin</code>. The given string is prefixed to the route name exactly as it is specified, so we will be sure to provide the trailing <code>.</code> character in the prefix:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;admin.&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Route assigned name &quot;admin.users&quot;...</span>
    <span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><a name="route-model-binding"></a></p>

<h2>Route Model Binding</h2>

<p>When injecting a model ID to a route or controller action, you will often query to retrieve the model that corresponds to that ID. Laravel route model binding provides a convenient way to automatically inject the model instances directly into your routes. For example, instead of injecting a user&#39;s ID, you can inject the entire <code>User</code> model instance that matches the given ID.</p>

<p><a name="implicit-binding"></a></p>

<h3>Implicit Binding</h3>

<p>Laravel automatically resolves Eloquent models defined in routes or controller actions whose type-hinted variable names match a route segment name. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;api/users/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Since the <code>$user</code> variable is type-hinted as the <code>App\Models\User</code> Eloquent model and the variable name matches the <code>{user}</code> URI segment, Laravel will automatically inject the model instance that has an ID matching the corresponding value from the request URI. If a matching model instance is not found in the database, a 404 HTTP response will automatically be generated.</p>

<h4>Customizing The Key</h4>

<p>Sometimes you may wish to resolve Eloquent models using a column other than <code>id</code>. To do so, you may specify the column in the route parameter definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;api/posts/{post:slug}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$post</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p><a name="implicit-model-binding-scoping"></a></p>

<h4>Custom Keys &amp; Scoping</h4>

<p>Sometimes, when implicitly binding multiple Eloquent models in a single route definition, you may wish to scope the second Eloquent model such that it must be a child of the first Eloquent model. For example, consider this situation that retrieves a blog post by slug for a specific user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;api/users/{user}/posts/{post:slug}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nx">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$post</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>When using a custom keyed implicit binding as a nested route parameter, Laravel will automatically scope the query to retrieve the nested model by its parent using conventions to guess the relationship name on the parent. In this case, it will be assumed that the <code>User</code> model has a relationship named <code>posts</code> (the plural of the route parameter name) which can be used to retrieve the <code>Post</code> model.</p>

<h4>Customizing The Default Key Name</h4>

<p>If you would like model binding to use a default database column other than <code>id</code> when retrieving a given model class, you may override the <code>getRouteKeyName</code> method on the Eloquent model:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the route key for the model.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">getRouteKeyName</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;slug&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="explicit-binding"></a></p>

<h3>Explicit Binding</h3>

<p>To register an explicit binding, use the router&#39;s <code>model</code> method to specify the class for a given parameter. You should define your explicit model bindings at the beginning of the <code>boot</code> method of your <code>RouteServiceProvider</code> class:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define your route model bindings, pattern filters, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Next, define a route that contains a <code>{user}</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span> <span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<p>Since we have bound all <code>{user}</code> parameters to the <code>App\Models\User</code> model, a <code>User</code> instance will be injected into the route. So, for example, a request to <code>profile/1</code> will inject the <code>User</code> instance from the database which has an ID of <code>1</code>.</p>

<p>If a matching model instance is not found in the database, a 404 HTTP response will be automatically generated.</p>

<h4>Customizing The Resolution Logic</h4>

<p>If you wish to use your own resolution logic, you may use the <code>Route::bind</code> method. The <code>Closure</code> you pass to the <code>bind</code> method will receive the value of the URI segment and should return the instance of the class that should be injected into the route:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Define your route model bindings, pattern filters, etc.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Alternatively, you may override the <code>resolveRouteBinding</code> method on your Eloquent model. This method will receive the value of the URI segment and should return the instance of the class that should be injected into the route:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Retrieve the model for a bound value.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  mixed  $value</span>
<span class="cm"> * @param  string|null  $field</span>
<span class="cm"> * @return \Illuminate\Database\Eloquent\Model|null</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">resolveRouteBinding</span><span class="p">(</span><span class="nx">$value</span><span class="p">,</span> <span class="nx">$field</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">firstOrFail</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="fallback-routes"></a></p>

<h2>Fallback Routes</h2>

<p>Using the <code>Route::fallback</code> method, you may define a route that will be executed when no other route matches the incoming request. Typically, unhandled requests will automatically render a &quot;404&quot; page via your application&#39;s exception handler. However, since you may define the <code>fallback</code> route within your <code>routes/web.php</code> file, all middleware in the <code>web</code> middleware group will apply to the route. You are free to add additional middleware to this route as needed:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">fallback</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} The fallback route should always be the last route registered by your application.</p>
</blockquote>

<p><a name="rate-limiting"></a></p>

<h2>Rate Limiting</h2>

<p><a name="defining-rate-limiters"></a></p>

<h3>Defining Rate Limiters</h3>

<p>Laravel includes powerful and customizable rate limiting services that you may utilize to restrict the amount of traffic for a given route or group of routes. To get started, you should define rate limiter configurations that meet your application&#39;s needs. Typically, this may be done in your application&#39;s <code>RouteServiceProvider</code>.</p>

<p>Rate limiters are defined using the <code>RateLimiter</code> facade&#39;s <code>for</code> method. The <code>for</code> method accepts a rate limiter name and a Closure that returns the limit configuration that should apply to routes that are assigned this rate limiter:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Cache</span><span class="err">\</span><span class="nx">RateLimiting</span><span class="err">\</span><span class="nx">Limit</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">RateLimiter</span><span class="p">;</span>

<span class="nx">RateLimiter</span><span class="o">::</span><span class="k">for</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>If the incoming request exceeds the specified rate limit, a response with a 429 HTTP status code will be automatically returned by Laravel. If you would like to define your own response that should be returned by a rate limit, you may use the <code>response</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">RateLimiter</span><span class="o">::</span><span class="k">for</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">response</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;Custom response...&#39;</span><span class="p">,</span> <span class="mi">429</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>Since rate limiter callbacks receive the incoming HTTP request instance, you may build the appropriate rate limit dynamically based on the incoming request or authenticated user:</p>
<div class="highlight"><pre><span></span><span class="nx">RateLimiter</span><span class="o">::</span><span class="k">for</span><span class="p">(</span><span class="s1">&#39;uploads&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">vipCustomer</span><span class="p">()</span>
                <span class="o">?</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">none</span><span class="p">()</span>
                <span class="o">:</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Segmenting Rate Limits</h4>

<p>Sometimes you may wish to segment rate limits by some arbitrary value. For example, you may wish to allow users to access a given route 100 times per minute per IP address. To accomplish this, you may use the <code>by</code> method when building your rate limit:</p>
<div class="highlight"><pre><span></span><span class="nx">RateLimiter</span><span class="o">::</span><span class="k">for</span><span class="p">(</span><span class="s1">&#39;uploads&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">vipCustomer</span><span class="p">()</span>
                <span class="o">?</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">none</span><span class="p">()</span>
                <span class="o">:</span> <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">by</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">ip</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>

<h4>Multiple Rate Limits</h4>

<p>If needed, you may return an array of rate limits for a given rate limiter configuration. Each rate limit will be evaluated for the route based on the order they are placed within the array:</p>
<div class="highlight"><pre><span></span><span class="nx">RateLimiter</span><span class="o">::</span><span class="k">for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
        <span class="nx">Limit</span><span class="o">::</span><span class="nx">perMinute</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">by</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">input</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)),</span>
    <span class="p">];</span>
<span class="p">});</span>
</pre></div>

<p><a name="attaching-rate-limiters-to-routes"></a></p>

<h3>Attaching Rate Limiters To Routes</h3>

<p>Rate limiters may be attached to routes or route groups using the <code>throttle</code> <a href="/docs/%7B%7Bversion%7D%7D/middleware">middleware</a>. The throttle middleware accepts the name of the rate limiter you wish to assign to the route:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">([</span><span class="s1">&#39;throttle:uploads&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">group</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/audio&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>

    <span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/video&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><a name="form-method-spoofing"></a></p>

<h2>Form Method Spoofing</h2>

<p>HTML forms do not support <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> actions. So, when defining <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> routes that are called from an HTML form, you will need to add a hidden <code>_method</code> field to the form. The value sent with the <code>_method</code> field will be used as the HTTP request method:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_token&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;{{ csrf_token() }}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p>You may use the <code>@method</code> Blade directive to generate the <code>_method</code> input:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">method</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">csrf</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</pre></div>

<p><a name="accessing-the-current-route"></a></p>

<h2>Accessing The Current Route</h2>

<p>You may use the <code>current</code>, <code>currentRouteName</code>, and <code>currentRouteAction</code> methods on the <code>Route</code> facade to access information about the route handling the incoming request:</p>
<div class="highlight"><pre><span></span><span class="nx">$route</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">current</span><span class="p">();</span>

<span class="nx">$name</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteName</span><span class="p">();</span>

<span class="nx">$action</span> <span class="o">=</span> <span class="nx">Route</span><span class="o">::</span><span class="nx">currentRouteAction</span><span class="p">();</span>
</pre></div>

<p>Refer to the API documentation for both the <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Router.html">underlying class of the Route facade</a> and <a href="https://laravel.com/api/%7B%7Bversion%7D%7D/Illuminate/Routing/Route.html">Route instance</a> to review all accessible methods.</p>

<p><a name="cors"></a></p>

<h2>Cross-Origin Resource Sharing (CORS)</h2>

<p>Laravel can automatically respond to CORS OPTIONS requests with values that you configure. All CORS settings may be configured in your <code>cors</code> configuration file and OPTIONS requests will automatically be handled by the <code>HandleCors</code> middleware that is included by default in your global middleware stack.</p>

<blockquote>
<p>{tip} For more information on CORS and CORS headers, please consult the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#The_HTTP_response_headers">MDN web documentation on CORS</a>.</p>
</blockquote>
<div style="page-break-after: always;" ></div><h1>Laravel Sanctum</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#how-it-works">How It Works</a></li>
</ul></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#api-token-authentication">API Token Authentication</a>

<ul>
<li><a href="#issuing-api-tokens">Issuing API Tokens</a></li>
<li><a href="#token-abilities">Token Abilities</a></li>
<li><a href="#protecting-routes">Protecting Routes</a></li>
<li><a href="#revoking-tokens">Revoking Tokens</a></li>
</ul></li>
<li><a href="#spa-authentication">SPA Authentication</a>

<ul>
<li><a href="#spa-configuration">Configuration</a></li>
<li><a href="#spa-authenticating">Authenticating</a></li>
<li><a href="#protecting-spa-routes">Protecting Routes</a></li>
<li><a href="#authorizing-private-broadcast-channels">Authorizing Private Broadcast Channels</a></li>
</ul></li>
<li><a href="#mobile-application-authentication">Mobile Application Authentication</a>

<ul>
<li><a href="#issuing-mobile-api-tokens">Issuing API Tokens</a></li>
<li><a href="#protecting-mobile-api-routes">Protecting Routes</a></li>
<li><a href="#revoking-mobile-api-tokens">Revoking Tokens</a></li>
</ul></li>
<li><a href="#testing">Testing</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Sanctum provides a featherweight authentication system for SPAs (single page applications), mobile applications, and simple, token based APIs. Sanctum allows each user of your application to generate multiple API tokens for their account. These tokens may be granted abilities / scopes which specify which actions the tokens are allowed to perform.</p>

<p><a name="how-it-works"></a></p>

<h3>How It Works</h3>

<p>Laravel Sanctum exists to solve two separate problems.</p>

<h4>API Tokens</h4>

<p>First, it is a simple package to issue API tokens to your users without the complication of OAuth. This feature is inspired by GitHub &quot;access tokens&quot;. For example, imagine the &quot;account settings&quot; of your application has a screen where a user may generate an API token for their account. You may use Sanctum to generate and manage those tokens. These tokens typically have a very long expiration time (years), but may be manually revoked by the user at anytime.</p>

<p>Laravel Sanctum offers this feature by storing user API tokens in a single database table and authenticating incoming requests via the <code>Authorization</code> header which should contain a valid API token.</p>

<h4>SPA Authentication</h4>

<p>Second, Sanctum exists to offer a simple way to authenticate single page applications (SPAs) that need to communicate with a Laravel powered API. These SPAs might exist in the same repository as your Laravel application or might be an entirely separate repository, such as a SPA created using Vue CLI.</p>

<p>For this feature, Sanctum does not use tokens of any kind. Instead, Sanctum uses Laravel&#39;s built-in cookie based session authentication services. This provides the benefits of CSRF protection, session authentication, as well as protects against leakage of the authentication credentials via XSS. Sanctum will only attempt to authenticate using cookies when the incoming request originates from your own SPA frontend.</p>

<blockquote>
<p>{tip} It is perfectly fine to use Sanctum only for API token authentication or only for SPA authentication. Just because you use Sanctum does not mean you are required to use both features it offers.</p>
</blockquote>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>You may install Laravel Sanctum via Composer:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">sanctum</span>
</pre></div>

<p>Next, you should publish the Sanctum configuration and migration files using the <code>vendor:publish</code> Artisan command. The <code>sanctum</code> configuration file will be placed in your <code>config</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&quot;Laravel\Sanctum\SanctumServiceProvider&quot;</span>
</pre></div>

<p>Finally, you should run your database migrations. Sanctum will create one database table in which to store API tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p>Next, if you plan to utilize Sanctum to authenticate an SPA, you should add Sanctum&#39;s middleware to your <code>api</code> middleware group within your <code>app/Http/Kernel.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Sanctum</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">EnsureFrontendRequestsAreStateful</span><span class="p">;</span>

<span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">EnsureFrontendRequestsAreStateful</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;throttle:60,1&#39;</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SubstituteBindings</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<h4>Migration Customization</h4>

<p>If you are not going to use Sanctum&#39;s default migrations, you should call the <code>Sanctum::ignoreMigrations</code> method in the <code>register</code> method of your <code>AppServiceProvider</code>. You may export the default migrations using <code>php artisan vendor:publish --tag=sanctum-migrations</code>.</p>

<p><a name="api-token-authentication"></a></p>

<h2>API Token Authentication</h2>

<blockquote>
<p>{tip} You should not use API tokens to authenticate your own first-party SPA. Instead, use Sanctum&#39;s built-in <a href="#spa-authentication">SPA authentication</a>.</p>
</blockquote>

<p><a name="issuing-api-tokens"></a></p>

<h3>Issuing API Tokens</h3>

<p>Sanctum allows you to issue API tokens / personal access tokens that may be used to authenticate API requests. When making requests using API tokens, the token should be included in the <code>Authorization</code> header as a <code>Bearer</code> token.</p>

<p>To begin issuing tokens for users, your User model should use the <code>HasApiTokens</code> trait:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Sanctum</span><span class="err">\</span><span class="nx">HasApiTokens</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="nx">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>To issue a token, you may use the <code>createToken</code> method. The <code>createToken</code> method returns a <code>Laravel\Sanctum\NewAccessToken</code> instance. API tokens are hashed using SHA-256 hashing before being stored in your database, but you may access the plain-text value of the token using the <code>plainTextToken</code> property of the <code>NewAccessToken</code> instance. You should display this value to the user immediately after the token has been created:</p>
<div class="highlight"><pre><span></span><span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="s1">&#39;token-name&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">$token</span><span class="o">-&gt;</span><span class="nx">plainTextToken</span><span class="p">;</span>
</pre></div>

<p>You may access all of the user&#39;s tokens using the <code>tokens</code> Eloquent relationship provided by the <code>HasApiTokens</code> trait:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokens</span> <span class="nx">as</span> <span class="nx">$token</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="token-abilities"></a></p>

<h3>Token Abilities</h3>

<p>Sanctum allows you to assign &quot;abilities&quot; to tokens, similar to OAuth &quot;scopes&quot;. You may pass an array of string abilities as the second argument to the <code>createToken</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="s1">&#39;token-name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;server:update&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">plainTextToken</span><span class="p">;</span>
</pre></div>

<p>When handling an incoming request authenticated by Sanctum, you may determine if the token has a given ability using the <code>tokenCan</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokenCan</span><span class="p">(</span><span class="s1">&#39;server:update&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} For convenience, the <code>tokenCan</code> method will always return <code>true</code> if the incoming authenticated request was from your first-party SPA and you are using Sanctum&#39;s built-in <a href="#spa-authentication">SPA authentication</a>.</p>
</blockquote>

<p><a name="protecting-routes"></a></p>

<h3>Protecting Routes</h3>

<p>To protect routes so that all incoming requests must be authenticated, you should attach the <code>sanctum</code> authentication guard to your API routes within your <code>routes/api.php</code> file. This guard will ensure that incoming requests are authenticated as either a stateful authenticated requests from your SPA or contain a valid API token header if the request is from a third party:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:sanctum&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="revoking-tokens"></a></p>

<h3>Revoking Tokens</h3>

<p>You may &quot;revoke&quot; tokens by deleting them from your database using the <code>tokens</code> relationship that is provided by the <code>HasApiTokens</code> trait:</p>
<div class="highlight"><pre><span></span><span class="c1">// Revoke all tokens...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokens</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

<span class="c1">// Revoke the user&#39;s current token...</span>
<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">currentAccessToken</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

<span class="c1">// Revoke a specific token...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokens</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p><a name="spa-authentication"></a></p>

<h2>SPA Authentication</h2>

<p>Sanctum exists to offer a simple way to authenticate single page applications (SPAs) that need to communicate with a Laravel powered API. These SPAs might exist in the same repository as your Laravel application or might be an entirely separate repository, such as a SPA created using Vue CLI.</p>

<p>For this feature, Sanctum does not use tokens of any kind. Instead, Sanctum uses Laravel&#39;s built-in cookie based session authentication services. This provides the benefits of CSRF protection, session authentication, as well as protects against leakage of the authentication credentials via XSS. Sanctum will only attempt to authenticate using cookies when the incoming request originates from your own SPA frontend.</p>

<blockquote>
<p>{note} In order to authenticate, your SPA and API must share the same top-level domain. However, they may be placed on different subdomains.</p>
</blockquote>

<p><a name="spa-configuration"></a></p>

<h3>Configuration</h3>

<h4>Configuring Your First-Party Domains</h4>

<p>First, you should configure which domains your SPA will be making requests from. You may configure these domains using the <code>stateful</code> configuration option in your <code>sanctum</code> configuration file. This configuration setting determines which domains will maintain &quot;stateful&quot; authentication using Laravel session cookies when making requests to your API.</p>

<blockquote>
<p>{note} If you are accessing your application via a URL that includes the port (<code>127.0.0.1:8000</code>), you should ensure that you include the port number with the domain.</p>
</blockquote>

<h4>Sanctum Middleware</h4>

<p>Next, you should add Sanctum&#39;s middleware to your <code>api</code> middleware group within your <code>app/Http/Kernel.php</code> file. This middleware is responsible for ensuring that incoming requests from your SPA can authenticate using Laravel&#39;s session cookies, while still allowing requests from third parties or mobile applications to authenticate using API tokens:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Sanctum</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">EnsureFrontendRequestsAreStateful</span><span class="p">;</span>

<span class="s1">&#39;api&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">EnsureFrontendRequestsAreStateful</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="s1">&#39;throttle:60,1&#39;</span><span class="p">,</span>
    <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">SubstituteBindings</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p><a name="cors-and-cookies"></a></p>

<h4>CORS &amp; Cookies</h4>

<p>If you are having trouble authenticating with your application from an SPA that executes on a separate subdomain, you have likely misconfigured your CORS (Cross-Origin Resource Sharing) or session cookie settings.</p>

<p>You should ensure that your application&#39;s CORS configuration is returning the <code>Access-Control-Allow-Credentials</code> header with a value of <code>True</code> by setting the <code>supports_credentials</code> option within your application&#39;s <code>cors</code> configuration file to <code>true</code>.</p>

<p>In addition, you should enable the <code>withCredentials</code> option on your global <code>axios</code> instance. Typically, this should be performed in your <code>resources/js/bootstrap.js</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>

<p>Finally, you should ensure your application&#39;s session cookie domain configuration supports any subdomain of your root domain. You may do this by prefixing the domain with a leading <code>.</code> within your <code>session</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;domain&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;.domain.com&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="spa-authenticating"></a></p>

<h3>Authenticating</h3>

<p>To authenticate your SPA, your SPA&#39;s login page should first make a request to the <code>/sanctum/csrf-cookie</code> route to initialize CSRF protection for the application:</p>
<div class="highlight"><pre><span></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/sanctum/csrf-cookie&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Login...</span>
<span class="p">});</span>
</pre></div>

<p>During this request Laravel will set an <code>XSRF-TOKEN</code> cookie containing the current CSRF token. This token should then be passed in an <code>X-XSRF-TOKEN</code> header on subsequent requests, which libraries like Axios and the Angular HttpClient will do automatically for you.</p>

<p>Once CSRF protection has been initialized, you should make a <code>POST</code> request to the typical Laravel <code>/login</code> route. This <code>/login</code> route may be provided by the <code>laravel/ui</code> <a href="/docs/%7B%7Bversion%7D%7D/authentication#introduction">authentication scaffolding</a> package.</p>

<p>If the login request is successful, you will be authenticated and subsequent requests to your API routes will automatically be authenticated via the session cookie that the Laravel backend issued to your client.</p>

<blockquote>
<p>{tip} You are free to write your own <code>/login</code> endpoint; however, you should ensure that it authenticates the user using the standard, <a href="/docs/%7B%7Bversion%7D%7D/authentication#authenticating-users">session based authentication services that Laravel provides</a>.</p>
</blockquote>

<p><a name="protecting-spa-routes"></a></p>

<h3>Protecting Routes</h3>

<p>To protect routes so that all incoming requests must be authenticated, you should attach the <code>sanctum</code> authentication guard to your API routes within your <code>routes/api.php</code> file. This guard will ensure that incoming requests are authenticated as either a stateful authenticated requests from your SPA or contain a valid API token header if the request is from a third party:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:sanctum&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="authorizing-private-broadcast-channels"></a></p>

<h3>Authorizing Private Broadcast Channels</h3>

<p>If your SPA needs to authenticate with <a href="/docs/%7B%7Bversion%7D%7D/broadcasting#authorizing-channels">private / presence broadcast channels</a>, you should place the <code>Broadcast::routes</code> method call within your <code>routes/api.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Broadcast</span><span class="o">::</span><span class="nx">routes</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;auth:sanctum&#39;</span><span class="p">]]);</span>
</pre></div>

<p>Next, in order for Pusher&#39;s authorization requests to succeed, you will need to provide a custom Pusher <code>authorizer</code> when initializing <a href="/docs/%7B%7Bversion%7D%7D/broadcasting#installing-laravel-echo">Laravel Echo</a>. This allows your application to configure Pusher to use the <code>axios</code> instance that is <a href="#cors-and-cookies">properly configured for cross-domain requests</a>:</p>
<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Echo</span><span class="p">({</span>
    <span class="nx">broadcaster</span><span class="o">:</span> <span class="s2">&quot;pusher&quot;</span><span class="p">,</span>
    <span class="nx">cluster</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MIX_PUSHER_APP_CLUSTER</span><span class="p">,</span>
    <span class="nx">encrypted</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">key</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MIX_PUSHER_APP_KEY</span><span class="p">,</span>
    <span class="nx">authorizer</span><span class="o">:</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">authorize</span><span class="o">:</span> <span class="p">(</span><span class="nx">socketId</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/broadcasting/auth&#39;</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">socket_id</span><span class="o">:</span> <span class="nx">socketId</span><span class="p">,</span>
                    <span class="nx">channel_name</span><span class="o">:</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">name</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="nx">callback</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">},</span>
<span class="p">})</span>
</pre></div>

<p><a name="mobile-application-authentication"></a></p>

<h2>Mobile Application Authentication</h2>

<p>You may use Sanctum tokens to authenticate your mobile application&#39;s requests to your API. The process for authenticating mobile application requests is similar to authenticating third-party API requests; however, there are small differences in how you will issue the API tokens.</p>

<p><a name="issuing-mobile-api-tokens"></a></p>

<h3>Issuing API Tokens</h3>

<p>To get started, create a route that accepts the user&#39;s email / username, password, and device name, then exchanges those credentials for a new Sanctum token. The endpoint will return the plain-text Sanctum token which may then be stored on the mobile device and used to make additional API requests:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">Hash</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">ValidationException</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/sanctum/token&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;device_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="nx">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">$user</span> <span class="o">||</span> <span class="o">!</span> <span class="nx">Hash</span><span class="o">::</span><span class="nx">check</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">password</span><span class="p">,</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">password</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">ValidationException</span><span class="o">::</span><span class="nx">withMessages</span><span class="p">([</span>
            <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;The provided credentials are incorrect.&#39;</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">createToken</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">device_name</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">plainTextToken</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>When the mobile device uses the token to make an API request to your application, it should pass the token in the <code>Authorization</code> header as a <code>Bearer</code> token.</p>

<blockquote>
<p>{tip} When issuing tokens for a mobile application, you are also free to specify <a href="#token-abilities">token abilities</a></p>
</blockquote>

<p><a name="protecting-mobile-api-routes"></a></p>

<h3>Protecting Routes</h3>

<p>As previously documented, you may protect routes so that all incoming requests must be authenticated by attaching the <code>sanctum</code> authentication guard to the routes. Typically, you will attach this guard to the routes defined within your <code>routes/api.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;auth:sanctum&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p><a name="revoking-mobile-api-tokens"></a></p>

<h3>Revoking Tokens</h3>

<p>To allow users to revoke API tokens issued to mobile devices, you may list them by name, along with a &quot;Revoke&quot; button, within an &quot;account settings&quot; portion of your web application&#39;s UI. When the user clicks the &quot;Revoke&quot; button, you can delete the token from the database. Remember, you can access a user&#39;s API tokens via the <code>tokens</code> relationship provided by the <code>HasApiTokens</code> trait:</p>
<div class="highlight"><pre><span></span><span class="c1">// Revoke all tokens...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokens</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>

<span class="c1">// Revoke a specific token...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokens</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p><a name="testing"></a></p>

<h2>Testing</h2>

<p>While testing, the <code>Sanctum::actingAs</code> method may be used to authenticate a user and specify which abilities are granted to their token:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Sanctum</span><span class="err">\</span><span class="nx">Sanctum</span><span class="p">;</span>

<span class="kr">public</span> <span class="kd">function</span> <span class="nx">test_task_list_can_be_retrieved</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Sanctum</span><span class="o">::</span><span class="nx">actingAs</span><span class="p">(</span>
        <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(),</span>
        <span class="p">[</span><span class="s1">&#39;view-tasks&#39;</span><span class="p">]</span>
    <span class="p">);</span>

    <span class="nx">$response</span> <span class="o">=</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/task&#39;</span><span class="p">);</span>

    <span class="nx">$response</span><span class="o">-&gt;</span><span class="nx">assertOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>If you would like to grant all abilities to the token, you should include <code>*</code> in the ability list provided to the <code>actingAs</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Sanctum</span><span class="o">::</span><span class="nx">actingAs</span><span class="p">(</span>
    <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">create</span><span class="p">(),</span>
    <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Task Scheduling</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-schedules">Defining Schedules</a>

<ul>
<li><a href="#scheduling-artisan-commands">Scheduling Artisan Commands</a></li>
<li><a href="#scheduling-queued-jobs">Scheduling Queued Jobs</a></li>
<li><a href="#scheduling-shell-commands">Scheduling Shell Commands</a></li>
<li><a href="#schedule-frequency-options">Schedule Frequency Options</a></li>
<li><a href="#timezones">Timezones</a></li>
<li><a href="#preventing-task-overlaps">Preventing Task Overlaps</a></li>
<li><a href="#running-tasks-on-one-server">Running Tasks On One Server</a></li>
<li><a href="#background-tasks">Background Tasks</a></li>
<li><a href="#maintenance-mode">Maintenance Mode</a></li>
</ul></li>
<li><a href="#task-output">Task Output</a></li>
<li><a href="#task-hooks">Task Hooks</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In the past, you may have generated a Cron entry for each task you needed to schedule on your server. However, this can quickly become a pain, because your task schedule is no longer in source control and you must SSH into your server to add additional Cron entries.</p>

<p>Laravel&#39;s command scheduler allows you to fluently and expressively define your command schedule within Laravel itself. When using the scheduler, only a single Cron entry is needed on your server. Your task schedule is defined in the <code>app/Console/Kernel.php</code> file&#39;s <code>schedule</code> method. To help you get started, a simple example is defined within the method.</p>

<h3>Starting The Scheduler</h3>

<p>When using the scheduler, you only need to add the following Cron entry to your server. If you do not know how to add Cron entries to your server, consider using a service such as <a href="https://forge.laravel.com">Laravel Forge</a> which can manage the Cron entries for you:</p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="nx">cd</span> <span class="o">/</span><span class="nx">path</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">your</span><span class="o">-</span><span class="nx">project</span> <span class="o">&amp;&amp;</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">schedule</span><span class="o">:</span><span class="nx">run</span> <span class="o">&gt;&gt;</span> <span class="err">/dev/null 2&gt;&amp;1</span>
</pre></div>

<p>This Cron will call the Laravel command scheduler every minute. When the <code>schedule:run</code> command is executed, Laravel will evaluate your scheduled tasks and runs the tasks that are due.</p>

<p><a name="defining-schedules"></a></p>

<h2>Defining Schedules</h2>

<p>You may define all of your scheduled tasks in the <code>schedule</code> method of the <code>App\Console\Kernel</code> class. To get started, let&#39;s look at an example of scheduling a task. In this example, we will schedule a <code>Closure</code> to be called every day at midnight. Within the <code>Closure</code> we will execute a database query to clear a table:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Console</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Console\Scheduling\Schedule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Console\Kernel</span> <span class="k">as</span> <span class="nx">ConsoleKernel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Kernel</span> <span class="k">extends</span> <span class="nx">ConsoleKernel</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The Artisan commands provided by your application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$commands</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">//</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Define the application&#39;s command schedule.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Illuminate\Console\Scheduling\Schedule  $schedule</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">schedule</span><span class="p">(</span><span class="nx">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;recent_users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
        <span class="p">})</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In addition to scheduling using Closures, you may also use <a href="https://secure.php.net/manual/en/language.oop5.magic.php#object.invoke">invokable objects</a>. Invokable objects are simple PHP classes that contain an <code>__invoke</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="k">new</span> <span class="nx">DeleteRecentUsers</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p><a name="scheduling-artisan-commands"></a></p>

<h3>Scheduling Artisan Commands</h3>

<p>In addition to scheduling Closure calls, you may also schedule <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan commands</a> and operating system commands. For example, you may use the <code>command</code> method to schedule an Artisan command using either the command&#39;s name or class:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send Taylor --force&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>

<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="nx">EmailsCommand</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;--force&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p><a name="scheduling-queued-jobs"></a></p>

<h3>Scheduling Queued Jobs</h3>

<p>The <code>job</code> method may be used to schedule a <a href="/docs/%7B%7Bversion%7D%7D/queues">queued job</a>. This method provides a convenient way to schedule jobs without using the <code>call</code> method to manually create Closures to queue the job:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">job</span><span class="p">(</span><span class="k">new</span> <span class="nx">Heartbeat</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">everyFiveMinutes</span><span class="p">();</span>

<span class="c1">// Dispatch the job to the &quot;heartbeats&quot; queue...</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">job</span><span class="p">(</span><span class="k">new</span> <span class="nx">Heartbeat</span><span class="p">,</span> <span class="s1">&#39;heartbeats&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">everyFiveMinutes</span><span class="p">();</span>
</pre></div>

<p><a name="scheduling-shell-commands"></a></p>

<h3>Scheduling Shell Commands</h3>

<p>The <code>exec</code> method may be used to issue a command to the operating system:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;node /home/forge/script.js&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p><a name="schedule-frequency-options"></a></p>

<h3>Schedule Frequency Options</h3>

<p>There are a variety of schedules you may assign to your task:</p>

<p>Method  | Description
------------- | -------------
<code>-&gt;cron(&#39;* * * * *&#39;);</code>  |  Run the task on a custom Cron schedule
<code>-&gt;everyMinute();</code>  |  Run the task every minute
<code>-&gt;everyTwoMinutes();</code>  |  Run the task every two minutes
<code>-&gt;everyThreeMinutes();</code>  |  Run the task every three minutes
<code>-&gt;everyFourMinutes();</code>  |  Run the task every four minutes
<code>-&gt;everyFiveMinutes();</code>  |  Run the task every five minutes
<code>-&gt;everyTenMinutes();</code>  |  Run the task every ten minutes
<code>-&gt;everyFifteenMinutes();</code>  |  Run the task every fifteen minutes
<code>-&gt;everyThirtyMinutes();</code>  |  Run the task every thirty minutes
<code>-&gt;hourly();</code>  |  Run the task every hour
<code>-&gt;hourlyAt(17);</code>  |  Run the task every hour at 17 minutes past the hour
<code>-&gt;everyTwoHours();</code>  |  Run the task every two hours
<code>-&gt;everyThreeHours();</code>  |  Run the task every three hours
<code>-&gt;everyFourHours();</code>  |  Run the task every four hours
<code>-&gt;everySixHours();</code>  |  Run the task every six hours
<code>-&gt;daily();</code>  |  Run the task every day at midnight
<code>-&gt;dailyAt(&#39;13:00&#39;);</code>  |  Run the task every day at 13:00
<code>-&gt;twiceDaily(1, 13);</code>  |  Run the task daily at 1:00 &amp; 13:00
<code>-&gt;weekly();</code>  |  Run the task every sunday at 00:00
<code>-&gt;weeklyOn(1, &#39;8:00&#39;);</code>  |  Run the task every week on Monday at 8:00
<code>-&gt;monthly();</code>  |  Run the task on the first day of every month at 00:00
<code>-&gt;monthlyOn(4, &#39;15:00&#39;);</code>  |  Run the task every month on the 4th at 15:00
<code>-&gt;lastDayOfMonth(&#39;15:00&#39;);</code> | Run the task on the last day of the month at 15:00
<code>-&gt;quarterly();</code> |  Run the task on the first day of every quarter at 00:00
<code>-&gt;yearly();</code>  |  Run the task on the first day of every year at 00:00
<code>-&gt;timezone(&#39;America/New_York&#39;);</code> | Set the timezone</p>

<p>These methods may be combined with additional constraints to create even more finely tuned schedules that only run on certain days of the week. For example, to schedule a command to run weekly on Monday:</p>
<div class="highlight"><pre><span></span><span class="c1">// Run once per week on Monday at 1 PM...</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">weekly</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">mondays</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;13:00&#39;</span><span class="p">);</span>

<span class="c1">// Run hourly from 8 AM to 5 PM on weekdays...</span>
<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">weekdays</span><span class="p">()</span>
          <span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">()</span>
          <span class="o">-&gt;</span><span class="nx">timezone</span><span class="p">(</span><span class="s1">&#39;America/Chicago&#39;</span><span class="p">)</span>
          <span class="o">-&gt;</span><span class="nx">between</span><span class="p">(</span><span class="s1">&#39;8:00&#39;</span><span class="p">,</span> <span class="s1">&#39;17:00&#39;</span><span class="p">);</span>
</pre></div>

<p>Below is a list of the additional schedule constraints:</p>

<p>Method  | Description
------------- | -------------
<code>-&gt;weekdays();</code>  |  Limit the task to weekdays
<code>-&gt;weekends();</code>  |  Limit the task to weekends
<code>-&gt;sundays();</code>  |  Limit the task to Sunday
<code>-&gt;mondays();</code>  |  Limit the task to Monday
<code>-&gt;tuesdays();</code>  |  Limit the task to Tuesday
<code>-&gt;wednesdays();</code>  |  Limit the task to Wednesday
<code>-&gt;thursdays();</code>  |  Limit the task to Thursday
<code>-&gt;fridays();</code>  |  Limit the task to Friday
<code>-&gt;saturdays();</code>  |  Limit the task to Saturday
<code>-&gt;days(array|mixed);</code>  |  Limit the task to specific days
<code>-&gt;between($start, $end);</code>  |  Limit the task to run between start and end times
<code>-&gt;when(Closure);</code>  |  Limit the task based on a truth test
<code>-&gt;environments($env);</code>  |  Limit the task to specific environments</p>

<h4>Day Constraints</h4>

<p>The <code>days</code> method may be used to limit the execution of a task to specific days of the week. For example, you may schedule a command to run hourly on Sundays and Wednesdays:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;reminders:send&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">days</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>

<h4>Between Time Constraints</h4>

<p>The <code>between</code> method may be used to limit the execution of a task based on the time of day:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;reminders:send&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="nx">between</span><span class="p">(</span><span class="s1">&#39;7:00&#39;</span><span class="p">,</span> <span class="s1">&#39;22:00&#39;</span><span class="p">);</span>
</pre></div>

<p>Similarly, the <code>unlessBetween</code> method can be used to exclude the execution of a task for a period of time:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;reminders:send&#39;</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nx">hourly</span><span class="p">()</span>
                    <span class="o">-&gt;</span><span class="nx">unlessBetween</span><span class="p">(</span><span class="s1">&#39;23:00&#39;</span><span class="p">,</span> <span class="s1">&#39;4:00&#39;</span><span class="p">);</span>
</pre></div>

<h4>Truth Test Constraints</h4>

<p>The <code>when</code> method may be used to limit the execution of a task based on the result of a given truth test. In other words, if the given <code>Closure</code> returns <code>true</code>, the task will execute as long as no other constraining conditions prevent the task from running:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">when</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The <code>skip</code> method may be seen as the inverse of <code>when</code>. If the <code>skip</code> method returns <code>true</code>, the scheduled task will not be executed:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">skip</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>When using chained <code>when</code> methods, the scheduled command will only execute if all <code>when</code> conditions return <code>true</code>.</p>

<h4>Environment Constraints</h4>

<p>The <code>environments</code> method may be used to execute tasks only on the given environments:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">environments</span><span class="p">([</span><span class="s1">&#39;staging&#39;</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="timezones"></a></p>

<h3>Timezones</h3>

<p>Using the <code>timezone</code> method, you may specify that a scheduled task&#39;s time should be interpreted within a given timezone:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;report:generate&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">timezone</span><span class="p">(</span><span class="s1">&#39;America/New_York&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;02:00&#39;</span><span class="p">)</span>
</pre></div>

<p>If you are assigning the same timezone to all of your scheduled tasks, you may wish to define a <code>scheduleTimezone</code> method in your <code>app/Console/Kernel.php</code> file. This method should return the default timezone that should be assigned to all scheduled tasks:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the timezone that should be used by default for scheduled events.</span>
<span class="cm"> *</span>
<span class="cm"> * @return \DateTimeZone|string|null</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">scheduleTimezone</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Remember that some timezones utilize daylight savings time. When daylight saving time changes occur, your scheduled task may run twice or even not run at all. For this reason, we recommend avoiding timezone scheduling when possible.</p>
</blockquote>

<p><a name="preventing-task-overlaps"></a></p>

<h3>Preventing Task Overlaps</h3>

<p>By default, scheduled tasks will be run even if the previous instance of the task is still running. To prevent this, you may use the <code>withoutOverlapping</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withoutOverlapping</span><span class="p">();</span>
</pre></div>

<p>In this example, the <code>emails:send</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> will be run every minute if it is not already running. The <code>withoutOverlapping</code> method is especially useful if you have tasks that vary drastically in their execution time, preventing you from predicting exactly how long a given task will take.</p>

<p>If needed, you may specify how many minutes must pass before the &quot;without overlapping&quot; lock expires. By default, the lock will expire after 24 hours:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withoutOverlapping</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>

<p><a name="running-tasks-on-one-server"></a></p>

<h3>Running Tasks On One Server</h3>

<blockquote>
<p>{note} To utilize this feature, your application must be using the <code>database</code>, <code>memcached</code>, or <code>redis</code> cache driver as your application&#39;s default cache driver. In addition, all servers must be communicating with the same central cache server.</p>
</blockquote>

<p>If your application is running on multiple servers, you may limit a scheduled job to only execute on a single server. For instance, assume you have a scheduled task that generates a new report every Friday night. If the task scheduler is running on three worker servers, the scheduled task will run on all three servers and generate the report three times. Not good!</p>

<p>To indicate that the task should run on only one server, use the <code>onOneServer</code> method when defining the scheduled task. The first server to obtain the task will secure an atomic lock on the job to prevent other servers from running the same task at the same time:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;report:generate&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">fridays</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;17:00&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nx">onOneServer</span><span class="p">();</span>
</pre></div>

<p><a name="background-tasks"></a></p>

<h3>Background Tasks</h3>

<p>By default, multiple commands scheduled at the same time will execute sequentially. If you have long-running commands, this may cause subsequent commands to start much later than anticipated. If you would like to run commands in the background so that they may all run simultaneously, you may use the <code>runInBackground</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;analytics:report&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">runInBackground</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} The <code>runInBackground</code> method may only be used when scheduling tasks via the <code>command</code> and <code>exec</code> methods.</p>
</blockquote>

<p><a name="maintenance-mode"></a></p>

<h3>Maintenance Mode</h3>

<p>Laravel&#39;s scheduled tasks will not run when Laravel is in <a href="/docs/%7B%7Bversion%7D%7D/configuration#maintenance-mode">maintenance mode</a>, since we don&#39;t want your tasks to interfere with any unfinished maintenance you may be performing on your server. However, if you would like to force a task to run even in maintenance mode, you may use the <code>evenInMaintenanceMode</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">evenInMaintenanceMode</span><span class="p">();</span>
</pre></div>

<p><a name="task-output"></a></p>

<h2>Task Output</h2>

<p>The Laravel scheduler provides several convenient methods for working with the output generated by scheduled tasks. First, using the <code>sendOutputTo</code> method, you may send the output to a file for later inspection:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">);</span>
</pre></div>

<p>If you would like to append the output to a given file, you may use the <code>appendOutputTo</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">appendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">);</span>
</pre></div>

<p>Using the <code>emailOutputTo</code> method, you may e-mail the output to an e-mail address of your choice. Before e-mailing the output of a task, you should configure Laravel&#39;s <a href="/docs/%7B%7Bversion%7D%7D/mail">e-mail services</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">sendOutputTo</span><span class="p">(</span><span class="nx">$filePath</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">emailOutputTo</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">);</span>
</pre></div>

<p>If you only want to e-mail the output if the command fails, use the <code>emailOutputOnFailure</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">emailOutputOnFailure</span><span class="p">(</span><span class="s1">&#39;foo@example.com&#39;</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} The <code>emailOutputTo</code>, <code>emailOutputOnFailure</code>, <code>sendOutputTo</code>, and <code>appendOutputTo</code> methods are exclusive to the <code>command</code> and <code>exec</code> methods.</p>
</blockquote>

<p><a name="task-hooks"></a></p>

<h2>Task Hooks</h2>

<p>Using the <code>before</code> and <code>after</code> methods, you may specify code to be executed before and after the scheduled task is complete:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// Task is about to start...</span>
         <span class="p">})</span>
         <span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// Task is complete...</span>
         <span class="p">});</span>
</pre></div>

<p>The <code>onSuccess</code> and <code>onFailure</code> methods allow you to specify code to be executed if the scheduled task succeeds or fails:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">onSuccess</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// The task succeeded...</span>
         <span class="p">})</span>
         <span class="o">-&gt;</span><span class="nx">onFailure</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
             <span class="c1">// The task failed...</span>
         <span class="p">});</span>
</pre></div>

<p>If output is available from your command, you may access it in your <code>after</code>, <code>onSuccess</code> or <code>onFailure</code> hooks by type-hinting an <code>Illuminate\Support\Stringable</code> instance as <code>$output</code> on your hook&#39;s Closure definition:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Stringable</span><span class="p">;</span>

<span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">onSuccess</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Stringable</span> <span class="nx">$output</span><span class="p">)</span> <span class="p">{</span>
             <span class="c1">// The task succeeded...</span>
         <span class="p">})</span>
         <span class="o">-&gt;</span><span class="nx">onFailure</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Stringable</span> <span class="nx">$output</span><span class="p">)</span> <span class="p">{</span>
             <span class="c1">// The task failed...</span>
         <span class="p">});</span>
</pre></div>

<h4>Pinging URLs</h4>

<p>Using the <code>pingBefore</code> and <code>thenPing</code> methods, the scheduler can automatically ping a given URL before or after a task is complete. This method is useful for notifying an external service, such as <a href="https://envoyer.io">Laravel Envoyer</a>, that your scheduled task is commencing or has finished execution:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">pingBefore</span><span class="p">(</span><span class="nx">$url</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">thenPing</span><span class="p">(</span><span class="nx">$url</span><span class="p">);</span>
</pre></div>

<p>The <code>pingBeforeIf</code> and <code>thenPingIf</code> methods may be used to ping a given URL only if the given condition is <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">pingBeforeIf</span><span class="p">(</span><span class="nx">$condition</span><span class="p">,</span> <span class="nx">$url</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">thenPingIf</span><span class="p">(</span><span class="nx">$condition</span><span class="p">,</span> <span class="nx">$url</span><span class="p">);</span>
</pre></div>

<p>The <code>pingOnSuccess</code> and <code>pingOnFailure</code> methods may be used to ping a given URL only if the task succeeds or fails:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;emails:send&#39;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">daily</span><span class="p">()</span>
         <span class="o">-&gt;</span><span class="nx">pingOnSuccess</span><span class="p">(</span><span class="nx">$successUrl</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="nx">pingOnFailure</span><span class="p">(</span><span class="nx">$failureUrl</span><span class="p">);</span>
</pre></div>

<p>All of the ping methods require the Guzzle HTTP library. You can add Guzzle to your project using the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">guzzlehttp</span><span class="o">/</span><span class="nx">guzzle</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Laravel Scout</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#queueing">Queueing</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#configuration">Configuration</a>

<ul>
<li><a href="#configuring-model-indexes">Configuring Model Indexes</a></li>
<li><a href="#configuring-searchable-data">Configuring Searchable Data</a></li>
<li><a href="#configuring-the-model-id">Configuring The Model ID</a></li>
<li><a href="#identifying-users">Identifying Users</a></li>
</ul></li>
<li><a href="#indexing">Indexing</a>

<ul>
<li><a href="#batch-import">Batch Import</a></li>
<li><a href="#adding-records">Adding Records</a></li>
<li><a href="#updating-records">Updating Records</a></li>
<li><a href="#removing-records">Removing Records</a></li>
<li><a href="#pausing-indexing">Pausing Indexing</a></li>
<li><a href="#conditionally-searchable-model-instances">Conditionally Searchable Model Instances</a></li>
</ul></li>
<li><a href="#searching">Searching</a>

<ul>
<li><a href="#where-clauses">Where Clauses</a></li>
<li><a href="#pagination">Pagination</a></li>
<li><a href="#soft-deleting">Soft Deleting</a></li>
<li><a href="#customizing-engine-searches">Customizing Engine Searches</a></li>
</ul></li>
<li><a href="#custom-engines">Custom Engines</a></li>
<li><a href="#builder-macros">Builder Macros</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Scout provides a simple, driver based solution for adding full-text search to your <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent models</a>. Using model observers, Scout will automatically keep your search indexes in sync with your Eloquent records.</p>

<p>Currently, Scout ships with an <a href="https://www.algolia.com/">Algolia</a> driver; however, writing custom drivers is simple and you are free to extend Scout with your own search implementations.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>First, install Scout via the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">scout</span>
</pre></div>

<p>After installing Scout, you should publish the Scout configuration using the <code>vendor:publish</code> Artisan command. This command will publish the <code>scout.php</code> configuration file to your <code>config</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&quot;Laravel\Scout\ScoutServiceProvider&quot;</span>
</pre></div>

<p>Finally, add the <code>Laravel\Scout\Searchable</code> trait to the model you would like to make searchable. This trait will register a model observer to keep the model in sync with your search driver:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Scout\Searchable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Searchable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="queueing"></a></p>

<h3>Queueing</h3>

<p>While not strictly required to use Scout, you should strongly consider configuring a <a href="/docs/%7B%7Bversion%7D%7D/queues">queue driver</a> before using the library. Running a queue worker will allow Scout to queue all operations that sync your model information to your search indexes, providing much better response times for your application&#39;s web interface.</p>

<p>Once you have configured a queue driver, set the value of the <code>queue</code> option in your <code>config/scout.php</code> configuration file to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;queue&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
</pre></div>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Algolia</h4>

<p>When using the Algolia driver, you should configure your Algolia <code>id</code> and <code>secret</code> credentials in your <code>config/scout.php</code> configuration file. Once your credentials have been configured, you will also need to install the Algolia PHP SDK via the Composer package manager:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">algolia</span><span class="o">/</span><span class="nx">algoliasearch</span><span class="o">-</span><span class="nx">client</span><span class="o">-</span><span class="nx">php</span><span class="o">:^</span><span class="mf">2.2</span>
</pre></div>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p><a name="configuring-model-indexes"></a></p>

<h3>Configuring Model Indexes</h3>

<p>Each Eloquent model is synced with a given search &quot;index&quot;, which contains all of the searchable records for that model. In other words, you can think of each index like a MySQL table. By default, each model will be persisted to an index matching the model&#39;s typical &quot;table&quot; name. Typically, this is the plural form of the model name; however, you are free to customize the model&#39;s index by overriding the <code>searchableAs</code> method on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Scout\Searchable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Searchable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the index name for the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">searchableAs</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;posts_index&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="configuring-searchable-data"></a></p>

<h3>Configuring Searchable Data</h3>

<p>By default, the entire <code>toArray</code> form of a given model will be persisted to its search index. If you would like to customize the data that is synchronized to the search index, you may override the <code>toSearchableArray</code> method on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Scout\Searchable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Searchable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the indexable data array for the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toSearchableArray</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

        <span class="c1">// Customize array...</span>

        <span class="k">return</span> <span class="nv">$array</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="configuring-the-model-id"></a></p>

<h3>Configuring The Model ID</h3>

<p>By default, Scout will use the primary key of the model as the unique ID stored in the search index. If you need to customize this behavior, you may override the <code>getScoutKey</code> and the <code>getScoutKeyName</code> methods on the model:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Scout\Searchable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Searchable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the value used to index the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getScoutKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the key name used to index the model.</span>
<span class="sd">     *</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getScoutKeyName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;email&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="identifying-users"></a></p>

<h3>Identifying Users</h3>

<p>Scout also allows you to auto identify users when using Algolia. Associating the authenticated user with search operations may be helpful when viewing your search analytics within Algolia&#39;s dashboard. You can enable user identification by setting <code>SCOUT_IDENTIFY</code> to <code>true</code> in your <code>.env</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">SCOUT_IDENTIFY</span><span class="o">=</span><span class="kc">true</span>
</pre></div>

<p>Enabling this feature this will also pass the request&#39;s IP address and your authenticated user&#39;s primary identifier to Algolia so this data is associated with any search request that is made by the user.</p>

<p><a name="indexing"></a></p>

<h2>Indexing</h2>

<p><a name="batch-import"></a></p>

<h3>Batch Import</h3>

<p>If you are installing Scout into an existing project, you may already have database records you need to import into your search driver. Scout provides an <code>import</code> Artisan command that you may use to import all of your existing records into your search indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">scout</span><span class="o">:</span><span class="kr">import</span> <span class="s2">&quot;App\Models\Post&quot;</span>
</pre></div>

<p>The <code>flush</code> command may be used to remove all of a model&#39;s records from your search indexes:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">scout</span><span class="o">:</span><span class="nx">flush</span> <span class="s2">&quot;App\Models\Post&quot;</span>
</pre></div>

<p><a name="adding-records"></a></p>

<h3>Adding Records</h3>

<p>Once you have added the <code>Laravel\Scout\Searchable</code> trait to a model, all you need to do is <code>save</code> a model instance and it will automatically be added to your search index. If you have configured Scout to <a href="#queueing">use queues</a> this operation will be performed in the background by your queue worker:</p>
<div class="highlight"><pre><span></span><span class="nx">$order</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<h4>Adding Via Query</h4>

<p>If you would like to add a collection of models to your search index via an Eloquent query, you may chain the <code>searchable</code> method onto an Eloquent query. The <code>searchable</code> method will <a href="/docs/%7B%7Bversion%7D%7D/eloquent#chunking-results">chunk the results</a> of the query and add the records to your search index. Again, if you have configured Scout to use queues, all of the chunks will be added in the background by your queue workers:</p>
<div class="highlight"><pre><span></span><span class="c1">// Adding via Eloquent query...</span>
<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="c1">// You may also add records via relationships...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">orders</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="c1">// You may also add records via collections...</span>
<span class="nx">$orders</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>
</pre></div>

<p>The <code>searchable</code> method can be considered an &quot;upsert&quot; operation. In other words, if the model record is already in your index, it will be updated. If it does not exist in the search index, it will be added to the index.</p>

<p><a name="updating-records"></a></p>

<h3>Updating Records</h3>

<p>To update a searchable model, you only need to update the model instance&#39;s properties and <code>save</code> the model to your database. Scout will automatically persist the changes to your search index:</p>
<div class="highlight"><pre><span></span><span class="nx">$order</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Update the order...</span>

<span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>
</pre></div>

<p>You may also use the <code>searchable</code> method on an Eloquent query to update a collection of models. If the models do not exist in your search index, they will be created:</p>
<div class="highlight"><pre><span></span><span class="c1">// Updating via Eloquent query...</span>
<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="c1">// You may also update via relationships...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">orders</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="c1">// You may also update via collections...</span>
<span class="nx">$orders</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>
</pre></div>

<p><a name="removing-records"></a></p>

<h3>Removing Records</h3>

<p>To remove a record from your index, <code>delete</code> the model from the database. This form of removal is even compatible with <a href="/docs/%7B%7Bversion%7D%7D/eloquent#soft-deleting">soft deleted</a> models:</p>
<div class="highlight"><pre><span></span><span class="nx">$order</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">$order</span><span class="o">-&gt;</span><span class="k">delete</span><span class="p">();</span>
</pre></div>

<p>If you do not want to retrieve the model before deleting the record, you may use the <code>unsearchable</code> method on an Eloquent query instance or collection:</p>
<div class="highlight"><pre><span></span><span class="c1">// Removing via Eloquent query...</span>
<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unsearchable</span><span class="p">();</span>

<span class="c1">// You may also remove via relationships...</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">orders</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">unsearchable</span><span class="p">();</span>

<span class="c1">// You may also remove via collections...</span>
<span class="nx">$orders</span><span class="o">-&gt;</span><span class="nx">unsearchable</span><span class="p">();</span>
</pre></div>

<p><a name="pausing-indexing"></a></p>

<h3>Pausing Indexing</h3>

<p>Sometimes you may need to perform a batch of Eloquent operations on a model without syncing the model data to your search index. You may do this using the <code>withoutSyncingToSearch</code> method. This method accepts a single callback which will be immediately executed. Any model operations that occur within the callback will not be synced to the model&#39;s index:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">withoutSyncingToSearch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Perform model actions...</span>
<span class="p">});</span>
</pre></div>

<p><a name="conditionally-searchable-model-instances"></a></p>

<h3>Conditionally Searchable Model Instances</h3>

<p>Sometimes you may need to only make a model searchable under certain conditions. For example, imagine you have <code>App\Models\Post</code> model that may be in one of two states: &quot;draft&quot; and &quot;published&quot;. You may only want to allow &quot;published&quot; posts to be searchable. To accomplish this, you may define a <code>shouldBeSearchable</code> method on your model:</p>
<div class="highlight"><pre><span></span><span class="kr">public</span> <span class="kd">function</span> <span class="nx">shouldBeSearchable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">isPublished</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>The <code>shouldBeSearchable</code> method is only applied when manipulating models through the <code>save</code> method, queries, or relationships. Directly making models or collections searchable using the <code>searchable</code> method will override the result of the <code>shouldBeSearchable</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Will respect &quot;shouldBeSearchable&quot;...</span>
<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">orders</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">save</span><span class="p">();</span>

<span class="c1">// Will override &quot;shouldBeSearchable&quot;...</span>
<span class="nx">$orders</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>

<span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">searchable</span><span class="p">();</span>
</pre></div>

<p><a name="searching"></a></p>

<h2>Searching</h2>

<p>You may begin searching a model using the <code>search</code> method. The search method accepts a single string that will be used to search your models. You should then chain the <code>get</code> method onto the search query to retrieve the Eloquent models that match the given search query:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p>Since Scout searches return a collection of Eloquent models, you may even return the results directly from a route or controller and they will automatically be converted to JSON:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>If you would like to get the raw results before they are converted to Eloquent models, you should use the <code>raw</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">raw</span><span class="p">();</span>
</pre></div>

<p>Search queries will typically be performed on the index specified by the model&#39;s <a href="#configuring-model-indexes"><code>searchableAs</code></a> method. However, you may use the <code>within</code> method to specify a custom index that should be searched instead:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">within</span><span class="p">(</span><span class="s1">&#39;tv_shows_popularity_desc&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="where-clauses"></a></p>

<h3>Where Clauses</h3>

<p>Scout allows you to add simple &quot;where&quot; clauses to your search queries. Currently, these clauses only support basic numeric equality checks, and are primarily useful for scoping search queries by a tenant ID. Since a search index is not a relational database, more advanced &quot;where&quot; clauses are not currently supported:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="pagination"></a></p>

<h3>Pagination</h3>

<p>In addition to retrieving a collection of models, you may paginate your search results using the <code>paginate</code> method. This method will return a <code>Paginator</code> instance just as if you had <a href="/docs/%7B%7Bversion%7D%7D/pagination">paginated a traditional Eloquent query</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">();</span>
</pre></div>

<p>You may specify how many models to retrieve per page by passing the amount as the first argument to the <code>paginate</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>

<p>Once you have retrieved the results, you may display the results and render the page links using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade</a> just as if you had paginated a traditional Eloquent query:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$orders</span> <span class="nx">as</span> <span class="nx">$order</span><span class="p">)</span>
        <span class="p">{{</span> <span class="nx">$order</span><span class="o">-&gt;</span><span class="nx">price</span> <span class="p">}}</span>
    <span class="err">@</span><span class="nx">endforeach</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="p">{{</span> <span class="nx">$orders</span><span class="o">-&gt;</span><span class="nx">links</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

<p><a name="soft-deleting"></a></p>

<h3>Soft Deleting</h3>

<p>If your indexed models are <a href="/docs/%7B%7Bversion%7D%7D/eloquent#soft-deleting">soft deleting</a> and you need to search your soft deleted models, set the <code>soft_delete</code> option of the <code>config/scout.php</code> configuration file to <code>true</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;soft_delete&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
</pre></div>

<p>When this configuration option is <code>true</code>, Scout will not remove soft deleted models from the search index. Instead, it will set a hidden <code>__soft_deleted</code> attribute on the indexed record. Then, you may use the <code>withTrashed</code> or <code>onlyTrashed</code> methods to retrieve the soft deleted records when searching:</p>
<div class="highlight"><pre><span></span><span class="c1">// Include trashed records when retrieving results...</span>
<span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>

<span class="c1">// Only include trashed records when retrieving results...</span>
<span class="nx">$orders</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">onlyTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{tip} When a soft deleted model is permanently deleted using <code>forceDelete</code>, Scout will remove it from the search index automatically.</p>
</blockquote>

<p><a name="customizing-engine-searches"></a></p>

<h3>Customizing Engine Searches</h3>

<p>If you need to customize the search behavior of an engine you may pass a callback as the second argument to the <code>search</code> method. For example, you could use this callback to add geo-location data to your search options before the search query is passed to Algolia:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Algolia</span><span class="err">\</span><span class="nx">AlgoliaSearch</span><span class="err">\</span><span class="nx">SearchIndex</span><span class="p">;</span>

<span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">SearchIndex</span> <span class="nx">$algolia</span><span class="p">,</span> <span class="nx">string</span> <span class="nx">$query</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">$options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$options</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;bool&#39;</span><span class="p">][</span><span class="s1">&#39;filter&#39;</span><span class="p">][</span><span class="s1">&#39;geo_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;distance&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;1000km&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span> <span class="p">=&gt;</span> <span class="mi">36</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span> <span class="p">=&gt;</span> <span class="mi">111</span><span class="p">],</span>
    <span class="p">];</span>

    <span class="k">return</span> <span class="nx">$algolia</span><span class="o">-&gt;</span><span class="nx">search</span><span class="p">(</span><span class="nx">$query</span><span class="p">,</span> <span class="nx">$options</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">();</span>
</pre></div>

<p><a name="custom-engines"></a></p>

<h2>Custom Engines</h2>

<h4>Writing The Engine</h4>

<p>If one of the built-in Scout search engines doesn&#39;t fit your needs, you may write your own custom engine and register it with Scout. Your engine should extend the <code>Laravel\Scout\Engines\Engine</code> abstract class. This abstract class contains eight methods your custom engine must implement:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Scout</span><span class="err">\</span><span class="nx">Builder</span><span class="p">;</span>

<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">$models</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="k">delete</span><span class="p">(</span><span class="nx">$models</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">search</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">paginate</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">,</span> <span class="nx">$perPage</span><span class="p">,</span> <span class="nx">$page</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">mapIds</span><span class="p">(</span><span class="nx">$results</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">Builder</span> <span class="nx">$builder</span><span class="p">,</span> <span class="nx">$results</span><span class="p">,</span> <span class="nx">$model</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getTotalCount</span><span class="p">(</span><span class="nx">$results</span><span class="p">);</span>
<span class="kr">abstract</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">flush</span><span class="p">(</span><span class="nx">$model</span><span class="p">);</span>
</pre></div>

<p>You may find it helpful to review the implementations of these methods on the <code>Laravel\Scout\Engines\AlgoliaEngine</code> class. This class will provide you with a good starting point for learning how to implement each of these methods in your own engine.</p>

<h4>Registering The Engine</h4>

<p>Once you have written your custom engine, you may register it with Scout using the <code>extend</code> method of the Scout engine manager. You should call the <code>extend</code> method from the <code>boot</code> method of your <code>AppServiceProvider</code> or any other service provider used by your application. For example, if you have written a <code>MySqlSearchEngine</code>, you may register it like so:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Scout</span><span class="err">\</span><span class="nx">EngineManager</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="nx">EngineManager</span><span class="o">::</span><span class="kr">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MySqlSearchEngine</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Once your engine has been registered, you may specify it as your default Scout <code>driver</code> in your <code>config/scout.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;driver&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
</pre></div>

<p><a name="builder-macros"></a></p>

<h2>Builder Macros</h2>

<p>If you would like to define a custom builder method, you may use the <code>macro</code> method on the <code>Laravel\Scout\Builder</code> class. Typically, &quot;macros&quot; should be defined within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider&#39;s</a> <code>boot</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Scout\Builder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ScoutMacroServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register the application&#39;s scout macros.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Builder</span><span class="o">::</span><span class="na">macro</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">engine</span><span class="o">-&gt;</span><span class="na">getTotalCount</span><span class="p">(</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">engine</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span>
            <span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>macro</code> function accepts a name as its first argument, and a Closure as its second. The macro&#39;s Closure will be executed when calling the macro name from a <code>Laravel\Scout\Builder</code> implementation:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Order</span><span class="o">::</span><span class="nx">search</span><span class="p">(</span><span class="s1">&#39;Star Trek&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">count</span><span class="p">();</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Database: Seeding</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#writing-seeders">Writing Seeders</a>

<ul>
<li><a href="#using-model-factories">Using Model Factories</a></li>
<li><a href="#calling-additional-seeders">Calling Additional Seeders</a></li>
</ul></li>
<li><a href="#running-seeders">Running Seeders</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel includes a simple method of seeding your database with test data using seed classes. All seed classes are stored in the <code>database/seeds</code> directory. Seed classes may have any name you wish, but probably should follow some sensible convention, such as <code>UserSeeder</code>, etc. By default, a <code>DatabaseSeeder</code> class is defined for you. From this class, you may use the <code>call</code> method to run other seed classes, allowing you to control the seeding order.</p>

<p><a name="writing-seeders"></a></p>

<h2>Writing Seeders</h2>

<p>To generate a seeder, execute the <code>make:seeder</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a>. All seeders generated by the framework will be placed in the <code>database/seeds</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">seeder</span> <span class="nx">UserSeeder</span>
</pre></div>

<p>A seeder class only contains one method by default: <code>run</code>. This method is called when the <code>db:seed</code> <a href="/docs/%7B%7Bversion%7D%7D/artisan">Artisan command</a> is executed. Within the <code>run</code> method, you may insert data into your database however you wish. You may use the <a href="/docs/%7B%7Bversion%7D%7D/queries">query builder</a> to manually insert data or you may use <a href="/docs/%7B%7Bversion%7D%7D/database-testing#writing-factories">Eloquent model factories</a>.</p>

<blockquote>
<p>{tip} <a href="/docs/%7B%7Bversion%7D%7D/eloquent#mass-assignment">Mass assignment protection</a> is automatically disabled during database seeding.</p>
</blockquote>

<p>As an example, let&#39;s modify the default <code>DatabaseSeeder</code> class and add a database insert statement to the <code>run</code> method:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Database\Seeders</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the database seeds.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;@gmail.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may type-hint any dependencies you need within the <code>run</code> method&#39;s signature. They will automatically be resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>
</blockquote>

<p><a name="using-model-factories"></a></p>

<h3>Using Model Factories</h3>

<p>Of course, manually specifying the attributes for each model seed is cumbersome. Instead, you can use <a href="/docs/%7B%7Bversion%7D%7D/database-testing#writing-factories">model factories</a> to conveniently generate large amounts of database records. First, review the <a href="/docs/%7B%7Bversion%7D%7D/database-testing#writing-factories">model factory documentation</a> to learn how to define your factories.</p>

<p>For example, let&#39;s create 50 users and attach a relationship to each user:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Run the database seeds.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">User</span><span class="o">::</span><span class="nx">factory</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="nx">times</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">hasPosts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">create</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><a name="calling-additional-seeders"></a></p>

<h3>Calling Additional Seeders</h3>

<p>Within the <code>DatabaseSeeder</code> class, you may use the <code>call</code> method to execute additional seed classes. Using the <code>call</code> method allows you to break up your database seeding into multiple files so that no single seeder class becomes overwhelmingly large. Pass the name of the seeder class you wish to run:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Run the database seeds.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">call</span><span class="p">([</span>
        <span class="nx">UserSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="nx">PostSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
        <span class="nx">CommentSeeder</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="running-seeders"></a></p>

<h2>Running Seeders</h2>

<p>Once you have written your seeder, you may need to regenerate Composer&#39;s autoloader using the <code>dump-autoload</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">dump</span><span class="o">-</span><span class="nx">autoload</span>
</pre></div>

<p>Now you may use the <code>db:seed</code> Artisan command to seed your database. By default, the <code>db:seed</code> command runs the <code>DatabaseSeeder</code> class, which may be used to call other seed classes. However, you may use the <code>--class</code> option to specify a specific seeder class to run individually:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="kr">class</span><span class="o">=</span><span class="nx">UserSeeder</span>
</pre></div>

<p>You may also seed your database using the <code>migrate:fresh</code> command, which will drop all tables and re-run all of your migrations. This command is useful for completely re-building your database:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span><span class="o">:</span><span class="nx">fresh</span> <span class="o">--</span><span class="nx">seed</span>
</pre></div>

<p><a name="forcing-seeding-production"></a></p>

<h4>Forcing Seeders To Run In Production</h4>

<p>Some seeding operations may cause you to alter or lose data. In order to protect you from running seeding commands against your production database, you will be prompted for confirmation before the seeders are executed. To force the seeders to run without a prompt, use the <code>--force</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="nx">force</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>HTTP Session</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#driver-prerequisites">Driver Prerequisites</a></li>
</ul></li>
<li><a href="#using-the-session">Using The Session</a>

<ul>
<li><a href="#retrieving-data">Retrieving Data</a></li>
<li><a href="#storing-data">Storing Data</a></li>
<li><a href="#flash-data">Flash Data</a></li>
<li><a href="#deleting-data">Deleting Data</a></li>
<li><a href="#regenerating-the-session-id">Regenerating The Session ID</a></li>
</ul></li>
<li><a href="#session-blocking">Session Blocking</a></li>
<li><a href="#adding-custom-session-drivers">Adding Custom Session Drivers</a>

<ul>
<li><a href="#implementing-the-driver">Implementing The Driver</a></li>
<li><a href="#registering-the-driver">Registering The Driver</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Since HTTP driven applications are stateless, sessions provide a way to store information about the user across multiple requests. Laravel ships with a variety of session backends that are accessed through an expressive, unified API. Support for popular backends such as <a href="https://memcached.org">Memcached</a>, <a href="https://redis.io">Redis</a>, and databases is included out of the box.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>The session configuration file is stored at <code>config/session.php</code>. Be sure to review the options available to you in this file. By default, Laravel is configured to use the <code>file</code> session driver, which will work well for many applications.</p>

<p>The session <code>driver</code> configuration option defines where session data will be stored for each request. Laravel ships with several great drivers out of the box:</p>

<div class="content-list" markdown="1">
- `file` - sessions are stored in `storage/framework/sessions`.
- `cookie` - sessions are stored in secure, encrypted cookies.
- `database` - sessions are stored in a relational database.
- `memcached` / `redis` - sessions are stored in one of these fast, cache based stores.
- `array` - sessions are stored in a PHP array and will not be persisted.
</div>

<blockquote>
<p>{tip} The array driver is used during <a href="/docs/%7B%7Bversion%7D%7D/testing">testing</a> and prevents the data stored in the session from being persisted.</p>
</blockquote>

<p><a name="driver-prerequisites"></a></p>

<h3>Driver Prerequisites</h3>

<h4>Database</h4>

<p>When using the <code>database</code> session driver, you will need to create a table to contain the session items. Below is an example <code>Schema</code> declaration for the table:</p>
<div class="highlight"><pre><span></span><span class="nx">Schema</span><span class="o">::</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">unique</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">foreignId</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">string</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;user_agent&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">nullable</span><span class="p">();</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">);</span>
    <span class="nx">$table</span><span class="o">-&gt;</span><span class="nx">integer</span><span class="p">(</span><span class="s1">&#39;last_activity&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>You may use the <code>session:table</code> Artisan command to generate this migration:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">session</span><span class="o">:</span><span class="nx">table</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h4>Redis</h4>

<p>Before using Redis sessions with Laravel, you will need to either install the PhpRedis PHP extension via PECL or install the <code>predis/predis</code> package (~1.0) via Composer. For more information on configuring Redis, consult its <a href="/docs/%7B%7Bversion%7D%7D/redis#configuration">Laravel documentation page</a>.</p>

<blockquote>
<p>{tip} In the <code>session</code> configuration file, the <code>connection</code> option may be used to specify which Redis connection is used by the session.</p>
</blockquote>

<p><a name="using-the-session"></a></p>

<h2>Using The Session</h2>

<p><a name="retrieving-data"></a></p>

<h3>Retrieving Data</h3>

<p>There are two primary ways of working with session data in Laravel: the global <code>session</code> helper and via a <code>Request</code> instance. First, let&#39;s look at accessing the session via a <code>Request</code> instance, which can be type-hinted on a controller method. Remember, controller method dependencies are automatically injected via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the profile for the given user.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @param  int  $id</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When you retrieve an item from the session, you may also pass a default value as the second argument to the <code>get</code> method. This default value will be returned if the specified key does not exist in the session. If you pass a <code>Closure</code> as the default value to the <code>get</code> method and the requested key does not exist, the <code>Closure</code> will be executed and its result returned:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h4>The Global Session Helper</h4>

<p>You may also use the global <code>session</code> PHP function to retrieve and store data in the session. When the <code>session</code> helper is called with a single, string argument, it will return the value of that session key. When the helper is called with an array of key / value pairs, those values will be stored in the session:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Retrieve a piece of data from the session...</span>
    <span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

    <span class="c1">// Specifying a default value...</span>
    <span class="nx">$value</span> <span class="o">=</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>

    <span class="c1">// Store a piece of data in the session...</span>
    <span class="nx">session</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} There is little practical difference between using the session via an HTTP request instance versus using the global <code>session</code> helper. Both methods are <a href="/docs/%7B%7Bversion%7D%7D/testing">testable</a> via the <code>assertSessionHas</code> method which is available in all of your test cases.</p>
</blockquote>

<h4>Retrieving All Session Data</h4>

<p>If you would like to retrieve all the data in the session, you may use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$data</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">();</span>
</pre></div>

<h4>Determining If An Item Exists In The Session</h4>

<p>To determine if an item is present in the session, you may use the <code>has</code> method. The <code>has</code> method returns <code>true</code> if the item is present and is not <code>null</code>:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>To determine if an item is present in the session, even if its value is <code>null</code>, you may use the <code>exists</code> method. The <code>exists</code> method returns <code>true</code> if the item is present:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="storing-data"></a></p>

<h3>Storing Data</h3>

<p>To store data in the session, you will typically use the <code>put</code> method or the <code>session</code> helper:</p>
<div class="highlight"><pre><span></span><span class="c1">// Via a request instance...</span>
<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>

<span class="c1">// Via the global helper...</span>
<span class="nx">session</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">]);</span>
</pre></div>

<h4>Pushing To Array Session Values</h4>

<p>The <code>push</code> method may be used to push a new value onto a session value that is an array. For example, if the <code>user.teams</code> key contains an array of team names, you may push a new value onto the array like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;user.teams&#39;</span><span class="p">,</span> <span class="s1">&#39;developers&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving &amp; Deleting An Item</h4>

<p>The <code>pull</code> method will retrieve and delete an item from the session in a single statement:</p>
<div class="highlight"><pre><span></span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">pull</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="flash-data"></a></p>

<h3>Flash Data</h3>

<p>Sometimes you may wish to store items in the session only for the next request. You may do so using the <code>flash</code> method. Data stored in the session using this method will be available immediately and during the subsequent HTTP request. After the subsequent HTTP request, the flashed data will be deleted. Flash data is primarily useful for short-lived status messages:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;Task was successful!&#39;</span><span class="p">);</span>
</pre></div>

<p>If you need to keep your flash data around for several requests, you may use the <code>reflash</code> method, which will keep all of the flash data for an additional request. If you only need to keep specific flash data, you may use the <code>keep</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">reflash</span><span class="p">();</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">keep</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="deleting-data"></a></p>

<h3>Deleting Data</h3>

<p>The <code>forget</code> method will remove a piece of data from the session. If you would like to remove all data from the session, you may use the <code>flush</code> method:</p>
<div class="highlight"><pre><span></span><span class="c1">// Forget a single key...</span>
<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forget</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>

<span class="c1">// Forget multiple keys...</span>
<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">forget</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">]);</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">flush</span><span class="p">();</span>
</pre></div>

<p><a name="regenerating-the-session-id"></a></p>

<h3>Regenerating The Session ID</h3>

<p>Regenerating the session ID is often done in order to prevent malicious users from exploiting a <a href="https://owasp.org/www-community/attacks/Session_fixation">session fixation</a> attack on your application.</p>

<p>Laravel automatically regenerates the session ID during authentication if you are using the built-in <code>LoginController</code>; however, if you need to manually regenerate the session ID, you may use the <code>regenerate</code> method.</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">regenerate</span><span class="p">();</span>
</pre></div>

<p><a name="session-blocking"></a></p>

<h2>Session Blocking</h2>

<blockquote>
<p>{note} To utilize session blocking, your application must be using a cache driver that supports <a href="/docs/%7B%7Bversion%7D%7D/cache#atomic-locks">atomic locks</a>. Currently, those cache drivers include the <code>memcached</code>, <code>dynamodb</code>, <code>redis</code>, and <code>database</code> drivers. In addition, you may not use the <code>cookie</code> session driver.</p>
</blockquote>

<p>By default, Laravel allows requests using the same session to execute concurrently. So, for example, if you use a JavaScript HTTP library to make two HTTP requests to your application, they will both execute at the same time. For many applications, this is not a problem; however, session data loss can occur in a small subset of applications that make concurrent requests to two different application endpoints which both write data to the session.</p>

<p>To mitigate this, Laravel provides functionality that allows you to limit concurrent requests for a given session. To get started, you may simply chain the <code>block</code> method onto your route definition. In this example, an incoming request to the <code>/profile</code> endpoint would acquire a session lock. While this lock is being held, any incoming requests to the <code>/profile</code> or <code>/order</code> endpoints which share the same session ID will wait for the first request to finish executing before continuing their execution:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">(</span><span class="nx">$lockSeconds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">$waitSeconds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/order&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">(</span><span class="nx">$lockSeconds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">$waitSeconds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

<p>The <code>block</code> method accepts two optional arguments. The first argument accepted by the <code>block</code> method is the maximum number of seconds the session lock should be held for before it is released. Of course, if the request finishes executing before this time the lock will be released earlier.</p>

<p>The second argument accepted by the <code>block</code> method is the number of seconds a request should wait while attempting to obtain a session lock. A <code>Illuminate\Contracts\Cache\LockTimoutException</code> will be thrown if the request is unable to obtain a session lock within the given number of seconds.</p>

<p>If neither of these arguments are passed, the lock will be obtained for a maximum of 10 seconds and requests will wait a maximum of 10 seconds while attempting to obtain a lock:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">block</span><span class="p">()</span>
</pre></div>

<p><a name="adding-custom-session-drivers"></a></p>

<h2>Adding Custom Session Drivers</h2>

<p><a name="implementing-the-driver"></a></p>

<h4>Implementing The Driver</h4>

<p>Your custom session driver should implement the <code>SessionHandlerInterface</code>. This interface contains just a few simple methods we need to implement. A stubbed MongoDB implementation looks something like this:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Extensions</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MongoSessionHandler</span> <span class="k">implements</span> <span class="nx">\SessionHandlerInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">(</span><span class="nv">$savePath</span><span class="p">,</span> <span class="nv">$sessionName</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">gc</span><span class="p">(</span><span class="nv">$lifetime</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} Laravel does not ship with a directory to contain your extensions. You are free to place them anywhere you like. In this example, we have created an <code>Extensions</code> directory to house the <code>MongoSessionHandler</code>.</p>
</blockquote>

<p>Since the purpose of these methods is not readily understandable, let&#39;s quickly cover what each of the methods do:</p>

<div class="content-list" markdown="1">
- The `open` method would typically be used in file based session store systems. Since Laravel ships with a `file` session driver, you will almost never need to put anything in this method. You can leave it as an empty stub. It is a fact of poor interface design (which we'll discuss later) that PHP requires us to implement this method.
- The `close` method, like the `open` method, can also usually be disregarded. For most drivers, it is not needed.
- The `read` method should return the string version of the session data associated with the given `$sessionId`. There is no need to do any serialization or other encoding when retrieving or storing session data in your driver, as Laravel will perform the serialization for you.
- The `write` method should write the given `$data` string associated with the `$sessionId` to some persistent storage system, such as MongoDB, Dynamo, etc.  Again, you should not perform any serialization - Laravel will have already handled that for you.
- The `destroy` method should remove the data associated with the `$sessionId` from persistent storage.
- The `gc` method should destroy all session data that is older than the given `$lifetime`, which is a UNIX timestamp. For self-expiring systems like Memcached and Redis, this method may be left empty.
</div>

<p><a name="registering-the-driver"></a></p>

<h4>Registering The Driver</h4>

<p>Once your driver has been implemented, you are ready to register it with the framework. To add additional drivers to Laravel&#39;s session backend, you may use the <code>extend</code> method on the <code>Session</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. You should call the <code>extend</code> method from the <code>boot</code> method of a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. You may do this from the existing <code>AppServiceProvider</code> or create an entirely new provider:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Extensions\MongoSessionHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Session</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SessionServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Session</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;mongo&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Return implementation of SessionHandlerInterface...</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">MongoSessionHandler</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the session driver has been registered, you may use the <code>mongo</code> driver in your <code>config/session.php</code> configuration file.</p>
<div style="page-break-after: always;" ></div><h1>Laravel Socialite</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#upgrading-socialite">Upgrading Socialite</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#optional-parameters">Optional Parameters</a></li>
<li><a href="#access-scopes">Access Scopes</a></li>
<li><a href="#stateless-authentication">Stateless Authentication</a></li>
<li><a href="#retrieving-user-details">Retrieving User Details</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>In addition to typical, form based authentication, Laravel also provides a simple, convenient way to authenticate with OAuth providers using <a href="https://github.com/laravel/socialite">Laravel Socialite</a>. Socialite currently supports authentication with Facebook, Twitter, LinkedIn, Google, GitHub, GitLab and Bitbucket.</p>

<blockquote>
<p>{tip} Adapters for other platforms are listed at the community driven <a href="https://socialiteproviders.com/">Socialite Providers</a> website.</p>
</blockquote>

<p><a name="upgrading-socialite"></a></p>

<h2>Upgrading Socialite</h2>

<p>When upgrading to a new major version of Socialite, it&#39;s important that you carefully review <a href="https://github.com/laravel/socialite/blob/master/UPGRADE.md">the upgrade guide</a>.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>To get started with Socialite, use Composer to add the package to your project&#39;s dependencies:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">socialite</span>
</pre></div>

<p><a name="configuration"></a></p>

<h2>Configuration</h2>

<p>Before using Socialite, you will also need to add credentials for the OAuth services your application utilizes. These credentials should be placed in your <code>config/services.php</code> configuration file, and should use the key <code>facebook</code>, <code>twitter</code>, <code>linkedin</code>, <code>google</code>, <code>github</code>, <code>gitlab</code> or <code>bitbucket</code>, depending on the providers your application requires. For example:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;github&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;client_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;GITHUB_CLIENT_ID&#39;</span><span class="p">),</span>
    <span class="s1">&#39;client_secret&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;GITHUB_CLIENT_SECRET&#39;</span><span class="p">),</span>
    <span class="s1">&#39;redirect&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;http://your-callback-url&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<blockquote>
<p>{tip} If the <code>redirect</code> option contains a relative path, it will automatically be resolved to a fully qualified URL.</p>
</blockquote>

<p><a name="routing"></a></p>

<h2>Routing</h2>

<p>Next, you are ready to authenticate users! You will need two routes: one for redirecting the user to the OAuth provider, and another for receiving the callback from the provider after authentication. We will access Socialite using the <code>Socialite</code> facade:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Socialite\Facades\Socialite</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoginController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Redirect the user to the GitHub authentication page.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Http\Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">redirectToProvider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Obtain the user information from GitHub.</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Illuminate\Http\Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleProviderCallback</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>

        <span class="c1">// $user-&gt;token;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>redirect</code> method takes care of sending the user to the OAuth provider, while the <code>user</code> method will read the incoming request and retrieve the user&#39;s information from the provider.</p>

<p>You will need to define routes to your controller methods:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">LoginController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;login/github&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">LoginController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;redirectToProvider&#39;</span><span class="p">]);</span>
<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;login/github/callback&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">LoginController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;handleProviderCallback&#39;</span><span class="p">]);</span>
</pre></div>

<p><a name="optional-parameters"></a></p>

<h2>Optional Parameters</h2>

<p>A number of OAuth providers support optional parameters in the redirect request. To include any optional parameters in the request, call the <code>with</code> method with an associative array:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="kd">with</span><span class="p">([</span><span class="s1">&#39;hd&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;example.com&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} When using the <code>with</code> method, be careful not to pass any reserved keywords such as <code>state</code> or <code>response_type</code>.</p>
</blockquote>

<p><a name="access-scopes"></a></p>

<h2>Access Scopes</h2>

<p>Before redirecting the user, you may also add additional &quot;scopes&quot; on the request using the <code>scopes</code> method. This method will merge all existing scopes with the ones you supply:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">scopes</span><span class="p">([</span><span class="s1">&#39;read:user&#39;</span><span class="p">,</span> <span class="s1">&#39;public_repo&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<p>You can overwrite all existing scopes using the <code>setScopes</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nx">setScopes</span><span class="p">([</span><span class="s1">&#39;read:user&#39;</span><span class="p">,</span> <span class="s1">&#39;public_repo&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nx">redirect</span><span class="p">();</span>
</pre></div>

<p><a name="stateless-authentication"></a></p>

<h2>Stateless Authentication</h2>

<p>The <code>stateless</code> method may be used to disable session state verification. This is useful when adding social authentication to an API:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">stateless</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>
</pre></div>

<blockquote>
<p>{note} Stateless authentication is not available for the Twitter driver, which uses OAuth 1.0 for authentication.</p>
</blockquote>

<p><a name="retrieving-user-details"></a></p>

<h2>Retrieving User Details</h2>

<p>Once you have a user instance, you can grab a few more details about the user:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">();</span>

<span class="c1">// OAuth Two Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>
<span class="nx">$refreshToken</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">refreshToken</span><span class="p">;</span> <span class="c1">// not always provided</span>
<span class="nx">$expiresIn</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">expiresIn</span><span class="p">;</span>

<span class="c1">// OAuth One Providers</span>
<span class="nx">$token</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">token</span><span class="p">;</span>
<span class="nx">$tokenSecret</span> <span class="o">=</span> <span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">tokenSecret</span><span class="p">;</span>

<span class="c1">// All Providers</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getId</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getNickname</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getName</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getEmail</span><span class="p">();</span>
<span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">getAvatar</span><span class="p">();</span>
</pre></div>

<h4>Retrieving User Details From A Token (OAuth2)</h4>

<p>If you already have a valid access token for a user, you can retrieve their details using the <code>userFromToken</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">userFromToken</span><span class="p">(</span><span class="nx">$token</span><span class="p">);</span>
</pre></div>

<h4>Retrieving User Details From A Token And Secret (OAuth1)</h4>

<p>If you already have a valid pair of token / secret for a user, you can retrieve their details using the <code>userFromTokenAndSecret</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="nx">driver</span><span class="p">(</span><span class="s1">&#39;twitter&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">userFromTokenAndSecret</span><span class="p">(</span><span class="nx">$token</span><span class="p">,</span> <span class="nx">$secret</span><span class="p">);</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Directory Structure</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-root-directory">The Root Directory</a>

<ul>
<li><a href="#the-root-app-directory">The <code>app</code> Directory</a></li>
<li><a href="#the-bootstrap-directory">The <code>bootstrap</code> Directory</a></li>
<li><a href="#the-config-directory">The <code>config</code> Directory</a></li>
<li><a href="#the-database-directory">The <code>database</code> Directory</a></li>
<li><a href="#the-public-directory">The <code>public</code> Directory</a></li>
<li><a href="#the-resources-directory">The <code>resources</code> Directory</a></li>
<li><a href="#the-routes-directory">The <code>routes</code> Directory</a></li>
<li><a href="#the-storage-directory">The <code>storage</code> Directory</a></li>
<li><a href="#the-tests-directory">The <code>tests</code> Directory</a></li>
<li><a href="#the-vendor-directory">The <code>vendor</code> Directory</a></li>
</ul></li>
<li><a href="#the-app-directory">The App Directory</a>

<ul>
<li><a href="#the-broadcasting-directory">The <code>Broadcasting</code> Directory</a></li>
<li><a href="#the-console-directory">The <code>Console</code> Directory</a></li>
<li><a href="#the-events-directory">The <code>Events</code> Directory</a></li>
<li><a href="#the-exceptions-directory">The <code>Exceptions</code> Directory</a></li>
<li><a href="#the-http-directory">The <code>Http</code> Directory</a></li>
<li><a href="#the-jobs-directory">The <code>Jobs</code> Directory</a></li>
<li><a href="#the-listeners-directory">The <code>Listeners</code> Directory</a></li>
<li><a href="#the-mail-directory">The <code>Mail</code> Directory</a></li>
<li><a href="#the-models-directory">The <code>Models</code> Directory</a></li>
<li><a href="#the-notifications-directory">The <code>Notifications</code> Directory</a></li>
<li><a href="#the-policies-directory">The <code>Policies</code> Directory</a></li>
<li><a href="#the-providers-directory">The <code>Providers</code> Directory</a></li>
<li><a href="#the-rules-directory">The <code>Rules</code> Directory</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>The default Laravel application structure is intended to provide a great starting point for both large and small applications. But you are free to organize your application however you like. Laravel imposes almost no restrictions on where any given class is located - as long as Composer can autoload the class.</p>

<p><a name="the-root-directory"></a></p>

<h2>The Root Directory</h2>

<p><a name="the-root-app-directory"></a></p>

<h4>The App Directory</h4>

<p>The <code>app</code> directory contains the core code of your application. We&#39;ll explore this directory in more detail soon; however, almost all of the classes in your application will be in this directory.</p>

<p><a name="the-bootstrap-directory"></a></p>

<h4>The Bootstrap Directory</h4>

<p>The <code>bootstrap</code> directory contains the <code>app.php</code> file which bootstraps the framework. This directory also houses a <code>cache</code> directory which contains framework generated files for performance optimization such as the route and services cache files.</p>

<p><a name="the-config-directory"></a></p>

<h4>The Config Directory</h4>

<p>The <code>config</code> directory, as the name implies, contains all of your application&#39;s configuration files. It&#39;s a great idea to read through all of these files and familiarize yourself with all of the options available to you.</p>

<p><a name="the-database-directory"></a></p>

<h4>The Database Directory</h4>

<p>The <code>database</code> directory contains your database migrations, model factories, and seeds. If you wish, you may also use this directory to hold an SQLite database.</p>

<p><a name="the-public-directory"></a></p>

<h4>The Public Directory</h4>

<p>The <code>public</code> directory contains the <code>index.php</code> file, which is the entry point for all requests entering your application and configures autoloading. This directory also houses your assets such as images, JavaScript, and CSS.</p>

<p><a name="the-resources-directory"></a></p>

<h4>The Resources Directory</h4>

<p>The <code>resources</code> directory contains your views as well as your raw, un-compiled assets such as LESS, SASS, or JavaScript. This directory also houses all of your language files.</p>

<p><a name="the-routes-directory"></a></p>

<h4>The Routes Directory</h4>

<p>The <code>routes</code> directory contains all of the route definitions for your application. By default, several route files are included with Laravel: <code>web.php</code>, <code>api.php</code>, <code>console.php</code> and <code>channels.php</code>.</p>

<p>The <code>web.php</code> file contains routes that the <code>RouteServiceProvider</code> places in the <code>web</code> middleware group, which provides session state, CSRF protection, and cookie encryption. If your application does not offer a stateless, RESTful API, all of your routes will most likely be defined in the <code>web.php</code> file.</p>

<p>The <code>api.php</code> file contains routes that the <code>RouteServiceProvider</code> places in the <code>api</code> middleware group, which provides rate limiting. These routes are intended to be stateless, so requests entering the application through these routes are intended to be authenticated via tokens and will not have access to session state.</p>

<p>The <code>console.php</code> file is where you may define all of your Closure based console commands. Each Closure is bound to a command instance allowing a simple approach to interacting with each command&#39;s IO methods. Even though this file does not define HTTP routes, it defines console based entry points (routes) into your application.</p>

<p>The <code>channels.php</code> file is where you may register all of the event broadcasting channels that your application supports.</p>

<p><a name="the-storage-directory"></a></p>

<h4>The Storage Directory</h4>

<p>The <code>storage</code> directory contains your compiled Blade templates, file based sessions, file caches, and other files generated by the framework. This directory is segregated into <code>app</code>, <code>framework</code>, and <code>logs</code> directories. The <code>app</code> directory may be used to store any files generated by your application. The <code>framework</code> directory is used to store framework generated files and caches. Finally, the <code>logs</code> directory contains your application&#39;s log files.</p>

<p>The <code>storage/app/public</code> directory may be used to store user-generated files, such as profile avatars, that should be publicly accessible. You should create a symbolic link at <code>public/storage</code> which points to this directory. You may create the link using the <code>php artisan storage:link</code> command.</p>

<p><a name="the-tests-directory"></a></p>

<h4>The Tests Directory</h4>

<p>The <code>tests</code> directory contains your automated tests. An example <a href="https://phpunit.de/">PHPUnit</a> test is provided out of the box. Each test class should be suffixed with the word <code>Test</code>. You may run your tests using the <code>phpunit</code> or <code>php vendor/bin/phpunit</code> commands.</p>

<p><a name="the-vendor-directory"></a></p>

<h4>The Vendor Directory</h4>

<p>The <code>vendor</code> directory contains your <a href="https://getcomposer.org">Composer</a> dependencies.</p>

<p><a name="the-app-directory"></a></p>

<h2>The App Directory</h2>

<p>The majority of your application is housed in the <code>app</code> directory. By default, this directory is namespaced under <code>App</code> and is autoloaded by Composer using the <a href="https://www.php-fig.org/psr/psr-4/">PSR-4 autoloading standard</a>.</p>

<p>The <code>app</code> directory contains a variety of additional directories such as <code>Console</code>, <code>Http</code>, and <code>Providers</code>. Think of the <code>Console</code> and <code>Http</code> directories as providing an API into the core of your application. The HTTP protocol and CLI are both mechanisms to interact with your application, but do not actually contain application logic. In other words, they are two ways of issuing commands to your application. The <code>Console</code> directory contains all of your Artisan commands, while the <code>Http</code> directory contains your controllers, middleware, and requests.</p>

<p>A variety of other directories will be generated inside the <code>app</code> directory as you use the <code>make</code> Artisan commands to generate classes. So, for example, the <code>app/Jobs</code> directory will not exist until you execute the <code>make:job</code> Artisan command to generate a job class.</p>

<blockquote>
<p>{tip} Many of the classes in the <code>app</code> directory can be generated by Artisan via commands. To review the available commands, run the <code>php artisan list make</code> command in your terminal.</p>
</blockquote>

<p><a name="the-broadcasting-directory"></a></p>

<h4>The Broadcasting Directory</h4>

<p>The <code>Broadcasting</code> directory contains all of the broadcast channel classes for your application. These classes are generated using the <code>make:channel</code> command. This directory does not exist by default, but will be created for you when you create your first channel. To learn more about channels, check out the documentation on <a href="/docs/%7B%7Bversion%7D%7D/broadcasting">event broadcasting</a>.</p>

<p><a name="the-console-directory"></a></p>

<h4>The Console Directory</h4>

<p>The <code>Console</code> directory contains all of the custom Artisan commands for your application. These commands may be generated using the <code>make:command</code> command. This directory also houses your console kernel, which is where your custom Artisan commands are registered and your <a href="/docs/%7B%7Bversion%7D%7D/scheduling">scheduled tasks</a> are defined.</p>

<p><a name="the-events-directory"></a></p>

<h4>The Events Directory</h4>

<p>This directory does not exist by default, but will be created for you by the <code>event:generate</code> and <code>make:event</code> Artisan commands. The <code>Events</code> directory houses <a href="/docs/%7B%7Bversion%7D%7D/events">event classes</a>. Events may be used to alert other parts of your application that a given action has occurred, providing a great deal of flexibility and decoupling.</p>

<p><a name="the-exceptions-directory"></a></p>

<h4>The Exceptions Directory</h4>

<p>The <code>Exceptions</code> directory contains your application&#39;s exception handler and is also a good place to place any exceptions thrown by your application. If you would like to customize how your exceptions are logged or rendered, you should modify the <code>Handler</code> class in this directory.</p>

<p><a name="the-http-directory"></a></p>

<h4>The Http Directory</h4>

<p>The <code>Http</code> directory contains your controllers, middleware, and form requests. Almost all of the logic to handle requests entering your application will be placed in this directory.</p>

<p><a name="the-jobs-directory"></a></p>

<h4>The Jobs Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>make:job</code> Artisan command. The <code>Jobs</code> directory houses the <a href="/docs/%7B%7Bversion%7D%7D/queues">queueable jobs</a> for your application. Jobs may be queued by your application or run synchronously within the current request lifecycle. Jobs that run synchronously during the current request are sometimes referred to as &quot;commands&quot; since they are an implementation of the <a href="https://en.wikipedia.org/wiki/Command_pattern">command pattern</a>.</p>

<p><a name="the-listeners-directory"></a></p>

<h4>The Listeners Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>event:generate</code> or <code>make:listener</code> Artisan commands. The <code>Listeners</code> directory contains the classes that handle your <a href="/docs/%7B%7Bversion%7D%7D/events">events</a>. Event listeners receive an event instance and perform logic in response to the event being fired. For example, a <code>UserRegistered</code> event might be handled by a <code>SendWelcomeEmail</code> listener.</p>

<p><a name="the-mail-directory"></a></p>

<h4>The Mail Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>make:mail</code> Artisan command. The <code>Mail</code> directory contains all of your classes that represent emails sent by your application. Mail objects allow you to encapsulate all of the logic of building an email in a single, simple class that may be sent using the <code>Mail::send</code> method.</p>

<p><a name="the-models-directory"></a></p>

<h4>The Models Directory</h4>

<p>The <code>Models</code> directory contains all of your Eloquent model classes. The Eloquent ORM included with Laravel provides a beautiful, simple ActiveRecord implementation for working with your database. Each database table has a corresponding &quot;Model&quot; which is used to interact with that table. Models allow you to query for data in your tables, as well as insert new records into the table.</p>

<p><a name="the-notifications-directory"></a></p>

<h4>The Notifications Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>make:notification</code> Artisan command. The <code>Notifications</code> directory contains all of the &quot;transactional&quot; notifications that are sent by your application, such as simple notifications about events that happen within your application. Laravel&#39;s notification features abstracts sending notifications over a variety of drivers such as email, Slack, SMS, or stored in a database.</p>

<p><a name="the-policies-directory"></a></p>

<h4>The Policies Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>make:policy</code> Artisan command. The <code>Policies</code> directory contains the authorization policy classes for your application. Policies are used to determine if a user can perform a given action against a resource. For more information, check out the <a href="/docs/%7B%7Bversion%7D%7D/authorization">authorization documentation</a>.</p>

<p><a name="the-providers-directory"></a></p>

<h4>The Providers Directory</h4>

<p>The <code>Providers</code> directory contains all of the <a href="/docs/%7B%7Bversion%7D%7D/providers">service providers</a> for your application. Service providers bootstrap your application by binding services in the service container, registering events, or performing any other tasks to prepare your application for incoming requests.</p>

<p>In a fresh Laravel application, this directory will already contain several providers. You are free to add your own providers to this directory as needed.</p>

<p><a name="the-rules-directory"></a></p>

<h4>The Rules Directory</h4>

<p>This directory does not exist by default, but will be created for you if you execute the <code>make:rule</code> Artisan command. The <code>Rules</code> directory contains the custom validation rule objects for your application. Rules are used to encapsulate complicated validation logic in a simple object. For more information, check out the <a href="/docs/%7B%7Bversion%7D%7D/validation">validation documentation</a>.</p>
<div style="page-break-after: always;" ></div><h1>Laravel Telescope</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#data-pruning">Data Pruning</a></li>
<li><a href="#migration-customization">Migration Customization</a></li>
<li><a href="#dashboard-authorization">Dashboard Authorization</a></li>
</ul></li>
<li><a href="#upgrading-telescope">Upgrading Telescope</a></li>
<li><a href="#filtering">Filtering</a>

<ul>
<li><a href="#filtering-entries">Entries</a></li>
<li><a href="#filtering-batches">Batches</a></li>
</ul></li>
<li><a href="#tagging">Tagging</a></li>
<li><a href="#available-watchers">Available Watchers</a>

<ul>
<li><a href="#cache-watcher">Cache Watcher</a></li>
<li><a href="#command-watcher">Command Watcher</a></li>
<li><a href="#dump-watcher">Dump Watcher</a></li>
<li><a href="#event-watcher">Event Watcher</a></li>
<li><a href="#exception-watcher">Exception Watcher</a></li>
<li><a href="#gate-watcher">Gate Watcher</a></li>
<li><a href="#job-watcher">Job Watcher</a></li>
<li><a href="#log-watcher">Log Watcher</a></li>
<li><a href="#mail-watcher">Mail Watcher</a></li>
<li><a href="#model-watcher">Model Watcher</a></li>
<li><a href="#notification-watcher">Notification Watcher</a></li>
<li><a href="#query-watcher">Query Watcher</a></li>
<li><a href="#redis-watcher">Redis Watcher</a></li>
<li><a href="#request-watcher">Request Watcher</a></li>
<li><a href="#schedule-watcher">Schedule Watcher</a></li>
</ul></li>
<li><a href="#displaying-user-avatars">Displaying User Avatars</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel Telescope is an elegant debug assistant for the Laravel framework. Telescope provides insight into the requests coming into your application, exceptions, log entries, database queries, queued jobs, mail, notifications, cache operations, scheduled tasks, variable dumps and more. Telescope makes a wonderful companion to your local Laravel development environment.</p>

<p align="center">
<img src="https://laravel.com/assets/img/examples/Screen_Shot_2018-10-09_at_1.47.23_PM.png" width="600">
</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p>You may use Composer to install Telescope into your Laravel project:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">telescope</span>
</pre></div>

<p>After installing Telescope, publish its assets using the <code>telescope:install</code> Artisan command. After installing Telescope, you should also run the <code>migrate</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">telescope</span><span class="o">:</span><span class="nx">install</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<h3>Installing Only In Specific Environments</h3>

<p>If you plan to only use Telescope to assist your local development, you may install Telescope using the <code>--dev</code> flag:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">telescope</span> <span class="o">--</span><span class="nx">dev</span>
</pre></div>

<p>After running <code>telescope:install</code>, you should remove the <code>TelescopeServiceProvider</code> service provider registration from your <code>app</code> configuration file. Instead, manually register the service provider in the <code>register</code> method of your <code>AppServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">isLocal</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">register</span><span class="p">(</span><span class="err">\</span><span class="nx">Laravel</span><span class="err">\</span><span class="nx">Telescope</span><span class="err">\</span><span class="nx">TelescopeServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
        <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">register</span><span class="p">(</span><span class="nx">TelescopeServiceProvider</span><span class="o">::</span><span class="kr">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You should also prevent the Telescope package from being <a href="/docs/%7B%7Bversion%7D%7D/packages#package-discovery">auto-discovered</a> by adding the following to your <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;extra&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;laravel&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;dont-discover&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;laravel/telescope&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>

<p><a name="migration-customization"></a></p>

<h3>Migration Customization</h3>

<p>If you are not going to use Telescope&#39;s default migrations, you should call the <code>Telescope::ignoreMigrations</code> method in the <code>register</code> method of your <code>AppServiceProvider</code>. You may export the default migrations using the <code>php artisan vendor:publish --tag=telescope-migrations</code> command.</p>

<p><a name="configuration"></a></p>

<h3>Configuration</h3>

<p>After publishing Telescope&#39;s assets, its primary configuration file will be located at <code>config/telescope.php</code>. This configuration file allows you to configure your watcher options and each configuration option includes a description of its purpose, so be sure to thoroughly explore this file.</p>

<p>If desired, you may disable Telescope&#39;s data collection entirely using the <code>enabled</code> configuration option:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_ENABLED&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
</pre></div>

<p><a name="data-pruning"></a></p>

<h3>Data Pruning</h3>

<p>Without pruning, the <code>telescope_entries</code> table can accumulate records very quickly. To mitigate this, you should schedule the <code>telescope:prune</code> Artisan command to run daily:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;telescope:prune&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p>By default, all entries older than 24 hours will be pruned. You may use the <code>hours</code> option when calling the command to determine how long to retain Telescope data. For example, the following command will delete all records created over 48 hours ago:</p>
<div class="highlight"><pre><span></span><span class="nx">$schedule</span><span class="o">-&gt;</span><span class="nx">command</span><span class="p">(</span><span class="s1">&#39;telescope:prune --hours=48&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">daily</span><span class="p">();</span>
</pre></div>

<p><a name="dashboard-authorization"></a></p>

<h3>Dashboard Authorization</h3>

<p>Telescope exposes a dashboard at <code>/telescope</code>. By default, you will only be able to access this dashboard in the <code>local</code> environment. Within your <code>app/Providers/TelescopeServiceProvider.php</code> file, there is a <code>gate</code> method. This authorization gate controls access to Telescope in <strong>non-local</strong> environments. You are free to modify this gate as needed to restrict access to your Telescope installation:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register the Telescope gate.</span>
<span class="cm"> *</span>
<span class="cm"> * This gate determines who can access Telescope in non-local environments.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">gate</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Gate</span><span class="o">::</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;viewTelescope&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">in_array</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">email</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} You should ensure you change your <code>APP_ENV</code> environment variable to <code>production</code> in your production environment. Otherwise, your Telescope installation will be publicly available.</p>
</blockquote>

<p><a name="upgrading-telescope"></a></p>

<h2>Upgrading Telescope</h2>

<p>When upgrading to a new version of Telescope, you should re-publish Telescope&#39;s assets:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">telescope</span><span class="o">:</span><span class="nx">publish</span>
</pre></div>

<p>To keep the assets up-to-date and avoid issues in future updates, you may add the <code>telescope:publish</code> command to the <code>post-update-cmd</code> scripts in your application&#39;s <code>composer.json</code> file:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;post-update-cmd&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;@php artisan telescope:publish --ansi&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="filtering"></a></p>

<h2>Filtering</h2>

<p><a name="filtering-entries"></a></p>

<h3>Entries</h3>

<p>You may filter the data that is recorded by Telescope via the <code>filter</code> callback that is registered in your <code>TelescopeServiceProvider</code>. By default, this callback records all data in the <code>local</code> environment and exceptions, failed jobs, scheduled tasks, and data with monitored tags in all other environments:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hideSensitiveRequestDetails</span><span class="p">();</span>

    <span class="nx">Telescope</span><span class="o">::</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">IncomingEntry</span> <span class="nx">$entry</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">isLocal</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isReportableException</span><span class="p">()</span> <span class="o">||</span>
            <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isFailedJob</span><span class="p">()</span> <span class="o">||</span>
            <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isScheduledTask</span><span class="p">()</span> <span class="o">||</span>
            <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">hasMonitoredTag</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="filtering-batches"></a></p>

<h3>Batches</h3>

<p>While the <code>filter</code> callback filters data for individual entries, you may use the <code>filterBatch</code> method to register a callback that filters all data for a given request or console command. If the callback returns <code>true</code>, all of the entries are recorded by Telescope:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Collection</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hideSensitiveRequestDetails</span><span class="p">();</span>

    <span class="nx">Telescope</span><span class="o">::</span><span class="nx">filterBatch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">Collection</span> <span class="nx">$entries</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">app</span><span class="o">-&gt;</span><span class="nx">isLocal</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">$entries</span><span class="o">-&gt;</span><span class="nx">contains</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$entry</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isReportableException</span><span class="p">()</span> <span class="o">||</span>
                <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isFailedJob</span><span class="p">()</span> <span class="o">||</span>
                <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">isScheduledTask</span><span class="p">()</span> <span class="o">||</span>
                <span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">hasMonitoredTag</span><span class="p">();</span>
            <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="tagging"></a></p>

<h2>Tagging</h2>

<p>Telescope allows you to search entries by &quot;tag&quot;. Often, tags are Eloquent model class names or authenticated user IDs which Telescope automatically adds to entries. Occasionally, you may want to attach your own custom tags to entries. To accomplish this, you may use the <code>Telescope::tag</code> method. The <code>tag</code> method accepts a callback which should return an array of tags. The tags returned by the callback will be merged with any tags Telescope would automatically attach to the entry. You should call the <code>tag</code> method within your <code>TelescopeServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Telescope</span><span class="err">\</span><span class="nx">Telescope</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">hideSensitiveRequestDetails</span><span class="p">();</span>

    <span class="nx">Telescope</span><span class="o">::</span><span class="nx">tag</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">IncomingEntry</span> <span class="nx">$entry</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;request&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;status:&#39;</span><span class="p">.</span><span class="nx">$entry</span><span class="o">-&gt;</span><span class="nx">content</span><span class="p">[</span><span class="s1">&#39;response_status&#39;</span><span class="p">]];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[];</span>
    <span class="p">});</span>
 <span class="p">}</span>
</pre></div>

<p><a name="available-watchers"></a></p>

<h2>Available Watchers</h2>

<p>Telescope watchers gather application data when a request or console command is executed. You may customize the list of watchers that you would like to enable within your <code>config/telescope.php</code> configuration file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">CacheWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">CommandWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p>Some watchers also allow you to provide additional customization options:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">QueryWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_QUERY_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;slow&#39;</span> <span class="p">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="cache-watcher"></a></p>

<h3>Cache Watcher</h3>

<p>The cache watcher records data when a cache key is hit, missed, updated and forgotten.</p>

<p><a name="command-watcher"></a></p>

<h3>Command Watcher</h3>

<p>The command watcher records the arguments, options, exit code, and output whenever an Artisan command is executed. If you would like to exclude certain commands from being recorded by the watcher, you may specify the command in the <code>ignore</code> option in your <code>config/telescope.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">CommandWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_COMMAND_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;ignore&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;key:generate&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="dump-watcher"></a></p>

<h3>Dump Watcher</h3>

<p>The dump watcher records and displays your variable dumps in Telescope. When using Laravel, variables may be dumped using the global <code>dump</code> function. The dump watcher tab must be open in a browser for the recording to occur, otherwise the dumps will be ignored by the watcher.</p>

<p><a name="event-watcher"></a></p>

<h3>Event Watcher</h3>

<p>The event watcher records the payload, listeners, and broadcast data for any events dispatched by your application. The Laravel framework&#39;s internal events are ignored by the Event watcher.</p>

<p><a name="exception-watcher"></a></p>

<h3>Exception Watcher</h3>

<p>The exception watcher records the data and stack trace for any reportable Exceptions that are thrown by your application.</p>

<p><a name="gate-watcher"></a></p>

<h3>Gate Watcher</h3>

<p>The gate watcher records the data and result of gate and policy checks by your application. If you would like to exclude certain abilities from being recorded by the watcher, you may specify those in the <code>ignore_abilities</code> option in your <code>config/telescope.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">GateWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_GATE_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;ignore_abilities&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;viewNova&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="job-watcher"></a></p>

<h3>Job Watcher</h3>

<p>The job watcher records the data and status of any jobs dispatched by your application.</p>

<p><a name="log-watcher"></a></p>

<h3>Log Watcher</h3>

<p>The log watcher records the log data for any logs written by your application.</p>

<p><a name="mail-watcher"></a></p>

<h3>Mail Watcher</h3>

<p>The mail watcher allows you to view an in-browser preview of the emails along with their associated data. You may also download the email as an <code>.eml</code> file.</p>

<p><a name="model-watcher"></a></p>

<h3>Model Watcher</h3>

<p>The model watcher records model changes whenever an Eloquent <code>created</code>, <code>updated</code>, <code>restored</code>, or <code>deleted</code> event is dispatched. You may specify which model events should be recorded via the watcher&#39;s <code>events</code> option:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">ModelWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_MODEL_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;events&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;eloquent.created*&#39;</span><span class="p">,</span> <span class="s1">&#39;eloquent.updated*&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="notification-watcher"></a></p>

<h3>Notification Watcher</h3>

<p>The notification watcher records all notifications sent by your application. If the notification triggers an email and you have the mail watcher enabled, the email will also be available for preview on the mail watcher screen.</p>

<p><a name="query-watcher"></a></p>

<h3>Query Watcher</h3>

<p>The query watcher records the raw SQL, bindings, and execution time for all queries that are executed by your application. The watcher also tags any queries slower than 100ms as <code>slow</code>. You may customize the slow query threshold using the watcher&#39;s <code>slow</code> option:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">QueryWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_QUERY_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;slow&#39;</span> <span class="p">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="redis-watcher"></a></p>

<h3>Redis Watcher</h3>

<p>The Redis watcher records all Redis commands executed by your application. If you are using Redis for caching, cache commands will also be recorded by the Redis Watcher.</p>

<p><a name="request-watcher"></a></p>

<h3>Request Watcher</h3>

<p>The request watcher records the request, headers, session, and response data associated with any requests handled by the application. You may limit your response data via the <code>size_limit</code> (in KB) option:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;watchers&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">Watchers</span><span class="err">\</span><span class="nx">RequestWatcher</span><span class="o">::</span><span class="kr">class</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;enabled&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_REQUEST_WATCHER&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="s1">&#39;size_limit&#39;</span> <span class="p">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;TELESCOPE_RESPONSE_SIZE_LIMIT&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="p">...</span>
<span class="p">],</span>
</pre></div>

<p><a name="schedule-watcher"></a></p>

<h3>Schedule Watcher</h3>

<p>The schedule watcher records the command and output of any scheduled tasks run by your application.</p>

<p><a name="displaying-user-avatars"></a></p>

<h2>Displaying User Avatars</h2>

<p>The Telescope dashboard displays the user avatar for the user that was logged in when a given entry was saved. By default, Telescope will retrieve avatars using the Gravatar web service. However, you may customize the avatar URL by registering a callback in your <code>TelescopeServiceProvider</code>. The callback will receive the user&#39;s ID and email address and should return the user&#39;s avatar image URL:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">User</span><span class="p">;</span>
<span class="nx">use</span> <span class="nx">Laravel</span><span class="err">\</span><span class="nx">Telescope</span><span class="err">\</span><span class="nx">Telescope</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Register any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Telescope</span><span class="o">::</span><span class="nx">avatar</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$id</span><span class="p">,</span> <span class="nx">$email</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;/avatars/&#39;</span><span class="p">.</span><span class="nx">User</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">avatar_path</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Testing: Getting Started</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#environment">Environment</a></li>
<li><a href="#creating-and-running-tests">Creating &amp; Running Tests</a>

<ul>
<li><a href="#artisan-test-runner">Artisan Test Runner</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel is built with testing in mind. In fact, support for testing with PHPUnit is included out of the box and a <code>phpunit.xml</code> file is already set up for your application. The framework also ships with convenient helper methods that allow you to expressively test your applications.</p>

<p>By default, your application&#39;s <code>tests</code> directory contains two directories: <code>Feature</code> and <code>Unit</code>. Unit tests are tests that focus on a very small, isolated portion of your code. In fact, most unit tests probably focus on a single method. Feature tests may test a larger portion of your code, including how several objects interact with each other or even a full HTTP request to a JSON endpoint.</p>

<p>An <code>ExampleTest.php</code> file is provided in both the <code>Feature</code> and <code>Unit</code> test directories. After installing a new Laravel application, run <code>vendor/bin/phpunit</code> on the command line to run your tests.</p>

<p><a name="environment"></a></p>

<h2>Environment</h2>

<p>When running tests via <code>vendor/bin/phpunit</code>, Laravel will automatically set the configuration environment to <code>testing</code> because of the environment variables defined in the <code>phpunit.xml</code> file. Laravel also automatically configures the session and cache to the <code>array</code> driver while testing, meaning no session or cache data will be persisted while testing.</p>

<p>You are free to define other testing environment configuration values as necessary. The <code>testing</code> environment variables may be configured in the <code>phpunit.xml</code> file, but make sure to clear your configuration cache using the <code>config:clear</code> Artisan command before running your tests!</p>

<p>In addition, you may create a <code>.env.testing</code> file in the root of your project. This file will override the <code>.env</code> file when running PHPUnit tests or executing Artisan commands with the <code>--env=testing</code> option.</p>

<p><a name="creating-and-running-tests"></a></p>

<h2>Creating &amp; Running Tests</h2>

<p>To create a new test case, use the <code>make:test</code> Artisan command:</p>
<div class="highlight"><pre><span></span><span class="c1">// Create a test in the Feature directory...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">test</span> <span class="nx">UserTest</span>

<span class="c1">// Create a test in the Unit directory...</span>
<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">test</span> <span class="nx">UserTest</span> <span class="o">--</span><span class="nx">unit</span>
</pre></div>

<blockquote>
<p>{tip} Test stubs may be customized using <a href="/docs/%7B%7Bversion%7D%7D/artisan#stub-customization">stub publishing</a></p>
</blockquote>

<p>Once the test has been generated, you may define test methods as you normally would using PHPUnit. To run your tests, execute the <code>phpunit</code> or <code>artisan test</code> command from your terminal:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Unit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * A basic test example.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicTest</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} If you define your own <code>setUp</code> / <code>tearDown</code> methods within a test class, be sure to call the respective <code>parent::setUp()</code> / <code>parent::tearDown()</code> methods on the parent class.</p>
</blockquote>

<p><a name="artisan-test-runner"></a></p>

<h3>Artisan Test Runner</h3>

<p>In addition to the <code>phpunit</code> command, you may use the <code>test</code> Artisan command to run your tests. The Artisan test runner provides verbose test reports in order to ease development and debugging:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">test</span>
</pre></div>

<p>Any arguments that can be passed to the <code>phpunit</code> command may also be passed to the Artisan <code>test</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">test</span> <span class="o">--</span><span class="nx">group</span><span class="o">=</span><span class="nx">feature</span> <span class="o">--</span><span class="nx">stop</span><span class="o">-</span><span class="nx">on</span><span class="o">-</span><span class="nx">failure</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Upgrade Guide</h1>

<ul>
<li><a href="#upgrade-9.0">Upgrading To 9.0 From 8.x</a></li>
</ul>

<p><a name="high-impact-changes"></a></p>

<h2>High Impact Changes</h2>

<div class="content-list" markdown="1">
- ...
</div>

<p><a name="medium-impact-changes"></a></p>

<h2>Medium Impact Changes</h2>

<div class="content-list" markdown="1">
- ...
</div>

<p><a name="upgrade-9.0"></a></p>

<h2>Upgrading To 9.0 From 8.x</h2>

<h4>Estimated Upgrade Time: ?? Minutes</h4>

<blockquote>
<p>{note} We attempt to document every possible breaking change. Since some of these breaking changes are in obscure parts of the framework only a portion of these changes may actually affect your application.</p>
</blockquote>

<p><a name="updating-dependencies"></a></p>

<h3>Updating Dependencies</h3>

<p>Update the following dependencies in your <code>composer.json</code> file:</p>

<div class="content-list" markdown="1">
- ...
</div>

<p>The following first-party packages have new major releases to support Laravel 9. If applicable, you should read their individual upgrade guides before upgrading:</p>

<div class="content-list" markdown="1">
- ...
</div>

<p>Finally, examine any other third-party packages consumed by your application and verify you are using the proper version for Laravel 9 support.</p>

<p><a name="miscellaneous"></a></p>

<h3>Miscellaneous</h3>

<p>We also encourage you to view the changes in the <code>laravel/laravel</code> <a href="https://github.com/laravel/laravel">GitHub repository</a>. While many of these changes are not required, you may wish to keep these files in sync with your application. Some of these changes will be covered in this upgrade guide, but others, such as changes to configuration files or comments, will not be. You can easily view the changes with the <a href="https://github.com/laravel/laravel/compare/7.x...master">GitHub comparison tool</a> and choose which updates are important to you.</p>
<div style="page-break-after: always;" ></div><h1>URL Generation</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-basics">The Basics</a>

<ul>
<li><a href="#generating-basic-urls">Generating Basic URLs</a></li>
<li><a href="#accessing-the-current-url">Accessing The Current URL</a></li>
</ul></li>
<li><a href="#urls-for-named-routes">URLs For Named Routes</a>

<ul>
<li><a href="#signed-urls">Signed URLs</a></li>
</ul></li>
<li><a href="#urls-for-controller-actions">URLs For Controller Actions</a></li>
<li><a href="#default-values">Default Values</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides several helpers to assist you in generating URLs for your application. These are mainly helpful when building links in your templates and API responses, or when generating redirect responses to another part of your application.</p>

<p><a name="the-basics"></a></p>

<h2>The Basics</h2>

<p><a name="generating-basic-urls"></a></p>

<h3>Generating Basic URLs</h3>

<p>The <code>url</code> helper may be used to generate arbitrary URLs for your application. The generated URL will automatically use the scheme (HTTP or HTTPS) and host from the current request:</p>
<div class="highlight"><pre><span></span><span class="nx">$post</span> <span class="o">=</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Models</span><span class="err">\</span><span class="nx">Post</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">url</span><span class="p">(</span><span class="s2">&quot;/posts/{$post-&gt;id}&quot;</span><span class="p">);</span>

<span class="c1">// http://example.com/posts/1</span>
</pre></div>

<p><a name="accessing-the-current-url"></a></p>

<h3>Accessing The Current URL</h3>

<p>If no path is provided to the <code>url</code> helper, a <code>Illuminate\Routing\UrlGenerator</code> instance is returned, allowing you to access information about the current URL:</p>
<div class="highlight"><pre><span></span><span class="c1">// Get the current URL without the query string...</span>
<span class="nx">echo</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">current</span><span class="p">();</span>

<span class="c1">// Get the current URL including the query string...</span>
<span class="nx">echo</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">full</span><span class="p">();</span>

<span class="c1">// Get the full URL for the previous request...</span>
<span class="nx">echo</span> <span class="nx">url</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">previous</span><span class="p">();</span>
</pre></div>

<p>Each of these methods may also be accessed via the <code>URL</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">URL</span><span class="p">;</span>

<span class="nx">echo</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">current</span><span class="p">();</span>
</pre></div>

<p><a name="urls-for-named-routes"></a></p>

<h2>URLs For Named Routes</h2>

<p>The <code>route</code> helper may be used to generate URLs to named routes. Named routes allow you to generate URLs without being coupled to the actual URL defined on the route. Therefore, if the route&#39;s URL changes, no changes need to be made to your <code>route</code> function calls. For example, imagine your application contains a route defined like the following:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/post/{post}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;post.show&#39;</span><span class="p">);</span>
</pre></div>

<p>To generate a URL to this route, you may use the <code>route</code> helper like so:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;post.show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// http://example.com/post/1</span>
</pre></div>

<p>You will often be generating URLs using the primary key of <a href="/docs/%7B%7Bversion%7D%7D/eloquent">Eloquent models</a>. For this reason, you may pass Eloquent models as parameter values. The <code>route</code> helper will automatically extract the model&#39;s primary key:</p>
<div class="highlight"><pre><span></span><span class="nx">echo</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;post.show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span> <span class="p">=&gt;</span> <span class="nx">$post</span><span class="p">]);</span>
</pre></div>

<p>The <code>route</code> helper may also be used to generate URLs for routes with multiple parameters:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/post/{post}/comment/{comment}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;comment.show&#39;</span><span class="p">);</span>

<span class="nx">echo</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;comment.show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span> <span class="p">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>

<span class="c1">// http://example.com/post/1/comment/3</span>
</pre></div>

<p><a name="signed-urls"></a></p>

<h3>Signed URLs</h3>

<p>Laravel allows you to easily create &quot;signed&quot; URLs to named routes. These URLs have a &quot;signature&quot; hash appended to the query string which allows Laravel to verify that the URL has not been modified since it was created. Signed URLs are especially useful for routes that are publicly accessible yet need a layer of protection against URL manipulation.</p>

<p>For example, you might use signed URLs to implement a public &quot;unsubscribe&quot; link that is emailed to your customers. To create a signed URL to a named route, use the <code>signedRoute</code> method of the <code>URL</code> facade:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">URL</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">signedRoute</span><span class="p">(</span><span class="s1">&#39;unsubscribe&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p>If you would like to generate a temporary signed route URL that expires, you may use the <code>temporarySignedRoute</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">URL</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">URL</span><span class="o">::</span><span class="nx">temporarySignedRoute</span><span class="p">(</span>
    <span class="s1">&#39;unsubscribe&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>

<h4>Validating Signed Route Requests</h4>

<p>To verify that an incoming request has a valid signature, you should call the <code>hasValidSignature</code> method on the incoming <code>Request</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/unsubscribe/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">hasValidSignature</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;unsubscribe&#39;</span><span class="p">);</span>
</pre></div>

<p>Alternatively, you may assign the <code>Illuminate\Routing\Middleware\ValidateSignature</code> middleware to the route. If it is not already present, you should assign this middleware a key in your HTTP kernel&#39;s <code>routeMiddleware</code> array:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The application&#39;s route middleware.</span>
<span class="cm"> *</span>
<span class="cm"> * These middleware may be assigned to groups or used individually.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;signed&#39;</span> <span class="p">=&gt;</span> <span class="err">\</span><span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Routing</span><span class="err">\</span><span class="nx">Middleware</span><span class="err">\</span><span class="nx">ValidateSignature</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p>Once you have registered the middleware in your kernel, you may attach it to a route. If the incoming request does not have a valid signature, the middleware will automatically return a <code>403</code> error response:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/unsubscribe/{user}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;unsubscribe&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;signed&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="urls-for-controller-actions"></a></p>

<h2>URLs For Controller Actions</h2>

<p>The <code>action</code> function generates a URL for the given controller action. You do not need to pass the full namespace of the controller. Instead, pass the controller class name relative to the <code>App\Http\Controllers</code> namespace:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;HomeController@index&#39;</span><span class="p">);</span>
</pre></div>

<p>You may also reference actions with a &quot;callable&quot; array syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">HomeController</span><span class="p">;</span>

<span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">([</span><span class="nx">HomeController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
</pre></div>

<p>If the controller method accepts route parameters, you may pass them as the second argument to the function:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="s1">&#39;UserController@profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="p">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>

<p><a name="default-values"></a></p>

<h2>Default Values</h2>

<p>For some applications, you may wish to specify request-wide default values for certain URL parameters. For example, imagine many of your routes define a <code>{locale}</code> parameter:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/{locale}/posts&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">name</span><span class="p">(</span><span class="s1">&#39;post.index&#39;</span><span class="p">);</span>
</pre></div>

<p>It is cumbersome to always pass the <code>locale</code> every time you call the <code>route</code> helper. So, you may use the <code>URL::defaults</code> method to define a default value for this parameter that will always be applied during the current request. You may wish to call this method from a <a href="/docs/%7B%7Bversion%7D%7D/middleware#assigning-middleware-to-routes">route middleware</a> so that you have access to the current request:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\URL</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SetDefaultLocaleForUrls</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">URL</span><span class="o">::</span><span class="na">defaults</span><span class="p">([</span><span class="s1">&#39;locale&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">locale</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Once the default value for the <code>locale</code> parameter has been set, you are no longer required to pass its value when generating URLs via the <code>route</code> helper.</p>
<div style="page-break-after: always;" ></div><h1>Laravel Valet</h1>

<ul>
<li><a href="#introduction">Introduction</a>

<ul>
<li><a href="#valet-or-homestead">Valet Or Homestead</a></li>
</ul></li>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#upgrading">Upgrading</a></li>
</ul></li>
<li><a href="#serving-sites">Serving Sites</a>

<ul>
<li><a href="#the-park-command">The &quot;Park&quot; Command</a></li>
<li><a href="#the-link-command">The &quot;Link&quot; Command</a></li>
<li><a href="#securing-sites">Securing Sites With TLS</a></li>
</ul></li>
<li><a href="#sharing-sites">Sharing Sites</a></li>
<li><a href="#site-specific-environment-variables">Site Specific Environment Variables</a></li>
<li><a href="#proxying-services">Proxying Services</a></li>
<li><a href="#custom-valet-drivers">Custom Valet Drivers</a>

<ul>
<li><a href="#local-drivers">Local Drivers</a></li>
</ul></li>
<li><a href="#other-valet-commands">Other Valet Commands</a></li>
<li><a href="#valet-directories-and-files">Valet Directories &amp; Files</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Valet is a Laravel development environment for Mac minimalists. No Vagrant, no <code>/etc/hosts</code> file. You can even share your sites publicly using local tunnels. <em>Yeah, we like it too.</em></p>

<p>Laravel Valet configures your Mac to always run <a href="https://www.nginx.com/">Nginx</a> in the background when your machine starts. Then, using <a href="https://en.wikipedia.org/wiki/Dnsmasq">DnsMasq</a>, Valet proxies all requests on the <code>*.test</code> domain to point to sites installed on your local machine.</p>

<p>In other words, a blazing fast Laravel development environment that uses roughly 7 MB of RAM. Valet isn&#39;t a complete replacement for Vagrant or Homestead, but provides a great alternative if you want flexible basics, prefer extreme speed, or are working on a machine with a limited amount of RAM.</p>

<p>Out of the box, Valet support includes, but is not limited to:</p>

<style>
    #valet-support > ul {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        line-height: 1.9;
    }
</style>

<div id="valet-support" markdown="1">
- [Laravel](https://laravel.com)
- [Lumen](https://lumen.laravel.com)
- [Bedrock](https://roots.io/bedrock/)
- [CakePHP 3](https://cakephp.org)
- [Concrete5](https://www.concrete5.org/)
- [Contao](https://contao.org/en/)
- [Craft](https://craftcms.com)
- [Drupal](https://www.drupal.org/)
- [ExpressionEngine](https://www.expressionengine.com/)
- [Jigsaw](https://jigsaw.tighten.co)
- [Joomla](https://www.joomla.org/)
- [Katana](https://github.com/themsaid/katana)
- [Kirby](https://getkirby.com/)
- [Magento](https://magento.com/)
- [OctoberCMS](https://octobercms.com/)
- [Sculpin](https://sculpin.io/)
- [Slim](https://www.slimframework.com)
- [Statamic](https://statamic.com)
- Static HTML
- [Symfony](https://symfony.com)
- [WordPress](https://wordpress.org)
- [Zend](https://framework.zend.com)
</div>

<p>However, you may extend Valet with your own <a href="#custom-valet-drivers">custom drivers</a>.</p>

<p><a name="valet-or-homestead"></a></p>

<h3>Valet Or Homestead</h3>

<p>As you may know, Laravel offers <a href="/docs/%7B%7Bversion%7D%7D/homestead">Homestead</a>, another local Laravel development environment. Homestead and Valet differ in regards to their intended audience and their approach to local development. Homestead offers an entire Ubuntu virtual machine with automated Nginx configuration. Homestead is a wonderful choice if you want a fully virtualized Linux development environment or are on Windows / Linux.</p>

<p>Valet only supports Mac, and requires you to install PHP and a database server directly onto your local machine. This is easily achieved by using <a href="https://brew.sh/">Homebrew</a> with commands like <code>brew install php</code> and <code>brew install mysql</code>. Valet provides a blazing fast local development environment with minimal resource consumption, so it&#39;s great for developers who only require PHP / MySQL and do not need a fully virtualized development environment.</p>

<p>Both Valet and Homestead are great choices for configuring your Laravel development environment. Which one you choose will depend on your personal taste and your team&#39;s needs.</p>

<p><a name="installation"></a></p>

<h2>Installation</h2>

<p><strong>Valet requires macOS and <a href="https://brew.sh/">Homebrew</a>. Before installation, you should make sure that no other programs such as Apache or Nginx are binding to your local machine&#39;s port 80.</strong></p>

<div class="content-list" markdown="1">
- Install or update [Homebrew](https://brew.sh/) to the latest version using `brew update`.
- Install PHP 7.4 using Homebrew via `brew install php`.
- Install [Composer](https://getcomposer.org).
- Install Valet with Composer via `composer global require laravel/valet`. Make sure the `~/.composer/vendor/bin` directory is in your system's "PATH".
- Run the `valet install` command. This will configure and install Valet and DnsMasq, and register Valet's daemon to launch when your system starts.
</div>

<p>Once Valet is installed, try pinging any <code>*.test</code> domain on your terminal using a command such as <code>ping foobar.test</code>. If Valet is installed correctly you should see this domain responding on <code>127.0.0.1</code>.</p>

<p>Valet will automatically start its daemon each time your machine boots. There is no need to run <code>valet start</code> or <code>valet install</code> ever again once the initial Valet installation is complete.</p>

<h4>Using Another Domain</h4>

<p>By default, Valet serves your projects using the <code>.test</code> TLD. If you&#39;d like to use another domain, you can do so using the <code>valet tld tld-name</code> command.</p>

<p>For example, if you&#39;d like to use <code>.app</code> instead of <code>.test</code>, run <code>valet tld app</code> and Valet will start serving your projects at <code>*.app</code> automatically.</p>

<h4>Database</h4>

<p>If you need a database, try MySQL by running <code>brew install mysql@5.7</code> on your command line. Once MySQL has been installed, you may start it using the <code>brew services start mysql@5.7</code> command. You can then connect to the database at <code>127.0.0.1</code> using the <code>root</code> username and an empty string for the password.</p>

<h4>PHP Versions</h4>

<p>Valet allows you to switch PHP versions using the <code>valet use php@version</code> command. Valet will install the specified PHP version via Brew if it is not already installed:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">use</span> <span class="nx">php</span><span class="err">@</span><span class="mf">7.2</span>

<span class="nx">valet</span> <span class="nx">use</span> <span class="nx">php</span>
</pre></div>

<blockquote>
<p>{note} Valet only serves one PHP version at a time, even if you have multiple PHP versions installed.</p>
</blockquote>

<h4>Resetting Your Installation</h4>

<p>If you are having trouble getting your Valet installation to run properly, executing the <code>composer global update</code> command followed by <code>valet install</code> will reset your installation and can solve a variety of problems. In rare cases it may be necessary to &quot;hard reset&quot; Valet by executing <code>valet uninstall --force</code> followed by <code>valet install</code>.</p>

<p><a name="upgrading"></a></p>

<h3>Upgrading</h3>

<p>You may update your Valet installation using the <code>composer global update</code> command in your terminal. After upgrading, it is good practice to run the <code>valet install</code> command so Valet can make additional upgrades to your configuration files if necessary.</p>

<p><a name="serving-sites"></a></p>

<h2>Serving Sites</h2>

<p>Once Valet is installed, you&#39;re ready to start serving sites. Valet provides two commands to help you serve your Laravel sites: <code>park</code> and <code>link</code>.</p>

<p><a name="the-park-command"></a></p>

<h4>The <code>park</code> Command</h4>

<div class="content-list" markdown="1">
- Create a new directory on your Mac by running something like `mkdir ~/Sites`. Next, `cd ~/Sites` and run `valet park`. This command will register your current working directory as a path that Valet should search for sites.
- Next, create a new Laravel site within this directory: `laravel new blog`.
- Open `http://blog.test` in your browser.
</div>

<p><strong>That&#39;s all there is to it.</strong> Now, any Laravel project you create within your &quot;parked&quot; directory will automatically be served using the <code>http://folder-name.test</code> convention.</p>

<p><a name="the-link-command"></a></p>

<h4>The <code>link</code> Command</h4>

<p>The <code>link</code> command may also be used to serve your Laravel sites. This command is useful if you want to serve a single site in a directory and not the entire directory.</p>

<div class="content-list" markdown="1">
- To use the command, navigate to one of your projects and run `valet link app-name` in your terminal. Valet will create a symbolic link in `~/.config/valet/Sites` which points to your current working directory.
- After running the `link` command, you can access the site in your browser at `http://app-name.test`.
</div>

<p>To see a listing of all of your linked directories, run the <code>valet links</code> command. You may use <code>valet unlink app-name</code> to destroy the symbolic link.</p>

<blockquote>
<p>{tip} You can use <code>valet link</code> to serve the same project from multiple (sub)domains. To add a subdomain or another domain to your project run <code>valet link subdomain.app-name</code> from the project folder.</p>
</blockquote>

<p><a name="securing-sites"></a></p>

<h4>Securing Sites With TLS</h4>

<p>By default, Valet serves sites over plain HTTP. However, if you would like to serve a site over encrypted TLS using HTTP/2, use the <code>secure</code> command. For example, if your site is being served by Valet on the <code>laravel.test</code> domain, you should run the following command to secure it:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">secure</span> <span class="nx">laravel</span>
</pre></div>

<p>To &quot;unsecure&quot; a site and revert back to serving its traffic over plain HTTP, use the <code>unsecure</code> command. Like the <code>secure</code> command, this command accepts the host name that you wish to unsecure:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">unsecure</span> <span class="nx">laravel</span>
</pre></div>

<p><a name="sharing-sites"></a></p>

<h2>Sharing Sites</h2>

<p>Valet even includes a command to share your local sites with the world, providing an easy way to test your site on mobile devices or share it with team members and clients. No additional software installation is required once Valet is installed.</p>

<h3>Sharing Sites Via Ngrok</h3>

<p>To share a site, navigate to the site&#39;s directory in your terminal and run the <code>valet share</code> command. A publicly accessible URL will be inserted into your clipboard and is ready to paste directly into your browser or share with your team.</p>

<p>To stop sharing your site, hit <code>Control + C</code> to cancel the process.</p>

<blockquote>
<p>{tip} You may pass additional parameters to the share command, such as <code>valet share --region=eu</code>. For more information, consult the <a href="https://ngrok.com/docs">ngrok documentation</a>.</p>
</blockquote>

<h3>Sharing Sites Via Expose</h3>

<p>If you have <a href="https://beyondco.de/docs/expose">Expose</a> installed, you can share your site by navigating to the site&#39;s directory in your terminal and running the <code>expose</code> command. Consult the expose documentation for additional command-line parameters it supports. After sharing the site, Expose will display the sharable URL that you may use on your other devices or amongst team members.</p>

<p>To stop sharing your site, hit <code>Control + C</code> to cancel the process.</p>

<h3>Sharing Sites On Your Local Network</h3>

<p>Valet restricts incoming traffic to the internal <code>127.0.0.1</code> interface by default. This way your development machine isn&#39;t exposed to security risks from the Internet.</p>

<p>If you wish to allow other devices on your local network to access the Valet sites on your machine via your machine&#39;s IP address (eg: <code>192.168.1.10/app-name.test</code>), you will need to manually edit the appropriate Nginx configuration file for that site to remove the restriction on the <code>listen</code> directive by removing the the <code>127.0.0.1:</code> prefix on the directive for ports 80 and 443.</p>

<p>If you have not run <code>valet secure</code> on the project, you can open up network access for all non-HTTPS sites by editing the <code>/usr/local/etc/nginx/valet/valet.conf</code> file. However, if you&#39;re serving the project site over HTTPS (you have run <code>valet secure</code> for the site) then you should edit the <code>~/.config/valet/Nginx/app-name.test</code> file.</p>

<p>Once you have updated your Nginx configuration, run the <code>valet restart</code> command to apply the configuration changes.</p>

<p><a name="site-specific-environment-variables"></a></p>

<h2>Site Specific Environment Variables</h2>

<p>Some applications using other frameworks may depend on server environment variables but do not provide a way for those variables to be configured within your project. Valet allows you to configure site specific environment variables by adding a <code>.valet-env.php</code> file within the root of your project. These variables will be added to the <code>$_SERVER</code> global array:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Set $_SERVER[&#39;key&#39;] to &quot;value&quot; for the foo.test site...</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>

<span class="c1">// Set $_SERVER[&#39;key&#39;] to &quot;value&quot; for all sites...</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">&#39;*&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>

<p><a name="proxying-services"></a></p>

<h2>Proxying Services</h2>

<p>Sometimes you may wish to proxy a Valet domain to another service on your local machine. For example, you may occasionally need to run Valet while also running a separate site in Docker; however, Valet and Docker can&#39;t both bind to port 80 at the same time.</p>

<p>To solve this, you may use the <code>proxy</code> command to generate a proxy. For example, you may proxy all traffic from <code>http://elasticsearch.test</code> to <code>http://127.0.0.1:9200</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">proxy</span> <span class="nx">elasticsearch</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//127.0.0.1:9200</span>
</pre></div>

<p>You may remove a proxy using the <code>unproxy</code> command:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">unproxy</span> <span class="nx">elasticsearch</span>
</pre></div>

<p>You may use the <code>proxies</code> command to list all site configuration that are proxied:</p>
<div class="highlight"><pre><span></span><span class="nx">valet</span> <span class="nx">proxies</span>
</pre></div>

<p><a name="custom-valet-drivers"></a></p>

<h2>Custom Valet Drivers</h2>

<p>You can write your own Valet &quot;driver&quot; to serve PHP applications running on another framework or CMS that is not natively supported by Valet. When you install Valet, a <code>~/.config/valet/Drivers</code> directory is created which contains a <code>SampleValetDriver.php</code> file. This file contains a sample driver implementation to demonstrate how to write a custom driver. Writing a driver only requires you to implement three methods: <code>serves</code>, <code>isStaticFile</code>, and <code>frontControllerPath</code>.</p>

<p>All three methods receive the <code>$sitePath</code>, <code>$siteName</code>, and <code>$uri</code> values as their arguments. The <code>$sitePath</code> is the fully qualified path to the site being served on your machine, such as <code>/Users/Lisa/Sites/my-project</code>. The <code>$siteName</code> is the &quot;host&quot; / &quot;site name&quot; portion of the domain (<code>my-project</code>). The <code>$uri</code> is the incoming request URI (<code>/foo/bar</code>).</p>

<p>Once you have completed your custom Valet driver, place it in the <code>~/.config/valet/Drivers</code> directory using the <code>FrameworkValetDriver.php</code> naming convention. For example, if you are writing a custom valet driver for WordPress, your file name should be <code>WordPressValetDriver.php</code>.</p>

<p>Let&#39;s take a look at a sample implementation of each method your custom Valet driver should implement.</p>

<h4>The <code>serves</code> Method</h4>

<p>The <code>serves</code> method should return <code>true</code> if your driver should handle the incoming request. Otherwise, the method should return <code>false</code>. So, within this method you should attempt to determine if the given <code>$sitePath</code> contains a project of the type you are trying to serve.</p>

<p>For example, let&#39;s pretend we are writing a <code>WordPressValetDriver</code>. Our <code>serves</code> method might look something like this:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the driver serves the request.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $sitePath</span>
<span class="cm"> * @param  string  $siteName</span>
<span class="cm"> * @param  string  $uri</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">serves</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">,</span> <span class="nx">$siteName</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">is_dir</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">.</span><span class="s1">&#39;/wp-admin&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>The <code>isStaticFile</code> Method</h4>

<p>The <code>isStaticFile</code> should determine if the incoming request is for a file that is &quot;static&quot;, such as an image or a stylesheet. If the file is static, the method should return the fully qualified path to the static file on disk. If the incoming request is not for a static file, the method should return <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the incoming request is for a static file.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $sitePath</span>
<span class="cm"> * @param  string  $siteName</span>
<span class="cm"> * @param  string  $uri</span>
<span class="cm"> * @return string|false</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">isStaticFile</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">,</span> <span class="nx">$siteName</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nx">$staticFilePath</span> <span class="o">=</span> <span class="nx">$sitePath</span><span class="p">.</span><span class="s1">&#39;/public/&#39;</span><span class="p">.</span><span class="nx">$uri</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$staticFilePath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} The <code>isStaticFile</code> method will only be called if the <code>serves</code> method returns <code>true</code> for the incoming request and the request URI is not <code>/</code>.</p>
</blockquote>

<h4>The <code>frontControllerPath</code> Method</h4>

<p>The <code>frontControllerPath</code> method should return the fully qualified path to your application&#39;s &quot;front controller&quot;, which is typically your &quot;index.php&quot; file or equivalent:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the fully resolved path to the application&#39;s front controller.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  string  $sitePath</span>
<span class="cm"> * @param  string  $siteName</span>
<span class="cm"> * @param  string  $uri</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">frontControllerPath</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">,</span> <span class="nx">$siteName</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">$sitePath</span><span class="p">.</span><span class="s1">&#39;/public/index.php&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><a name="local-drivers"></a></p>

<h3>Local Drivers</h3>

<p>If you would like to define a custom Valet driver for a single application, create a <code>LocalValetDriver.php</code> in the application&#39;s root directory. Your custom driver may extend the base <code>ValetDriver</code> class or extend an existing application specific driver such as the <code>LaravelValetDriver</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">LocalValetDriver</span> <span class="kr">extends</span> <span class="nx">LaravelValetDriver</span>
<span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Determine if the driver serves the request.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  string  $sitePath</span>
<span class="cm">     * @param  string  $siteName</span>
<span class="cm">     * @param  string  $uri</span>
<span class="cm">     * @return bool</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">serves</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">,</span> <span class="nx">$siteName</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the fully resolved path to the application&#39;s front controller.</span>
<span class="cm">     *</span>
<span class="cm">     * @param  string  $sitePath</span>
<span class="cm">     * @param  string  $siteName</span>
<span class="cm">     * @param  string  $uri</span>
<span class="cm">     * @return string</span>
<span class="cm">     */</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">frontControllerPath</span><span class="p">(</span><span class="nx">$sitePath</span><span class="p">,</span> <span class="nx">$siteName</span><span class="p">,</span> <span class="nx">$uri</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$sitePath</span><span class="p">.</span><span class="s1">&#39;/public_html/index.php&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="other-valet-commands"></a></p>

<h2>Other Valet Commands</h2>

<p>Command  | Description
------------- | -------------
<code>valet forget</code> | Run this command from a &quot;parked&quot; directory to remove it from the parked directory list.
<code>valet log</code> | View a list of logs which are written by Valet&#39;s services.
<code>valet paths</code> | View all of your &quot;parked&quot; paths.
<code>valet restart</code> | Restart the Valet daemon.
<code>valet start</code> | Start the Valet daemon.
<code>valet stop</code> | Stop the Valet daemon.
<code>valet trust</code> | Add sudoers files for Brew and Valet to allow Valet commands to be run without prompting for passwords.
<code>valet uninstall</code> | Uninstall Valet: Shows instructions for manual uninstall; or pass the <code>--force</code> parameter to aggressively delete all of Valet.</p>

<p><a name="valet-directories-and-files"></a></p>

<h2>Valet Directories &amp; Files</h2>

<p>You may find the following directory and file information helpful while troubleshooting issues with your Valet environment:</p>

<p>File / Path | Description
--------- | -----------
<code>~/.config/valet/</code> | Contains all of Valet&#39;s configuration. You may wish to maintain a backup of this folder.
<code>~/.config/valet/dnsmasq.d/</code> | Contains DNSMasq&#39;s configuration.
<code>~/.config/valet/Drivers/</code> | Contains custom Valet drivers.
<code>~/.config/valet/Extensions/</code> | Contains custom Valet extensions / commands.
<code>~/.config/valet/Nginx/</code> | Contains all Valet generated Nginx site configurations. These files are rebuilt when running the <code>install</code>, <code>secure</code>, and <code>tld</code> commands.
<code>~/.config/valet/Sites/</code> | Contains all symbolic links for linked projects.
<code>~/.config/valet/config.json</code> | Valet&#39;s master configuration file
<code>~/.config/valet/valet.sock</code> | The PHP-FPM socket used by Valet&#39;s Nginx configuration. This will only exist if PHP is running properly.
<code>~/.config/valet/Log/fpm-php.www.log</code> | User log for PHP errors.
<code>~/.config/valet/Log/nginx-error.log</code> | User log for Nginx errors.
<code>/usr/local/var/log/php-fpm.log</code> | System log for PHP-FPM errors.
<code>/usr/local/var/log/nginx</code> | Contains Nginx access and error logs.
<code>/usr/local/etc/php/X.X/conf.d</code> | Contains <code>*.ini</code> files for various PHP configuration settings.
<code>/usr/local/etc/php/X.X/php-fpm.d/valet-fpm.conf</code> | PHP-FPM pool configuration file.
<code>~/.composer/vendor/laravel/valet/cli/stubs/secure.valet.conf</code> | The default Nginx configuration used for building site certificates.</p>
<div style="page-break-after: always;" ></div><h1>Validation</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#validation-quickstart">Validation Quickstart</a>

<ul>
<li><a href="#quick-defining-the-routes">Defining The Routes</a></li>
<li><a href="#quick-creating-the-controller">Creating The Controller</a></li>
<li><a href="#quick-writing-the-validation-logic">Writing The Validation Logic</a></li>
<li><a href="#quick-displaying-the-validation-errors">Displaying The Validation Errors</a></li>
<li><a href="#a-note-on-optional-fields">A Note On Optional Fields</a></li>
</ul></li>
<li><a href="#form-request-validation">Form Request Validation</a>

<ul>
<li><a href="#creating-form-requests">Creating Form Requests</a></li>
<li><a href="#authorizing-form-requests">Authorizing Form Requests</a></li>
<li><a href="#customizing-the-error-messages">Customizing The Error Messages</a></li>
<li><a href="#customizing-the-validation-attributes">Customizing The Validation Attributes</a></li>
<li><a href="#prepare-input-for-validation">Prepare Input For Validation</a></li>
</ul></li>
<li><a href="#manually-creating-validators">Manually Creating Validators</a>

<ul>
<li><a href="#automatic-redirection">Automatic Redirection</a></li>
<li><a href="#named-error-bags">Named Error Bags</a></li>
<li><a href="#after-validation-hook">After Validation Hook</a></li>
</ul></li>
<li><a href="#working-with-error-messages">Working With Error Messages</a>

<ul>
<li><a href="#custom-error-messages">Custom Error Messages</a></li>
</ul></li>
<li><a href="#available-validation-rules">Available Validation Rules</a></li>
<li><a href="#conditionally-adding-rules">Conditionally Adding Rules</a></li>
<li><a href="#validating-arrays">Validating Arrays</a></li>
<li><a href="#custom-validation-rules">Custom Validation Rules</a>

<ul>
<li><a href="#using-rule-objects">Using Rule Objects</a></li>
<li><a href="#using-closures">Using Closures</a></li>
<li><a href="#using-extensions">Using Extensions</a></li>
<li><a href="#implicit-extensions">Implicit Extensions</a></li>
</ul></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Laravel provides several different approaches to validate your application&#39;s incoming data. By default, Laravel&#39;s base controller class uses a <code>ValidatesRequests</code> trait which provides a convenient method to validate incoming HTTP requests with a variety of powerful validation rules.</p>

<p><a name="validation-quickstart"></a></p>

<h2>Validation Quickstart</h2>

<p>To learn about Laravel&#39;s powerful validation features, let&#39;s look at a complete example of validating a form and displaying the error messages back to the user.</p>

<p><a name="quick-defining-the-routes"></a></p>

<h3>Defining The Routes</h3>

<p>First, let&#39;s assume we have the following routes defined in our <code>routes/web.php</code> file:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Http</span><span class="err">\</span><span class="nx">Controllers</span><span class="err">\</span><span class="nx">PostController</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;post/create&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">PostController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">]);</span>

<span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">PostController</span><span class="o">::</span><span class="kr">class</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]);</span>
</pre></div>

<p>The <code>GET</code> route will display a form for the user to create a new blog post, while the <code>POST</code> route will store the new blog post in the database.</p>

<p><a name="quick-creating-the-controller"></a></p>

<h3>Creating The Controller</h3>

<p>Next, let&#39;s take a look at a simple controller that handles these routes. We&#39;ll leave the <code>store</code> method empty for now:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Show the form to create a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;post.create&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Store a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validate and store the blog post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="quick-writing-the-validation-logic"></a></p>

<h3>Writing The Validation Logic</h3>

<p>Now we are ready to fill in our <code>store</code> method with the logic to validate the new blog post. To do this, we will use the <code>validate</code> method provided by the <code>Illuminate\Http\Request</code> object. If the validation rules pass, your code will keep executing normally; however, if validation fails, an exception will be thrown and the proper error response will automatically be sent back to the user. In the case of a traditional HTTP request, a redirect response will be generated, while a JSON response will be sent for AJAX requests.</p>

<p>To get a better understanding of the <code>validate</code> method, let&#39;s jump back into the <code>store</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store a new blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  Request  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$validatedData</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// The blog post is valid...</span>
<span class="p">}</span>
</pre></div>

<p>As you can see, we pass the desired validation rules into the <code>validate</code> method. Again, if the validation fails, the proper response will automatically be generated. If the validation passes, our controller will continue executing normally.</p>

<p>Alternatively, validation rules may be specified as arrays of rules instead of a single <code>|</code> delimited string:</p>
<div class="highlight"><pre><span></span><span class="nx">$validatedData</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;unique:posts&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">],</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p>You may use the <code>validateWithBag</code> method to validate a request and store any error messages within a <a href="#named-error-bags">named error bag</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">$validatedData</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validateWithBag</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;unique:posts&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">],</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<h4>Stopping On First Validation Failure</h4>

<p>Sometimes you may wish to stop running validation rules on an attribute after the first validation failure. To do so, assign the <code>bail</code> rule to the attribute:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;bail|required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>In this example, if the <code>unique</code> rule on the <code>title</code> attribute fails, the <code>max</code> rule will not be checked. Rules will be validated in the order they are assigned.</p>

<h4>A Note On Nested Attributes</h4>

<p>If your HTTP request contains &quot;nested&quot; parameters, you may specify them in your validation rules using &quot;dot&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;author.name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;author.description&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p><a name="quick-displaying-the-validation-errors"></a></p>

<h3>Displaying The Validation Errors</h3>

<p>So, what if the incoming request parameters do not pass the given validation rules? As mentioned previously, Laravel will automatically redirect the user back to their previous location. In addition, all of the validation errors will automatically be <a href="/docs/%7B%7Bversion%7D%7D/session#flash-data">flashed to the session</a>.</p>

<p>Again, notice that we did not have to explicitly bind the error messages to the view in our <code>GET</code> route. This is because Laravel will check for errors in the session data, and automatically bind them to the view if they are available. The <code>$errors</code> variable will be an instance of <code>Illuminate\Support\MessageBag</code>. For more information on working with this object, <a href="#working-with-error-messages">check out its documentation</a>.</p>

<blockquote>
<p>{tip} The <code>$errors</code> variable is bound to the view by the <code>Illuminate\View\Middleware\ShareErrorsFromSession</code> middleware, which is provided by the <code>web</code> middleware group. <strong>When this middleware is applied an <code>$errors</code> variable will always be available in your views</strong>, allowing you to conveniently assume the <code>$errors</code> variable is always defined and can be safely used.</p>
</blockquote>

<p>So, in our example, the user will be redirected to our controller&#39;s <code>create</code> method when validation fails, allowing us to display the error messages in the view:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/post/create.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Create</span> <span class="nx">Post</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

<span class="err">@</span><span class="k">if</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">any</span><span class="p">())</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="err">@</span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$error</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$error</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="err">@</span><span class="nx">endforeach</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">endif</span>

<span class="c">&lt;!--</span> <span class="nx">Create</span> <span class="nx">Post</span> <span class="nx">Form</span> <span class="o">--&gt;</span>
</pre></div>

<h4>The <code>@error</code> Directive</h4>

<p>You may also use the <code>@error</code> <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade</a> directive to quickly check if validation error messages exist for a given attribute. Within an <code>@error</code> directive, you may echo the <code>$message</code> variable to display the error message:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="err">/resources/views/post/create.blade.php --&gt;</span>

<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span><span class="nx">Post</span> <span class="nx">Title</span><span class="o">&lt;</span><span class="err">/label&gt;</span>

<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;@error(&#39;title&#39;) is-invalid @enderror&quot;</span><span class="o">&gt;</span>

<span class="err">@</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">$message</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="err">@</span><span class="nx">enderror</span>
</pre></div>

<p><a name="a-note-on-optional-fields"></a></p>

<h3>A Note On Optional Fields</h3>

<p>By default, Laravel includes the <code>TrimStrings</code> and <code>ConvertEmptyStringsToNull</code> middleware in your application&#39;s global middleware stack. These middleware are listed in the stack by the <code>App\Http\Kernel</code> class. Because of this, you will often need to mark your &quot;optional&quot; request fields as <code>nullable</code> if you do not want the validator to consider <code>null</code> values as invalid. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;publish_at&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;nullable|date&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>In this example, we are specifying that the <code>publish_at</code> field may be either <code>null</code> or a valid date representation. If the <code>nullable</code> modifier is not added to the rule definition, the validator would consider <code>null</code> an invalid date.</p>

<p><a name="quick-ajax-requests-and-validation"></a></p>

<h4>AJAX Requests &amp; Validation</h4>

<p>In this example, we used a traditional form to send data to the application. However, many applications use AJAX requests. When using the <code>validate</code> method during an AJAX request, Laravel will not generate a redirect response. Instead, Laravel generates a JSON response containing all of the validation errors. This JSON response will be sent with a 422 HTTP status code.</p>

<p><a name="form-request-validation"></a></p>

<h2>Form Request Validation</h2>

<p><a name="creating-form-requests"></a></p>

<h3>Creating Form Requests</h3>

<p>For more complex validation scenarios, you may wish to create a &quot;form request&quot;. Form requests are custom request classes that contain validation logic. To create a form request class, use the <code>make:request</code> Artisan CLI command:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">request</span> <span class="nx">StoreBlogPost</span>
</pre></div>

<p>The generated class will be placed in the <code>app/Http/Requests</code> directory. If this directory does not exist, it will be created when you run the <code>make:request</code> command. Let&#39;s add a few validation rules to the <code>rules</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the validation rules that apply to the request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">rules</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may type-hint any dependencies you need within the <code>rules</code> method&#39;s signature. They will automatically be resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>
</blockquote>

<p>So, how are the validation rules evaluated? All you need to do is type-hint the request on your controller method. The incoming form request is validated before the controller method is called, meaning you do not need to clutter your controller with any validation logic:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Store the incoming blog post.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  StoreBlogPost  $request</span>
<span class="cm"> * @return Response</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">store</span><span class="p">(</span><span class="nx">StoreBlogPost</span> <span class="nx">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// The incoming request is valid...</span>

    <span class="c1">// Retrieve the validated input data...</span>
    <span class="nx">$validated</span> <span class="o">=</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validated</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>If validation fails, a redirect response will be generated to send the user back to their previous location. The errors will also be flashed to the session so they are available for display. If the request was an AJAX request, a HTTP response with a 422 status code will be returned to the user including a JSON representation of the validation errors.</p>

<h4>Adding After Hooks To Form Requests</h4>

<p>If you would like to add an &quot;after&quot; hook to a form request, you may use the <code>withValidator</code> method. This method receives the fully constructed validator, allowing you to call any of its methods before the validation rules are actually evaluated:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Configure the validator instance.</span>
<span class="cm"> *</span>
<span class="cm"> * @param  \Illuminate\Validation\Validator  $validator</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">withValidator</span><span class="p">(</span><span class="nx">$validator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$validator</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">somethingElseIsInvalid</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;Something is wrong with this field!&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="authorizing-form-requests"></a></p>

<h3>Authorizing Form Requests</h3>

<p>The form request class also contains an <code>authorize</code> method. Within this method, you may check if the authenticated user actually has the authority to update a given resource. For example, you may determine if a user actually owns a blog comment they are attempting to update:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$comment</span> <span class="o">=</span> <span class="nx">Comment</span><span class="o">::</span><span class="nx">find</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">$comment</span> <span class="o">&amp;&amp;</span> <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">can</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">$comment</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Since all form requests extend the base Laravel request class, we may use the <code>user</code> method to access the currently authenticated user. Also note the call to the <code>route</code> method in the example above. This method grants you access to the URI parameters defined on the route being called, such as the <code>{comment}</code> parameter in the example below:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;comment/{comment}&#39;</span><span class="p">);</span>
</pre></div>

<p>If the <code>authorize</code> method returns <code>false</code>, a HTTP response with a 403 status code will automatically be returned and your controller method will not execute.</p>

<p>If you plan to have authorization logic in another part of your application, return <code>true</code> from the <code>authorize</code> method:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Determine if the user is authorized to make this request.</span>
<span class="cm"> *</span>
<span class="cm"> * @return bool</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{tip} You may type-hint any dependencies you need within the <code>authorize</code> method&#39;s signature. They will automatically be resolved via the Laravel <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>.</p>
</blockquote>

<p><a name="customizing-the-error-messages"></a></p>

<h3>Customizing The Error Messages</h3>

<p>You may customize the error messages used by the form request by overriding the <code>messages</code> method. This method should return an array of attribute / rule pairs and their corresponding error messages:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the error messages for the defined validation rules.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">messages</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;title.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A title is required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;A message is required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="customizing-the-validation-attributes"></a></p>

<h3>Customizing The Validation Attributes</h3>

<p>If you would like the <code>:attribute</code> portion of your validation message to be replaced with a custom attribute name, you may specify the custom names by overriding the <code>attributes</code> method. This method should return an array of attribute / name pairs:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get custom attributes for validator errors.</span>
<span class="cm"> *</span>
<span class="cm"> * @return array</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">attributes</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email address&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><a name="prepare-input-for-validation"></a></p>

<h3>Prepare Input For Validation</h3>

<p>If you need to sanitize any data from the request before you apply your validation rules, you can use the <code>prepareForValidation</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Str</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Prepare the data for validation.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="kd">function</span> <span class="nx">prepareForValidation</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">merge</span><span class="p">([</span>
        <span class="s1">&#39;slug&#39;</span> <span class="p">=&gt;</span> <span class="nx">Str</span><span class="o">::</span><span class="nx">slug</span><span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">slug</span><span class="p">),</span>
    <span class="p">]);</span>
<span class="p">}</span>
</pre></div>

<p><a name="manually-creating-validators"></a></p>

<h2>Manually Creating Validators</h2>

<p>If you do not want to use the <code>validate</code> method on the request, you may create a validator instance manually using the <code>Validator</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. The <code>make</code> method on the facade generates a new validator instance:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Store a new blog post.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;post/create&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withErrors</span><span class="p">(</span><span class="nv">$validator</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Store the blog post...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The first argument passed to the <code>make</code> method is the data under validation. The second argument is the validation rules that should be applied to the data.</p>

<p>After checking if the request validation failed, you may use the <code>withErrors</code> method to flash the error messages to the session. When using this method, the <code>$errors</code> variable will automatically be shared with your views after redirection, allowing you to easily display them back to the user. The <code>withErrors</code> method accepts a validator, a <code>MessageBag</code>, or a PHP <code>array</code>.</p>

<p><a name="automatic-redirection"></a></p>

<h3>Automatic Redirection</h3>

<p>If you would like to create a validator instance manually but still take advantage of the automatic redirection offered by the request&#39;s <code>validate</code> method, you may call the <code>validate</code> method on an existing validator instance. If validation fails, the user will automatically be redirected or, in the case of an AJAX request, a JSON response will be returned:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">();</span>
</pre></div>

<p>You may use the <code>validateWithBag</code> method to store the error messages in a <a href="#named-error-bags">named error bag</a> if validation fails:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|unique:posts|max:255&#39;</span><span class="p">,</span>
    <span class="s1">&#39;body&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nx">validateWithBag</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="named-error-bags"></a></p>

<h3>Named Error Bags</h3>

<p>If you have multiple forms on a single page, you may wish to name the <code>MessageBag</code> of errors, allowing you to retrieve the error messages for a specific form. Pass a name as the second argument to <code>withErrors</code>:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nx">withErrors</span><span class="p">(</span><span class="nx">$validator</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">);</span>
</pre></div>

<p>You may then access the named <code>MessageBag</code> instance from the <code>$errors</code> variable:</p>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">login</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>

<p><a name="after-validation-hook"></a></p>

<h3>After Validation Hook</h3>

<p>The validator also allows you to attach callbacks to be run after validation is completed. This allows you to easily perform further validation and even add more error messages to the message collection. To get started, use the <code>after</code> method on a validator instance:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(...);</span>

<span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="o">-&gt;</span><span class="nx">somethingElseIsInvalid</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;Something is wrong with this field!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">fails</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="working-with-error-messages"></a></p>

<h2>Working With Error Messages</h2>

<p>After calling the <code>errors</code> method on a <code>Validator</code> instance, you will receive an <code>Illuminate\Support\MessageBag</code> instance, which has a variety of convenient methods for working with error messages. The <code>$errors</code> variable that is automatically made available to all views is also an instance of the <code>MessageBag</code> class.</p>

<h4>Retrieving The First Error Message For A Field</h4>

<p>To retrieve the first error message for a given field, use the <code>first</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$errors</span> <span class="o">=</span> <span class="nx">$validator</span><span class="o">-&gt;</span><span class="nx">errors</span><span class="p">();</span>

<span class="nx">echo</span> <span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</pre></div>

<h4>Retrieving All Error Messages For A Field</h4>

<p>If you need to retrieve an array of all the messages for a given field, use the <code>get</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p>If you are validating an array form field, you may retrieve all of the messages for each of the array elements using the <code>*</code> character:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;attachments.*&#39;</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Retrieving All Error Messages For All Fields</h4>

<p>To retrieve an array of all messages for all fields, use the <code>all</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">foreach</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Determining If Messages Exist For A Field</h4>

<p>The <code>has</code> method may be used to determine if any error messages exist for a given field:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">$errors</span><span class="o">-&gt;</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<p><a name="custom-error-messages"></a></p>

<h3>Custom Error Messages</h3>

<p>If needed, you may use custom error messages for validation instead of the defaults. There are several ways to specify custom messages. First, you may pass the custom messages as the third argument to the <code>Validator::make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute field is required.&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">);</span>
</pre></div>

<p>In this example, the <code>:attribute</code> placeholder will be replaced by the actual name of the field under validation. You may also utilize other placeholders in validation messages. For example:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;same&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute and :other must match.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be exactly :size.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;between&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute value :input is not between :min - :max.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;in&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;The :attribute must be one of the following types: :values&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<h4>Specifying A Custom Message For A Given Attribute</h4>

<p>Sometimes you may wish to specify a custom error message only for a specific field. You may do so using &quot;dot&quot; notation. Specify the attribute&#39;s name first, followed by the rule:</p>
<div class="highlight"><pre><span></span><span class="nx">$messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;email.required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>

<p><a name="localization"></a></p>

<h4>Specifying Custom Messages In Language Files</h4>

<p>In most cases, you will probably specify your custom messages in a language file instead of passing them directly to the <code>Validator</code>. To do so, add your messages to <code>custom</code> array in the <code>resources/lang/xx/validation.php</code> language file.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;We need to know your e-mail address!&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<h4>Specifying Custom Attribute Values</h4>

<p>If you would like the <code>:attribute</code> portion of your validation message to be replaced with a custom attribute name, you may specify the custom name in the <code>attributes</code> array of your <code>resources/lang/xx/validation.php</code> language file:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;attributes&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email address&#39;</span><span class="p">,</span>
<span class="p">],</span>
</pre></div>

<p>You may also pass the custom attributes as the fourth argument to the <code>Validator::make</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">$customAttributes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email address&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">,</span> <span class="nx">$messages</span><span class="p">,</span> <span class="nx">$customAttributes</span><span class="p">);</span>
</pre></div>

<h4>Specifying Custom Values In Language Files</h4>

<p>Sometimes you may need the <code>:value</code> portion of your validation message to be replaced with a custom representation of the value. For example, consider the following rule that specifies that a credit card number is required if the <code>payment_type</code> has a value of <code>cc</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;credit_card_number&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required_if:payment_type,cc&#39;</span>
<span class="p">]);</span>
</pre></div>

<p>If this validation rule fails, it will produce the following error message:</p>
<div class="highlight"><pre><span></span><span class="nx">The</span> <span class="nx">credit</span> <span class="nx">card</span> <span class="nx">number</span> <span class="nx">field</span> <span class="nx">is</span> <span class="nx">required</span> <span class="nx">when</span> <span class="nx">payment</span> <span class="nx">type</span> <span class="nx">is</span> <span class="nx">cc</span><span class="p">.</span>
</pre></div>

<p>Instead of displaying <code>cc</code> as the payment type value, you may specify a custom value representation in your <code>validation</code> language file by defining a <code>values</code> array:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;values&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;payment_type&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;cc&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;credit card&#39;</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>

<p>Now if the validation rule fails it will produce the following message:</p>
<div class="highlight"><pre><span></span><span class="nx">The</span> <span class="nx">credit</span> <span class="nx">card</span> <span class="nx">number</span> <span class="nx">field</span> <span class="nx">is</span> <span class="nx">required</span> <span class="nx">when</span> <span class="nx">payment</span> <span class="nx">type</span> <span class="nx">is</span> <span class="nx">credit</span> <span class="nx">card</span><span class="p">.</span>
</pre></div>

<p><a name="available-validation-rules"></a></p>

<h2>Available Validation Rules</h2>

<p>Below is a list of all available validation rules and their function:</p>

<style>
    .collection-method-list > p {
        column-count: 3; -moz-column-count: 3; -webkit-column-count: 3;
        column-gap: 2em; -moz-column-gap: 2em; -webkit-column-gap: 2em;
    }

    .collection-method-list a {
        display: block;
    }
</style>

<div class="collection-method-list" markdown="1">

[Accepted](#rule-accepted)
[Active URL](#rule-active-url)
[After (Date)](#rule-after)
[After Or Equal (Date)](#rule-after-or-equal)
[Alpha](#rule-alpha)
[Alpha Dash](#rule-alpha-dash)
[Alpha Numeric](#rule-alpha-num)
[Array](#rule-array)
[Bail](#rule-bail)
[Before (Date)](#rule-before)
[Before Or Equal (Date)](#rule-before-or-equal)
[Between](#rule-between)
[Boolean](#rule-boolean)
[Confirmed](#rule-confirmed)
[Date](#rule-date)
[Date Equals](#rule-date-equals)
[Date Format](#rule-date-format)
[Different](#rule-different)
[Digits](#rule-digits)
[Digits Between](#rule-digits-between)
[Dimensions (Image Files)](#rule-dimensions)
[Distinct](#rule-distinct)
[Email](#rule-email)
[Ends With](#rule-ends-with)
[Exclude If](#rule-exclude-if)
[Exclude Unless](#rule-exclude-unless)
[Exists (Database)](#rule-exists)
[File](#rule-file)
[Filled](#rule-filled)
[Greater Than](#rule-gt)
[Greater Than Or Equal](#rule-gte)
[Image (File)](#rule-image)
[In](#rule-in)
[In Array](#rule-in-array)
[Integer](#rule-integer)
[IP Address](#rule-ip)
[JSON](#rule-json)
[Less Than](#rule-lt)
[Less Than Or Equal](#rule-lte)
[Max](#rule-max)
[MIME Types](#rule-mimetypes)
[MIME Type By File Extension](#rule-mimes)
[Min](#rule-min)
[Not In](#rule-not-in)
[Not Regex](#rule-not-regex)
[Nullable](#rule-nullable)
[Numeric](#rule-numeric)
[Password](#rule-password)
[Present](#rule-present)
[Regular Expression](#rule-regex)
[Required](#rule-required)
[Required If](#rule-required-if)
[Required Unless](#rule-required-unless)
[Required With](#rule-required-with)
[Required With All](#rule-required-with-all)
[Required Without](#rule-required-without)
[Required Without All](#rule-required-without-all)
[Same](#rule-same)
[Size](#rule-size)
[Sometimes](#conditionally-adding-rules)
[Starts With](#rule-starts-with)
[String](#rule-string)
[Timezone](#rule-timezone)
[Unique (Database)](#rule-unique)
[URL](#rule-url)
[UUID](#rule-uuid)

</div>

<p><a name="rule-accepted"></a></p>

<h4>accepted</h4>

<p>The field under validation must be <em>yes</em>, <em>on</em>, <em>1</em>, or <em>true</em>. This is useful for validating &quot;Terms of Service&quot; acceptance.</p>

<p><a name="rule-active-url"></a></p>

<h4>active_url</h4>

<p>The field under validation must have a valid A or AAAA record according to the <code>dns_get_record</code> PHP function. The hostname of the provided URL is extracted using the <code>parse_url</code> PHP function before being passed to <code>dns_get_record</code>.</p>

<p><a name="rule-after"></a></p>

<h4>after:<em>date</em></h4>

<p>The field under validation must be a value after a given date. The dates will be passed into the <code>strtotime</code> PHP function:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;start_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|date|after:tomorrow&#39;</span>
</pre></div>

<p>Instead of passing a date string to be evaluated by <code>strtotime</code>, you may specify another field to compare against the date:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;finish_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|date|after:start_date&#39;</span>
</pre></div>

<p><a name="rule-after-or-equal"></a></p>

<h4>after_or_equal:<em>date</em></h4>

<p>The field under validation must be a value after or equal to the given date. For more information, see the <a href="#rule-after">after</a> rule.</p>

<p><a name="rule-alpha"></a></p>

<h4>alpha</h4>

<p>The field under validation must be entirely alphabetic characters.</p>

<p><a name="rule-alpha-dash"></a></p>

<h4>alpha_dash</h4>

<p>The field under validation may have alpha-numeric characters, as well as dashes and underscores.</p>

<p><a name="rule-alpha-num"></a></p>

<h4>alpha_num</h4>

<p>The field under validation must be entirely alpha-numeric characters.</p>

<p><a name="rule-array"></a></p>

<h4>array</h4>

<p>The field under validation must be a PHP <code>array</code>.</p>

<p><a name="rule-bail"></a></p>

<h4>bail</h4>

<p>Stop running validation rules after the first validation failure.</p>

<p><a name="rule-before"></a></p>

<h4>before:<em>date</em></h4>

<p>The field under validation must be a value preceding the given date. The dates will be passed into the PHP <code>strtotime</code> function. In addition, like the <a href="#rule-after"><code>after</code></a> rule, the name of another field under validation may be supplied as the value of <code>date</code>.</p>

<p><a name="rule-before-or-equal"></a></p>

<h4>before_or_equal:<em>date</em></h4>

<p>The field under validation must be a value preceding or equal to the given date. The dates will be passed into the PHP <code>strtotime</code> function. In addition, like the <a href="#rule-after"><code>after</code></a> rule, the name of another field under validation may be supplied as the value of <code>date</code>.</p>

<p><a name="rule-between"></a></p>

<h4>between:<em>min</em>,<em>max</em></h4>

<p>The field under validation must have a size between the given <em>min</em> and <em>max</em>. Strings, numerics, arrays, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-boolean"></a></p>

<h4>boolean</h4>

<p>The field under validation must be able to be cast as a boolean. Accepted input are <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code>, <code>&quot;1&quot;</code>, and <code>&quot;0&quot;</code>.</p>

<p><a name="rule-confirmed"></a></p>

<h4>confirmed</h4>

<p>The field under validation must have a matching field of <code>foo_confirmation</code>. For example, if the field under validation is <code>password</code>, a matching <code>password_confirmation</code> field must be present in the input.</p>

<p><a name="rule-date"></a></p>

<h4>date</h4>

<p>The field under validation must be a valid, non-relative date according to the <code>strtotime</code> PHP function.</p>

<p><a name="rule-date-equals"></a></p>

<h4>date<em>equals:</em>date_</h4>

<p>The field under validation must be equal to the given date. The dates will be passed into the PHP <code>strtotime</code> function.</p>

<p><a name="rule-date-format"></a></p>

<h4>date<em>format:</em>format_</h4>

<p>The field under validation must match the given <em>format</em>. You should use <strong>either</strong> <code>date</code> or <code>date_format</code> when validating a field, not both. This validation rule supports all formats supported by PHP&#39;s <a href="https://www.php.net/manual/en/class.datetime.php">DateTime</a> class.</p>

<p><a name="rule-different"></a></p>

<h4>different:<em>field</em></h4>

<p>The field under validation must have a different value than <em>field</em>.</p>

<p><a name="rule-digits"></a></p>

<h4>digits:<em>value</em></h4>

<p>The field under validation must be <em>numeric</em> and must have an exact length of <em>value</em>.</p>

<p><a name="rule-digits-between"></a></p>

<h4>digits<em>between:</em>min<em>,</em>max_</h4>

<p>The field under validation must be <em>numeric</em> and must have a length between the given <em>min</em> and <em>max</em>.</p>

<p><a name="rule-dimensions"></a></p>

<h4>dimensions</h4>

<p>The file under validation must be an image meeting the dimension constraints as specified by the rule&#39;s parameters:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;avatar&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dimensions:min_width=100,min_height=200&#39;</span>
</pre></div>

<p>Available constraints are: <em>min_width</em>, <em>max_width</em>, <em>min_height</em>, <em>max_height</em>, <em>width</em>, <em>height</em>, <em>ratio</em>.</p>

<p>A <em>ratio</em> constraint should be represented as width divided by height. This can be specified either by a statement like <code>3/2</code> or a float like <code>1.5</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;avatar&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dimensions:ratio=3/2&#39;</span>
</pre></div>

<p>Since this rule requires several arguments, you may use the <code>Rule::dimensions</code> method to fluently construct the rule:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;avatar&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="nx">Rule</span><span class="o">::</span><span class="nx">dimensions</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">maxWidth</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">maxHeight</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ratio</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="rule-distinct"></a></p>

<h4>distinct</h4>

<p>When working with arrays, the field under validation must not have any duplicate values.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;foo.*.id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;distinct&#39;</span>
</pre></div>

<p><a name="rule-email"></a></p>

<h4>email</h4>

<p>The field under validation must be formatted as an e-mail address. Under the hood, this validation rule makes use of the <a href="https://github.com/egulias/EmailValidator"><code>egulias/email-validator</code></a> package for validating the email address. By default the <code>RFCValidation</code> validator is applied, but you can apply other validation styles as well:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email:rfc,dns&#39;</span>
</pre></div>

<p>The example above will apply the <code>RFCValidation</code> and <code>DNSCheckValidation</code> validations. Here&#39;s a full list of validation styles you can apply:</p>

<div class="content-list" markdown="1">
- `rfc`: `RFCValidation`
- `strict`: `NoRFCWarningsValidation`
- `dns`: `DNSCheckValidation`
- `spoof`: `SpoofCheckValidation`
- `filter`: `FilterEmailValidation`
</div>

<p>The <code>filter</code> validator, which uses PHP&#39;s <code>filter_var</code> function under the hood, ships with Laravel and is Laravel&#39;s pre-5.8 behavior. The <code>dns</code> and <code>spoof</code> validators require the PHP <code>intl</code> extension.</p>

<p><a name="rule-ends-with"></a></p>

<h4>ends<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must end with one of the given values.</p>

<p><a name="rule-exclude-if"></a></p>

<h4>exclude<em>if:</em>anotherfield<em>,</em>value_</h4>

<p>The field under validation will be excluded from the request data returned by the <code>validate</code> and <code>validated</code> methods if the <em>anotherfield</em> field is equal to <em>value</em>.</p>

<p><a name="rule-exclude-unless"></a></p>

<h4>exclude<em>unless:</em>anotherfield<em>,</em>value_</h4>

<p>The field under validation will be excluded from the request data returned by the <code>validate</code> and <code>validated</code> methods unless <em>anotherfield</em>&#39;s field is equal to <em>value</em>.</p>

<p><a name="rule-exists"></a></p>

<h4>exists:<em>table</em>,<em>column</em></h4>

<p>The field under validation must exist on a given database table.</p>

<h4>Basic Usage Of Exists Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states&#39;</span>
</pre></div>

<p>If the <code>column</code> option is not specified, the field name will be used.</p>

<h4>Specifying A Custom Column Name</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;state&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:states,abbreviation&#39;</span>
</pre></div>

<p>Occasionally, you may need to specify a specific database connection to be used for the <code>exists</code> query. You can accomplish this by prepending the connection name to the table name using &quot;dot&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:connection.staff,email&#39;</span>
</pre></div>

<p>Instead of specifying the table name directly, you may specify the Eloquent model which should be used to determine the table name:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;user_id&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exists:App\Models\User,id&#39;</span>
</pre></div>

<p>If you would like to customize the query executed by the validation rule, you may use the <code>Rule</code> class to fluently define the rule. In this example, we&#39;ll also specify the validation rules as an array instead of using the <code>|</code> character to delimit them:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="nx">Rule</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;staff&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}),</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="rule-file"></a></p>

<h4>file</h4>

<p>The field under validation must be a successfully uploaded file.</p>

<p><a name="rule-filled"></a></p>

<h4>filled</h4>

<p>The field under validation must not be empty when it is present.</p>

<p><a name="rule-gt"></a></p>

<h4>gt:<em>field</em></h4>

<p>The field under validation must be greater than the given <em>field</em>. The two fields must be of the same type. Strings, numerics, arrays, and files are evaluated using the same conventions as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-gte"></a></p>

<h4>gte:<em>field</em></h4>

<p>The field under validation must be greater than or equal to the given <em>field</em>. The two fields must be of the same type. Strings, numerics, arrays, and files are evaluated using the same conventions as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-image"></a></p>

<h4>image</h4>

<p>The file under validation must be an image (jpeg, png, bmp, gif, svg, or webp)</p>

<p><a name="rule-in"></a></p>

<h4>in:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be included in the given list of values. Since this rule often requires you to <code>implode</code> an array, the <code>Rule::in</code> method may be used to fluently construct the rule:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;zones&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="nx">Rule</span><span class="o">::</span><span class="k">in</span><span class="p">([</span><span class="s1">&#39;first-zone&#39;</span><span class="p">,</span> <span class="s1">&#39;second-zone&#39;</span><span class="p">]),</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="rule-in-array"></a></p>

<h4>in<em>array:</em>anotherfield_.*</h4>

<p>The field under validation must exist in <em>anotherfield</em>&#39;s values.</p>

<p><a name="rule-integer"></a></p>

<h4>integer</h4>

<p>The field under validation must be an integer.</p>

<blockquote>
<p>{note} This validation rule does not verify that the input is of the &quot;integer&quot; variable type, only that the input is a string or numeric value that contains an integer.</p>
</blockquote>

<p><a name="rule-ip"></a></p>

<h4>ip</h4>

<p>The field under validation must be an IP address.</p>

<h4>ipv4</h4>

<p>The field under validation must be an IPv4 address.</p>

<h4>ipv6</h4>

<p>The field under validation must be an IPv6 address.</p>

<p><a name="rule-json"></a></p>

<h4>json</h4>

<p>The field under validation must be a valid JSON string.</p>

<p><a name="rule-lt"></a></p>

<h4>lt:<em>field</em></h4>

<p>The field under validation must be less than the given <em>field</em>. The two fields must be of the same type. Strings, numerics, arrays, and files are evaluated using the same conventions as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-lte"></a></p>

<h4>lte:<em>field</em></h4>

<p>The field under validation must be less than or equal to the given <em>field</em>. The two fields must be of the same type. Strings, numerics, arrays, and files are evaluated using the same conventions as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-max"></a></p>

<h4>max:<em>value</em></h4>

<p>The field under validation must be less than or equal to a maximum <em>value</em>. Strings, numerics, arrays, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-mimetypes"></a></p>

<h4>mimetypes:<em>text/plain</em>,...</h4>

<p>The file under validation must match one of the given MIME types:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;video&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mimetypes:video/avi,video/mpeg,video/quicktime&#39;</span>
</pre></div>

<p>To determine the MIME type of the uploaded file, the file&#39;s contents will be read and the framework will attempt to guess the MIME type, which may be different from the client provided MIME type.</p>

<p><a name="rule-mimes"></a></p>

<h4>mimes:<em>foo</em>,<em>bar</em>,...</h4>

<p>The file under validation must have a MIME type corresponding to one of the listed extensions.</p>

<h4>Basic Usage Of MIME Rule</h4>
<div class="highlight"><pre><span></span><span class="s1">&#39;photo&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;mimes:jpeg,bmp,png&#39;</span>
</pre></div>

<p>Even though you only need to specify the extensions, this rule actually validates against the MIME type of the file by reading the file&#39;s contents and guessing its MIME type.</p>

<p>A full listing of MIME types and their corresponding extensions may be found at the following location: <a href="https://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types">https://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types</a></p>

<p><a name="rule-min"></a></p>

<h4>min:<em>value</em></h4>

<p>The field under validation must have a minimum <em>value</em>. Strings, numerics, arrays, and files are evaluated in the same fashion as the <a href="#rule-size"><code>size</code></a> rule.</p>

<p><a name="rule-not-in"></a></p>

<h4>not<em>in:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must not be included in the given list of values. The <code>Rule::notIn</code> method may be used to fluently construct the rule:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;toppings&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="nx">Rule</span><span class="o">::</span><span class="nx">notIn</span><span class="p">([</span><span class="s1">&#39;sprinkles&#39;</span><span class="p">,</span> <span class="s1">&#39;cherries&#39;</span><span class="p">]),</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="rule-not-regex"></a></p>

<h4>not<em>regex:</em>pattern_</h4>

<p>The field under validation must not match the given regular expression.</p>

<p>Internally, this rule uses the PHP <code>preg_match</code> function. The pattern specified should obey the same formatting required by <code>preg_match</code> and thus also include valid delimiters. For example: <code>&#39;email&#39; =&gt; &#39;not_regex:/^.+$/i&#39;</code>.</p>

<p><strong>Note:</strong> When using the <code>regex</code> / <code>not_regex</code> patterns, it may be necessary to specify rules in an array instead of using pipe delimiters, especially if the regular expression contains a pipe character.</p>

<p><a name="rule-nullable"></a></p>

<h4>nullable</h4>

<p>The field under validation may be <code>null</code>. This is particularly useful when validating primitive such as strings and integers that can contain <code>null</code> values.</p>

<p><a name="rule-numeric"></a></p>

<h4>numeric</h4>

<p>The field under validation must be numeric.</p>

<p><a name="rule-password"></a></p>

<h4>password</h4>

<p>The field under validation must match the authenticated user&#39;s password. You may specify an authentication guard using the rule&#39;s first parameter:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;password&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;password:api&#39;</span>
</pre></div>

<p><a name="rule-present"></a></p>

<h4>present</h4>

<p>The field under validation must be present in the input data but can be empty.</p>

<p><a name="rule-regex"></a></p>

<h4>regex:<em>pattern</em></h4>

<p>The field under validation must match the given regular expression.</p>

<p>Internally, this rule uses the PHP <code>preg_match</code> function. The pattern specified should obey the same formatting required by <code>preg_match</code> and thus also include valid delimiters. For example: <code>&#39;email&#39; =&gt; &#39;regex:/^.+@.+$/i&#39;</code>.</p>

<p><strong>Note:</strong> When using the <code>regex</code> / <code>not_regex</code> patterns, it may be necessary to specify rules in an array instead of using pipe delimiters, especially if the regular expression contains a pipe character.</p>

<p><a name="rule-required"></a></p>

<h4>required</h4>

<p>The field under validation must be present in the input data and not empty. A field is considered &quot;empty&quot; if one of the following conditions are true:</p>

<div class="content-list" markdown="1">

- The value is `null`.
- The value is an empty string.
- The value is an empty array or empty `Countable` object.
- The value is an uploaded file with no path.

</div>

<p><a name="rule-required-if"></a></p>

<h4>required<em>if:</em>anotherfield<em>,</em>value_,...</h4>

<p>The field under validation must be present and not empty if the <em>anotherfield</em> field is equal to any <em>value</em>.</p>

<p>If you would like to construct a more complex condition for the <code>required_if</code> rule, you may use the <code>Rule::requiredIf</code> method. This methods accepts a boolean or a Closure. When passed a Closure, the Closure should return <code>true</code> or <code>false</code> to indicate if the field under validation is required:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;role_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">Rule</span><span class="o">::</span><span class="nx">requiredIf</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">is_admin</span><span class="p">),</span>
<span class="p">]);</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;role_id&#39;</span> <span class="p">=&gt;</span> <span class="nx">Rule</span><span class="o">::</span><span class="nx">requiredIf</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="nx">use</span> <span class="p">(</span><span class="nx">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">is_admin</span><span class="p">;</span>
    <span class="p">}),</span>
<span class="p">]);</span>
</pre></div>

<p><a name="rule-required-unless"></a></p>

<h4>required<em>unless:</em>anotherfield<em>,</em>value_,...</h4>

<p>The field under validation must be present and not empty unless the <em>anotherfield</em> field is equal to any <em>value</em>.</p>

<p><a name="rule-required-with"></a></p>

<h4>required<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present and not empty <em>only if</em> any of the other specified fields are present.</p>

<p><a name="rule-required-with-all"></a></p>

<h4>required<em>with</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present and not empty <em>only if</em> all of the other specified fields are present.</p>

<p><a name="rule-required-without"></a></p>

<h4>required<em>without:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must be present and not empty <em>only when</em> any of the other specified fields are not present.</p>

<p><a name="rule-required-without-all"></a></p>

<h4>required<em>without</em>all:<em>foo</em>,<em>bar</em>,...</h4>

<p>The field under validation must be present and not empty <em>only when</em> all of the other specified fields are not present.</p>

<p><a name="rule-same"></a></p>

<h4>same:<em>field</em></h4>

<p>The given <em>field</em> must match the field under validation.</p>

<p><a name="rule-size"></a></p>

<h4>size:<em>value</em></h4>

<p>The field under validation must have a size matching the given <em>value</em>. For string data, <em>value</em> corresponds to the number of characters. For numeric data, <em>value</em> corresponds to a given integer value (the attribute must also have the <code>numeric</code> or <code>integer</code> rule). For an array, <em>size</em> corresponds to the <code>count</code> of the array. For files, <em>size</em> corresponds to the file size in kilobytes. Let&#39;s look at some examples:</p>
<div class="highlight"><pre><span></span><span class="c1">// Validate that a string is exactly 12 characters long...</span>
<span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;size:12&#39;</span><span class="p">;</span>

<span class="c1">// Validate that a provided integer equals 10...</span>
<span class="s1">&#39;seats&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;integer|size:10&#39;</span><span class="p">;</span>

<span class="c1">// Validate that an array has exactly 5 elements...</span>
<span class="s1">&#39;tags&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;array|size:5&#39;</span><span class="p">;</span>

<span class="c1">// Validate that an uploaded file is exactly 512 kilobytes...</span>
<span class="s1">&#39;image&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;file|size:512&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="rule-starts-with"></a></p>

<h4>starts<em>with:</em>foo<em>,</em>bar_,...</h4>

<p>The field under validation must start with one of the given values.</p>

<p><a name="rule-string"></a></p>

<h4>string</h4>

<p>The field under validation must be a string. If you would like to allow the field to also be <code>null</code>, you should assign the <code>nullable</code> rule to the field.</p>

<p><a name="rule-timezone"></a></p>

<h4>timezone</h4>

<p>The field under validation must be a valid timezone identifier according to the <code>timezone_identifiers_list</code> PHP function.</p>

<p><a name="rule-unique"></a></p>

<h4>unique:<em>table</em>,<em>column</em>,<em>except</em>,<em>idColumn</em></h4>

<p>The field under validation must not exist within the given database table.</p>

<p><strong>Specifying A Custom Table / Column Name:</strong></p>

<p>Instead of specifying the table name directly, you may specify the Eloquent model which should be used to determine the table name:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:App\Models\User,email_address&#39;</span>
</pre></div>

<p>The <code>column</code> option may be used to specify the field&#39;s corresponding database column. If the <code>column</code> option is not specified, the field name will be used.</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,email_address&#39;</span>
</pre></div>

<p><strong>Custom Database Connection</strong></p>

<p>Occasionally, you may need to set a custom connection for database queries made by the Validator. As seen above, setting <code>unique:users</code> as a validation rule will use the default database connection to query the database. To override this, specify the connection and the table name using &quot;dot&quot; syntax:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:connection.users,email_address&#39;</span>
</pre></div>

<p><strong>Forcing A Unique Rule To Ignore A Given ID:</strong></p>

<p>Sometimes, you may wish to ignore a given ID during the unique check. For example, consider an &quot;update profile&quot; screen that includes the user&#39;s name, e-mail address, and location. You will probably want to verify that the e-mail address is unique. However, if the user only changes the name field and not the e-mail field, you do not want a validation error to be thrown because the user is already the owner of the e-mail address.</p>

<p>To instruct the validator to ignore the user&#39;s ID, we&#39;ll use the <code>Rule</code> class to fluently define the rule. In this example, we&#39;ll also specify the validation rules as an array instead of using the <code>|</code> character to delimit the rules:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Validation</span><span class="err">\</span><span class="nx">Rule</span><span class="p">;</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="nx">Rule</span><span class="o">::</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ignore</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<blockquote>
<p>{note} You should never pass any user controlled request input into the <code>ignore</code> method. Instead, you should only pass a system generated unique ID such as an auto-incrementing ID or UUID from an Eloquent model instance. Otherwise, your application will be vulnerable to an SQL injection attack.</p>
</blockquote>

<p>Instead of passing the model key&#39;s value to the <code>ignore</code> method, you may pass the entire model instance. Laravel will automatically extract the key from the model:</p>
<div class="highlight"><pre><span></span><span class="nx">Rule</span><span class="o">::</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ignore</span><span class="p">(</span><span class="nx">$user</span><span class="p">)</span>
</pre></div>

<p>If your table uses a primary key column name other than <code>id</code>, you may specify the name of the column when calling the <code>ignore</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Rule</span><span class="o">::</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ignore</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>

<p>By default, the <code>unique</code> rule will check the uniqueness of the column matching the name of the attribute being validated. However, you may pass a different column name as the second argument to the <code>unique</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Rule</span><span class="o">::</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email_address&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">ignore</span><span class="p">(</span><span class="nx">$user</span><span class="o">-&gt;</span><span class="nx">id</span><span class="p">),</span>
</pre></div>

<p><strong>Adding Additional Where Clauses:</strong></p>

<p>You may also specify additional query constraints by customizing the query using the <code>where</code> method. For example, let&#39;s add a constraint that verifies the <code>account_id</code> is <code>1</code>:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="nx">Rule</span><span class="o">::</span><span class="nx">unique</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$query</span><span class="o">-&gt;</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<p><a name="rule-url"></a></p>

<h4>url</h4>

<p>The field under validation must be a valid URL.</p>

<p><a name="rule-uuid"></a></p>

<h4>uuid</h4>

<p>The field under validation must be a valid RFC 4122 (version 1, 3, 4, or 5) universally unique identifier (UUID).</p>

<p><a name="conditionally-adding-rules"></a></p>

<h2>Conditionally Adding Rules</h2>

<h4>Skipping Validation When Fields Have Certain Values</h4>

<p>You may occasionally wish to not validate a given field if another field has a given value. You may accomplish this using the <code>exclude_if</code> validation rule. In this example, the <code>appointment_date</code> and <code>doctor_name</code> fields will not be validated if the <code>has_appointment</code> field has a value of <code>false</code>:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;has_appointment&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|bool&#39;</span><span class="p">,</span>
    <span class="s1">&#39;appointment_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exclude_if:has_appointment,false|required|date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;doctor_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exclude_if:has_appointment,false|required|string&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Alternatively, you may use the <code>exclude_unless</code> rule to not validate a given field unless another field has a given value:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;has_appointment&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|bool&#39;</span><span class="p">,</span>
    <span class="s1">&#39;appointment_date&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exclude_unless:has_appointment,true|required|date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;doctor_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;exclude_unless:has_appointment,true|required|string&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<h4>Validating When Present</h4>

<p>In some situations, you may wish to run validation checks against a field <strong>only</strong> if that field is present in the input array. To quickly accomplish this, add the <code>sometimes</code> rule to your rule list:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;sometimes|required|email&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>In the example above, the <code>email</code> field will only be validated if it is present in the <code>$data</code> array.</p>

<blockquote>
<p>{tip} If you are attempting to validate a field that should always be present but may be empty, check out <a href="#a-note-on-optional-fields">this note on optional fields</a></p>
</blockquote>

<h4>Complex Conditional Validation</h4>

<p>Sometimes you may wish to add validation rules based on more complex conditional logic. For example, you may wish to require a given field only if another field has a greater value than 100. Or, you may need two fields to have a given value only when another field is present. Adding these validation rules doesn&#39;t have to be a pain. First, create a <code>Validator</code> instance with your <em>static rules</em> that never change:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$data</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;games&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|numeric&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Let&#39;s assume our web application is for game collectors. If a game collector registers with our application and they own more than 100 games, we want them to explain why they own so many games. For example, perhaps they run a game resale shop, or maybe they just enjoy collecting. To conditionally add this requirement, we can use the <code>sometimes</code> method on the <code>Validator</code> instance.</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;required|max:500&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>The first argument passed to the <code>sometimes</code> method is the name of the field we are conditionally validating. The second argument is the rules we want to add. If the <code>Closure</code> passed as the third argument returns <code>true</code>, the rules will be added. This method makes it a breeze to build complex conditional validations. You may even add conditional validations for several fields at once:</p>
<div class="highlight"><pre><span></span><span class="nx">$v</span><span class="o">-&gt;</span><span class="nx">sometimes</span><span class="p">([</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;cost&#39;</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$input</span><span class="o">-&gt;</span><span class="nx">games</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{tip} The <code>$input</code> parameter passed to your <code>Closure</code> will be an instance of <code>Illuminate\Support\Fluent</code> and may be used to access your input and files.</p>
</blockquote>

<p><a name="validating-arrays"></a></p>

<h2>Validating Arrays</h2>

<p>Validating array based form input fields doesn&#39;t have to be a pain. You may use &quot;dot notation&quot; to validate attributes within an array. For example, if the incoming HTTP request contains a <code>photos[profile]</code> field, you may validate it like so:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;photos.profile&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required|image&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>You may also validate each element of an array. For example, to validate that each e-mail in a given array input field is unique, you may do the following:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;person.*.email&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;email|unique:users&#39;</span><span class="p">,</span>
    <span class="s1">&#39;person.*.first_name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;required_with:person.*.last_name&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>

<p>Likewise, you may use the <code>*</code> character when specifying your validation messages in your language files, making it a breeze to use a single validation message for array based fields:</p>
<div class="highlight"><pre><span></span><span class="s1">&#39;custom&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;person.*.email&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;unique&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Each person must have a unique e-mail address&#39;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">],</span>
</pre></div>

<p><a name="custom-validation-rules"></a></p>

<h2>Custom Validation Rules</h2>

<p><a name="using-rule-objects"></a></p>

<h3>Using Rule Objects</h3>

<p>Laravel provides a variety of helpful validation rules; however, you may wish to specify some of your own. One method of registering custom validation rules is using rule objects. To generate a new rule object, you may use the <code>make:rule</code> Artisan command. Let&#39;s use this command to generate a rule that verifies a string is uppercase. Laravel will place the new rule in the <code>app/Rules</code> directory:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">rule</span> <span class="nx">Uppercase</span>
</pre></div>

<p>Once the rule has been created, we are ready to define its behavior. A rule object contains two methods: <code>passes</code> and <code>message</code>. The <code>passes</code> method receives the attribute value and name, and should return <code>true</code> or <code>false</code> depending on whether the attribute value is valid or not. The <code>message</code> method should return the validation error message that should be used when validation fails:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Rules</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Validation\Rule</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Uppercase</span> <span class="k">implements</span> <span class="nx">Rule</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Determine if the validation rule passes.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  string  $attribute</span>
<span class="sd">     * @param  mixed  $value</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">passes</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">===</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the validation error message.</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">message</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;The :attribute must be uppercase.&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You may call the <code>trans</code> helper from your <code>message</code> method if you would like to return an error message from your translation files:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Get the validation error message.</span>
<span class="cm"> *</span>
<span class="cm"> * @return string</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">message</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">trans</span><span class="p">(</span><span class="s1">&#39;validation.uppercase&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Once the rule has been defined, you may attach it to a validator by passing an instance of the rule object with your other validation rules:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">App</span><span class="err">\</span><span class="nx">Rules</span><span class="err">\</span><span class="nx">Uppercase</span><span class="p">;</span>

<span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">validate</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Uppercase</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="using-closures"></a></p>

<h3>Using Closures</h3>

<p>If you only need the functionality of a custom rule once throughout your application, you may use a Closure instead of a rule object. The Closure receives the attribute&#39;s name, the attribute&#39;s value, and a <code>$fail</code> callback that should be called if validation fails:</p>
<div class="highlight"><pre><span></span><span class="nx">$validator</span> <span class="o">=</span> <span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$request</span><span class="o">-&gt;</span><span class="nx">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;title&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;max:255&#39;</span><span class="p">,</span>
        <span class="kd">function</span> <span class="p">(</span><span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$fail</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$value</span> <span class="o">===</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$fail</span><span class="p">(</span><span class="nx">$attribute</span><span class="p">.</span><span class="s1">&#39; is invalid.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>

<p><a name="using-extensions"></a></p>

<h3>Using Extensions</h3>

<p>Another method of registering custom validation rules is using the <code>extend</code> method on the <code>Validator</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>. Let&#39;s use this method within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a> to register a custom validation rule:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Validator</span><span class="o">::</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$validator</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The custom validator Closure receives four arguments: the name of the <code>$attribute</code> being validated, the <code>$value</code> of the attribute, an array of <code>$parameters</code> passed to the rule, and the <code>Validator</code> instance.</p>

<p>You may also pass a class and method to the <code>extend</code> method instead of a Closure:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooValidator@validate&#39;</span><span class="p">);</span>
</pre></div>

<h4>Defining The Error Message</h4>

<p>You will also need to define an error message for your custom rule. You can do so either using an inline custom message array or by adding an entry in the validation language file. This message should be placed in the first level of the array, not within the <code>custom</code> array, which is only for attribute-specific error messages:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;foo&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;Your input was invalid!&quot;</span><span class="p">,</span>

<span class="s2">&quot;accepted&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;The :attribute must be accepted.&quot;</span><span class="p">,</span>

<span class="c1">// The rest of the validation error messages...</span>
</pre></div>

<p>When creating a custom validation rule, you may sometimes need to define custom placeholder replacements for error messages. You may do so by creating a custom Validator as described above then making a call to the <code>replacer</code> method on the <code>Validator</code> facade. You may do this within the <code>boot</code> method of a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Bootstrap any application services.</span>
<span class="cm"> *</span>
<span class="cm"> * @return void</span>
<span class="cm"> */</span>
<span class="kr">public</span> <span class="kd">function</span> <span class="nx">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">Validator</span><span class="o">::</span><span class="nx">extend</span><span class="p">(...);</span>

    <span class="nx">Validator</span><span class="o">::</span><span class="nx">replacer</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$message</span><span class="p">,</span> <span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$rule</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(...);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p><a name="implicit-extensions"></a></p>

<h3>Implicit Extensions</h3>

<p>By default, when an attribute being validated is not present or contains an empty string, normal validation rules, including custom extensions, are not run. For example, the <a href="#rule-unique"><code>unique</code></a> rule will not be run against an empty string:</p>
<div class="highlight"><pre><span></span><span class="nx">$rules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;unique:users,name&#39;</span><span class="p">];</span>

<span class="nx">$input</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">];</span>

<span class="nx">Validator</span><span class="o">::</span><span class="nx">make</span><span class="p">(</span><span class="nx">$input</span><span class="p">,</span> <span class="nx">$rules</span><span class="p">)</span><span class="o">-&gt;</span><span class="nx">passes</span><span class="p">();</span> <span class="c1">// true</span>
</pre></div>

<p>For a rule to run even when an attribute is empty, the rule must imply that the attribute is required. To create such an &quot;implicit&quot; extension, use the <code>Validator::extendImplicit()</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Validator</span><span class="o">::</span><span class="nx">extendImplicit</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$attribute</span><span class="p">,</span> <span class="nx">$value</span><span class="p">,</span> <span class="nx">$parameters</span><span class="p">,</span> <span class="nx">$validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$value</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>{note} An &quot;implicit&quot; extension only <em>implies</em> that the attribute is required. Whether it actually invalidates a missing or empty attribute is up to you.</p>
</blockquote>

<h4>Implicit Rule Objects</h4>

<p>If you would like a rule object to run when an attribute is empty, you should implement the <code>Illuminate\Contracts\Validation\ImplicitRule</code> interface. This interface serves as a &quot;marker interface&quot; for the validator; therefore, it does not contain any methods you need to implement.</p>
<div style="page-break-after: always;" ></div><h1>Email Verification</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#model-preparation">Model Preparation</a></li>
<li><a href="#verification-database">Database Considerations</a></li>
<li><a href="#verification-routing">Routing</a>

<ul>
<li><a href="#protecting-routes">Protecting Routes</a></li>
</ul></li>
<li><a href="#verification-views">Views</a></li>
<li><a href="#after-verifying-emails">After Verifying Emails</a></li>
<li><a href="#events">Events</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<p>Many web applications require users to verify their email addresses before using the application. Rather than forcing you to re-implement this on each application, Laravel provides convenient methods for sending and verifying email verification requests.</p>

<p><a name="model-preparation"></a></p>

<h2>Model Preparation</h2>

<p>To get started, verify that your <code>App\Models\User</code> model implements the <code>Illuminate\Contracts\Auth\MustVerifyEmail</code> contract:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\MustVerifyEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">MustVerifyEmail</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Once this interface has been added to your model, newly registered users will automatically be sent an email containing an email verification link. As you can see by examining your <code>EventServiceProvider</code>, Laravel already contains a <code>SendEmailVerificationNotification</code> listener that is attached to the <code>Illuminate\Auth\Events\Registered</code> event.</p>

<p><a name="verification-database"></a></p>

<h3>Database Considerations</h3>

<h4>The Email Verification Column</h4>

<p>Next, your <code>user</code> table must contain an <code>email_verified_at</code> column to store the date and time that the email address was verified. By default, the <code>users</code> table migration included with the Laravel framework already includes this column. So, all you need to do is run your database migrations:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</pre></div>

<p><a name="verification-routing"></a></p>

<h2>Routing</h2>

<p>Laravel includes the <code>Auth\VerificationController</code> class that contains the necessary logic to send verification links and verify emails. To register the necessary routes for this controller, pass the <code>verify</code> option to the <code>Auth::routes</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">Auth</span><span class="o">::</span><span class="nx">routes</span><span class="p">([</span><span class="s1">&#39;verify&#39;</span> <span class="p">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
</pre></div>

<p><a name="protecting-routes"></a></p>

<h3>Protecting Routes</h3>

<p><a href="/docs/%7B%7Bversion%7D%7D/middleware">Route middleware</a> can be used to only allow verified users to access a given route. Laravel ships with a <code>verified</code> middleware, which is defined at <code>Illuminate\Auth\Middleware\EnsureEmailIsVerified</code>. Since this middleware is already registered in your application&#39;s HTTP kernel, all you need to do is attach the middleware to a route definition:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Only verified users may enter...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nx">middleware</span><span class="p">(</span><span class="s1">&#39;verified&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="verification-views"></a></p>

<h2>Views</h2>

<p>To generate all of the necessary view for email verification, you may use the <code>laravel/ui</code> Composer package:</p>
<div class="highlight"><pre><span></span><span class="nx">composer</span> <span class="nx">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">ui</span>

<span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">ui</span> <span class="nx">vue</span> <span class="o">--</span><span class="nx">auth</span>
</pre></div>

<p>The email verification view is placed in <code>resources/views/auth/verify.blade.php</code>. You are free to customize this view as needed for your application.</p>

<p><a name="after-verifying-emails"></a></p>

<h2>After Verifying Emails</h2>

<p>After an email address is verified, the user will automatically be redirected to <code>/home</code>. You can customize the post verification redirect location by defining a <code>redirectTo</code> method or property on the <code>VerificationController</code>:</p>
<div class="highlight"><pre><span></span><span class="kr">protected</span> <span class="nx">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">;</span>
</pre></div>

<p><a name="events"></a></p>

<h2>Events</h2>

<p>Laravel dispatches <a href="/docs/%7B%7Bversion%7D%7D/events">events</a> during the email verification process. You may attach listeners to these events in your <code>EventServiceProvider</code>:</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * The event listener mappings for the application.</span>
<span class="cm"> *</span>
<span class="cm"> * @var array</span>
<span class="cm"> */</span>
<span class="kr">protected</span> <span class="nx">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Illuminate\Auth\Events\Verified&#39;</span> <span class="p">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;App\Listeners\LogVerifiedUser&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></div>
<div style="page-break-after: always;" ></div><h1>Views</h1>

<ul>
<li><a href="#creating-views">Creating Views</a></li>
<li><a href="#passing-data-to-views">Passing Data To Views</a>

<ul>
<li><a href="#sharing-data-with-all-views">Sharing Data With All Views</a></li>
</ul></li>
<li><a href="#view-composers">View Composers</a></li>
<li><a href="#optimizing-views">Optimizing Views</a></li>
</ul>

<p><a name="creating-views"></a></p>

<h2>Creating Views</h2>

<blockquote>
<p>{tip} Looking for more information on how to write Blade templates? Check out the full <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade documentation</a> to get started.</p>
</blockquote>

<p>Views contain the HTML served by your application and separate your controller / application logic from your presentation logic. Views are stored in the <code>resources/views</code> directory. A simple view might look something like this:</p>
<div class="highlight"><pre><span></span><span class="c">&lt;!--</span> <span class="nx">View</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">resources</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">blade</span><span class="p">.</span><span class="nx">php</span> <span class="o">--&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{{</span> <span class="nx">$name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
    <span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>

<p>Since this view is stored at <code>resources/views/greeting.blade.php</code>, we may return it using the global <code>view</code> helper like so:</p>
<div class="highlight"><pre><span></span><span class="nx">Route</span><span class="o">::</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;James&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>

<p>As you can see, the first argument passed to the <code>view</code> helper corresponds to the name of the view file in the <code>resources/views</code> directory. The second argument is an array of data that should be made available to the view. In this case, we are passing the <code>name</code> variable, which is displayed in the view using <a href="/docs/%7B%7Bversion%7D%7D/blade">Blade syntax</a>.</p>

<p>Views may also be nested within subdirectories of the <code>resources/views</code> directory. &quot;Dot&quot; notation may be used to reference nested views. For example, if your view is stored at <code>resources/views/admin/profile.blade.php</code>, you may reference it like so:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;admin.profile&#39;</span><span class="p">,</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<blockquote>
<p>{note} View directory names should not contain the <code>.</code> character.</p>
</blockquote>

<h4>Determining If A View Exists</h4>

<p>If you need to determine if a view exists, you may use the <code>View</code> facade. The <code>exists</code> method will return <code>true</code> if the view exists:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">View</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">View</span><span class="o">::</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;emails.customer&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>

<h4>Creating The First Available View</h4>

<p>Using the <code>first</code> method, you may create the first view that exists in a given array of views. This is useful if your application or package allows views to be customized or overwritten:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">()</span><span class="o">-&gt;</span><span class="nx">first</span><span class="p">([</span><span class="s1">&#39;custom.admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p>You may also call this method via the <code>View</code> <a href="/docs/%7B%7Bversion%7D%7D/facades">facade</a>:</p>
<div class="highlight"><pre><span></span><span class="nx">use</span> <span class="nx">Illuminate</span><span class="err">\</span><span class="nx">Support</span><span class="err">\</span><span class="nx">Facades</span><span class="err">\</span><span class="nx">View</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="nx">first</span><span class="p">([</span><span class="s1">&#39;custom.admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">],</span> <span class="nx">$data</span><span class="p">);</span>
</pre></div>

<p><a name="passing-data-to-views"></a></p>

<h2>Passing Data To Views</h2>

<p>As you saw in the previous examples, you may pass an array of data to views:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greetings&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">]);</span>
</pre></div>

<p>When passing information in this manner, the data should be an array with key / value pairs. Inside your view, you can then access each value using its corresponding key, such as <code>&lt;?php echo $key; ?&gt;</code>. As an alternative to passing a complete array of data to the <code>view</code> helper function, you may use the <code>with</code> method to add individual pieces of data to the view:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kd">with</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Victoria&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="sharing-data-with-all-views"></a></p>

<h4>Sharing Data With All Views</h4>

<p>Occasionally, you may need to share a piece of data with all views that are rendered by your application. You may do so using the view facade&#39;s <code>share</code> method. Typically, you should place calls to <code>share</code> within a service provider&#39;s <code>boot</code> method. You are free to add them to the <code>AppServiceProvider</code> or generate a separate service provider to house them:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">View</span><span class="o">::</span><span class="na">share</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a name="view-composers"></a></p>

<h2>View Composers</h2>

<p>View composers are callbacks or class methods that are called when a view is rendered. If you have data that you want to be bound to a view each time that view is rendered, a view composer can help you organize that logic into a single location.</p>

<p>For this example, let&#39;s register the view composers within a <a href="/docs/%7B%7Bversion%7D%7D/providers">service provider</a>. We&#39;ll use the <code>View</code> facade to access the underlying <code>Illuminate\Contracts\View\Factory</code> contract implementation. Remember, Laravel does not include a default directory for view composers. You are free to organize them however you wish. For example, you could create an <code>app/Http/View/Composers</code> directory:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\View</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ViewServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bootstrap any application services.</span>
<span class="sd">     *</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Using class based composers...</span>
        <span class="nx">View</span><span class="o">::</span><span class="na">composer</span><span class="p">(</span>
            <span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\View\Composers\ProfileComposer&#39;</span>
        <span class="p">);</span>

        <span class="c1">// Using Closure based composers...</span>
        <span class="nx">View</span><span class="o">::</span><span class="na">composer</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$view</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>{note} Remember, if you create a new service provider to contain your view composer registrations, you will need to add the service provider to the <code>providers</code> array in the <code>config/app.php</code> configuration file.</p>
</blockquote>

<p>Now that we have registered the composer, the <code>ProfileComposer@compose</code> method will be executed each time the <code>profile</code> view is being rendered. So, let&#39;s define the composer class:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\View\Composers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Repositories\UserRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\View\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProfileComposer</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The user repository implementation.</span>
<span class="sd">     *</span>
<span class="sd">     * @var UserRepository</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new profile composer.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  UserRepository  $users</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$users</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Dependencies automatically resolved by service container...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="nv">$users</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Bind data to the view.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  View  $view</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compose</span><span class="p">(</span><span class="nx">View</span> <span class="nv">$view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Just before the view is rendered, the composer&#39;s <code>compose</code> method is called with the <code>Illuminate\View\View</code> instance. You may use the <code>with</code> method to bind data to the view.</p>

<blockquote>
<p>{tip} All view composers are resolved via the <a href="/docs/%7B%7Bversion%7D%7D/container">service container</a>, so you may type-hint any dependencies you need within a composer&#39;s constructor.</p>
</blockquote>

<h4>Attaching A Composer To Multiple Views</h4>

<p>You may attach a view composer to multiple views at once by passing an array of views as the first argument to the <code>composer</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;dashboard&#39;</span><span class="p">],</span>
    <span class="s1">&#39;App\Http\View\Composers\MyViewComposer&#39;</span>
<span class="p">);</span>
</pre></div>

<p>The <code>composer</code> method also accepts the <code>*</code> character as a wildcard, allowing you to attach a composer to all views:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">composer</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$view</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">});</span>
</pre></div>

<h4>View Creators</h4>

<p>View <strong>creators</strong> are very similar to view composers; however, they are executed immediately after the view is instantiated instead of waiting until the view is about to render. To register a view creator, use the <code>creator</code> method:</p>
<div class="highlight"><pre><span></span><span class="nx">View</span><span class="o">::</span><span class="nx">creator</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Http\View\Creators\ProfileCreator&#39;</span><span class="p">);</span>
</pre></div>

<p><a name="optimizing-views"></a></p>

<h2>Optimizing Views</h2>

<p>By default, views are compiled on demand. When a request is executed that renders a view, Laravel will determine if a compiled version of the view exists. If the file exists, Laravel will then determine if the uncompiled view has been modified more recently than the compiled view. If the compiled view either does not exist, or the uncompiled view has been modified, Laravel will recompile the view.</p>

<p>Compiling views during the request negatively impacts performance, so Laravel provides the <code>view:cache</code> Artisan command to precompile all of the views utilized by your application. For increased performance, you may wish to run this command as part of your deployment process:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">view</span><span class="o">:</span><span class="nx">cache</span>
</pre></div>

<p>You may use the <code>view:clear</code> command to clear the view cache:</p>
<div class="highlight"><pre><span></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">view</span><span class="o">:</span><span class="nx">clear</span>
</pre></div>
<div style="page-break-after: always;" ></div></div></body></html>